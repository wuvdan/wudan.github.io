{"meta":{"title":"ä¸€ä¸ªå­¤ç‹¬çš„æ¬ç çŒ¿","subtitle":"iOSer","description":"","author":"","url":"https://github.com/wuvdan/wuvdan.github.io","root":"/"},"pages":[{"title":"å…³äº","date":"2020-01-17T07:52:27.857Z","updated":"2020-01-17T07:52:27.853Z","comments":true,"path":"about/index.html","permalink":"https://github.com/wuvdan/wuvdan.github.io/about/index.html","excerpt":"","text":"åŸºæœ¬ä¿¡æ¯ æ€§åˆ«ï¼šç”· å‡ºç”Ÿå¹´æœˆï¼š1996-10 æ¦‚è¦æˆ‘æ˜¯ä¸€ä¸ªä¸“æ³¨äºiOSå¼€å‘çš„èŒä¸šå·¥ä½œè€…ï¼Œä¸€èˆ¬å¼€å‘è¯­è¨€ä½¿ç”¨çš„æ˜¯Objective-Cï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨Swiftè¿›è¡Œç®€å•çš„å¼€å‘ã€‚å–œæ¬¢ç¼–ç¨‹ï¼Œå¯¹æ–°çŸ¥è¯†æœ‰æ¸´æœ›çš„æ¢çŸ¥æ¬²ã€‚å¹³æ—¶çš„çˆ±å¥½å°±æ˜¯å–œæ¬¢çœ‹çœ‹åšå®¢å’Œå†™å†™åšå®¢ï¼Œè®°å½•è‡ªå·±çš„å­¦ä¹ ç»å†ã€‚è‡ªå·±çš„èŒä¸šè§„åˆ’æ˜¯æˆä¸ºä¸€åiOSå¼€å‘é«˜çº§å·¥ç¨‹å¸ˆã€‚ å·¥ä½œç»å† 2019-08 ~ è‡³ä»Šï¼š å®‰å¾½å¥½é©¬ç§‘æŠ€æœ‰é™å…¬å¸(iOSå¼€å‘å·¥ç¨‹å¸ˆ) 2018-08 ~ 2019-08ï¼š æ­å·é“¶æ±ŸåŒ»è”ç½‘è‚¡ä»½æœ‰é™å…¬å¸(iOSå¼€å‘å·¥ç¨‹å¸ˆ) 2017-12 ~ 2018-08ï¼šæ­å·ä¼šå‹ç§‘æŠ€æœ‰é™å…¬å¸(iOSå¼€å‘å·¥ç¨‹å¸ˆ) 2017-06 ~ 2017-09ï¼šä¸Šæµ·å·¦æ£®æ™ºèƒ½ç§‘æŠ€æœ‰é™å…¬å¸(iOSå¼€å‘å·¥ç¨‹å¸ˆã€æµ‹è¯•å·¥ç¨‹å¸ˆ) é¡¹ç›®ç»å†1. åŒ»æ˜“é€š(åŒ»æŠ¤ç«¯) æ—¶é—´: 2018-08 ~ è‡³ä»Š å·¥ä½œèŒè´£ï¼š é¡¹ç›®éœ€æ±‚ç ”è®¨ Bugä¿®æ”¹ è¿­ä»£ä¸Šçº¿ å·¥ä½œå†…å®¹ï¼š æ–°åŠŸèƒ½å¼€å‘ ä¿®æ”¹Bug å¢åŠ ç”¨æˆ·ä½“éªŒ é¡µé¢ä¼˜åŒ– éš¾ç‚¹ï¼š XIBä½¿ç”¨ 2. èŠ½å„¿é˜…è¯» æ—¶é—´: 2018-03 ~ 2018-06 å·¥ä½œèŒè´£ï¼š é¡¹ç›®éœ€æ±‚ç ”è®¨ é¡¹ç›®ä»£ç å¼€å‘ è¿­ä»£ä¸Šçº¿ å·¥ä½œå†…å®¹ï¼š æ–°åŠŸèƒ½å¼€å‘ äº§å“ç»´æŠ¤ éš¾ç‚¹ï¼š è¿œç¨‹é€šçŸ¥å¤„ç† CollectionViewCellå¤ç”¨ 3. å‹åˆ© æ—¶é—´: 2017-12 ~ 2018-02 å·¥ä½œèŒè´£ï¼š é¡¹ç›®ç»´æŠ¤ è¿­ä»£ä¸Šçº¿ å·¥ä½œå†…å®¹ï¼š ä¿®å¤Bug æ–°å¢å•†åŸæ¨¡å— éš¾ç‚¹ï¼š å•†åŸè®¢å•å¤„ç† TableViewCellå¤ç”¨ 4. å¡æœå…ˆç”Ÿ æ—¶é—´: 2017-06 ~ 09 å·¥ä½œèŒè´£ï¼š é¡¹ç›®ç»´æŠ¤ è¿­ä»£ä¸Šçº¿ å·¥ä½œå†…å®¹ï¼š é»‘ç›’æµ‹è¯• ä¿®å¤å·²çŸ¥Bug æ–°å¢ç¬¬ä¸‰æ–¹ç™»é™† æ–°å¢é¡µé¢ç»˜åˆ¶ éš¾ç‚¹ï¼š ç¬¬ä¸‰æ–¹ç™»é™†ä¿¡æ¯è·å– ä¸“ä¸šæŠ€èƒ½ï¼š ç¬¬ä¸‰æ–¹å¼€æºåº“ç†Ÿç»ƒä½¿ç”¨ æå…‰æ¨é€ å‹ç›Ÿåˆ†äº«ã€å‹ç›Ÿç»Ÿè®¡ åŸç”ŸQQ/å¾®ä¿¡ç­‰ç¬¬ä¸‰æ–¹ç™»å½•å’Œåˆ†äº« AppStoreæµç¨‹ï¼šç†Ÿæ‚‰ä¸Šæ¶ã€è½¬è®©ã€æ›´æ–°ç­‰æµç¨‹ æŠ€èƒ½æ¸…å•ï¼š UIæ§ä»¶ã€å·¥å…·åº“å°è£… ç†Ÿæ‚‰é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Œäº†è§£iOSäº§å“å¼€å‘æµç¨‹ ç†Ÿç»ƒä½¿ç”¨StoryBoard/Xibå¸ƒå±€å’Œçº¯ä»£ç å¸ƒå±€ æŒæ¡Swiftè¯­è¨€ å¯¹è½¯ä»¶å¼€å‘æœ‰è¾ƒå¼ºçš„é€»è¾‘åˆ†æèƒ½åŠ›ï¼Œè‰¯å¥½çš„æ–‡æ¡£é˜…è¯»èƒ½åŠ› çƒ­çˆ±ç¼–ç¨‹ï¼Œå–œæ¬¢ç ”ç©¶æ–°æŠ€æœ¯ è”ç³»æ–¹å¼ QQ/WeChat: 158019325 E-mial: wudan_ios@163.comè‡´è°¢æ„Ÿè°¢æ‚¨èŠ±æ—¶é—´é˜…è¯»æˆ‘çš„ç®€å†ï¼ŒæœŸå¾…èƒ½æœ‰æœºä¼šå’Œæ‚¨å…±äº‹ã€‚"},{"title":"404 Not Found","date":"2020-01-17T06:55:27.700Z","updated":"2020-01-17T06:55:12.377Z","comments":true,"path":"404.html","permalink":"https://github.com/wuvdan/wuvdan.github.io/404.html","excerpt":"","text":""},{"title":"æ‰€æœ‰åˆ†ç±»","date":"2020-01-17T07:56:07.558Z","updated":"2020-01-17T07:56:07.552Z","comments":true,"path":"categories/index.html","permalink":"https://github.com/wuvdan/wuvdan.github.io/categories/index.html","excerpt":"","text":""},{"title":"æ‰€æœ‰æ ‡ç­¾","date":"2020-01-17T07:55:54.265Z","updated":"2020-01-17T07:55:54.259Z","comments":true,"path":"tag/index.html","permalink":"https://github.com/wuvdan/wuvdan.github.io/tag/index.html","excerpt":"","text":""}],"posts":[{"title":"iOSåº•å±‚-KVO","slug":"iOSåº•å±‚-KVO","date":"2020-01-16T09:10:36.000Z","updated":"2020-01-20T01:49:43.576Z","comments":true,"path":"2020/01/16/iOSåº•å±‚-KVO/","link":"","permalink":"https://github.com/wuvdan/wuvdan.github.io/2020/01/16/iOS%E5%BA%95%E5%B1%82-KVO/","excerpt":"","text":"ç±»çš„å•ä¸ªå±æ€§è§‚å¯Ÿè§‚å¯Ÿå€¼çš„4ä¸­æ¨¡å¼ 123456&#x2F;** * NSKeyValueObservingOptionNew æ–°å€¼ * NSKeyValueObservingOptionOld æ—§å€¼ * NSKeyValueObservingOptionInitial æ³¨å†Œå‘é€é€šçŸ¥ï¼Œæ”¹å˜æ—¶å‘é€é€šçŸ¥ * NSKeyValueObservingOptionPrior æ”¹å˜ä¹‹å‰å‘é€é€šçŸ¥ï¼Œæ”¹å˜åå‘é€é€šçŸ¥ *&#x2F; é’ˆå¯¹Personç±»é‡Œé¢çš„nameå±æ€§è¿›è¡Œè§‚å¯Ÿ 1[person addObserver:self forKeyPath:@&quot;name&quot; options:NSKeyValueObservingOptionNew context:nil]; æŸ¥çœ‹è§‚å¯Ÿ 123- (void)observeValueForKeyPath:(NSString *)keyPath ofObject:(id)object change:(NSDictionary&lt;NSKeyValueChangeKey,id&gt; *)change context:(void *)context &#123; NSLog(@&quot;%@&quot;, change);&#125; æ‰“å°æ•ˆæœ 12342019-03-22 09:20:16.875033+0800 KVO[1844:81256] &#123; kind &#x3D; 1; new &#x3D; 0;&#125; ç±»çš„é‡Œé¢åµŒå¥—å…¶ä»–çš„å±æ€§è§‚å¯Ÿè§‚å¯ŸPersoné‡Œé¢Dogç±»çš„ageï¼Œé€šè¿‡ç‚¹è¯­æ³•ç›´æ¥ç›‘å¬ 1[person addObserver:self forKeyPath:@&quot;dog.age&quot; options:NSKeyValueObservingOptionNew context:nil]; è¾“å…¥ç»“æœ 12342019-03-22 09:23:25.854859+0800 KVO[1876:84141] &#123; kind &#x3D; 1; new &#x3D; 11;&#125; ä¸€æ¬¡æ€§è§‚å¯Ÿå¤šä¸ªå€¼ä¾‹å¦‚è§‚å¯ŸPersoné‡Œé¢çš„Dogçš„ageå’Œlevelï¼Œåˆ™åœ¨Personç±»ä¸­é‡æ–°+ (NSSet&lt;NSString *&gt; *)keyPathsForValuesAffectingValueForKey:(NSString *)key 12345678+ (NSSet&lt;NSString *&gt; *)keyPathsForValuesAffectingValueForKey:(NSString *)key &#123; NSSet *keyPaths &#x3D; [super keyPathsForValuesAffectingValueForKey:key]; if ([key isEqualToString:@&quot;dog&quot;]) &#123; NSArray *array &#x3D; @[@&quot;_dog.name&quot;, @&quot;_dog.level&quot;]; keyPaths &#x3D; [keyPaths setByAddingObjectsFromArray:array]; &#125; return keyPaths;&#125; ç›´æ¥è§‚å¯ŸDogç±» 1[person addObserver:self forKeyPath:@&quot;dog&quot; options:NSKeyValueObservingOptionNew context:nil]; æ‰“å°ç»“æœ 12342019-03-22 09:27:11.485240+0800 KVO[1929:87568] &#123; kind &#x3D; 1; new &#x3D; &quot;&lt;Dog: 0x6000027c0b80&gt;&quot;;&#125; æ‰‹åŠ¨æ¨¡å¼åœ¨Personç±»ä¸­é‡å†™+ (BOOL)automaticallyNotifiesObserversForKey:(NSString *)key 1234+ (BOOL)automaticallyNotifiesObserversForKey:(NSString *)key &#123; &#x2F;&#x2F; ä¿®æ”¹ä¸ºæ‰‹åŠ¨æ¨¡å¼ return NO;&#125; æ‰‹åŠ¨è§¦å‘ 12[self.person willChangeValueForKey:@&quot;name&quot;];[self.person didChangeValueForKey:@&quot;name&quot;]; è§‚å¯Ÿå®¹å™¨ç±»éœ€è¦åˆ©ç”¨KVCä¾‹å¦‚è§‚å¯Ÿpersonä¸­çš„array 1[[self.person mutableArrayValueForKey:@&quot;array&quot;] addObject:@&quot;obj&quot;]; è¾“å‡ºç»“æœ 12345672019-03-22 11:02:13.996095+0800 KVO[5521:170395] &#123; indexes &#x3D; &quot;&lt;_NSCachedIndexSet: 0x600002216160&gt;[number of indexes: 1 (in 1 ranges), indexes: (0)]&quot;; kind &#x3D; 2; new &#x3D; ( obj );&#125; KVOçš„åº•å±‚å®ç°å®è´¨ï¼šè§‚å¯Ÿå€¼çš„setteræ–¹æ³•é€šè¿‡runtimeï¼Œæ–°å»ºä¸€ä¸ªå­ç±»ç»§æ‰¿äºè§‚å¯Ÿç±»ï¼ˆNSKVONotifing_ç±»åï¼‰ï¼ŒåŠ¨æ€çš„ä¿®æ”¹äº†è§‚å¯Ÿç±»çš„ç±»å‹ä¸ºå­ç±»çš„ç±»å‹,åœ¨å­ç±»é‡Œé¢é‡å†™setæ–¹æ³•ï¼Œè°ƒç”¨ 12345- (void)setName:(NSString *)name &#123; [self willChangeValueForKey:@&quot;name&quot;]; [super setName:name]; [self didChangeValueForKey:@&quot;name&quot;]; &#125;","categories":[{"name":"åº•å±‚åŸç†","slug":"åº•å±‚åŸç†","permalink":"https://github.com/wuvdan/wuvdan.github.io/categories/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/"}],"tags":[{"name":"KVO","slug":"KVO","permalink":"https://github.com/wuvdan/wuvdan.github.io/tags/KVO/"}]},{"title":"iOSåº•å±‚-å±æ€§å…³é”®è¯","slug":"iOSåº•å±‚-å±æ€§å…³é”®è¯","date":"2020-01-16T09:10:36.000Z","updated":"2020-01-20T01:50:09.236Z","comments":true,"path":"2020/01/16/iOSåº•å±‚-å±æ€§å…³é”®è¯/","link":"","permalink":"https://github.com/wuvdan/wuvdan.github.io/2020/01/16/iOS%E5%BA%95%E5%B1%82-%E5%B1%9E%E6%80%A7%E5%85%B3%E9%94%AE%E8%AF%8D/","excerpt":"","text":"@propertyé»˜è®¤æ ¼å¼ï¼š@syntheszie var = _var; ARCä¸­ï¼Œé»˜è®¤ä¿®é¥° åŸºæœ¬æ•°æ®ç±»å‹@property (atomic, assign) å¯¹è±¡æ•°æ®ç±»å‹@property (atomic, strong) ä¿®é¥°è¯è§£é‡Š nonatomic éåŸå­æ€§è®¿é—®ï¼Œä¸å¯¹setæ–¹æ³•åŠ é”ï¼Œä¸æ˜¯å®‰å…¨çº¿ç¨‹ï¼Œä½†æ˜¯æ€§èƒ½é«˜ã€‚ atomic åŸå­æ€§è®¿é—®ï¼Œå¯¹ç”Ÿæˆçš„ set æ–¹æ³•åŠ äº’æ–¥é” @synchronized(é”å¯¹è±¡ï¼‰ï¼Œå®‰å…¨çº¿ç¨‹ï¼ˆä¸æ˜¯ç»å¯¹å®‰å…¨çº¿ç¨‹ï¼‰,æ€§èƒ½å·®ã€‚ strongARCä¸­ä½¿ç”¨ï¼Œä¿®é¥°OCå¯¹è±¡ï¼Œæ‹¥æœ‰å…³ç³»ï¼Œå¼•ç”¨è®¡æ•°å™¨+1ã€‚ reatainMRCä¸­ä½¿ç”¨ï¼Œä¿®é¥°OCå¯¹è±¡ï¼Œæ‹¥æœ‰å…³ç³»ï¼Œå¼•ç”¨è®¡æ•°å™¨+1ã€‚ assignä¿®é¥°åŸºç¡€æ•°æ®ç±»å‹ï¼Œç›´æ¥èµ‹å€¼ï¼Œéæ‹¥æœ‰å…³ç³»ï¼Œä¸ä½¿ç”¨å¼•ç”¨è®¡æ•°å™¨ã€‚ weakä¿®é¥°åè®®ï¼Œæ§ä»¶ï¼Œéæ‹¥æœ‰å…³ç³»ï¼ŒæŒ‡å‘çš„å¯¹è±¡é”€æ¯ï¼ŒæŒ‡é’ˆä¼šè‡ªåŠ¨ç½®ä¸ºnilï¼Œä¸ä½¿ç”¨å¼•ç”¨è®¡æ•°å™¨ã€‚ unsafe_unretainedä¸weakç±»ä¼¼ï¼Œä¸ä¼šè‡ªåŠ¨nilåŒ–ï¼Œå¦‚æœæ‰€æŒ‡å‘çš„å†…å­˜åŒºåŸŸè¢«é‡Šæ”¾äº†ï¼Œè¿™ä¸ªæŒ‡é’ˆå°±æ˜¯ä¸€ä¸ªé‡æŒ‡é’ˆã€‚ copyåœ¨ MRC æ—¶æ˜¯è¿™æ ·åšçš„ release æ—§å¯¹è±¡( æ—§å¯¹è±¡çš„å¼•ç”¨è®¡æ•°å™¨ -1 ) , copy æ–°å¯¹è±¡( æ–°å¯¹è±¡çš„å¼•ç”¨è®¡æ•°å™¨ +1 ) , ç„¶åæŒ‡å‘æ–°å¯¹è±¡ .ï¼ˆæ–°å¯¹è±¡æ˜¯æŒ‡æœ€ç»ˆæŒ‡å‘çš„é‚£ä¸ªå¯¹è±¡ï¼Œä¸ç®¡æ·±æ‹·è´è¿˜æ˜¯æµ…æ‹·è´ï¼‰ï¼Œåœ¨ ARC æ—¶æ˜¯è¿™ä¹ˆå¹²çš„ copy æ–°å¯¹è±¡( æ–°å¯¹è±¡çš„å¼•ç”¨è®¡æ•°å™¨ +1 ) , ç„¶åæŒ‡å‘æ–°å¯¹è±¡ã€‚ readonlyåªç”Ÿæˆgetæ–¹æ³•ï¼Œä¸æƒ³æŠŠæš´éœ²çš„å±æ€§è¢«äººéšä¾¿æ›¿æ¢æ—¶ , å¯ä»¥ä½¿ç”¨ã€‚ readwriteç”Ÿæˆget/setæ–¹æ³•ã€‚ @dynamicå‘Šè¯‰ç¼–è¯‘å™¨:å±æ€§çš„ setter ä¸ getter æ–¹æ³•ç”±ç”¨æˆ·è‡ªå·±å®ç°,ä¸è‡ªåŠ¨ç”Ÿæˆã€‚(å½“ç„¶å¯¹äº readonly çš„å±æ€§åªéœ€æä¾› getter å³å¯) @synthesizeå¦‚æœä½ æ²¡æœ‰æ‰‹åŠ¨å®ç° setter æ–¹æ³•å’Œ getter æ–¹æ³•,é‚£ä¹ˆç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ä¸ºä½ åŠ ä¸Šè¿™ä¸¤ä¸ªæ–¹æ³•ã€‚ @synchronizedçº¿ç¨‹åŒæ­¥é” é—®é¢˜ï¼šï¼ˆ1ï¼‰ä»€ä¹ˆæƒ…å†µä½¿ç”¨ weak å…³é”®å­—ï¼Ÿç›¸æ¯” assign æœ‰ä»€ä¹ˆä¸åŒ? ä½¿ç”¨ åè®®å£°æ˜ä½¿ç”¨weak IBOutlet ä½¿ç”¨weak weak å’Œ assign çš„ä¸åŒç‚¹: weak ç­–ç•¥åœ¨å±æ€§æ‰€æŒ‡çš„å¯¹è±¡é­åˆ°æ‘§æ¯æ—¶,ç³»ç»Ÿä¼šå°† weak ä¿®é¥°çš„å±æ€§å¯¹è±¡çš„æŒ‡é’ˆæŒ‡å‘ nil,åœ¨ OC ç»™ nil å‘æ¶ˆæ¯æ˜¯ä¸ä¼šæœ‰ä»€ä¹ˆé—®é¢˜çš„;å¦‚æœä½¿ç”¨ assign ç­–ç•¥åœ¨å±æ€§æ‰€æŒ‡çš„å¯¹è±¡é­åˆ°æ‘§æ¯æ—¶,å±æ€§å¯¹è±¡æŒ‡é’ˆè¿˜æŒ‡å‘åŸæ¥çš„å¯¹è±¡,ç”±äºå¯¹è±¡å·²ç»è¢«é”€æ¯,è¿™æ—¶å€™å°±äº§ç”Ÿäº†é‡æŒ‡é’ˆ,å¦‚æœè¿™æ—¶å€™åœ¨ç»™æ­¤å¯¹è±¡å‘é€æ¶ˆæ¯,å¾ˆå®¹é€ æˆç¨‹åºå¥”æºƒassigin å¯ä»¥ç”¨äºä¿®é¥°é OC å¯¹è±¡,è€Œ weak å¿…é¡»ç”¨äº OC å¯¹è±¡ã€‚ ï¼ˆ2ï¼‰ä½¿ç”¨ atomic ä¸€å®šæ˜¯çº¿ç¨‹å®‰å…¨çš„å—? ä¸æ˜¯,atomic çš„æœ¬æ„æ˜¯æŒ‡å±æ€§çš„å­˜å–æ–¹æ³•æ˜¯çº¿ç¨‹å®‰å…¨çš„,å¹¶ä¸ä¿è¯æ•´ä¸ªå¯¹è±¡æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ ä¾‹å¦‚ï¼š å£°æ˜ä¸€ä¸ª NSMutableArray çš„åŸå­å±æ€§ stuff,æ­¤æ—¶ self.stuff å’Œ self.stuff =othersulf éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä½†æ˜¯,ä½¿ç”¨[self.stuff objectAtIndex:index]å°±ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„,éœ€è¦ç”¨äº’æ–¥é”æ¥ä¿è¯çº¿ç¨‹å®‰å…¨æ€§ã€‚ ï¼ˆ3ï¼‰@synthesize å’Œ @dynamic åˆ†åˆ«æœ‰ä»€ä¹ˆä½œç”¨ @property æœ‰ä¸¤ä¸ªå¯¹åº”çš„è¯,ä¸€ä¸ªæ˜¯@synthesize,ä¸€ä¸ªæ˜¯@dynamicã€‚å¦‚æœ@synthesize å’Œ@dynamic éƒ½æ²¡å†™,é‚£ä¹ˆé»˜è®¤çš„å°±æ˜¯@syntheszie var = _var; @synthesize çš„è¯­ä¹‰æ˜¯å¦‚æœä½ æ²¡æœ‰æ‰‹åŠ¨å®ç° setter æ–¹æ³•å’Œ getter æ–¹æ³•,é‚£ä¹ˆç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ä¸ºä½ åŠ ä¸Šè¿™ä¸¤ä¸ªæ–¹æ³•ã€‚ @dynamic å‘Šè¯‰ç¼–è¯‘å™¨:å±æ€§çš„ setter ä¸ getter æ–¹æ³•ç”±ç”¨æˆ·è‡ªå·±å®ç°,ä¸è‡ªåŠ¨ç”Ÿæˆã€‚(å½“ç„¶å¯¹äº readonly çš„å±æ€§åªéœ€æä¾› getter å³å¯) å‡å¦‚ä¸€ä¸ªå±æ€§è¢«å£°æ˜ä¸º@dynamic varï¼›ç„¶åä½ æ²¡æœ‰æä¾›@setter æ–¹æ³•å’Œ@getter æ–¹æ³•,ç¼–è¯‘çš„æ—¶å€™æ²¡é—®é¢˜,ä½†æ˜¯å½“ç¨‹åºè¿è¡Œåˆ° instance.var = someVar,ç”±äºç¼º setteræ–¹æ³•ä¼šå¯¼è‡´ç¨‹åºå´©æºƒ;æˆ–è€…å½“è¿è¡Œåˆ° someVar = instance.var æ—¶,ç”±äºç¼º getter æ–¹æ³•åŒæ ·ä¼šå¯¼è‡´å´©æºƒã€‚ ï¼ˆ4ï¼‰ARC ä¸‹,ä¸æ˜¾å¼æŒ‡å®šä»»ä½•å±æ€§å…³é”®å­—æ—¶,é»˜è®¤çš„å…³é”®å­—éƒ½æœ‰å“ªäº›? åŸºæœ¬æ•°æ®ï¼š atomic,readwrite,assign æ™®é€šçš„ OC å¯¹è±¡: atomic,readwrite,strong ï¼ˆ5ï¼‰ç”¨@property å£°æ˜çš„ NSString(æˆ– NSArray,NSDictionary)ç»å¸¸ä½¿ç”¨ copy å…³é”®å­—,ä¸ºä»€ä¹ˆ?å¦‚æœæ”¹ç”¨ strong å…³é”®å­—,å¯èƒ½é€ æˆä»€ä¹ˆé—®é¢˜? å› ä¸ºçˆ¶ç±»æŒ‡é’ˆå¯ä»¥æŒ‡å‘å­ç±»å¯¹è±¡,ä½¿ç”¨ copy çš„ç›®çš„æ˜¯ä¸ºäº†è®©æœ¬å¯¹è±¡çš„å±æ€§ä¸å—å¤–ç•Œå½±å“,ä½¿ç”¨ copy æ— è®ºç»™æˆ‘ä¼ å…¥æ˜¯ä¸€ä¸ªå¯å˜å¯¹è±¡è¿˜æ˜¯ä¸å¯å¯¹è±¡,æˆ‘æœ¬èº«æŒæœ‰çš„å°±æ˜¯ä¸€ä¸ªä¸å¯å˜çš„å‰¯æœ¬. å¦‚æœæˆ‘ä»¬ä½¿ç”¨æ˜¯ strong,é‚£ä¹ˆè¿™ä¸ªå±æ€§å°±æœ‰å¯èƒ½æŒ‡å‘ä¸€ä¸ªå¯å˜å¯¹è±¡,å¦‚æœè¿™ä¸ªå¯å˜å¯¹è±¡åœ¨å¤–éƒ¨è¢«ä¿®æ”¹äº†,é‚£ä¹ˆä¼šå½±å“è¯¥å±æ€§. ï¼ˆ6ï¼‰è¿™ä¸ªå†™æ³•ä¼šå‡ºä»€ä¹ˆé—®é¢˜: @property(copy)NSMutableArray *array; å› ä¸º copy ç­–ç•¥æ‹·è´å‡ºæ¥çš„æ˜¯ä¸€ä¸ªä¸å¯å˜å¯¹è±¡,ç„¶è€Œå´æŠŠå®ƒå½“æˆå¯å˜å¯¹è±¡ä½¿ç”¨,å¾ˆå®¹æ˜“é€ æˆç¨‹åºå¥”æºƒè¿™é‡Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜,è¯¥å±æ€§ä½¿ç”¨äº†åŒæ­¥é”,ä¼šåœ¨åˆ›å»ºæ—¶ç”Ÿæˆä¸€äº›é¢å¤–çš„ä»£ç ç”¨äºå¸®åŠ©ç¼–å†™å¤šçº¿ç¨‹ç¨‹åº,è¿™ä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜,é€šè¿‡å£°æ˜ nonatomic å¯ä»¥èŠ‚çœè¿™äº›è™½ç„¶å¾ˆå°ä½†æ˜¯ä¸å¿…è¦é¢å¤–å¼€é”€,åœ¨ iOS å¼€å‘ä¸­åº”è¯¥ä½¿ç”¨ nonatomic æ›¿ä»£ atomic. ï¼ˆ7ï¼‰å¦‚ä½•è®©è‡ªå®šä¹‰ç±»å¯ä»¥ç”¨ copy ä¿®é¥°ç¬¦?å¦‚ä½•é‡å†™å¸¦ copy å…³é”®å­—çš„ setter? è‹¥æƒ³ä»¤è‡ªå·±æ‰€å†™çš„å¯¹è±¡å…·æœ‰æ‹·è´åŠŸèƒ½,åˆ™éœ€å®ç° NSCopying åè®®ã€‚ 1234567&#x2F;&#x2F; å®ç°ä¸å¯å˜ç‰ˆæœ¬æ‹·è´- (id)copyWithZone:(NSZone *)zone; &#x2F;&#x2F; å®ç°å¯å˜ç‰ˆæœ¬æ‹·è´- (id)mutableCopyWithZone:(NSZone *)zone;&#x2F;&#x2F; é‡å†™å¸¦ copy å…³é”®å­—çš„ setter- (void)setName:(NSString *)name &#123; _name &#x3D; [name copy];&#125; æ·±æ‹·è´å’Œæµ…æ‹·è´copy å’Œ mutableCopy copyæ‹·è´å‡ºæ¥çš„å¯¹è±¡ç±»å‹æ€»æ˜¯ä¸å¯å˜ç±»å‹(ä¾‹å¦‚, NSString, NSDictionary, NSArrayç­‰ç­‰) mutableCopyæ‹·è´å‡ºæ¥çš„å¯¹è±¡ç±»å‹æ€»æ˜¯å¯å˜ç±»å‹(ä¾‹å¦‚, NSMutableString, NSMutableDictionary, NSMutableArrayç­‰ç­‰) copy å¯¹äºå¯å˜å¯¹è±¡ä¸ºæ·±æ‹·è´ï¼Œå¯¹äºä¸å¯å˜å¯¹è±¡ä¸ºæµ…æ‹·è´ mutableCopy å§‹ç»ˆæ˜¯æ·±æ‹·è´","categories":[{"name":"Objective-C","slug":"Objective-C","permalink":"https://github.com/wuvdan/wuvdan.github.io/categories/Objective-C/"}],"tags":[{"name":"åº•å±‚åŸç†","slug":"åº•å±‚åŸç†","permalink":"https://github.com/wuvdan/wuvdan.github.io/tags/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/"}]},{"title":"iOSè‡ªå®šä¹‰æ§ä»¶-èº«ä»½è¯é”®ç›˜","slug":"iOSè‡ªå®šä¹‰æ§ä»¶-èº«ä»½è¯é”®ç›˜","date":"2020-01-16T09:10:36.000Z","updated":"2020-01-20T02:18:26.986Z","comments":true,"path":"2020/01/16/iOSè‡ªå®šä¹‰æ§ä»¶-èº«ä»½è¯é”®ç›˜/","link":"","permalink":"https://github.com/wuvdan/wuvdan.github.io/2020/01/16/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-%E8%BA%AB%E4%BB%BD%E8%AF%81%E9%94%AE%E7%9B%98/","excerpt":"","text":"åˆ©ç”¨UIInputViewControllerè‡ªå®šä¹‰é”®ç›˜ï¼Œåˆæ¬¡å°è¯•ã€‚ å®ç°ä»£ç 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120fileprivate class WDCustomKeybordButton: UIButton &#123; &#x2F;&#x2F; æŒ‰é’®ç‚¹å‡»å›è°ƒ var didInputBlock: ((_ text: String) -&gt; Void)? override var isHighlighted: Bool &#123; didSet &#123; &#x2F;&#x2F; ç›‘å¬æ˜¯å¦æ˜¯é«˜äº®çŠ¶æ€ï¼Œå¹¶è®¾ç½®èƒŒæ™¯é¢œè‰² backgroundColor &#x3D; isHighlighted ? UIColor(red:0.66, green:0.69, blue:0.73, alpha:1.00) : .white &#125; &#125; override init(frame: CGRect) &#123; super.init(frame: frame) backgroundColor &#x3D; .white layer.cornerRadius &#x3D; 5 setTitleColor(.black, for: .normal) addTarget(self, action: #selector(buttonTargetAction(sender:)), for: .touchUpInside) &#125; @objc func buttonTargetAction(sender: UIButton) &#123; let text &#x3D; (sender.titleLabel?.text) ?? &quot;&quot; if didInputBlock !&#x3D; nil &#123; didInputBlock!(text) &#125; &#x2F;&#x2F; æ·»åŠ éœ‡åŠ¨åé¦ˆ UIImpactFeedbackGenerator().impactOccurred() &#125; required init?(coder: NSCoder) &#123; fatalError(&quot;init(coder:) has not been implemented&quot;) &#125;&#125;@objc protocol WDCustomKeybordDelegate: NSObjectProtocol &#123; func keybord(keybord: WDCustomKeybord, isDelete: Bool, text: String) -&gt; Void&#125;class WDCustomKeybord: UIInputViewController &#123; &#x2F;&#x2F;&#x2F; é”®ç›˜ç‚¹å‡»Blockå›è°ƒï¼ŒisDeleteï¼š æ˜¯å¦æ˜¯åˆ é™¤æŒ‰é’® public var didInputBlock: ((_ isDelete: Bool, _ text: String) -&gt; Void)? &#x2F;&#x2F;&#x2F; ä»£ç†å›è°ƒ public weak var delegate: WDCustomKeybordDelegate? &#x2F;&#x2F;&#x2F; æŒ‰é’®çš„å®½åº¦ private let buttonWidth: CGFloat &#x3D; (UIScreen.main.bounds.width - 4.0 * 5.0) &#x2F; 3.0 &#x2F;&#x2F;&#x2F; æŒ‰é’®é«˜åº¦ private let buttonHeight: CGFloat &#x3D; 40.0 &#x2F;&#x2F;&#x2F; é—´éš™ private let margin: CGFloat &#x3D; 5.0 &#x2F;&#x2F;&#x2F; æŒ‰é’®æ•°ç»„ private let numArray &#x3D; [&quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, &quot;6&quot;, &quot;7&quot;, &quot;8&quot;, &quot;9&quot;, &quot;X&quot;, &quot;0&quot;, &quot;&quot;] &#x2F;&#x2F;&#x2F; åˆ˜æµ·å±é€‚é… private var isiPhoneX: Bool &#123; var iPhoneX &#x3D; false if UIDevice.current.userInterfaceIdiom !&#x3D; .phone &#123; return iPhoneX &#125; if #available(iOS 11.0, *) &#123; let mainWindow &#x3D; UIApplication.shared.keyWindow if (mainWindow?.safeAreaInsets.bottom)! &gt; CGFloat(0.0) &#123; iPhoneX &#x3D; true &#125; &#125; return iPhoneX &#125; override func viewDidLoad() &#123; let height &#x3D; buttonHeight * 4.0 + margin * 5.0 if isiPhoneX &#123; view.frame &#x3D; CGRect(x: 0, y: 0, width: UIScreen.main.bounds.width, height: height + 34) &#125; else &#123; view.frame &#x3D; CGRect(x: 0, y: 0, width: UIScreen.main.bounds.width, height: height) &#125; setupSubviews() &#125; &#x2F;&#x2F;&#x2F; forå¾ªç¯æ·»åŠ æŒ‰é’® private func setupSubviews() &#123; for (i, text) in numArray.enumerated() &#123; let button &#x3D; WDCustomKeybordButton() button.setTitle(text, for: .normal) button.tag &#x3D; 1000 + I if i &lt; 3 &#123; button.frame &#x3D; CGRect(x: margin + (margin + buttonWidth) * CGFloat(i), y: margin, width: buttonWidth, height: buttonHeight) &#125; else if i &lt; 6 &#123; button.frame &#x3D; CGRect(x: margin + (margin + buttonWidth) * CGFloat(i - 3), y: margin * 2 + buttonHeight, width: buttonWidth, height: buttonHeight) &#125; else if i &lt; 9 &#123; button.frame &#x3D; CGRect(x: margin + (margin + buttonWidth) * CGFloat(i - 6), y: margin * 3 + buttonHeight * 2, width: buttonWidth, height: buttonHeight) &#125; else &#123; button.frame &#x3D; CGRect(x: margin + (margin + buttonWidth) * CGFloat(i - 9), y: margin * 4 + buttonHeight * 3, width: buttonWidth, height: buttonHeight) &#125; if i &#x3D;&#x3D; 11 &#123; button.imageView?.contentMode &#x3D; .scaleAspectFit &#x2F;&#x2F; åˆ é™¤æŒ‰é’®&lt;è‡ªå®šä¹‰å›¾ç‰‡&gt; button.setImage(UIImage(named: &quot;delete&quot;), for: .normal) &#125; button.didInputBlock &#x3D; &#123; if self.didInputBlock !&#x3D; nil &#123; if $0.count &#x3D;&#x3D; 0 &#123; self.didInputBlock!(true, $0) &#125; else &#123; self.didInputBlock!(false, $0) &#125; &#125; if (self.delegate?.responds(to: #selector(WDCustomKeybordDelegate.keybord(keybord:isDelete:text:))))! &#123; if $0.count &#x3D;&#x3D; 0 &#123; self.delegate?.keybord(keybord: self, isDelete:true , text: $0) &#125; else &#123; self.delegate?.keybord(keybord: self, isDelete:false , text: $0) &#125; &#125; &#125; view.addSubview(button) &#125; &#125;&#125; ä½¿ç”¨æ–¹æ³•ï¼ˆä¸€ï¼‰1234567891011121314151617let inputController &#x3D; WDCustomKeybord()inputController.didInputBlock &#x3D; &#123; if $0 &#123; &#x2F;&#x2F; åˆ é™¤ var varText &#x3D; &quot;&quot; if let tText &#x3D; self.textField.text &#123; for (i, text) in tText.enumerated() &#123; if i &lt; tText.count - 1 &#123; varText.append(text) &#125; &#125; self.textField.text &#x3D; varText &#125; &#125; else &#123;&#x2F;&#x2F; è¾“å…¥ self.textField.text?.append($1) &#125;&#125;textField.inputView &#x3D; inputController.inputView ä½¿ç”¨æ–¹æ³•ï¼ˆäºŒï¼‰12345678910111213141516171819202122 let inputController &#x3D; WDCustomKeybord() inputController.delegate &#x3D; self textField.inputView &#x3D; inputController.inputView&#x2F;&#x2F; MARK: WDCustomKeybord Delegate Methodextension ViewController: WDCustomKeybordDelegate &#123; func keybord(keybord: WDCustomKeybord, isDelete: Bool, text: String) &#123; if isDelete &#123; &#x2F;&#x2F; åˆ é™¤ var varText &#x3D; &quot;&quot; if let tText &#x3D; textField.text &#123; for (i, text) in tText.enumerated() &#123; if i &lt; tText.count - 1 &#123; varText.append(text) &#125; &#125; textField.text &#x3D; varText &#125; &#125; else &#123; &#x2F;&#x2F; è¾“å…¥ textField.text?.append(text) &#125; &#125;&#125; æ•ˆæœå›¾","categories":[{"name":"Swift","slug":"Swift","permalink":"https://github.com/wuvdan/wuvdan.github.io/categories/Swift/"}],"tags":[{"name":"è‡ªå®šä¹‰æ§ä»¶","slug":"è‡ªå®šä¹‰æ§ä»¶","permalink":"https://github.com/wuvdan/wuvdan.github.io/tags/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6/"}]},{"title":"iOSè‡ªå®šä¹‰æ§ä»¶-æœç´¢å†å²æ ‡ç­¾","slug":"iOSè‡ªå®šä¹‰æ§ä»¶-æœç´¢å†å²æ ‡ç­¾","date":"2020-01-16T09:10:36.000Z","updated":"2020-01-20T02:17:04.567Z","comments":true,"path":"2020/01/16/iOSè‡ªå®šä¹‰æ§ä»¶-æœç´¢å†å²æ ‡ç­¾/","link":"","permalink":"https://github.com/wuvdan/wuvdan.github.io/2020/01/16/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-%E6%90%9C%E7%B4%A2%E5%8E%86%E5%8F%B2%E6%A0%87%E7%AD%BE/","excerpt":"","text":"123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114import UIKit@objc protocol WDTagsViewDelegate: NSObjectProtocol &#123; &#x2F;&#x2F;&#x2F; å•ä¸ªæ ‡ç­¾ç‚¹å‡»å›è°ƒ func tagsView(view: WDTagsView, didTappedAtIndex index: Int, didTappedAtText text: String) -&gt; Void&#125;class WDTagsView: UIView &#123; &#x2F;&#x2F; MARK: Public public weak var delegate: WDTagsViewDelegate? public var tagHeight: CGFloat &#x3D; 32 &#x2F;&#x2F; æ ‡ç­¾é«˜åº¦ï¼Œé»˜è®¤ä¸º32 public var viewHMargin: CGFloat &#x3D; 10 &#x2F;&#x2F; æ•´ä½“å·¦å³é—´è· é»˜è®¤ä¸º10 public var viewVMargin: CGFloat &#x3D; 10 &#x2F;&#x2F; æ•´ä½“ä¸Šä¸‹é—´è· é»˜è®¤ä¸º10 public var tagInnerSpace: CGFloat &#x3D; 10 &#x2F;&#x2F; æ ‡ç­¾å†…éƒ¨å·¦å³é—´è· é»˜è®¤ä¸º10 public var tagHMargin: CGFloat &#x3D; 10 &#x2F;&#x2F; æ ‡ç­¾ä¹‹é—´çš„æ°´å¹³é—´è· é»˜è®¤ä¸º10 public var tagVMargin: CGFloat &#x3D; 5 &#x2F;&#x2F; æ ‡ç­¾ä¹‹é—´çš„è¡Œé—´è· é»˜è®¤ä¸º5 public var tagFont: UIFont &#x3D; .systemFont(ofSize: 14) &#x2F;&#x2F; æ ‡ç­¾å­—ä½“ é»˜è®¤ä¸º5 public var tagTextColor: UIColor &#x3D; .black &#x2F;&#x2F; æ ‡ç­¾å­—ä½“é¢œè‰² public var tagBackgroundColor: UIColor &#x3D; UIColor(red: 0.95, green: 0.95, blue: 0.95, alpha: 1) &#x2F;&#x2F; æ ‡ç­¾èƒŒæ™¯é¢œè‰² public var itemArray: Array&lt;String&gt; &#x3D; Array() &#123; didSet &#123; setupViews() &#125; &#125; &#x2F;&#x2F; MARK: Private private var tagsArray: Array&lt;UIButton&gt; &#x3D; Array() override init(frame: CGRect) &#123; super.init(frame: frame) &#125; func refreshView() &#123; DispatchQueue.main.async &#123; self.setupViews() &#125; &#125; private func setupViews() &#123; for v in self.subviews &#123; v.removeFromSuperview() &#125; tagsArray.removeAll() for (index, item) in itemArray.enumerated() &#123; let b &#x3D; UIButton() b.setTitle(item, for: .normal) b.setTitleColor(tagTextColor, for: .normal) b.titleLabel?.font &#x3D; tagFont b.backgroundColor &#x3D; tagBackgroundColor b.layer.cornerRadius &#x3D; 10 b.tag &#x3D; index b.addTarget(self, action: #selector(buttonTargetAction(sender:)), for: .touchUpInside) addSubview(b) tagsArray.append(b) &#125; layoutItems() &#125; private func layoutItems() &#123; var tagLineWidth &#x3D; viewHMargin &#x2F;&#x2F; å•è¡Œçš„æ€»å®½åº¦ let allWidth &#x3D; UIScreen.main.bounds.width &#x2F;&#x2F; é»˜è®¤ä¸ºå±å¹•å®½åº¦ var isChange: Bool &#x3D; false &#x2F;&#x2F; æ˜¯å¦éœ€è¦æ¢è¡Œ var lastItem: UIButton! for index in 0..&lt;tagsArray.count &#123; let button &#x3D; tagsArray[index] let tagTitle: NSString &#x3D; itemArray[index] as NSString var tagWidth &#x3D; tagTitle.boundingRect(with: CGSize(width: CGFloat(MAXFLOAT), height: tagHeight), options: .usesLineFragmentOrigin, attributes: [.font : tagFont], context: nil).size.width + 2 * tagInnerSpace + 0.5 tagLineWidth +&#x3D; (tagWidth + tagHMargin) if tagLineWidth &gt; (allWidth - viewHMargin) &#123; isChange &#x3D; true if (tagWidth + 2 * tagHMargin) &gt; allWidth &#123; tagWidth &#x3D; allWidth - 2 * tagHMargin button.titleEdgeInsets &#x3D; UIEdgeInsets(top: 0, left: tagInnerSpace &#x2F; 2, bottom: 0, right: tagInnerSpace &#x2F; 2) &#125; tagLineWidth &#x3D; viewHMargin + tagWidth + tagHMargin &#125; button.snp.makeConstraints &#123; (make) in make.height.equalTo(tagHeight) make.width.equalTo(tagWidth) if lastItem &#x3D;&#x3D; nil &#123; make.top.equalTo(viewVMargin) make.leading.equalTo(viewHMargin) &#125; else &#123; if isChange &#123; make.leading.equalTo(viewVMargin) make.top.equalTo(lastItem.snp.bottom).offset(tagVMargin) isChange &#x3D; false &#125; else &#123; make.leading.equalTo(lastItem.snp.trailing).offset(tagHMargin) make.top.equalTo(lastItem.snp.top) &#125; &#125; &#125; lastItem &#x3D; button &#125; lastItem.snp.makeConstraints &#123; (make) in make.bottom.equalTo(-viewVMargin).priority(.high) &#125; &#125; required init?(coder: NSCoder) &#123; fatalError(&quot;init(coder:) has not been implemented&quot;) &#125; @objc private func buttonTargetAction(sender: UIButton) &#123; delegate?.tagsView(view: self, didTappedAtIndex: sender.tag, didTappedAtText: itemArray[sender.tag]) &#125;&#125; 1234567891011121314151617181920var tagsView: WDTagsView!&#x2F;**é¡µé¢æ·»åŠ ï¼Œç®€å•æ ·å¼é…ç½®**&#x2F;tagsView &#x3D; WDTagsView()tagsView.delegate &#x3D; selftagsView.tagTextColor &#x3D; .blacktagsView.tagFont &#x3D; .systemFont(ofSize: 14)tagsView.backgroundColor &#x3D; UIColor(red: 0.9, green: 0.9, blue: 0.9, alpha: 1)tagsView.tagHeight &#x3D; 30tagsView.itemArray &#x3D; [&quot;æ‰‹æœº&quot;, &quot;ç”µè„‘&quot;, &quot;æ˜¾å¡&quot;, &quot;ä¸»æœº&quot;, &quot;å•¥å•¥&quot;, &quot;æˆ‘æ“¦&quot;, &quot;æˆ‘æ˜¯å“¦å‘ç”Ÿçš„æ´»åŠ¨å¼€å§‹å¯¹æ–¹æ“¦&quot;, &quot;æˆ‘å±®è‰¸èŠ”èŒ»&quot;,&quot;æ‰‹æœº&quot;, &quot;ç”µè„‘&quot;, &quot;æ˜¾å¡&quot;, &quot;ä¸»æœº&quot;, &quot;å•¥å•¥&quot;, &quot;æˆ‘æ“¦&quot;, &quot;æˆ‘å±®è‰¸èŠ”èŒ»&quot;,&quot;æ‰‹æœº&quot;, &quot;ç”µè„‘&quot;, &quot;æ˜¾å¡&quot;, &quot;ä¸»æœº&quot;, &quot;å•¥å•¥&quot;, &quot;æˆ‘æ“¦&quot;, &quot;æˆ‘å±®è‰¸èŠ”èŒ»&quot;, &quot;å•¥å•¥&quot;, &quot;æˆ‘æ“¦&quot;, &quot;æˆ‘å±®è‰¸èŠ”èŒ»&quot;]view.addSubview(tagsView)&#x2F;**é¡µé¢å¸ƒå±€**&#x2F;tagsView.snp.makeConstraints &#123; (make) in make.leading.top.trailing.equalToSuperview()&#125;&#x2F;**åˆ·æ–°å®å›¾**&#x2F;tagsView.itemArray &#x3D; [&quot;æ‰‹æœº&quot;, &quot;ç”µè„‘&quot;, &quot;æ˜¾å¡&quot;, &quot;ä¸»æœº&quot;]tagsView.refreshView()","categories":[{"name":"Swift","slug":"Swift","permalink":"https://github.com/wuvdan/wuvdan.github.io/categories/Swift/"}],"tags":[{"name":"è‡ªå®šä¹‰æ§ä»¶","slug":"è‡ªå®šä¹‰æ§ä»¶","permalink":"https://github.com/wuvdan/wuvdan.github.io/tags/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6/"}]},{"title":"iOSè‡ªå®šä¹‰æ§ä»¶-ä»¿äº¬ä¸œåœ°å€é€‰æ‹©å™¨","slug":"iOSè‡ªå®šä¹‰æ§ä»¶-ä»¿äº¬ä¸œåœ°å€é€‰æ‹©å™¨","date":"2020-01-16T09:10:36.000Z","updated":"2020-01-20T02:22:13.956Z","comments":true,"path":"2020/01/16/iOSè‡ªå®šä¹‰æ§ä»¶-ä»¿äº¬ä¸œåœ°å€é€‰æ‹©å™¨/","link":"","permalink":"https://github.com/wuvdan/wuvdan.github.io/2020/01/16/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-%E4%BB%BF%E4%BA%AC%E4%B8%9C%E5%9C%B0%E5%9D%80%E9%80%89%E6%8B%A9%E5%99%A8/","excerpt":"","text":"å†™è¿™ä¸ªçš„ä¸»è¦æ˜¯ä¸ºäº†ç»ƒä¹ Swiftçš„ä½¿ç”¨ã€‚ Plistæ–‡ä»¶å†…å®¹ä¸‹è½½åœ°å€ æ–‡ä»¶è¯»å–1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768fileprivate class WDAddressPickerDataManger: NSObject &#123; static let manager &#x3D; WDAddressPickerDataManger() &#x2F;&#x2F; è¯»å–listæ–‡ä»¶ func readPlistFile() -&gt; Dictionary&lt;String, Any&gt; &#123; let path &#x3D; Bundle.main.path(forResource: &quot;list.plist&quot;, ofType: nil) ?? &quot;&quot; let dict &#x3D; NSDictionary(contentsOfFile: path) if dict !&#x3D; nil &#123; return dict as! Dictionary&lt;String, Any&gt; &#125; return [:] &#125; &#x2F;&#x2F; è¯»å–æ‰€æœ‰çœä»½ func getProvinceNameArray() -&gt; Array&lt;String&gt; &#123; var array: [String] &#x3D; Array() for item in readPlistFile().keys &#123; array.append(item) &#125; return array &#125; &#x2F;&#x2F; è¯»å–æ™®é€šçœä»½ä¸­çš„åŸå¸‚ func getNormalCityNameArray(with provinceName: String) -&gt; Array&lt;String&gt; &#123; var array: [String] &#x3D; Array() for item in readPlistFile() &#123; if item.key.contains(provinceName) &#123; let name &#x3D; (item.value as! Dictionary&lt;String, Any&gt;).keys for cityName in name &#123; array.append(cityName) &#125; &#125; &#125; return array &#125; &#x2F;&#x2F; è¯»å–ç›´è¾–å¸‚ï¼Œç‰¹åŒºä¸­çš„åŒº func getSpecailCityNameArray(with provinceName: String) -&gt; Array&lt;String&gt; &#123; var array: [String] &#x3D; Array() for item in readPlistFile() &#123; if item.key.contains(provinceName) &#123; let name &#x3D; item.value as! Array&lt;String&gt; for cityName in name &#123; array.append(cityName) &#125; &#125; &#125; return array &#125; &#x2F;&#x2F; è¯»å–æ™®é€šåŸå¸‚ä¸­çš„åŒº func getRegionNameArray(with provinceName: String, cityName: String) -&gt; Array&lt;String&gt; &#123; var array: [String] &#x3D; Array() for item in readPlistFile() &#123; if item.key.contains(provinceName) &#123; let provinceDic &#x3D; item.value as! Dictionary&lt;String, Array&lt;String&gt;&gt; for city in provinceDic.keys &#123; if city.contains(cityName) &#123; for last in provinceDic[city]! &#123; array.append(last) &#125; &#125; &#125; &#125; &#125; return array &#125;&#125; HeaderViewæç¤ºæ–‡å­—ï¼Œä¸é¡µé¢æ¶ˆå¤±æŒ‰é’® 12345678910111213141516171819202122232425262728293031323334353637fileprivate class WDAddressPickerHeaderView: UIView &#123; var textLabel: UILabel! var clearButton: UIButton! override init(frame: CGRect) &#123; super.init(frame: frame) setupSubviews() &#125; required init?(coder: NSCoder) &#123; fatalError(&quot;init(coder:) has not been implemented&quot;) &#125; func setupSubviews() &#123; backgroundColor &#x3D; .white layer.cornerRadius &#x3D; 10 textLabel &#x3D; UILabel() textLabel.text &#x3D; &quot;åœ°å€é€‰æ‹©&quot; textLabel.textColor &#x3D; .black textLabel.font &#x3D; .systemFont(ofSize: 20, weight: .bold) addSubview(textLabel) &#x2F;&#x2F; è‡ªå®šä¹‰æŒ‰é’®å›¾ç‰‡ clearButton &#x3D; UIButton(type: .custom) clearButton.setImage(UIImage(named: &quot;clear&quot;), for: .normal) addSubview(clearButton) &#125; override func layoutSubviews() &#123; super.layoutSubviews() textLabel.frame &#x3D; CGRect(x: 15, y: 0, width: bounds.width &#x2F; 2.0, height: bounds.height) let cycleWidth &#x3D; (bounds.height - 10.0) &#x2F; 2 clearButton.frame &#x3D; CGRect(x: bounds.width - 15 - cycleWidth, y: (bounds.height - 10.0 - cycleWidth) &#x2F; 2.0, width: cycleWidth, height: cycleWidth) &#125;&#125; TopViewé¡µé¢æ ‡é¢˜æ˜¾ç¤ºä¸åˆ‡æ¢ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091fileprivate class WDAddressPickerTopView: UIView &#123; &#x2F;&#x2F; ç‚¹å‡»å›è°ƒ var didSelectedIndexBlock: ((_ index: Int) -&gt; Void) &#x3D; &#123;(_) in&#125; &#x2F;&#x2F; æ ‡é¢˜åº•éƒ¨æŒ‡ç¤ºå™¨ var indicatorView: UIView! &#x2F;&#x2F; æ ‡é¢˜ä¹‹é—´çš„é—´è· let margin: CGFloat &#x3D; 15 &#x2F;&#x2F; åº•éƒ¨æŒ‡ç¤ºå™¨çš„å¸ƒå±€ï¼Œç”¨æ¥è¿›è¡Œå¸ƒå±€ä¿®æ”¹ä¸åŠ¨ç”»å¤„ç† var indicatorViewConstraints: [NSLayoutConstraint]! override init(frame: CGRect) &#123; super.init(frame: frame) setupSubviews() &#125; required init?(coder: NSCoder) &#123; fatalError(&quot;init(coder:) has not been implemented&quot;) &#125; func setupSubviews() &#123; backgroundColor &#x3D; .white indicatorView &#x3D; UIView() indicatorView.backgroundColor &#x3D; .red addSubview(indicatorView) &#125; &#x2F;&#x2F; forå¾ªç¯æ˜¾ç¤ºæ ‡é¢˜ func setup(with items: [String], selectIndex: Int) &#123; var lastButton &#x3D; UIButton() var newItems &#x3D; items if items.isEmpty &#123; newItems.append(&quot;è¯·é€‰æ‹©&quot;) &#125; for view in subviews &#123; if view.isKind(of: UIButton.self) &#123; view.removeFromSuperview() &#125; &#125; for (i, title) in newItems.enumerated() &#123; let button &#x3D; UIButton(type: .custom) button.setTitle(title, for: .normal) button.titleLabel?.font &#x3D; .systemFont(ofSize: 15, weight: .bold) button.setTitleColor(.black, for: .normal) button.addTarget(self, action: #selector(buttonTargetAction(sender:)), for: .touchUpInside) button.tag &#x3D; 1000 + I addSubview(button) button.translatesAutoresizingMaskIntoConstraints &#x3D; false if i &#x3D;&#x3D; 0 &#123; addConstraint(NSLayoutConstraint(item: button, attribute: .leading, relatedBy: .equal, toItem: self, attribute: .leading, multiplier: 1, constant: margin)) &#125; else &#123; addConstraint(NSLayoutConstraint(item: button, attribute: .leading, relatedBy: .equal, toItem: lastButton, attribute: .trailing, multiplier: 1, constant: margin)) &#125; addConstraints([ NSLayoutConstraint(item: button, attribute: .centerY, relatedBy: .equal, toItem: self, attribute: .centerY, multiplier: 1, constant: 0) ]) lastButton &#x3D; button if i &#x3D;&#x3D; selectIndex &#123; indicatorView.translatesAutoresizingMaskIntoConstraints &#x3D; false indicatorViewConstraints &#x3D; [ NSLayoutConstraint(item: indicatorView, attribute: .leading, relatedBy: .equal, toItem: button, attribute: .leading, multiplier: 1, constant: 0), NSLayoutConstraint(item: indicatorView, attribute: .trailing, relatedBy: .equal, toItem: button, attribute: .trailing, multiplier: 1, constant: 0), NSLayoutConstraint(item: indicatorView, attribute: .bottom, relatedBy: .equal, toItem: self, attribute: .bottom, multiplier: 1, constant: -3), NSLayoutConstraint(item: indicatorView, attribute: .height, relatedBy: .equal, toItem: nil, attribute: .height, multiplier: 1, constant: 5), ] addConstraints(indicatorViewConstraints) &#125; &#125; &#125; @objc func buttonTargetAction(sender: UIButton) &#123; &#x2F;&#x2F; ç§»é™¤å…ˆå‰æ·»åŠ çš„å¸ƒå±€ removeConstraints(indicatorViewConstraints) indicatorViewConstraints &#x3D; [ NSLayoutConstraint(item: indicatorView, attribute: .leading, relatedBy: .equal, toItem: sender, attribute: .leading, multiplier: 1, constant: 0), NSLayoutConstraint(item: indicatorView, attribute: .trailing, relatedBy: .equal, toItem: sender, attribute: .trailing, multiplier: 1, constant: 0), NSLayoutConstraint(item: indicatorView, attribute: .bottom, relatedBy: .equal, toItem: self, attribute: .bottom, multiplier: 1, constant: -3), NSLayoutConstraint(item: indicatorView, attribute: .height, relatedBy: .equal, toItem: nil, attribute: .height, multiplier: 1, constant: 5), ] &#x2F;&#x2F; æ·»åŠ ç‚¹å‡»å˜åŒ–åçš„å¸ƒå±€ addConstraints(indicatorViewConstraints) setNeedsUpdateConstraints() UIView.animate(withDuration: 0.3) &#123; self.layoutIfNeeded() &#125; didSelectedIndexBlock(sender.tag - 1000) &#125;&#125; åˆ—è¡¨å•å…ƒæ ¼123456789101112131415161718192021222324252627282930313233343536373839404142fileprivate class WDAddressPickerTableViewCell: UITableViewCell &#123; var titleLabel: UILabel! var checkedImageView: UIImageView! override init(style: UITableViewCell.CellStyle, reuseIdentifier: String?) &#123; super.init(style: style, reuseIdentifier: reuseIdentifier) setupSubviews() &#125; required init?(coder: NSCoder) &#123; fatalError(&quot;init(coder:) has not been implemented&quot;) &#125; func setupSubviews() &#123; titleLabel &#x3D; UILabel() titleLabel.font &#x3D; .systemFont(ofSize: 15) titleLabel.textColor &#x3D; .black contentView.addSubview(titleLabel) &#x2F;&#x2F; è‡ªå®šä¹‰æ˜¾ç¤ºå›¾ç‰‡ checkedImageView &#x3D; UIImageView() checkedImageView.image &#x3D; UIImage(named: &quot;duihao&quot;) contentView.addSubview(checkedImageView) &#125; private var _cellChecked: Bool &#x3D; false var cellChecked: Bool &#123; set &#123; _cellChecked &#x3D; newValue if !newValue &#123; checkedImageView.frame &#x3D; CGRect(x: 15, y: 15, width: 0, height: 0) titleLabel.frame &#x3D; CGRect(x: 15, y: 0, width: UIScreen.main.bounds.width - 30, height: 45) &#125; else &#123; checkedImageView.frame &#x3D; CGRect(x: 15, y: 15, width: 15, height: 15) titleLabel.frame &#x3D; CGRect(x: checkedImageView.frame.maxX + 15, y: 0, width: UIScreen.main.bounds.width - checkedImageView.frame.maxX - 15 - 15 , height: 45) &#125; &#125; get &#123; return _cellChecked &#125; &#125;&#125; BottomViewåº•éƒ¨åˆ—è¡¨è§†å›¾è½½ä½“ï¼Œä½¿ç”¨UIScrollViewåµŒå¥—UITableViewæ¥å®ç° 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156fileprivate class WDAddressPickerBottomView: UIView &#123; &#x2F;&#x2F; Action var didSelectedBlock: ((_ page: Int, _ index: Int, _ name: String) -&gt; Void) &#x3D; &#123;(_,_,_) in &#125; &#x2F;&#x2F; UI var scrollView: UIScrollView! var provinceTableView: UITableView! var cityTableView: UITableView! var regionTableView: UITableView! &#x2F;&#x2F; Data var proVinceSelectedIndexRow &#x3D; -1 var citySelectedIndexRow &#x3D; -1 var regionSelectedIndexRow &#x3D; -1 var selectedIndexRow &#x3D; -1 var regionNameArray: [String] &#x3D; Array() var cityNameArray: [String] &#x3D; Array() var cityName: String &#x3D; &quot;&quot; &#123; didSet &#123; regionSelectedIndexRow &#x3D; -1 regionNameArray &#x3D; WDAddressPickerDataManger.manager.getRegionNameArray(with: provinceName, cityName: cityName) regionTableView.reloadData() &#125; &#125; let provinceNameArray: [String] &#x3D; WDAddressPickerDataManger.manager.getProvinceNameArray() var provinceName: String &#x3D; &quot;&quot; &#123; didSet &#123; if provinceName.contains(&quot;åŒ—äº¬&quot;) || provinceName.contains(&quot;ä¸Šæµ·&quot;) || provinceName.contains(&quot;å¤©æ´¥&quot;) || provinceName.contains(&quot;é¦™æ¸¯&quot;) || provinceName.contains(&quot;æ¾³é—¨&quot;) || provinceName.contains(&quot;é‡åº†&quot;) &#123; cityNameArray &#x3D; WDAddressPickerDataManger.manager.getSpecailCityNameArray(with: provinceName) &#125; else &#123; cityNameArray &#x3D; WDAddressPickerDataManger.manager.getNormalCityNameArray(with: provinceName) &#125; citySelectedIndexRow &#x3D; -1 regionSelectedIndexRow &#x3D; -1 cityTableView.reloadData() &#125; &#125; override init(frame: CGRect) &#123; super.init(frame: frame) backgroundColor &#x3D; .white setupSubviews() &#125; required init?(coder: NSCoder) &#123; fatalError(&quot;init(coder:) has not been implemented&quot;) &#125; override func layoutSubviews() &#123; super.layoutSubviews() scrollView.frame &#x3D; bounds provinceTableView.frame &#x3D; scrollView.bounds cityTableView.frame &#x3D; CGRect(x: scrollView.bounds.width, y: 0, width: scrollView.bounds.width, height: scrollView.bounds.height) regionTableView.frame &#x3D; CGRect(x: scrollView.bounds.width * 2.0, y: 0, width: scrollView.bounds.width, height: scrollView.bounds.height) &#125;&#125;&#x2F;&#x2F; MARK: Views Set Upprivate extension WDAddressPickerBottomView &#123; func setupSubviews() &#123; scrollView &#x3D; UIScrollView() scrollView.isScrollEnabled &#x3D; false scrollView.isPagingEnabled &#x3D; true scrollView.showsHorizontalScrollIndicator &#x3D; false scrollView.bounces &#x3D; false addSubview(scrollView) provinceTableView &#x3D; UITableView(frame: .zero, style: .plain) provinceTableView.delegate &#x3D; self provinceTableView.dataSource &#x3D; self provinceTableView.rowHeight &#x3D; 45 provinceTableView.register(WDAddressPickerTableViewCell.self, forCellReuseIdentifier: &quot;WDAddressPickerTableViewCell&quot;) scrollView.addSubview(provinceTableView) cityTableView &#x3D; UITableView(frame: .zero, style: .plain) cityTableView.delegate &#x3D; self cityTableView.dataSource &#x3D; self cityTableView.rowHeight &#x3D; 45 cityTableView.register(WDAddressPickerTableViewCell.self, forCellReuseIdentifier: &quot;WDAddressPickerTableViewCell&quot;) scrollView.addSubview(cityTableView) regionTableView &#x3D; UITableView(frame: .zero, style: .plain) regionTableView.delegate &#x3D; self regionTableView.dataSource &#x3D; self regionTableView.rowHeight &#x3D; 45 regionTableView.register(WDAddressPickerTableViewCell.self, forCellReuseIdentifier: &quot;WDAddressPickerTableViewCell&quot;) scrollView.addSubview(regionTableView) scrollView.contentSize &#x3D; CGSize(width: UIScreen.main.bounds.width, height: 0) &#125;&#125;&#x2F;&#x2F; MARK: UITableView DataSource Methodsextension WDAddressPickerBottomView: UITableViewDataSource &#123; func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int) -&gt; Int &#123; if tableView &#x3D;&#x3D; provinceTableView &#123; return provinceNameArray.count &#125; else if tableView &#x3D;&#x3D; cityTableView &#123; return cityNameArray.count &#125; else &#123; return regionNameArray.count &#125; &#125; func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -&gt; UITableViewCell &#123; let cell &#x3D; tableView.dequeueReusableCell(withIdentifier: &quot;WDAddressPickerTableViewCell&quot;, for: indexPath) as! WDAddressPickerTableViewCell if tableView &#x3D;&#x3D; provinceTableView &#123; cell.titleLabel.text &#x3D; (provinceNameArray[indexPath.row] as NSString).substring(from: 6) if indexPath.row &#x3D;&#x3D; proVinceSelectedIndexRow &#123; cell.cellChecked &#x3D; true &#125; else &#123; cell.cellChecked &#x3D; false &#125; &#125; else if tableView &#x3D;&#x3D; cityTableView &#123; cell.titleLabel.text &#x3D; (cityNameArray[indexPath.row] as NSString).substring(from: 6) if indexPath.row &#x3D;&#x3D; citySelectedIndexRow &#123; cell.cellChecked &#x3D; true &#125; else &#123; cell.cellChecked &#x3D; false &#125; &#125; else &#123; cell.titleLabel.text &#x3D; (regionNameArray[indexPath.row] as NSString).substring(from: 6) if indexPath.row &#x3D;&#x3D; regionSelectedIndexRow &#123; cell.cellChecked &#x3D; true &#125; else &#123; cell.cellChecked &#x3D; false &#125; &#125; return cell &#125;&#125;&#x2F;&#x2F; MARK: UITableView Delegate Methodextension WDAddressPickerBottomView: UITableViewDelegate &#123; func tableView(_ tableView: UITableView, didSelectRowAt indexPath: IndexPath) &#123; tableView.deselectRow(at: indexPath, animated: true) let cell &#x3D; tableView.cellForRow(at: indexPath) as! WDAddressPickerTableViewCell if tableView &#x3D;&#x3D; provinceTableView &#123; proVinceSelectedIndexRow &#x3D; indexPath.row scrollView.contentSize &#x3D; CGSize(width: UIScreen.main.bounds.width * 2, height: 0) scrollView.setContentOffset(CGPoint(x: UIScreen.main.bounds.width, y: 0), animated: true) &#125; else if tableView &#x3D;&#x3D; cityTableView &#123; citySelectedIndexRow &#x3D; indexPath.row scrollView.contentSize &#x3D; CGSize(width: UIScreen.main.bounds.width * 3, height: 0) scrollView.setContentOffset(CGPoint(x: UIScreen.main.bounds.width * 2, y: 0), animated: true) &#125; else &#123; regionSelectedIndexRow &#x3D; indexPath.row &#125; tableView.reloadData() selectedIndexRow &#x3D; indexPath.row didSelectedBlock(Int(scrollView.contentOffset.x &#x2F; UIScreen.main.bounds.width), indexPath.row, cell.titleLabel.text ?? &quot;&quot;) &#125;&#125; AddressPickerViewä»¥ä¸Šçš„æ˜¾ç¤ºçš„è§†å›¾çš„è½½ä½“è§†å›¾ 123456789101112131415161718192021222324252627282930313233343536373839fileprivate class WDAddressPickerView: UIView &#123; var headerView: WDAddressPickerHeaderView! var topView: WDAddressPickerTopView! var bottomView: WDAddressPickerBottomView! override init(frame: CGRect) &#123; super.init(frame: frame) setupSubviews() setupSubviewsConstraint() &#125; required init?(coder: NSCoder) &#123; fatalError(&quot;init(coder:) has not been implemented&quot;) &#125;&#125;&#x2F;&#x2F; MARK: é¡µé¢å¸ƒå±€@objc private extension WDAddressPickerView &#123; &#x2F;&#x2F; é¡µé¢æ§ä»¶åˆå§‹åŒ– func setupSubviews() &#123; headerView &#x3D; WDAddressPickerHeaderView() addSubview(headerView) topView &#x3D; WDAddressPickerTopView() topView.setup(with: [], selectIndex: 0) addSubview(topView) bottomView &#x3D; WDAddressPickerBottomView() addSubview(bottomView) &#125; &#x2F;&#x2F; é¡µé¢æ§ä»¶å¸ƒå±€ func setupSubviewsConstraint() &#123; headerView.frame &#x3D; CGRect(x: 0, y: 0, width: UIScreen.main.bounds.width, height: 50) topView.frame &#x3D; CGRect(x: 0, y: headerView.frame.maxY - 10, width: UIScreen.main.bounds.width, height: 45) bottomView.frame &#x3D; CGRect(x: 0, y: topView.frame.maxY, width: UIScreen.main.bounds.width, height: UIScreen.main.bounds.height - 100 - topView.frame.maxY) &#125;&#125; åœ°å€é€‰å–ç®¡ç†å™¨123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384class WDAddressPickerManager: NSObject &#123; static let manager &#x3D; WDAddressPickerManager() private var backView: UIView! private var addressPickerView: WDAddressPickerView! &#x2F;&#x2F;&#x2F; æ˜¾ç¤ºé€‰æ‹©å™¨ &#x2F;&#x2F;&#x2F; - Parameter completeBlock: provinceï¼š çœï¼ˆç›´è¾–å¸‚ï¼‰ï¼Œ cityï¼šå¸‚ï¼ˆç›´è¾–å¸‚ä¸­çš„åŒºï¼‰ï¼Œregionï¼š åŒº func showPicker(completeBlock: @escaping ((_ province: String, _ city: String, _ region: String) -&gt; Void)) &#123; backView &#x3D; UIView() backView.backgroundColor &#x3D; UIColor(white: 0, alpha: 0) backView.frame &#x3D; UIScreen.main.bounds backView.addGestureRecognizer(UITapGestureRecognizer(target: self, action: #selector(tapGuestureTargetAction(sender:)))) UIApplication.shared.keyWindow?.addSubview(backView) var titleItems: [String] &#x3D; Array() var provinceName &#x3D; &quot;&quot; var cityName &#x3D; &quot;&quot; var reginName &#x3D; &quot;&quot; addressPickerView &#x3D; WDAddressPickerView() addressPickerView.frame &#x3D; CGRect(x: 0, y: UIScreen.main.bounds.height, width: UIScreen.main.bounds.width, height: UIScreen.main.bounds.height - 100) addressPickerView.headerView.clearButton.addTarget(self, action: #selector(tapGuestureTargetAction(sender:)), for: .touchUpInside) addressPickerView.bottomView.didSelectedBlock &#x3D; &#123; [weak self] (page, index, name) in if page &#x3D;&#x3D; 0 &#123; provinceName &#x3D; name cityName &#x3D; &quot;&quot; reginName &#x3D; &quot;&quot; titleItems &#x3D; [name, &quot;è¯·é€‰æ‹©&quot;] self?.addressPickerView.bottomView.provinceName &#x3D; name self?.addressPickerView.topView.setup(with: titleItems, selectIndex: page + 1) &#125; else if page &#x3D;&#x3D; 1 &#123; cityName &#x3D; name reginName &#x3D; &quot;&quot; if provinceName.contains(&quot;åŒ—äº¬&quot;) || provinceName.contains(&quot;ä¸Šæµ·&quot;) || provinceName.contains(&quot;å¤©æ´¥&quot;) || provinceName.contains(&quot;é¦™æ¸¯&quot;) || provinceName.contains(&quot;æ¾³é—¨&quot;) || provinceName.contains(&quot;é‡åº†&quot;) &#123; self?.hidenView() completeBlock(provinceName, cityName, reginName) return &#125; titleItems &#x3D; [(provinceName), (cityName), &quot;è¯·é€‰æ‹©&quot;] self?.addressPickerView.bottomView.cityName &#x3D; name self?.addressPickerView.topView.setup(with: titleItems, selectIndex: page + 1) &#125; else &#123; reginName &#x3D; name titleItems &#x3D; [provinceName, cityName, reginName] self?.addressPickerView.topView.setup(with: titleItems, selectIndex: page) &#125; if page &#x3D;&#x3D; 2 &#123; self?.hidenView() completeBlock(provinceName, cityName, reginName) &#125; &#125; addressPickerView.topView.didSelectedIndexBlock &#x3D; &#123; [weak self] index in self?.addressPickerView.bottomView.scrollView.setContentOffset(CGPoint(x: UIScreen.main.bounds.width * CGFloat(index), y: 0), animated: true) &#125; UIApplication.shared.keyWindow?.addSubview(addressPickerView) UIView.animate(withDuration: 0.5) &#123; self.backView.backgroundColor &#x3D; UIColor(white: 0, alpha: 0.3) self.addressPickerView.frame &#x3D; CGRect(x: 0, y: 100, width: UIScreen.main.bounds.width, height: UIScreen.main.bounds.height - 100) &#125; &#125; @objc private func tapGuestureTargetAction(sender: Any) &#123; hidenView() &#125; private func hidenView() &#123; UIView.animate(withDuration: 0.5, animations: &#123; self.backView.backgroundColor &#x3D; UIColor(white: 0, alpha: 0) self.addressPickerView.frame &#x3D; CGRect(x: 0, y: UIScreen.main.bounds.height, width: UIScreen.main.bounds.width, height: UIScreen.main.bounds.height - 100) &#125;) &#123; (finished) in self.backView.removeFromSuperview() self.addressPickerView.removeFromSuperview() &#125; &#125;&#125; æ•ˆæœå›¾","categories":[{"name":"Swift","slug":"Swift","permalink":"https://github.com/wuvdan/wuvdan.github.io/categories/Swift/"}],"tags":[{"name":"è‡ªå®šä¹‰æ§ä»¶","slug":"è‡ªå®šä¹‰æ§ä»¶","permalink":"https://github.com/wuvdan/wuvdan.github.io/tags/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6/"}]},{"title":"iOSå•å…ƒæµ‹è¯•","slug":"iOSå•å…ƒæµ‹è¯•","date":"2020-01-16T08:07:20.651Z","updated":"2020-01-20T02:27:31.333Z","comments":true,"path":"2020/01/16/iOSå•å…ƒæµ‹è¯•/","link":"","permalink":"https://github.com/wuvdan/wuvdan.github.io/2020/01/16/iOS%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/","excerpt":"","text":"å•å…ƒæµ‹è¯•ä»¥æµ‹è¯•ViewControllerä¸ºä¾‹ã€‚ ViewController.hæ–‡ä»¶1234567891011#import &lt;UIKit&#x2F;UIKit.h&gt;@interface ViewController : UIViewController&#x2F;** é€»è¾‘æµ‹è¯• *&#x2F;- (int)getSumWithNum1:(int)a num2:(int)b;&#x2F;** å¼‚æ­¥æµ‹è¯• *&#x2F;- (void)loadDataComplete:(void(^)(id info))complete;&#x2F;** æ€§èƒ½æµ‹è¯• *&#x2F;- (void)openCamera;@end ViewController.mæ–‡ä»¶1234567891011121314151617181920212223- (int)getSumWithNum1:(int)a num2:(int)b &#123; return a + b;&#125;- (void)loadDataComplete:(void (^)(id))complete &#123; dispatch_async(dispatch_get_global_queue(0, 0), ^&#123; sleep(2); NSString *data &#x3D; @&quot;ğŸ˜&quot;; dispatch_async(dispatch_get_main_queue(), ^&#123; complete(data); &#125;); &#125;);&#125;- (void)openCamera &#123; for(int i &#x3D; 0; i &lt; 1000; ++i) &#123; NSLog(@&quot;è¿™æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²%d&quot;, i); &#125;&#125;- (void)viewDidLoad &#123; [super viewDidLoad];&#125; ä¸ºäº†è¿›è¡Œå•å…ƒåŒ–æµ‹è¯•ï¼Œæ‰€ä»¥æ–°å»ºä¸€ä¸ªViewControllerTestæ–‡ä»¶ã€‚æ­¥éª¤ å¯¼å…¥æµ‹è¯•å¤´æ–‡ä»¶#import &quot;ViewController.h&quot; å£°æ˜å±æ€§@property (nonatomic, strong) ViewController *vc; åœ¨- (void)setUp;è¿›è¡Œåˆå§‹åŒ–ä»£ç 123- (void)setUp &#123; self.vc &#x3D; [[ViewController alloc] init];&#125; 1ã€é€»è¾‘æµ‹è¯• ç»™å‡ºæµ‹è¯•æ•°æ® è¿›è¡Œæµ‹è¯• ä½¿ç”¨æ–­è¨€è¿›è¡Œåˆ¤å®š 123456789- (void)testSum &#123; &#x2F;&#x2F; 1. given int a &#x3D; 10; int b &#x3D; 22; &#x2F;&#x2F; 2. when int sum &#x3D; [self.vc getSumWithNum1:a num2:b]; &#x2F;&#x2F; 3. then XCTAssertEqual(sum, 32, @&quot;é”™è¯¯&quot;);&#125; 2ã€å¼‚æ­¥æµ‹è¯• åˆ›å»ºXCTestExpectationï¼Œè®¾ç½®é”™è¯¯æç¤º è°ƒç”¨æ–¹æ³•ï¼Œåœ¨å¼‚æ­¥ä¸­è°ƒç”¨fulfill è¿›è¡Œåˆ¤æ–­æ—¶é—´ï¼Œæ˜¯å¦åœ¨é¢„æœŸæ—¶é—´å†…å®¹ 12345678XCTestExpectation *exp &#x3D; [self expectationWithDescription:@&quot;è¶…è¿‡é¢„æœŸæ—¶é—´&quot;];[self.vc loadDataComplete:^(id info) &#123; XCTAssertNil(info, @&quot;æ•°æ®ä¸ºç©º&quot;); [exp fulfill];&#125;];[self waitForExpectationsWithTimeout:4 handler:^(NSError * _Nullable error) &#123; NSLog(@&quot;%@&quot;, error);&#125;]; 3ã€æ€§èƒ½æµ‹è¯• è®¾ç½®Baselineæ—¶é—´ Max STDDEV æœ€å¤§æ ·æœ¬æ ‡å‡†åå·®æ¯”ä¾‹ 12345- (void)testPerformanceExample &#123; [self measureBlock:^&#123; [self.vc openCamera]; &#125;];&#125; UIæµ‹è¯• 1ã€å½•åˆ¶è„šæœ¬2ã€ç¼–è¾‘è„šæœ¬3ã€è‡ªåŠ¨åŒ–æµ‹è¯• è·å–ä»£ç è¦†ç›–ç‡1ã€ç‚¹å‡»Edit Secheme 2ã€é€‰æ‹©Test-&gt;Options-&gt;Code Coverageå‹¾èµ· 3ã€è¿è¡Œä»£ç æŸ¥çœ‹ç»“æœ","categories":[{"name":"Objective-C","slug":"Objective-C","permalink":"https://github.com/wuvdan/wuvdan.github.io/categories/Objective-C/"}],"tags":[{"name":"å¼€å‘æŠ€å·§","slug":"å¼€å‘æŠ€å·§","permalink":"https://github.com/wuvdan/wuvdan.github.io/tags/%E5%BC%80%E5%8F%91%E6%8A%80%E5%B7%A7/"}]},{"title":"å¼€å‘æŠ€å·§","slug":"å¼€å‘æŠ€å·§","date":"2020-01-16T08:07:12.406Z","updated":"2020-01-20T01:55:22.920Z","comments":true,"path":"2020/01/16/å¼€å‘æŠ€å·§/","link":"","permalink":"https://github.com/wuvdan/wuvdan.github.io/2020/01/16/%E5%BC%80%E5%8F%91%E6%8A%80%E5%B7%A7/","excerpt":"","text":"1ã€PrefixHeaderå¯¼å…¥ä½ç½®å†™æ³• 1$(SRCROOT)&#x2F;$(PROJECT_NAME)&#x2F;&lt;#æ–‡ä»¶æ‰€åœ¨æ–‡ä»¶å¤¹åç§°#&gt;&#x2F;PrefixHeader.pch 2ã€éšè—å¯¼èˆªæ çš„ä¸¤ç§æ–¹å¼ 1234567891011121314151617181920212223242526272829&#x2F;&#x2F;æ–¹å¼ä¸€ ã€Šæ¨èã€‹&#x2F;&#x2F;åœ¨éœ€è¦éšè—çš„viewControllerä¸­éµå¾ª&lt;UINavigationControllerDelegate&gt;- (void)viewDidLoad &#123; [super viewDidLoad]; &#x2F;&#x2F; è®¾ç½®å¯¼èˆªæ§åˆ¶å™¨çš„ä»£ç†ä¸ºself self.navigationController.delegate &#x3D; self;&#125;#pragma mark - UINavigationControllerDelegate&#x2F;&#x2F; å°†è¦æ˜¾ç¤ºæ§åˆ¶å™¨- (void)navigationController:(UINavigationController *)navigationController willShowViewController:(UIViewController *)viewController animated:(BOOL)animated &#123; &#x2F;&#x2F; åˆ¤æ–­è¦æ˜¾ç¤ºçš„æ§åˆ¶å™¨æ˜¯å¦æ˜¯è‡ªå·± BOOL isShowHomePage &#x3D; [viewController isKindOfClass:[self class]]; [self.navigationController setNavigationBarHidden:isShowHomePage animated:YES];&#125;&#x2F;&#x2F;æ–¹å¼äºŒ- (void)viewWillAppear:(BOOL)animated &#123; [super viewWillAppear:animated]; [self.navigationController setNavigationBarHidden:YES animated:YES];&#125;- (void)viewWillDisappear:(BOOL)animated &#123; [super viewWillDisappear:animated]; [self.navigationController setNavigationBarHidden:NO animated:YES];&#125; 3ã€TabBarItemè¦æ±‚åªæ˜¾ç¤ºå›¾ç‰‡ä¸æ˜¾ç¤ºæ–‡å­— 12&#x2F;&#x2F; self è¡¨ç¤ºéœ€è¦è®¾ç½®æ ·å¼çš„æ§åˆ¶å™¨[self.tabBarItem setImageInsets:UIEdgeInsetsMake(6, 0, -6, 0)]; 4ã€TableViewæˆ–CollectionViewå•é€‰ 1234567891011&lt;!--æ­¥éª¤ä¸€ã€ å£°æ˜ä¸€ä¸ªå…¨å±€å˜é‡--&gt;@property (nonatomic, assign) NSInteger selectedIndex;&lt;!--æ­¥éª¤äºŒã€TableViewæˆ–CollectionViewç‚¹å‡»äº‹ä»¶çš„æ–¹æ³•ä¸­ä¿å­˜ç‚¹å‡»çš„indexï¼Œå¹¶åˆ·æ–°--&gt;self.selectedIndex &#x3D; indexPath.row;[collectionView reloadData];æˆ–[tableView reloadData];&lt;!--æ­¥éª¤ä¸‰ã€åœ¨cellForItemAtIndexPathæˆ–cellForRowAtIndexPathæ–¹æ³•ä¸­åˆ¤æ–­æ˜¯å¦æ˜¯æ‰€ä¿å­˜çš„index--&gt;if (self.selectedIndex &#x3D;&#x3D; indexPath.row) &#123; &#x2F;&#x2F; è®¾ç½®é€‰ä¸­æ ·å¼&#125; else &#123; &#x2F;&#x2F; è®¾ç½®æˆé»˜è®¤æ ·å¼ &#125; 5ã€æ€ä¹ˆåŒºåˆ†çœŸæœºè¿˜æ˜¯æ¨¡æ‹Ÿå™¨ 1234567#if TARGET_IPHONE_SIMULATOR NSLog(@&quot;run on simulator&quot;); #define SIMULATOR_TEST#else &#x2F;&#x2F;ä¸å®šä¹‰SIMULATOR_TESTè¿™ä¸ªå® NSLog(@&quot;run on device&quot;); #endif 6ã€if Debug 12345#ifdef DEBUG &#x2F;&#x2F; do sth#else &#x2F;&#x2F; do sth#endif 7ã€ä¸€é”®æ¸…ç†æ‰€æœ‰æ¨¡æ‹Ÿå™¨å®‰è£…è¿‡çš„APP 12&#x2F;&#x2F; å…ˆå…³é—­æ‰€æœ‰æ¨¡æ‹Ÿå™¨ åœ¨ç»ˆç«¯ä¸­è¾“å…¥ä¸‹é¢å‘½ä»¤å³å¯xcrun simctl erase all 8ã€SDWebImageæ¸…ç†ç¼“å­˜ 1234- (void)didReceiveMemoryWarning &#123; [super didReceiveMemoryWarning]; [[[SDWebImageManager sharedManager] imageCache] clearMemory];&#125; 9ã€UITableViewçš„HeaderViewä¸‹æ‹‰æ”¾å¤§ 123456789101112131ã€View1:ä½œä¸ºæ˜¾ç¤ºView2ã€View2:ä½œä¸ºtableViewçš„tableHeaderViewï¼Œå¹¶æ·»åŠ View1ï¼ŒView2çš„å¤§å°å’ŒView1å¤§å°ç›¸åŒ.3ã€åœ¨UIScrollViewDelegateæ–¹æ³•ä¸­è¿›è¡Œè®¾è®¡- (void)scrollViewDidScroll:(UIScrollView *)scrollView &#123; CGFloat width &#x3D; UIScreen.mainScreen.bounds.size.width; CGFloat viewHeight &#x3D; kScreenWidth * 0.5; &#x2F;&#x2F; View1çš„åˆå§‹é«˜åº¦ CGFloat yOffset &#x3D; scrollView.contentOffset.y; if (yOffset &lt; 0) &#123; CGFloat totalOffset &#x3D; viewHeight + ABS(yOffset); CGFloat f &#x3D; totalOffset &#x2F; viewHeight; self.headerView.frame &#x3D; CGRectMake(- (width * f - width) &#x2F; 2, yOffset, width * f, totalOffset); &#125;&#125; 10ã€Masonryåˆ¶ä½œå°±å®«æ ¼ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647&#x2F;&#x2F;Objective-C ----&gt; Masonry&#x2F;** å¤šè§†å›¾å¸ƒå±€ @param viewArray è§†å›¾æ•°ç»„ @param column åˆ—æ•° @param tbSpeace è§†å›¾ä¸Šä¸‹é—´è· @param lrSpeace è§†å›¾å·¦å³é—´è· @param topSpeace å’Œçˆ¶è§†å›¾ä¸Šé—´è· @param lrSuperViewSpeace çˆ¶è§†å›¾å·¦å³é—´è· @param superView çˆ¶è§†å›¾ @param viewHeight è§†å›¾é«˜åº¦ *&#x2F;- (void)wd_masLayoutSubViewsWithViewArray:(NSArray&lt;UIView *&gt; *)viewArray columnOfRow:(NSInteger)column topBottomOfItemSpeace:(CGFloat)tbSpeace leftRightItemSpeace:(CGFloat)lrSpeace topOfSuperViewSpeace:(CGFloat)topSpeace leftRightSuperViewSpeace:(CGFloat)lrSuperViewSpeace addToSubperView:(UIView *)superView viewHeight:(CGFloat)viewHeight&#123; CGFloat viewWidth &#x3D; superView.bounds.size.width; CGFloat itemWidth &#x3D; (viewWidth - lrSuperViewSpeace * 2 - (column - 1) * lrSpeace) &#x2F; column * 1.0f; CGFloat itemHeight &#x3D; viewHeight; UIView *last &#x3D; nil; for (int i &#x3D; 0; i &lt; viewArray.count; i++) &#123; UIView *item &#x3D; viewArray[i]; [superView addSubview:item]; [item mas_makeConstraints:^(MASConstraintMaker *make) &#123; make.width.mas_equalTo(itemWidth); make.height.mas_equalTo(itemHeight); CGFloat top &#x3D; topSpeace + (i &#x2F; column) * (itemHeight + tbSpeace); make.top.mas_offset(top); if (!last || (i % column) &#x3D;&#x3D; 0) &#123; make.left.mas_offset(lrSuperViewSpeace); &#125;else&#123; make.left.mas_equalTo(last.mas_right).mas_offset(lrSpeace); &#125; &#125;]; last &#x3D; item; &#125;&#125; 11ã€Snapkitåˆ¶ä½œä¹å®«æ ¼ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253&#x2F;&#x2F;Swift ----&gt; SnapKit &#x2F;&#x2F;&#x2F; å¤šè§†å›¾å¸ƒå±€ &#x2F;&#x2F;&#x2F; &#x2F;&#x2F;&#x2F; - Parameters: &#x2F;&#x2F;&#x2F; - viewArray: è§†å›¾æ•°ç»„ &#x2F;&#x2F;&#x2F; - columnOfRow: åˆ—æ•° &#x2F;&#x2F;&#x2F; - topBottomOfItemSpeace: è§†å›¾ä¸Šä¸‹é—´è· &#x2F;&#x2F;&#x2F; - leftRightItemSpeace: è§†å›¾å·¦å³é—´è· &#x2F;&#x2F;&#x2F; - topOfSuperViewSpeace: å’Œçˆ¶è§†å›¾ä¸Šé—´è· &#x2F;&#x2F;&#x2F; - leftRightSuperViewSpeace: çˆ¶è§†å›¾å·¦å³é—´è· &#x2F;&#x2F;&#x2F; - addToSubperView: çˆ¶è§†å›¾ &#x2F;&#x2F;&#x2F; - viewHeight: è§†å›¾é«˜åº¦ func wd_masLayoutSubViews(viewArray:Array&lt;UIView&gt;, columnOfRow:Int, topBottomOfItemSpeace:CGFloat, leftRightItemSpeace:CGFloat, topOfSuperViewSpeace:CGFloat, leftRightSuperViewSpeace:CGFloat, addToSubperView:UIView, viewHeight:CGFloat) -&gt; Void &#123; let viewWidth &#x3D; addToSubperView.bounds.width let tempW &#x3D; leftRightSuperViewSpeace * 2 + CGFloat(columnOfRow - 1) * leftRightItemSpeace let itemWidth &#x3D; (viewWidth - tempW) &#x2F; CGFloat(columnOfRow) let itemHeight &#x3D; viewHeight print(leftRightSuperViewSpeace,leftRightItemSpeace,itemWidth) var lastView:UIView? for (index) in viewArray.enumerated() &#123; let item &#x3D; viewArray[i] addToSubperView.addSubview(item) item.snp.makeConstraints &#123; (make) in make.width.equalTo(itemWidth) make.height.equalTo(itemHeight) let top &#x3D; topOfSuperViewSpeace + CGFloat(i &#x2F; columnOfRow) * (itemHeight + topBottomOfItemSpeace) make.top.equalTo(top) if !(lastView !&#x3D; nil) || i%columnOfRow &#x3D;&#x3D; 0 &#123; make.left.equalTo(leftRightSuperViewSpeace) &#125; else &#123; make.left.equalTo((lastView?.snp.right)!).offset(leftRightItemSpeace) &#125; lastView &#x3D; item &#125; &#125; &#125; 12ã€æ²‰æµ¸å¼TableView(ScrollViewã€CollectionView) 12345if (@available(iOS 11.0, *)) &#123; self.tableView.contentInsetAdjustmentBehavior &#x3D; UIScrollViewContentInsetAdjustmentNever;&#125; else &#123; self.automaticallyAdjustsScrollViewInsets &#x3D; false;&#125; 13ã€é€šè¿‡èº«ä»½è¯è®¡ç®—å¹´é¾„ 1234567891011121314151617181920212223242526272829303132333435363738&#x2F;** é€šè¿‡èº«ä»½è¯è®¡ç®—å¹´é¾„ *&#x2F;- (NSString *)calculationAgeWithBirthday: (NSString *)birthday &#123; NSCalendar *calendar &#x3D; [NSCalendar currentCalendar]; NSDate *nowDate &#x3D; [NSDate date]; NSString *birth &#x3D; birthday; NSDateFormatter *dateFormatter &#x3D; [[NSDateFormatter alloc]init]; [dateFormatter setDateFormat:@&quot;yyyy-MM-dd&quot;]; NSDate *birthDay &#x3D; [dateFormatter dateFromString:birth]; unsigned int unitFlags &#x3D; NSCalendarUnitYear | NSCalendarUnitMonth | NSCalendarUnitDay; NSDateComponents *date &#x3D; [calendar components:unitFlags fromDate:birthDay toDate:nowDate options:0]; if ([date year] &gt; 0) &#123; return [NSString stringWithFormat:@&quot;%ldå²&quot;, (long)[date year]]; &#125; else if([date month] &gt; 0) &#123; return [NSString stringWithFormat:@&quot;%ldæœˆ&quot;, (long)[date month]]; &#125; else if([date day] &gt; 0)&#123; return [NSString stringWithFormat:@&quot;%ldå¤©&quot;, (long)[date day]]; &#125; else &#123; return @&quot;0å¤©&quot;; &#125;&#125;- (NSString *)ageStrFromIdentityCard:(NSString *)numberStr &#123; NSString *dateSt; NSMutableString *dateS; if (numberStr.length &gt; 15) &#123; dateSt &#x3D; [numberStr substringWithRange:NSMakeRange(6, 8)]; dateS &#x3D; [NSMutableString stringWithFormat:@&quot;%@&quot;, dateSt]; [dateS insertString:@&quot;-&quot; atIndex:4]; [dateS insertString:@&quot;-&quot; atIndex:7]; &#125; else &#123; &#x2F;&#x2F; åªè€ƒè™‘ 19å¼€å¤´çš„15ä½çš„èº«ä»½è¯å· dateSt &#x3D; [NSString stringWithFormat:@&quot;19%@&quot;,[numberStr substringWithRange:NSMakeRange(6, 6)]]; dateS &#x3D; [NSMutableString stringWithFormat:@&quot;%@&quot;, dateSt]; [dateS insertString:@&quot;-&quot; atIndex:4]; [dateS insertString:@&quot;-&quot; atIndex:7]; &#125; return [self calculationAgeWithBirthday:dateS];&#125;","categories":[{"name":"iOSå¼€å‘æŠ€å·§","slug":"iOSå¼€å‘æŠ€å·§","permalink":"https://github.com/wuvdan/wuvdan.github.io/categories/iOS%E5%BC%80%E5%8F%91%E6%8A%80%E5%B7%A7/"}],"tags":[{"name":"å¼€å‘æŠ€å·§","slug":"å¼€å‘æŠ€å·§","permalink":"https://github.com/wuvdan/wuvdan.github.io/tags/%E5%BC%80%E5%8F%91%E6%8A%80%E5%B7%A7/"}]},{"title":"ä»£ç å—(Snippet)","slug":"ä»£ç å—(Snippet)","date":"2020-01-16T08:06:56.902Z","updated":"2020-01-20T02:30:16.351Z","comments":true,"path":"2020/01/16/ä»£ç å—(Snippet)/","link":"","permalink":"https://github.com/wuvdan/wuvdan.github.io/2020/01/16/%E4%BB%A3%E7%A0%81%E5%9D%97(Snippet)/","excerpt":"","text":"ä»£ç å—(Snippet)ï¼Œæ–¹ä¾¿äº†ä»£ç å¿«é€Ÿåˆ›å»ºã€‚ ç®¡ç†ï¼šåœ¨æ–°ç‰ˆXcodeä¸­ç®¡ç†é¡µé¢åœ¨ç¼–è¯‘å™¨çš„å³ä¸Šè§’ æ·»åŠ ï¼šé€‰ä¸­ä»£ç é¼ æ ‡å³å‡» ç¼–è¾‘ Titleï¼šæ ‡é¢˜ã€‚ Summaryï¼šæè¿°æ–‡å­—ã€‚ Platformï¼šå¯ä»¥ä½¿ç”¨çš„å¹³å°ï¼ˆå¦‚iOSã€Mac OSï¼‰ã€‚ Languageï¼šå¯ä»¥åœ¨å“ªäº›è¯­è¨€ä¸­ä½¿ç”¨ï¼ˆå¦‚ Objective-Cã€Swiftï¼‰ã€‚ Completion Shortcutï¼šå¿«æ·æ–¹å¼ï¼Œä»¥å­—æ¯å¼€å¤´ï¼ˆæ”¯æŒå°‘æ•°ç¬¦å·ï¼Œå¦‚@ï¼‰ã€‚ Completion Scopesï¼šä½œç”¨èŒƒå›´ï¼Œä¸€èˆ¬å†™åœ¨æ­£ç¡®çš„ä½ç½®æ‹–åŠ¨å³å¯ï¼ŒXcodeä¼šè‡ªè¡Œé€‰æ‹©å¥½ã€‚ å±æ€§12345@property (nonatomic, strong) &lt;#ClassName#&gt; *&lt;#class#&gt;; &#x2F;&#x2F;&#x2F;&lt; &lt;#æ³¨é‡Š#&gt;@property (nonatomic, assign) &lt;#DataType#&gt; &lt;#name#&gt;; &#x2F;&#x2F;&#x2F;&lt; &lt;#æ³¨é‡Š#&gt;@property (nonatomic, copy) &lt;#ClassName#&gt; *&lt;#name#&gt;; &#x2F;&#x2F;&#x2F;&lt; &lt;#æ³¨é‡Š#&gt;@property (nonatomic, weak) id&lt;&lt;#delegateOrDataSouce#&gt;&gt; &lt;#delegateOrDataSouce#&gt;; &#x2F;&#x2F;&#x2F;&lt; &lt;#æ³¨é‡Š#&gt;@property (nonatomic, weak) &lt;#Class#&gt; *&lt;#name#&gt;; &#x2F;&#x2F;&#x2F;&lt; &lt;#æ³¨é‡Š#&gt; å¸¸ç”¨æ³¨é‡Š é¡¶éƒ¨æ³¨é‡Š 1&#x2F;** &lt;#å±æ€§æ³¨é‡Š#&gt; *&#x2F; å³ä¾§æ³¨é‡Š 1&#x2F;&#x2F;&#x2F;&lt; &lt;#æ³¨é‡Š#&gt; ç®€è¿°é¡¶éƒ¨æ³¨é‡Š 123&#x2F;** &lt;#ç®€è¦æè¿°#&gt; * &lt;#è¯¦ç»†æè¿°#&gt; *&#x2F; Pragma æœ‰åˆ†å‰²çº¿1#pragma mark &lt;#mark#&gt; æ— åˆ†å‰²çº¿1#pragma mark - &lt;#mark&gt; æˆ– &#x2F;&#x2F; MARK: &lt;#mark#&gt; Warning(è­¦å‘Š) 1#warning &lt;#message#&gt; ???(ä¸ç¡®å®š) 1&#x2F;&#x2F; ???: &lt;#???#&gt; !!!(è­¦å‘Š) 1&#x2F;&#x2F; !!!: &lt;#???#&gt; FIXME(éœ€è¦ä¿®æ”¹çš„åœ°æ–¹) 1&#x2F;&#x2F; FIXME: &lt;#Fixè¯¦æƒ…#&gt; å¸¸ç”¨æ–¹æ³• 123456789#pragma mark - é¡µé¢æ§ä»¶é…ç½®- (void)setupSubViewsProperties &#123; &#125;#pragma mark - é¡µé¢æ§ä»¶å¸ƒå±€- (void)setupSubViewsConstraint &#123; &#125; æšä¸¾ 1234567typedef NS_ENUM(NSInteger, &lt;#TypeName#&gt;) &#123; &#125;;typedef NS_OPTIONS(NSUInteger, &lt;#TypeName#&gt;) &#123; &#125;; IFDEBUG 12345#if DEBUG&lt;#TODO#&gt;#else&lt;#TODO#&gt;#endif å¿«æ·åˆå§‹åŒ–UILabel 123456UILabel *l &#x3D; [[UILabel alloc] init];l.font &#x3D; [UIFont &lt;#font#&gt;];l.text &#x3D; @&quot;&lt;#conent#&gt;&quot;;l.textColor &#x3D; [UIColor &lt;#textColor#&gt;];l.numberOfLines &#x3D; 0;[&lt;#view#&gt; addSubview:l]; å¿«æ·åˆå§‹åŒ–UIButton 12345678UIButton *b &#x3D; [UIButton buttonWithType:UIButtonTypeCustom];b.backgroundColor &#x3D; [UIColor &lt;#backgroundColor#&gt;];b.titleLabel.font &#x3D; [UIFont &lt;#font#&gt;];[b setTitle:&lt;#title#&gt; forState:UIControlStateNormal];[b setTitleColor:[UIColor &lt;#titleColor#&gt;] forState:UIControlStateNormal];[b setImage:[UIImage imageNamed:&lt;#(nonnull NSString *)#&gt;] forState:UIControlStateNormal][b addTarget:self action:@selector(didTapped&lt;#Button Name#&gt;:) forControlEvents:UIControlEventTouchUpInside];[&lt;#view#&gt; addSubview:b]; UIButton ç‚¹å‡»äº‹ä»¶ 1234&#x2F;** &lt;#ButtonName#&gt;ç‚¹å‡»äº‹ä»¶ *&#x2F;- (void)didTapped&lt;#ButtonName#&gt;:(UIButton *)sender &#123; &#125; Notificationäº‹ä»¶ 1234&#x2F;** &lt;#Notification Name#&gt;é€šçŸ¥äº‹ä»¶ *&#x2F;- (void)didReceive&lt;#Notification Name#&gt;:(NSNotification *)notification &#123; &#125; UIGestureRecognizerè§¦æ‘¸äº‹ä»¶ 1234&#x2F;** &lt;#GestureRecognizer Name#&gt;è§¦æ‘¸äº‹ä»¶ *&#x2F;- (void)didRecognized&lt;#GestureRecognizer Name#&gt;:(UIGestureRecognizer *)recognizer &#123; &#125; ç»“æŸè¯­è¿™ä¹Ÿæ˜¯ä¸ºäº†ä¸ªäººæ„è§ï¼Œå…¶ä»–è¿˜æœ‰å¾ˆå¤šå¯ä»¥åšæˆä»£ç å—çš„ï¼Œä¾‹å¦‚CGDï¼ŒTableViewDataSourceç­‰ç­‰ï¼Œå¸Œæœ›çŸ­çŸ­çš„æ–‡ç« å¯ä»¥è®©ä½ ä»£ç å¯ä»¥å†™çš„æ›´å¥½ã€‚","categories":[{"name":"iOSå¼€å‘æŠ€å·§","slug":"iOSå¼€å‘æŠ€å·§","permalink":"https://github.com/wuvdan/wuvdan.github.io/categories/iOS%E5%BC%80%E5%8F%91%E6%8A%80%E5%B7%A7/"}],"tags":[{"name":"å¼€å‘æŠ€å·§","slug":"å¼€å‘æŠ€å·§","permalink":"https://github.com/wuvdan/wuvdan.github.io/tags/%E5%BC%80%E5%8F%91%E6%8A%80%E5%B7%A7/"}]},{"title":"JavaScriptä¸åŸç”Ÿäº¤äº’","slug":"JavaScriptä¸åŸç”Ÿäº¤äº’","date":"2020-01-16T08:06:48.781Z","updated":"2020-01-20T02:06:38.242Z","comments":true,"path":"2020/01/16/JavaScriptä¸åŸç”Ÿäº¤äº’/","link":"","permalink":"https://github.com/wuvdan/wuvdan.github.io/2020/01/16/JavaScript%E4%B8%8E%E5%8E%9F%E7%94%9F%E4%BA%A4%E4%BA%92/","excerpt":"","text":"åŸç”Ÿé¡µé¢ä¸HTMLé¡µé¢è¿›è¡Œç›¸äº’è°ƒç”¨æ–¹å¼ | é€‚ç”¨å¯¹è±¡â€”|â€”æ‹¦æˆªURL | UIWebViewå’ŒWKWebViewJavaScriptCore | UIWebViewMessageHandler | WKWebViewWebViewJavascriptBridge| UIWebViewå’ŒWKWebView å®ä¾‹HTMLä»£ç 1234567891011121314151617181920212223242526272829303132333435&lt;body&gt; &lt;h2&gt;æŒ‰é’®ç‚¹å‡»&lt;&#x2F;h2&gt; &lt;button type&#x3D;&quot;submit&quot; onclick&#x3D;&quot;buttonEvent()&quot; id&#x3D;&quot;submitButto&quot;&gt;æäº¤&lt;&#x2F;button&gt; &lt;h2&gt;æ–‡ä»¶ä¸Šä¼ &lt;&#x2F;h2&gt; &lt;input type&#x3D;&quot;file&quot; &#x2F;&gt; &lt;h2&gt;åŸç”Ÿæ³¨å…¥æ•°æ®&lt;&#x2F;h2&gt; &lt;input type&#x3D;&quot;text&quot; id&#x3D;&quot;textField&quot;&gt; &lt;input type&#x3D;&quot;button&quot; onclick&#x3D;&quot;getTextEvent()&quot; value&#x3D;&quot;å¼€å§‹æ³¨å…¥&quot;&gt; &lt;script&gt; function loadURL(url) &#123; var iFrame; iFrame &#x3D; document.createElement(&quot;iframe&quot;); iFrame.setAttribute(&quot;src&quot;, url); iFrame.setAttribute(&quot;style&quot;, &quot;display:none;&quot;); iFrame.setAttribute(&quot;height&quot;, &quot;0px&quot;); iFrame.setAttribute(&quot;width&quot;, &quot;0px&quot;); iFrame.setAttribute(&quot;frameborder&quot;, &quot;0&quot;); document.body.appendChild(iFrame); iFrame.parentNode.removeChild(iFrame); iFrame &#x3D; null; &#125; function buttonEvent()&#123; loadURL(&quot;&#x2F;buttonEvent&quot;); buttonDidPapped(); &#125; function getTextEvent() &#123; loadURL(&quot;&#x2F;getText&quot;); getTextButtonDidPapped(); &#125; function getText(text)&#123; document.getElementById(&quot;textField&quot;).value &#x3D; text; &#125; &lt;&#x2F;script&gt;&lt;&#x2F;body&gt; æ‹¦æˆªURLUIWebViewéµå¾ªUIWebViewDelegateè°ƒç”¨- (BOOL)webView:(UIWebView *)webView shouldStartLoadWithRequest:(NSURLRequest *)request navigationType:(UIWebViewNavigationType)navigationTypeæ–¹æ³•ï¼Œåˆ¤æ–­è·å–çš„Urlåœ°å€ 123456789101112131415&#x2F;&#x2F; è°ƒç”¨JSif ([request.URL.absoluteString hasSuffix:@&quot;buttonEvent&quot;]) &#123; UIAlertController *vc &#x3D; [UIAlertControlleralertControllerWithTitle:@&quot;æ¸©é¦¨æç¤º&quot; message:@&quot;ç‚¹å‡»äº†æäº¤æŒ‰é’®&quot; preferredStyle:UIAlertControllerStyleAlert]; [vc addAction:[UIAlertAction actionWithTitle:@&quot;ç¡®å®š&quot; style:UIAlertActionStyleDefault handler:^(UIAlertAction * _Nonnull action) &#123; &#125;]]; [self presentViewController:vc animated:true completion:nil]; return NO;&#125; &#x2F;&#x2F; æ³¨å…¥æ•°æ®ç»™JSif ([request.URL.absoluteString hasSuffix:@&quot;getText&quot;]) &#123; [webView stringByEvaluatingJavaScriptFromString:@&quot;getText(&#39;å“ˆå“ˆ&#39;)&quot;]; return NO;&#125;return YES; WKWebViewéµå¾ªWKNavigationDelegateè°ƒç”¨- (void)webView:(WKWebView *)webView decidePolicyForNavigationAction:(WKNavigationAction *)navigationAction decisionHandler:(void (^)(WKNavigationActionPolicy))decisionHandleræ–¹æ³•åˆ¤æ–­è·å–çš„åœ°å€ 1234567891011121314151617NSString *strRequest &#x3D; [navigationAction.request.URL.absoluteString stringByRemovingPercentEncoding];&#x2F;&#x2F; è°ƒç”¨JSif ([strRequest hasSuffix:@&quot;buttonEvent&quot;]) &#123; UIAlertController *vc &#x3D; [UIAlertController alertControllerWithTitle:@&quot;æ¸©é¦¨æç¤º&quot; message:@&quot;ç‚¹å‡»äº†æäº¤æŒ‰é’®&quot; preferredStyle:UIAlertControllerStyleAlert]; [vc addAction:[UIAlertAction actionWithTitle:@&quot;ç¡®å®š&quot; style:UIAlertActionStyleDefault handler:^(UIAlertAction * _Nonnull action) &#123; &#125;]]; [self presentViewController:vc animated:true completion:nil]; decisionHandler(WKNavigationActionPolicyCancel);&#125; else if ([strRequest hasSuffix:@&quot;getText&quot;]) &#123; &#x2F;&#x2F; æ³¨å…¥æ•°æ®ç»™JS [webView evaluateJavaScript:@&quot;getText(&#39;å“ˆå“ˆ&#39;)&quot; completionHandler:^(id _Nullable info, NSError * _Nullable error) &#123; NSLog(@&quot;Error--%@, info--%@&quot;, error, info); &#125;]; decisionHandler(WKNavigationActionPolicyCancel);&#125; else &#123; decisionHandler(WKNavigationActionPolicyAllow);&#125; JavaScriptCore å¯¼å…¥&lt;JavaScriptCore/JavaScriptCore.h&gt; éµå¾ª&lt;UIWebViewDelegate&gt;å¹¶å®ç°- (void)webViewDidFinishLoad:(UIWebView *)webViewæ–¹æ³•ã€‚12345678910111213141516171819202122&#x2F;&#x2F; å¯¹JSContextå¯¹è±¡è¿›è¡Œåˆå§‹åŒ–JSContext *context &#x3D; [self.webView valueForKeyPath:@&quot;documentView.webView.mainFrame.javaScriptContext&quot;];&#x2F;&#x2F; éªŒè¯JSContextå¯¹è±¡æ˜¯å¦åˆå§‹åŒ–æˆåŠŸcontext.exceptionHandler &#x3D; ^(JSContext *context, JSValue *exceptionValue)&#123; context.exception &#x3D; exceptionValue;&#125;; &#x2F;&#x2F; è°ƒç”¨JS context[@&quot;buttonDidPapped&quot;] &#x3D; ^&#123; UIAlertController *vc &#x3D; [UIAlertController alertControllerWithTitle:@&quot;æ¸©é¦¨æç¤º&quot; message:@&quot;ç‚¹å‡»äº†æäº¤æŒ‰é’®&quot; preferredStyle:UIAlertControllerStyleAlert]; [vc addAction:[UIAlertAction actionWithTitle:@&quot;ç¡®å®š&quot; style:UIAlertActionStyleDefault handler:^(UIAlertAction * _Nonnull action) &#123; &#125;]]; [self presentViewController:vc animated:true completion:nil];&#125;; &#x2F;&#x2F; æ³¨å…¥æ•°æ®ç»™JS context[@&quot;getTextButtonDidPapped&quot;] &#x3D; ^&#123; dispatch_async(dispatch_get_main_queue(), ^&#123; [self.webView stringByEvaluatingJavaScriptFromString:@&quot;getText(&#39;å“ˆå“ˆ&#39;)&quot;]; &#125;);&#125;; MessageHandler ä¿®æ”¹jsä¸­çš„æ–¹æ³•ï¼Œ é€šè¿‡window.webkit.messageHandlers+æ“ä½œæ–¹æ³•1234567function buttonEvent()&#123; window.webkit.messageHandlers.buttonEvent.postMessage(null);&#125; function getTextEvent() &#123; window.webkit.messageHandlers.getTextEvent.postMessage(null);&#125; éµå¾ªWKScriptMessageHandler åœ¨- (void)viewWillAppear:(BOOL)animatedä¸­æ·»åŠ scriptMessageHandler åœ¨- (void)viewWillDisappear:(BOOL)animatedä¸­ç§»é™¤scriptMessageHandler å®ç°WKScriptMessageHandleræ–¹æ³•1234567891011121314151617181920212223242526272829303132- (void)viewWillAppear:(BOOL)animated &#123; [super viewWillAppear:animated]; [self.webView.configuration.userContentController addScriptMessageHandler:self name:@&quot;buttonEvent&quot;]; [self.webView.configuration.userContentController addScriptMessageHandler:self name:@&quot;getTextEvent&quot;];&#125;- (void)viewWillDisappear:(BOOL)animated &#123; [super viewWillDisappear:animated]; [self.webView.configuration.userContentController removeScriptMessageHandlerForName:@&quot;buttonEvent&quot;]; [self.webView.configuration.userContentController removeScriptMessageHandlerForName:@&quot;getTextEvent&quot;];&#125;#pragma mark - WKScriptMessageHandler Method- (void)userContentController:(WKUserContentController *)userContentController didReceiveScriptMessage:(WKScriptMessage *)message &#123; &#x2F;&#x2F; è°ƒç”¨JS if ([message.name isEqualToString:@&quot;buttonEvent&quot;]) &#123; UIAlertController *vc &#x3D; [UIAlertController alertControllerWithTitle:@&quot;æ¸©é¦¨æç¤º&quot; message:@&quot;ç‚¹å‡»äº†æäº¤æŒ‰é’®&quot; preferredStyle:UIAlertControllerStyleAlert]; [vc addAction:[UIAlertAction actionWithTitle:@&quot;ç¡®å®š&quot; style:UIAlertActionStyleDefault handler:^(UIAlertAction * _Nonnull action) &#123; &#125;]]; [self presentViewController:vc animated:true completion:nil]; return; &#125; &#x2F;&#x2F; æ³¨å…¥æ•°æ®ç»™JS if ([message.name isEqualToString:@&quot;getTextEvent&quot;]) &#123; [self.webView evaluateJavaScript:@&quot;getText(&#39;å“ˆå“ˆ&#39;)&quot; completionHandler:^(id _Nullable info, NSError * _Nullable error) &#123; NSLog(@&quot;Error--%@, info--%@&quot;, error, info); &#125;]; return; &#125;&#125; WebViewJavascriptBridgeHTMLä»£ç  123456789101112131415161718192021222324252627282930313233343536&lt;body&gt; &lt;h2&gt;æŒ‰é’®ç‚¹å‡»&lt;&#x2F;h2&gt; &lt;input id &#x3D; &#39;submitBtn&#39; type&#x3D;&quot;button&quot; value&#x3D;&quot;æäº¤æŒ‰é’®&quot; onclick&#x3D;&quot;submitClick()&quot;&#x2F;&gt; &lt;h2&gt;æ–‡ä»¶é€‰æ‹©&lt;&#x2F;h2&gt; &lt;input type&#x3D;&quot;file&quot; id&#x3D;&quot;image&quot;&gt; &lt;h2&gt;æ³¨å…¥æ•°æ®&lt;&#x2F;h2&gt; &lt;input type&#x3D;&quot;text&quot; id&#x3D;&quot;getTextField&quot; &#x2F;&gt; &lt;input type&#x3D;&quot;button&quot; value&#x3D;&quot;å¼€å§‹è·å–&quot; id &#x3D; &#39;startGet&#39; onclick&#x3D;&quot;getTextClick()&quot;&#x2F;&gt; &lt;script&gt; function setupWebViewJavascriptBridge(callback) &#123; if (window.WebViewJavascriptBridge) &#123; return callback(WebViewJavascriptBridge); &#125; if (window.WVJBCallbacks) &#123; return window.WVJBCallbacks.push(callback); &#125; window.WVJBCallbacks &#x3D; [callback]; var WVJBIframe &#x3D; document.createElement(&#39;iframe&#39;); WVJBIframe.style.display &#x3D; &#39;none&#39;; WVJBIframe.src &#x3D; &#39;https:&#x2F;&#x2F;__bridge_loaded__&#39;; document.documentElement.appendChild(WVJBIframe); setTimeout(function() &#123; document.documentElement.removeChild(WVJBIframe) &#125;, 0) &#125; setupWebViewJavascriptBridge(function(bridge) &#123; &#125;) function submitClick() &#123; WebViewJavascriptBridge.callHandler(&#39;submitClick&#39;, null, function(response) &#123; &#125;); &#125; function getTextClick() &#123; WebViewJavascriptBridge.callHandler(&#39;getTextClick&#39;, null, function(response) &#123; document.getElementById(&quot;getTextField&quot;).value &#x3D; response; &#125;); &#125; &lt;&#x2F;script&gt;&lt;&#x2F;body&gt; ç¬¬ä¸‰æ–¹åº“ï¼šåœ°å€ æ·»åŠ WebViewJavascriptBridgeåº“ å¯¼å…¥å¤´æ–‡ä»¶#import &lt;WebViewJavascriptBridge.h&gt; å£°æ˜æ–¹æ³•@property WebViewJavascriptBridge* bridge; ä¸WebViewå…³è”123_bridge &#x3D; [WebViewJavascriptBridge bridgeForWebView:self.webView];[_bridge setWebViewDelegate:self]; è°ƒç”¨js1234567[_bridge registerHandler:@&quot;submitClick&quot; handler:^(id data, WVJBResponseCallback responseCallback) &#123; UIAlertController *vc &#x3D; [UIAlertController alertControllerWithTitle:@&quot;æ¸©é¦¨æç¤º&quot; message:@&quot;ç‚¹å‡»äº†æäº¤æŒ‰é’®&quot; preferredStyle:UIAlertControllerStyleAlert]; [vc addAction:[UIAlertAction actionWithTitle:@&quot;ç¡®å®š&quot; style:UIAlertActionStyleDefault handler:^(UIAlertAction * _Nonnull action) &#123; &#125;]]; [self presentViewController:vc animated:true completion:nil];&#125;]; æ³¨å…¥æ•°æ®123[_bridge registerHandler:@&quot;getTextClick&quot; handler:^(id data, WVJBResponseCallback responseCallback) &#123; responseCallback(@&quot;å“ˆå“ˆå“ˆ&quot;);&#125;];","categories":[],"tags":[]},{"title":"iOSè‡ªå®šä¹‰æ§ä»¶-è‡ªå®šä¹‰åˆ†ç±»ä¸‹æ‹‰","slug":"iOSè‡ªå®šä¹‰æ§ä»¶-è‡ªå®šä¹‰åˆ†ç±»ä¸‹æ‹‰","date":"2020-01-16T08:06:44.955Z","updated":"2020-01-20T02:08:55.469Z","comments":true,"path":"2020/01/16/iOSè‡ªå®šä¹‰æ§ä»¶-è‡ªå®šä¹‰åˆ†ç±»ä¸‹æ‹‰/","link":"","permalink":"https://github.com/wuvdan/wuvdan.github.io/2020/01/16/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%88%86%E7%B1%BB%E4%B8%8B%E6%8B%89/","excerpt":"","text":"æœ€è¿‘è‡ªç”±æ—¶é—´æœ‰ç‚¹å¤šï¼Œå°±å¼€å§‹æ’¸æ§ä»¶ã€‚è¿™ä¸ªæ˜¯æˆ‘ä»¬å¸¸ç”¨çš„ä¸€ä¸ªä¸‹æ‹‰åˆ†ç±»æ§ä»¶ï¼Œçœ‹äº†å¾ˆå¤šåˆ«äººå†™çš„ï¼Œéƒ½æ˜¯ç”¨TableViewæˆ–è€…CollectionViewæ•´åˆåœ¨ä¸€èµ·çš„æ„Ÿè§‰è‡ªå®šä¹‰æ€§æ²¡æœ‰é‚£ä¹ˆå¼ºï¼Œæ‰€ä»¥å°±å°è¯•ç”¨æŠŠTableViewå’ŒCollectionViewæ›¿æ¢æˆUIViewControllerã€‚å…¶ä»–åºŸè¯ä¸å¤šè¯´äº†ã€‚ 1ã€ æ¥å£æ–‡ä»¶123456789101112131415161718192021222324252627282930313233343536#import &lt;UIKit&#x2F;UIKit.h&gt;UIKIT_EXTERN NSString *lzDropViewNotification;NS_ASSUME_NONNULL_BEGIN@class LZDropView;@protocol LZDropViewDataSource &lt;NSObject&gt;@required&#x2F;** Height corresponding to controller display *&#x2F;- (NSArray&lt;NSNumber *&gt; *)setupCategoryControllerHeightInDropView:(LZDropView *)dropView;&#x2F;** Title corresponding controller array *&#x2F;- (NSArray&lt;UIViewController *&gt; *)setupCategoryControllerInDropView:(LZDropView *)dropView;&#x2F;** Default display of Title Array *&#x2F;- (NSArray&lt;NSString *&gt; *)setupCategoryTitleNameInDropView:(LZDropView *)dropView;@end@protocol LZDropViewDelegate &lt;NSObject&gt;&#x2F;** Click the column and select the information. *&#x2F;- (void)dropView:(LZDropView *)dropView didSelectAtColumn:(NSInteger)column info:(NSString *)info;@end@interface LZDropView : UIView&#x2F;** Simple page configuration *&#x2F;@property (nonatomic, weak) id &lt;LZDropViewDataSource&gt; dataSorce;&#x2F;** Click proxy event&lt;##&gt; *&#x2F;@property (nonatomic, weak) id &lt;LZDropViewDelegate&gt; delegate;@endNS_ASSUME_NONNULL_END 2ã€ å®ç°æ–‡ä»¶123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167#import &quot;LZDropView.h&quot;NSString *lzDropViewNotification &#x3D; @&quot;nitification&quot;;@interface LZDropView ()@property (nonatomic, strong) NSArray&lt;UIViewController *&gt; *controllerArray;@property (nonatomic, strong) NSArray&lt;NSString *&gt; *titleArray;@property (nonatomic, strong) UIButton *containerView;@property (nonatomic, strong) NSArray&lt;NSNumber *&gt; *controllerHeightArray;@property (nonatomic, strong) NSMutableArray&lt;UIButton *&gt; *buttonArray;@end@implementation LZDropView#pragma mark - Release memory- (void)dealloc &#123; [[NSNotificationCenter defaultCenter] removeObserver:self];&#125;#pragma mark - Initialization- (instancetype)init &#123; self &#x3D; [super init]; if (self) &#123; [[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(notificationAction:) name:lzDropViewNotification object:nil]; &#125; return self;&#125;#pragma mark - Draw the page- (void)setupTitleButton:(NSArray&lt;NSString *&gt; *)array &#123; CGFloat width &#x3D; UIScreen.mainScreen.bounds.size.width &#x2F; array.count; self.buttonArray &#x3D; [NSMutableArray array]; for (NSString *name in array) &#123; NSInteger index &#x3D; [array indexOfObject:name]; UIButton *button &#x3D; [UIButton buttonWithType:UIButtonTypeCustom]; button.titleLabel.font &#x3D; [UIFont systemFontOfSize:15]; [button setTitle:[NSString stringWithFormat:@&quot;%@ â–¼&quot;, name] forState:UIControlStateNormal]; [button setTitle:[NSString stringWithFormat:@&quot;%@ â–²&quot;, name] forState:UIControlStateSelected]; [button setTitleColor:UIColor.grayColor forState:UIControlStateNormal]; [button setTitleColor:UIColor.orangeColor forState:UIControlStateSelected]; button.frame &#x3D; CGRectMake(width * index, 0, width, 45); button.tag &#x3D; index + 1000; [button addTarget:self action:@selector(buttonTouched:) forControlEvents:UIControlEventTouchUpInside]; [self addSubview:button]; [self.buttonArray addObject:button]; &#125;&#125;#pragma mark - Button click event- (void)buttonTouched:(UIButton *)sender &#123; if (sender.selected) &#123; [self closeControllerView]; &#125; else &#123; [self openControllerViewWithButton:sender]; &#125;&#125;- (void)backButtonTouched:(UIButton *)sender &#123; [self closeControllerView];&#125;#pragma mark - Notification event- (void)notificationAction:(NSNotification *)notification &#123; if (![self.controllerArray containsObject:notification.object]) &#123; return; &#125; NSInteger index &#x3D; [self.controllerArray indexOfObject:notification.object]; UIButton *button &#x3D; self.buttonArray[index]; [button setTitle:[NSString stringWithFormat:@&quot;%@ â–¼&quot;, notification.userInfo.allValues.firstObject] forState:UIControlStateNormal]; if (self.delegate &amp;&amp; [self.delegate respondsToSelector:@selector(dropView:didSelectAtColumn:info:)]) &#123; [self.delegate dropView:self didSelectAtColumn:index info:notification.userInfo.allValues.firstObject]; &#125; [self closeControllerView];&#125;#pragma mark - Close all controllers.- (void)closeControllerView &#123; [UIView animateWithDuration:0.8 animations:^&#123; self.containerView.alpha &#x3D; 0; self.containerView.frame &#x3D; CGRectMake(0, CGRectGetMaxY(self.frame), UIScreen.mainScreen.bounds.size.width, 0); &#125; completion:^(BOOL finished) &#123; [self.containerView removeFromSuperview]; &#125;]; for (UIButton *button in self.buttonArray) &#123; button.selected &#x3D; false; &#125;&#125;#pragma mark - Open the corresponding controller.- (void)openControllerViewWithButton:(UIButton *)sender &#123; for (UIButton *button in self.buttonArray) &#123; button.selected &#x3D; false; &#125; self.containerView.alpha &#x3D; 1; for (UIView *view in self.containerView.subviews) &#123; [view removeFromSuperview]; &#125; UIViewController *vc &#x3D; self.controllerArray[sender.tag - 1000]; double vcHeight &#x3D; [self.controllerHeightArray[sender.tag - 1000] doubleValue]; self.containerView.frame &#x3D; CGRectMake(0, CGRectGetMaxY(self.frame), self.frame.size.width, 0); vc.view.frame &#x3D; CGRectMake(0, 0, UIScreen.mainScreen.bounds.size.width, 0); [self.superview addSubview:self.containerView]; [self.containerView addSubview:vc.view]; [UIView animateWithDuration:0.6 animations:^&#123; self.containerView.frame &#x3D; CGRectMake(0, CGRectGetMaxY(self.frame), self.frame.size.width, UIScreen.mainScreen.bounds.size.height); vc.view.frame &#x3D; CGRectMake(0, 0, UIScreen.mainScreen.bounds.size.width, vcHeight); &#125; completion:^(BOOL finished) &#123; &#125;]; sender.selected &#x3D; true;&#125;#pragma mark - Getter- (UIView *)containerView &#123; if (!_containerView) &#123; _containerView &#x3D; [[UIButton alloc] init]; _containerView.backgroundColor &#x3D; [UIColor colorWithWhite:0 alpha:0.1]; [_containerView addTarget:self action:@selector(backButtonTouched:) forControlEvents:UIControlEventTouchUpInside]; &#125; return _containerView;&#125;#pragma mark - Setter- (void)setDataSorce:(id&lt;LZDropViewDataSource&gt;)dataSorce &#123; _dataSorce &#x3D; dataSorce; if (self.dataSorce &amp;&amp; [self.dataSorce respondsToSelector:@selector(setupCategoryControllerInDropView:)])&#123; self.controllerArray &#x3D; [self.dataSorce setupCategoryControllerInDropView:self]; &#125; if (self.dataSorce &amp;&amp; [self.dataSorce respondsToSelector:@selector(setupCategoryTitleNameInDropView:)])&#123; self.titleArray &#x3D; [self.dataSorce setupCategoryTitleNameInDropView:self]; [self setupTitleButton:self.titleArray]; &#125; if (self.dataSorce &amp;&amp; [self.dataSorce respondsToSelector:@selector(setupCategoryControllerHeightInDropView:)]) &#123; self.controllerHeightArray &#x3D; [self.dataSorce setupCategoryControllerHeightInDropView:self]; &#125; if (self.controllerArray.count !&#x3D; self.titleArray.count || self.controllerArray.count !&#x3D; self.controllerHeightArray.count) &#123; @throw [NSException exceptionWithName:NSStringFromClass([self class]) reason:@&quot;The number of corresponding arrays is inconsistent.&quot; userInfo:nil]; &#125;&#125;@end ä½¿ç”¨æ–¹å¼ 1.éµå¾ªåè®® 1&lt;LZDropViewDataSource, LZDropViewDelegate&gt; 2.åˆå§‹åŒ– 123456LZDropView *view &#x3D; [[LZDropView alloc] init]; view.dataSorce &#x3D; self; view.delegate &#x3D; self; view.backgroundColor &#x3D; UIColor.whiteColor; view.frame &#x3D; CGRectMake(0, 100, UIScreen.mainScreen.bounds.size.width, 45); [self.view addSubview:view]; å®ç°ä»£ç†å’Œæ•°æ®æº12345678910111213141516171819202122232425262728#pragma mark - LZDropViewDataSource- (NSArray&lt;UIViewController *&gt; *)setupCategoryControllerInDropView:(LZDropView *)dropView &#123; return @[[[TableViewController alloc] init], [[TableViewController alloc] init], [[TableViewController alloc] init], [[TableViewController alloc] init]];&#125;- (NSArray&lt;NSString *&gt; *)setupCategoryTitleNameInDropView:(LZDropView *)dropView &#123; return @[@&quot;å…¨éƒ¨&quot;, @&quot;é™„è¿‘&quot;, @&quot;åªèƒ½æ’åº&quot;, @&quot;ç­›é€‰&quot;];&#125;- (NSArray&lt;NSNumber *&gt; *)setupCategoryControllerHeightInDropView:(LZDropView *)dropView &#123; return @[[NSNumber numberWithFloat:300], [NSNumber numberWithFloat:400], [NSNumber numberWithFloat:410], [NSNumber numberWithFloat:420]];&#125;#pragma mark - LZDropViewDelegate- (void)dropView:(LZDropView *)dropView didSelectAtColumn:(NSInteger)column info:(NSString *)info &#123; NSLog(@&quot;%ld---%@&quot;, column, info);&#125; ç‚¹å‡»controllerä¸­çš„æ•°æ®æ˜¾ç¤ºåœ¨æŒ‰é’®çš„æ ‡é¢˜ä¸­ï¼Œè¿™å› ä¸ºè·¨ç•Œé¢æ˜¾ç¤ºï¼Œæˆ‘æš‚æ—¶æ²¡æœ‰æƒ³åˆ°å¥½çš„åŠæ³•ï¼Œæ‰€ä»¥ä½¿ç”¨å¼ºå¤§çš„é€šçŸ¥ä¼ å€¼ã€‚ è®°å½•é€‰ä¸­çŠ¶æ€ï¼Œåº”è¯¥æ˜¯æ§åˆ¶å™¨é‡Œé¢çš„æ“ä½œï¼Œè¿™é‡Œå°±æ²¡æœ‰å®ç°1[[NSNotificationCenter defaultCenter] postNotificationName:lzDropViewNotification object:self userInfo:@&#123;@&quot;key&quot;:[NSString stringWithFormat:@&quot;ç¬¬%ldcell&quot;, indexPath.row]&#125;]; å¦‚æœæœ‰ä»€ä¹ˆä¸å¥½å¦‚æœå»ºè®®çš„åœ°æ–¹ï¼Œè¯·æ‰¹è¯„æŒ‡æ­£ï¼","categories":[{"name":"Objective-C","slug":"Objective-C","permalink":"https://github.com/wuvdan/wuvdan.github.io/categories/Objective-C/"}],"tags":[{"name":"è‡ªå®šä¹‰æ§ä»¶","slug":"è‡ªå®šä¹‰æ§ä»¶","permalink":"https://github.com/wuvdan/wuvdan.github.io/tags/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6/"}]},{"title":"iOSè‡ªå®šä¹‰æ§ä»¶-è‡ªå®šä¹‰Alterå¼¹çª—","slug":"iOSè‡ªå®šä¹‰æ§ä»¶-è‡ªå®šä¹‰Alterå¼¹çª—","date":"2020-01-16T08:06:41.422Z","updated":"2020-01-20T02:09:01.273Z","comments":true,"path":"2020/01/16/iOSè‡ªå®šä¹‰æ§ä»¶-è‡ªå®šä¹‰Alterå¼¹çª—/","link":"","permalink":"https://github.com/wuvdan/wuvdan.github.io/2020/01/16/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-%E8%87%AA%E5%AE%9A%E4%B9%89Alter%E5%BC%B9%E7%AA%97/","excerpt":"","text":"åœ¨ä¸‹å°ç™½ä¸€ä¸ªï¼Œå‡†å¤‡å†™å†™å’Œè‡ªå·±å¼€å‘æ¯æ¯ç›¸å…³çš„æ§ä»¶ï¼Œå¸Œæœ›å¤§å®¶æ‰¹è¯„æŒ‡æ­£ã€‚è¿™æ˜¯ç¬¬ä¸€ä¸ªå¸¸ç”¨çš„åº•éƒ¨å¼¹çª—ï¼Œä½¿ç”¨äº†æœ€ç®€å•çš„åˆ†è£…æ–¹å¼ã€‚ 1ã€å¤´æ–‡ä»¶é‡Œé¢å£°æ˜äº†ä¸€ä¸ªä»£ç†å’Œåˆå§‹åŒ–æ–¹æ³•ã€‚12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667#import &lt;UIKit&#x2F;UIKit.h&gt;NS_ASSUME_NONNULL_BEGIN@class LZAlterView;@protocol LZAlterViewDelegate &lt;NSObject&gt;- (void)alterView:(LZAlterView *)alterView didSelectedAtIndex:(NSInteger)index;@end@interface LZAlterView : UIView+ (instancetype)alter;&#x2F;** æ˜¾ç¤ºæ ·å¼ä¸€ @param mainTitle ä¸»æ ‡é¢˜ @param subTitle å‰¯æ ‡é¢˜ @param actionTitleArray äº‹ä»¶æŒ‰é’®æ•°ç»„ @param cancelTitle å–æ¶ˆæŒ‰é’® @return return value description *&#x2F;- (LZAlterView *)configureWithMainTitle:(NSString *)mainTitle subTitle:(NSString *)subTitle actionTitleArray:(NSArray&lt;NSString *&gt; *)actionTitleArray cancelActionTitle:(NSString *)cancelTitle;&#x2F;** æ˜¾ç¤ºæ ·å¼äºŒ @param mainTitle ä¸»æ ‡é¢˜ @param subTitle å‰¯æ ‡é¢˜ @param actionTitleArray äº‹ä»¶æŒ‰é’®ç»„æ•° @return return value description *&#x2F;- (LZAlterView *)configureWithMainTitle:(NSString *)mainTitle subTitle:(NSString *)subTitle actionTitleArray:(NSArray&lt;NSString *&gt; *)actionTitleArray;&#x2F;** æ˜¾ç¤ºæ ·å¼ä¸‰ @param actionTitleArray äº‹ä»¶æŒ‰é’®æ•°ç»„ @param cancelTitle å–æ¶ˆæŒ‰é’® @return return value description *&#x2F;- (LZAlterView *)configureWithActionTitleArray:(NSArray&lt;NSString *&gt; *)actionTitleArray cancelActionTitle:(NSString *)cancelTitle;&#x2F;** æ˜¾ç¤ºæ ·å¼å›› @param actionTitleArray äº‹ä»¶æŒ‰é’®æ•°ç»„ @return return value description *&#x2F;- (LZAlterView *)configureWithActionTitleArray:(NSArray&lt;NSString *&gt; *)actionTitleArray;&#x2F;** è®¾ç½®ä»£ç† @param delegate ä»£ç† @return return value description *&#x2F;- (LZAlterView *)setupDelegate:(id&lt;LZAlterViewDelegate&gt;)delegate;- (void)showAlter;@endNS_ASSUME_NONNULL_END 2ã€å®ç°æ–‡ä»¶é‡Œé¢è¿›è¡Œé¡µé¢çš„ç»˜åˆ¶ã€æ•°æ®å¤„ç†å’Œäº‹ä»¶å¤„ç†ã€‚123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243#import &quot;LZAlterView.h&quot;#define alter_ScreenWidth UIScreen.mainScreen.bounds.size.width#define alter_ScreenHeight UIScreen.mainScreen.bounds.size.height#define alter_actionHeight 45 * alter_ScreenWidth&#x2F;375.0#define alter_cancelSpece 5 * alter_ScreenWidth&#x2F;375.0#define alter_mainTitleHeight alter_actionHeight + alter_cancelSpece#define alter_FontSize(s) [UIFont systemFontOfSize:s * alter_ScreenWidth&#x2F;375.0]@interface LZAlterView ()@property (nonatomic) CGRect conterViewRect;@property (nonatomic, strong) UIView *contanerView;@property (nonatomic, weak) id &lt;LZAlterViewDelegate&gt; delegate;@end@implementation LZAlterView+ (instancetype)alter &#123; static dispatch_once_t onceToken; static LZAlterView *alter; dispatch_once(&amp;onceToken, ^&#123; alter &#x3D; [[LZAlterView alloc] init]; &#125;); return alter;&#125;- (instancetype)init &#123; self &#x3D; [super init]; if (self) &#123; UITapGestureRecognizer *tap &#x3D; [[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(tapGestureRecognizer:)]; [self addGestureRecognizer:tap]; &#125; return self;&#125;#pragma mark - Configuration method&#x2F;** ä»£ç† *&#x2F;- (LZAlterView *)setupDelegate:(id&lt;LZAlterViewDelegate&gt;)delegate &#123; self.delegate &#x3D; delegate; return self;&#125;&#x2F;** Set title, subtitle, events and cancel *&#x2F;- (LZAlterView *)configureWithMainTitle:(NSString *)mainTitle subTitle:(NSString *)subTitle actionTitleArray:(NSArray&lt;NSString *&gt; *)actionTitleArray cancelActionTitle:(NSString *)cancelTitle &#123; CGFloat width &#x3D; alter_actionHeight * (actionTitleArray.count + 1) + alter_cancelSpece + alter_mainTitleHeight; self.contanerView.frame &#x3D; CGRectMake(0, [self safeScreenHeight] - width, alter_ScreenWidth, width); [self addSubview:self.contanerView]; UILabel *titleLabel &#x3D; [self setupMainTitle:mainTitle subTitle:subTitle]; titleLabel.frame &#x3D; CGRectMake(0, 0, alter_ScreenWidth, alter_mainTitleHeight); [self.contanerView addSubview:titleLabel]; UIButton *cancelButton &#x3D; [self cancelButtonWithTitle:cancelTitle]; cancelButton.frame &#x3D; CGRectMake(0, self.contanerView.frame.size.height - alter_actionHeight, alter_ScreenWidth, alter_actionHeight); [self.contanerView addSubview:cancelButton]; for (NSString *name in actionTitleArray) &#123; UIButton *button &#x3D; [self setupActionWithTitle:name]; NSInteger index &#x3D; [actionTitleArray indexOfObject:name]; button.tag &#x3D; 1000 + index; button.frame &#x3D; CGRectMake(0, titleLabel.frame.size.height + 0.5 + alter_actionHeight * index, alter_ScreenWidth, alter_actionHeight - 0.5); [self.contanerView addSubview:button]; &#125; self.conterViewRect &#x3D; self.contanerView.frame; return self;&#125;&#x2F;** Set title, subtitle and events *&#x2F;- (LZAlterView *)configureWithMainTitle:(NSString *)mainTitle subTitle:(NSString *)subTitle actionTitleArray:(NSArray&lt;NSString *&gt; *)actionTitleArray &#123; CGFloat width &#x3D; alter_actionHeight * actionTitleArray.count + alter_mainTitleHeight; self.contanerView.frame &#x3D; CGRectMake(0, [self safeScreenHeight] - width, alter_ScreenWidth, width); [self addSubview:self.contanerView]; UILabel *titleLabel &#x3D; [self setupMainTitle:mainTitle subTitle:subTitle]; titleLabel.frame &#x3D; CGRectMake(0, 0, alter_ScreenWidth, alter_mainTitleHeight); [self.contanerView addSubview:titleLabel]; for (NSString *name in actionTitleArray) &#123; UIButton *button &#x3D; [self setupActionWithTitle:name]; NSInteger index &#x3D; [actionTitleArray indexOfObject:name]; button.tag &#x3D; 1000 + index; button.frame &#x3D; CGRectMake(0, titleLabel.frame.size.height + 0.5 + alter_actionHeight * index, alter_ScreenWidth, alter_actionHeight - 0.5); [self.contanerView addSubview:button]; &#125; self.conterViewRect &#x3D; self.contanerView.frame; return self;&#125;&#x2F;** Set events and cancel *&#x2F;- (LZAlterView *)configureWithActionTitleArray:(NSArray&lt;NSString *&gt; *)actionTitleArray cancelActionTitle:(NSString *)cancelTitle &#123; CGFloat width &#x3D; alter_actionHeight * (actionTitleArray.count + 1) + alter_cancelSpece; self.contanerView.frame &#x3D; CGRectMake(0, [self safeScreenHeight] - width, alter_ScreenWidth, width); [self addSubview:self.contanerView]; UIButton *cancelButton &#x3D; [self cancelButtonWithTitle:cancelTitle]; cancelButton.frame &#x3D; CGRectMake(0, self.contanerView.frame.size.height - alter_actionHeight, alter_ScreenWidth, alter_actionHeight); [self.contanerView addSubview:cancelButton]; for (NSString *name in actionTitleArray) &#123; UIButton *button &#x3D; [self setupActionWithTitle:name]; NSInteger index &#x3D; [actionTitleArray indexOfObject:name]; button.tag &#x3D; 1000 + index; button.frame &#x3D; CGRectMake(0, alter_actionHeight * index, alter_ScreenWidth, alter_actionHeight-0.5); [self.contanerView addSubview:button]; &#125; self.conterViewRect &#x3D; self.contanerView.frame; return self;&#125;&#x2F;** Set events *&#x2F;- (LZAlterView *)configureWithActionTitleArray:(NSArray&lt;NSString *&gt; *)actionTitleArray &#123; CGFloat width &#x3D; alter_actionHeight * actionTitleArray.count; self.contanerView.frame &#x3D; CGRectMake(0, [self safeScreenHeight] - width, alter_ScreenWidth, width); [self addSubview:self.contanerView]; for (NSString *name in actionTitleArray) &#123; UIButton *button &#x3D; [self setupActionWithTitle:name]; NSInteger index &#x3D; [actionTitleArray indexOfObject:name]; button.tag &#x3D; 1000 + index; button.frame &#x3D; CGRectMake(0, alter_actionHeight * index, alter_ScreenWidth, alter_actionHeight-0.5); [self.contanerView addSubview:button]; &#125; self.conterViewRect &#x3D; self.contanerView.frame; return self;&#125;&#x2F;** Event button style *&#x2F;- (UIButton *)setupActionWithTitle:(NSString *)title &#123; UIButton *button &#x3D; [UIButton buttonWithType:UIButtonTypeCustom]; [button setTitle:title forState:UIControlStateNormal]; [button setTitleColor:UIColor.blackColor forState:UIControlStateNormal]; button.backgroundColor &#x3D; [UIColor colorWithRed:0.9 green:0.9 blue:0.9 alpha:1]; button.titleLabel.font &#x3D; alter_FontSize(15); [button addTarget:self action:@selector(buttonTouched:) forControlEvents:UIControlEventTouchUpInside]; return button;&#125;&#x2F;** Cancel button style *&#x2F;- (UIButton *)cancelButtonWithTitle:(NSString *)title &#123; UIButton *button &#x3D; [UIButton buttonWithType:UIButtonTypeCustom]; [button setTitle:title forState:UIControlStateNormal]; [button setTitleColor:[UIColor colorWithRed:0.9 green:0 blue:0 alpha:1] forState:UIControlStateNormal]; button.backgroundColor &#x3D; [UIColor colorWithRed:0.9 green:0.9 blue:0.9 alpha:1]; button.titleLabel.font &#x3D; alter_FontSize(15); [button addTarget:self action:@selector(hidenAlter) forControlEvents:UIControlEventTouchUpInside]; return button;&#125;&#x2F;** Title style *&#x2F;- (UILabel *)setupMainTitle:(NSString *)title subTitle:(NSString *)subTitle &#123; NSString *titleString; if (subTitle.length &#x3D;&#x3D; 0) &#123; titleString &#x3D; [NSString stringWithFormat:@&quot;%@&quot;,title]; &#125; else &#123; titleString &#x3D; [NSString stringWithFormat:@&quot;%@\\n%@&quot;,title,subTitle]; &#125; UILabel *label &#x3D; [[UILabel alloc] init]; label.backgroundColor &#x3D; [UIColor colorWithRed:0.9 green:0.9 blue:0.9 alpha:1]; label.textColor &#x3D; UIColor.blackColor; label.font &#x3D; alter_FontSize(15); NSMutableAttributedString *muAttribute &#x3D; [[NSMutableAttributedString alloc] initWithString:titleString]; [muAttribute addAttribute:NSFontAttributeName value:alter_FontSize(12) range:NSMakeRange(titleString.length - subTitle.length, subTitle.length)]; [muAttribute addAttribute:NSForegroundColorAttributeName value:UIColor.grayColor range:NSMakeRange(titleString.length - subTitle.length, subTitle.length)]; label.textAlignment &#x3D; NSTextAlignmentCenter; label.numberOfLines &#x3D; 2; label.attributedText &#x3D; muAttribute; return label;&#125;#pragma mark - Button click events and delegate- (void)buttonTouched:(UIButton *)sender &#123; [self hidenAlter]; if (self.delegate &amp;&amp; [self.delegate respondsToSelector:@selector(alterView:didSelectedAtIndex:)]) &#123; [self.delegate alterView:self didSelectedAtIndex:sender.tag - 1000]; &#125;&#125;&#x2F;** iOS 11 safeArea bottom space *&#x2F;- (CGFloat)safeScreenHeight &#123; CGFloat safeAreaInsetsBottom &#x3D; 0; if (@available(iOS 11.0, *)) &#123; safeAreaInsetsBottom &#x3D; UIApplication.sharedApplication.delegate.window.safeAreaInsets.bottom; &#125; else &#123; safeAreaInsetsBottom &#x3D; 0; &#125; return alter_ScreenHeight - safeAreaInsetsBottom;&#125;#pragma mark - Show alter And hiden alter&#x2F;** Show alter from bottom *&#x2F;- (void)showAlter &#123; [UIApplication.sharedApplication.delegate.window addSubview:self]; self.backgroundColor &#x3D; [UIColor colorWithWhite:0 alpha:0.3]; self.frame &#x3D; CGRectMake(0, 0, alter_ScreenWidth, alter_ScreenHeight); self.alpha &#x3D; 0; self.contanerView.frame &#x3D; CGRectMake(0, UIScreen.mainScreen.bounds.size.height, UIScreen.mainScreen.bounds.size.height, 0); [UIView animateWithDuration:0.4 animations:^&#123; self.alpha &#x3D; 1; self.contanerView.frame &#x3D; self.conterViewRect; &#125;];&#125;&#x2F;** Hiden alter and remove subViews from superview *&#x2F;- (void)hidenAlter &#123; [UIView animateWithDuration:0.4 animations:^&#123; self.alpha &#x3D; 0; self.contanerView.frame &#x3D; CGRectMake(0, UIScreen.mainScreen.bounds.size.height, UIScreen.mainScreen.bounds.size.height, 0); &#125; completion:^(BOOL finished) &#123; for (UIView *view in self.contanerView.subviews) &#123; [view removeFromSuperview]; &#125; [self removeFromSuperview]; &#125;];&#125;#pragma mark - Getter- (UIView *)contanerView &#123; if (!_contanerView) &#123; _contanerView &#x3D; [[UIView alloc] init]; _contanerView.backgroundColor &#x3D; [UIColor colorWithRed:0.9 green:0.9 blue:0.9 alpha:0.5]; &#125; return _contanerView;&#125;#pragma mark - TapGestureRecognizer event- (void)tapGestureRecognizer:(id)sender &#123; [self hidenAlter];&#125;@end 3ã€ä½¿ç”¨æ–¹æ³•ï¼Œéµå¾ªLZAlterViewDelegateæ ·å¼ä¸€1234567&#x2F;&#x2F; Objc[[[[LZAlterView alter] configureWithMainTitle:@&quot;é€‰æ‹©å›¾ç‰‡&quot; subTitle:@&quot;1&quot; actionTitleArray:@[@&quot;æ‰“å¼€ç›¸å†Œ&quot;, @&quot;æ‰“å¼€ç›¸æœº&quot;] cancelActionTitle:@&quot;å–æ¶ˆ&quot;] setupDelegate:self] showAlter];&#x2F;&#x2F; SwiftLZAlterView.alter().configure(withMainTitle: &quot;é€‰æ‹©å›¾ç‰‡&quot;, subTitle: &quot;å‰¯æ ‡é¢˜&quot;, actionTitleArray: [&quot;ç›¸æœº&quot;, &quot;ç›¸å†Œ&quot;], cancelActionTitle: &quot;å–æ¶ˆ&quot;).setupDelegate(self).showAlter() æ ·å¼äºŒ123456&#x2F;&#x2F; Objc [[[[LZAlterView alter] configureWithMainTitle:@&quot;é€‰æ‹©å›¾ç‰‡&quot; subTitle:@&quot;2&quot; actionTitleArray:@[@&quot;æ‰“å¼€ç›¸å†Œ&quot;, @&quot;æ‰“å¼€ç›¸æœº&quot;]] setupDelegate:self] showAlter];&#x2F;&#x2F; SwiftLZAlterView.alter().configure(withMainTitle: &quot;é€‰æ‹©å›¾ç‰‡&quot;, subTitle: &quot;éœ€è¦ç”¨æˆ·æƒé™&quot;, actionTitleArray: [&quot;ç›¸æœº&quot;, &quot;ç›¸å†Œ&quot;]).setupDelegate(self).showAlter() æ ·å¼ä¸‰12345&#x2F;&#x2F; Objc[[[[LZAlterView alter] configureWithActionTitleArray:@[@&quot;æ‰“å¼€ç›¸å†Œ&quot;, @&quot;æ‰“å¼€ç›¸æœº&quot;] cancelActionTitle:@&quot;å–æ¶ˆ&quot;] setupDelegate:self] showAlter];&#x2F;&#x2F; SwiftLZAlterView.alter().configure(withActionTitleArray: [&quot;ç›¸æœº&quot;, &quot;ç›¸å†Œ&quot;], cancelActionTitle: &quot;å–æ¶ˆ&quot;).setupDelegate(self).showAlter() æ ·å¼å››1234&#x2F;&#x2F; Objc[[[[LZAlterView alter] configureWithActionTitleArray:@[@&quot;æ‰“å¼€ç›¸å†Œ&quot;, @&quot;æ‰“å¼€ç›¸æœº&quot;, @&quot;æ‹ç…§è§†é¢‘&quot;]] setupDelegate:self] showAlter];&#x2F;&#x2F; SwiftLZAlterView.alter().configure(withActionTitleArray: [&quot;ç›¸æœº&quot;, &quot;ç›¸å†Œ&quot;]).setupDelegate(self).showAlter() 4ã€ä»£ç†æ–¹æ³•12345678910&#x2F;&#x2F; Objc- (void)alterView:(LZAlterView *)alterView didSelectedAtIndex:(NSInteger)index &#123; NSLog(@&quot;ç‚¹å‡»ç¬¬%ldæŒ‰é’®&quot;, index);&#125;&#x2F;&#x2F; Swiftextension ViewController: LZAlterViewDelegate &#123; func alterView(_ alterView: LZAlterView, didSelectedAt index: Int) &#123; print(&quot;ç‚¹å‡»ç¬¬\\(index)æŒ‰é’®&quot;) &#125;&#125; 5ã€æ•ˆæœå›¾ ç»“å°¾ï¼šæœ‰é—®é¢˜å¸Œæœ›å¤§å®¶æŒ‡æ­£ï¼ğŸ˜„ğŸ˜„ğŸ˜„","categories":[{"name":"Objective-C","slug":"Objective-C","permalink":"https://github.com/wuvdan/wuvdan.github.io/categories/Objective-C/"}],"tags":[{"name":"è‡ªå®šä¹‰æ§ä»¶","slug":"è‡ªå®šä¹‰æ§ä»¶","permalink":"https://github.com/wuvdan/wuvdan.github.io/tags/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6/"}]},{"title":"iOSè‡ªå®šä¹‰æ§ä»¶-ä¸€ä¸ªç®€æ˜“çš„Combobox","slug":"iOSè‡ªå®šä¹‰æ§ä»¶-ä¸€ä¸ªç®€æ˜“çš„Combobox","date":"2020-01-16T08:06:36.855Z","updated":"2020-01-20T02:08:43.532Z","comments":true,"path":"2020/01/16/iOSè‡ªå®šä¹‰æ§ä»¶-ä¸€ä¸ªç®€æ˜“çš„Combobox/","link":"","permalink":"https://github.com/wuvdan/wuvdan.github.io/2020/01/16/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-%E4%B8%80%E4%B8%AA%E7%AE%80%E6%98%93%E7%9A%84Combobox/","excerpt":"","text":"ä»£ç ç®€å•æ˜“æ‡‚ï¼Œå±äºè‡ªå·±ç»ƒæ‰‹çš„ä»£ç ï¼Œè¿˜åœ¨å­¦ä¹ ï¼Œå†™çš„ä¸å¥½ï¼Œå¸Œæœ›å‹¿å–·1ã€å¤´æ–‡ä»¶ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657#import &lt;UIKit&#x2F;UIKit.h&gt;NS_ASSUME_NONNULL_BEGINtypedef NS_ENUM(NSInteger, WDComboBoxControlDirection) &#123; WDComboBoxControlDirectionTop, WDComboBoxControlDirectionLeading, WDComboBoxControlDirectionTrailing, WDComboBoxControlDirectionBottom,&#125;;@protocol WDComboBoxControlDataSource &lt;NSObject&gt;@optional&#x2F;** &lt; æ•°æ®æ•°ç»„ &gt; *&#x2F;- (NSArray&lt;NSArray&lt;NSString *&gt; *&gt; *)dataSourceOfColunm;@required&#x2F;** &lt; æ ‡é¢˜æ•°ç»„ &gt; *&#x2F;- (NSArray&lt;NSString *&gt; *)titleOfSection;@end@protocol WDComboBoxControlDelegate &lt;NSObject&gt;&#x2F;** ç‚¹å‡»äº‹ä»¶ @param indexPath indexPath description @param title title description @param sourceView sourceView description *&#x2F;- (void)selectedAtIndexPath:(NSIndexPath *)indexPath resultTitle:(NSString *)title fromSourceView:(UIView *)sourceView;@end@interface WDComboBoxControl : UIView@property (nonatomic, weak) id &lt;WDComboBoxControlDataSource&gt; dataSource;@property (nonatomic, weak) id &lt;WDComboBoxControlDelegate&gt; delegate;&#x2F;** &lt; èƒŒæ™¯æŒ‰é’®ï¼Œå¯ä»¥å®šä¹‰éœ€è¦çš„å±æ€§ &gt; *&#x2F;@property (nonatomic, strong) UIButton *backgroundButton;&#x2F;** &lt; å†…å®¹TableViewï¼Œä¹Ÿå¯ä»¥å®šä¹‰ä¸€äº›å±æ€§ &gt; *&#x2F;@property (nonatomic, strong) UITableView *tableView;&#x2F;** åˆå§‹åŒ–æ–¹æ³• @param height æ˜¾ç¤ºå†…å®¹é«˜åº¦ @param view å‚è€ƒView @return return value description *&#x2F;- (instancetype)initViewWithMaxHeight:(CGFloat)height fromView:(UIView *)view showDirection:(WDComboBoxControlDirection)direction;&#x2F;** æ˜¾ç¤ºé¡µé¢ *&#x2F;- (void)showInView;@endNS_ASSUME_NONNULL_END 2ã€å®ç°æ–‡ä»¶ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140#import &quot;WDComboBoxControl.h&quot;@interface WDComboBoxControl () &lt;UITableViewDelegate, UITableViewDataSource&gt;@property (nonatomic, assign) CGFloat viewHeight;@property (nonatomic, strong) NSArray&lt;NSArray&lt;NSString *&gt; *&gt; * dataArray;@property (nonatomic, strong) NSArray&lt;NSString *&gt; * titleArray;@property (nonatomic, strong) UIView *sourceView;@property (nonatomic, assign) WDComboBoxControlDirection direction;@end@implementation WDComboBoxControl#pragma mark &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; åˆå§‹åŒ–é¡µé¢ &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;- (instancetype)initViewWithMaxHeight:(CGFloat)height fromView:(UIView *)view showDirection:(WDComboBoxControlDirection)direction &#123; self &#x3D; [super init]; if (self) &#123; _viewHeight &#x3D; height; _sourceView &#x3D; view; _direction &#x3D; direction; [self setupSubViewsPropertys]; [self setupSubViewsConstraints]; &#125; return self;&#125;#pragma mark &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; æ˜¾ç¤ºé¡µé¢ &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;- (void)showInView &#123; self.frame &#x3D; UIScreen.mainScreen.bounds; [UIApplication.sharedApplication.delegate.window addSubview:self];&#125;#pragma mark &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; è®©é¡µé¢æ¶ˆå¤± &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;- (void)dismisssView &#123; [self removeFromSuperview];&#125;#pragma mark &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; è·å–æ•°æ®æº &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;- (void)setDataSource:(id&lt;WDComboBoxControlDataSource&gt;)dataSource &#123; _dataSource &#x3D; dataSource; if (self.dataSource &amp;&amp; [self.dataSource respondsToSelector:@selector(dataSourceOfColunm)]) &#123; self.dataArray &#x3D; [self.dataSource dataSourceOfColunm]; &#125; if (self.dataArray &amp;&amp; [self.dataSource respondsToSelector:@selector(titleOfSection)]) &#123; self.titleArray &#x3D; [self.dataSource titleOfSection]; &#125; [self.tableView reloadData];&#125;#pragma mark &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; Add controls, set properties &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;- (void)setupSubViewsPropertys &#123; self.backgroundButton &#x3D; [[UIButton alloc] init]; self.backgroundButton.backgroundColor &#x3D; UIColor.clearColor; [self.backgroundButton addTarget:self action:@selector(dismisssView) forControlEvents:UIControlEventTouchUpInside]; [self addSubview:self.backgroundButton]; self.tableView &#x3D; [[UITableView alloc] init]; self.tableView.delegate &#x3D; self; self.tableView.dataSource &#x3D; self; self.tableView.tableFooterView &#x3D; [[UIView alloc] init]; self.tableView.layer.borderColor &#x3D; UIColor.lightGrayColor.CGColor; self.tableView.layer.borderWidth &#x3D; 0.5; self.tableView.estimatedRowHeight &#x3D; 45; self.tableView.layer.cornerRadius &#x3D; 5; self.tableView.rowHeight &#x3D; UITableViewAutomaticDimension; [self addSubview:self.tableView];&#125;#pragma mark &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; Setting control layout constraints &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;- (void)setupSubViewsConstraints &#123; self.backgroundButton.frame &#x3D; UIScreen.mainScreen.bounds; switch (self.direction) &#123; case WDComboBoxControlDirectionBottom:&#123; self.tableView.frame &#x3D; CGRectMake(CGRectGetMinX(self.sourceView.frame), CGRectGetMaxY(self.sourceView.frame), self.sourceView.frame.size.width, self.viewHeight); &#125; break; case WDComboBoxControlDirectionTop:&#123; self.tableView.frame &#x3D; CGRectMake(CGRectGetMinX(self.sourceView.frame), CGRectGetMaxY(self.sourceView.frame) - self.viewHeight - self.sourceView.frame.size.height, self.sourceView.frame.size.width, self.viewHeight); &#125; break; case WDComboBoxControlDirectionLeading:&#123; self.tableView.frame &#x3D; CGRectMake(CGRectGetMinX(self.sourceView.frame) - self.sourceView.frame.size.width, CGRectGetMinY(self.sourceView.frame), self.sourceView.frame.size.width, self.viewHeight); &#125; break; case WDComboBoxControlDirectionTrailing:&#123; self.tableView.frame &#x3D; CGRectMake(CGRectGetMinX(self.sourceView.frame) + self.sourceView.frame.size.width, CGRectGetMinY(self.sourceView.frame), self.sourceView.frame.size.width, self.viewHeight); &#125; break; default: break; &#125; &#125;#pragma mark &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; UITableViewDelegate, UITableViewDataSource &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;- (NSString *)tableView:(UITableView *)tableView titleForHeaderInSection:(NSInteger)section &#123; return self.titleArray[section];&#125;- (NSInteger)numberOfSectionsInTableView:(UITableView *)tableView &#123; return self.dataArray.count;&#125;- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section &#123; return [self.dataArray[section] count];&#125;- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath &#123; UITableViewCell *cell &#x3D; [tableView dequeueReusableCellWithIdentifier:@&quot;cell&quot;]; if (!cell) &#123; cell &#x3D; [[UITableViewCell alloc] initWithStyle:UITableViewCellStyleDefault reuseIdentifier:@&quot;cell&quot;]; &#125; cell.textLabel.text &#x3D; self.dataArray[indexPath.section][indexPath.row]; cell.textLabel.numberOfLines &#x3D; 0; return cell;&#125;- (void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath &#123; if (self.delegate &amp;&amp; [self.delegate respondsToSelector:@selector(selectedAtIndexPath:resultTitle: fromSourceView:)]) &#123; [self.delegate selectedAtIndexPath:indexPath resultTitle:self.dataArray[indexPath.section][indexPath.row] fromSourceView:self.sourceView]; [self dismisssView]; &#125;&#125;@end 3ã€ä½¿ç”¨æ–¹æ³• 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374&#x2F;&#x2F; 1ã€å¯¼å…¥å¤´æ–‡ä»¶#import &quot;WDComboBoxControl.h&quot;&#x2F;&#x2F; 2ã€éµå¾ªä»£ç†å’Œæ•°æ®æº&lt;WDComboBoxControlDataSource, WDComboBoxControlDelegate&gt;&#x2F;&#x2F; 3ã€å®ç°æ–¹æ³•#pragma mark &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; WDComBoxControlDataSource &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;- (NSArray&lt;NSString *&gt; *)titleOfSection;- (NSArray&lt;NSArray&lt;NSString *&gt; *&gt; *)dataSourceOfColunm;#pragma mark &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; WDComBoxControlDelegate &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;- (void)selectedAtIndexPath:(NSIndexPath *)indexPath resultTitle:(NSString *)title fromSourceView:(UIView *)sourceView;&#x2F;&#x2F; ä¸‹é¢æ˜¯å®ä¾‹ï¼š@property (nonatomic, strong) UIButton *button;@property (nonatomic, strong) UIButton *button2;- (void)viewDidLoad &#123; [super viewDidLoad]; &#x2F;&#x2F; Do any additional setup after loading the view. UIButton *button &#x3D; [[UIButton alloc] init]; [button setTitleColor:UIColor.blackColor forState:UIControlStateNormal]; [button addTarget:self action:@selector(buttonShow:) forControlEvents:UIControlEventTouchUpInside]; [self.view addSubview:button]; button.layer.borderColor &#x3D; UIColor.lightGrayColor.CGColor; button.layer.borderWidth &#x3D; 0.5; [button setTitle:@&quot;æŒ‰é’®&quot; forState:UIControlStateNormal]; [button mas_makeConstraints:^(MASConstraintMaker *make) &#123; make.centerX.mas_equalTo(self.view); make.top.mas_equalTo(self.wdNavigationBar.mas_bottom); make.width.mas_equalTo(300); &#125;]; self.button &#x3D; button; UIButton *button2 &#x3D; [[UIButton alloc] init]; [button2 setTitleColor:UIColor.blackColor forState:UIControlStateNormal]; [button2 addTarget:self action:@selector(buttonShow:) forControlEvents:UIControlEventTouchUpInside]; [self.view addSubview:button2]; button2.layer.borderColor &#x3D; UIColor.lightGrayColor.CGColor; button2.layer.borderWidth &#x3D; 0.5; [button2 setTitle:@&quot;æŒ‰é’®2&quot; forState:UIControlStateNormal]; button2.bounds &#x3D; CGRectMake(0, 0, 300, 50); button2.center &#x3D; self.view.center; self.button2 &#x3D; button2;&#125;- (void)buttonShow:(UIButton *)sender &#123; WDComboBoxControl *view &#x3D; [[WDComboBoxControl alloc] initViewWithMaxHeight:400 fromView:sender showDirection:WDComboBoxControlDirectionBottom]; view.dataSource &#x3D; self; view.delegate &#x3D; self; view.backgroundButton.backgroundColor &#x3D; [UIColor colorWithWhite:0 alpha:0.3]; [view showInView];&#125;#pragma mark &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; WDComBoxControlDataSource &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;- (NSArray&lt;NSString *&gt; *)titleOfSection &#123; return @[@&quot;å®‰å¾½çœ&quot;, @&quot;æµ™æ±Ÿçœ&quot;, @&quot;æ±Ÿè‹çœ&quot;, @&quot;å®‰å¾½çœ&quot;, @&quot;æµ™æ±Ÿçœ&quot;, @&quot;æ±Ÿè‹çœ&quot;];&#125;- (NSArray&lt;NSArray&lt;NSString *&gt; *&gt; *)dataSourceOfColunm &#123; return @[@[@&quot;åˆè‚¥&quot;, @&quot;èŠœæ¹–&quot;, @&quot;å®‰åº†&quot;], @[@&quot;å—äº¬&quot;, @&quot;è‹å·&quot;, @&quot;æ— é”¡&quot;], @[@&quot;æ­å·&quot;, @&quot;å®æ³¢&quot;, @&quot;æ¸©å·&quot;], @[@&quot;åˆè‚¥&quot;, @&quot;èŠœæ¹–&quot;, @&quot;å®‰åº†&quot;], @[@&quot;å—äº¬&quot;, @&quot;è‹å·&quot;, @&quot;æ— é”¡&quot;], @[@&quot;æ­å·&quot;, @&quot;å®æ³¢&quot;, @&quot;æ¸©å·&quot;]];&#125;#pragma mark &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; WDComBoxControlDelegate &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;- (void)selectedAtIndexPath:(NSIndexPath *)indexPath resultTitle:(NSString *)title fromSourceView:(UIView *)sourceView &#123; UIButton *sender &#x3D; (UIButton *)sourceView; [sender setTitle:title forState:UIControlStateNormal];&#125; 4ã€æ•ˆæœå›¾ 5ã€Demoåœ°å€ï¼ˆä»£ç éƒ½åœ¨è¿™é‡Œäº†ï¼Œå°±ä¸å¼„ä¸ªDemoäº†ï¼Œè¿™ä¸ªå¯ä»¥è‡ªå®šä¹‰çš„åœ°æ–¹è¿˜æœ‰å¾ˆå¤šï¼ŒTableViewå’ŒèƒŒæ™¯çš„Buttonéƒ½å¯ä»¥ï¼Œéšå¿ƒæ‰€æ¬²å§ï¼ï¼‰","categories":[{"name":"Objective-C","slug":"Objective-C","permalink":"https://github.com/wuvdan/wuvdan.github.io/categories/Objective-C/"}],"tags":[{"name":"è‡ªå®šä¹‰æ§ä»¶","slug":"è‡ªå®šä¹‰æ§ä»¶","permalink":"https://github.com/wuvdan/wuvdan.github.io/tags/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6/"}]},{"title":"iOSè‡ªå®šä¹‰æ§ä»¶-å›¾ç‰‡æµè§ˆå™¨","slug":"iOSè‡ªå®šä¹‰æ§ä»¶-å›¾ç‰‡æµè§ˆå™¨","date":"2020-01-16T08:06:32.455Z","updated":"2020-01-20T02:15:04.551Z","comments":true,"path":"2020/01/16/iOSè‡ªå®šä¹‰æ§ä»¶-å›¾ç‰‡æµè§ˆå™¨/","link":"","permalink":"https://github.com/wuvdan/wuvdan.github.io/2020/01/16/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-%E5%9B%BE%E7%89%87%E6%B5%8F%E8%A7%88%E5%99%A8/","excerpt":"","text":"ä¸€ç›´æƒ³å†™ä¸€ä¸ªè‡ªå·±çš„å›¾ç‰‡æµè§ˆå™¨ï¼Œä½†æ˜¯è‡ªå·±èƒ½åŠ›åˆä¸æ˜¯å¾ˆå¤Ÿï¼Œæ‰€ä»¥ä¸€ç›´æ‹–è¿™ï¼Œæœ€è¿‘è¶è‡ªå·±æ—¶é—´å……è£•ï¼Œè‡ªå·±ç ”ç©¶äº†ä¸€ä¸‹è¿™æ–¹é¢çš„çŸ¥è¯†ã€‚æ„Ÿè§‰æœ‰ä»¥ä¸‹å‡ ä¸ªéš¾ç‚¹ï¼š æ˜¾ç¤ºå’Œæ¶ˆå¤±çš„è½¬åœºåŠ¨ç”» æ‰‹åŠ¿æ‹–æ‹½ å›¾ç‰‡åŠ è½½ åŠ è½½æ–¹å¼å’Œè½¬åœºåŠ¨ç”» é€šè¿‡ControlleråŠ è½½ï¼šéœ€è¦ä½¿ç”¨ViewControllerå®ç°UIViewControllerAnimatedTransitioningå®ç°è½¬åœºæ•ˆæœ é€šè¿‡ViewåŠ è½½ï¼šä½¿ç”¨UIViewåŠ¨ç”»è¯•ä¸‹è½¬åœºæ•ˆæœ è½¬åœºåŠ¨ç”»å¿…è¦å…ƒç´  æ˜¾ç¤ºæ—¶éœ€è¦fromViewçš„frame æ¶ˆå¤±æ—¶éœ€è¦toViewçš„frameæ˜¾ç¤ºé€šè¿‡ä¿®æ”¹å½“å‰éœ€è¦æ˜¾ç¤ºå›¾ç‰‡çš„CollectionViewCellä¸­ImageViewçš„frameï¼ŒåŒæ—¶ä¿®æ”¹å½“æœŸViewçš„èƒŒæ™¯é¢œè‰²é€æ˜åº¦1234567WDImageCollectionViewCell *cell &#x3D; (WDImageCollectionViewCell *)[self.collectionView cellForItemAtIndexPath:[NSIndexPath indexPathForRow:self.tappedIndex inSection:0]];CGRect fromFrame &#x3D; [self.originView convertRect:self.originView.bounds toView:cell.contentView];cell.imageView.frame &#x3D; fromFrame;[UIView animateWithDuration:0.5 animations:^&#123; self.backgroundColor &#x3D; [[UIColor alloc] initWithWhite:0 alpha:1]; cell.imageView.frame &#x3D; cell.contentView.bounds;&#125;]; æ¶ˆå¤±åŸç†ä¸æ˜¾ç¤ºç›¸åŒ12345678CGRect toRect &#x3D; [self.originView convertRect:self.originView.bounds toView:self.window];[UIView animateWithDuration:0.5 animations:^&#123; cell.imageView.clipsToBounds &#x3D; YES; cell.imageView.frame &#x3D; toRect; self.backgroundColor &#x3D; [[UIColor alloc] initWithWhite:0 alpha:0];&#125; completion:^(BOOL finished) &#123; [self removeFromSuperview];&#125;]; æ‹–æ‹½çš„æ‰‹åŠ¿å°†æ‰‹åŠ¿æ·»åŠ åœ¨CollectionViewCellä¸­ScrollViewä¸Šï¼Œå¹¶éµå¾ªUIGestureRecognizerDelegateåè®®ï¼Œä¸ç„¶ä¼šCollectionViewæ— æ³•è¿›è¡Œæ»šåŠ¨æ“ä½œã€‚ å£°æ˜ä¸€ä¸ªå…¨å±€å±æ€§1CGPoint firstTouchPoint; å®ç°ä»£ç†123456789101112131415161718#pragma mark - UIGestureRecognizer Delegate Method- (BOOL)gestureRecognizer:(UIGestureRecognizer *)gestureRecognizer shouldReceiveTouch:(UITouch *)touch &#123; firstTouchPoint &#x3D; [touch locationInView:self.window]; return YES;&#125;- (BOOL)gestureRecognizerShouldBegin:(UIGestureRecognizer *)gestureRecognizer &#123; CGPoint touchPoint &#x3D; [gestureRecognizer locationInView:self.window]; CGFloat dirTop &#x3D; firstTouchPoint.y - touchPoint.y; if (dirTop &gt; -10 &amp;&amp; dirTop &lt; 10) &#123; return NO; &#125; CGFloat dirLift &#x3D; firstTouchPoint.x - touchPoint.x; if (dirLift &gt; -10 &amp;&amp; dirLift &lt; 10 &amp;&amp; self.scrollView.frame.size.height &gt; [[UIScreen mainScreen] bounds].size.height) &#123; return NO; &#125; return YES;&#125; æ‹–åŠ¨æ‰‹åŠ¿æ“ä½œï¼ŒåŒæ„ä»£ç†ä¼ ç»™View åè®®æ–¹æ³•123456@class WDImageCollectionViewCell;@protocol WDImageCollectionViewCellDelegate &lt;NSObject&gt;- (void)collectionViewCell:(WDImageCollectionViewCell *)cell singleTapActionWithImageUrl:(NSString *)imageUrl;- (void)collectionViewCell:(WDImageCollectionViewCell *)cell panActionWithPercent:(CGFloat)percent;- (void)collectionViewCell:(WDImageCollectionViewCell *)cell dimssViewWithImageUrl:(NSString *)imageUrl;@end æ‹–åŠ¨æ‰‹åŠ¿æ–¹æ³•12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758#pragma mark - UIGestureRecognizer Target Event&#x2F;** æ»‘åŠ¨æ‰‹åŠ¿ *&#x2F;- (void)didRecognizedPanGuesture:(UIPanGestureRecognizer *)pan &#123; CGPoint point &#x3D; [pan translationInView:self.window]; CGFloat scale &#x3D; 1.0 - ABS(point.y) &#x2F; [[UIScreen mainScreen] bounds].size.height; switch (pan.state) &#123; case UIGestureRecognizerStateBegan: &#123;&#125; break; case UIGestureRecognizerStateChanged: &#123; scale &#x3D; MAX(scale, 0); CGFloat s &#x3D; MAX(scale, 0.5); CGAffineTransform translation &#x3D; CGAffineTransformMakeTranslation(point.x &#x2F; s, point.y &#x2F; s); CGAffineTransform translationScale &#x3D; CGAffineTransformMakeScale(s, s); self.imageView.transform &#x3D; CGAffineTransformConcat(translation, translationScale); &#x2F;&#x2F; ä¼ å‡ºtranslationScaleï¼Œä¿®æ”¹èƒŒæ™¯é¢œè‰²é€æ˜åº¦ if (self.delegate &amp;&amp; [self.delegate respondsToSelector:@selector(collectionViewCell:panActionWithPercent:)]) &#123; [self.delegate collectionViewCell:self panActionWithPercent:scale]; &#125; &#125; break; case UIGestureRecognizerStateCancelled | UIGestureRecognizerStateFailed: &#123; self.imageView.transform &#x3D; CGAffineTransformIdentity; &#x2F;&#x2F; å›å¤åˆå§‹æ ·å¼ï¼Œä¼ å‡ºtranslationScaleï¼Œä¿®æ”¹èƒŒæ™¯é¢œè‰²é€æ˜åº¦ if (self.delegate &amp;&amp; [self.delegate respondsToSelector:@selector(collectionViewCell:panActionWithPercent:)]) &#123; [self.delegate collectionViewCell:self panActionWithPercent:1]; &#125; &#125; break; case UIGestureRecognizerStateEnded: &#123; [UIView animateWithDuration:0.5 animations:^&#123; CGAffineTransform transform1 &#x3D; CGAffineTransformMakeTranslation(0,0); self.imageView.transform &#x3D; CGAffineTransformScale(transform1, 1, 1); &#125;]; &#x2F;&#x2F; å›å¤åˆå§‹æ ·å¼ï¼Œä¼ å‡ºtranslationScaleï¼Œä¿®æ”¹èƒŒæ™¯é¢œè‰²é€æ˜åº¦ if (self.delegate &amp;&amp; [self.delegate respondsToSelector:@selector(collectionViewCell:panActionWithPercent:)]) &#123; [self.delegate collectionViewCell:self panActionWithPercent:scale]; &#125; if (scale &lt; 0.7) &#123; &#x2F;&#x2F; æ‹–åŠ¨ç»“æŸï¼Œè®©é¡µé¢æ¶ˆå¤± if (self.delegate &amp;&amp; [self.delegate respondsToSelector:@selector(collectionViewCell:dimssViewWithImageUrl:)]) &#123; [self.delegate collectionViewCell:self dimssViewWithImageUrl:self.imageUrl]; &#125; &#125; else &#123; &#x2F;&#x2F; å›å¤åˆå§‹æ ·å¼ï¼Œä¼ å‡ºtranslationScaleï¼Œä¿®æ”¹èƒŒæ™¯é¢œè‰²é€æ˜åº¦ if (self.delegate &amp;&amp; [self.delegate respondsToSelector:@selector(collectionViewCell:panActionWithPercent:)]) &#123; [self.delegate collectionViewCell:self panActionWithPercent:1]; &#125; &#125; &#125; break; default: break; &#125;&#125; å›¾ç‰‡åŠ è½½ä½¿ç”¨SDWebImageè·å–å›¾ç‰‡ï¼Œé€šè¿‡FLAnimatedImageViewåŠ è½½gifå›¾Githubåœ°å€é¡¹ç›®åœ°å€æ•ˆæœå›¾","categories":[{"name":"Objective-C","slug":"Objective-C","permalink":"https://github.com/wuvdan/wuvdan.github.io/categories/Objective-C/"}],"tags":[{"name":"è‡ªå®šä¹‰æ§ä»¶","slug":"è‡ªå®šä¹‰æ§ä»¶","permalink":"https://github.com/wuvdan/wuvdan.github.io/tags/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6/"}]},{"title":"iOSè‡ªå®šä¹‰æ§ä»¶-æé†’æ¡","slug":"iOSè‡ªå®šä¹‰æ§ä»¶-æé†’æ¡","date":"2020-01-16T08:06:28.698Z","updated":"2020-01-20T02:16:12.571Z","comments":true,"path":"2020/01/16/iOSè‡ªå®šä¹‰æ§ä»¶-æé†’æ¡/","link":"","permalink":"https://github.com/wuvdan/wuvdan.github.io/2020/01/16/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-%E6%8F%90%E9%86%92%E6%9D%A1/","excerpt":"","text":"ç®€å•çš„æé†’æ¡ï¼Œä»£ç æ¯”è¾ƒç®€å•ï¼Œä½¿ç”¨å®¹æ˜“ï¼Œä»£ç ä¸­ç›®å‰æä¾›äº†ä¸‰ç§æ˜¾ç¤ºçš„é¢œè‰²ï¼Œé»˜è®¤æ˜¾ç¤ºæ–‡æœ¬å†…å®¹ä¸ºä¸€è¡Œæ–‡å­—ï¼Œé»˜è®¤é«˜åº¦ä¸º20ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±éœ€æ±‚è‡ªå®šä¹‰æ ·å¼ã€‚ä»£ç åŒæ—¶æ”¯æŒObjective-Cå’ŒSwiftï¼Œä½¿ç”¨æ–¹å¼æœ‰ç‚¹ç‚¹å·®åˆ«ï¼Œè¯¦æƒ…çœ‹ä»£ç ã€‚ æ¥å£æ–‡ä»¶123456789101112131415161718192021222324252627282930313233343536#import &lt;UIKit&#x2F;UIKit.h&gt;NS_ASSUME_NONNULL_BEGINtypedef NS_ENUM(NSInteger, RemindBarStyle) &#123; RemindBarStyleInfo, &#x2F;&#x2F; æé†’ â‡ï¸ RemindBarStyleWarn, &#x2F;&#x2F; è­¦å‘Š âš ï¸ RemindBarStyleError &#x2F;&#x2F; é”™è¯¯ âŒ&#125;;typedef NS_ENUM(NSInteger, RemindBarPosition) &#123; RemindBarPositionStatusBar, &#x2F;&#x2F; çŠ¶æ€æ ä¸‹é¢ RemindBarPositionNavigationBar, &#x2F;&#x2F; å¯¼èˆªæ ä¸‹é¢&#125;;@interface LZRemindBar : UIView&#x2F;** é…ç½®æ˜¾ç¤ºæ ·å¼ @param style æ ·å¼ @param position ä½ç½® @param text å†…å®¹ @return return value description *&#x2F;+ (LZRemindBar *)configurationWithStyle:(RemindBarStyle)style showPosition:(RemindBarPosition)position contentText:(NSString *)text;&#x2F;** æ˜¾ç¤º å¹¶è®¾ç½®æ˜¾ç¤ºæ—¶é—´ @param interval æ˜¾ç¤ºæ—¶é—´ *&#x2F;- (void)showBarAfterTimeInterval:(NSTimeInterval)interval;@endNS_ASSUME_NONNULL_END å®ç°æ–‡ä»¶123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122#import &quot;LZRemindBar.h&quot;#define bar_IsPhoneX UIApplication.sharedApplication.statusBarFrame.size.height !&#x3D; 20#define bar_topInterval bar_IsPhoneX ? UIApplication.sharedApplication.statusBarFrame.size.height : 0@interface LZRemindBar ()@property (nonatomic, strong) UILabel *contentLabel; &#x2F;&#x2F;*! æ–‡å­—Label@property (nonatomic, assign) RemindBarPosition position; &#x2F;&#x2F;*! æ˜¾ç¤ºä½ç½®@property (nonatomic, assign) BOOL isShowing; &#x2F;&#x2F;*! æ˜¯å¦æ­£åœ¨æ˜¾ç¤º@end@implementation LZRemindBar+ (instancetype)remind &#123; static dispatch_once_t onceToken; static LZRemindBar *remind; dispatch_once(&amp;onceToken, ^&#123; remind &#x3D; [[LZRemindBar alloc] init]; &#125;); return remind;&#125;+ (LZRemindBar *)configurationWithStyle:(RemindBarStyle)style showPosition:(RemindBarPosition)position contentText:(NSString *)text &#123; if ([LZRemindBar remind].isShowing) &#123; return [LZRemindBar remind]; &#125; [LZRemindBar remind].contentLabel &#x3D; (&#123; UILabel *label &#x3D; [[UILabel alloc] init]; label.backgroundColor &#x3D; UIColor.clearColor; label.numberOfLines &#x3D; 1; label.textAlignment &#x3D; NSTextAlignmentCenter; label.font &#x3D; [UIFont systemFontOfSize:13]; label.textColor &#x3D; UIColor.whiteColor; [[LZRemindBar remind] addSubview:label]; label.translatesAutoresizingMaskIntoConstraints &#x3D; false; [[label.leadingAnchor constraintEqualToAnchor:[LZRemindBar remind].leadingAnchor] setActive:true]; [[label.trailingAnchor constraintEqualToAnchor:[LZRemindBar remind].trailingAnchor] setActive:true]; [[label.topAnchor constraintEqualToAnchor:[LZRemindBar remind].topAnchor] setActive:true]; [[label.bottomAnchor constraintEqualToAnchor:[LZRemindBar remind].bottomAnchor] setActive:true]; label.text &#x3D; text; label; &#125;); [LZRemindBar remind].isShowing &#x3D; true; [LZRemindBar remind].position &#x3D; position; switch (style) &#123; case RemindBarStyleInfo: [LZRemindBar remind].backgroundColor &#x3D; [UIColor colorWithRed:0 green:166.0&#x2F;255 blue:124.0&#x2F;255 alpha:1]; break; case RemindBarStyleWarn: [LZRemindBar remind].backgroundColor &#x3D; UIColor.orangeColor; break; case RemindBarStyleError: [LZRemindBar remind].backgroundColor &#x3D; UIColor.redColor; break; default: break; &#125; if (position &#x3D;&#x3D; RemindBarPositionStatusBar) &#123; [[LZRemindBar remind] setupShowStatusBarBottomWithStutus:true]; &#125; else &#123; [[LZRemindBar remind] setupShowNavigationBarBottomWithStutus:true]; &#125; return [LZRemindBar remind];&#125;- (void)setupShowStatusBarBottomWithStutus:(BOOL)show &#123; if (show) &#123; UIApplication.sharedApplication.delegate.window.windowLevel &#x3D; bar_IsPhoneX ? UIWindowLevelNormal : UIWindowLevelAlert; self.frame &#x3D; CGRectMake(0, bar_topInterval, UIScreen.mainScreen.bounds.size.width, 0); [UIView animateWithDuration:0.5 animations:^&#123; self.frame &#x3D; CGRectMake(0, bar_topInterval, UIScreen.mainScreen.bounds.size.width, 20); &#125;]; &#125; else &#123; [UIView animateWithDuration:0.5 animations:^&#123; self.frame &#x3D; CGRectMake(0, bar_topInterval, UIScreen.mainScreen.bounds.size.width, 0); &#125; completion:^(BOOL finished) &#123; UIApplication.sharedApplication.delegate.window.windowLevel &#x3D; UIWindowLevelNormal; [self dismissBar]; &#125;]; &#125;&#125;- (void)setupShowNavigationBarBottomWithStutus:(BOOL)show &#123; if (show) &#123; self.frame &#x3D; CGRectMake(0, UIApplication.sharedApplication.statusBarFrame.size.height + 44, UIScreen.mainScreen.bounds.size.width, 0); [UIView animateWithDuration:0.5 animations:^&#123; self.frame &#x3D; CGRectMake(0, UIApplication.sharedApplication.statusBarFrame.size.height + 44, UIScreen.mainScreen.bounds.size.width, 20); &#125;]; &#125; else &#123; [UIView animateWithDuration:0.5 animations:^&#123; self.frame &#x3D; CGRectMake(0, UIApplication.sharedApplication.statusBarFrame.size.height + 44, UIScreen.mainScreen.bounds.size.width, 0); &#125; completion:^(BOOL finished) &#123; [self dismissBar]; &#125;]; &#125;&#125;- (void)showBarAfterTimeInterval:(NSTimeInterval)interval &#123; [UIApplication.sharedApplication.delegate.window addSubview:self]; dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(interval * NSEC_PER_SEC)), dispatch_get_main_queue(), ^&#123; if (self.position &#x3D;&#x3D; RemindBarPositionStatusBar) &#123; [self setupShowStatusBarBottomWithStutus:false]; &#125; else &#123; [self setupShowNavigationBarBottomWithStutus:false]; &#125; &#125;);&#125;- (void)dismissBar &#123; self.isShowing &#x3D; false; [self.contentLabel removeFromSuperview]; [self removeFromSuperview];&#125;@end ä½¿ç”¨æ–¹æ³•123456789&#x2F;&#x2F; å‚æ•°RemindBarStyleï¼š æ˜¾ç¤ºæ ·å¼&#x2F;&#x2F; å‚æ•°RemindBarPosition: æ˜¾ç¤ºä½ç½® &#x2F;&#x2F; å‚æ•°contentText: æ˜¾ç¤ºæ–‡å­—å†…å®¹ &#x2F;&#x2F; intervalï¼šæ˜¾ç¤ºæ—¶é—´&#x2F;&#x2F; Objc[[LZRemindBar configurationWithStyle:RemindBarStyleInfo showPosition:RemindBarPositionStatusBar contentText:@&quot;è¿™æ˜¯ä¸€ä¸ªæç¤º&quot;] showBarAfterTimeInterval:1.2];&#x2F;&#x2F; SwiftLZRemindBar.configuration(with: .info, show: .statusBar, contentText: &quot;æç¤ºæ–‡å­—&quot;).show(afterTimeInterval: 1.2) æ•ˆæœå›¾","categories":[{"name":"Objective-C","slug":"Objective-C","permalink":"https://github.com/wuvdan/wuvdan.github.io/categories/Objective-C/"}],"tags":[{"name":"è‡ªå®šä¹‰æ§ä»¶","slug":"è‡ªå®šä¹‰æ§ä»¶","permalink":"https://github.com/wuvdan/wuvdan.github.io/tags/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6/"}]},{"title":"iOSè‡ªå®šä¹‰æ§ä»¶-å¼€å±å¹¿å‘Š","slug":"iOSè‡ªå®šä¹‰æ§ä»¶-å¼€å±å¹¿å‘Š","date":"2020-01-16T08:06:22.600Z","updated":"2020-01-20T02:20:51.987Z","comments":true,"path":"2020/01/16/iOSè‡ªå®šä¹‰æ§ä»¶-å¼€å±å¹¿å‘Š/","link":"","permalink":"https://github.com/wuvdan/wuvdan.github.io/2020/01/16/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-%E5%BC%80%E5%B1%8F%E5%B9%BF%E5%91%8A/","excerpt":"","text":"å¾ˆä¹…æ²¡æœ‰å»å†™åšå®¢äº†ï¼Œæœ€è¿‘ç”±äºå…¬å¸éœ€æ±‚å˜åŒ–ï¼Œéœ€è¦åšä¸€ä¸ªæ–°çš„å¼€å±å¹¿å‘Šçš„é¡µé¢ï¼Œæ‰€ä»¥æˆ‘å°±ç®€å•çš„å»ç ”ç©¶äº†ä¸€ä¸‹ã€‚å…¶ä¸­æ˜¾ç¤ºåˆ†ä¸ºè§†é¢‘å’Œå›¾ç‰‡ï¼Œå…¶ä¸­å›¾ç‰‡ç›¸æ¯”è€Œè¨€å®ç°èµ·æ¥å°±ç®€å•çš„å¤šäº†ã€‚ å›¾ç‰‡åŠ è½½å¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„åŠ è½½å’Œç¼“å­˜ï¼Œä¾‹å¦‚ï¼šSDWebImageæˆ–è€…Kingfisherã€‚å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ç³»ç»Ÿçš„URLSessionä¸‹è½½åˆ°æœ¬åœ°å†è¿›è¡Œè¯»å–åŠ è½½ã€‚ è§†é¢‘åŠ è½½æˆ‘è¿™è¾¹åˆ©ç”¨çš„å°±URLSessionçš„downloadTaskè¿›è¡Œä¸‹è½½åˆ°æœ¬åœ°å†è¿›è¡Œæ’­æ”¾çš„ã€‚ è§†é¢‘ä¸‹è½½çš„ä»£ç 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131import UIKit&#x2F;&#x2F;&#x2F; ä¿å­˜URLåœ°å€è¿›è¡ŒåŒ¹é…fileprivate let kURL_DOWNLOAD_PATH &#x3D; &quot;WDDownloadUrlPath&quot;&#x2F;&#x2F;&#x2F; ä¿å­˜è·¯å¾„fileprivate let kDOCUMENTS_PATH &#x3D; NSHomeDirectory() + &quot;&#x2F;Documents&#x2F;Advertisement.mp4&quot;fileprivate class UserDefaultsTools &#123; &#x2F;&#x2F; è®¾ç½®åœ°å€ static func wd_set(value: String) &#123; UserDefaults.standard.setValue(value, forKey: kURL_DOWNLOAD_PATH) &#125; &#x2F;&#x2F; è¯»å–åœ°å€ static func wd_get() -&gt; String &#123; return UserDefaults.standard.object(forKey: kURL_DOWNLOAD_PATH) as? String ?? &quot;&quot; &#125;&#125;fileprivate class FileManagerTools &#123; &#x2F;&#x2F; æ˜¯å¦å­˜åœ¨æ–‡ä»¶ static func isExistFile(atPath: String) -&gt; Bool &#123; return FileManager.default.fileExists(atPath: atPath) &#125; &#x2F;&#x2F; ç§»åŠ¨æ–‡ä»¶ static func moveFile(fromPath: String, toPath: String) &#123; try! FileManager.default.moveItem(atPath: fromPath, toPath: toPath) &#125; &#x2F;&#x2F; åˆ é™¤æ–‡ä»¶ static func deleteFile(atPath: String) &#123; try! FileManager.default.removeItem(atPath: atPath) &#125; &#x2F;&#x2F; æ–‡ä»¶å¤§å° static func fileSize(atPath: String) -&gt; Float &#123; if self.isExistFile(atPath: kDOCUMENTS_PATH) &#123; let attributes &#x3D; try! FileManager.default.attributesOfItem(atPath: atPath) let size &#x3D; attributes[FileAttributeKey.size] as! Int return Float(size) &#125; return 0 &#125;&#125;class WDLaunchADDownloader: NSObject &#123; &#x2F;&#x2F;&#x2F; ä¸‹è½½è§†é¢‘çš„è·¯å¾„ private var downloadUrlPath: String &#x3D; &quot;&quot; &#x2F;&#x2F;&#x2F; ä¸‹è½½çš„Session private var session: URLSession! &#x2F;&#x2F;&#x2F; ä¸‹è½½çš„ä»»åŠ¡ private var downloadTask: URLSessionDownloadTask! &#x2F;&#x2F;&#x2F; è®°å½•æ˜¯å¦åœ¨ä¸‹è½½ private var downloading: Bool &#x3D; false &#x2F;&#x2F;&#x2F; è®°å½•å·²ä¸‹è½½çš„æ•°æ® private var downloadData: Data? &#x2F;* ä¸‹è½½è§†é¢‘ *&#x2F; static func downloadVideo(path: String) -&gt; String &#123; let downloader &#x3D; WDLaunchADDownloader() return downloader.setupDownload(with: path) &#125; private func setupDownload(with path: String) -&gt; String &#123; downloadUrlPath &#x3D; path &#x2F;&#x2F; è·å–è§†é¢‘æ’­æ”¾ç½‘ç»œè·¯å¾„ let configuration &#x3D; URLSessionConfiguration.default configuration.isDiscretionary &#x3D; true session &#x3D; URLSession(configuration: configuration, delegate: self, delegateQueue: nil) let request &#x3D; URLRequest.init(url: URL(string: path)!) downloadTask &#x3D; session.downloadTask(with: request) &#x2F;&#x2F; ç½‘å€ä¸åŒï¼Œåˆ é™¤åŸæœ¬çš„ï¼Œä¸‹è½½æœ€æ–°çš„ if UserDefaultsTools.wd_get() !&#x3D; path &#123; UserDefaultsTools.wd_set(value: &quot;&quot;) if FileManagerTools.isExistFile(atPath: kDOCUMENTS_PATH) &#123; FileManagerTools.deleteFile(atPath: kDOCUMENTS_PATH) &#125; &#x2F;&#x2F; å¼€å§‹ä¸‹è½½ startDownload() &#125; &#x2F;&#x2F; å¦‚æœå·²å­˜åœ¨æ–‡ä»¶ å°±åŠ è½½è§†é¢‘ å¦åˆ™åŠ è½½å›¾ç‰‡ if FileManagerTools.isExistFile(atPath: kDOCUMENTS_PATH) &#123; return kDOCUMENTS_PATH &#125; else &#123; return &quot;&quot; &#125; &#125; &#x2F;&#x2F; MARK: - å¼€å§‹ä¸‹è½½ private func startDownload() &#123; downloading &#x3D; true downloadTask.resume() &#125; &#x2F;&#x2F; MARK: - æš‚åœä¸‹è½½ private func pauseDownload() &#123; downloadTask.cancel &#123; [weak self] (resumeData) in self?.downloadData &#x3D; resumeData &#125; downloading &#x3D; false &#125;&#125;extension WDLaunchADDownloader: URLSessionDownloadDelegate &#123; &#x2F;&#x2F; ä¸‹è½½ä»£ç†æ–¹æ³•ï¼Œä¸‹è½½ç»“æŸ func urlSession(_ session: URLSession, downloadTask: URLSessionDownloadTask, didFinishDownloadingTo location: URL) &#123; let locationPath &#x3D; location.path FileManagerTools.moveFile(fromPath: locationPath, toPath: kDOCUMENTS_PATH) UserDefaultsTools.wd_set(value: downloadUrlPath) &#125; &#x2F;&#x2F; ä¸‹è½½ä»£ç†æ–¹æ³•ï¼Œç›‘å¬ä¸‹è½½è¿›åº¦ func urlSession(_ session: URLSession, downloadTask: URLSessionDownloadTask, didWriteData bytesWritten: Int64, totalBytesWritten: Int64, totalBytesExpectedToWrite: Int64) &#123; if FileManagerTools.fileSize(atPath: kDOCUMENTS_PATH) &gt;&#x3D; Float(totalBytesExpectedToWrite) &#123; pauseDownload() return &#125; print(String(format: &quot;ğŸ‰ Advertising Video Download Progress: %0.2f&quot;, Float(totalBytesWritten) &#x2F; Float(totalBytesExpectedToWrite))) &#125; &#x2F;&#x2F; å¦‚æœä¸‹è½½å¤±è´¥äº† func urlSession(_ session: URLSession, task: URLSessionTask, didCompleteWithError error: Error?) &#123; if error !&#x3D; nil &#123; UserDefaultsTools.wd_set(value: &quot;&quot;) &#125; &#125;&#125; è§†é¢‘æ’­æ”¾ä»£ç å…¶ä¸­è·å–åˆ°åŠ è½½çš„ç§ç±»(å›¾ç‰‡ã€è§†é¢‘)ï¼Œé¡µé¢è¿›è¡Œç›¸åº”çš„å¸ƒå±€ 123456789101112131415161718192021222324252627import UIKitimport AVFoundationclass WDLaunchADPlayerManager: NSObject &#123; static let share &#x3D; WDLaunchADPlayerManager() var playerItem: AVPlayerItem! var player: AVPlayer! var playerLayer: CALayer! &#x2F;&#x2F; å¼€å§‹æ’­æ”¾ &lt;æ’­æ”¾ä¸‹è½½å¥½å†æœ¬åœ°æ–‡ä»¶å¤¹é‡Œé¢çš„è§†é¢‘æ–‡ä»¶&gt; func playItem(with url: String) &#123; playerItem &#x3D; AVPlayerItem(url: URL(fileURLWithPath: url)) player &#x3D; AVPlayer(playerItem: playerItem) playerLayer &#x3D; AVPlayerLayer(player: player) player.usesExternalPlaybackWhileExternalScreenIsActive &#x3D; true player.play() player.volume &#x3D; 0 &#x2F;&#x2F; é™éŸ³æ’­æ”¾ &#125; &#x2F;&#x2F; åœæ­¢æ’­æ”¾ func stopPlay() &#123; player.pause() player &#x3D; nil &#125;&#125; é¡µé¢æ˜¾ç¤º12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364import UIKitimport SDWebImageclass WDLaunchADController: UIViewController &#123; &#x2F;&#x2F;&#x2F; æ’­æ”¾å™¨çš„layerå±‚ private var playerLayer: CALayer &#x3D; CALayer() &#x2F;&#x2F;&#x2F; å›¾ç‰‡åŠ è½½ private let imageView: UIImageView &#x3D; &#123; let imageV &#x3D; UIImageView() imageV.contentMode &#x3D; .scaleAspectFill imageV.clipsToBounds &#x3D; true return imageV &#125;() deinit &#123; print(&quot;&#x3D;&#x3D;[\\(type(of: self))] deinit&#x3D;&#x3D;&quot;) &#125; override func viewDidLoad() &#123; super.viewDidLoad() view.backgroundColor &#x3D; .white &#125; &#x2F;&#x2F; é…ç½®é¡µé¢æ ·å¼ func setup(with adType: WDLaunchADType, url: String, bottomLogoView: UIView? &#x3D; UIView(), bottomLogoViewHeight: CGFloat &#x3D; 180) &#123; if adType &#x3D;&#x3D; .image &#123; imageView.isUserInteractionEnabled &#x3D; true view.addSubview(imageView) imageView.sd_setImage(with: URL(string: url), completed: nil) &#125; else &#123; WDLaunchADPlayerManager.share.playItem(with: url) if let layer &#x3D; WDLaunchADPlayerManager.share.playerLayer &#123; self.view.layer.addSublayer(layer) playerLayer &#x3D; layer &#125; &#125; if let logoView &#x3D; bottomLogoView &#123; view.addSubview(logoView) logoView.frame &#x3D; CGRect(x: 0, y: view.frame.height - bottomLogoViewHeight, width: view.frame.width, height: bottomLogoViewHeight) if adType &#x3D;&#x3D; .image &#123; imageView.frame &#x3D; CGRect(x: 0, y: 0, width: view.frame.width, height: view.frame.height - bottomLogoViewHeight) &#125; else &#123; playerLayer.frame &#x3D; CGRect(x: 0, y: 0, width: view.frame.width, height: view.frame.height) &#125; &#125; else &#123; if adType &#x3D;&#x3D; .image &#123; imageView.frame &#x3D; view.bounds &#125; else &#123; playerLayer.frame &#x3D; view.bounds &#125; &#125; &#125; override var shouldAutorotate: Bool &#123; return false &#125; override var prefersHomeIndicatorAutoHidden: Bool &#123; return false &#125;&#125; åŠ è½½æ§åˆ¶ä»£ç 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163import UIKitenum WDLaunchADType &#123; case image case video&#125;&#x2F;&#x2F;&#x2F; æ˜¯å¦æ˜¯åˆ˜æµ·å±ç³»åˆ—var kIS_IPHONEX: Bool &#123; var iPhoneX &#x3D; false if UIDevice.current.userInterfaceIdiom !&#x3D; .phone &#123; return iPhoneX &#125; if #available(iOS 11.0, *) &#123; if let mainWindow &#x3D; UIApplication.shared.delegate?.window &#123; if (mainWindow?.safeAreaInsets.bottom)! &gt; CGFloat(0.0) &#123; iPhoneX &#x3D; true &#125; &#125; &#125; return iPhoneX&#125;&#x2F;&#x2F;&#x2F; çŠ¶æ€æ é«˜åº¦var kSTATUS_HEIGHT: CGFloat &#123; return kIS_IPHONEX ? UIApplication.shared.statusBarFrame.height : 22&#125;&#x2F;&#x2F; MARK: - Mainclass WDLaunchAD: NSObject &#123; &#x2F;&#x2F; MARK: Public &#x2F;&#x2F;&#x2F; é™æ€æ–¹æ³• &#x2F;&#x2F;&#x2F; &#x2F;&#x2F;&#x2F; - Parameters: &#x2F;&#x2F;&#x2F; - adType: å¹¿å‘Šç±»å‹ &#96;å›¾ç‰‡&#96; &#96;è§†é¢‘&lt;æ— å£°éŸ³&gt;&#96; &#x2F;&#x2F;&#x2F; - url: å¹¿å‘Šåœ°å€ &#x2F;&#x2F;&#x2F; - durition: æ˜¾ç¤ºæ—¶é—´ &#x2F;&#x2F;&#x2F; - bottomView: åº•éƒ¨è§†å›¾ &#x2F;&#x2F;&#x2F; - buttomViewHeight: åº•éƒ¨è§†å›¾é«˜åº¦ &#x2F;&#x2F;&#x2F; - clickBlock: å¹¿å‘Šç‚¹å‡»äº‹ä»¶å›è°ƒ static func setup(with adType: WDLaunchADType &#x3D; .image, url: String, durition: Int, bottomView: UIView? &#x3D; UIView(), buttomViewHeight: CGFloat &#x3D; 0, clickBlock: @escaping (() -&gt; Void)) &#123; let manager &#x3D; WDLaunchAD() manager.show(with: adType, url: url, durition: durition, bottomView: bottomView, buttomViewHeight: buttomViewHeight ,clickBlock: clickBlock) &#125; &#x2F;&#x2F; MARK: Private &#x2F;&#x2F;&#x2F; é¡µé¢æ˜¾ç¤ºçš„windowæ ¹æ§åˆ¶å™¨ï¼Œé™¤äº†å€’è®¡æ—¶æŒ‰é’®ï¼Œå…¶ä»–å…ƒç´ åœ¨æ§åˆ¶å™¨ä¸­é…ç½® private let wdLaunchADViewController &#x3D; WDLaunchADController() &#x2F;&#x2F;&#x2F; æ˜¾ç¤ºçš„æ—¶é—´ private var timerInterval: Int &#x3D; 0 &#x2F;&#x2F;&#x2F; å®šæ—¶å™¨ private var timer: Timer? &#x2F;&#x2F;&#x2F; ç‚¹å‡»äº‹ä»¶å›è°ƒ private var clickBlockHandle: (() -&gt; Void)? &#x2F;&#x2F;&#x2F; é¡µé¢æ˜¾ç¤ºçš„window private let window: UIWindow &#x3D; &#123; let window &#x3D; UIWindow.init(frame: UIScreen.main.bounds) window.rootViewController?.view.backgroundColor &#x3D; .black window.rootViewController?.view.isUserInteractionEnabled &#x3D; false window.windowLevel &#x3D; UIWindow.Level.statusBar + 1 window.isHidden &#x3D; false window.alpha &#x3D; 1 return window &#125;() &#x2F;&#x2F;&#x2F; å€’è®¡æ—¶æŒ‰é’® private let timeButton: UIButton &#x3D; &#123; let button &#x3D; UIButton(type: .custom) button.backgroundColor &#x3D; UIColor(white: 0, alpha: 0.5) button.setTitleColor(.white, for: .normal) button.titleLabel?.font &#x3D; UIFont.systemFont(ofSize: 15) return button &#125;()&#125;&#x2F;&#x2F; MARK: - é¡µé¢åˆå§‹åŒ–ä¸é”€æ¯fileprivate extension WDLaunchAD &#123; &#x2F;&#x2F; æ§åˆ¶å™¨åˆå§‹åŒ–é¡µé¢ func show(with adType: WDLaunchADType, url: String, durition: Int, bottomView: UIView?, buttomViewHeight: CGFloat, clickBlock: @escaping (() -&gt; Void)) &#123; clickBlockHandle &#x3D; clickBlock timerInterval &#x3D; durition window.rootViewController &#x3D; wdLaunchADViewController wdLaunchADViewController.view.addGestureRecognizer(UITapGestureRecognizer.init(target: self, action: #selector(adGuestureTargetAction))) wdLaunchADViewController.setup(with: adType, url: url, bottomLogoView: bottomView, bottomLogoViewHeight: buttomViewHeight) addTimeButton() &#x2F;&#x2F; å¼€å§‹å€’è®¡æ—¶ DispatchQueue.main.asyncAfter(deadline: .now() + 1) &#123; self.timer &#x3D; Timer.scheduledTimer(timeInterval: 1, target: self, selector: #selector(self.timerDown(timer:)), userInfo: nil, repeats: true) if let timer &#x3D; self.timer &#123; timer.fire() &#125; &#125; &#125; &#x2F;&#x2F; ç§»é™¤å®šæ—¶å™¨ä¸è§†å›¾ func removeWindow() &#123; &#x2F;&#x2F; åœæ­¢æ’­æ”¾è§†é¢‘ if WDLaunchADPlayerManager.share.player !&#x3D; nil &#123; WDLaunchADPlayerManager.share.stopPlay() &#125; &#x2F;&#x2F; åœæ­¢å€’è®¡æ—¶å¹¶ç§»é™¤ if let timer &#x3D; timer &#123; timer.invalidate() &#125; timer &#x3D; nil &#x2F;&#x2F; ç§»é™¤å½“å‰è§†å›¾ UIView.transition(with: window, duration: 0.8, options: UIView.AnimationOptions.curveEaseOut, animations: &#123; self.window.alpha &#x3D; 0; &#125;) &#123; (finished) in self.window.rootViewController &#x3D; nil self.window.removeFromSuperview() &#125; &#125;&#125;&#x2F;&#x2F; MARK: - é¡µé¢æ§ä»¶é…ç½®private extension WDLaunchAD &#123; &#x2F;&#x2F; é…ç½®æ—¶é—´æŒ‰é’® func addTimeButton() &#123; timeButton.setTitle(&quot; è·³è¿‡ \\(timerInterval) &quot;, for: .normal) timeButton.addTarget(self, action: #selector(buttonTargetAction(sender:)), for: .touchUpInside) window.addSubview(timeButton) timeButton.translatesAutoresizingMaskIntoConstraints &#x3D; false window.addConstraints([ NSLayoutConstraint(item: timeButton, attribute: .trailing, relatedBy: .equal, toItem: window, attribute: .trailing, multiplier: 1, constant: -15), NSLayoutConstraint(item: timeButton, attribute: .top, relatedBy: .equal, toItem: window, attribute: .top, multiplier: 1, constant: kSTATUS_HEIGHT), ]) timeButton.layoutIfNeeded() timeButton.layer.cornerRadius &#x3D; timeButton.frame.height &#x2F; 2.0 &#125;&#125;&#x2F;&#x2F; MARK: - å€’è®¡æ—¶ä¸å€’è®¡æ—¶ç‚¹å‡»äº‹ä»¶@objc private extension WDLaunchAD &#123; &#x2F;&#x2F; å€’è®¡æ—¶ func timerDown(timer: Timer) &#123; timerInterval -&#x3D; 1 timeButton.setTitle(&quot; è·³è¿‡ \\(timerInterval) &quot;, for: .normal) if timerInterval &#x3D;&#x3D; 0 &#123; removeWindow() &#125; &#125; &#x2F;&#x2F; å¹¿å‘Šé¡µç§»é™¤ func buttonTargetAction(sender: UIButton) &#123; removeWindow() &#125; &#x2F;&#x2F; ç‚¹å‡»æ‰‹åŠ¿ func adGuestureTargetAction() &#123; if clickBlockHandle !&#x3D; nil &#123; clickBlockHandle!() &#125; &#125;&#125; åŠ è½½æ–¹å¼åœ¨AppDelgateä¸­çš„didFinishLaunchingWithOptionsæ–¹æ³•ä¸­è°ƒç”¨æ–¹æ³•ã€‚æˆ‘è¿™ä¸ºäº†é€‚åº”å˜åŒ–çš„éœ€è¦ï¼Œæä¾›äº†ç›¸å¯¹è‡ªç”±çš„æ˜¾ç¤ºæ–¹å¼ åº•éƒ¨çš„logoè§†å›¾æ˜¯å¯ä»¥è‡ªå®šä¹‰çš„ï¼Œä¼ å…¥å¯¹åº”æ˜¾ç¤ºçš„é«˜åº¦å³å¯ã€‚ å›¾ç‰‡åœ°å€ 1let imagePath &#x3D; &quot;https:&#x2F;&#x2F;timgsa.baidu.com&#x2F;timg?image&amp;quality&#x3D;80&amp;size&#x3D;b9999_10000&amp;sec&#x3D;1567682065374&amp;di&#x3D;4c2a4d2008a4e951b34b3d130db19d12&amp;imgtype&#x3D;0&amp;src&#x3D;http%3A%2F%2Fb-ssl.duitang.com%2Fuploads%2Fitem%2F201704%2F14%2F20170414155109_Cmz24.jpeg&quot; ä»…æ˜¾ç¤ºå›¾ç‰‡ 123WDLaunchAD.setup(with: .image, url: imagePath, durition: 5, bottomView: WDLaunchADBottomLogoView(), buttomViewHeight: 180) &#123; print(&quot;âœ¨ ç‚¹å‡»äº†å¹¿å‘Š&quot;)&#125; æ˜¾ç¤ºå›¾ç‰‡ä¸åº•éƒ¨logoè§†å›¾åº•éƒ¨è§†å›¾ä»£ç  12345678910111213141516171819202122232425262728293031323334353637&#x2F;&#x2F; MARK: - åº•éƒ¨logoè§†å›¾class WDLaunchADBottomLogoView: UIView &#123; &#x2F;&#x2F; logo let logoImageView: UIImageView &#x3D; &#123; let imageV &#x3D; UIImageView() imageV.image &#x3D; UIImage(named: &quot;nav-logo-4c7bbafe27adc892f3046e6978459bac&quot;)?.withRenderingMode(.alwaysTemplate) imageV.tintColor &#x3D; .red return imageV &#125;() override init(frame: CGRect) &#123; super.init(frame: frame) setupSubviews() setupSubviewsLayouts() &#125; required init?(coder aDecoder: NSCoder) &#123; fatalError(&quot;init(coder:) has not been implemented&quot;) &#125;&#125;&#x2F;&#x2F; MARK: åº•éƒ¨logoè§†å›¾é¡µé¢é…ç½®ä¸å¸ƒå±€extension WDLaunchADBottomLogoView &#123; func setupSubviews() &#123; backgroundColor &#x3D; .white addSubview(logoImageView) logoImageView.translatesAutoresizingMaskIntoConstraints &#x3D; false &#125; func setupSubviewsLayouts() &#123; addConstraints([ NSLayoutConstraint(item: logoImageView, attribute: .centerX, relatedBy: .equal, toItem: self, attribute: .centerX, multiplier: 1, constant: 0), NSLayoutConstraint(item: logoImageView, attribute: .centerY, relatedBy: .equal, toItem: self, attribute: .centerY, multiplier: 1, constant: 0) ]) &#125;&#125; åŠ è½½ä»£ç  123WDLaunchAD.setup(with: .image, url: imagePath, durition: 5, bottomView: WDLaunchADBottomLogoView(), buttomViewHeight: 180) &#123; print(&quot;âœ¨ ç‚¹å‡»äº†å¹¿å‘Š&quot;)&#125; åŠ è½½è§†é¢‘é¦–å…ˆéœ€è¦ç°åœ¨æœ‰ç½‘çš„ç¯å¢ƒç¼“å­˜åˆ°æœ¬åœ°ï¼Œæˆ‘è¿™è¾¹çš„æ€æƒ³æ˜¯ï¼Œé¦–æ¬¡è¿›å…¥Appé»˜è®¤åŠ è½½å›¾ç‰‡ï¼Œç„¶åä¸‹è½½å¹¿å‘Šçš„è§†é¢‘åˆ°æœ¬åœ°ã€‚å†æ¬¡è¿›å…¥çš„æ—¶å€™ï¼Œåˆ¤æ–­æ˜¯å¦æ˜¯ç¼“å­˜çš„è§†é¢‘ï¼Œæ˜¯åˆ™è¿›è¡Œæ’­æ”¾ã€‚æ˜¯å¦åŠ è½½çš„URLä¸ç¼“å­˜çš„ä¸åŒï¼Œåˆ™ä¾æ—§åŠ è½½å›¾ç‰‡ï¼Œå¹¶ä¸‹è½½æœ€æ–°URLä¸‹çš„è§†é¢‘ã€‚ 12345678910let path &#x3D; WDLaunchADDownloader.downloadVideo(path: &quot;http:&#x2F;&#x2F;wvideo.spriteapp.cn&#x2F;video&#x2F;2018&#x2F;0514&#x2F;eede6198571f11e8b5ca842b2b4c75ab_wpd.mp4&quot;) if path.count &gt; 0 &#123; WDLaunchAD.setup(with: .video, url: path, durition: 5, bottomView: WDLaunchADBottomLogoView(), buttomViewHeight: 180) &#123; print(&quot;âœ¨ ç‚¹å‡»äº†å¹¿å‘Š&quot;) &#125; &#125; else &#123; WDLaunchAD.setup(with: .image, url: imagePath, durition: 5, bottomView: WDLaunchADBottomLogoView(), buttomViewHeight: 180) &#123; print(&quot;âœ¨ ç‚¹å‡»äº†å¹¿å‘Š&quot;) &#125; &#125; æ•ˆæœå›¾ï¼Œæ²¡æœ‰æ‰¾åˆ°åˆé€‚å¤§å°çš„è§†é¢‘å°±å‡‘åˆç€ç”¨äº†ã€‚ è¯´æ˜: é¡µé¢æ¶ˆå¤±çš„åŠ¨ç”»ï¼Œæ²¡æœ‰åšè¿‡å¤šçš„å¤„ç† è§†é¢‘æ²¡æœ‰åšå¾ªç¯æ’­æ”¾","categories":[{"name":"Swift","slug":"Swift","permalink":"https://github.com/wuvdan/wuvdan.github.io/categories/Swift/"}],"tags":[{"name":"è‡ªå®šä¹‰æ§ä»¶","slug":"è‡ªå®šä¹‰æ§ä»¶","permalink":"https://github.com/wuvdan/wuvdan.github.io/tags/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6/"}]},{"title":"iOSè‡ªå®šä¹‰æ§ä»¶-åˆ†æ®µé€‰æ‹©å™¨","slug":"iOSè‡ªå®šä¹‰æ§ä»¶-åˆ†æ®µé€‰æ‹©å™¨","date":"2020-01-16T08:06:19.135Z","updated":"2020-01-20T02:21:38.326Z","comments":true,"path":"2020/01/16/iOSè‡ªå®šä¹‰æ§ä»¶-åˆ†æ®µé€‰æ‹©å™¨/","link":"","permalink":"https://github.com/wuvdan/wuvdan.github.io/2020/01/16/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-%E5%88%86%E6%AE%B5%E9%80%89%E6%8B%A9%E5%99%A8/","excerpt":"","text":"åºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥ä¸Šä»£ç  1ã€æ•°æ®æºæ–¹æ³•12345678910111213141516171819&#x2F;&#x2F; MARK: &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; SegmentSelectorManagerDataSource &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;@objc protocol SegmentSelectorManagerDataSource:NSObjectProtocol &#123; &#x2F;&#x2F;&#x2F; ä¸»è¦é…ç½® -&gt; å¿…é¡»è¦å®ç° func nameOfSliderItems(segemntControl:SegmentSelectorManager) -&gt; Array&lt;String&gt; func childViewControllers(segemntControl:SegmentSelectorManager) -&gt; Array&lt;UIViewController&gt; &#x2F;&#x2F;&#x2F; å­—ä½“é¢œè‰²é…ç½® -&gt; æœ‰é»˜è®¤ @objc optional func colorOfSlider(segemntControl:SegmentSelectorManager) -&gt; UIColor @objc optional func colorOfTopView(segemntControl:SegmentSelectorManager) -&gt; UIColor &#x2F;&#x2F;&#x2F; èƒŒæ™¯é¢œè‰²é…ç½® -&gt; æœ‰é»˜è®¤ @objc optional func colorOfSliderItemsTitle(segemntControl:SegmentSelectorManager) -&gt; UIColor @objc optional func colorOfHighlightedSliderItemsTitle(segemntControl:SegmentSelectorManager) -&gt; UIColor &#x2F;&#x2F;&#x2F; é«˜åº¦é…ç½® -&gt; æœ‰é»˜è®¤ @objc optional func heightOfTopView(segemntControl:SegmentSelectorManager) -&gt; CGFloat @objc optional func heightOfSlider(segemntControl:SegmentSelectorManager) -&gt; CGFloat&#125; 2ã€ä»£ç†æ–¹æ³•1234&#x2F;&#x2F; MARK: &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; SegmentSelectorManagerDelegate &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;protocol SegmentSelectorManagerDelegate &#123; func slideView(sliderView:SegmentSelectorManager, didSelectItemAtIndex:Int) -&gt; Void&#125; 3ã€é¡µé¢å®ç°123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596override init(frame: CGRect) &#123; super.init(frame: frame) &#125; required init?(coder aDecoder: NSCoder) &#123; fatalError(&quot;init(coder:) has not been implemented&quot;) &#125; &#x2F;&#x2F;&#x2F; æ•°æ®æº public weak var dataSource:SegmentSelectorManagerDataSource? &#123; didSet &#123; &#x2F;&#x2F; åç§°æ•°ç»„ namesOfSlideItems &#x3D; dataSource?.nameOfSliderItems(segemntControl: self) &#x2F;&#x2F; æ§åˆ¶å™¨æ•°ç»„ childControllersArray &#x3D; dataSource?.childViewControllers(segemntControl: self) if let ds &#x3D; dataSource &#123; if (ds.responds(to: #selector(ds.colorOfHighlightedSliderItemsTitle(segemntControl:)))) &#123; &#x2F;&#x2F;æŒ‰é’®å­—ä½“é¢œè‰²é»˜è®¤ colorOfSlideItemsTitle &#x3D; ds.colorOfSliderItemsTitle!(segemntControl: self) &#125; if (ds.responds(to: #selector(ds.colorOfHighlightedSliderItemsTitle(segemntControl:)))) &#123; &#x2F;&#x2F; æŒ‰é’®å­—ä½“é¢œè‰²é€‰ä¸­ colorOfHighlightedSlideItemsTitle &#x3D; ds.colorOfHighlightedSliderItemsTitle!(segemntControl: self) &#125; if (ds.responds(to: #selector(ds.colorOfSlider(segemntControl:)))) &#123; &#x2F;&#x2F; æŒ‡ç¤ºå™¨é¢œè‰² colorOfSlider &#x3D; ds.colorOfSlider!(segemntControl: self) &#125; if ds.responds(to: #selector(ds.heightOfTopView(segemntControl:))) &#123; &#x2F;&#x2F; é¡¶éƒ¨è§†å›¾é«˜åº¦ heightOfTopView &#x3D; (ds.heightOfTopView!(segemntControl: self)) &#125; if ds.responds(to: #selector(ds.heightOfTopView(segemntControl:))) &#123; &#x2F;&#x2F; æŒ‡ç¤ºå™¨é«˜åº¦ heightOfSlider &#x3D; (ds.heightOfSlider!(segemntControl: self)) &#125; &#125; &#125; &#125; &#x2F;&#x2F; ä»£ç† public var delegate:SegmentSelectorManagerDelegate? var namesOfSlideItems: Array&lt;String&gt;? &#x3D; [] &#x2F;&#x2F; åç§°æ•°ç»„ var colorOfSlider: UIColor? &#x3D; UIColor.orange &#x2F;&#x2F; æŒ‡ç¤ºå™¨é¢œè‰² var colorOfSlideView: UIColor? &#x3D; UIColor.white &#x2F;&#x2F; é¡¶éƒ¨è§†å›¾é¢œè‰² var colorOfSlideItemsTitle: UIColor? &#x3D; UIColor.gray &#x2F;&#x2F; é»˜è®¤å­—ä½“é¢œè‰² var colorOfHighlightedSlideItemsTitle: UIColor? &#x3D; UIColor.orange &#x2F;&#x2F; é€‰ä¸­å­—ä½“é¢œè‰² var heightOfTopView:CGFloat &#x3D; 45 &#x2F;&#x2F; é¡¶éƒ¨è§†å›¾é«˜åº¦ var heightOfSlider:CGFloat &#x3D; 2 &#x2F;&#x2F; æŒ‡ç¤ºå™¨é«˜åº¦ let SliderThanSliderView_WidthRatio:CGFloat &#x3D; 1 &#x2F;&#x2F; æŒ‰é’®å’ŒæŒ‡ç¤ºå™¨å®½åº¦æ¯” var buttonsArray:Array&lt;UIButton&gt;? &#x3D; [] &#x2F;&#x2F; æ‰€æœ‰æŒ‰é’®çš„æ•°ç»„ var childControllersArray:Array&lt;UIViewController&gt;? &#x3D; [] &#x2F;&#x2F; æ§åˆ¶å™¨æ•°ç»„ let SCREEN_WIDTH &#x3D; UIScreen.main.bounds.size.width let SCREEN_HEIGHT &#x3D; UIScreen.main.bounds.height &#x2F;&#x2F;&#x2F; é¡¶éƒ¨View lazy var slideBar:UIView &#x3D; &#123; let view &#x3D; UIView.init() view.backgroundColor &#x3D; colorOfSlideView addSubview(view) view.translatesAutoresizingMaskIntoConstraints &#x3D; false view.leadingAnchor.constraint(equalTo: leadingAnchor).isActive &#x3D; true view.trailingAnchor.constraint(equalTo: trailingAnchor).isActive &#x3D; true view.topAnchor.constraint(equalTo: topAnchor).isActive &#x3D; true view.heightAnchor.constraint(equalToConstant: self.heightOfTopView).isActive &#x3D; true return view &#125;() &#x2F;&#x2F; åº•éƒ¨æŒ‡ç¤ºå™¨ var slider:UIView? &#x2F;&#x2F;&#x2F; æ§åˆ¶å™¨ScrollView lazy var contentScrollView:UIScrollView &#x3D; &#123; let sc &#x3D; UIScrollView.init() sc.isDirectionalLockEnabled &#x3D; true sc.backgroundColor &#x3D; UIColor.white sc.isPagingEnabled &#x3D; true sc.showsHorizontalScrollIndicator &#x3D; false sc.delegate &#x3D; self sc.bounces &#x3D; false addSubview(sc) sc.translatesAutoresizingMaskIntoConstraints &#x3D; false sc.leadingAnchor.constraint(equalTo: leadingAnchor).isActive &#x3D; true sc.trailingAnchor.constraint(equalTo: trailingAnchor).isActive &#x3D; true sc.topAnchor.constraint(equalTo: self.slideBar.bottomAnchor).isActive &#x3D; true sc.bottomAnchor.constraint(equalTo: bottomAnchor).isActive &#x3D; true return sc &#125;() #####4ã€ç»˜åˆ¶é¡µé¢UI 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124 &#x2F;&#x2F; è·å–å½“å‰é¡µé¢çš„æ§åˆ¶å™¨ public func viewController()-&gt;UIViewController? &#123; var nextResponder: UIResponder? &#x3D; self repeat &#123; nextResponder &#x3D; nextResponder?.next if let viewController &#x3D; nextResponder as? UIViewController &#123; return viewController &#125; &#125; while nextResponder !&#x3D; nil return nil &#125;override func layoutSubviews() &#123; super.layoutSubviews() addSlider() addButton() addContentScrollView() &#125;&#x2F;&#x2F;&#x2F; æ·»åŠ æŒ‰é’®åˆ°é¡¶éƒ¨è§†å›¾ func addButton() &#123; let numberOfItems:Int &#x3D; (namesOfSlideItems?.count)! let slideItemWidth &#x3D; SCREEN_WIDTH &#x2F; CGFloat(numberOfItems) let sliderWidth &#x3D; slideItemWidth * SliderThanSliderView_WidthRatio let position_x &#x3D; (slideItemWidth - sliderWidth) &#x2F; 2.0 for index in 0..&lt;numberOfItems &#123; let b &#x3D; UIButton.init(type: .custom) b.tag &#x3D; index b.setTitle(namesOfSlideItems![index], for: .normal) b.setTitleColor(colorOfSlideItemsTitle, for: .normal) b.titleLabel?.textAlignment &#x3D; .center b.addTarget(self, action: #selector(buttonTouched(button:)), for: .touchUpInside) buttonsArray?.append(b) b.frame &#x3D; CGRect(x: position_x + slideItemWidth * CGFloat(index), y: 5, width: sliderWidth, height: heightOfTopView-5) slideBar.addSubview(b) if index &#x3D;&#x3D; 0 &#123; b.setTitleColor(colorOfHighlightedSlideItemsTitle!, for: .normal) &#125; &#125; &#125; &#x2F;&#x2F; æ·»åŠ åº•éƒ¨æŒ‡ç¤ºå™¨åˆ°é¡¶éƒ¨è§†å›¾ func addSlider() &#123; let slideItemWidth &#x3D; SCREEN_WIDTH &#x2F; CGFloat((namesOfSlideItems?.count)!) let sliderWidth &#x3D; slideItemWidth * SliderThanSliderView_WidthRatio let position_x &#x3D; (slideItemWidth - sliderWidth) &#x2F; 2.0 slideBar.addSubview(sliderView(frame: CGRect(x: position_x, y: heightOfTopView - heightOfSlider, width: sliderWidth, height: heightOfSlider))) slideBar.backgroundColor &#x3D; colorOfSlideView slider?.backgroundColor &#x3D; colorOfSlider &#125; &#x2F;&#x2F; æ·»åŠ ScrollView func addContentScrollView() &#123; contentScrollView.contentSize &#x3D; CGSize(width: SCREEN_WIDTH * CGFloat((namesOfSlideItems?.count)!), height: 0) for (index) in (childControllersArray?.enumerated())! &#123; index.element.view.frame &#x3D; CGRect(x: CGFloat(index.offset) * SCREEN_WIDTH, y: 0, width: contentScrollView.frame.width, height: contentScrollView.frame.height) contentScrollView.addSubview(index.element.view) viewController()?.addChild(index.element) index.element.didMove(toParent: viewController()) &#125; &#125; &#x2F;&#x2F; vcæ»šåŠ¨åŠ¨ç”» func animateSlider(tag:Int) -&gt; Void &#123; contentScrollView.setContentOffset(CGPoint(x: SCREEN_WIDTH * CGFloat(tag), y: 0), animated: true) &#125; &#x2F;&#x2F; æŒ‡ç¤ºå™¨æ»šåŠ¨åŠ¨ç”» func animateSliderToPosition(offset:CGPoint) -&gt; Void &#123; let slideItemWidth &#x3D; SCREEN_WIDTH &#x2F; CGFloat((namesOfSlideItems?.count)!) let sliderWidth &#x3D; slideItemWidth * SliderThanSliderView_WidthRatio let position_x &#x3D; (slideItemWidth - sliderWidth) &#x2F; 2.0 let newFrame &#x3D; CGRect(x: (offset.x &#x2F; SCREEN_WIDTH) * slideItemWidth + position_x, y: (slider?.frame.origin.y)!, width: (slider?.frame.width)!, height: (slider?.frame.height)!) slider?.frame &#x3D; newFrame for (index) in (buttonsArray?.enumerated())! &#123; index.element.setTitleColor(colorOfSlideItemsTitle, for: .normal) &#125; var buttonTag &#x3D; 0 let ratio &#x3D; offset.x &#x2F; SCREEN_WIDTH let tempRation &#x3D; Int(ratio) let decimal:CGFloat &#x3D; ratio - CGFloat(tempRation) if decimal &gt;&#x3D; 0.5 &#123; buttonTag &#x3D; Int(ratio) + 1 &#125; else &#123; buttonTag &#x3D; Int(ratio) &#125; buttonsArray![buttonTag].setTitleColor(colorOfHighlightedSlideItemsTitle, for: .normal) &#125; &#x2F;&#x2F;&#x2F; æ ¹æ®frameåˆå§‹åŒ–æŒ‡ç¤ºå™¨ func sliderView(frame:CGRect) -&gt; UIView &#123; slider &#x3D; UIView.init(frame: frame) return slider! &#125; &#x2F;&#x2F;&#x2F; ç‚¹å‡»äº‹ä»¶ @objc func buttonTouched(button:UIButton) &#123; delegate?.slideView(sliderView: self, didSelectItemAtIndex: button.tag) animateSlider(tag: tag) contentScrollView.setContentOffset(CGPoint(x: SCREEN_WIDTH * CGFloat(button.tag), y: 0), animated: true) &#125; 5ã€ä½¿ç”¨Extensionå®ç°UIScrollViewDidScrollDelegate123456&#x2F;&#x2F; MARK: &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; UIScrollViewDidScrollDelegate &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;extension SegmentSelectorManager:UIScrollViewDelegate &#123; func scrollViewDidScroll(_ scrollView: UIScrollView) &#123; animateSliderToPosition(offset: scrollView.contentOffset) &#125;&#125; 6ã€ä½¿ç”¨æ–¹æ³•(å®ä¾‹ä»£ç )12345678910111213141516override func setupSubViewsProperties() &#123; segmentView &#x3D; SegmentSelectorManager.init(frame: CGRect.zero) segmentView?.delegate &#x3D; self segmentView?.dataSource &#x3D; self view.addSubview(segmentView!) &#125; override func setupSubViewsConstrains() &#123; if let seg &#x3D; segmentView &#123; seg.translatesAutoresizingMaskIntoConstraints &#x3D; false seg.leadingAnchor.constraint(equalTo: view.leadingAnchor).isActive &#x3D; true seg.trailingAnchor.constraint(equalTo: view.trailingAnchor).isActive &#x3D; true seg.bottomAnchor.constraint(equalTo: view.bottomAnchor, constant: -kTabBarHeight).isActive &#x3D; true seg.topAnchor.constraint(equalTo: wd_navgationBar_normal.bottomAnchor).isActive &#x3D; true &#125; &#125; 12345678910111213141516171819202122232425262728293031323334353637383940extension HotPlayController: SegmentSelectorManagerDataSource &#123; func nameOfSliderItems(segemntControl: SegmentSelectorManager) -&gt; Array&lt;String&gt; &#123; return [&quot;æ­£åœ¨çƒ­æ˜ &quot;, &quot;å³å°†ä¸Šæ˜ &quot;] &#125; func childViewControllers(segemntControl: SegmentSelectorManager) -&gt; Array&lt;UIViewController&gt; &#123; return [HotPlayingController(), HotWillPlayViewController()] &#125; func heightOfTopView(segemntControl: SegmentSelectorManager) -&gt; CGFloat &#123; return 45 &#125; func heightOfSlider(segemntControl: SegmentSelectorManager) -&gt; CGFloat &#123; return 3 &#125; func colorOfSlider(segemntControl slider: SegmentSelectorManager) -&gt; UIColor &#123; return UIColor.wd_init(r: 73, g: 73, b: 73) &#125; func colorOfTopView(segemntControl: SegmentSelectorManager) -&gt; UIColor &#123; return UIColor.white &#125; func colorOfSliderItemsTitle(segemntControl: SegmentSelectorManager) -&gt; UIColor &#123; return UIColor.gray &#125; func colorOfHighlightedSliderItemsTitle(segemntControl: SegmentSelectorManager) -&gt; UIColor &#123; return UIColor.wd_init(r: 73, g: 73, b: 73) &#125;&#125;extension HotPlayController: SegmentSelectorManagerDelegate &#123; func slideView(sliderView: SegmentSelectorManager, didSelectItemAtIndex: Int) &#123; &#125;&#125; 7ã€æ•ˆæœå›¾","categories":[{"name":"Swift","slug":"Swift","permalink":"https://github.com/wuvdan/wuvdan.github.io/categories/Swift/"}],"tags":[{"name":"è‡ªå®šä¹‰æ§ä»¶","slug":"è‡ªå®šä¹‰æ§ä»¶","permalink":"https://github.com/wuvdan/wuvdan.github.io/tags/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6/"}]},{"title":"iOSè‡ªå®šä¹‰æ§ä»¶-ä»¿QQä¾§è¾¹èœå•","slug":"iOSè‡ªå®šä¹‰æ§ä»¶-ä»¿QQä¾§è¾¹èœå•","date":"2020-01-16T08:06:15.186Z","updated":"2020-01-20T02:22:03.730Z","comments":true,"path":"2020/01/16/iOSè‡ªå®šä¹‰æ§ä»¶-ä»¿QQä¾§è¾¹èœå•/","link":"","permalink":"https://github.com/wuvdan/wuvdan.github.io/2020/01/16/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-%E4%BB%BFQQ%E4%BE%A7%E8%BE%B9%E8%8F%9C%E5%8D%95/","excerpt":"","text":"12345678910111213141516171819202122232425262728293031#import &lt;UIKit&#x2F;UIKit.h&gt;NS_ASSUME_NONNULL_BEGIN@interface LZSliderContainerViewController : UIViewController&#x2F;&#x2F; æ˜¯å¦å…è®¸ä¾§æ»‘æ‰‹åŠ¿@property (nonatomic, assign) BOOL allowOpenSliderView;&#x2F;&#x2F; å•ä¾‹+ (instancetype)mamager;&#x2F;** åˆå§‹åŒ–æ–¹æ³• @param mainController ä¸»é¡µé¢æ§åˆ¶å™¨ @param sliderController èœå•é¡µé¢æ§åˆ¶å™¨ @param space ç©ºéš™ @return UIViewController *&#x2F;- (UIViewController *)lz_setupMainController:(UIViewController *)mainController sliderController:(UIViewController *)sliderController space:(CGFloat)space;&#x2F;** æ‰“å¼€ä¾§è¾¹èœå• *&#x2F;- (void)lz_openSlderView;&#x2F;** å…³é—­ä¾§è¾¹èœå• *&#x2F;- (void)lz_closeSliderView;@end 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192#import &quot;LZSliderContainerViewController.h&quot;@interface UIView (Frame)@property (nonatomic) CGFloat left;@property (nonatomic) CGFloat right;@end@implementation UIView (Frame)- (CGFloat)left &#123; return self.frame.origin.x;&#125;- (void)setLeft:(CGFloat)x &#123; CGRect frame &#x3D; self.frame; frame.origin.x &#x3D; x; self.frame &#x3D; frame;&#125;- (CGFloat)right &#123; return self.frame.origin.x + self.frame.size.width;&#125;- (void)setRight:(CGFloat)right &#123; CGRect frame &#x3D; self.frame; frame.origin.x &#x3D; right - frame.size.width; self.frame &#x3D; frame;&#125;@end@interface LZSliderContainerViewController ()@property (nonatomic, strong) UIViewController *mainController;@property (nonatomic, strong) UIViewController *sliderController;@property (nonatomic, assign) CGFloat spece;@property (nonatomic, assign) CGFloat panStartX;@property (nonatomic, strong) UIView *coverView;@end@implementation LZSliderContainerViewController#pragma mark - å•ä¾‹æ–¹æ³•+ (instancetype)mamager &#123; static dispatch_once_t onceToken; static LZSliderContainerViewController *vc; dispatch_once(&amp;onceToken, ^&#123; vc &#x3D; [[LZSliderContainerViewController alloc] init]; &#125;); return vc;&#125;#pragma mark - åˆå§‹åŒ–æ–¹æ³•- (UIViewController *)lz_setupMainController:(UIViewController *)mainController sliderController:(UIViewController *)sliderController space:(CGFloat)space &#123; [self lz_addChildControllerWithMainController:mainController sliderController:sliderController]; [self lz_setupCoverView]; _spece &#x3D; space; return self;&#125;#pragma mark - é…ç½®é®ç½©å±‚- (void)lz_setupCoverView &#123; self.coverView &#x3D; [[UIView alloc] init]; self.coverView.frame &#x3D; UIScreen.mainScreen.bounds; self.coverView.backgroundColor &#x3D; [[UIColor blackColor] colorWithAlphaComponent:0]; self.coverView.hidden &#x3D; true; [self.coverView addGestureRecognizer:[[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(lz_closeSliderView)]]; [self.view addSubview:self.coverView];&#125;#pragma mark - æ·»åŠ VC- (void)lz_addChildControllerWithMainController:(UIViewController *)mainController sliderController:(UIViewController *)sliderController &#123; [self addChildViewController:mainController]; [mainController didMoveToParentViewController:self]; mainController.view.frame &#x3D; UIScreen.mainScreen.bounds; [self.view addSubview:mainController.view]; [self addChildViewController:sliderController]; [sliderController didMoveToParentViewController:self]; sliderController.view.frame &#x3D; CGRectMake(-UIScreen.mainScreen.bounds.size.width, 0, UIScreen.mainScreen.bounds.size.width, UIScreen.mainScreen.bounds.size.height); [self.view addSubview:sliderController.view]; self.mainController &#x3D; mainController; self.sliderController &#x3D; sliderController; [self lz_setupGusture];&#125;#pragma mark - æ·»åŠ å¹³ç§»æ‰‹åŠ¿- (void)lz_setupGusture &#123; UIPanGestureRecognizer *panGusture &#x3D; [[UIPanGestureRecognizer alloc] initWithTarget:self action:@selector(lz_panGestureRecognizer:)]; [self.view addGestureRecognizer:panGusture];&#125;#pragma mark - UIPanGestureRecognizer Action- (void)lz_panGestureRecognizer:(UIPanGestureRecognizer *)sender &#123; UIView *rootView &#x3D; self.mainController.view; UIView *menuView &#x3D; self.sliderController.view; if (sender.state &#x3D;&#x3D; UIGestureRecognizerStateBegan) &#123; CGFloat startPointX &#x3D; [sender translationInView:self.view].x; self.panStartX &#x3D; startPointX; self.coverView.hidden &#x3D; false; &#125; if (self.panStartX &gt;&#x3D; 40 &amp;&amp; rootView.frame.origin.x &#x3D;&#x3D; 0) &#123; return; &#125; CGFloat translationX &#x3D; [sender translationInView:rootView].x; CGFloat rootViewX &#x3D; rootView.frame.origin.x; rootViewX &#x3D; [self lz_minmumWithValueA:(rootViewX + translationX) valueB:(UIScreen.mainScreen.bounds.size.width - self.spece)]; rootViewX &#x3D; [self lz_maxmumWithValueA:rootViewX valueB:0]; rootView.left &#x3D; rootViewX; menuView.right &#x3D; rootView.left; self.coverView.frame &#x3D; rootView.frame; CGFloat aphal &#x3D; 0.5 * rootView.frame.origin.x &#x2F; (UIScreen.mainScreen.bounds.size.width - self.spece); self.coverView.backgroundColor &#x3D; [[UIColor blackColor] colorWithAlphaComponent:aphal]; [sender setTranslation:CGPointZero inView:rootView]; if (sender.state &#x3D;&#x3D; UIGestureRecognizerStateEnded || sender.state &#x3D;&#x3D; UIGestureRecognizerStateCancelled) &#123; if (rootViewX &gt;&#x3D; (UIScreen.mainScreen.bounds.size.width - self.spece)&#x2F;2) &#123; [self lz_openSlderView]; &#125; else&#123; [self lz_closeSliderView]; &#125; &#125;&#125;#pragma mark - æ‰“å¼€ä¾§è¾¹èœå•- (void)lz_openSlderView &#123; [self lz_setupGusture]; UIView *rootView &#x3D; self.mainController.view; UIView *menuView &#x3D; self.sliderController.view; self.coverView.hidden &#x3D; false; [UIView animateWithDuration:0.4 animations:^&#123; rootView.left &#x3D; UIScreen.mainScreen.bounds.size.width - self.spece; menuView.right &#x3D; rootView.left; self.coverView.frame &#x3D; rootView.frame; self.coverView.backgroundColor &#x3D; [[UIColor blackColor] colorWithAlphaComponent:0.5]; &#125;];&#125;#pragma mark - å…³é—­ä¾§è¾¹èœå•- (void)lz_closeSliderView &#123; UIView *rootView &#x3D; self.mainController.view; UIView *menuView &#x3D; self.sliderController.view; [UIView animateWithDuration:0.4 animations:^&#123; self.coverView.backgroundColor &#x3D; [[UIColor blackColor] colorWithAlphaComponent:0]; rootView.left &#x3D; 0; menuView.right &#x3D; rootView.left; self.coverView.frame &#x3D; rootView.frame; &#125; completion:^(BOOL finished) &#123; if (finished) &#123; self.coverView.hidden &#x3D; true; &#125; &#125;];&#125;#pragma mark - æ¯”è¾ƒå¤§å°å–æœ€å°å€¼- (CGFloat)lz_minmumWithValueA:(CGFloat)a valueB:(CGFloat)b &#123; return a &gt; b ? b : a;&#125;#pragma mark - æ¯”è¾ƒå¤§å°å–æœ€å¤§å€¼- (CGFloat)lz_maxmumWithValueA:(CGFloat)a valueB:(CGFloat)b &#123; return a &gt; b ? a : b;&#125;#pragma mark - Setter- (void)setAllowOpenSliderView:(BOOL)allowOpenSliderView &#123; _allowOpenSliderView &#x3D; allowOpenSliderView; if (allowOpenSliderView) &#123; [self lz_setupGusture]; &#125; else &#123; for (UIGestureRecognizer *pan in self.view.gestureRecognizers) &#123; [self.view removeGestureRecognizer:pan]; &#125; &#125;&#125;@end AppDelegateä¸­è®¾ç½®ä¸ºæ ¹æ§åˆ¶å™¨ 1self.window.rootViewController &#x3D; [[LZSliderContainerViewController mamager] lz_setupMainController:tab sliderController:sldier space:200]; // å•ç‹¬æ‰“å¼€æˆ–å…³é—­ 1234&#x2F;&#x2F; æ‰“å¼€é¡µé¢[[LZSliderContainerViewController mamager] lz_openSlderView];&#x2F;&#x2F; å…³é—­é¡µé¢[[LZSliderContainerViewController mamager] lz_closeSliderView]; é»˜è®¤æ‰€æœ‰é¡µé¢éƒ½æ˜¯æ‰“å¼€çš„ï¼Œå¦‚æœéœ€è¦å…³é—­ 123456789- (void)viewWillAppear:(BOOL)animated&#123; [super viewWillAppear:animated]; [LZSliderContainerViewController mamager].allowOpenSliderView &#x3D; NO;&#125;- (void)viewDidDisappear:(BOOL)animated &#123; [super viewDidDisappear:animated]; [LZSliderContainerViewController mamager].allowOpenSliderView &#x3D; true;&#125;","categories":[{"name":"Objective-C","slug":"Objective-C","permalink":"https://github.com/wuvdan/wuvdan.github.io/categories/Objective-C/"}],"tags":[{"name":"è‡ªå®šä¹‰æ§ä»¶","slug":"è‡ªå®šä¹‰æ§ä»¶","permalink":"https://github.com/wuvdan/wuvdan.github.io/tags/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6/"}]},{"title":"iOSè‡ªå®šä¹‰æ§ä»¶-TableViewã€CollectionViewç©ºæ•°æ®å ä½å›¾","slug":"iOSè‡ªå®šä¹‰æ§ä»¶-TableViewã€CollectionViewç©ºæ•°æ®å ä½å›¾","date":"2020-01-16T08:06:11.294Z","updated":"2020-01-20T01:44:54.956Z","comments":true,"path":"2020/01/16/iOSè‡ªå®šä¹‰æ§ä»¶-TableViewã€CollectionViewç©ºæ•°æ®å ä½å›¾/","link":"","permalink":"https://github.com/wuvdan/wuvdan.github.io/2020/01/16/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-TableView%E3%80%81CollectionView%E7%A9%BA%E6%95%B0%E6%8D%AE%E5%8D%A0%E4%BD%8D%E5%9B%BE/","excerpt":"","text":"æœ€è¿‘ç”±äºä¸šåŠ¡éœ€æ±‚ï¼Œéœ€è¦å°è£…è¿™æ ·çš„ä¸€ä¸ªæç¤ºé¡µé¢ã€‚çœ‹äº†ç½‘ä¸Šæ–¹æ³•æ„Ÿè§‰éƒ½å¤§åŒå°å¼‚ï¼Œå…¶ä¸­DZNEmptyDataSetæ˜¯å¾ˆå¥½çš„ä¸€ä¸ªåº“ï¼Œä½†æ˜¯å¯¹æˆ‘ä¸ªäººè€Œè¨€æœ‰ç‚¹å¤§è´¢å°ç”¨äº†ã€‚æ‰€ä»¥å°±å€Ÿé‰´ä¸€ä¸‹å…¶æ–¹æ³•ï¼Œè‡ªå·±å°è£…ä¸€ä¸ªã€‚æ„Ÿè§‰æœ‰æ›´é«˜çš„è‡ªå®šä¹‰æ€§å§ã€‚ï¼ˆæˆ‘æ˜¯åˆå­¦è€…ï¼Œè¯·å¤§ä½¬çˆ±æŠ¤ï¼Œå‹¿å–·ï¼‰ä¸€ã€å°è£…ä»£ç ï¼šåˆ©ç”¨UIScrollViewçš„åˆ†ç±»å®ç° 1234567891011#import &lt;UIKit&#x2F;UIKit.h&gt;NS_ASSUME_NONNULL_BEGIN@interface UIScrollView (WD_NoData)&#x2F;&#x2F; éœ€è¦æ˜¾ç¤ºçš„å ä½é¡µé¢@property (nonatomic, strong) UIView *noDataView;@endNS_ASSUME_NONNULL_END å®ç°ä»£ç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101#import &quot;UIScrollView+WD_NoData.h&quot;#import &lt;objc&#x2F;runtime.h&gt;static char *noDataViewKey &#x3D; &quot;noDataViewKey&quot;;@implementation UIScrollView (WD_NoData)&#x2F;** äº¤æ¢æ–¹æ³• @param sel1 åŸæ–¹æ³• @param sel2 è‡ªå®šä¹‰æ–¹æ³• @param cls ç±» *&#x2F;void exchangeSelector(SEL sel1, SEL sel2, Class cls) &#123; Class class &#x3D; [cls class]; Method originalMethod &#x3D; class_getInstanceMethod(class, sel1); Method swizzledMethod &#x3D; class_getInstanceMethod(class, sel2); BOOL success &#x3D; class_addMethod(class, sel1, method_getImplementation(swizzledMethod), method_getTypeEncoding(swizzledMethod)); if (success) &#123; class_replaceMethod(class, sel2, method_getImplementation(originalMethod), method_getTypeEncoding(originalMethod)); &#125; else &#123; method_exchangeImplementations(originalMethod, swizzledMethod); &#125;&#125;#pragma mark &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; Setter &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;- (void)setNoDataView:(UIView *)noDataView &#123; static dispatch_once_t onceToken; dispatch_once(&amp;onceToken, ^&#123; exchangeSelector(@selector(reloadData), @selector(wd_reloadData), [self class]); &#125;); objc_setAssociatedObject(self, noDataViewKey, noDataView, OBJC_ASSOCIATION_RETAIN_NONATOMIC);&#125;#pragma mark &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; Getter &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;- (UIView *)noDataView &#123; UIView *noDataView &#x3D; objc_getAssociatedObject(self, noDataViewKey); noDataView.frame &#x3D; self.frame; return noDataView;&#125;- (void)wd_reloadData &#123; [self wd_reloadData]; [self wd_checkData];&#125;#pragma mark &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; è·å–æ•°æ® &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;- (void)wd_checkData &#123; NSInteger items &#x3D; 0; if (![self respondsToSelector:@selector(dataSource)]) &#123; return; &#125; &#x2F;&#x2F; UITableView support if ([self isKindOfClass:[UITableView class]]) &#123; UITableView *tableView &#x3D; (UITableView *)self; id &lt;UITableViewDataSource&gt; dataSource &#x3D; tableView.dataSource; NSInteger sections &#x3D; 1; if (dataSource &amp;&amp; [dataSource respondsToSelector:@selector(numberOfSectionsInTableView:)]) &#123; sections &#x3D; [dataSource numberOfSectionsInTableView:tableView]; &#125; if (dataSource &amp;&amp; [dataSource respondsToSelector:@selector(tableView:numberOfRowsInSection:)]) &#123; for (NSInteger section &#x3D; 0; section &lt; sections; section++) &#123; items +&#x3D; [dataSource tableView:tableView numberOfRowsInSection:section]; &#125; &#125; &#125; &#x2F;&#x2F; UICollectionView support else if ([self isKindOfClass:[UICollectionView class]]) &#123; UICollectionView *collectionView &#x3D; (UICollectionView *)self; id &lt;UICollectionViewDataSource&gt; dataSource &#x3D; collectionView.dataSource; NSInteger sections &#x3D; 1; if (dataSource &amp;&amp; [dataSource respondsToSelector:@selector(numberOfSectionsInCollectionView:)]) &#123; sections &#x3D; [dataSource numberOfSectionsInCollectionView:collectionView]; &#125; if (dataSource &amp;&amp; [dataSource respondsToSelector:@selector(collectionView:numberOfItemsInSection:)]) &#123; for (NSInteger section &#x3D; 0; section &lt; sections; section++) &#123; items +&#x3D; [dataSource collectionView:collectionView numberOfItemsInSection:section]; &#125; &#125; &#125; if ( items &#x3D;&#x3D; 0 ) &#123; [self.superview addSubview:self.noDataView]; &#125; else &#123; [self.noDataView removeFromSuperview]; &#125;&#125;@end äºŒã€ä½¿ç”¨æ–¹æ³• 123#import &quot;UIScrollView+WD_NoData.h&quot;&#x2F;&#x2F; è‡ªå®šä¹‰é¡µé¢#import &quot;WDTestEmptyView.h&quot; 1234&#x2F;&#x2F;ç¤ºä¾‹çš„è§†å›¾ WDTestEmptyView *view &#x3D; [NSBundle.mainBundle loadNibNamed:@&quot;WDTestEmptyView&quot; owner:self options:nil].firstObject;&#x2F;&#x2F; è®¾ç½®è§†å›¾self.tableView.noDataView &#x3D; view; ä¸‰ã€æ•ˆæœå›¾","categories":[{"name":"Objective-C","slug":"Objective-C","permalink":"https://github.com/wuvdan/wuvdan.github.io/categories/Objective-C/"}],"tags":[{"name":"è‡ªå®šä¹‰æ§ä»¶","slug":"è‡ªå®šä¹‰æ§ä»¶","permalink":"https://github.com/wuvdan/wuvdan.github.io/tags/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6/"}]},{"title":"iOSè‡ªå®šä¹‰æ§ä»¶-PopMenu","slug":"iOSè‡ªå®šä¹‰æ§ä»¶-PopMenu","date":"2020-01-16T08:06:05.203Z","updated":"2020-01-20T02:06:59.932Z","comments":true,"path":"2020/01/16/iOSè‡ªå®šä¹‰æ§ä»¶-PopMenu/","link":"","permalink":"https://github.com/wuvdan/wuvdan.github.io/2020/01/16/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-PopMenu/","excerpt":"","text":"ç°åœ¨å¾ˆå¤šçš„åº”ç”¨éƒ½æœ‰ç±»ä¼¼çš„å¼¹çª—æ§ä»¶ï¼Œæœ€å‡ºååº”è¯¥æ˜¯ä¼é¹…å’Œå¾®ä¿¡äº†å§ã€‚æƒ³ç€ä¸ºäº†æ»¡è¶³è‡ªå·±çš„æ•ˆæœå°±åŠ¨æ‰‹å†™äº†è¿™ä¸ªã€‚é¦–å…ˆè¦æ„Ÿè°¢å†™å‡ºå¼¹çª—ç®­å¤´çš„ä»£ç çš„äººiHandleï¼Œè¿™æ–¹é¢çš„çŸ¥è¯†æˆ‘å¾ˆæ¬ ç¼ºï¼Œä»¥åæ‰¾æœºä¼šæ¶è¡¥ä¸€ä¸‹ã€‚å…ˆä¸Šä¸¤å¼ å‡ºåçš„æ•ˆæœå›¾ï¼š æ ·å¼å®šä¹‰ä¸»è¦ä»¥UITableViewä½œä¸ºå®¹å™¨æ˜¾ç¤ºæ ·å¼ èƒŒæ™¯é¢œè‰² æ–‡å­—æ ·å¼ï¼šé¢œè‰²ï¼Œå­—ä½“å¤§å°ï¼Œå¯¹é½æ–¹å¼ æ˜¾ç¤ºç±»å‹ï¼šä»…æ–‡å­—ï¼Œä»…å›¾æ ‡ï¼Œæ–‡å­— + å›¾æ ‡ æ˜¯å¦æ˜¾ç¤ºä¸‹åˆ’çº¿ ç®­å¤´æ–¹å‘ å¼¹çª—å®½åº¦ å•å…ƒæ ¼çš„é«˜åº¦ ç®­å¤´ç”Ÿæˆ123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152typedef NS_ENUM(NSInteger, ArrowDirection) &#123; ArrowDirectionRight &#x3D; 0, ArrowDirectionBottom, ArrowDirectionLeft, ArrowDirectionTop,&#125;;#define CORNER_RADIUS 8 &#x2F;&#x2F; é»˜è®¤çŸ©å½¢æ¡†åœ†è§’åŠå¾„#define ARROW_WIDTH 30 &#x2F;&#x2F; é»˜è®¤ç®­å¤´å®½å¸¦#define ARROW_HEIGHT 12 &#x2F;&#x2F; é»˜è®¤ç®­å¤´é«˜åº¦#define ARROW_DIRECTION 1 &#x2F;&#x2F; é»˜è®¤ç®­å¤´æ–¹å‘ï¼Œå‘ä¸‹#define ARROW_POSITION 0.5 &#x2F;&#x2F; é»˜è®¤ç®­å¤´ç›¸å¯¹ä½ç½®ï¼Œå±…ä¸­#define ARROW_RADIUS 3 &#x2F;&#x2F; é»˜è®¤ç®­å¤´æŒ‡å‘å¤„çš„åœ†è§’åŠå¾„@interface WudanLayer : NSObject@property (nonatomic, assign) CGFloat cornerRadius;@property (nonatomic, assign) CGFloat arrowRadius;@property (nonatomic, assign) CGFloat arrowHeight;@property (nonatomic, assign) CGFloat arrowWidth;@property (nonatomic, assign) ArrowDirection arrowDirection;@property (nonatomic, assign) CGFloat arrowPosition;@property (nonatomic, assign) CGSize size;- (instancetype)initWithSize:(CGSize)size;- (CAShapeLayer *)layer;@end@implementation WudanLayer#pragma mark - preparation- (NSMutableArray *)keyPoints &#123; NSMutableArray *points &#x3D; [NSMutableArray array]; CGPoint beginPoint; CGPoint topPoint; CGPoint endPoint; CGFloat validWidthForTopPoint &#x3D; _size.width - 2 * _cornerRadius - _arrowWidth; CGFloat validHeightForTopPoint &#x3D; _size.height - 2 * _cornerRadius - _arrowWidth; CGFloat x &#x3D; 0, y &#x3D; 0; CGFloat width &#x3D; _size.width, height &#x3D; _size.height; switch (_arrowDirection) &#123; case ArrowDirectionRight: &#123; width -&#x3D; _arrowHeight; topPoint &#x3D; CGPointMake(_size.width , _size.height &#x2F; 2 + validHeightForTopPoint*(_arrowPosition - 0.5)); beginPoint &#x3D; CGPointMake(topPoint.x - _arrowHeight, topPoint.y - _arrowWidth&#x2F;2); endPoint &#x3D; CGPointMake(beginPoint.x, beginPoint.y + _arrowWidth); &#125; break; case ArrowDirectionBottom: &#123; height -&#x3D; _arrowHeight; topPoint &#x3D; CGPointMake(_size.width &#x2F; 2 + validWidthForTopPoint*(_arrowPosition - 0.5), _size.height); beginPoint &#x3D; CGPointMake(topPoint.x + _arrowWidth&#x2F;2, topPoint.y - _arrowHeight); endPoint &#x3D; CGPointMake(beginPoint.x - _arrowWidth, beginPoint.y); &#125; break; case ArrowDirectionLeft: &#123; x &#x3D; _arrowHeight; width -&#x3D; _arrowHeight; topPoint &#x3D; CGPointMake(0, _size.height &#x2F; 2 + validHeightForTopPoint*(_arrowPosition - 0.5)); beginPoint &#x3D; CGPointMake(topPoint.x + _arrowHeight, topPoint.y + _arrowWidth&#x2F;2); endPoint &#x3D; CGPointMake(beginPoint.x, beginPoint.y - _arrowWidth); &#125; break; case ArrowDirectionTop: &#123; y &#x3D; _arrowHeight; height -&#x3D; _arrowHeight; topPoint &#x3D; CGPointMake(_size.width &#x2F; 2 + validWidthForTopPoint*(_arrowPosition - 0.5), 0); beginPoint &#x3D; CGPointMake(topPoint.x - _arrowWidth&#x2F;2, topPoint.y + _arrowHeight); endPoint &#x3D; CGPointMake(beginPoint.x + _arrowWidth, beginPoint.y); &#125; break; &#125; points &#x3D; [NSMutableArray arrayWithObjects: [NSValue valueWithCGPoint:beginPoint], [NSValue valueWithCGPoint:topPoint], [NSValue valueWithCGPoint:endPoint], nil]; CGPoint bottomRight &#x3D; CGPointMake(x + width, y + height); CGPoint bottomLeft &#x3D; CGPointMake(x, y + height); CGPoint topLeft &#x3D; CGPointMake(x, y); CGPoint topRight &#x3D; CGPointMake(x + width, y); NSMutableArray *rectPoints &#x3D; [NSMutableArray arrayWithObjects: [NSValue valueWithCGPoint:bottomRight], [NSValue valueWithCGPoint:bottomLeft], [NSValue valueWithCGPoint:topLeft], [NSValue valueWithCGPoint:topRight], nil]; int rectPointIndex &#x3D; (int)_arrowDirection; for(int i &#x3D; 0; i &lt; 4; ++i) &#123; [points addObject:[rectPoints objectAtIndex:rectPointIndex]]; rectPointIndex &#x3D; (rectPointIndex + 1) % 4; &#125; return points;&#125;#pragma mark - Draw bubblePath- (CGPathRef)bubblePath &#123; UIGraphicsBeginImageContextWithOptions(self.size, NO, 0.0); CGContextRef ctx &#x3D; UIGraphicsGetCurrentContext(); NSMutableArray *points &#x3D; [self keyPoints]; CGPoint currentPoint &#x3D; [[points objectAtIndex:6] CGPointValue]; CGContextMoveToPoint(ctx, currentPoint.x, currentPoint.y); CGPoint pointA, pointB; CGFloat radius; int i &#x3D; 0; while(1) &#123; if (i &gt; 6) break; radius &#x3D; i &lt; 3 ? _arrowRadius : _cornerRadius; pointA &#x3D; [[points objectAtIndex:i] CGPointValue]; pointB &#x3D; [[points objectAtIndex:(i + 1) % 7] CGPointValue]; CGContextAddArcToPoint(ctx, pointA.x, pointA.y, pointB.x, pointB.y, radius); i &#x3D; i + 1; &#125; CGContextClosePath(ctx); CGPathRef path &#x3D; CGContextCopyPath(ctx); CGContextRelease(ctx); return path;&#125;- (CAShapeLayer *)layer&#123; CAShapeLayer *layer &#x3D; [CAShapeLayer layer]; layer.path &#x3D; [self bubblePath]; return layer;&#125;#pragma mark - Setup- (void)setDefaultProperty &#123; _cornerRadius &#x3D; CORNER_RADIUS; _arrowWidth &#x3D; ARROW_WIDTH; _arrowHeight &#x3D; ARROW_HEIGHT; _arrowDirection &#x3D; ARROW_DIRECTION; _arrowPosition &#x3D; ARROW_POSITION; _arrowRadius &#x3D; ARROW_RADIUS;&#125;#pragma mark - Init- (instancetype)initWithSize:(CGSize)size &#123; if(self &#x3D; [super init]) &#123; [self setDefaultProperty]; _size &#x3D; size; &#125; return self;&#125;@end å•å…ƒæ ¼é»˜è®¤æ ·å¼123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172typedef NS_ENUM(NSInteger, WDPopMenuType) &#123; WDPopMenuTypeNormal, WDPopMenuTypeOnlyTitle, WDPopMenuTypeOnlyIcon,&#125;;@interface WDPopMenuCell : UITableViewCell@property (nonatomic, strong) UIImageView *iconImageView;@property (nonatomic, strong) UILabel *titleLabel;@property (nonatomic, assign) WDPopMenuType showType;@end@implementation WDPopMenuCell- (instancetype)initWithStyle:(UITableViewCellStyle)style reuseIdentifier:(NSString *)reuseIdentifier &#123; self &#x3D; [super initWithStyle:style reuseIdentifier:reuseIdentifier]; if (self) &#123; [self setupSubViewsProperties]; &#125; return self;&#125;- (void)setupSubViewsProperties &#123; self.iconImageView &#x3D; [[UIImageView alloc] init]; self.iconImageView.contentMode &#x3D; UIViewContentModeScaleAspectFit; self.iconImageView.translatesAutoresizingMaskIntoConstraints &#x3D; NO; [self.contentView addSubview:self.iconImageView]; self.titleLabel &#x3D; [[UILabel alloc] init]; self.titleLabel.font &#x3D; [UIFont systemFontOfSize:15]; self.titleLabel.textColor &#x3D; [UIColor blackColor]; self.titleLabel.translatesAutoresizingMaskIntoConstraints &#x3D; NO; [self.contentView addSubview:self.titleLabel];&#125;- (void)setShowType:(WDPopMenuType)showType &#123; _showType &#x3D; showType; [self setupSubViewsConstraint];&#125;- (void)setTitleLabel:(UILabel *)titleLabel &#123; _titleLabel &#x3D; titleLabel; titleLabel.translatesAutoresizingMaskIntoConstraints &#x3D; NO;&#125;- (void)setupSubViewsConstraint &#123; if (self.showType &#x3D;&#x3D; WDPopMenuTypeNormal) &#123; self.titleLabel.textAlignment &#x3D; NSTextAlignmentLeft; [self.contentView addConstraints:@[ [NSLayoutConstraint constraintWithItem:self.iconImageView attribute:NSLayoutAttributeLeading relatedBy:NSLayoutRelationEqual toItem:self.contentView attribute:NSLayoutAttributeLeading multiplier:1 constant:15], [NSLayoutConstraint constraintWithItem:self.iconImageView attribute:NSLayoutAttributeCenterY relatedBy:NSLayoutRelationEqual toItem:self.contentView attribute:NSLayoutAttributeCenterY multiplier:1 constant:0], ]]; [self.contentView addConstraints:@[ [NSLayoutConstraint constraintWithItem:self.titleLabel attribute:NSLayoutAttributeLeading relatedBy:NSLayoutRelationEqual toItem:self.iconImageView attribute:NSLayoutAttributeTrailing multiplier:1 constant:10], [NSLayoutConstraint constraintWithItem:self.titleLabel attribute:NSLayoutAttributeCenterY relatedBy:NSLayoutRelationEqual toItem:self.contentView attribute:NSLayoutAttributeCenterY multiplier:1 constant:0], ]]; &#125; else if (self.showType &#x3D;&#x3D; WDPopMenuTypeOnlyTitle)&#123; self.titleLabel.textAlignment &#x3D; NSTextAlignmentCenter; [self.contentView addConstraints:@[ [NSLayoutConstraint constraintWithItem:self.titleLabel attribute:NSLayoutAttributeCenterX relatedBy:NSLayoutRelationEqual toItem:self.contentView attribute:NSLayoutAttributeCenterX multiplier:1 constant:0], [NSLayoutConstraint constraintWithItem:self.titleLabel attribute:NSLayoutAttributeCenterY relatedBy:NSLayoutRelationEqual toItem:self.contentView attribute:NSLayoutAttributeCenterY multiplier:1 constant:0], ]]; &#125; else &#123; [self.contentView addConstraints:@[ [NSLayoutConstraint constraintWithItem:self.iconImageView attribute:NSLayoutAttributeCenterX relatedBy:NSLayoutRelationEqual toItem:self.contentView attribute:NSLayoutAttributeCenterX multiplier:1 constant:0], [NSLayoutConstraint constraintWithItem:self.iconImageView attribute:NSLayoutAttributeCenterY relatedBy:NSLayoutRelationEqual toItem:self.contentView attribute:NSLayoutAttributeCenterY multiplier:1 constant:0], ]]; &#125;&#125;@end æ¥å£ä»£ç 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140#import &lt;UIKit&#x2F;UIKit.h&gt;NS_ASSUME_NONNULL_BEGIN@interface WDPopMenu : UIView@property (nonatomic, copy, readonly) NSArray&lt;NSString *&gt; *titles;@property (nonatomic, copy, readonly) NSArray&lt;NSString *&gt; *iconImageNames;&#x2F;** ä»…æ˜¾ç¤ºå›¾æ ‡ + é»˜è®¤æ ·å¼ @param iconImageNames å›¾æ ‡æ•°ç»„ @param position åˆå§‹ä½ç½® @param complete ç‚¹å‡»å›è°ƒ *&#x2F;+ (void)showPopMenuWithIconImageNames:(NSArray&lt;NSString *&gt; *)iconImageNames originPosition:(CGPoint)position selectedItemComplete:(void(^)(NSInteger currentIndex))complete;&#x2F;** ä»…æ˜¾ç¤ºå›¾æ ‡ + é»˜è®¤æ ·å¼ @param iconImageNames å›¾æ ‡æ•°ç»„ @param position åˆå§‹ä½ç½® @param isNeedSeparatorLine æ˜¯å¦æ˜¾ç¤ºåˆ†å‰²çº¿ @param complete ç‚¹å‡»å›è°ƒ *&#x2F;+ (void)showPopMenuWithIconImageNames:(NSArray&lt;NSString *&gt; *)iconImageNames originPosition:(CGPoint)position needSeparatorLine:(BOOL)isNeedSeparatorLine selectedItemComplete:(void(^)(NSInteger currentIndex))complete;&#x2F;** ä»…æ˜¾ç¤ºæ ‡é¢˜ + é»˜è®¤æ ·å¼ @param titles æ ‡é¢˜æ•°ç»„ @param position åˆå§‹ä½ç½® @param complete ç‚¹å‡»å›è°ƒ *&#x2F;+ (void)showPopMenuWithTitles:(NSArray&lt;NSString *&gt; *)titles originPosition:(CGPoint)position selectedItemComplete:(void(^)(NSInteger currentIndex))complete;&#x2F;** ä»…æ˜¾ç¤ºæ ‡é¢˜ + é»˜è®¤æ ·å¼ @param titles æ ‡é¢˜æ•°ç»„ @param position åˆå§‹ä½ç½® @param isNeedSeparatorLine æ˜¯å¦æ˜¾ç¤ºåˆ†å‰²çº¿ @param complete ç‚¹å‡»å›è°ƒ *&#x2F;+ (void)showPopMenuWithTitles:(NSArray&lt;NSString *&gt; *)titles originPosition:(CGPoint)position needSeparatorLine:(BOOL)isNeedSeparatorLine selectedItemComplete:(void(^)(NSInteger currentIndex))complete;&#x2F;** æ˜¾ç¤ºæ–‡å­—å’Œå›¾æ ‡ + é»˜è®¤æ ·å¼ @param iconImageNames å›¾æ ‡æ•°ç»„ @param titles æ ‡é¢˜æ•°ç»„ @param position åˆå§‹ä½ç½® @param complete ç‚¹å‡»å›è°ƒ *&#x2F;+ (void)showPopMenuWithIconImageNames:(NSArray&lt;NSString *&gt; * _Nullable)iconImageNames titles:(NSArray&lt;NSString *&gt; * _Nullable)titles originPosition:(CGPoint)position selectedItemComplete:(void(^)(NSInteger currentIndex))complete;&#x2F;** æ˜¾ç¤ºæ–‡å­—å’Œå›¾æ ‡ + é»˜è®¤æ ·å¼ @param iconImageNames å›¾æ ‡æ•°ç»„ @param titles æ ‡é¢˜æ•°ç»„ @param position åˆå§‹ä½ç½® @param isNeedSeparatorLine æ˜¯å¦æ˜¾ç¤ºåˆ†å‰²çº¿ @param complete ç‚¹å‡»å›è°ƒ *&#x2F;+ (void)showPopMenuWithIconImageNames:(NSArray&lt;NSString *&gt; * _Nullable)iconImageNames titles:(NSArray&lt;NSString *&gt; * _Nullable)titles originPosition:(CGPoint)position needSeparatorLine:(BOOL)isNeedSeparatorLine selectedItemComplete:(void(^)(NSInteger currentIndex))complete;&#x2F;** å¯é€‰æ˜¾ç¤ºå›¾æ ‡ã€æ ‡é¢˜ @param iconImageNames å›¾ç‰‡æ•°ç»„ å¯ä»¥ä¸ºç©º @param titles æ ‡é¢˜æ•°ç»„ å¯ä»¥ä¸ºç©º @param position åˆå§‹ä½ç½® @param height å•ä¸ªitemé«˜åº¦ é»˜è®¤ä¸º45 @param width æ˜¾ç¤ºViewçš„é«˜åº¦ é»˜è®¤ä¸ºå±å¹•å®½åº¦çš„ä¸€åŠ @param color æ˜¾ç¤ºViewçš„èƒŒæ™¯é¢œè‰² @param isNeedSeparatorLine æ˜¯å¦æ˜¾ç¤ºåˆ†å‰²çº¿ @param complete ç‚¹å‡»å›è°ƒ *&#x2F;+ (void)showPopMenuWithIconImageNames:(NSArray&lt;NSString *&gt; * _Nullable)iconImageNames titles:(NSArray&lt;NSString *&gt; * _Nullable)titles originPosition:(CGPoint)position heightOfItem:(CGFloat)height widthOfView:(CGFloat)width backgroundColorOfView:(UIColor *)color needSeparatorLine:(BOOL)isNeedSeparatorLine selectedItemComplete:(void(^)(NSInteger currentIndex))complete;&#x2F;** å¯é€‰æ˜¾ç¤ºå›¾æ ‡ã€æ ‡é¢˜ @param iconImageNames å›¾ç‰‡æ•°ç»„ å¯ä»¥ä¸ºç©º @param titles æ ‡é¢˜æ•°ç»„ å¯ä»¥ä¸ºç©º @param position åˆå§‹ä½ç½® @param height å•ä¸ªitemé«˜åº¦ é»˜è®¤ä¸º45 @param width æ˜¾ç¤ºViewçš„é«˜åº¦ é»˜è®¤ä¸ºå±å¹•å®½åº¦çš„ä¸€åŠ @param color æ˜¾ç¤ºViewçš„èƒŒæ™¯é¢œè‰² @param isNeedSeparatorLine æ˜¯å¦æ˜¾ç¤ºåˆ†å‰²çº¿ @param titleLabel è‡ªå®šä¹‰Itemçš„Labelæ ·å¼ @param complete ç‚¹å‡»å›è°ƒ *&#x2F;+ (void)showPopMenuWithIconImageNames:(NSArray&lt;NSString *&gt; * _Nullable)iconImageNames titles:(NSArray&lt;NSString *&gt; * _Nullable)titles originPosition:(CGPoint)position heightOfItem:(CGFloat)height widthOfView:(CGFloat)width backgroundColorOfView:(UIColor *)color titleLabelOfItem:(UILabel * _Nullable)titleLabel needSeparatorLine:(BOOL)isNeedSeparatorLine selectedItemComplete:(void(^)(NSInteger currentIndex))complete;@endNS_ASSUME_NONNULL_END å®ç°ä»£ç 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310#define WD_SCREEN_WIDTH ([[UIScreen mainScreen] bounds].size.width)#define WD_SCREEN_HEIGHT ([[UIScreen mainScreen] bounds].size.height)@interface WDPopMenu () &lt;UITableViewDataSource, UITableViewDelegate&gt;@property (nonatomic, copy) void (^selectedItemComplete)(NSInteger currentIndex);@property (nonatomic, strong) UIView *backgroundView;@property (nonatomic, strong) UITableView *tableView;@property (nonatomic, strong) UILabel *titleLabel;@property (nonatomic, assign) CGFloat viewWidth;@property (nonatomic, assign) CGFloat itemHeight;@property (nonatomic, assign) CGPoint beginPosition;@property (nonatomic, strong) UIColor *cellColor;@property (nonatomic, copy, readwrite) NSArray&lt;NSString *&gt; *titles;@property (nonatomic, copy, readwrite) NSArray&lt;NSString *&gt; *iconImageNames;@end@implementation WDPopMenu- (instancetype)init &#123; self &#x3D; [super init]; if (self) &#123; [self addSubview:self.tableView]; UITapGestureRecognizer *tap &#x3D; [[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(backgroundTappedTarget:)]; [self.backgroundView addGestureRecognizer:tap]; &#125; return self;&#125;+ (void)showPopMenuWithIconImageNames:(NSArray&lt;NSString *&gt; *)iconImageNames originPosition:(CGPoint)position selectedItemComplete:(void(^)(NSInteger currentIndex))complete &#123; [self showPopMenuWithIconImageNames:iconImageNames originPosition:position needSeparatorLine:YES selectedItemComplete:complete];&#125;+ (void)showPopMenuWithIconImageNames:(NSArray&lt;NSString *&gt; *)iconImageNames originPosition:(CGPoint)position needSeparatorLine:(BOOL)isNeedSeparatorLine selectedItemComplete:(void(^)(NSInteger currentIndex))complete &#123; [self showPopMenuWithIconImageNames:iconImageNames titles:nil originPosition:position needSeparatorLine:isNeedSeparatorLine selectedItemComplete:complete];&#125;+ (void)showPopMenuWithTitles:(NSArray&lt;NSString *&gt; *)titles originPosition:(CGPoint)position selectedItemComplete:(void(^)(NSInteger currentIndex))complete &#123; [self showPopMenuWithTitles:titles originPosition:position needSeparatorLine:YES selectedItemComplete:complete];&#125;+ (void)showPopMenuWithTitles:(NSArray&lt;NSString *&gt; *)titles originPosition:(CGPoint)position needSeparatorLine:(BOOL)isNeedSeparatorLine selectedItemComplete:(void(^)(NSInteger currentIndex))complete &#123; [self showPopMenuWithIconImageNames:nil titles:titles originPosition:position needSeparatorLine:isNeedSeparatorLine selectedItemComplete:complete];&#125;+ (void)showPopMenuWithIconImageNames:(NSArray&lt;NSString *&gt; * _Nullable)iconImageNames titles:(NSArray&lt;NSString *&gt; * _Nullable)titles originPosition:(CGPoint)position selectedItemComplete:(void(^)(NSInteger currentIndex))complete &#123; [self showPopMenuWithIconImageNames:iconImageNames titles:titles originPosition:position needSeparatorLine:YES selectedItemComplete:complete];&#125;+ (void)showPopMenuWithIconImageNames:(NSArray&lt;NSString *&gt; * _Nullable)iconImageNames titles:(NSArray&lt;NSString *&gt; * _Nullable)titles originPosition:(CGPoint)position needSeparatorLine:(BOOL)isNeedSeparatorLine selectedItemComplete:(void(^)(NSInteger currentIndex))complete &#123; [self showPopMenuWithIconImageNames:iconImageNames titles:titles originPosition:position heightOfItem:0 widthOfView:0 backgroundColorOfView:[UIColor whiteColor] needSeparatorLine:isNeedSeparatorLine selectedItemComplete:complete];&#125;+ (void)showPopMenuWithIconImageNames:(NSArray&lt;NSString *&gt; * _Nullable)iconImageNames titles:(NSArray&lt;NSString *&gt; * _Nullable)titles originPosition:(CGPoint)position heightOfItem:(CGFloat)height widthOfView:(CGFloat)width backgroundColorOfView:(UIColor *)color needSeparatorLine:(BOOL)isNeedSeparatorLine selectedItemComplete:(void(^)(NSInteger currentIndex))complete &#123; [self showPopMenuWithIconImageNames:iconImageNames titles:titles originPosition:position heightOfItem:height widthOfView:width backgroundColorOfView:color titleLabelOfItem:nil needSeparatorLine:isNeedSeparatorLine selectedItemComplete:complete];&#125;+ (void)showPopMenuWithIconImageNames:(NSArray&lt;NSString *&gt; * _Nullable)iconImageNames titles:(NSArray&lt;NSString *&gt; * _Nullable)titles originPosition:(CGPoint)position heightOfItem:(CGFloat)height widthOfView:(CGFloat)width backgroundColorOfView:(UIColor *)color titleLabelOfItem:(UILabel * _Nullable)titleLabel needSeparatorLine:(BOOL)isNeedSeparatorLine selectedItemComplete:(void(^)(NSInteger currentIndex))complete &#123; WDPopMenu *v &#x3D; [[WDPopMenu alloc] init]; v.iconImageNames &#x3D; iconImageNames; v.titles &#x3D; titles; v.beginPosition &#x3D; position; v.itemHeight &#x3D; height &#x3D;&#x3D; 0 ? 45 : height; v.viewWidth &#x3D; width &#x3D;&#x3D; 0 ? [[UIScreen mainScreen] bounds].size.width &#x2F; 2 : width; v.tableView.backgroundColor &#x3D; color; v.cellColor &#x3D; color; v.titleLabel &#x3D; titleLabel; v.selectedItemComplete &#x3D; complete; v.tableView.rowHeight &#x3D; v.itemHeight; if (isNeedSeparatorLine) &#123; v.tableView.separatorStyle &#x3D; UITableViewCellSeparatorStyleSingleLine; &#125; else &#123; v.tableView.separatorStyle &#x3D; UITableViewCellSeparatorStyleNone; &#125; [v.tableView reloadData]; [v showView];&#125;- (void)backgroundTappedTarget:(id)sender &#123; [self hidenView];&#125;- (void)showView &#123; [[[UIApplication sharedApplication] keyWindow] addSubview:self.backgroundView]; [[[UIApplication sharedApplication] keyWindow] addSubview:self]; [self setupViewAndArrowShape]; [self showAnimation];&#125;- (void)setupViewAndArrowShape &#123; CGRect toFrame &#x3D; CGRectZero; toFrame.size.width &#x3D; self.viewWidth; if (self.iconImageNames.count &#x3D;&#x3D; 0 || self.iconImageNames &#x3D;&#x3D; nil) &#123; toFrame.size.height &#x3D; self.itemHeight * self.titles.count + 15; &#125; else if (self.titles &#x3D;&#x3D; nil || self.titles.count &#x3D;&#x3D; 0) &#123; toFrame.size.height &#x3D; self.itemHeight * self.iconImageNames.count + 15; &#125; else &#123; toFrame.size.height &#x3D; self.itemHeight * self.titles.count + 15; &#125; WudanLayer *bbLayer &#x3D; [[WudanLayer alloc] initWithSize:toFrame.size]; if (self.beginPosition.x + self.viewWidth &#x2F; 2 &gt; WD_SCREEN_WIDTH) &#123; toFrame.origin.x &#x3D; WD_SCREEN_WIDTH - 10 - self.viewWidth; bbLayer.arrowDirection &#x3D; ArrowDirectionTop; bbLayer.arrowPosition &#x3D; (self.beginPosition.x - toFrame.origin.x + 15) &#x2F; self.viewWidth; self.layer.anchorPoint &#x3D; CGPointMake(bbLayer.arrowPosition, 0); &#125; else if (self.beginPosition.x - self.viewWidth &#x2F; 2 &lt; 0)&#123; toFrame.origin.x &#x3D; 10; bbLayer.arrowDirection &#x3D; ArrowDirectionTop; bbLayer.arrowPosition &#x3D; (self.beginPosition.x - toFrame.origin.x - 15) &#x2F; self.viewWidth; self.layer.anchorPoint &#x3D; CGPointMake(bbLayer.arrowPosition, 0); &#125; else &#123; toFrame.origin.x &#x3D; self.beginPosition.x - self.viewWidth &#x2F; 2; bbLayer.arrowDirection &#x3D; ArrowDirectionTop; bbLayer.arrowPosition &#x3D; (self.beginPosition.x - toFrame.origin.x) &#x2F; self.viewWidth; self.layer.anchorPoint &#x3D; CGPointMake(bbLayer.arrowPosition, 0); &#125; if (self.beginPosition.y + toFrame.size.height &gt; WD_SCREEN_HEIGHT) &#123; toFrame.origin.y &#x3D; self.beginPosition.y - toFrame.size.height - 15; bbLayer.arrowDirection &#x3D; ArrowDirectionBottom; self.layer.anchorPoint &#x3D; CGPointMake(bbLayer.arrowPosition, 1); &#125; else &#123; toFrame.origin.y &#x3D; self.beginPosition.y + 15; &#125; self.tableView.frame &#x3D; CGRectZero; self.frame &#x3D; CGRectMake(self.beginPosition.x, self.beginPosition.y, 0, 0); self.alpha &#x3D; 0; self.frame &#x3D; toFrame; if (self.beginPosition.y + toFrame.size.height &gt; WD_SCREEN_HEIGHT) &#123; self.tableView.contentInset &#x3D; UIEdgeInsetsZero; &#125; else &#123; self.tableView.contentInset &#x3D; UIEdgeInsetsMake(15, 0, 0, 0); &#125; self.tableView.frame &#x3D; CGRectMake(0, 0, toFrame.size.width, toFrame.size.height); bbLayer.cornerRadius &#x3D; 8; bbLayer.arrowHeight &#x3D; 15; bbLayer.arrowWidth &#x3D; 30; bbLayer.arrowRadius &#x3D; 0; [self.layer setMask:[bbLayer layer]];&#125;- (void)showAnimation &#123; self.layer.affineTransform &#x3D; CGAffineTransformMakeScale(0.1, 0.1); [UIView animateWithDuration:0.35 animations:^&#123; self.backgroundView.backgroundColor &#x3D; [UIColor colorWithWhite:0 alpha:0.1]; self.alpha &#x3D; 1; self.layer.affineTransform &#x3D; CGAffineTransformIdentity; &#125;];&#125;- (void)hidenView &#123; [UIView animateWithDuration:0.35 animations:^&#123; self.alpha &#x3D; 0; self.layer.affineTransform &#x3D; CGAffineTransformMakeScale(0.1, 0.1); self.backgroundView.backgroundColor &#x3D; [UIColor colorWithWhite:0 alpha:0]; &#125; completion:^(BOOL finished) &#123; [self removeFromSuperview]; self.layer.affineTransform &#x3D; CGAffineTransformIdentity; [self.backgroundView removeFromSuperview]; &#125;];&#125;#pragma mark - UITableView DataSource Method- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section &#123; if (self.titles.count &gt; 0) &#123; return self.titles.count; &#125; if (self.iconImageNames.count &gt; 0)&#123; return self.iconImageNames.count; &#125; return 0;&#125;- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath &#123; WDPopMenuCell *cell &#x3D; [tableView dequeueReusableCellWithIdentifier:@&quot;WDPopMenuCell&quot;]; if (!cell) &#123; cell &#x3D; [[WDPopMenuCell alloc] initWithStyle:UITableViewCellStyleDefault reuseIdentifier:@&quot;WDPopMenuCell&quot;]; &#125; if (self.iconImageNames.count &#x3D;&#x3D; 0 || self.iconImageNames &#x3D;&#x3D; nil) &#123; cell.showType &#x3D; WDPopMenuTypeOnlyTitle; cell.titleLabel.text &#x3D; self.titles[indexPath.row]; &#125; else if (self.titles &#x3D;&#x3D; nil || self.titles.count &#x3D;&#x3D; 0) &#123; cell.showType &#x3D; WDPopMenuTypeOnlyIcon; cell.iconImageView.image &#x3D; [UIImage imageNamed:self.iconImageNames[indexPath.row]]; &#125; else &#123; cell.showType &#x3D; WDPopMenuTypeNormal; cell.iconImageView.image &#x3D; [UIImage imageNamed:self.iconImageNames[indexPath.row]]; cell.titleLabel.text &#x3D; self.titles[indexPath.row]; &#125; if (self.titleLabel) &#123; cell.titleLabel.textColor &#x3D; self.titleLabel.textColor; cell.titleLabel.textAlignment &#x3D; self.titleLabel.textAlignment; cell.titleLabel.font &#x3D; self.titleLabel.font; &#125; cell.contentView.backgroundColor &#x3D; self.cellColor; if (indexPath.row &#x3D;&#x3D; [tableView numberOfRowsInSection:indexPath.section] - 1) &#123; cell.separatorInset &#x3D; UIEdgeInsetsMake(0, self.bounds.size.width, 0, 0); &#125; else &#123; cell.separatorInset &#x3D; UIEdgeInsetsMake(0, 0, 0, 0); &#125; return cell;&#125;#pragma mark - UITableView Delegate Method- (void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath &#123; [tableView deselectRowAtIndexPath:indexPath animated:YES]; [self hidenView]; self.selectedItemComplete(indexPath.row);&#125;#pragma mark - Setter- (UITableView *)tableView &#123; if (!_tableView) &#123; _tableView &#x3D; [[UITableView alloc] initWithFrame:CGRectZero style:UITableViewStylePlain]; _tableView.tableFooterView &#x3D; [[UIView alloc] init]; _tableView.dataSource &#x3D; self; _tableView.delegate &#x3D; self; _tableView.scrollEnabled &#x3D; NO; &#125; return _tableView;&#125;- (UIView *)backgroundView &#123; if (!_backgroundView) &#123; _backgroundView &#x3D; [[UIView alloc] initWithFrame:[[UIScreen mainScreen] bounds]]; &#125; return _backgroundView;&#125;@end å®ç°æ•ˆæœå›¾","categories":[],"tags":[]},{"title":"iOSè‡ªå®šä¹‰æ§ä»¶-AVPlayerå°è£…","slug":"iOSè‡ªå®šä¹‰æ§ä»¶-AVPlayerå°è£…","date":"2020-01-16T08:06:01.551Z","updated":"2020-01-20T02:07:52.977Z","comments":true,"path":"2020/01/16/iOSè‡ªå®šä¹‰æ§ä»¶-AVPlayerå°è£…/","link":"","permalink":"https://github.com/wuvdan/wuvdan.github.io/2020/01/16/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-AVPlayer%E5%B0%81%E8%A3%85/","excerpt":"","text":"æœ€è¿‘åœ¨å†™å…³äºéŸ³è§†é¢‘æ’­æ”¾çš„æ¡ˆä¾‹ï¼Œæ‰€ä»¥å°±è¶æœºä¼šç ”ç©¶äº†ä¸€ä¸‹AVPlayerçš„å†…å®¹ã€‚æˆ‘å°è£…çš„ç›®å‰åªèƒ½æ’­æ”¾ç½‘ç»œéŸ³è§†é¢‘ã€‚è¿˜æœªæ·»åŠ ç¼“å­˜ï¼Œä»¥åæ‰¾æœºä¼šç ”ç©¶ä¸€ä¸‹å†æ›´æ–°ã€‚ä»£ç ä¸­æä¾›äº†éŸ³è§†é¢‘çš„ä¸Šä¸€æ›²ã€ä¸‹ä¸€æ›²ã€æš‚åœã€å¼€å§‹ã€åœæ­¢ã€å•æ›²æ’­æ”¾ã€é¡ºåºæ’­æ”¾ã€éšæœºæ’­æ”¾ç­‰åŠŸèƒ½ã€‚ä»£ç å†™çš„ä¸å¥½ï¼Œä»…ä¾›å‚è€ƒ~ ä»£ç æ¥å£æ–‡ä»¶123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171#import &lt;Foundation&#x2F;Foundation.h&gt;#import &lt;AVFoundation&#x2F;AVFoundation.h&gt;NS_ASSUME_NONNULL_BEGIN&#x2F;&#x2F; å½“å‰æ’­æ”¾å™¨çš„æ’­æ”¾å½¢å¼typedef NS_ENUM(NSInteger, MediaPlayType) &#123; MediaPlayTypeCycle, &#x2F;&#x2F;&#x2F;&lt; é¡ºåº MediaPlayTypeSingle, &#x2F;&#x2F;&#x2F;&lt; å•æ›²å¾ªç¯ MediaPlayTypeRandom &#x2F;&#x2F;&#x2F;&lt; éšæœºæ’­æ”¾&#125;;&#x2F;&#x2F; å½“å‰æ’­æ”¾å™¨çš„æ’­æ”¾çŠ¶æ€typedef NS_ENUM(NSInteger, MediaPlayStatus) &#123; MediaPlayStatusStop, &#x2F;&#x2F;&#x2F;&lt; åœæ­¢æ’­æ”¾ MediaPlayStatusPause, &#x2F;&#x2F;&#x2F;&lt; æš‚åœæ’­æ”¾ MediaPlayStatusPlaying &#x2F;&#x2F;&#x2F;&lt; æ­£åœ¨æ’­æ”¾&#125;;&#x2F;&#x2F; åª’ä½“åŠ è½½çŠ¶æ€typedef NS_ENUM(NSInteger, MediaLoadStatus) &#123; MediaLoadStatusReadyToPlay, &#x2F;&#x2F;&#x2F;&lt; å‡†å¤‡æ’­æ”¾ MediaLoadStatusUnknown, &#x2F;&#x2F;&#x2F;&lt; æœªçŸ¥ MediaPlayStatusFailed &#x2F;&#x2F;&#x2F;&lt; å¤±è´¥&#125;;@class MediaPlyerManager;@protocol MediaPlyerManagerDelegate &lt;NSObject&gt;@optional&#x2F;&#x2F; æ•°æ®åŠ è½½çŠ¶æ€ æ ¹æ®çŠ¶æ€è¿›è¡Œæ’­æ”¾æˆ–å…¶ä»–æ“ä½œ- (void)MediaPlayer:(MediaPlyerManager *)playerManager playerItemStatus:(MediaLoadStatus)status;&#x2F;&#x2F; ç¼“å†²è¿›åº¦- (void)MediaPlayer:(MediaPlyerManager *)playerManager netBufferValue:(CGFloat)value;&#x2F;&#x2F; ç¼“å†²æ˜¯å¦è¶³å¤Ÿæ’­æ”¾- (void)MediaPlayer:(MediaPlyerManager *)playerManager bufferHasEnough:(BOOL)enough;&#x2F;&#x2F; å½“å‰æ’­æ”¾çš„æ—¶é—´- (void)MediaPlayer:(MediaPlyerManager *)playerManager currentPlayTime:(NSString *)time currentPlayTimeValue:(CGFloat)value;&#x2F;&#x2F; æ’­æ”¾æ€»æ—¶é—´- (void)MediaPlayer:(MediaPlyerManager *)playerManager mediaEndTime:(NSString *)time mediaEndTimeValue:(CGFloat)value;&#x2F;&#x2F; æ’­æ”¾ç»“æŸ- (void)MediaPlayerCurrentMediaPlayFinish:(MediaPlyerManager *)playerManager;&#x2F;&#x2F; æ’­æ”¾çŠ¶æ€- (void)MediaPlayer:(MediaPlyerManager *)playerManager playeStatus:(MediaPlayStatus)status;&#x2F;&#x2F; è·å–æ•°æ®åˆ‡æ¢æ—¶è·å–æ­£åœ¨æ’­æ”¾çš„URLå’Œå½“å‰çš„index- (void)MediaPlayer:(MediaPlyerManager *)playerManager currentUrl:(NSString *)url currentIndex:(NSInteger)index;&#x2F;&#x2F; ä¸ºäº†é…åˆæ‰‹æœºåå°æ’­æ”¾ å®æ—¶è·å–æ’­æ”¾çš„è¿›åº¦ï¼Œæ€»çš„æ—¶é—´ï¼Œå½“å‰çš„index&lt;é€šè¿‡indexè·å–å›¾ç‰‡ç­‰ä¿¡æ¯&gt;- (void)MediaPlayer:(MediaPlyerManager *)playerManager currentProgressValue:(CGFloat)value totalValue:(CGFloat)totalValue currentIndex:(NSInteger)index;@endtypedef MediaPlyerManager *(^playerCurrentTime)(NSString *time);@interface MediaPlyerManager : NSObject@property (nonatomic, strong, readonly) AVPlayer *mediaPlayer; &#x2F;&#x2F;&#x2F;&lt; æ’­æ”¾å™¨@property (nonatomic, strong, readonly) AVPlayerItem *meidaPlayerItem; &#x2F;&#x2F;&#x2F;&lt; æ’­æ”¾å™¨çš„CurrentItem@property (nonatomic, strong, readonly) NSMutableArray&lt;NSString*&gt; *dataUrlArray; &#x2F;&#x2F;&#x2F;&lt; æ­£åœ¨æ’­æ”¾çš„åˆ—è¡¨æ•°æ®@property (nonatomic, assign, readonly) MediaPlayType playType; &#x2F;&#x2F;&#x2F;&lt; å½“å‰æ’­æ”¾ç±»å‹@property (nonatomic, assign, readonly) MediaPlayStatus playStatus; &#x2F;&#x2F;&#x2F;&lt; å½“å‰æ’­æ”¾çŠ¶æ€@property (nonatomic, assign, readonly) NSInteger currentIndex; &#x2F;&#x2F;&#x2F;&lt; å½“å‰æ’­æ”¾çš„ç´¢å¼•@property (nonatomic, assign, readonly) BOOL isPlaying; &#x2F;&#x2F;&#x2F;&lt; æ˜¯å¦åœ¨æ’­æ”¾@property (nonatomic, assign, readonly) CGFloat curentPlayTimeValue; &#x2F;&#x2F;&#x2F;&lt; å½“å‰æ’­æ”¾æ—¶é—´å€¼@property (nonatomic, copy, readonly) NSString *curentPlayTime; &#x2F;&#x2F;&#x2F;&lt; å½“å‰æ’­æ”¾æ—¶é—´@property (nonatomic, assign, readonly) CGFloat endPlayTimeValue; &#x2F;&#x2F;&#x2F;&lt; å½“å‰æ’­æ”¾æ—¶é—´å€¼@property (nonatomic, copy, readonly) NSString *endPlayTime; &#x2F;&#x2F;&#x2F;&lt; å½“å‰æ’­æ”¾æ—¶é—´+ (instancetype)defaultManager;&#x2F;** åˆ—è¡¨æ’­æ”¾ âš ï¸&lt;é»˜è®¤ä¸è‡ªåŠ¨æ’­æ”¾&gt; @param urls æ–‡ä»¶è·¯å¾„æ•°ç»„ @param delegate å›è°ƒä»£ç† @return MediaPlyerManager *&#x2F;- (MediaPlyerManager *)playerWithUrls:(NSArray&lt;NSString *&gt; *)urls actionWithDelegate:(id&lt;MediaPlyerManagerDelegate&gt;)delegate;&#x2F;** å•ä¸ªéŸ³è§†é¢‘æ’­æ”¾ âš ï¸&lt;é»˜è®¤ä¸è‡ªåŠ¨æ’­æ”¾&gt; @param url æ–‡ä»¶è·¯å¾„ @param delegate å›è°ƒä»£ç† @return MediaPlyerManager *&#x2F;- (MediaPlyerManager *)playerWithUrl:(NSString *)url actionWithDelegate:(id&lt;MediaPlyerManagerDelegate&gt;)delegate;&#x2F;** å¼€å§‹æ’­æ”¾ *&#x2F;- (void)play;&#x2F;** æš‚åœæ’­æ”¾ *&#x2F;- (void)pause;&#x2F;** åœæ­¢æ’­æ”¾ *&#x2F;- (void)stop;&#x2F;** ä¸‹ä¸€æ›² *&#x2F;- (void)next;&#x2F;** ä¸Šä¸€æ›² *&#x2F;- (void)previous;&#x2F;** æŒ‡å®šè¿›åº¦å¼€å§‹æ’­æ”¾ @param progress è¿›åº¦ç™¾åˆ†æ¯” *&#x2F;- (void)setupPlayerSeekToProgress:(CGFloat)progress;&#x2F;** åˆ¶å®šæ’­æ”¾ç±»å‹ @param type ç±»å‹ *&#x2F;- (void)setupMediaPlayerType:(MediaPlayType)type;&#x2F;** æŒ‡å®šæ’­æ”¾çš„index @param index ç´¢å¼• *&#x2F;- (void)setupPlayerIndex:(NSInteger)index;&#x2F;** æ·»åŠ æ•°æ® @param files æ–‡ä»¶æ•°ç»„ @param index ç´¢å¼• *&#x2F;- (void)insertMediaFile:(NSArray&lt;NSString *&gt; *)files atIndex:(NSInteger)index;&#x2F;** ç§»é™¤å…¨éƒ¨æ•°æ® *&#x2F;- (void)removeAllFiles;&#x2F;** ç§»é™¤ç´¢å¼•ä¸­çš„å•ä¸ªæ•°æ® @param index ç´¢å¼• *&#x2F;- (void)removeObjectAtIndex:(NSInteger)index;&#x2F;** è®¾ç½®é”å±æ ·å¼ @param coverImage ä¸“è¾‘å›¾ç‰‡ @param size æ˜¾ç¤ºå¤§å° @param title æ ‡é¢˜ @param author ä¸“è¾‘ä½œè€… @param album ä¸“è¾‘åç§° @param currentTime å½“å‰æ’­æ”¾æ—¶é—´ @param duration æ’­æ”¾æ€»æ—¶é•¿ *&#x2F;- (void)setupLockScreenPlayInfo:(UIImage *)coverImage imageSize:(CGSize)size title:(NSString *)title ahthor:(NSString *)author album:(NSString *)album currentPlayTime:(CGFloat)currentTime duration:(CGFloat)duration;@endNS_ASSUME_NONNULL_END ä»£ç å®ç°æ–‡ä»¶123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382#import &quot;MediaPlyerManager.h&quot;#import &lt;MediaPlayer&#x2F;MediaPlayer.h&gt;@interface MediaPlyerManager ()@property (nonatomic, strong, readwrite) NSMutableArray&lt;NSString *&gt; *dataUrlArray;@property (nonatomic, strong, readwrite) AVPlayer *mediaPlayer;@property (nonatomic, assign, readwrite) BOOL isPlaying;@property (nonatomic, strong, readwrite) AVPlayerItem *meidaPlayerItem;@property (nonatomic, assign, readwrite) MediaPlayType playeType;@property (nonatomic, assign, readwrite) NSInteger currentIndex;@property (nonatomic, assign, readwrite) MediaPlayStatus playStatus;@property (nonatomic, assign, readwrite) CGFloat curentPlayTimeValue;@property (nonatomic, copy, readwrite ) NSString *curentPlayTime;@property (nonatomic, assign, readwrite) CGFloat endPlayTimeValue;@property (nonatomic, copy, readwrite ) NSString *endPlayTime;@property (nonatomic, weak ) id &lt;MediaPlyerManagerDelegate&gt; delegate;@end@implementation MediaPlyerManager+ (instancetype)defaultManager &#123; static dispatch_once_t onceToken; static MediaPlyerManager *manger; dispatch_once(&amp;onceToken, ^&#123; manger &#x3D; [[MediaPlyerManager alloc] init]; &#125;); return manger;&#125;#pragma mark - åˆå§‹åŒ–- (MediaPlyerManager *)playerWithUrl:(NSString *)url actionWithDelegate:(id&lt;MediaPlyerManagerDelegate&gt;)delegate &#123; [self playerWithUrls:@[url] actionWithDelegate:delegate]; return self;&#125;- (MediaPlyerManager *)playerWithUrls:(NSArray&lt;NSString *&gt; *)urls actionWithDelegate:(id&lt;MediaPlyerManagerDelegate&gt;)delegate &#123; self.delegate &#x3D; delegate; self.currentIndex &#x3D; 0; self.dataUrlArray &#x3D; [NSMutableArray array]; NSMutableArray *array &#x3D; [NSMutableArray arrayWithCapacity:urls.count]; for (NSString *urlStr in urls) &#123; [array addObject:[self createPlayerItemWithUrl:urlStr]]; [self.dataUrlArray addObject:urlStr]; &#125; self.playeType &#x3D; MediaPlayTypeCycle; self.mediaPlayer &#x3D; [[AVPlayer alloc] initWithPlayerItem:array.firstObject]; self.meidaPlayerItem &#x3D; self.mediaPlayer.currentItem; [self getCurrentIndex:self.currentIndex]; [self addObserver]; __weak typeof(self) weakself &#x3D; self; [self.mediaPlayer addPeriodicTimeObserverForInterval:CMTimeMake(1, 1) queue:NULL usingBlock:^(CMTime time) &#123; NSString *currentString &#x3D; [weakself getStringFromCMTime:time]; weakself.curentPlayTime &#x3D; currentString; weakself.curentPlayTimeValue &#x3D; (CGFloat)time.value&#x2F;time.timescale; #pragma mark - è·å–å½“å‰æ’­æ”¾æ—¶é—´ if (weakself.delegate &amp;&amp; [weakself.delegate respondsToSelector:@selector(MediaPlayer:currentPlayTime:currentPlayTimeValue:)]) &#123; [weakself.delegate MediaPlayer:weakself currentPlayTime:currentString currentPlayTimeValue:(CGFloat)time.value&#x2F;time.timescale]; &#125;#pragma mark - å®æ—¶è·å–æ’­æ”¾ä¿¡æ¯ if (self.delegate &amp;&amp; [self.delegate respondsToSelector:@selector(MediaPlayer:currentProgressValue:totalValue:currentIndex:)]) &#123; [weakself.delegate MediaPlayer:weakself currentProgressValue:weakself.curentPlayTimeValue totalValue:weakself.endPlayTimeValue currentIndex:weakself.currentIndex]; &#125; &#125;]; return self;&#125;#pragma mark - æ’­æ”¾ç»“æŸ- (void)playFinish:(NSNotification *)notification &#123; if (self.delegate &amp;&amp; [self.delegate respondsToSelector:@selector(MediaPlayerCurrentMediaPlayFinish:)]) &#123; [self.delegate MediaPlayerCurrentMediaPlayFinish:self]; &#125; if (self.playeType &#x3D;&#x3D; MediaPlayTypeSingle) &#123; [self.mediaPlayer seekToTime:kCMTimeZero]; [self play]; &#125; else &#123; if (self.currentIndex &lt; self.dataUrlArray.count - 1) &#123; self.currentIndex +&#x3D; 1; &#125; else &#123; self.currentIndex &#x3D; 0; &#125; [self.mediaPlayer replaceCurrentItemWithPlayerItem:[self createPlayerItemWithUrl:self.dataUrlArray[self.currentIndex]]]; self.meidaPlayerItem &#x3D; self.mediaPlayer.currentItem; [self getCurrentIndex:self.currentIndex]; [self play]; &#125;&#125;#pragma mark - KVO- (void)observeValueForKeyPath:(NSString *)keyPath ofObject:(id)object change:(NSDictionary&lt;NSKeyValueChangeKey,id&gt; *)change context:(void *)context &#123; AVPlayerItem *playerItem &#x3D; object; if ([keyPath isEqualToString:@&quot;status&quot;]) &#123; MediaLoadStatus status &#x3D; [change[@&quot;new&quot;] integerValue];#pragma mark - è·å–åª’ä½“åŠ è½½çŠ¶æ€ if (self.delegate &amp;&amp; [self.delegate respondsToSelector:@selector(MediaPlayer:playerItemStatus:)]) &#123; [self.delegate MediaPlayer:self playerItemStatus:status]; &#125; &#125; else if ([keyPath isEqualToString:@&quot;loadedTimeRanges&quot;]) &#123; NSArray * timeRanges &#x3D; playerItem.loadedTimeRanges; CMTimeRange timeRange &#x3D; [timeRanges.firstObject CMTimeRangeValue]; NSTimeInterval totalLoadTime &#x3D; CMTimeGetSeconds(timeRange.start) \\ + CMTimeGetSeconds(timeRange.duration); NSTimeInterval duration &#x3D; CMTimeGetSeconds(playerItem.duration); NSTimeInterval scale &#x3D; totalLoadTime&#x2F;duration; #pragma mark - è·å–åª’ä½“æ€»æ—¶é—´ if ((CGFloat)duration&#x2F;scale &gt;&#x3D; 0) &#123; self.endPlayTime &#x3D; [self getStringFromCMTime:playerItem.duration]; self.endPlayTimeValue &#x3D; (CGFloat)duration&#x2F;scale; if (self.delegate &amp;&amp; [self.delegate respondsToSelector:@selector(MediaPlayer:mediaEndTime:mediaEndTimeValue:)]) &#123; [self.delegate MediaPlayer:self mediaEndTime:[self getStringFromCMTime:playerItem.duration] mediaEndTimeValue:(CGFloat)duration&#x2F;scale]; &#125; &#125; #pragma mark - ç¼“å†²ç™¾åˆ†æ¯” if (self.delegate &amp;&amp; [self.delegate respondsToSelector:@selector(MediaPlayer:netBufferValue:)]) &#123; [self.delegate MediaPlayer:self netBufferValue:scale]; &#125; &#125; else if ([keyPath isEqualToString:@&quot;playbackBufferEmpty&quot;]) &#123; #pragma mark - ç¼“å†²ä¸è¶³å¤Ÿæ’­æ”¾ if (self.delegate &amp;&amp; [self.delegate respondsToSelector:@selector(MediaPlayer:bufferHasEnough:)]) &#123; [self.delegate MediaPlayer:self bufferHasEnough:false]; &#125; &#125; else if ([keyPath isEqualToString:@&quot;playbackLikelyToKeepUp&quot;]) &#123; #pragma mark - ç¼“å†²è¶³å¤Ÿæ’­æ”¾ if (self.delegate &amp;&amp; [self.delegate respondsToSelector:@selector(MediaPlayer:bufferHasEnough:)]) &#123; [self.delegate MediaPlayer:self bufferHasEnough:true]; &#125; &#125;&#125;#pragma mark - å¼€å§‹æ’­æ”¾- (void)play &#123; [self.mediaPlayer play]; [self getPlayStatus:MediaPlayStatusPlaying];&#125;#pragma mark - æš‚åœæ’­æ”¾- (void)pause &#123; [self.mediaPlayer pause]; [self getPlayStatus:MediaPlayStatusPause];&#125;#pragma mark - åœæ­¢æ’­æ”¾- (void)stop &#123; [self.mediaPlayer replaceCurrentItemWithPlayerItem:nil]; [self getPlayStatus:MediaPlayStatusStop]; [self removeObserver];&#125;#pragma mark - ä¸‹ä¸€ä¸ª- (void)next &#123; if (self.playeType &#x3D;&#x3D; MediaPlayTypeRandom) &#123; self.currentIndex &#x3D; (NSInteger)arc4random_uniform((int32_t)(self.dataUrlArray.count - 1)); &#125; else &#123; if (self.currentIndex &#x3D;&#x3D; self.dataUrlArray.count - 1) &#123; self.currentIndex &#x3D; 0; &#125; else &#123; self.currentIndex +&#x3D; 1; &#125; &#125; [self.mediaPlayer replaceCurrentItemWithPlayerItem:[self createPlayerItemWithUrl:self.dataUrlArray[self.currentIndex]]]; self.meidaPlayerItem &#x3D; self.mediaPlayer.currentItem; [self getCurrentIndex:self.currentIndex]; [self addObserver];&#125;#pragma mark - ä¸Šä¸€ä¸ª- (void)previous &#123; if (self.playeType &#x3D;&#x3D; MediaPlayTypeRandom) &#123; self.currentIndex &#x3D; (NSInteger)arc4random_uniform((int32_t)(self.dataUrlArray.count - 1)); &#125; else &#123; if (self.currentIndex &#x3D;&#x3D; 0) &#123; self.currentIndex &#x3D; self.dataUrlArray.count - 1; &#125; else &#123; self.currentIndex -&#x3D; 1; &#125; &#125; [self.mediaPlayer replaceCurrentItemWithPlayerItem:[self createPlayerItemWithUrl:self.dataUrlArray[self.currentIndex]]]; self.meidaPlayerItem &#x3D; self.mediaPlayer.currentItem; [self getCurrentIndex:self.currentIndex]; [self addObserver];&#125;#pragma mark - æ’­æ”¾çŠ¶æ€- (void)getPlayStatus:(MediaPlayStatus)status &#123; if (self.delegate &amp;&amp; [self.delegate respondsToSelector:@selector(MediaPlayer:playeStatus:)]) &#123; [self.delegate MediaPlayer:self playeStatus:status]; &#125; self.playStatus &#x3D; status; if (status &#x3D;&#x3D; MediaPlayStatusPlaying) &#123; self.isPlaying &#x3D; true; &#125; else &#123; self.isPlaying &#x3D; false; &#125;&#125;#pragma mark - æ ¹æ®indexè¿›è¡Œå›è°ƒ- (void)getCurrentIndex:(NSInteger)index &#123; if (self.delegate &amp;&amp; [self.delegate respondsToSelector:@selector(MediaPlayer:currentUrl:currentIndex:)]) &#123; [self.delegate MediaPlayer:self currentUrl:self.dataUrlArray[index] currentIndex:index]; &#125;&#125;#pragma mark - è®¾ç½®æ’­æ”¾è¿›åº¦ç™¾åˆ†æ¯”- (void)setupPlayerSeekToProgress:(CGFloat)progress &#123; float timeValue &#x3D; progress * CMTimeGetSeconds(self.mediaPlayer.currentItem.duration); [self.mediaPlayer seekToTime:CMTimeMake(timeValue, 1)];&#125;#pragma mark - è®¾ç½®æ’­æ”¾å½¢å¼- (void)setupMediaPlayerType:(MediaPlayType)type &#123; self.playeType &#x3D; type;&#125;#pragma mark - æ’­æ”¾æŒ‡å®šindexçš„åª’ä½“- (void)setupPlayerIndex:(NSInteger)index &#123; if (index &gt; (self.dataUrlArray.count - 1)) &#123; @throw [NSException exceptionWithName:@&quot;è¶Šç•Œé”™è¯¯&quot; reason:@&quot;index ä¸èƒ½è¶…å‡ºURLæ•°ç»„çš„é•¿åº¦&quot; userInfo:nil]; return; &#125; self.currentIndex &#x3D; index; [self.mediaPlayer replaceCurrentItemWithPlayerItem:[self createPlayerItemWithUrl:self.dataUrlArray[self.currentIndex]]]; self.meidaPlayerItem &#x3D; self.mediaPlayer.currentItem; [self getCurrentIndex:self.currentIndex];&#125;#pragma mark - æ’å…¥æ•°æ®- (void)insertMediaFile:(NSArray&lt;NSString *&gt; *)files atIndex:(NSInteger)index &#123; for (NSString *urlStr in files) &#123; NSInteger i &#x3D; [files indexOfObject:urlStr]; [self.dataUrlArray insertObject:urlStr atIndex:index + i]; &#125; if (index &lt; self.currentIndex) &#123; self.currentIndex +&#x3D; 1; &#125;&#125;#pragma mark - åˆ é™¤æ•°æ®- (void)removeAllFiles &#123; [self stop]; [self.dataUrlArray removeAllObjects]; self.dataUrlArray &#x3D; [NSMutableArray array]; self.currentIndex &#x3D; 0;&#125;- (void)removeObjectAtIndex:(NSInteger)index &#123; if (self.dataUrlArray.count &#x3D;&#x3D; 1) &#123; [self removeAllFiles]; &#125; else &#123; [self.dataUrlArray removeObjectAtIndex:index]; if (index &#x3D;&#x3D; self.currentIndex) &#123; if (index &#x3D;&#x3D; 0) &#123; self.currentIndex &#x3D; 0; [self next]; &#125; else &#123; self.currentIndex -&#x3D; 1; &#125; &#125; else &#123; if (self.currentIndex &gt; index) &#123; self.currentIndex -&#x3D; 1; &#125; &#125; &#125;&#125;#pragma mark - Utils- (NSString *)getStringFromCMTime:(CMTime)time &#123; float currentTimeValue &#x3D; (CGFloat)time.value&#x2F;time.timescale; NSDate * currentDate &#x3D; [NSDate dateWithTimeIntervalSince1970:currentTimeValue]; NSCalendar *calendar &#x3D; [[NSCalendar alloc] initWithCalendarIdentifier:NSCalendarIdentifierGregorian]; NSInteger unitFlags &#x3D; NSCalendarUnitHour | NSCalendarUnitMinute | NSCalendarUnitSecond; NSDateComponents *components &#x3D; [calendar components:unitFlags fromDate:currentDate]; if (currentTimeValue &gt;&#x3D; 3600 ) &#123; return [NSString stringWithFormat:@&quot;%02ld:%02ld:%02ld&quot;, (long)components.hour, (long)components.minute, (long)components.second]; &#125; else &#123; return [NSString stringWithFormat:@&quot;%02ld:%02ld&quot;, (long)components.minute, (long)components.second]; &#125;&#125;- (void)addObserver &#123; &#x2F;&#x2F; ç›‘æ§çŠ¶æ€å±æ€§ [self.meidaPlayerItem addObserver:self forKeyPath:@&quot;status&quot; options:(NSKeyValueObservingOptionOld|NSKeyValueObservingOptionNew) context:nil]; &#x2F;&#x2F; ç›‘æ§ç¼“å†²åŠ è½½æƒ…å†µå±æ€§ [self.meidaPlayerItem addObserver:self forKeyPath:@&quot;loadedTimeRanges&quot; options:(NSKeyValueObservingOptionOld|NSKeyValueObservingOptionNew) context:nil]; &#x2F;&#x2F; ç›‘å¬ç¼“å†²ä¸è¶³å¤Ÿæ’­æ”¾ [self.meidaPlayerItem addObserver:self forKeyPath:@&quot;playbackBufferEmpty&quot; options:NSKeyValueObservingOptionNew context:nil]; &#x2F;&#x2F; ç›‘å¬ç¼“å†²è¶³å¤Ÿæ’­æ”¾ [self.meidaPlayerItem addObserver:self forKeyPath:@&quot;playbackLikelyToKeepUp&quot; options:NSKeyValueObservingOptionNew context:nil]; &#x2F;&#x2F; è·å–æ˜¯å¦æ’­æ”¾ç»“æŸ [[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(playFinish:) name:AVPlayerItemDidPlayToEndTimeNotification object:self.meidaPlayerItem];&#125;- (void)removeObserver &#123; [[NSNotificationCenter defaultCenter] removeObserver:self]; @try &#123; [self.meidaPlayerItem removeObserver:self forKeyPath:@&quot;loadedTimeRanges&quot;]; [self.meidaPlayerItem removeObserver:self forKeyPath:@&quot;playbackBufferEmpty&quot;]; [self.meidaPlayerItem removeObserver:self forKeyPath:@&quot;playbackLikelyToKeepUp&quot;]; [self.meidaPlayerItem removeObserver:self forKeyPath:@&quot;status&quot;]; &#125; @catch(NSException *exception) &#123; NSLog(@&quot;%@&quot;, exception); &#125; &#125;#pragma mark - è®¾ç½®é”å±æ ·å¼- (void)setupLockScreenPlayInfo:(UIImage *)coverImage imageSize:(CGSize)size title:(NSString *)title ahthor:(NSString *)author album:(NSString *)album currentPlayTime:(CGFloat)currentTime duration:(CGFloat)duration &#123; Class playingInfoCenter &#x3D; NSClassFromString(@&quot;MPNowPlayingInfoCenter&quot;); if (playingInfoCenter) &#123; NSMutableDictionary *songInfo &#x3D; [[NSMutableDictionary alloc] init]; MPMediaItemArtwork *albumArt &#x3D; [[MPMediaItemArtwork alloc] initWithBoundsSize:size requestHandler:^UIImage * _Nonnull(CGSize size) &#123; return coverImage; &#125;]; [songInfo setObject:title forKey:MPMediaItemPropertyTitle]; [songInfo setObject:author forKey:MPMediaItemPropertyArtist]; [songInfo setObject:album forKey:MPMediaItemPropertyAlbumTitle]; [songInfo setObject:albumArt forKey:MPMediaItemPropertyArtwork]; [songInfo setObject:[NSNumber numberWithDouble:currentTime] forKey:MPNowPlayingInfoPropertyElapsedPlaybackTime]; [songInfo setObject:[NSNumber numberWithDouble:duration] forKey:MPMediaItemPropertyPlaybackDuration]; [[MPNowPlayingInfoCenter defaultCenter] setNowPlayingInfo:songInfo]; &#125;&#125;- (AVPlayerItem *)createPlayerItemWithUrl:(NSString *)url &#123; return [AVPlayerItem playerItemWithURL:[NSURL URLWithString:url]];&#125;@end æé—®æœ¬æ¥ç›¸åŒä½¿ç”¨AVQueuePlayeræ¥è¿›è¡Œåˆ—è¡¨æ’­æ”¾çš„ï¼Œä½†æ˜¯å½“åšå•æ›²å¾ªç¯çš„æ—¶å€™é‡åˆ°é—®é¢˜ï¼šé€šè¿‡é€šçŸ¥ç›‘å¬æ’­æ”¾å®Œæˆï¼Œåœ¨é€šçŸ¥çš„æ–¹æ³•é‡Œè¿›è¡Œå…·ä½“æ“ä½œï¼Œä½†æ˜¯è®¾ç½®æ— æ•ˆï¼Œç›´æ¥æ’­æ”¾çš„è¿˜æ˜¯ä¸‹ä¸€ä¸ªæ–‡ä»¶ã€‚å¦‚æœæœ‰äººçŸ¥é“å¦‚ä½•è§£å†³ï¼Œå¸®å¿™å›å¤ä¸€ä¸‹ã€‚","categories":[{"name":"Objective-C","slug":"Objective-C","permalink":"https://github.com/wuvdan/wuvdan.github.io/categories/Objective-C/"}],"tags":[{"name":"è‡ªå®šä¹‰æ§ä»¶","slug":"è‡ªå®šä¹‰æ§ä»¶","permalink":"https://github.com/wuvdan/wuvdan.github.io/tags/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6/"}]},{"title":"iOSé¢è¯•é¢˜-007","slug":"iOSé¢è¯•é¢˜-007","date":"2020-01-16T08:05:48.432Z","updated":"2020-01-20T01:42:43.602Z","comments":true,"path":"2020/01/16/iOSé¢è¯•é¢˜-007/","link":"","permalink":"https://github.com/wuvdan/wuvdan.github.io/2020/01/16/iOS%E9%9D%A2%E8%AF%95%E9%A2%98-007/","excerpt":"","text":"çº¿ç¨‹æ­»é”çš„å¿…è¦æ¡ä»¶ äº’æ–¥æ¡ä»¶ : ä¸€ä¸ªèµ„æºæ¯æ¬¡åªèƒ½è¢«ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨ã€‚ è¯·æ±‚ä¸ä¿æŒæ¡ä»¶ : ä¸€ä¸ªè¿›ç¨‹å› è¯·æ±‚èµ„æºè€Œé˜»å¡æ—¶ï¼Œå¯¹å·²è·å¾—çš„èµ„æºä¿æŒä¸æ”¾ã€‚ ä¸å‰¥å¤ºæ¡ä»¶ : è¿›ç¨‹å·²è·å¾—çš„èµ„æºï¼Œåœ¨æœ«ä½¿ç”¨å®Œä¹‹å‰ï¼Œä¸èƒ½å¼ºè¡Œå‰¥å¤ºã€‚ å¾ªç¯ç­‰å¾…æ¡ä»¶ : è‹¥å¹²è¿›ç¨‹ä¹‹é—´å½¢æˆä¸€ç§å¤´å°¾ç›¸æ¥çš„å¾ªç¯ç­‰å¾…èµ„æºå…³ç³»ã€‚ å¤šå›¾ä¸‹è½½ï¼Œæœ€ååˆå¹¶æˆä¸€ä¸ªå›¾ç‰‡çš„æ–¹å¼ dispatch_group ä¿¡å·é‡ NSOperationQueue çº¿ç¨‹ä¸è¿›ç¨‹çš„å…³ç³» è¿›ç¨‹æ˜¯èµ„æºçš„åˆ†é…å’Œè°ƒåº¦çš„ä¸€ä¸ªç‹¬ç«‹å•å…ƒï¼Œè€Œçº¿ç¨‹æ˜¯CPUè°ƒåº¦çš„åŸºæœ¬å•å…ƒ åŒä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥åŒ…æ‹¬å¤šä¸ªçº¿ç¨‹ï¼Œå¹¶ä¸”çº¿ç¨‹å…±äº«æ•´ä¸ªè¿›ç¨‹çš„èµ„æºï¼ˆå¯„å­˜å™¨ã€å †æ ˆã€ä¸Šä¸‹æ–‡ï¼‰ï¼Œä¸€ä¸ªè¿›è¡Œè‡³å°‘åŒ…æ‹¬ä¸€ä¸ªçº¿ç¨‹ã€‚ è¿›ç¨‹çš„åˆ›å»ºè°ƒç”¨forkæˆ–è€…vforkï¼Œè€Œçº¿ç¨‹çš„åˆ›å»ºè°ƒç”¨pthread_createï¼Œè¿›ç¨‹ç»“æŸåå®ƒæ‹¥æœ‰çš„æ‰€æœ‰çº¿ç¨‹éƒ½å°†é”€æ¯ï¼Œè€Œçº¿ç¨‹çš„ç»“æŸä¸ä¼šå½±å“åŒä¸ªè¿›ç¨‹ä¸­çš„å…¶ä»–çº¿ç¨‹çš„ç»“æŸ çº¿ç¨‹æ˜¯è½»ä¸¤çº§çš„è¿›ç¨‹ï¼Œå®ƒçš„åˆ›å»ºå’Œé”€æ¯æ‰€éœ€è¦çš„æ—¶é—´æ¯”è¿›ç¨‹å°å¾ˆå¤šï¼Œæ‰€æœ‰æ“ä½œç³»ç»Ÿä¸­çš„æ‰§è¡ŒåŠŸèƒ½éƒ½æ˜¯åˆ›å»ºçº¿ç¨‹å»å®Œæˆçš„ çº¿ç¨‹ä¸­æ‰§è¡Œæ—¶ä¸€èˆ¬éƒ½è¦è¿›è¡ŒåŒæ­¥å’Œäº’æ–¥ï¼Œå› ä¸ºä»–ä»¬å…±äº«åŒä¸€è¿›ç¨‹çš„æ‰€æœ‰èµ„æº çº¿ç¨‹æœ‰è‡ªå·±çš„ç§æœ‰å±æ€§TCBï¼Œçº¿ç¨‹idï¼Œå¯„å­˜å™¨ã€ç¡¬ä»¶ä¸Šä¸‹æ–‡ï¼Œè€Œè¿›ç¨‹ä¹Ÿæœ‰è‡ªå·±çš„ç§æœ‰å±æ€§è¿›ç¨‹æ§åˆ¶å—PCBï¼Œè¿™äº›ç§æœ‰å±æ€§æ˜¯ä¸è¢«å…±äº«çš„ï¼Œç”¨æ¥æ ‡ç¤ºä¸€ä¸ªè¿›ç¨‹æˆ–ä¸€ä¸ªçº¿ç¨‹çš„æ ‡å¿— çº¿ç¨‹ä¸Runloopçš„å…³ç³» RunLoop çš„ä½œç”¨å°±æ˜¯æ¥ç®¡ç†çº¿ç¨‹çš„ï¼Œå½“çº¿ç¨‹çš„ RunLoopå¼€å¯åï¼Œçº¿ç¨‹å°±ä¼šåœ¨æ‰§è¡Œå®Œä»»åŠ¡åï¼Œå¤„äºä¼‘çœ çŠ¶æ€ï¼Œéšæ—¶ç­‰å¾…æ¥å—æ–°çš„ä»»åŠ¡ï¼Œè€Œä¸æ˜¯é€€å‡ºã€‚ åªæœ‰ä¸»çº¿ç¨‹çš„RunLoopæ˜¯é»˜è®¤å¼€å¯çš„ï¼Œæ‰€ä»¥ç¨‹åºåœ¨å¼€å¯åï¼Œä¼šä¸€ç›´è¿è¡Œï¼Œä¸ä¼šé€€å‡ºã€‚å…¶ä»–çº¿ç¨‹çš„RunLoopå¦‚æœéœ€è¦å¼€å¯ï¼Œå°±æ‰‹åŠ¨å¼€å¯ã€‚","categories":[{"name":"é¢è¯•é¢˜","slug":"é¢è¯•é¢˜","permalink":"https://github.com/wuvdan/wuvdan.github.io/categories/%E9%9D%A2%E8%AF%95%E9%A2%98/"}],"tags":[{"name":"é¢è¯•æŠ€å·§","slug":"é¢è¯•æŠ€å·§","permalink":"https://github.com/wuvdan/wuvdan.github.io/tags/%E9%9D%A2%E8%AF%95%E6%8A%80%E5%B7%A7/"}]},{"title":"iOSé¢è¯•é¢˜-006","slug":"iOSé¢è¯•é¢˜-006","date":"2020-01-16T08:05:44.945Z","updated":"2020-01-20T01:42:53.393Z","comments":true,"path":"2020/01/16/iOSé¢è¯•é¢˜-006/","link":"","permalink":"https://github.com/wuvdan/wuvdan.github.io/2020/01/16/iOS%E9%9D%A2%E8%AF%95%E9%A2%98-006/","excerpt":"","text":"åŸºç¡€ å¦‚ä½•æ˜¯è‡ªå·±å†™çš„å¯¹è±¡å…·æœ‰æ‹·è´åŠŸèƒ½ éœ€å®ç° NSCopying åè®®ã€‚ è¯´è¯´ä½ å¦‚ä½•ç†è§£weakå±æ€§ Runtimeç»´æŠ¤äº†ä¸€ä¸ªweakè¡¨ï¼Œç”¨äºå­˜å‚¨æŒ‡å‘æŸä¸ªå¯¹è±¡çš„æ‰€æœ‰weakæŒ‡é’ˆã€‚weakè¡¨å…¶å®æ˜¯ä¸€ä¸ªhashï¼ˆå“ˆå¸Œï¼‰è¡¨ï¼ŒKeyæ˜¯æ‰€æŒ‡å¯¹è±¡çš„åœ°å€ï¼ŒValueæ˜¯weakæŒ‡é’ˆçš„åœ°å€ï¼ˆè¿™ä¸ªåœ°å€çš„å€¼æ˜¯æ‰€æŒ‡å¯¹è±¡çš„åœ°å€ï¼‰æ•°ç»„ã€‚1ã€åˆå§‹åŒ–æ—¶ï¼šruntimeä¼šè°ƒç”¨objc_initWeakå‡½æ•°ï¼Œåˆå§‹åŒ–ä¸€ä¸ªæ–°çš„weakæŒ‡é’ˆæŒ‡å‘å¯¹è±¡çš„åœ°å€ã€‚2ã€æ·»åŠ å¼•ç”¨æ—¶ï¼šobjc_initWeakå‡½æ•°ä¼šè°ƒç”¨ objc_storeWeak() å‡½æ•°ï¼Œ objc_storeWeak() çš„ä½œç”¨æ˜¯æ›´æ–°æŒ‡é’ˆæŒ‡å‘ï¼Œåˆ›å»ºå¯¹åº”çš„å¼±å¼•ç”¨è¡¨ã€‚3ã€é‡Šæ”¾æ—¶ï¼Œè°ƒç”¨clearDeallocatingå‡½æ•°ã€‚clearDeallocatingå‡½æ•°é¦–å…ˆæ ¹æ®å¯¹è±¡åœ°å€è·å–æ‰€æœ‰weakæŒ‡é’ˆåœ°å€çš„æ•°ç»„ï¼Œç„¶åéå†è¿™ä¸ªæ•°ç»„æŠŠå…¶ä¸­çš„æ•°æ®è®¾ä¸ºnilï¼Œæœ€åæŠŠè¿™ä¸ªentryä»weakè¡¨ä¸­åˆ é™¤ï¼Œæœ€åæ¸…ç†å¯¹è±¡çš„è®°å½•ã€‚ UIViewå’ŒCALayerçš„å…³ç³» æ¯ä¸ªUIViewéƒ½å¯¹åº”ç€ä¸€ä¸ªCALayer,å½“æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªUIViewä¹‹åä¹Ÿä¼šåˆ›å»ºå¯¹åº”çš„CALayerã€‚UIViewä¹‹æ‰€ä»¥èƒ½å¤Ÿæ˜¾ç¤ºå†…å®¹ï¼Œå…¶å®è¿˜æ˜¯é CALayeræ¥ç»˜åˆ¶çš„ã€‚UIViewæœ¬èº«å°±åƒæ˜¯CALayerçš„ç®¡ç†è€…ï¼Œè®¿é—®UIViewçš„åæ ‡ï¼Œä¾‹å¦‚ï¼šframeï¼Œcenterç­‰ï¼Œå…¶å®æ˜¯è®¿é—®å†…éƒ¨layerçš„frameã€positionç­‰ç›¸å…³å±æ€§ã€‚ @synthesizeå’Œ@dynamicåˆ†åˆ«ä»€ä¹ˆä½œç”¨? 1ã€@propertyæœ‰ä¸¤ä¸ªå¯¹åº”çš„è¯ï¼Œä¸€ä¸ªæ˜¯ @synthesizeï¼Œä¸€ä¸ªæ˜¯ @dynamicã€‚å¦‚æœ @synthesizeå’Œ @dynamicéƒ½æ²¡å†™ï¼Œé‚£ä¹ˆé»˜è®¤çš„å°±æ˜¯@syntheszie var = _var;2ã€@synthesize çš„è¯­ä¹‰æ˜¯å¦‚æœä½ æ²¡æœ‰æ‰‹åŠ¨å®ç° setter æ–¹æ³•å’Œ getter æ–¹æ³•ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ä¸ºä½ åŠ ä¸Šè¿™ä¸¤ä¸ªæ–¹æ³•ã€‚3ã€@dynamic å‘Šè¯‰ç¼–è¯‘å™¨ï¼šå±æ€§çš„ setter ä¸ getter æ–¹æ³•ç”±ç”¨æˆ·è‡ªå·±å®ç°ï¼Œä¸è‡ªåŠ¨ç”Ÿæˆã€‚ï¼ˆå½“ç„¶å¯¹äº readonly çš„å±æ€§åªéœ€æä¾› getter å³å¯ï¼‰ã€‚å‡å¦‚ä¸€ä¸ªå±æ€§è¢«å£°æ˜ä¸º @dynamic varï¼Œç„¶åä½ æ²¡æœ‰æä¾› @setteræ–¹æ³•å’Œ @getter æ–¹æ³•ï¼Œç¼–è¯‘çš„æ—¶å€™æ²¡é—®é¢˜ï¼Œä½†æ˜¯å½“ç¨‹åºè¿è¡Œåˆ° instance.var = someVarï¼Œç”±äºç¼º setter æ–¹æ³•ä¼šå¯¼è‡´ç¨‹åºå´©æºƒï¼›æˆ–è€…å½“è¿è¡Œåˆ° someVar = var æ—¶ï¼Œç”±äºç¼º getter æ–¹æ³•åŒæ ·ä¼šå¯¼è‡´å´©æºƒã€‚ç¼–è¯‘æ—¶æ²¡é—®é¢˜ï¼Œè¿è¡Œæ—¶æ‰æ‰§è¡Œç›¸åº”çš„æ–¹æ³•ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„åŠ¨æ€ç»‘å®šã€‚ åŠ¨æ€ç»‘å®š Category(ç±»åˆ«)ã€Extension(æ‰©å±•)å’Œç»§æ‰¿çš„åŒºåˆ« 1ã€Categoryï¼šåˆ†ç±»å°±æ˜¯å¯¹ä¸€ä¸ªç±»çš„åŠŸèƒ½è¿›è¡Œæ‰©å±•,,è®©è¿™ä¸ªç±»èƒ½å¤Ÿé€‚åº”ä¸ä¸åŒæƒ…å†µçš„éœ€æ±‚.åœ¨ä¸€èˆ¬çš„å®é™…å¼€å‘ä¸­,æˆ‘ä»¬éƒ½ä¼šå¯¹ç³»ç»Ÿçš„ä¸€äº›å¸¸ç”¨ç±»è¿›è¡Œæ‰©å±•,æ¯”å¦‚,NSString,Button,Labelç­‰ç­‰,ç®€å•æ¥è¯´ç±»åˆ«æ˜¯ä¸€ç§ä¸ºç°æœ‰çš„ç±»æ·»åŠ æ–°æ–¹æ³•çš„æ–¹å¼ã€‚2ã€Extensionï¼šæ˜¯Categoryçš„ä¸€ä¸ªç‰¹ä¾‹ä½œç”¨:ä¸ºä¸€ä¸ªç±»å¢åŠ ç§æœ‰æ–¹æ³•,å±æ€§æˆ–æˆå‘˜å˜é‡,ä¹Ÿå°±æ˜¯è¯´åªèƒ½è¿™äº›åªèƒ½åœ¨æœ¬æ–‡ä»¶ä¸­è¢«ä½¿ç”¨å…¶åå­—ä¸ºåŒ¿å(ä¸ºç©º),å¹¶ä¸”æ–°æ·»åŠ çš„æ–¹æ³•ä¸€å®šè¦äºˆä»¥å®ç°ã€‚(Categoryæ²¡æœ‰è¿™ä¸ªé™åˆ¶)3ã€ç»§æ‰¿ï¼šå¤šä¸ªç±»å…·æœ‰ç›¸åŒçš„å®ä¾‹å˜é‡å’Œæ–¹æ³•æ—¶ï¼Œè€ƒè™‘ç”¨ç»§æ‰¿ã€‚å³å­ç±»å¯ä»¥ç»§æ‰¿çˆ¶ç±»çš„ç›¸åŒç‰¹æ€§ã€‚å¦‚animalå…·æœ‰å¹´é¾„å’Œä½“é‡ä¸¤ä¸ªå±æ€§ï¼Œdogä¹Ÿå…·æœ‰å¹´é¾„å’Œä½“é‡ä¸¤ ä¸ªå±æ€§ï¼Œdogå¯ä»¥ç»§æ‰¿animalçš„è¿™ä¸¤ä¸ªå±æ€§ï¼Œå³ä¸ºç»§æ‰¿ã€‚ ä¸ºä»€ä¹ˆä»£ç†è¦ç”¨weakï¼Ÿdelegateå’ŒDataSourceæœ‰ä»€ä¹ˆåŒºåˆ«ï¼ŸBlockå’Œä»£ç†çš„åŒºåˆ«ï¼Ÿ idå’ŒNSObject *çš„åŒºåˆ« 1ã€NSObjectåŒ…å«äº†ä¸€äº›å…¶ä»–çš„æ–¹æ³•ï¼Œéœ€è¦å®ç°NSObjectåè®®ï¼Œå¯ä»¥ç”¨NSObjectæ¥è¡¨ç¤ºidï¼Œä½†æ˜¯ä¸èƒ½ç”¨idæ¥è¡¨ç¤ºNSObjectã€‚2ã€idå…³é”®å­—åœ¨ç¼–è¯‘çš„æ—¶å€™ä¸ä¼šè¢«æ£€æŸ¥ï¼Œè€ŒNSObjectåœ¨ç¼–è¯‘çš„æ—¶å€™è¢«è¢«æ£€æŸ¥æ˜¯å¦å«æœ‰ä¸€äº›é”™è¯¯çš„æ–¹æ³•3ã€idå¯ä»¥æ˜¯ä»»ä½•å¯¹è±¡ï¼ŒåŒ…æ‹¬ä¸æ˜¯NSObjectçš„å¯¹è±¡4ã€å®šä¹‰idçš„æ—¶å€™ä¸éœ€è¦*ï¼Œè€Œå®šä¹‰NSOjectçš„æ—¶å€™éœ€è¦ã€‚ é’ˆå¯¹ç³»ç»Ÿæä¾›çš„Block APIï¼Œæ˜¯å¦ä¹Ÿè¦è€ƒè™‘å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼Ÿ ç³»ç»Ÿçš„æŸäº›block apiä¸­ï¼ŒUIViewçš„blockç‰ˆæœ¬å†™åŠ¨ç”»æ—¶ä¸éœ€è¦è€ƒè™‘ï¼Œä½†ä¹Ÿæœ‰ä¸€äº›api éœ€è¦è€ƒè™‘ã€‚ä»¥ä¸‹è¿™äº›ä½¿ç”¨æ–¹å¼ä¸ä¼šå¼•èµ·å¾ªç¯å¼•ç”¨çš„é—®é¢˜ 1234567891011[UIView animateWithDuration:1.2 animations:^&#123; [self.view layoutIfNeeded]; &#125;]; [[NSOperationQueue mainQueue] addOperationWithBlock:^&#123; &#x2F;&#x2F; Do Some Thing &#125;]; [[NSNotificationCenter defaultCenter] addObserverForName:@&quot;someNotification&quot; object:nil queue:[NSOperationQueue mainQueue] usingBlock:^(NSNotification * _Nonnull note) &#123; &#x2F;&#x2F; Do Some Thing &#125;]; ä½†å¦‚æœæ–¹æ³•ä¸­çš„ä¸€äº›å‚æ•°æ˜¯ æˆå‘˜å˜é‡ï¼Œé‚£ä¹ˆå¯ä»¥é€ æˆå¾ªç¯å¼•ç”¨ï¼Œå¦‚ GCD ã€NSNotificationCenterè°ƒç”¨å°±è¦å°å¿ƒä¸€ç‚¹ï¼Œæ¯”å¦‚ GCD å†…éƒ¨å¦‚æœå¼•ç”¨äº† selfï¼Œè€Œä¸” GCD çš„å‚æ•°æ˜¯ æˆå‘˜å˜é‡ï¼Œåˆ™è¦è€ƒè™‘åˆ°å¾ªç¯å¼•ç”¨ï¼Œä¸¾ä¾‹å¦‚ä¸‹ï¼šGCD-&gt;åˆ†æï¼šselfâ€“&gt;_operationsQueueâ€“&gt;blockâ€“&gt;selfå½¢æˆé—­ç¯ï¼Œå°±é€ æˆäº†å¾ªç¯å¼•ç”¨ 123&gt;dispatch_group_async(_operationsGroup, _operationsQueue, ^&#123; &#x2F;&#x2F; Do Some Thing&gt;&#125;); NSNotificationCenter-&gt;åˆ†æ:selfâ€“&gt;_observerâ€“&gt;blockâ€“&gt;selfå½¢æˆé—­ç¯ï¼Œå°±é€ æˆäº†å¾ªç¯å¼•ç”¨ 123&gt;_observer &#x3D; [[NSNotificationCenter defaultCenter] addObserverForName:@&quot;testKey&quot; object:nil queue:nil usingBlock:^(NSNotification *note)&#123;&#x2F;&#x2F; Do Some Thing&gt;&#125;]; åœ¨@propertyä¸­ä¸ºä»€ä¹ˆ NSString ï¼ˆæˆ–NSArrayï¼ŒNSDictionaryï¼‰ä½¿ç”¨copyå…³é”®å­—ï¼Ÿæ”¹æˆStrongæœ‰å¯èƒ½ä¼šé€ æˆä»€ä¹ˆé—®é¢˜ï¼Ÿ 1ã€å› ä¸ºçˆ¶ç±»æŒ‡é’ˆå¯ä»¥æŒ‡å‘å­ç±»å¯¹è±¡,ä½¿ç”¨copyçš„ç›®çš„æ˜¯ä¸ºäº†è®©æœ¬å¯¹è±¡çš„å±æ€§ä¸å—å¤–ç•Œå½±å“,ä½¿ç”¨copyæ— è®ºç»™æˆ‘ä¼ å…¥æ˜¯ä¸€ä¸ªå¯å˜å¯¹è±¡è¿˜æ˜¯ä¸å¯å¯¹è±¡,æˆ‘æœ¬èº«æŒæœ‰çš„å°±æ˜¯ä¸€ä¸ªä¸å¯å˜çš„å‰¯æœ¬.2ã€å¦‚æœæˆ‘ä»¬ä½¿ç”¨æ˜¯strong,é‚£ä¹ˆè¿™ä¸ªå±æ€§å°±æœ‰å¯èƒ½æŒ‡å‘ä¸€ä¸ªå¯å˜å¯¹è±¡,å¦‚æœè¿™ä¸ªå¯å˜å¯¹è±¡åœ¨å¤–éƒ¨è¢«ä¿®æ”¹äº†,é‚£ä¹ˆä¼šå½±å“è¯¥å±æ€§. å…³é”®å­—const/static/externã€UIKIT_EXTERNåŒºåˆ«å’Œç”¨æ³• 1ã€constï¼ˆ1ï¼‰constç”¨æ¥ä¿®é¥°å³è¾¹çš„åŸºæœ¬å˜é‡æˆ–æŒ‡é’ˆå˜é‡ï¼ˆ2ï¼‰è¢«ä¿®é¥°çš„å˜é‡åªè¯»ï¼Œä¸èƒ½è¢«ä¿®æ”¹ 2ã€staticï¼ˆ1ï¼‰ä¿®é¥°å±€éƒ¨å˜é‡ï¼ˆ2ï¼‰ä¿®é¥°å…¨å±€å˜é‡ï¼ˆ3ï¼‰ä¿®é¥°å‡½æ•°3ã€externï¼ˆ1ï¼‰å£°æ˜å¤–éƒ¨å…¨å±€å˜é‡ã€‚è¿™é‡Œéœ€è¦ç‰¹åˆ«æ³¨æ„externåªèƒ½å£°æ˜ï¼Œä¸èƒ½ç”¨äºå®ç°ï¼Œè€Œä¸”å®šä¹‰å’Œåˆ†é…å†…å­˜éƒ½åœ¨åŸæ¥ç±»ä¸­ã€‚4ã€UIKIT_EXTERNï¼ˆ1ï¼‰å°†å‡½æ•°ä¿®é¥°ä¸ºå…¼å®¹ä»¥å¾€Cç¼–è¯‘æ–¹å¼çš„ã€å…·æœ‰externå±æ€§(æ–‡ä»¶å¤–å¯è§æ€§)ã€publicä¿®é¥°çš„æ–¹æ³•æˆ–å˜é‡åº“å¤–ä»å¯è§çš„å±æ€§ åº•å±‚ main()ä¹‹å‰æœ‰å“ªäº›è¿‡ç¨‹ï¼Ÿ KVOçš„åŸç† å½“è§‚å¯ŸæŸå¯¹è±¡æ—¶ï¼ŒKVOåŠ¨æ€åˆ›å»ºè¯¥å¯¹è±¡çš„å­ç±»ï¼Œå¹¶é‡å†™å­ç±»è¢«è§‚å¯Ÿå±æ€§setteræ–¹æ³•ï¼Œéšåé€šçŸ¥è§‚å¯Ÿè€…è¯¥å±æ€§çš„å˜åŒ–çŠ¶å†µã€‚ Swiftå¦‚ä½•ä½¿ç”¨KVOï¼Ÿ Swiftæœ‰å“ªäº›åŒ¹é…æ¨¡å¼ï¼Ÿ Objcå‘ä¸€ä¸ªå¯¹è±¡å‘é€æ¶ˆæ¯ï¼Œå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ Runtimeåº“ä¼šæ ¹æ®å¯¹è±¡çš„isaæŒ‡é’ˆæ‰¾åˆ°è¯¥å¯¹è±¡å®é™…æ‰€å±çš„ç±»ï¼Œç„¶ååœ¨è¯¥ç±»ä¸­çš„æ–¹æ³•åˆ—è¡¨ä»¥åŠå…¶çˆ¶ç±»æ–¹æ³•åˆ—è¡¨ä¸­å¯»æ‰¾æ–¹æ³•è¿è¡Œï¼Œç„¶ååœ¨å‘é€æ¶ˆæ¯çš„æ—¶å€™ï¼Œobjc_msgSendæ–¹æ³•ä¸ä¼šè¿”å›å€¼ï¼Œæ‰€è°“çš„è¿”å›å†…å®¹éƒ½æ˜¯å…·ä½“è°ƒç”¨æ—¶æ‰§è¡Œçš„ã€‚ é™æ€åº“çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿä½ æœ‰æ²¡æœ‰å†™è¿‡å“ªäº›é™æ€åº“? é‡åˆ°å“ªäº›é—®é¢˜ï¼Ÿ Runloopæ˜¯ç”¨æ¥åšä»€ä¹ˆçš„ï¼Ÿrunloopå’Œçº¿ç¨‹çš„å…³ç³»ï¼Ÿä¸»çº¿ç¨‹é»˜è®¤å¼€å§‹runloopäº†å—ï¼Ÿ å­çº¿ç¨‹å‘¢ï¼Ÿ ä¸æ‰‹åŠ¨æŒ‡å®šautoreleasepoolçš„å‰æä¸‹ï¼Œautoreleasepoolåœ¨ä»€ä¹ˆä»€ä¹ˆæ—¶åˆ»é‡Šæ”¾ï¼Ÿï¼ˆæ¯”å¦‚åœ¨vcçš„viewDidLoadä¸­åˆ›å»ºï¼‰ æ‰‹åŠ¨å¹²é¢„é‡Šæ”¾æ—¶æœº - æŒ‡å®šautoreleasepoolå°±æ˜¯æ‰€è°“çš„ï¼šå½“å‰ä½œç”¨åŸŸå¤§æ‹¬å·ç»“æŸæ—¶é‡Šæ”¾ã€‚ ç³»ç»Ÿè‡ªåŠ¨å»é‡Šæ”¾ - ä¸æ‰‹åŠ¨æŒ‡å®šautoreleasepoolAutoreleaseå¯¹è±¡å‡ºäº†ä½œç”¨åŸŸä¹‹åï¼Œä¼šè¢«æ·»åŠ åˆ°æœ€è¿‘ä¸€æ¬¡åˆ›å»ºçš„è‡ªåŠ¨é‡Šæ”¾æ± ä¸­ï¼Œå¹¶ä¼šåœ¨å½“å‰çš„ runloop è¿­ä»£ç»“æŸæ—¶é‡Šæ”¾ã€‚å¦‚æœåœ¨ä¸€ä¸ªvcçš„viewDidLoadä¸­åˆ›å»ºä¸€ä¸ª Autoreleaseå¯¹è±¡ï¼Œé‚£ä¹ˆè¯¥å¯¹è±¡ä¼šåœ¨ viewDidAppear æ–¹æ³•æ‰§è¡Œå‰å°±è¢«é”€æ¯äº†ã€‚ OCä¸­çš„æ¶ˆæ¯è½¬å‘æœºåˆ¶+ä»£ç å®ç° ä»¥ + scheduledTimerWithTimeIntervalâ€¦çš„æ–¹å¼è§¦å‘çš„NSTimerï¼Œåœ¨æ»‘åŠ¨çš„åˆ—è¡¨æ—¶ï¼Œtimerä¼šæš‚æ—¶å›è°ƒï¼Œä¸ºä»€ä¹ˆï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ å¦‚ä½•æ‰‹åŠ¨è§¦å‘ä¸€ä¸ªvalueçš„KVOï¼Ÿ è‡ªåŠ¨è§¦å‘ï¼š è‡ªåŠ¨è§¦å‘æ˜¯æŒ‡ç±»ä¼¼çš„è¿™ç§åœºæ™¯ï¼šåœ¨æ³¨å†ŒKVOä¹‹å‰è®¾ç½®ä¸€ä¸ªåˆå§‹å€¼ï¼Œæ³¨å†Œä¹‹åè®¾ç½®ä¸€ä¸ªä¸ä¸€æ ·çš„å€¼ï¼Œå°±å¯ä»¥è§¦å‘äº†ã€‚ æ‰‹åŠ¨è§¦å‘ï¼š é”®å€¼è§‚å¯Ÿé€šçŸ¥ä¾èµ–äºNSObjectçš„ä¸¤ä¸ªæ–¹æ³•ï¼šwillChangeValueForKeyï¼šå’ŒdidChangeValueForKeyï¼šã€‚åœ¨ä¸€ä¸ªè¢«è§‚å¯Ÿå±æ€§å‘ç”Ÿæ”¹å˜ä¹‹å‰ï¼ŒwillChangeValueForKeyï¼šä¸€å®šä¼šè¢«è°ƒç”¨ï¼Œè¿™å°±ä¼šè®°å½•æ—§çš„å€¼ã€‚è€Œå½“æ”¹å˜å‘ç”Ÿåï¼ŒdidChangeValueForKeyï¼šä¼šè¢«è°ƒç”¨ï¼Œç»§è€ŒobjectServeValueForKeyï¼šofObjectï¼šchangeï¼šcontentï¼šä¹Ÿä¼šè¢«è°ƒç”¨ã€‚å¦‚æœå¯ä»¥æ‰‹åŠ¨å®ç°è¿™äº›è°ƒç”¨ï¼Œå°±å¯ä»¥å®ç°â€œæ‰‹åŠ¨è§¦å‘â€äº†ã€‚ å¦‚ä½•å®šä½å’Œåˆ†æé¡¹ç›®ä¸­å½±å“æ€§èƒ½çš„åœ°æ–¹ï¼Ÿä»¥åŠå¦‚ä½•è¿›è¡Œæ€§èƒ½ä¼˜åŒ–ï¼Ÿ ä¸²è¡Œå¹¶è¡Œï¼Œå¼‚æ­¥åŒæ­¥çš„åŒºåˆ« ä¸²è¡Œå¹¶è¡Œ æŒ‡çš„æ˜¯èƒ½å¦å¼€å¯æ–°çš„çº¿ç¨‹ã€‚åŒæ­¥ä¸èƒ½å¼€å¯æ–°çš„çº¿ç¨‹ï¼Œå¼‚æ­¥å¯ä»¥ã€‚ å¼‚æ­¥åŒæ­¥ æŒ‡çš„æ˜¯ä»»åŠ¡çš„æ‰§è¡Œæ–¹å¼ã€‚ä¸²è¡Œæ˜¯æŒ‡å¤šä¸ªä»»åŠ¡æ—¶ï¼Œå„ä¸ªä»»åŠ¡æŒ‰é¡ºåºæ‰§è¡Œï¼Œå®Œæˆä¸€ä¸ªä¹‹åæ‰èƒ½è¿›è¡Œä¸‹ä¸€ä¸ªã€‚å¹¶è¡ŒæŒ‡çš„æ˜¯å¤šä¸ªä»»åŠ¡å¯ä»¥åŒæ—¶æ‰§è¡Œã€‚å¼‚æ­¥æ˜¯å¤šä¸ªä»»åŠ¡å¹¶è¡Œçš„å‰ææ¡ä»¶ã€‚ çº¿ç¨‹æ˜¯ä»€ä¹ˆï¼Ÿè¿›ç¨‹æ˜¯ä»€ä¹ˆï¼ŸäºŒè€…æœ‰ä»€ä¹ˆåŒºåˆ«å’Œè”ç³»ï¼Ÿ çº¿ç¨‹æ˜¯CPUç‹¬ç«‹è¿è¡Œå’Œç‹¬ç«‹è°ƒåº¦çš„åŸºæœ¬å•ä½ è¿›ç¨‹æ˜¯èµ„æºåˆ†é…çš„åŸºæœ¬å•ä½ï¼› ä¸¤è€…çš„è”ç³»ï¼šè¿›ç¨‹å’Œçº¿ç¨‹éƒ½æ˜¯æ“ä½œç³»ç»Ÿæ‰€è¿è¡Œçš„ç¨‹åºè¿è¡Œçš„åŸºæœ¬å•å…ƒã€‚ åŒºåˆ«ï¼š è¿›ç¨‹å…·æœ‰ç‹¬ç«‹çš„ç©ºé—´åœ°å€ï¼Œä¸€ä¸ªè¿›ç¨‹å´©æºƒåï¼Œåœ¨ä¿æŠ¤æ¨¡å¼ä¸‹ä¸ä¼šå¯¹å…¶å®ƒè¿›ç¨‹äº§ç”Ÿå½±å“ã€‚ çº¿ç¨‹åªæ˜¯ä¸€ä¸ªè¿›ç¨‹çš„ä¸åŒæ‰§è¡Œè·¯å¾„ï¼Œçº¿ç¨‹æœ‰è‡ªå·±çš„å †æ ˆå’Œå±€éƒ¨å˜é‡ï¼Œä½†çº¿ç¨‹ä¹‹é—´æ²¡æœ‰å•ç‹¬çš„åœ°å€ç©ºé—´ï¼Œä¸€ä¸ªçº¿ç¨‹æ­»æ‰å°±ç­‰äºæ•´ä¸ªè¿›ç¨‹æ­»æ‰ã€‚","categories":[{"name":"é¢è¯•é¢˜","slug":"é¢è¯•é¢˜","permalink":"https://github.com/wuvdan/wuvdan.github.io/categories/%E9%9D%A2%E8%AF%95%E9%A2%98/"}],"tags":[{"name":"é¢è¯•æŠ€å·§","slug":"é¢è¯•æŠ€å·§","permalink":"https://github.com/wuvdan/wuvdan.github.io/tags/%E9%9D%A2%E8%AF%95%E6%8A%80%E5%B7%A7/"}]},{"title":"iOSé¢è¯•é¢˜-004","slug":"iOSé¢è¯•é¢˜-004","date":"2020-01-16T08:05:40.782Z","updated":"2020-01-20T01:45:07.814Z","comments":true,"path":"2020/01/16/iOSé¢è¯•é¢˜-004/","link":"","permalink":"https://github.com/wuvdan/wuvdan.github.io/2020/01/16/iOS%E9%9D%A2%E8%AF%95%E9%A2%98-004/","excerpt":"","text":"1ã€swiftå’Œocçš„åŒºåˆ« 2ã€ç¼–è¯‘é“¾æ¥ 3ã€synthesize &amp; denamic 4ã€åœ¨é¡¹ç›®å¼€å‘ä¸­å¸¸ç”¨çš„å¼€å‘å·¥å…·æœ‰å“ªäº›ï¼Ÿ 5ã€UITableView &amp; UICollection 6ã€NSProxy &amp; NSObject 7ã€Object &amp; Swift 8ã€ä¼ å€¼é€šçŸ¥ &amp; æ¨é€é€šçŸ¥ï¼ˆæœ¬åœ°&amp;è¿œç¨‹ï¼‰ 9ã€ç¬¬ä¸‰æ–¹åº“ &amp; ç¬¬ä¸‰æ–¹å¹³å° 10ã€NSCache &amp; NSDcitionary 11ã€ UIViewçš„setNeedsDisplayå’ŒsetNeedsLayoutæ–¹æ³• 12ã€UILayer &amp; UIView 13ã€layoutSubViews &amp; drawRects 14ã€UDID &amp; UUID 15ã€CPU &amp; GPU 16ã€ç‚¹ï¼ˆptï¼‰&amp; åƒç´ ï¼ˆpxï¼‰ 17ã€å±æ€§ä¸æˆå‘˜å˜é‡ 18ã€intå’ŒNSIntegerçš„åŒºåˆ« ï¼ˆ1ï¼‰importå’Œinclude ï¼ˆ2ï¼‰@class ï¼ˆ3ï¼‰å…¨å±€ &amp; é™æ€å˜é‡ 19ã€ç±»å’Œå¯¹è±¡ ï¼ˆ1ï¼‰åˆ†ç±»æ‹“å±•åè®®ä¸­å“ªäº›å¯ä»¥å£°æ˜å±æ€§? ï¼ˆ2ï¼‰ç»§æ‰¿å’Œç±»åˆ«çš„åŒºåˆ« ï¼ˆ3ï¼‰åˆ†ç±»çš„ä½œç”¨ ï¼ˆ4ï¼‰åˆ†ç±»çš„å±€é™æ€§ 20ã€category &amp; extension 21ã€Foundation ï¼ˆ1ï¼‰å­—ç¬¦ä¸² ï¼ˆ2ï¼‰å­—ç¬¦ä¸²æˆªå– ï¼ˆ3ï¼‰æ ¼å¼ 22ã€NSArrayå’ŒNSDictionary ï¼ˆ1ï¼‰iOSéå†æ•°ç»„/å­—å…¸çš„æ–¹æ³• ï¼ˆ2ï¼‰NSValue NSNumber ï¼ˆ3ï¼‰å…¶å®ƒ ï¼ˆ4ï¼‰å¦‚ä½•é¿å…å¾ªç¯å¼•ç”¨ 23ã€CFSocketä½¿ç”¨æœ‰å“ªå‡ ä¸ªæ­¥éª¤ 24ã€Core Foundationä¸­æä¾›äº†å“ªå‡ ç§æ“ä½œSocketçš„æ–¹æ³•ï¼Ÿ 25ã€è§£æXMLæ–‡ä»¶æœ‰å“ªå‡ ç§æ–¹å¼ï¼Ÿ 26ã€ä»€ä¹ˆæ˜¯æ²™ç›’æ¨¡å‹ï¼Ÿå“ªäº›æ“ä½œæ˜¯å±äºç§æœ‰apièŒƒç•´? 27ã€åœ¨ä¸€ä¸ªå¯¹è±¡çš„æ–¹æ³•é‡Œé¢ï¼šself.name= â€œobjectâ€ï¼›å’Œ name =â€objectâ€ æœ‰ä»€ä¹ˆä¸åŒå—? 28ã€è¯·ç®€è¦è¯´æ˜viewDidLoadå’ŒviewDidUnloadä½•æ—¶è°ƒç”¨ 29ã€åˆ›å»ºæ§åˆ¶å™¨ã€è§†å›¾çš„æ–¹å¼ 30ã€ç®€è¿°å†…å­˜åˆ†åŒºæƒ…å†µ 31ã€é˜Ÿåˆ—å’Œæ ˆæœ‰ä»€ä¹ˆåŒºåˆ« 32ã€iOSçš„ç³»ç»Ÿæ¶æ„ 33ã€æ§ä»¶ä¸»è¦å“åº”3ç§äº‹ä»¶ 34ã€xibæ–‡ä»¶çš„æ„æˆåˆ†ä¸ºå“ª3ä¸ªå›¾æ ‡ï¼Ÿéƒ½å…·æœ‰ä»€ä¹ˆåŠŸèƒ½ 35ã€ç®€è¿°è§†å›¾æ§ä»¶å™¨çš„ç”Ÿå‘½å‘¨æœŸ 36ã€app é¡¹ç›®çš„ç”Ÿå‘½å‘¨æœŸ ï¼ˆ1ï¼‰åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸ ï¼ˆ2ï¼‰ç®€è¦è¯´æ˜ä¸€ä¸‹APPçš„å¯åŠ¨è¿‡ç¨‹ï¼Œmainæ–‡ä»¶è¯´èµ·ï¼Œmainå‡½æ•°ä¸­æœ‰ä»€ä¹ˆå‡½æ•°ï¼Ÿä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ ï¼ˆ3ï¼‰UIApplicationMainå‡½æ•°ä½œç”¨ ï¼ˆ4ï¼‰mainå‡½æ•°ä½œç”¨ 37ã€ åŠ¨ç”»æœ‰åŸºæœ¬ç±»å‹æœ‰å“ªå‡ ç§ï¼›è¡¨è§†å›¾æœ‰å“ªå‡ ç§åŸºæœ¬æ ·å¼ã€‚ 38ã€å®ç°ç®€å•çš„è¡¨æ ¼æ˜¾ç¤ºéœ€è¦è®¾ç½®UITableViewçš„ä»€ä¹ˆå±æ€§ã€å®ç°ä»€ä¹ˆåè®®ï¼Ÿ 39ã€Cocoa Touchæä¾›äº†å“ªå‡ ç§Core Animationè¿‡æ¸¡ç±»å‹ï¼Ÿ 40ã€UIViewä¸CLayeræœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ 41ã€Quatrz 2Dçš„ç»˜å›¾åŠŸèƒ½çš„ä¸‰ä¸ªæ ¸å¿ƒæ¦‚å¿µæ˜¯ä»€ä¹ˆå¹¶ç®€è¿°å…¶ä½œç”¨ 42ã€iPhone OSä¸»è¦æä¾›äº†å‡ ç§æ’­æ”¾éŸ³é¢‘çš„æ–¹æ³•ï¼Ÿ 43ã€ä½¿ç”¨AVAudioPlayerç±»è°ƒç”¨å“ªä¸ªæ¡†æ¶ã€ä½¿ç”¨æ­¥éª¤ï¼Ÿ 44ã€æœ‰å“ªå‡ ç§æ‰‹åŠ¿é€šçŸ¥æ–¹æ³•ã€å†™æ¸…æ¥šæ–¹æ³•åï¼Ÿ 45ã€ViewControllerçš„didReceiveMemoryWarningæ€ä¹ˆè¢«è°ƒç”¨ 46ã€ä»€ä¹ˆæ—¶å€™ç”¨delegate,ä»€ä¹ˆæ—¶å€™ç”¨Notification? 47ã€ç”¨é¢„å¤„ç†æŒ‡ä»¤#defineå£°æ˜ä¸€ä¸ªå¸¸æ•°ï¼Œç”¨ä»¥è¡¨æ˜1å¹´ä¸­æœ‰å¤šå°‘ç§’ï¼ˆå¿½ç•¥é—°å¹´é—®é¢˜ï¼‰ 48ã€å†™ä¸€ä¸ªâ€æ ‡å‡†â€å®MIN ï¼Œè¿™ä¸ªå®è¾“å…¥ä¸¤ä¸ªå‚æ•°å¹¶è¿”å›è¾ƒå°çš„ä¸€ä¸ªã€‚ 49ã€å…³é”®å­—constæœ‰ä»€ä¹ˆå«æ„ï¼Ÿä¿®é¥°ç±»å‘¢?staticçš„ä½œç”¨,ç”¨äºç±»å‘¢?è¿˜æœ‰extern cçš„ä½œç”¨ 50ã€å…³é”®å­—volatileæœ‰ä»€ä¹ˆå«æ„?å¹¶ç»™å‡ºä¸‰ä¸ªä¸åŒçš„ä¾‹å­ 51ã€ä¸€ä¸ªå‚æ•°æ—¢å¯ä»¥æ˜¯constè¿˜å¯ä»¥æ˜¯volatileå—ï¼Ÿ ä¸€ä¸ªæŒ‡é’ˆå¯ä»¥æ˜¯volatile å—ï¼Ÿè§£é‡Šä¸ºä»€ä¹ˆã€‚ 52ã€static å…³é”®å­—çš„ä½œç”¨ 53ã€åˆ—ä¸¾å‡ ç§è¿›ç¨‹çš„åŒæ­¥æœºåˆ¶ï¼Œå¹¶æ¯”è¾ƒå…¶ä¼˜ç¼ºç‚¹ã€‚ 54ã€è¿›ç¨‹ä¹‹é—´é€šä¿¡çš„é€”å¾„ 55ã€è¿›ç¨‹æ­»é”çš„åŸå›  56ã€æ­»é”çš„4ä¸ªå¿…è¦æ¡ä»¶ 57ã€æ­»é”çš„å¤„ç† 58ã€cocoa touchæ¡†æ¶ 59ã€è‡ªåŠ¨é‡Šæ”¾æ± æ˜¯ä»€ä¹ˆ,å¦‚ä½•å·¥ä½œ 60ã€sprintf,strcpy,memcpyä½¿ç”¨ä¸Šæœ‰ä»€ä¹ˆè¦æ³¨æ„çš„åœ°æ–¹ 61ã€ä½ äº†è§£svn,cvsç­‰ç‰ˆæœ¬æ§åˆ¶å·¥å…·ä¹ˆï¼Ÿ 62ã€ä»€ä¹ˆæ˜¯push 63ã€é™æ€é“¾æ¥åº“ 64ã€OCä¸‰å¤§ç‰¹æ€§ ï¼ˆ1ï¼‰å°è£…_ç‚¹è¯­æ³• ï¼ˆ2ï¼‰ç»§æ‰¿ ï¼ˆ3ï¼‰å¤šæ€ 65ã€OCä¸­å¦‚ä½•å®ç°å¤šæ€ 66ã€Objective-Cçš„ä¼˜ç¼ºç‚¹ 67ã€å¯¹äºOC,ä½ è®¤ä¸ºæœ€å¤§çš„ä¼˜ç‚¹å’Œæœ€å¤§çš„ä¸è¶³æ˜¯ä»€ä¹ˆï¼Ÿå¯¹äºä¸è¶³ä¹‹å¤„ï¼Œç°åœ¨æœ‰æ²¡æœ‰å¯ç”¨çš„æ–¹æ³•ç»•è¿‡è¿™äº›ä¸è¶³æ¥å®ç°éœ€æ±‚ã€‚å¦‚æœå¯ä»¥è¯ï¼Œæœ‰æ²¡æœ‰è€ƒè™‘æˆ–è€…å®ç°è¿‡é‡æ–°å®ç°OCçš„åŠŸèƒ½ï¼Œå¦‚æœæœ‰ï¼Œå…·ä½“æ€ä¹ˆåšï¼Ÿ 68ã€ocä¸­å¯ä¿®æ”¹å’Œä¸å¯ä»¥ä¿®æ”¹ç±»å‹ 69ã€æˆ‘ä»¬è¯´çš„ocæ˜¯åŠ¨æ€è¿è¡Œæ—¶è¯­è¨€æ˜¯ä»€ä¹ˆæ„æ€? 70ã€é€šçŸ¥å’Œåè®®çš„ä¸åŒä¹‹å¤„? 71ã€ä»€ä¹ˆæ˜¯æ¨é€æ¶ˆæ¯? 72ã€å…³äºå¤šæ€æ€§ 73ã€ä»€ä¹ˆæ˜¯è°“è¯? 74ã€åšè¿‡çš„é¡¹ç›®æ˜¯å¦æ¶‰åŠç½‘ç»œè®¿é—®åŠŸèƒ½ï¼Œä½¿ç”¨ä»€ä¹ˆå¯¹è±¡å®Œæˆç½‘ç»œåŠŸèƒ½? 75ã€ç®€å•ä»‹ç»ä¸‹NSURLConnectionç±»åŠ+sendSynchronousRequest:returningResponse:error:ä¸â€“ initWithRequest:delegate:ä¸¤ä¸ªæ–¹æ³•çš„åŒºåˆ«? 76ã€è°ˆè°ˆObject-Cçš„å†…å­˜ç®¡ç†æ–¹å¼åŠè¿‡ç¨‹ï¼Ÿ 77ã€Object-Cæœ‰ç§æœ‰æ–¹æ³•å—ï¼Ÿç§æœ‰å˜é‡å‘¢ï¼Ÿ 78ã€è¯´è¯´å“åº”é“¾ 79ã€æ—¶é—´ä¼ é€’ &amp; å“åº”è€…é“¾ 80ã€frameå’Œboundsæœ‰ä»€ä¹ˆä¸åŒ? 81ã€æ–¹æ³•å’Œé€‰æ‹©å™¨æœ‰ä½•ä¸åŒ? 82ã€OCçš„åƒåœ¾å›æ”¶æœºåˆ¶? 83ã€ä»€ä¹ˆæ˜¯å»¶è¿ŸåŠ è½½? 84ã€æ˜¯å¦åœ¨ä¸€ä¸ªè§†å›¾æ§åˆ¶å™¨ä¸­åµŒå…¥ä¸¤ä¸ªtableviewæ§åˆ¶å™¨? 85ã€ä¸€ä¸ªtableViewæ˜¯å¦å¯ä»¥å…³è”ä¸¤ä¸ªä¸åŒçš„æ•°æ®æº?ä½ ä¼šæ€ä¹ˆå¤„ç†? 86ã€ä»€ä¹ˆæ—¶å€™ä½¿ç”¨NSMutableArrayï¼Œä»€ä¹ˆæ—¶å€™ä½¿ç”¨NSArray? 87ã€ç»™å‡ºå§”æ‰˜æ–¹æ³•çš„å®ä¾‹ï¼Œå¹¶ä¸”è¯´å‡ºUITableVIewçš„Data Sourceæ–¹æ³• 88ã€åœ¨åº”ç”¨ä¸­å¯ä»¥åˆ›å»ºå¤šå°‘autoreleaseå¯¹è±¡ï¼Œæ˜¯å¦æœ‰é™åˆ¶? 89ã€å¦‚æœæˆ‘ä»¬ä¸åˆ›å»ºå†…å­˜æ± ï¼Œæ˜¯å¦æœ‰å†…å­˜æ± æä¾›ç»™æˆ‘ä»¬? 90ã€ä»€ä¹ˆæ—¶å€™éœ€è¦åœ¨ç¨‹åºä¸­åˆ›å»ºå†…å­˜æ± ? 91ã€ç±»NSObjectçš„é‚£äº›æ–¹æ³•ç»å¸¸è¢«ä½¿ç”¨? 92ã€ä»€ä¹ˆæ˜¯ç®€ä¾¿æ„é€ æ–¹æ³•? 93ã€å¦‚ä½•ä½¿ç”¨Xcodeè®¾è®¡é€šç”¨åº”ç”¨? 94ã€ UIViewçš„åŠ¨ç”»æ•ˆæœæœ‰é‚£äº›? 95ã€Object-Cæœ‰å¤šç»§æ‰¿å—ï¼Ÿæ²¡æœ‰çš„è¯ç”¨ä»€ä¹ˆä»£æ›¿ï¼Ÿcocoa ä¸­æ‰€æœ‰çš„ç±»éƒ½æ˜¯NSObject çš„å­ç±» 96ã€å†…å­˜ç®¡ç† Autoreleaseã€retainã€copyã€assignçš„setæ–¹æ³•å’Œå«ä¹‰ï¼Ÿ 97ã€Cå’Œobj-c å¦‚ä½•æ··ç”¨ 98ã€ç±»åˆ«çš„ä½œç”¨?ç»§æ‰¿å’Œç±»åˆ«åœ¨å®ç°ä¸­æœ‰ä½•åŒºåˆ«? 99ã€ç±»åˆ«å’Œç±»æ‰©å±•çš„åŒºåˆ«ã€‚ 100ã€ocä¸­çš„åè®®å’Œjavaä¸­çš„æ¥å£æ¦‚å¿µæœ‰ä½•ä¸åŒ? 101ã€æ·±æ‹·è´ä¸å‰æ‹·è´åŒºåˆ« ï¼ˆ1ï¼‰ä»€ä¹ˆæ˜¯æ·±æ‹·è´æµ…æ‹·è´ ï¼ˆ2ï¼‰å­—ç¬¦ä¸²ä»€ä¹ˆæ—¶å€™ä½¿ç”¨copy,strong ï¼ˆ3ï¼‰å­—ç¬¦ä¸²æ‰€åœ¨å†…å­˜åŒºåŸŸ ï¼ˆ4ï¼‰mutablecopyå’Œcopy @property(copy) NSMutableArray *arr;è¿™æ ·å†™æœ‰ä»€ä¹ˆé—®é¢˜ ï¼ˆ5ï¼‰å¦‚ä½•è®©è‡ªå®šä¹‰ç±»å¯ä»¥ä½¿ç”¨copyä¿®é¥°ç¬¦ 102ã€å¯¹äºè¯­å¥NSString*obj = [[NSData alloc] init]; objåœ¨ç¼–è¯‘æ—¶å’Œè¿è¡Œæ—¶åˆ†åˆ«æ—¶ä»€ä¹ˆç±»å‹çš„å¯¹è±¡ï¼Ÿ 103ã€#import è·Ÿ#include åˆä»€ä¹ˆåŒºåˆ«ï¼Œ@classå‘¢, ï¼ƒimport&lt;&gt; è·Ÿ #importâ€â€åˆä»€ä¹ˆåŒºåˆ«ï¼Ÿ 104ã€Objective-Cçš„ç±»å¯ä»¥å¤šé‡ç»§æ‰¿ä¹ˆ?å¯ä»¥å®ç°å¤šä¸ªæ¥å£ä¹ˆ?Categoryæ˜¯ä»€ä¹ˆ?é‡å†™ä¸€ä¸ªç±»çš„æ–¹æ³•ç”¨ç»§æ‰¿å¥½è¿˜æ˜¯åˆ†ç±»å¥½?ä¸ºä»€ä¹ˆ? 105ã€ #import è·Ÿ#include åˆä»€ä¹ˆåŒºåˆ«ï¼Œ@classå‘¢, #import&lt;&gt; è·Ÿ #importâ€â€åˆä»€ä¹ˆåŒºåˆ«? 106ã€å†™ä¸€ä¸ªsetteræ–¹æ³•ç”¨äºå®Œæˆ@property (nonatomic,retain)NSString name,å†™ä¸€ä¸ªsetteræ–¹æ³•ç”¨äºå®Œæˆ@property(nonatomicï¼Œcopy)NSString name 107ã€å¸¸è§çš„Objective-Cçš„æ•°æ®ç±»å‹æœ‰é‚£äº›ï¼Œ å’ŒCçš„åŸºæœ¬æ•°æ®ç±»å‹æœ‰ä»€ä¹ˆåŒºåˆ«?å¦‚ï¼šNSIntegerå’Œint 108ã€id å£°æ˜çš„å¯¹è±¡æœ‰ä»€ä¹ˆç‰¹æ€§? 109ã€Objective-Cå¦‚ä½•å¯¹å†…å­˜ç®¡ç†çš„,è¯´è¯´ä½ çš„çœ‹æ³•å’Œè§£å†³æ–¹æ³•? 110ã€åŸå­(atomic)è·ŸéåŸå­(non-atomic)å±æ€§æœ‰ä»€ä¹ˆåŒºåˆ«? 111ã€çœ‹ä¸‹é¢çš„ç¨‹åº,ç¬¬ä¸€ä¸ªNSLogä¼šè¾“å‡ºä»€ä¹ˆ?è¿™æ—¶strçš„retainCountæ˜¯å¤šå°‘?ç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªå‘¢? ä¸ºä»€ä¹ˆ? 112ã€å†…å­˜ç®¡ç†çš„å‡ æ¡åŸåˆ™æ—¶ä»€ä¹ˆ?æŒ‰ç…§é»˜è®¤æ³•åˆ™.é‚£äº›å…³é”®å­—ç”Ÿæˆçš„å¯¹è±¡éœ€è¦æ‰‹åŠ¨é‡Šæ”¾?åœ¨å’Œpropertyç»“åˆçš„æ—¶å€™æ€æ ·æœ‰æ•ˆçš„é¿å…å†…å­˜æ³„éœ²? 113ã€å¦‚ä½•å¯¹iOSè®¾å¤‡è¿›è¡Œæ€§èƒ½æµ‹è¯•? 114ã€è®¾è®¡æ¨¡å¼ ï¼ˆ1ï¼‰mvcæ¨¡å¼ ï¼ˆ2ï¼‰å•ä¾‹æ¨¡å¼ ï¼ˆ3ï¼‰mvvmæ¨¡å¼ ï¼ˆ4ï¼‰è§‚å¯Ÿè€…æ¨¡å¼ ï¼ˆ5ï¼‰å·¥å‚æ¨¡å¼ ï¼ˆ6ï¼‰ä»£ç†æ¨¡å¼ ï¼ˆ7ï¼‰ç­–ç•¥æ¨¡å¼ ï¼ˆ8ï¼‰é€‚é…å™¨æ¨¡å¼ ï¼ˆ9ï¼‰æ¨¡ç‰ˆæ¨¡å¼ ï¼ˆ10ï¼‰å¤–è§‚æ¨¡å¼ ï¼ˆ11ï¼‰åˆ›å»ºæ¨¡å¼ ï¼ˆ12ï¼‰MVPæ¨¡å¼ 115ã€MVVMæ¨¡å¼åŸç†åˆ†æ 116ã€è¯´è¯´å¸¸ç”¨çš„å‡ ç§ä¼ å€¼æ–¹å¼ 117ã€ä»€ä¹ˆæ—¶å€™ç”¨delegateï¼Œä»€ä¹ˆæ—¶å€™ç”¨Notification 118ã€å¯¹äºå•ä¾‹çš„ç†è§£ 119ã€ä»è®¾è®¡æ¨¡å¼è§’åº¦åˆ†æä»£ç†ï¼Œé€šçŸ¥å’ŒKVOåŒºåˆ«ï¼Ÿios SDK æä¾› çš„frameworkä½¿ç”¨äº†å“ªäº›è®¾è®¡æ¨¡å¼ï¼Œä¸ºä»€ä¹ˆä½¿ç”¨ï¼Ÿæœ‰å“ªäº›å¥½å¤„å’Œåå¤„? 120ã€KVOï¼ŒNSNotificationï¼ŒdelegateåŠblockåŒºåˆ« 121ã€è¿è¡Œæ—¶ï¼ˆrunTimeï¼‰ 122ã€runtime/æ¶ˆæ¯è½¬å‘æœºåˆ¶ ï¼ˆ1ï¼‰runtime 1.1ã€ä»€ä¹ˆæ˜¯runtime 1.2ã€runtimeå¹²ä»€ä¹ˆç”¨ï¼Œä½¿ç”¨åœºæ™¯ ï¼ˆ2ï¼‰æ¶ˆæ¯æœºåˆ¶ 2.1ã€æ¶ˆæ¯è½¬å‘çš„åŸç† 2.2ã€SEL isa super cmd æ˜¯ä»€ä¹ˆ ï¼ˆ3ï¼‰åŠ¨æ€ç»‘å®š 123ã€ä½¿ç”¨buglyè¿›è¡Œå´©æºƒåˆ†æ 124ã€jenkens æŒç»­æ‰“åŒ… 125ã€KVO &amp; KVC ï¼ˆ1ï¼‰åº•å±‚å®ç° ï¼ˆ2ï¼‰KVOæ¦‚è¿° ï¼ˆ3ï¼‰KVCæ¦‚è¿° 126ã€ä»€ä¹ˆæ˜¯KVOå’ŒKVC? KVOå’ŒKVC ï¼ˆ1ï¼‰å¦‚ä½•è°ƒç”¨ç§æœ‰å˜é‡ï¼Œå¦‚ä½•ä¿®æ”¹ç³»ç»Ÿçš„åªè¯»å±æ€§ï¼ŒKVCçš„æŸ¥æ‰¾é¡ºåº ï¼ˆ2ï¼‰ä»€ä¹ˆæ˜¯é”®-å€¼,é”®è·¯å¾„æ˜¯ä»€ä¹ˆ ï¼ˆ3ï¼‰kvoçš„å®ç°æœºåˆ¶ ï¼ˆ4ï¼‰KVOè®¡ç®—å±æ€§ï¼Œè®¾ç½®ä¾èµ–é”® ï¼ˆ5ï¼‰KVOé›†åˆå±æ€§ ï¼ˆ6ï¼‰kvoä½¿ç”¨åœºæ™¯ 127ã€SDWebImage(SDWebImageçš„å®ç°æœºåˆ¶ï¼‰ ï¼ˆ1ï¼‰ä¸»è¦åŠŸèƒ½ ï¼ˆ2ï¼‰ç¼“å­˜ ï¼ˆ3ï¼‰å†…å­˜ç¼“å­˜ä¸ç£ç›˜ç¼“å­˜ 128ã€æ¡†æ¶ SDWebimageçš„ç¼“å­˜æœºåˆ¶ 129ã€ç½‘ç»œå®‰å…¨ å¯†ç çš„å®‰å…¨åŸåˆ™ 130ã€å¤šçº¿ç¨‹ ï¼ˆ1ï¼‰å¤šçº¿ç¨‹æ¦‚å¿µ ï¼ˆ2ï¼‰å¤šçº¿ç¨‹çš„ä½œç”¨ ï¼ˆ3ï¼‰ä½¿ç”¨åœºæ™¯ 131ã€NSOperationQueueå’ŒGCDçš„åŒºåˆ«æ˜¯ä»€ä¹ˆ 132ã€GCDä¸NSThreadçš„åŒºåˆ« 133ã€è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«ä¸è”ç³»æ˜¯ä»€ä¹ˆ? 134ã€åˆ«å¼‚æ­¥æ‰§è¡Œä¸¤ä¸ªè€—æ—¶æ“ä½œï¼Œç­‰ä¸¤æ¬¡è€—æ—¶æ“ä½œéƒ½æ‰§è¡Œå®Œæ¯•å,å†å›åˆ°ä¸»çº¿ç¨‹æ‰§è¡Œæ“ä½œ. ä½¿ç”¨é˜Ÿåˆ—ç»„(dispatch_group_t)å¿«é€Ÿ,é«˜æ•ˆçš„å®ç°ä¸Šè¿°éœ€æ±‚ 135ã€åœ¨é¡¹ç›®ä»€ä¹ˆæ—¶å€™é€‰æ‹©ä½¿ç”¨GCDï¼Œä»€ä¹ˆæ—¶å€™é€‰æ‹©NSOperation? 136ã€å¯¹æ¯”iOSä¸­çš„å¤šçº¿ç¨‹æŠ€æœ¯ 137ã€å¤šçº¿ç¨‹ä¼˜ç¼ºç‚¹ 138ã€iOSä¸­çš„å»¶è¿Ÿæ“ä½œ 139ã€ä¸²è¡Œé˜Ÿåˆ—åŒæ­¥æ‰§è¡Œå’Œå¼‚æ­¥ä¸»é˜Ÿåˆ— 140ã€èµ„æºæŠ¢å¤ºè§£å†³æ–¹æ¡ˆ 141ã€dispatch_barrier_asyncçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ 142ã€åœ¨å¤šçº¿ç¨‹Core Dataä¸­ï¼ŒNSC,MOC,NSObjectModelå“ªäº›éœ€è¦åœ¨çº¿ç¨‹ä¸­åˆ›å»ºæˆ–è€…ä¼ é€’ï¼Ÿä½ æ˜¯ç”¨ä»€ä¹ˆç­–è¶Šæ¥å®ç°çš„ï¼Ÿ 143ã€+(void)loadä¸ +(void)initializeåŒºåˆ«load å’Œ initializeæ–¹æ³•çš„åŒºåˆ« 144ã€httpçš„postä¸åŒºåˆ«ä¸è”ç³»ï¼Œå®è·µä¸­å¦‚ä½•é€‰æ‹©å®ƒä»¬ï¼Ÿ 145ã€è¯´è¯´å…³äºUDP/TCPçš„åŒºåˆ«ï¼Ÿ 146ã€httpå’Œscoketé€šä¿¡çš„åŒºåˆ«?socketè¿æ¥ç›¸å…³åº“,TCP,UDPçš„è¿æ¥æ–¹æ³•,HTTPçš„å‡ ç§å¸¸ç”¨æ–¹å¼? 147ã€HTTPè¯·æ±‚å¸¸ç”¨çš„å‡ ç§æ–¹å¼ 148ã€block ï¼ˆ1ï¼‰ä½¿ç”¨blockæ—¶ä»€ä¹ˆæƒ…å†µä¼šå‘ç”Ÿå¼•ç”¨å¾ªç¯ï¼Œå¦‚ä½•è§£å†³ï¼Ÿ ï¼ˆ2ï¼‰åœ¨blockå†…å¦‚ä½•ä¿®æ”¹blockå¤–éƒ¨å˜é‡ï¼Ÿ ï¼ˆ3ï¼‰Block &amp; MRC-Block ï¼ˆ4ï¼‰ä»€ä¹ˆæ˜¯block ï¼ˆ5ï¼‰block å®ç°åŸç† ï¼ˆ6ï¼‰å…³äºblock ï¼ˆ7ï¼‰ä½¿ç”¨blockå’Œä½¿ç”¨delegateå®Œæˆå§”æ‰˜æ¨¡å¼æœ‰ä»€ä¹ˆä¼˜ç‚¹ ï¼ˆ8ï¼‰å¤šçº¿ç¨‹ä¸block ï¼ˆ9ï¼‰è°ˆè°ˆå¯¹Block çš„ç†è§£?å¹¶å†™å‡ºä¸€ä¸ªä½¿ç”¨Blockæ‰§è¡ŒUIVewåŠ¨ç”»? ï¼ˆ10ï¼‰å†™å‡ºä¸Šé¢ä»£ç çš„Blockçš„å®šä¹‰ï¼ˆæ¥ä¸Šé¢˜ï¼‰ 149ã€Weakã€strongã€copyã€assign ä½¿ç”¨ ï¼ˆ1ï¼‰ä»€ä¹ˆæƒ…å†µä½¿ç”¨ weak å…³é”®å­—ï¼Œç›¸æ¯” assign æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ ï¼ˆ2ï¼‰æ€ä¹ˆç”¨ copy å…³é”®å­—ï¼Ÿ ï¼ˆ3ï¼‰weak &amp; strong ï¼ˆ4ï¼‰è¿™ä¸ªå†™æ³•ä¼šå‡ºä»€ä¹ˆé—®é¢˜ï¼š @property (copy) NSMutableArray *array ï¼ˆ5ï¼‰ å¦‚ä½•è®©è‡ªå·±çš„ç±»ç”¨ copy ä¿®é¥°ç¬¦ï¼Ÿå¦‚ä½•é‡å†™å¸¦ copy å…³é”®å­—çš„ setterï¼Ÿ ï¼ˆ6ï¼‰ @property çš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿivarã€getterã€setter æ˜¯å¦‚ä½•ç”Ÿæˆå¹¶æ·»åŠ åˆ°è¿™ä¸ªç±»ä¸­çš„ ï¼ˆ7ï¼‰ivarã€getterã€setter æ˜¯å¦‚ä½•ç”Ÿæˆå¹¶æ·»åŠ åˆ°è¿™ä¸ªç±»ä¸­çš„? ï¼ˆ8ï¼‰ç”¨@propertyå£°æ˜çš„NSStringï¼ˆæˆ–NSArrayï¼ŒNSDictionaryï¼‰ç»å¸¸ä½¿ç”¨copyå…³é”®å­—ï¼Œä¸ºä»€ä¹ˆï¼Ÿå¦‚æœæ”¹ç”¨strongå…³é”®å­—ï¼Œå¯èƒ½é€ æˆä»€ä¹ˆé—®é¢˜ï¼Ÿ ï¼ˆ9ï¼‰@protocol å’Œ category ä¸­å¦‚ä½•ä½¿ç”¨ @property ï¼ˆ10ï¼‰runtimeå¦‚ä½•é€šè¿‡selectoræ‰¾åˆ°å¯¹åº”çš„IMPåœ°å€ï¼Ÿ ï¼ˆ11ï¼‰retainå’ŒcopyåŒºåˆ« ï¼ˆ12ï¼‰copyå’Œstrongçš„ä½¿ç”¨ï¼Ÿ ï¼ˆ13ï¼‰NSStringå’ŒNSMutableStringï¼Œå‰è€…çº¿ç¨‹å®‰å…¨ï¼Œåè€…çº¿ç¨‹ä¸å®‰å…¨ã€‚ ï¼ˆ14ï¼‰readwriteï¼Œreadonlyï¼Œassignï¼Œretainï¼Œcopyï¼Œweak ,strong,nonatomic å±æ€§çš„ä½œç”¨ 150ã€OCä¸JSçš„äº¤äº’ï¼ˆiOSä¸H5æ··ç¼–ï¼‰ TableViewæ€§èƒ½ä¼˜åŒ– UITableViewæ ¸å¿ƒæ€æƒ³ UITableViewçš„ä¼˜åŒ–ä¸»è¦ä»ä¸‰ä¸ªæ–¹é¢å…¥æ‰‹ï¼š 151ã€TableViewä¸ºä»€ä¹ˆä¼šå¡ï¼Ÿ 152ã€UITableView ï¼ˆ1ï¼‰UITableViewæœ€æ ¸å¿ƒçš„æ€æƒ³ ï¼ˆ2ï¼‰å®šä¹‰é«˜åº¦ ï¼ˆ3ï¼‰è‡ªå®šä¹‰é«˜åº¦åŸç† ï¼ˆ4ï¼‰è€ç”Ÿå¸¸è°ˆä¹‹UITableViewçš„æ€§èƒ½ä¼˜åŒ– ï¼ˆ5ï¼‰cellé«˜åº¦çš„è®¡ç®— ï¼ˆ5.1ï¼‰å®šé«˜çš„cellå’ŒåŠ¨æ€é«˜åº¦çš„cell ï¼ˆ6ï¼‰TableViewæ¸²æŸ“ ï¼ˆ7ï¼‰å‡å°‘è§†å›¾çš„æ•°ç›® ï¼ˆ8ï¼‰å‡å°‘å¤šä½™çš„ç»˜åˆ¶æ“ä½œ ï¼ˆ9ï¼‰ä¸è¦ç»™cellåŠ¨æ€æ·»åŠ subView ï¼ˆ10ï¼‰å¼‚æ­¥åŒ–UIï¼Œä¸è¦é˜»å¡ä¸»çº¿ç¨‹ ï¼ˆ11ï¼‰æ»‘åŠ¨æ—¶æŒ‰éœ€åŠ è½½å¯¹åº”çš„å†…å®¹ ï¼ˆ12ï¼‰ç¦»å±æ¸²æŸ“çš„é—®é¢˜ ï¼ˆ13ï¼‰ç¦»å±æ¸²æŸ“ä¼˜åŒ–æ–¹æ¡ˆ 153ã€ç¯ä¿¡SDKä½¿ç”¨ 154ã€è“ç‰™ 155ã€åœ¨iPhoneåº”ç”¨ä¸­å¦‚ä½•ä¿å­˜æ•°æ®? 156ã€ä»€ä¹ˆæ˜¯coredata? 157ã€ ä»€ä¹ˆæ˜¯NSManagedObjectæ¨¡å‹? 158ã€ä»€ä¹ˆæ˜¯NSManagedobjectContext? 159ã€ iOSå¹³å°æ€ä¹ˆåšæ•°æ®çš„æŒä¹…åŒ–?coredata å’Œsqliteæœ‰æ— å¿…ç„¶è”ç³»ï¼Ÿcoredataæ˜¯ä¸€ä¸ªå…³ç³»å‹æ•°æ®åº“å—ï¼Ÿ 160ã€CoreData &amp; SQLite3 161ã€æ•°æ®å­˜å‚¨ ï¼ˆ1ï¼‰æ•°æ®å­˜å‚¨æŠ€æœ¯ ï¼ˆ1.1ï¼‰æ•°æ®å­˜å‚¨çš„å‡ ç§æ–¹å¼ ï¼ˆ1.2ï¼‰å„è‡ªç‰¹ç‚¹ï¼ˆé¢è¯•è€ƒç‚¹ï¼‰ ï¼ˆ1.3ï¼‰åå¥½è®¾ç½®ï¼ˆé¢è¯•è€ƒç‚¹ï¼‰ ï¼ˆ1.4ï¼‰å½’æ¡£ï¼ˆé¢è¯•è€ƒç‚¹ï¼‰ ï¼ˆ2ï¼‰æ•°æ®åº“æŠ€æœ¯ï¼ˆSQLite&amp;CoreDataï¼‰ 162ã€Objective-Cå †å’Œæ ˆçš„åŒºåˆ«ï¼Ÿ 163ã€å†…å­˜æ³„éœ² &amp; å†…å­˜æº¢å‡º 164ã€å † &amp; æ ˆ ï¼ˆ1ï¼‰å †æ ˆç©ºé—´åˆ†é…åŒºåˆ« ï¼ˆ2ï¼‰å †æ ˆç¼“å­˜æ–¹å¼åŒºåˆ« ï¼ˆ3ï¼‰å †æ ˆæ•°æ®ç»“æ„åŒºåˆ« 165ã€å†…å­˜ç®¡ç† ï¼ˆ1ï¼‰å†…å­˜åŒºåŸŸ ï¼ˆ1.1ï¼‰å †å’Œæ ˆçš„åŒºåˆ« ï¼ˆ1.2ï¼‰iOSå†…å­˜åŒºåŸŸ ï¼ˆ2ï¼‰å­—ç¬¦ä¸²çš„å†…å­˜ç®¡ç† ï¼ˆ3ï¼‰ä½ æ˜¯å¦‚ä½•ä¼˜åŒ–å†…å­˜ç®¡ç† ï¼ˆ4ï¼‰å¾ªç¯å¼•ç”¨ ï¼ˆ5ï¼‰autoreleaseçš„ä½¿ç”¨ ï¼ˆ5.1ï¼‰å·¥å‚æ–¹æ³•ä¸ºä»€ä¹ˆä¸é‡Šæ”¾å¯¹è±¡ ï¼ˆ5.2ï¼‰ARCä¸‹autoreleaseçš„ä½¿ç”¨åœºæ™¯ ï¼ˆ5.3ï¼‰è‡ªåŠ¨é‡Šæ”¾æ± å¦‚ä½•å·¥ä½œ ï¼ˆ5.4ï¼‰é¿å…å†…å­˜å³°å€¼ ï¼ˆ5.5ï¼‰ARCå’ŒMRCçš„æ··ç”¨ ï¼ˆ5.6ï¼‰NSTimerçš„å†…å­˜ç®¡ç† ï¼ˆ5.7ï¼‰ARCçš„å®ç°åŸç† 166ã€Runloop 167ã€fmmpegæ¡†æ¶ 168ã€fmdbæ¡†æ¶ 169ã€320æ¡†æ¶ 170ã€UIKitå’ŒCoreAnimationå’ŒCoreGraphicsçš„å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿåœ¨å¼€å‘ä¸­æ˜¯å¦ä½¿ç”¨è¿‡CoreAnimationå’ŒCoreGraphics? 171ã€trasform 172ã€ç‚¹è®²åŠ¨ç”»å’Œlayer ,viewçš„åŒºåˆ« 173ã€å›¾å±‚ä¸è§†å›¾ 174ã€å¹³è¡Œçš„å±‚çº§å…³ç³» 175ã€å›¾å±‚çš„èƒ½åŠ› 176ã€ä½¿ç”¨å›¾å±‚ 177ã€æ ¸å¿ƒç»˜å›¾ ï¼ˆ1ï¼‰Viewå’Œlayerçš„åŒºåˆ« ï¼ˆ2ï¼‰newå’Œalloc initçš„åŒºåˆ« 178ã€åŠ¨ç”» 179ã€UICollectionView ï¼ˆ1ï¼‰ä½•å®ç°ç€‘å¸ƒæµ,æµæ°´å¸ƒå±€ ï¼ˆ2ï¼‰å’ŒUITableViewçš„ä½¿ç”¨åŒºåˆ« 180ã€UIImage 181ã€webview 182ã€æè¿°ä¹å®«æ ¼ç®—æ³• 183ã€å®ç°å›¾ç‰‡è½®æ’­å›¾ 184ã€iOSç½‘ç»œæ¡†æ¶ 185ã€ç½‘ç»œ ï¼ˆ1ï¼‰ç½‘ç»œåŸºç¡€ ï¼ˆ2ï¼‰ç½‘ç»œä¼ è¾“ ï¼ˆ3ï¼‰AFN 186ã€AFNetworking &amp; ASIHttpRequest &amp; MKNetWorking ï¼ˆ1ï¼‰åº•å±‚å®ç° ï¼ˆ2ï¼‰å¯¹æœåŠ¡å™¨è¿”å›çš„æ•°æ®å¤„ç† ï¼ˆ3ï¼‰ç›‘å¬è¯·æ±‚è¿‡ç¨‹ ï¼ˆ4ï¼‰åœ¨æ–‡ä»¶ä¸‹è½½å’Œæ–‡ä»¶ä¸Šä¼ çš„ä½¿ç”¨éš¾æ˜“åº¦ ï¼ˆ5ï¼‰ç½‘ç»œç›‘æ§ ï¼ˆ6ï¼‰ASIæä¾›çš„å…¶ä»–å®ç”¨åŠŸèƒ½ ï¼ˆ7ï¼‰MKNetworkKit 187ã€æ€§èƒ½ä¼˜åŒ– 188ã€ç®—æ³•","categories":[{"name":"é¢è¯•é¢˜","slug":"é¢è¯•é¢˜","permalink":"https://github.com/wuvdan/wuvdan.github.io/categories/%E9%9D%A2%E8%AF%95%E9%A2%98/"}],"tags":[{"name":"é¢è¯•æŠ€å·§","slug":"é¢è¯•æŠ€å·§","permalink":"https://github.com/wuvdan/wuvdan.github.io/tags/%E9%9D%A2%E8%AF%95%E6%8A%80%E5%B7%A7/"}]},{"title":"iOSé¢è¯•é¢˜-003","slug":"iOSé¢è¯•é¢˜-003","date":"2020-01-16T08:05:35.573Z","updated":"2020-01-20T01:45:21.179Z","comments":true,"path":"2020/01/16/iOSé¢è¯•é¢˜-003/","link":"","permalink":"https://github.com/wuvdan/wuvdan.github.io/2020/01/16/iOS%E9%9D%A2%E8%AF%95%E9%A2%98-003/","excerpt":"","text":"ä¸€ã€UIè§†å›¾æ‹¬äº‹ä»¶ä¼ é€’è§†å›¾å“åº”UIå¸ƒå±€UIç»˜åˆ¶UITableviewé‡ç”¨æœºåˆ¶çš„ç†è§£ç­‰åŸºæœ¬æŠ€æœ¯ç‚¹ç¦»å±æ¸²æŸ“æµå¼é¡µé¢çš„æ€§èƒ½ä¼˜åŒ–å¼‚æ­¥ç»˜åˆ¶UIæ¸²æŸ“æœºåˆ¶Objective-Cè¯­è¨€KVOKVCåˆ†ç±»æ‰©å±•å…³è”å¯¹è±¡NSNotificationå±æ€§å…³é”®å­—ä¸‰ã€Runtimeå¯¹è±¡ç±»å¯¹è±¡åŸç±»å¯¹è±¡æ¶ˆæ¯ä¼ é€’æœºåˆ¶æ¶ˆæ¯è½¬å‘æµç¨‹Method-SwizzlingISA-swizzlingåŠ¨æ€æ–¹æ³•è§£æåŠ¨æ€æ·»åŠ æ–¹æ³•å››ã€å†…å­˜ç®¡ç†weakè‡ªåŠ¨ç½®nilARCMRCè‡ªåŠ¨é‡Šæ”¾æ± çš„å®ç°åŸç†å¾ªç¯å¼•ç”¨å¼•ç”¨è®¡æ•°ç®¡ç†äº”ã€Blockæˆªè·å˜é‡ç‰¹æ€§__Blockå…³é”®å­—Blockçš„æœ¬è´¨Blockçš„å†…å­˜ç®¡ç†å¾ªç¯å¼•ç”¨å…­ã€å¤šçº¿ç¨‹NSOperation&amp;NSOperationQueue ### NSThreadGCDNSLocké€’å½’é”è‡ªæ—‹é”æ¡ä»¶é”ä¸ƒã€RunLoopRunLoopä¸ºä»€ä¹ˆä¼šæœ‰äº‹åšäº‹æ²¡äº‹ä¼‘æ¯ï¼Œç³»ç»Ÿæ˜¯æ€æ ·å®ç°çš„æ€æ ·å®ç°ä¸€ä¸ªå¸¸é©»çº¿ç¨‹RunLoopå’Œçº¿ç¨‹çš„å…³ç³»æ˜¯æ€æ ·å…«ã€ç½‘ç»œHTTPç›¸å…³çš„ä¸­é—´äººæ”»å‡»HTTPSçš„è¿æ¥å»ºç«‹æµç¨‹å¯¹ç§°åŠ å¯†éå¯¹ç§°åŠ å¯†DNSåŠ«æŒTCPçš„æ»‘åŠ¨çª—å£åè®®å¯é ä¼ è¾“æ˜¯æ€æ ·ä¿è¯çš„TCPçš„æ…¢å¯åŠ¨ç‰¹ç‚¹Session/Cookieçš„åŒºåˆ«ä¹ã€è®¾è®¡æ¨¡å¼è½¯ä»¶è®¾è®¡åŸåˆ™è´£ä»»é“¾é€‚é…å™¨æ¡¥æ¥å‘½ä»¤å•ä¾‹ç­–ç•¥æ¨¡å¼åã€æ¶æ„/æ¡†æ¶æ€æ ·è®¾è®¡å›¾ç‰‡ç¼“å­˜æ¡†æ¶ç½‘ç»œæ¡†æ¶å®¢æˆ·ç«¯çš„æ•´ä½“æ¶æ„æ€æ ·å®ç°å¸¸è§çš„è§£è€¦æ–¹å¼æœ‰å“ªäº›","categories":[{"name":"é¢è¯•é¢˜","slug":"é¢è¯•é¢˜","permalink":"https://github.com/wuvdan/wuvdan.github.io/categories/%E9%9D%A2%E8%AF%95%E9%A2%98/"}],"tags":[{"name":"é¢è¯•æŠ€å·§","slug":"é¢è¯•æŠ€å·§","permalink":"https://github.com/wuvdan/wuvdan.github.io/tags/%E9%9D%A2%E8%AF%95%E6%8A%80%E5%B7%A7/"}]},{"title":"iOSé¢è¯•é¢˜-002","slug":"iOSé¢è¯•é¢˜-002","date":"2020-01-16T08:05:31.117Z","updated":"2020-01-20T01:45:29.234Z","comments":true,"path":"2020/01/16/iOSé¢è¯•é¢˜-002/","link":"","permalink":"https://github.com/wuvdan/wuvdan.github.io/2020/01/16/iOS%E9%9D%A2%E8%AF%95%E9%A2%98-002/","excerpt":"","text":"æ¶æ„æ¨¡å¼,ç¼–ç¨‹æ€æƒ³,è®¾è®¡æ¨¡å¼1ã€æ¶æ„æ¨¡å¼ MVC: MVCå³Model-VIew-Controllerã€‚MVCæ¨¡å¼è‡´åŠ›äºå…³æ³¨ç‚¹çš„åˆ‡åˆ†ï¼Œè¿™æ„å‘³ç€modelå’Œcontrollerçš„é€»è¾‘æ˜¯ä¸ä¸ç”¨æˆ·ç•Œé¢ï¼ˆViewï¼‰æŒ‚é’©çš„ã€‚Modelå±‚ä»£è¡¨äº†æè¿°ä¸šåŠ¡é€»è¾‘å’Œæ•°æ®çš„ä¸€ç³»åˆ—ç±»çš„é›†åˆã€‚å®ƒä¹Ÿå®šä¹‰äº†æ•°æ®ä¿®æ”¹å’Œæ“ä½œçš„ä¸šåŠ¡è§„åˆ™ã€‚Viewä»£è¡¨äº†UIç»„ä»¶ï¼ŒåƒUIViewï¼ŒUIButtonï¼ŒUITableViewç­‰ã€‚ä»–åªè´Ÿè´£å±•ç¤ºä»controlleræ¥æ”¶åˆ°çš„æ•°æ®ã€‚å› æ­¤ï¼Œç»´æŠ¤å’Œæµ‹è¯•ç¨‹åºå˜å¾—æ›´åŠ ç®€å•å®¹æ˜“ã€‚ç„¶è€Œåœ¨Cocoaçš„MVCæ¨¡å¼ä¸­Controllerç»å¸¸è¢«æ··æ‚åœ¨Viewçš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œå› æ­¤å¾ˆéš¾è¯´Viewå’ŒViewControlleræ˜¯åˆ†ç¦»çš„ï¼Œè¿™ä¹Ÿå¾€å¾€é©±ä½¿äººä»¬å†™å‡ºè‡ƒè‚¿çš„è§†å›¾æ§åˆ¶å™¨ï¼Œå°½ç®¡ä»å¯ä»¥å°†ä¸šåŠ¡é€»è¾‘å’Œæ•°æ®è½¬æ¢åˆ°Modelï¼Œä½†æ˜¯å¤§å¤šæ•°æƒ…å†µä¸‹å½“éœ€è¦ä¸ºViewå‡è´Ÿçš„æ—¶å€™æˆ‘ä»¬å´æ— èƒ½ä¸ºåŠ›äº†ã€‚Viewçš„æœ€å¤§çš„ä»»åŠ¡å°±æ˜¯å‘Controllerä¼ é€’ç”¨æˆ·åŠ¨ä½œäº‹ä»¶ã€‚ViewControllerä¸å†æ‰¿æ‹…ä¸€åˆ‡ä»£ç†å’Œæ•°æ®æºçš„èŒè´£ï¼Œé€šå¸¸åªè´Ÿè´£ä¸€äº›åˆ†å‘å’Œå–æ¶ˆç½‘ç»œè¯·æ±‚ä»¥åŠä¸€äº›å…¶ä»–çš„ä»»åŠ¡ã€‚å½“åœ¨è¿›è¡Œå•å…ƒæµ‹è¯•çš„æ—¶å€™ä½ ä¼šå‘ç°é—®é¢˜è¶Šæ¥è¶Šæ˜æ˜¾ã€‚å› ä¸ºä½ çš„ViewControllerå’ŒViewæ˜¯ç´§å¯†è€¦åˆçš„ï¼Œå¯¹å®ƒä»¬è¿›è¡Œæµ‹è¯•å°±æ˜¾å¾—å¾ˆè‰°éš¾ã€‚Cocoa MVCçœ‹æ¥å¹¶ä¸æ˜¯æˆ‘ä»¬å®šä¹‰ä¸­ç†æƒ³çš„æ¶æ„æ¨¡å¼ã€‚ MVVM: å³Model-View-View Modelã€‚è¿™ä¸ªæ¨¡å¼æä¾›å¯¹Viewå’ŒView Modelçš„åŒå‘æ•°æ®ç»‘å®šã€‚è¿™ä½¿å¾—View Modelçš„çŠ¶æ€æ”¹å˜å¯ä»¥è‡ªåŠ¨ä¼ é€’ç»™Viewã€‚å…¸å‹çš„æƒ…å†µæ˜¯ï¼ŒView Modelé€šè¿‡ä½¿ç”¨obseveræ¨¡å¼ï¼ˆè§‚å¯Ÿè€…æ¨¡å¼ï¼‰æ¥å°†View Modelçš„å˜åŒ–é€šçŸ¥ç»™modelã€‚View Modelè´Ÿè´£æš´æ¼æ–¹æ³•ï¼Œå‘½ä»¤ï¼Œå…¶ä»–å±æ€§æ¥æ“ä½œVIewçš„çŠ¶æ€ï¼Œç»„è£…modelä½œä¸ºViewåŠ¨ä½œçš„ç»“æœï¼Œå¹¶ä¸”è§¦å‘Viewè‡ªå·±çš„äº‹ä»¶ã€‚å®ƒå’ŒMVPæ¨¡å¼çœ‹èµ·æ¥éå¸¸åƒ:MVVMå°†ViewControllerè§†ä½œView,Viewå’ŒModelä¹‹é—´æ²¡æœ‰ç´§å¯†çš„è”ç³»ã€‚åœ¨ä½¿ç”¨MVVMæ¨¡å¼æ—¶ï¼Œè‡ªç„¶è€Œç„¶ä¼šæƒ³åˆ°ReactiveCocaï¼Œåä¹‹äº¦ç„¶ã€‚å°½ç®¡é€šè¿‡ç®€å•çš„ç»‘å®šæ¥ä½¿ç”¨MVVMæ˜¯å¯å®ç°çš„ï¼Œä½†æ˜¯ReactiveCocoaå´èƒ½æ›´å¥½çš„å‘æŒ¥MVVMæ¨¡å¼çš„ç‰¹ç‚¹ã€‚ä½†æ˜¯ä½¿ç”¨è¿™ä¸ªæ¡†æ¶æœ‰ä¸ªéš¾ä»¥å¿½ç•¥çš„äº‹å®ï¼šå½“ä½ åˆšå¼€å§‹ä½¿ç”¨ReactiveCocaçš„æ—¶å€™æœ‰å¾ˆå¤§çš„å¯èƒ½å°±ä¼šæŠŠäº‹æƒ…æç ¸ã€‚æ¢å¥è¯æ¥è¯´å°±æ˜¯ï¼Œå¦‚æœå‘ç°äº†ä¸€äº›é”™è¯¯ï¼Œå½“ä½ è¯•å›¾æŸ¥çœ‹å‡½æ•°è°ƒç”¨æ ˆæ—¶ä½ å¯èƒ½ä¼šå–Šï¼šâ€œå¤©å“ªï¼Œå¥½æ·±çš„å‡½æ•°è°ƒç”¨æ ˆâ€œï¼è°ƒè¯•å‡ºè¿™ä¸ªbugå¯èƒ½ä¼šèŠ±è´¹å¤§é‡çš„æ—¶é—´ã€‚MVVMå¾ˆè¯±äººï¼Œå› ä¸ºå®ƒé›†åˆäº†ä¸Šè¿°æ–¹æ³•çš„ä¼˜ç‚¹ï¼Œå¹¶ä¸”ç”±äºåœ¨Viewå±‚çš„ç»‘å®šï¼Œå®ƒå¹¶ä¸éœ€è¦å…¶ä»–é™„åŠ çš„ä»£ç æ¥æ›´æ–°Viewï¼Œå°½ç®¡è¿™æ ·ï¼Œå¯æµ‹è¯•æ€§ä¾ç„¶å¾ˆå¼ºâ€”â€”ç¬¦åˆæˆ‘ä»¬ç†æƒ³ä¸­å¥½æ¶æ„æ¨¡å¼çš„å®šä¹‰ã€‚ MVP: è¿™ä¸ªæ¨¡å¼æŠŠPresenteræ¢æˆControllerå°±å’ŒMVCéå¸¸ç›¸åƒäº†ã€‚è¿™ä¸ªè®¾è®¡æ¨¡å¼æŠŠåº”ç”¨ç¨‹åºåˆ†æˆäº†3ä¸ªä¸»è¦æ–¹é¢ï¼šModelã€Viewå’ŒPresenter,å…¶ä¸­çš„Modelå’ŒViewä¸MVCæ¨¡ä¸­çš„è§’è‰²ç›¸åŒã€‚Presenterè´Ÿè´£å¤„ç†ViewèƒŒåæ‰€æœ‰çš„UIäº‹ä»¶ã€‚å®ƒé€šè¿‡Viewæ¥æ”¶ç”¨æˆ·è¾“å…¥ï¼Œä¹‹ååˆ©ç”¨Modelæ¥å¤„ç†ç”¨æˆ·çš„æ•°æ®ï¼Œæœ€åæŠŠç»“æœè¿”å›ç»™Viewã€‚ä¸Viewå’ŒControllerä¸åŒï¼ŒViewå’ŒPresenterä¹‹é—´æ˜¯å®Œå…¨è§£è€¦çš„ï¼Œä»–ä»¬é€šè¿‡æ¥å£æ¥äº¤äº’ã€‚å¦å¤–ï¼Œpresenterä¸åƒcontrollerå¤„ç†è¿›å…¥çš„è¯·æ±‚ã€‚è¿™ä¸æ˜¯æ­£è§£å†³äº†Cocoa MVCä¸­ViewControllerå’ŒViewçš„è€¦åˆé—®é¢˜å—ï¼Ÿå°±MVPæ¨¡å¼è€Œè¨€ï¼ŒUIViewControllerçš„å­ç±»å®é™…ä¸Šå°±æ˜¯Viewså¹¶ä¸æ˜¯Presentersã€‚è¿™ç‚¹åŒºåˆ«ä½¿å¾—è¿™ç§æ¨¡å¼çš„å¯æµ‹è¯•æ€§å¾—åˆ°äº†æå¤§çš„æé«˜ï¼Œä»˜å‡ºçš„ä»£ä»·æ˜¯å¼€å‘é€Ÿåº¦çš„ä¸€äº›é™ä½ï¼Œå› ä¸ºå¿…é¡»è¦åšä¸€äº›æ‰‹åŠ¨çš„æ•°æ®å’Œäº‹ä»¶ç»‘å®šã€‚ä½†æ˜¯è¿™ä¹Ÿæ„å‘³ç€æˆ‘ä»¬å°†æœ€ä¸»è¦çš„ä»»åŠ¡åˆ’åˆ†åˆ°Presenterå’ŒModelï¼Œè€ŒViewçš„åŠŸèƒ½è¾ƒå°‘â€”â€”å„ä¸ªå®ä½“ä»»åŠ¡é‡åˆ†é…ä¸å‡è¡¡ã€‚ Viperæ¶æ„æ¨¡å¼: ç”±è§†å›¾ (View)ï¼Œäº¤äº’å™¨ (Interactor)ï¼Œå±•ç¤ºå™¨ (Presenter)ï¼Œå®ä½“ (Entity) ä»¥åŠè·¯ç”± (Routing) ç»„æˆã€‚è§†å›¾ï¼šæ ¹æ®å±•ç¤ºå™¨çš„è¦æ±‚æ˜¾ç¤ºç•Œé¢ï¼Œå¹¶å°†ç”¨æˆ·è¾“å…¥åé¦ˆç»™å±•ç¤ºå™¨ã€‚äº¤äº’å™¨ï¼šåŒ…å«ç”±ç”¨ä¾‹æŒ‡å®šçš„ä¸šåŠ¡é€»è¾‘ã€‚å±•ç¤ºå™¨ï¼šåŒ…å«ä¸ºæ˜¾ç¤ºï¼ˆä»äº¤äº’å™¨æ¥å—çš„å†…å®¹ï¼‰åšçš„å‡†å¤‡å·¥ä½œçš„ç›¸å…³è§†å›¾é€»è¾‘ï¼Œå¹¶å¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œåé¦ˆï¼ˆä»äº¤äº’å™¨è·å–æ–°æ•°æ®ï¼‰ã€‚å®ä½“ï¼šåŒ…å«äº¤äº’å™¨è¦ä½¿ç”¨çš„åŸºæœ¬æ¨¡å‹å¯¹è±¡ã€‚è·¯ç”±ï¼šåŒ…å«ç”¨æ¥æè¿°å±å¹•æ˜¾ç¤ºå’Œæ˜¾ç¤ºé¡ºåºçš„å¯¼èˆªé€»è¾‘ã€‚Viperå°†åº”ç”¨ç¨‹åºçš„é€»è¾‘ç»“æ„åˆ’åˆ†ä¸ºä¸åŒçš„è´£ä»»å±‚ã€‚è¿™ä½¿å¾—å®ƒæ›´å®¹æ˜“éš”ç¦»ä¾èµ–é¡¹ (å¦‚æ•°æ®åº“)ï¼Œä¹Ÿæ›´å®¹æ˜“æµ‹è¯•å„å±‚é—´çš„è¾¹ç•Œå¤„çš„äº¤äº’ã€‚Viperçš„ä¸åŒå±‚æä¾›äº†æ˜ç¡®çš„ç¨‹åºé€»è¾‘ä»¥åŠå¯¼èˆªæ§åˆ¶ä»£ç æ¥é¿å…è§†å›¾æ§åˆ¶å™¨å¤ªè¿‡äºè‡ƒè‚¿çš„é—®é¢˜ï¼Œåˆ©ç”¨ Viper ï¼Œè§†å›¾æ§åˆ¶å™¨å¯ä»¥ç®€æ´é«˜æ•ˆï¼Œæ„ä¹‰æ˜ç¡®åœ°æ§åˆ¶è§†å›¾ã€‚è§†å›¾æ§åˆ¶å™¨ä¸­ä»£ç å’Œæ‰€æœ‰çš„å…¶ä»–ç±»å¾ˆå®¹æ˜“ç†è§£ï¼Œå®¹æ˜“æµ‹è¯•ï¼Œç†æ‰€å½“ç„¶ä¹Ÿæ›´æ˜“ç»´æŠ¤ã€‚æ¯«æ— ç–‘é—®ï¼ŒViperåœ¨åˆ’åˆ†è´£ä»»çš„ç²’åº¦ä¸Šæ¯”ä»¥ä¸Šå‡ ç§æ¨¡å¼éƒ½è¦ä¼˜ç§€ï¼Œè‡ªç„¶è€Œç„¶å°±æœ‰æ›´å¥½çš„å¯æµ‹è¯•æ€§ï¼Œå½“ç„¶ä½ å¿…é¡»ä¸ºå¾ˆå°åŠŸèƒ½çš„ç±»å†™å‡ºå¤§é‡çš„æ¥å£ã€‚å¦‚æœæ˜¯åœ¨å¤§å‹é¡¹ç›®ä¸­ä½¿ç”¨Viperï¼ŒViperæ¶æ„æ¨¡å¼ç¬¦åˆæˆ‘ä»¬ç†æƒ³ä¸­å¥½æ¶æ„æ¨¡å¼çš„å®šä¹‰ã€‚ 2ã€ç¼–ç¨‹æ€æƒ³é¢å‘å¯¹è±¡ç¼–ç¨‹æ€æƒ³ å°è£…åœ¨é¢å‘å¯¹è±¡çš„è¯­è¨€ä¸­ï¼Œå¯¹è±¡ã€ç±»ã€æ–¹æ³•éƒ½æ˜¯ä¸€ç§å°è£…ï¼Œå¯¹è±¡æ˜¯å°è£…çš„æœ€åŸºæœ¬å•ä½ã€‚ç±»çš„å°è£…ä½“ç°åœ¨æ¯ä¸ªç±»éƒ½æœ‰.hå’Œ.mä¸¤ä¸ªæ–‡ä»¶ï¼Œå°†å®šä¹‰ä¸å®ç°åˆ†å¼€ï¼Œ.hå£°æ˜ï¼ˆç”¨æˆ·å¯è§çš„å¤–éƒ¨æ¥å£ï¼‰ï¼Œ.må®ç°ï¼ˆç”¨æˆ·ä¸å¯è§çš„å†…éƒ¨å®ç°ï¼‰ã€‚æ–¹æ³•çš„å°è£…ï¼Œæ˜¯æœ€å¸¸è§çš„ï¼Œæ¯ä¸ªæ–¹æ³•ä¸­å°è£…äº†ä¸€ä¸ªå°çš„åŠŸèƒ½ï¼Œè¿™æ˜¯å•ä¸€èŒè´£çš„å¾ˆå¥½ä½“ç°ï¼Œç¬¬ä¸‰æ–¹æ¡†æ¶å’Œä»£ç ä¹Ÿæ˜¯ä¸€ç§å°è£…ã€‚å°è£…ä½¿ç¨‹åºçš„ç»“æ„æ›´åŠ æ¸…æ™°ï¼Œå°†å®ç°çš„ä¿¡æ¯å°è£…éšè—ï¼Œç”¨çš„æ—¶å€™ç›´æ¥è°ƒç”¨å°è£…å¥½çš„æ–¹æ³•æˆ–ç±»ï¼Œæé«˜æ•ˆç‡ã€‚æ­¤å¤–ï¼Œå¯ä»¥å‡å°‘ç¨‹åºé—´çš„ç›¸äº’ä¾èµ–ã€‚ ç»§æ‰¿å­ç±»è‡ªåŠ¨å…±äº«çˆ¶ç±»éç§æœ‰æ•°æ®ç»“æ„å’Œæ–¹æ³•çš„æœºåˆ¶ï¼Œæ˜¯ç±»ä¹‹é—´çš„ä¸€ç§å…³ç³»ã€‚ç»§æ‰¿æ˜¯é¢å‘å¯¹è±¡è¯­è¨€ç‰¹æœ‰çš„ï¼Œé¢å‘è¿‡ç¨‹çš„è¯­è¨€ä¸å…·æœ‰ç»§æ‰¿ç‰¹æ€§ï¼ŒOCæ˜¯å•ç»§æ‰¿ã€‚ç»§æ‰¿æä¾›äº†ç±»çš„è§„èŒƒç­‰çº§ç»“æ„ï¼Œä½¿å…¬å…±çš„ç‰¹æ€§èƒ½å¤Ÿå…±äº«ï¼Œæé«˜çš„è½¯ä»¶çš„é‡ç”¨æ€§ã€‚ç±»çš„ç»§æ‰¿æ€§ä½¿æ‰€å»ºçš„è½¯ä»¶å…·æœ‰å¼€å‘æ€§ã€å¯æ‰©å……æ€§ï¼Œç®€åŒ–äº†å¯¹è±¡ã€ç±»çš„åˆ›å»ºå·¥ä½œé‡ï¼Œæé«˜äº†ä»£ç çš„é‡ç”¨æ€§ã€‚ å¤šæ€ç”¨çˆ¶ç±»æŒ‡é’ˆæŒ‡å‘å­ç±»çš„å¯¹è±¡ã€‚é€šè¿‡ä¸åŒçš„å¯¹è±¡è°ƒç”¨ç›¸åŒçš„åç§°çš„æ–¹æ³•ï¼Œå´äº§ç”Ÿä¸åŒçš„ç»“æœã€‚é€šè¿‡çˆ¶ç±»æŒ‡é’ˆå¾—åˆ°çš„å‡ ä¸ªå¯¹è±¡ï¼Œéƒ½è°ƒç”¨äº†çˆ¶ç±»ä¸­æŸä¸ªæ–¹æ³•ï¼Œä½†å®é™…ä¸Šåœ¨è¿è¡Œçš„æ—¶å€™ï¼Œæ˜¯æ‰§è¡Œçš„è‡ªå·±çœŸå®ç±»ä¸­çš„æ–¹æ³•ã€‚å¤šæ€å¢å¼ºäº†è½¯ä»¶çš„çµæ´»æ€§å’Œé‡ç”¨æ€§ã€‚ é“¾å¼ç¼–ç¨‹æ€æƒ³ å°†å¤šä¸ªæ“ä½œï¼ˆå¤šè¡Œä»£ç ï¼‰é€šè¿‡ç‚¹å·(.)é“¾æ¥åœ¨ä¸€èµ·æˆä¸ºä¸€å¥ä»£ç ,ä½¿ä»£ç å¯è¯»æ€§å¥½ã€‚a(1).b(2).c(3)é“¾å¼ç¼–ç¨‹ç‰¹ç‚¹ï¼šæ–¹æ³•çš„è¿”å›å€¼æ˜¯block,blockå¿…é¡»æœ‰è¿”å›å€¼ï¼ˆæœ¬èº«å¯¹è±¡ï¼‰ï¼Œblockå‚æ•°ï¼ˆéœ€è¦æ“ä½œçš„å€¼ä»£è¡¨ï¼šMasonryæ¡†æ¶ å“åº”å¼ç¼–ç¨‹æ€æƒ³ ä¸éœ€è¦è€ƒè™‘è°ƒç”¨é¡ºåºï¼Œåªéœ€è¦çŸ¥é“è€ƒè™‘ç»“æœï¼Œç±»ä¼¼äºè´è¶æ•ˆåº”ï¼Œäº§ç”Ÿä¸€ä¸ªäº‹ä»¶ï¼Œä¼šå½±å“å¾ˆå¤šä¸œè¥¿ï¼Œè¿™äº›äº‹ä»¶åƒæµä¸€æ ·çš„ä¼ æ’­å‡ºå»ï¼Œç„¶åå½±å“ç»“æœï¼Œå€Ÿç”¨é¢å‘å¯¹è±¡çš„ä¸€å¥è¯ï¼Œä¸‡ç‰©çš†æ˜¯æµã€‚ ä»£è¡¨ï¼šKVOè¿ç”¨ã€‚ å‡½æ•°å¼ç¼–ç¨‹æ€æƒ³ æ˜¯æŠŠæ“ä½œå°½é‡å†™æˆä¸€ç³»åˆ—åµŒå¥—çš„å‡½æ•°æˆ–è€…æ–¹æ³•è°ƒç”¨ã€‚å‡½æ•°å¼ç¼–ç¨‹æœ¬è´¨:å°±æ˜¯å¾€æ–¹æ³•ä¸­ä¼ å…¥Block,æ–¹æ³•ä¸­åµŒå¥—Blockè°ƒç”¨ï¼ŒæŠŠä»£ç èšåˆèµ·æ¥ç®¡ç†å‡½æ•°å¼ç¼–ç¨‹ç‰¹ç‚¹ï¼šæ¯ä¸ªæ–¹æ³•å¿…é¡»æœ‰è¿”å›å€¼ï¼ˆæœ¬èº«å¯¹è±¡ï¼‰,æŠŠå‡½æ•°æˆ–è€…Blockå½“åšå‚æ•°,blockå‚æ•°ï¼ˆéœ€è¦æ“ä½œçš„å€¼ï¼‰blockè¿”å›å€¼ï¼ˆæ“ä½œç»“æœï¼‰ä»£è¡¨ï¼šReactiveCocoaã€‚ åº•å±‚è¿›é˜¶,æ·±å±‚ç†è§£ä¸‰æ–¹æ¡†æ¶è¦çŸ¥å…¶ç„¶,è€ŒçŸ¥å…¶æ‰€ä»¥ç„¶1ã€AFNetworkingAFNetworkingæœ‰5ä¸ªæ¨¡å—ï¼š NSURLSession ç½‘ç»œè¯·æ±‚æ¨¡å— AFHTTPSessionManagerç»§æ‰¿è‡ªAFURLSessionManagerGETPOSTDELETEPUTPATCHæ–‡ä»¶ä¸Šä¼ AFURLSessionManagerç®¡ç†æ‰€æœ‰çš„è¯·æ±‚ï¼Œè®¾ç½®äº†NSURLSessionTaskDelegate, NSRULSessionDataDelegate,NSURLSessionDownloadDelegateå®ç°è¯ä¹¦åˆæ³•æ€§æ ¡éªŒï¼Œæ•°æ®ä¼ è¾“è¿›åº¦æ£€æµ‹ï¼Œæ•°æ®è¯·æ±‚æˆåŠŸ/å¤±è´¥çš„å›è°ƒã€‚ä½¿ç”¨Runtimeç”¨af_suspendæ›¿æ¢ suspend, ç”¨af_resumeæ›¿æ¢äº†resume å½“è°ƒç”¨è€…ä¸¤ä¸ªæ–¹æ³•æ—¶å¾€ä¸Šå±‚å‘é€é€šçŸ¥ AFNetworkingTaskDidSuspendNotification AFNetworkingTaskDidResumeNotificationè¯·æ±‚æœåŠ¡å™¨æ•°æ®ä¸Šä¼ æ•°æ®å¤šçº¿ç¨‹ä¸‹è½½æ•°æ® Reachability ç›‘æµ‹ç½‘ç»œçŠ¶æ€æ¨¡å— AFNetworkReachabilityManager Security å®‰å…¨ç­–ç•¥æ¨¡å— AFSecurityPolicy:iOSé¡¹ç›®å°†æœåŠ¡å™¨ç«¯çš„è¯ä¹¦ä¿å­˜å¯¼å…¥åˆ°é¡¹ç›®ä¸­ï¼ŒAFNæ ¹æ®é¡¹ç›®ä¸­çš„æœåŠ¡å™¨è¯ä¹¦æ¥è¿›è¡ŒéªŒè¯ï¼ŒéªŒè¯æœåŠ¡å™¨ï¼Œä¿è¯è®¿é—®æœåŠ¡å™¨çš„å®‰å…¨æ€§ã€‚éªŒè¯è¯ä¹¦çš„æ¨¡å¼æœ‰ä¸‰ç§ï¼šAFSSLPinningModeNone ä¸éªŒè¯AFSSLPinningModePublicKey åªéªŒè¯å…¬é’¥AFSSLPinningModeCertificate éªŒè¯è¯ä¹¦çš„æ‰€æœ‰å†…å®¹ Serialization åºåˆ—åŒ– AFURLRequestSerializationAFURLResponseSerialization UIKit UIç›¸å…³çš„ä¸€äº›ç±»ç›®åŸç†æ¦‚è¿° AFNetworking æ˜¯å¯¹NSURLSessionTaskçš„å°è£…ã€‚AFHTTPSessionManagerç»§æ‰¿AFURLSessionManagerå¯¹ç½‘ç»œè¯·æ±‚è¿›è¡Œç®¡ç†ï¼Œä½¿ç”¨AFURLRequestSerializationå¯¹ç½‘ç»œè¯·æ±‚è¿›è¡Œå°è£…ï¼Œä½¿ç”¨AFURLResponseSerializationå¯¹å“åº”ä½“è¿›è¡Œå¤„ç†ï¼Œä½¿ç”¨AFSecurityPolicyå¯¹æœåŠ¡å™¨è¯ä¹¦è¿›è¡Œæ ¡éªŒã€‚æ”¯æŒHTTPSåè®®ï¼Œæ”¯æŒæœ¬åœ°è¯ä¹¦å’ŒæœåŠ¡å™¨è¯ä¹¦è¿›è¡Œå¯¹æ¯”éªŒè¯ã€‚AFNæ•°æ®ä¼ é€’ä¸»è¦ä½¿ç”¨blockå’Œnotifacationæ–¹å¼ã€‚ è¯·æ±‚è¿‡ç¨‹ GET/POSTç­‰æ–¹æ³•è°ƒç”¨æŠ½è±¡çš„è¯·æ±‚æ–¹æ³•ï¼ŒæŒ‡æ˜è¯·æ±‚å‚æ•°ï¼Œè°ƒç”¨å…¨èƒ½æ•°æ®è¯·æ±‚æ–¹æ³•ï¼ŒæŒ‡æ˜æ•°æ®è¯·æ±‚æ–¹å¼å’Œå‚æ•°ã€‚å¯¹è¯·æ±‚è¿›è¡Œåºåˆ—åŒ–ï¼Œå¦‚æœåºåˆ—åŒ–å¤±è´¥ï¼Œå°±æ‰§è¡Œfailure blockã€‚ä¸ºæ¯ä¸€ä¸ªNSURLSessionDataTaskçš„dataTaskå¢åŠ ä»£ç†ã€‚å¯¹æ¯ä¸€ä¸ªNSURLSessionDataTaskçš„dataTaskå¢åŠ ä»£ç†çš„å…·ä½“å®ç°ï¼Œå¯¹dataTaskè®¾ç½®è¯·æ±‚ä¹‹åçš„å›è°ƒdelegateå’Œå¤„ç†blockã€‚ 2ã€SDWebImageç¼“å­˜æœºåˆ¶SDImageCacheåœ¨SDImageCacheï¼Œå›¾ç‰‡é‡‡ç”¨äº†äºŒçº§ç¼“å­˜ç­–ç•¥ã€‚å›¾ç‰‡ç¼“å­˜æ—¶ï¼Œåœ¨å†…å­˜æœ‰ç¼“å­˜ï¼Œåœ¨ç£ç›˜ä¸­ä¹Ÿæœ‰ç¼“å­˜ã€‚å…¶ä¸­ï¼Œå†…å­˜ç¼“å­˜æ˜¯é€šè¿‡NSCacheå®ç°çš„ã€‚ ç¼“å­˜æ­¥éª¤ å°†å›¾ç‰‡ç¼“å­˜åœ¨å†…å­˜ä¸­ åˆ¤æ–­å›¾ç‰‡çš„æ ¼å¼æ˜¯pngæˆ–æ˜¯jpegï¼Œå°†å›¾ç‰‡è½¬åŒ–ä¸ºNSDataæ•°æ® å¦‚æœæ˜¯åœ¨mac_osç³»ç»Ÿä¸­ï¼Œç›´æ¥å°†å›¾ç‰‡è½¬åŒ–ä¸ºNSBitmapImageRepæ•°æ® è·å–å›¾ç‰‡çš„å­˜å‚¨è·¯å¾„ï¼Œå…¶ä¸­å›¾ç‰‡çš„æ–‡ä»¶åæ˜¯é€šè¿‡ä¼ å…¥çš„keyç»è¿‡md5åŠ å¯†åè·å¾—çš„ã€‚ å°†å›¾ç‰‡å­˜å‚¨ç£ç›˜ä¸­ è·å–å›¾ç‰‡æ­¥éª¤ å…ˆåœ¨å†…å­˜ç¼“å­˜ä¸­å¯»æ‰¾ å¦‚æœå†…å­˜ä¸­æ‰¾ä¸åˆ°å›¾ç‰‡ï¼Œåˆ™åœ¨é»˜è®¤çš„ç£ç›˜æ ¹ç›®å½•ä¸­å¯»æ‰¾ï¼Œå¦‚æœè¿˜æ˜¯æ‰¾ä¸åˆ°ï¼Œå†ä»è‡ªå®šä¹‰çš„åªè¯»ç›®å½•è·¯å¾„ä¸­å¯»æ‰¾ è·å–å›¾ç‰‡æ•°æ®åï¼Œå°†å›¾ç‰‡æ•°æ®ä»NSDataè½¬åŒ–ä¸ºUIImage,è½¬åŒ–æ˜¯è¦æ ¹æ®å›¾ç‰‡çš„ç±»å‹è¿›è¡Œè½¬åŒ–ã€‚ é»˜è®¤å¯¹å›¾ç‰‡è¿›è¡Œè§£å‹ç¼©ï¼Œç”Ÿæˆä½å›¾å›¾ç‰‡ã€‚ å°†ä½å›¾å›¾ç‰‡è¿”å›ã€‚ å›¾ç‰‡è§£å‹ç¼©æ­¥éª¤ åˆ¤æ–­å›¾ç‰‡æ˜¯å¦æ˜¯åŠ¨æ€å›¾ç‰‡ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™ä¸èƒ½è§£å‹ç¼© åˆ¤æ–­å›¾ç‰‡æ˜¯å¦æ˜¯é€æ˜çš„ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™ä¸èƒ½è§£å‹ç¼© åˆ¤æ–­å›¾ç‰‡çš„é¢œè‰²ç©ºé—´æ¨¡å‹æ˜¯ä¸æ˜¯RGBï¼Œå¦‚æœä¸æ˜¯ï¼Œä¸èƒ½è§£å‹ç¼© æ ¹æ®å›¾ç‰‡çš„å¤§å°åˆ›å»ºä¸€ä¸ªä¸Šä¸‹æ–‡ å°†å›¾ç‰‡ç»˜åˆ¶åœ¨ä¸Šä¸‹æ–‡ä¸­ã€‚ ä»ä¸Šä¸‹æ–‡ä¸­è¯»å–ä¸€ä¸ªä¸é€æ˜çš„ä½å›¾å›¾åƒï¼Œè¯¥å›¾åƒå°±æ˜¯è§£å‹ç¼©åçš„å›¾åƒ å°†ä½å›¾å›¾åƒè¿”å› å¯¹å›¾ç‰‡è¿›è¡Œç¼©æ”¾æ­¥éª¤ å¦‚æœæ˜¯æ™®é€šå›¾åƒï¼Œåˆ™ç›´æ¥è¿›è¡Œç¼©æ”¾ å¦‚æœæ˜¯åŠ¨æ€å›¾åƒï¼Œåˆ™è¦å¯¹å›¾åƒä¸­çš„æ¯ä¸€å¼ å›¾åƒéƒ½è¿›è¡Œç¼©æ”¾ç£ç›˜ç¼“å­˜æ¸…ç†æ­¥éª¤ è·å–ç£ç›˜ä¸­å›¾ç‰‡çš„æœ€åä¿®æ”¹æ—¥æœŸã€‚(ä¸ºäº†å‡å°‘ç£ç›˜å’Œå†…å­˜æ•°æ®äº¤æ¢ï¼Œè¯»å–æ˜¯å¹¶ä¸å°†æ•´ä¸ªæ–‡ä»¶è¯»å…¥å†…å­˜ï¼Œä»…ä»…å°†æ–‡ä»¶çš„ä¸€äº›å±æ€§è¯»å…¥å†…å­˜ä¸­ï¼ŒåŒ…æ‹¬æœ€åä¿®æ”¹æ—¥æœŸï¼Œè¯¥æ–‡ä»¶æ˜¯å¦ä¸ºæ–‡ä»¶å¤¹ï¼Œæ–‡ä»¶çš„å¤§å°å’Œå¯¹åº”æ–‡ä»¶çš„æ–‡ä»¶è·¯å¾„) æ ¹æ®æœ€åä¿®æ”¹æ—¥æœŸå°†å›¾ç‰‡è¿›è¡Œåˆ†ç±»ï¼Œå°†é‚£äº›å·²ç»å­˜æ”¾è¶…è¿‡æœ€é•¿å­˜æ”¾æ—¶é—´çš„æ–‡ä»¶å­˜å‚¨åœ¨åˆ é™¤æ•°ç»„ï¼Œå…¶ä»–çš„æ–‡ä»¶ä¿¡æ¯å­˜å‚¨åœ¨å¦ä¸€ä¸ªå­—å…¸ä¸­ã€‚å¹¶è®¡ç®—é™¤å»è¦åˆ é™¤çš„æ–‡ä»¶ä¹‹å¤–çš„æ‰€æœ‰æ–‡ä»¶å¤§å° æ ¹æ®åˆ é™¤æ•°ç»„ä¸­çš„æ–‡ä»¶è·¯å¾„ï¼Œå°†å¯¹åº”çš„æ–‡ä»¶åˆ é™¤ã€‚ åˆ¤æ–­å‰©ä¸‹çš„æ–‡ä»¶å¤§å°æ˜¯å¦è¶…è¿‡ç”¨æˆ·ç°åœ¨çš„ç£ç›˜æœ€å¤§å®¹é‡ã€‚ å¦‚æœè¶…è¿‡ï¼Œåˆ™å°†å‰©ä½™çš„æ–‡ä»¶è¿›è¡Œå®‰ä¿®æ”¹æ—¶é—´è¿›è¡Œå‡åºæ’åˆ—ï¼Œç„¶ååˆ é™¤ä¿®æ”¹æ—¶é—´æœ€æ—©çš„æ–‡ä»¶ï¼Œç›´åˆ°ç”šå‰©ä½™æ–‡ä»¶å¤§å°å°äºæœ€å¤§ç£ç›˜å®¹é‡çš„ä¸€åŠã€‚ å›¾ç‰‡ç¼“å­˜æ¸…ç†æ—¶æœº å½“ç³»ç»Ÿå‘å‡ºå†…å­˜ä¸è¶³é€šçŸ¥æ—¶ï¼Œä¼šå°†å†…å­˜ä¸­çš„æ‰€æœ‰å›¾ç‰‡ç¼“å­˜éƒ½åˆ é™¤æ‰ã€‚ å½“ç¨‹åºè¿›å…¥åå°æ—¶ï¼Œä¼šå¯¹ç£ç›˜çš„æ–‡ä»¶æ•°æ®è¿›è¡Œæ¸…ç†ã€‚ å½“æ”¶åˆ°ç¨‹åºå…³é—­é€šçŸ¥æ—¶ï¼Œä¼šå¯¹ç£ç›˜ä¸­çš„æ–‡ä»¶æ•°æ®è¿›è¡Œæ¸…ç†ã€‚ å¤šçº¿ç¨‹ä¸ç½‘ç»œå†…å­˜ç®¡ç†,æ€§èƒ½ä¼˜åŒ–1ã€å†…å­˜ç®¡ç†2ã€æ€§èƒ½ä¼˜åŒ–é€»è¾‘ä¼˜åŒ– ä»£ç å°è£…ä¼˜åŒ– ä»£ç æ‰§è¡Œæ•ˆç‡ä¼˜åŒ–ç•Œé¢ä¼˜åŒ– ç¦»å±æ¸²æŸ“ä¼˜åŒ– shouldRasterizeï¼ˆå…‰æ …åŒ–ï¼‰ maskï¼ˆé®ç½©å±‚ï¼‰ shadowsï¼ˆé˜´å½±ï¼‰ EdgeAnntialiasingï¼ˆæŠ—é”¯é½¿ï¼‰ GroupOpacityï¼ˆä¸é€æ˜ï¼‰ å¤æ‚å½¢çŠ¶æ¯”å¦‚åœ†è§’ç­‰ æ¸å˜ ç•Œé¢åŠ è½½ä¼˜åŒ– æ•°æ®ç»“æ„å’Œç®—æ³•éŸ³è§†é¢‘æ–¹å‘é€†å‘æ–¹å‘","categories":[{"name":"é¢è¯•é¢˜","slug":"é¢è¯•é¢˜","permalink":"https://github.com/wuvdan/wuvdan.github.io/categories/%E9%9D%A2%E8%AF%95%E9%A2%98/"}],"tags":[{"name":"é¢è¯•æŠ€å·§","slug":"é¢è¯•æŠ€å·§","permalink":"https://github.com/wuvdan/wuvdan.github.io/tags/%E9%9D%A2%E8%AF%95%E6%8A%80%E5%B7%A7/"}]},{"title":"iOSé¢è¯•é¢˜-001","slug":"iOSé¢è¯•é¢˜-001","date":"2020-01-16T08:05:26.851Z","updated":"2020-01-20T01:45:34.466Z","comments":true,"path":"2020/01/16/iOSé¢è¯•é¢˜-001/","link":"","permalink":"https://github.com/wuvdan/wuvdan.github.io/2020/01/16/iOS%E9%9D%A2%E8%AF%95%E9%A2%98-001/","excerpt":"","text":"åŸºç¡€1. å±æ€§ä¿®é¥°è¯nonatomicéåŸå­æ€§è®¿é—®ï¼Œå¤šçº¿ç¨‹å¹¶å‘è®¿é—®ä¼šæé«˜æ€§èƒ½ã€‚ atomic:åŸå­æ€§è®¿é—®ã€‚ strongARCæ—¶ä¸­ä½¿ç”¨ï¼Œç›¸å½“äºretainã€‚ weakç›¸å½“äºassignï¼Œå¯ä»¥æŠŠå¯¹åº”çš„æŒ‡é’ˆå˜é‡ç½®ä¸ºnilã€‚ assginä¸ä¼šä½¿å¼•ç”¨è®¡æ•°åŠ 1ï¼Œä¹Ÿå°±æ˜¯ç›´æ¥èµ‹å€¼ã€‚ copyå»ºç«‹ä¸€ä¸ªç´¢å¼•è®¡æ•°ä¸º1çš„å¯¹è±¡ï¼Œåœ¨èµ‹å€¼æ—¶ä½¿ç”¨ä¼ å…¥å€¼çš„ä¸€ä»½æ‹·è´ã€‚ retainä¼šä½¿å¼•ç”¨è®¡æ•°åŠ 1ã€‚ readonlyæ­¤æ ‡è®°è¯´æ˜å±æ€§ä¼šè¢«å½“æˆè¯»å†™çš„ï¼Œè¿™ä¹Ÿæ˜¯é»˜è®¤å±æ€§ã€‚ readwriteæ­¤æ ‡è®°è¯´æ˜å±æ€§åªå¯ä»¥è¯»ï¼Œä¹Ÿå°±æ˜¯ä¸èƒ½è®¾ç½®ï¼Œå¯ä»¥è·å–ã€‚ é—®é¢˜ï¼šï¼ˆ1ï¼‰ä»€ä¹ˆæƒ…å†µä½¿ç”¨ weak å…³é”®å­—ï¼Ÿç›¸æ¯” assign æœ‰ä»€ä¹ˆä¸åŒ? ä½¿ç”¨ åè®®å£°æ˜ä½¿ç”¨weak IBOutlet ä½¿ç”¨weak weak å’Œ assign çš„ä¸åŒç‚¹: weak ç­–ç•¥åœ¨å±æ€§æ‰€æŒ‡çš„å¯¹è±¡é­åˆ°æ‘§æ¯æ—¶,ç³»ç»Ÿä¼šå°† weak ä¿®é¥°çš„å±æ€§å¯¹è±¡çš„æŒ‡é’ˆæŒ‡å‘ nil,åœ¨ OC ç»™ nil å‘æ¶ˆæ¯æ˜¯ä¸ä¼šæœ‰ä»€ä¹ˆé—®é¢˜çš„;å¦‚æœä½¿ç”¨ assign ç­–ç•¥åœ¨å±æ€§æ‰€æŒ‡çš„å¯¹è±¡é­åˆ°æ‘§æ¯æ—¶,å±æ€§å¯¹è±¡æŒ‡é’ˆè¿˜æŒ‡å‘åŸæ¥çš„å¯¹è±¡,ç”±äºå¯¹è±¡å·²ç»è¢«é”€æ¯,è¿™æ—¶å€™å°±äº§ç”Ÿäº†é‡æŒ‡é’ˆ,å¦‚æœè¿™æ—¶å€™åœ¨ç»™æ­¤å¯¹è±¡å‘é€æ¶ˆæ¯,å¾ˆå®¹é€ æˆç¨‹åºå¥”æºƒassigin å¯ä»¥ç”¨äºä¿®é¥°é OC å¯¹è±¡,è€Œ weak å¿…é¡»ç”¨äº OC å¯¹è±¡ã€‚ ï¼ˆ2ï¼‰ä½¿ç”¨ atomic ä¸€å®šæ˜¯çº¿ç¨‹å®‰å…¨çš„å—? ä¸æ˜¯,atomic çš„æœ¬æ„æ˜¯æŒ‡å±æ€§çš„å­˜å–æ–¹æ³•æ˜¯çº¿ç¨‹å®‰å…¨çš„,å¹¶ä¸ä¿è¯æ•´ä¸ªå¯¹è±¡æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ ä¾‹å¦‚ï¼š å£°æ˜ä¸€ä¸ª NSMutableArray çš„åŸå­å±æ€§ stuff,æ­¤æ—¶ self.stuff å’Œ self.stuff =othersulf éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä½†æ˜¯,ä½¿ç”¨[self.stuff objectAtIndex:index]å°±ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„,éœ€è¦ç”¨äº’æ–¥é”æ¥ä¿è¯çº¿ç¨‹å®‰å…¨æ€§ã€‚ ï¼ˆ3ï¼‰@synthesize å’Œ @dynamic åˆ†åˆ«æœ‰ä»€ä¹ˆä½œç”¨ @property æœ‰ä¸¤ä¸ªå¯¹åº”çš„è¯,ä¸€ä¸ªæ˜¯@synthesize,ä¸€ä¸ªæ˜¯@dynamicã€‚å¦‚æœ@synthesize å’Œ@dynamic éƒ½æ²¡å†™,é‚£ä¹ˆé»˜è®¤çš„å°±æ˜¯@syntheszie var = _var; @synthesize çš„è¯­ä¹‰æ˜¯å¦‚æœä½ æ²¡æœ‰æ‰‹åŠ¨å®ç° setter æ–¹æ³•å’Œ getter æ–¹æ³•,é‚£ä¹ˆç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ä¸ºä½ åŠ ä¸Šè¿™ä¸¤ä¸ªæ–¹æ³•ã€‚ @dynamic å‘Šè¯‰ç¼–è¯‘å™¨:å±æ€§çš„ setter ä¸ getter æ–¹æ³•ç”±ç”¨æˆ·è‡ªå·±å®ç°,ä¸è‡ªåŠ¨ç”Ÿæˆã€‚(å½“ç„¶å¯¹äº readonly çš„å±æ€§åªéœ€æä¾› getter å³å¯) å‡å¦‚ä¸€ä¸ªå±æ€§è¢«å£°æ˜ä¸º@dynamic varï¼›ç„¶åä½ æ²¡æœ‰æä¾›@setter æ–¹æ³•å’Œ@getter æ–¹æ³•,ç¼–è¯‘çš„æ—¶å€™æ²¡é—®é¢˜,ä½†æ˜¯å½“ç¨‹åºè¿è¡Œåˆ° instance.var = someVar,ç”±äºç¼º setteræ–¹æ³•ä¼šå¯¼è‡´ç¨‹åºå´©æºƒ;æˆ–è€…å½“è¿è¡Œåˆ° someVar = instance.var æ—¶,ç”±äºç¼º getter æ–¹æ³•åŒæ ·ä¼šå¯¼è‡´å´©æºƒã€‚ ï¼ˆ4ï¼‰ARC ä¸‹,ä¸æ˜¾å¼æŒ‡å®šä»»ä½•å±æ€§å…³é”®å­—æ—¶,é»˜è®¤çš„å…³é”®å­—éƒ½æœ‰å“ªäº›? åŸºæœ¬æ•°æ®ï¼š atomic,readwrite,assign æ™®é€šçš„ OC å¯¹è±¡: atomic,readwrite,strong ï¼ˆ5ï¼‰ç”¨@property å£°æ˜çš„ NSString(æˆ– NSArray,NSDictionary)ç»å¸¸ä½¿ç”¨ copy å…³é”®å­—,ä¸ºä»€ä¹ˆ?å¦‚æœæ”¹ç”¨ strong å…³é”®å­—,å¯èƒ½é€ æˆä»€ä¹ˆé—®é¢˜? å› ä¸ºçˆ¶ç±»æŒ‡é’ˆå¯ä»¥æŒ‡å‘å­ç±»å¯¹è±¡,ä½¿ç”¨ copy çš„ç›®çš„æ˜¯ä¸ºäº†è®©æœ¬å¯¹è±¡çš„å±æ€§ä¸å—å¤–ç•Œå½±å“,ä½¿ç”¨ copy æ— è®ºç»™æˆ‘ä¼ å…¥æ˜¯ä¸€ä¸ªå¯å˜å¯¹è±¡è¿˜æ˜¯ä¸å¯å¯¹è±¡,æˆ‘æœ¬èº«æŒæœ‰çš„å°±æ˜¯ä¸€ä¸ªä¸å¯å˜çš„å‰¯æœ¬. å¦‚æœæˆ‘ä»¬ä½¿ç”¨æ˜¯ strong,é‚£ä¹ˆè¿™ä¸ªå±æ€§å°±æœ‰å¯èƒ½æŒ‡å‘ä¸€ä¸ªå¯å˜å¯¹è±¡,å¦‚æœè¿™ä¸ªå¯å˜å¯¹è±¡åœ¨å¤–éƒ¨è¢«ä¿®æ”¹äº†,é‚£ä¹ˆä¼šå½±å“è¯¥å±æ€§. ï¼ˆ6ï¼‰è¿™ä¸ªå†™æ³•ä¼šå‡ºä»€ä¹ˆé—®é¢˜: @property(copy)NSMutableArray *array; å› ä¸º copy ç­–ç•¥æ‹·è´å‡ºæ¥çš„æ˜¯ä¸€ä¸ªä¸å¯å˜å¯¹è±¡,ç„¶è€Œå´æŠŠå®ƒå½“æˆå¯å˜å¯¹è±¡ä½¿ç”¨,å¾ˆå®¹æ˜“é€ æˆç¨‹åºå¥”æºƒè¿™é‡Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜,è¯¥å±æ€§ä½¿ç”¨äº†åŒæ­¥é”,ä¼šåœ¨åˆ›å»ºæ—¶ç”Ÿæˆä¸€äº›é¢å¤–çš„ä»£ç ç”¨äºå¸®åŠ©ç¼–å†™å¤šçº¿ç¨‹ç¨‹åº,è¿™ä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜,é€šè¿‡å£°æ˜ nonatomic å¯ä»¥èŠ‚çœè¿™äº›è™½ç„¶å¾ˆå°ä½†æ˜¯ä¸å¿…è¦é¢å¤–å¼€é”€,åœ¨ iOS å¼€å‘ä¸­åº”è¯¥ä½¿ç”¨ nonatomic æ›¿ä»£ atomic. ï¼ˆ7ï¼‰å¦‚ä½•è®©è‡ªå®šä¹‰ç±»å¯ä»¥ç”¨ copy ä¿®é¥°ç¬¦?å¦‚ä½•é‡å†™å¸¦ copy å…³é”®å­—çš„ setter? è‹¥æƒ³ä»¤è‡ªå·±æ‰€å†™çš„å¯¹è±¡å…·æœ‰æ‹·è´åŠŸèƒ½,åˆ™éœ€å®ç° NSCopying åè®®ã€‚ 1234567&#x2F;&#x2F; å®ç°ä¸å¯å˜ç‰ˆæœ¬æ‹·è´- (id)copyWithZone:(NSZone *)zone; &#x2F;&#x2F; å®ç°å¯å˜ç‰ˆæœ¬æ‹·è´- (id)mutableCopyWithZone:(NSZone *)zone;&#x2F;&#x2F; é‡å†™å¸¦ copy å…³é”®å­—çš„ setter- (void)setName:(NSString *)name &#123; _name &#x3D; [name copy];&#125; 2. æˆ‘ä»¬è¯´çš„Objective-Cæ˜¯åŠ¨æ€è¿è¡Œæ—¶è¯­è¨€æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ åŠ¨æ€ç±»å‹ã€‚ å¦‚idç±»å‹ã€‚å®é™…ä¸Šé™æ€ç±»å‹å› ä¸ºå…¶å›ºå®šæ€§å’Œå¯é¢„çŸ¥æ€§è€Œä½¿ç”¨å¾—æ›´åŠ å¹¿æ³›ã€‚é™æ€ç±»å‹æ˜¯å¼ºç±»å‹ï¼Œè€ŒåŠ¨æ€ç±»å‹å±äºå¼±ç±»å‹ã€‚è¿è¡Œæ—¶å†³å®šæ¥æ”¶è€…ã€‚ åŠ¨æ€ç»‘å®šã€‚è®©ä»£ç åœ¨è¿è¡Œæ—¶åˆ¤æ–­éœ€è¦è°ƒç”¨ä»€ä¹ˆæ–¹æ³•ï¼Œè€Œä¸æ˜¯åœ¨ç¼–è¯‘æ—¶ã€‚ä¸å…¶ä»–é¢å‘å¯¹è±¡è¯­è¨€ä¸€æ ·ï¼Œæ–¹æ³•è°ƒç”¨å’Œä»£ç å¹¶æ²¡æœ‰åœ¨ç¼–è¯‘æ—¶è¿æ¥åœ¨ä¸€èµ·ï¼Œè€Œæ˜¯åœ¨æ¶ˆæ¯å‘é€æ—¶æ‰è¿›è¡Œè¿æ¥ã€‚è¿è¡Œæ—¶å†³å®šè°ƒç”¨å“ªä¸ªæ–¹æ³•ã€‚ åŠ¨æ€è½½å…¥ã€‚è®©ç¨‹åºåœ¨è¿è¡Œæ—¶æ·»åŠ ä»£ç æ¨¡å—ä»¥åŠå…¶ä»–èµ„æºã€‚ç”¨æˆ·å¯ä»¥æ ¹æ®éœ€è¦åŠ è½½ä¸€äº›å¯æ‰§è¡Œä»£ç å’Œèµ„æºï¼Œè€Œä¸æ˜¯åœ¨å¯åŠ¨æ—¶å°±åŠ è½½æ‰€æœ‰ç»„ä»¶ã€‚å¯æ‰§è¡Œä»£ç ä¸­å¯ä»¥å«æœ‰å’Œç¨‹åºè¿è¡Œæ—¶æ•´åˆçš„æ–°ç±»ã€‚ 3. è®²ä¸€ä¸‹MVCå’ŒMVVMï¼ŒMVPï¼Ÿ MVC: MVCå³Model-VIew-Controllerã€‚MVCæ¨¡å¼è‡´åŠ›äºå…³æ³¨ç‚¹çš„åˆ‡åˆ†ï¼Œè¿™æ„å‘³ç€modelå’Œcontrollerçš„é€»è¾‘æ˜¯ä¸ä¸ç”¨æˆ·ç•Œé¢ï¼ˆViewï¼‰æŒ‚é’©çš„ã€‚Modelå±‚ä»£è¡¨äº†æè¿°ä¸šåŠ¡é€»è¾‘å’Œæ•°æ®çš„ä¸€ç³»åˆ—ç±»çš„é›†åˆã€‚å®ƒä¹Ÿå®šä¹‰äº†æ•°æ®ä¿®æ”¹å’Œæ“ä½œçš„ä¸šåŠ¡è§„åˆ™ã€‚Viewä»£è¡¨äº†UIç»„ä»¶ï¼ŒåƒUIViewï¼ŒUIButtonï¼ŒUITableViewç­‰ã€‚ä»–åªè´Ÿè´£å±•ç¤ºä»controlleræ¥æ”¶åˆ°çš„æ•°æ®ã€‚å› æ­¤ï¼Œç»´æŠ¤å’Œæµ‹è¯•ç¨‹åºå˜å¾—æ›´åŠ ç®€å•å®¹æ˜“ã€‚ç„¶è€Œåœ¨Cocoaçš„MVCæ¨¡å¼ä¸­Controllerç»å¸¸è¢«æ··æ‚åœ¨Viewçš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œå› æ­¤å¾ˆéš¾è¯´Viewå’ŒViewControlleræ˜¯åˆ†ç¦»çš„ï¼Œè¿™ä¹Ÿå¾€å¾€é©±ä½¿äººä»¬å†™å‡ºè‡ƒè‚¿çš„è§†å›¾æ§åˆ¶å™¨ï¼Œå°½ç®¡ä»å¯ä»¥å°†ä¸šåŠ¡é€»è¾‘å’Œæ•°æ®è½¬æ¢åˆ°Modelï¼Œä½†æ˜¯å¤§å¤šæ•°æƒ…å†µä¸‹å½“éœ€è¦ä¸ºViewå‡è´Ÿçš„æ—¶å€™æˆ‘ä»¬å´æ— èƒ½ä¸ºåŠ›äº†ã€‚Viewçš„æœ€å¤§çš„ä»»åŠ¡å°±æ˜¯å‘Controllerä¼ é€’ç”¨æˆ·åŠ¨ä½œäº‹ä»¶ã€‚ViewControllerä¸å†æ‰¿æ‹…ä¸€åˆ‡ä»£ç†å’Œæ•°æ®æºçš„èŒè´£ï¼Œé€šå¸¸åªè´Ÿè´£ä¸€äº›åˆ†å‘å’Œå–æ¶ˆç½‘ç»œè¯·æ±‚ä»¥åŠä¸€äº›å…¶ä»–çš„ä»»åŠ¡ã€‚å½“åœ¨è¿›è¡Œå•å…ƒæµ‹è¯•çš„æ—¶å€™ä½ ä¼šå‘ç°é—®é¢˜è¶Šæ¥è¶Šæ˜æ˜¾ã€‚å› ä¸ºä½ çš„ViewControllerå’ŒViewæ˜¯ç´§å¯†è€¦åˆçš„ï¼Œå¯¹å®ƒä»¬è¿›è¡Œæµ‹è¯•å°±æ˜¾å¾—å¾ˆè‰°éš¾ã€‚Cocoa MVCçœ‹æ¥å¹¶ä¸æ˜¯æˆ‘ä»¬å®šä¹‰ä¸­ç†æƒ³çš„æ¶æ„æ¨¡å¼ã€‚ MVVM: å³Model-View-View Modelã€‚è¿™ä¸ªæ¨¡å¼æä¾›å¯¹Viewå’ŒView Modelçš„åŒå‘æ•°æ®ç»‘å®šã€‚è¿™ä½¿å¾—View Modelçš„çŠ¶æ€æ”¹å˜å¯ä»¥è‡ªåŠ¨ä¼ é€’ç»™Viewã€‚å…¸å‹çš„æƒ…å†µæ˜¯ï¼ŒView Modelé€šè¿‡ä½¿ç”¨obseveræ¨¡å¼ï¼ˆè§‚å¯Ÿè€…æ¨¡å¼ï¼‰æ¥å°†View Modelçš„å˜åŒ–é€šçŸ¥ç»™modelã€‚View Modelè´Ÿè´£æš´æ¼æ–¹æ³•ï¼Œå‘½ä»¤ï¼Œå…¶ä»–å±æ€§æ¥æ“ä½œVIewçš„çŠ¶æ€ï¼Œç»„è£…modelä½œä¸ºViewåŠ¨ä½œçš„ç»“æœï¼Œå¹¶ä¸”è§¦å‘Viewè‡ªå·±çš„äº‹ä»¶ã€‚å®ƒå’ŒMVPæ¨¡å¼çœ‹èµ·æ¥éå¸¸åƒ:MVVMå°†ViewControllerè§†ä½œView,Viewå’ŒModelä¹‹é—´æ²¡æœ‰ç´§å¯†çš„è”ç³»ã€‚åœ¨ä½¿ç”¨MVVMæ¨¡å¼æ—¶ï¼Œè‡ªç„¶è€Œç„¶ä¼šæƒ³åˆ°ReactiveCocaï¼Œåä¹‹äº¦ç„¶ã€‚å°½ç®¡é€šè¿‡ç®€å•çš„ç»‘å®šæ¥ä½¿ç”¨MVVMæ˜¯å¯å®ç°çš„ï¼Œä½†æ˜¯ReactiveCocoaå´èƒ½æ›´å¥½çš„å‘æŒ¥MVVMæ¨¡å¼çš„ç‰¹ç‚¹ã€‚ä½†æ˜¯ä½¿ç”¨è¿™ä¸ªæ¡†æ¶æœ‰ä¸ªéš¾ä»¥å¿½ç•¥çš„äº‹å®ï¼šå½“ä½ åˆšå¼€å§‹ä½¿ç”¨ReactiveCocaçš„æ—¶å€™æœ‰å¾ˆå¤§çš„å¯èƒ½å°±ä¼šæŠŠäº‹æƒ…æç ¸ã€‚æ¢å¥è¯æ¥è¯´å°±æ˜¯ï¼Œå¦‚æœå‘ç°äº†ä¸€äº›é”™è¯¯ï¼Œå½“ä½ è¯•å›¾æŸ¥çœ‹å‡½æ•°è°ƒç”¨æ ˆæ—¶ä½ å¯èƒ½ä¼šå–Šï¼šâ€œå¤©å“ªï¼Œå¥½æ·±çš„å‡½æ•°è°ƒç”¨æ ˆâ€œï¼è°ƒè¯•å‡ºè¿™ä¸ªbugå¯èƒ½ä¼šèŠ±è´¹å¤§é‡çš„æ—¶é—´ã€‚MVVMå¾ˆè¯±äººï¼Œå› ä¸ºå®ƒé›†åˆäº†ä¸Šè¿°æ–¹æ³•çš„ä¼˜ç‚¹ï¼Œå¹¶ä¸”ç”±äºåœ¨Viewå±‚çš„ç»‘å®šï¼Œå®ƒå¹¶ä¸éœ€è¦å…¶ä»–é™„åŠ çš„ä»£ç æ¥æ›´æ–°Viewï¼Œå°½ç®¡è¿™æ ·ï¼Œå¯æµ‹è¯•æ€§ä¾ç„¶å¾ˆå¼ºâ€”â€”ç¬¦åˆæˆ‘ä»¬ç†æƒ³ä¸­å¥½æ¶æ„æ¨¡å¼çš„å®šä¹‰ã€‚ MVP: è¿™ä¸ªæ¨¡å¼æŠŠPresenteræ¢æˆControllerå°±å’ŒMVCéå¸¸ç›¸åƒäº†ã€‚è¿™ä¸ªè®¾è®¡æ¨¡å¼æŠŠåº”ç”¨ç¨‹åºåˆ†æˆäº†3ä¸ªä¸»è¦æ–¹é¢ï¼šModelã€Viewå’ŒPresenter,å…¶ä¸­çš„Modelå’ŒViewä¸MVCæ¨¡ä¸­çš„è§’è‰²ç›¸åŒã€‚Presenterè´Ÿè´£å¤„ç†ViewèƒŒåæ‰€æœ‰çš„UIäº‹ä»¶ã€‚å®ƒé€šè¿‡Viewæ¥æ”¶ç”¨æˆ·è¾“å…¥ï¼Œä¹‹ååˆ©ç”¨Modelæ¥å¤„ç†ç”¨æˆ·çš„æ•°æ®ï¼Œæœ€åæŠŠç»“æœè¿”å›ç»™Viewã€‚ä¸Viewå’ŒControllerä¸åŒï¼ŒViewå’ŒPresenterä¹‹é—´æ˜¯å®Œå…¨è§£è€¦çš„ï¼Œä»–ä»¬é€šè¿‡æ¥å£æ¥äº¤äº’ã€‚å¦å¤–ï¼Œpresenterä¸åƒcontrollerå¤„ç†è¿›å…¥çš„è¯·æ±‚ã€‚è¿™ä¸æ˜¯æ­£è§£å†³äº†Cocoa MVCä¸­ViewControllerå’ŒViewçš„è€¦åˆé—®é¢˜å—ï¼Ÿå°±MVPæ¨¡å¼è€Œè¨€ï¼ŒUIViewControllerçš„å­ç±»å®é™…ä¸Šå°±æ˜¯Viewså¹¶ä¸æ˜¯Presentersã€‚è¿™ç‚¹åŒºåˆ«ä½¿å¾—è¿™ç§æ¨¡å¼çš„å¯æµ‹è¯•æ€§å¾—åˆ°äº†æå¤§çš„æé«˜ï¼Œä»˜å‡ºçš„ä»£ä»·æ˜¯å¼€å‘é€Ÿåº¦çš„ä¸€äº›é™ä½ï¼Œå› ä¸ºå¿…é¡»è¦åšä¸€äº›æ‰‹åŠ¨çš„æ•°æ®å’Œäº‹ä»¶ç»‘å®šã€‚ä½†æ˜¯è¿™ä¹Ÿæ„å‘³ç€æˆ‘ä»¬å°†æœ€ä¸»è¦çš„ä»»åŠ¡åˆ’åˆ†åˆ°Presenterå’ŒModelï¼Œè€ŒViewçš„åŠŸèƒ½è¾ƒå°‘â€”â€”å„ä¸ªå®ä½“ä»»åŠ¡é‡åˆ†é…ä¸å‡è¡¡ã€‚ 4. ä¸ºä»€ä¹ˆä»£ç†è¦ç”¨weakï¼Ÿä»£ç†çš„delegateå’ŒdataSourceæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿblockå’Œä»£ç†çš„åŒºåˆ«? ä¸ºä»€ä¹ˆä»£ç†è¦ç”¨weak? é˜²æ­¢å¾ªç¯å¼•ç”¨ã€‚ä¾‹å¦‚Viewæœ‰ä¸€ä¸ªåè®®ï¼Œéœ€è¦ä¸€ä¸ªä»£ç†å®ç°å›è°ƒã€‚ä¸€ä¸ªControlleræ·»åŠ è¿™ä¸ªViewï¼Œå¹¶ä¸”éµå®ˆåè®®ï¼Œæˆä¸ºViewçš„ä»£ç†ã€‚å¦‚æœä¸ç”¨weekï¼Œç”¨strongï¼ŒController -&gt;View -&gt; delegate -&gt; Controllerï¼Œå°±å¾ªç¯å¼•ç”¨äº†ã€‚ ä»£ç†çš„delegateå’ŒdataSourceæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ delegateåé‡äºä¸ç”¨æˆ·äº¤äº’çš„å›è°ƒï¼Œæœ‰é‚£äº›æ–¹æ³•å¯ä»¥ä¾›æˆ‘ä½¿ç”¨ï¼Œä¾‹å¦‚UITableviewDelegateï¼›dataSourceåé‡äºæ•°æ®çš„å›è°ƒï¼Œviewé‡Œé¢æœ‰ä»€ä¹ˆä¸œè¥¿ï¼Œå±æ€§éƒ½æ˜¯ä»€ä¹ˆï¼Œä¾‹å¦‚UITableviewDatasourceï¼› blockå’Œä»£ç†çš„åŒºåˆ«? ä»£ç†å’Œblockçš„å…±åŒç‰¹æ€§æ˜¯å›è°ƒæœºåˆ¶ï¼Œä¸åŒçš„æ˜¯ï¼Œä»£ç†çš„æ–¹æ³•æ¯”è¾ƒå¤šï¼Œæ¯”è¾ƒåˆ†æ•£ã€‚ä½¿ç”¨blockçš„ä»£ç æ¯”è¾ƒé›†ä¸­ç»Ÿä¸€ã€‚ 5. å±æ€§çš„å®è´¨æ˜¯ä»€ä¹ˆï¼ŸåŒ…æ‹¬å“ªå‡ ä¸ªéƒ¨åˆ†ï¼Ÿå±æ€§é»˜è®¤çš„å…³é”®å­—éƒ½æœ‰å“ªäº›ï¼Ÿ@dynamicå…³é”®å­—å’Œ@synthesizeå…³é”®å­—æ˜¯ç”¨æ¥åšä»€ä¹ˆçš„ï¼Ÿ @property = ivar + getter + setter; (å®ä¾‹å˜é‡+getæ–¹æ³•+ setæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´ä½¿ç”¨@propertyç³»ç»Ÿä¼šè‡ªåŠ¨ç”Ÿæˆsetterå’Œgetteræ–¹æ³•;) @synthesize propertyName = _propertyName; (è¿™è¡Œä»£ç ä¼šåˆ›é€ ä¸€ä¸ªå¸¦ä¸‹åˆ’çº¿å‰ç¼€çš„å®ä¾‹å˜é‡åï¼ŒåŒæ—¶ä½¿ç”¨è¿™ä¸ªå±æ€§ç”Ÿæˆgetter å’Œ setter æ–¹æ³•ã€‚) ç¦æ­¢@synthesize:å¦‚æœæŸå±æ€§å·²ç»åœ¨æŸå¤„å®ç°äº†è‡ªå·±çš„ setter/getter ,å¯ä»¥ä½¿ç”¨ @dynamic æ¥é˜»æ­¢ @synthesize è‡ªåŠ¨ç”Ÿæˆæ–°çš„ setter/getter è¦†ç›–ã€‚ 6. å±æ€§çš„é»˜è®¤å…³é”®å­—æ˜¯ä»€ä¹ˆï¼Ÿ åŸºæœ¬ç±»å‹ @property (atomic, assign) å¯¹è±¡ç±»å‹ @property (atomic, strong) 7. NSStringä¸ºä»€ä¹ˆè¦ç”¨copyå…³é”®å­—ï¼Œå¦‚æœç”¨strongä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿï¼ˆæ³¨æ„ï¼šè¿™é‡Œæ²¡æœ‰è¯´ç”¨strongå°±ä¸€å®šä¸è¡Œã€‚ä½¿ç”¨copyå’Œstrongæ˜¯çœ‹æƒ…å†µè€Œå®šçš„ï¼‰ å› ä¸ºçˆ¶ç±»æŒ‡é’ˆå¯ä»¥æŒ‡å‘å­ç±»å¯¹è±¡,ä½¿ç”¨copyçš„ç›®çš„æ˜¯ä¸ºäº†è®©æœ¬å¯¹è±¡çš„å±æ€§ä¸å—å¤–ç•Œå½±å“,ä½¿ç”¨copyæ— è®ºç»™æˆ‘ä¼ å…¥æ˜¯ä¸€ä¸ªå¯å˜å¯¹è±¡è¿˜æ˜¯ä¸å¯å¯¹è±¡,æˆ‘æœ¬èº«æŒæœ‰çš„å°±æ˜¯ä¸€ä¸ªä¸å¯å˜çš„å‰¯æœ¬. å¦‚æœæˆ‘ä»¬ä½¿ç”¨æ˜¯strong,é‚£ä¹ˆè¿™ä¸ªå±æ€§å°±æœ‰å¯èƒ½æŒ‡å‘ä¸€ä¸ªå¯å˜å¯¹è±¡,å¦‚æœè¿™ä¸ªå¯å˜å¯¹è±¡åœ¨å¤–éƒ¨è¢«ä¿®æ”¹äº†,é‚£ä¹ˆä¼šå½±å“è¯¥å±æ€§. 8. å¦‚ä½•ä»¤è‡ªå·±æ‰€å†™çš„å¯¹è±¡å…·æœ‰æ‹·è´åŠŸèƒ½? éœ€å£°æ˜è¯¥ç±»éµä» NSCopying åè®® å®ç° NSCopying åè®®ã€‚è¯¥åè®®åªæœ‰ä¸€ä¸ªæ–¹æ³•: - (id)copyWithZone:(NSZone *)zone; 9. ç®€è¿°kvoã€kvcã€Delegateä»–ä»¬ä¹‹é—´çš„åŒºåˆ«ï¼Ÿ KVOï¼ˆKey-Value- Observingï¼‰ï¼šä¸€å¯¹å¤š, è§‚å¯Ÿè€…æ¨¡å¼, æ˜¯é”®å€¼ç›‘å¬,é”®å€¼è§‚å¯Ÿæœºåˆ¶, KVOçš„æœ¬è´¨æ˜¯å½“è§‚å¯Ÿè€…ä¸ºä¸€ä¸ªå¯¹è±¡çš„å±æ€§è¿›è¡Œäº†æ³¨å†Œï¼Œè¢«è§‚å¯Ÿå¯¹è±¡çš„isaæŒ‡é’ˆè¢«ä¿®æ”¹çš„æ—¶å€™ï¼ŒisaæŒ‡é’ˆå°±ä¼šæŒ‡å‘ä¸€ä¸ªä¸­é—´ç±»ï¼Œè€Œä¸æ˜¯çœŸå®çš„ç±»ã€‚æ‰€ä»¥ isaæŒ‡é’ˆå…¶å®ä¸éœ€è¦æŒ‡å‘å®ä¾‹å¯¹è±¡çœŸå®çš„ç±»ã€‚æ‰€ä»¥æˆ‘ä»¬çš„ç¨‹åºæœ€å¥½ä¸è¦ä¾èµ–äºisaæŒ‡é’ˆã€‚åœ¨è°ƒç”¨ç±»çš„æ–¹æ³•çš„æ—¶å€™ï¼Œæœ€å¥½è¦æ˜ç¡®å¯¹è±¡å®ä¾‹çš„ç±»åã€‚ KVC(Key-Value-Coding)å†…éƒ¨çš„å®ç°ï¼šæ˜¯é”®å€¼ç¼–ç , ä¸€ä¸ªå¯¹è±¡åœ¨è°ƒç”¨setValueçš„æ—¶å€™ï¼Œï¼ˆ1ï¼‰é¦–å…ˆæ ¹æ®æ–¹æ³•åæ‰¾åˆ°è¿è¡Œæ–¹æ³•çš„æ—¶å€™æ‰€éœ€è¦çš„ç¯ å¢ƒå‚æ•°ã€‚ï¼ˆ2ï¼‰ä»–ä¼šä»è‡ªå·±isaæŒ‡é’ˆç»“åˆç¯å¢ƒå‚æ•°ï¼Œæ‰¾åˆ°å…·ä½“çš„æ–¹æ³•å®ç°çš„æ¥å£ã€‚ï¼ˆ3ï¼‰å†ç›´æ¥æŸ¥æ‰¾å¾—æ¥çš„å…·ä½“çš„æ–¹æ³•å®ç°ã€‚ Delegate: é€šå¸¸å‘é€è€…å’Œæ¥æ”¶è€…çš„å…³ç³»æ˜¯ç›´æ¥çš„ä¸€å¯¹ä¸€çš„å…³ç³»ã€‚ä»£ç†çš„ç›®çš„æ˜¯æ”¹å˜æˆ–ä¼ é€’æ§åˆ¶é“¾ã€‚å…è®¸ä¸€ä¸ªç±»åœ¨æŸäº›ç‰¹å®šæ—¶åˆ»é€šçŸ¥åˆ°å…¶ä»–ç±»ï¼Œè€Œä¸éœ€è¦è·å–åˆ°é‚£äº›ç±»çš„æŒ‡é’ˆã€‚å¯ä»¥å‡å°‘æ¡†æ¶å¤æ‚åº¦ã€‚æ¶ˆæ¯çš„å‘é€è€…(sender)å‘ŠçŸ¥æ¥æ”¶è€…(receiver)æŸä¸ªäº‹ä»¶å°†è¦å‘ç”Ÿï¼ŒdelegateåŒæ„ç„¶ç„¶åå‘é€è€…å“åº”äº‹ä»¶ï¼Œdelegateæœºåˆ¶ä½¿å¾—æ¥æ”¶è€…å¯ä»¥æ”¹å˜å‘é€è€…çš„è¡Œä¸ºã€‚ Notification: è§‚å¯Ÿè€…æ¨¡å¼, é€šå¸¸å‘é€è€…å’Œæ¥æ”¶è€…çš„å…³ç³»æ˜¯é—´æ¥çš„å¤šå¯¹å¤šå…³ç³»ã€‚ æ¶ˆæ¯çš„å‘é€è€…å‘ŠçŸ¥æ¥æ”¶è€…äº‹ä»¶å·²ç»å‘ç”Ÿæˆ–è€…å°†è¦å‘é€ï¼Œä»…æ­¤è€Œå·²ï¼Œæ¥æ”¶è€…å¹¶ä¸èƒ½åè¿‡æ¥å½±å“å‘é€è€…çš„è¡Œä¸ºã€‚ (1) æ•ˆç‡è‚¯å®šæ˜¯delegateæ¯”NSNotificationé«˜ã€‚ (2) delegateæ–¹æ³•æ¯”notificationæ›´åŠ ç›´æ¥ï¼Œæœ€å…¸å‹çš„ç‰¹å¾æ˜¯ï¼Œdelegateæ–¹æ³•å¾€å¾€éœ€è¦å…³æ³¨è¿”å›å€¼ï¼Œä¹Ÿå°±æ˜¯delegateæ–¹æ³•çš„ç»“æœã€‚æ¯”å¦‚-windowShouldClose:ï¼Œéœ€è¦å…³å¿ƒè¿”å›çš„æ˜¯yesè¿˜æ˜¯noã€‚æ‰€ä»¥delegateæ–¹æ³•å¾€å¾€åŒ…å«shouldè¿™ä¸ªå¾ˆä¼ ç¥çš„è¯ã€‚ä¹Ÿå°±æ˜¯å¥½æ¯”ä½ åšæˆ‘çš„delegateï¼Œæˆ‘ä¼šé—®ä½ æˆ‘æƒ³å…³é—­çª—å£ä½ æ„¿æ„å—ï¼Ÿä½ éœ€è¦ç»™æˆ‘ä¸€ä¸ªç­”æ¡ˆï¼Œæˆ‘æ ¹æ®ä½ çš„ç­”æ¡ˆæ¥å†³å®šå¦‚ä½•åšä¸‹ä¸€æ­¥ã€‚ç›¸åçš„ï¼Œnotificationæœ€å¤§çš„ç‰¹è‰²å°±æ˜¯ä¸å…³å¿ƒæ¥å—è€…çš„æ€åº¦ï¼Œæˆ‘åªç®¡æŠŠé€šå‘Šæ”¾å‡ºæ¥ï¼Œä½ æ¥å—ä¸æ¥å—å°±æ˜¯ä½ çš„äº‹æƒ…ï¼ŒåŒæ—¶æˆ‘ä¹Ÿä¸å…³å¿ƒç»“æœã€‚æ‰€ä»¥notificationå¾€å¾€ç”¨didè¿™ä¸ªè¯æ±‡ï¼Œæ¯”å¦‚NSWindowDidResizeNotificationï¼Œé‚£ä¹ˆnswindowå¯¹è±¡æ”¾å‡ºè¿™ä¸ªnotificationåå°±ä»€ä¹ˆéƒ½ä¸ç®¡äº†ä¹Ÿä¸ä¼šç­‰å¾…æ¥å—è€…çš„ååº”ã€‚ 10. includeä¸#importçš„åŒºåˆ«ï¼Ÿ#importä¸@classçš„åŒºåˆ«ï¼Ÿ #importæŒ‡ä»¤æ˜¯Object-Cé’ˆå¯¹@includeçš„æ”¹è¿›ç‰ˆæœ¬ï¼Œèƒ½ç¡®ä¿å¼•ç”¨çš„æ–‡ä»¶åªä¼šè¢«å¼•ç”¨ä¸€æ¬¡ï¼Œä¸ä¼šé™·å…¥é€’å½’åŒ…å«çš„é—®é¢˜ä¸­ï¼› @importä¸@classçš„åŒºåˆ«ï¼š #importä¼šé“¾å…¥è¯¥å¤´æ–‡ä»¶çš„å…¨éƒ¨ä¿¡æ¯ï¼ŒåŒ…æ‹¬å®ä½“å˜é‡å’Œæ–¹æ³•ç­‰ï¼›äºŒ@classåªæ˜¯å‘Šè¯‰ç¼–è¯‘å™¨ï¼Œå…¶åé¢å£°æ˜çš„åç§°æ˜¯ç±»çš„åç§°ï¼Œè‡³äºè¿™äº›ç±»å¦‚ä½•å®šä¹‰çš„ï¼Œæš‚æ—¶ä¸ç”¨è€ƒè™‘ã€‚åœ¨å¤´æ–‡ä»¶ä¸­ï¼Œä¸€èˆ¬åªéœ€è¦çŸ¥é“è¢«å¼•ç”¨çš„ç±»çš„åç§°å°±å¯ä»¥äº†ï¼Œä¸éœ€è¦çŸ¥é“å…¶å†…éƒ¨çš„å®ä½“å˜é‡å’Œæ–¹æ³•ï¼Œæ‰€ä»¥åœ¨å¤´æ–‡ä»¶ä¸­ä¸€èˆ¬ä½¿ç”¨@classæ¥å£°æ˜è¿™ä¸ªåç§°æ˜¯ç±»çš„åç§°ï¼›è€Œåœ¨å®ç°ç±»é‡Œé¢ï¼Œå› ä¸ºä¼šç”¨åˆ°è¿™ä¸ªå¼•ç”¨ç±»çš„å†…éƒ¨çš„å®ä½“å˜é‡å’Œæ–¹æ³•ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨#importç±»åŒ…å«è¿™ä¸ªè¢«å¼•ç”¨ç±»çš„å¤´æ–‡ä»¶ã€‚@classè¿˜å¯ä»¥è§£å†³å¾ªç¯åŒ…å«çš„é—®é¢˜ #import&lt;&gt;è·Ÿ#importâ€â€çš„åŒºåˆ«ï¼š #import&lt;&gt;ç”¨æ¥åŒ…å«ç³»ç»Ÿè‡ªå¸¦çš„æ–‡ä»¶ï¼Œ#importâ€â€ç”¨æ¥åŒ…å«è‡ªå®šä¹‰çš„æ–‡ä»¶ 11. nonatomicå’Œatomicçš„åŒºåˆ«ï¼Ÿatomicæ˜¯ç»å¯¹çš„çº¿ç¨‹å®‰å…¨ä¹ˆï¼Ÿä¸ºä»€ä¹ˆï¼Ÿå¦‚æœä¸æ˜¯ï¼Œé‚£åº”è¯¥å¦‚ä½•å®ç°ï¼Ÿ nonatomicå’Œatomicçš„åŒºåˆ« nonatomicå’Œatomicç”¨æ¥å†³å®šç¼–è¯‘å™¨ç”Ÿæˆçš„getterå’Œsetteræ“ä½œæ˜¯å¦ä¸ºåŸå­æ“ä½œã€‚ atomicæ˜¯ç»å¯¹çš„çº¿ç¨‹å®‰å…¨ä¹ˆï¼Ÿ atomicä¸æ˜¯ç»å¯¹çš„çº¿ç¨‹å®‰å…¨ã€‚atomicçš„æœ¬æ„æ˜¯æŒ‡å±æ€§çš„å­˜å–æ–¹æ³•æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¹¶ä¸ä¿è¯æ•´ä¸ªå¯¹è±¡æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚å¦‚ï¼šå£°æ˜ä¸€ä¸ªNSMutableArrayçš„åŸå­å±æ€§stuffï¼Œæ­¤æ—¶self.stuff å’Œ self.stuff = otherstufféƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä½†æ˜¯ä½¿ç”¨[self.stuff objectAtIndex:index]å°±ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚éœ€è¦ç”¨äº’æ–¥é”æ¥ä¿è¯çº¿ç¨‹å®‰å…¨æ€§ã€‚ å¦‚ä½•å®ç°çº¿ç¨‹å®‰å…¨ ä½¿ç”¨çº¿ç¨‹é” 12. UICollectionViewè‡ªå®šä¹‰layoutå¦‚ä½•å®ç°ï¼Ÿ -(void)prepareLayout; æ–¹æ³•é‡å†™ï¼Œå¹¶è®¾ç½®åˆå§‹æ ·å¼ - (CGRect)collectionViewContentSize; æ–¹æ³•é‡å†™ï¼Œ å¹¶ä½¿ç”¨å®ƒæ¥è¿”å›CollectionViewè§†å›¾å†…å®¹çš„å®½é«˜ï¼Œ å››ä¸ªæ–¹æ³•æ¥ç¡®å®šå¸ƒå±€ä¿¡æ¯ - (NSArray&lt;__kindof UICollectionViewLayoutAttributes *&gt; *)layoutAttributesForElementsInRect:(CGRect)rect; - (UICollectionViewLayoutAttributes *)layoutAttributesForItemAtIndexPath:(NSIndexPath *)indexPath; - (UICollectionViewLayoutAttributes *)layoutAttributesForSupplementaryViewOfKind:(NSString *)elementKind atIndexPath:(NSIndexPath *)indexPath; - (UICollectionViewLayoutAttributes *)layoutAttributesForDecorationViewOfKind:(NSString*)elementKind atIndexPath:(NSIndexPath *)indexPath; - (BOOL)shouldInvalidateLayoutForBoundsChange:(CGRect)newBounds;å¦‚æœè¿”å›YESï¼Œé‚£ä¹ˆcollectionViewæ˜¾ç¤ºçš„èŒƒå›´å‘ç”Ÿæ”¹å˜æ—¶ï¼Œå°±ä¼šé‡æ–°åˆ·æ–°å¸ƒå±€ 13. è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«ï¼ŸåŒæ­¥å¼‚æ­¥çš„åŒºåˆ«ï¼Ÿå¹¶è¡Œå’Œå¹¶å‘çš„åŒºåˆ«ï¼Ÿ è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ« è¿›ç¨‹æ˜¯èµ„æºçš„åˆ†é…å’Œè°ƒåº¦çš„ä¸€ä¸ªç‹¬ç«‹å•å…ƒï¼Œè€Œçº¿ç¨‹æ˜¯CPUè°ƒåº¦çš„åŸºæœ¬å•å…ƒ åŒä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥åŒ…æ‹¬å¤šä¸ªçº¿ç¨‹ï¼Œå¹¶ä¸”çº¿ç¨‹å…±äº«æ•´ä¸ªè¿›ç¨‹çš„èµ„æºï¼ˆå¯„å­˜å™¨ã€å †æ ˆã€ä¸Šä¸‹æ–‡ï¼‰ï¼Œä¸€ä¸ªè¿›è¡Œè‡³å°‘åŒ…æ‹¬ä¸€ä¸ªçº¿ç¨‹ã€‚ è¿›ç¨‹çš„åˆ›å»ºè°ƒç”¨forkæˆ–è€…vforkï¼Œè€Œçº¿ç¨‹çš„åˆ›å»ºè°ƒç”¨pthread_createï¼Œè¿›ç¨‹ç»“æŸåå®ƒæ‹¥æœ‰çš„æ‰€æœ‰çº¿ç¨‹éƒ½å°†é”€æ¯ï¼Œè€Œçº¿ç¨‹çš„ç»“æŸä¸ä¼šå½±å“åŒä¸ªè¿›ç¨‹ä¸­çš„å…¶ä»–çº¿ç¨‹çš„ç»“æŸ çº¿ç¨‹æ˜¯è½»ä¸¤çº§çš„è¿›ç¨‹ï¼Œå®ƒçš„åˆ›å»ºå’Œé”€æ¯æ‰€éœ€è¦çš„æ—¶é—´æ¯”è¿›ç¨‹å°å¾ˆå¤šï¼Œæ‰€æœ‰æ“ä½œç³»ç»Ÿä¸­çš„æ‰§è¡ŒåŠŸèƒ½éƒ½æ˜¯åˆ›å»ºçº¿ç¨‹å»å®Œæˆçš„ çº¿ç¨‹ä¸­æ‰§è¡Œæ—¶ä¸€èˆ¬éƒ½è¦è¿›è¡ŒåŒæ­¥å’Œäº’æ–¥ï¼Œå› ä¸ºä»–ä»¬å…±äº«åŒä¸€è¿›ç¨‹çš„æ‰€æœ‰èµ„æº çº¿ç¨‹æœ‰è‡ªå·±çš„ç§æœ‰å±æ€§TCBï¼Œçº¿ç¨‹idï¼Œå¯„å­˜å™¨ã€ç¡¬ä»¶ä¸Šä¸‹æ–‡ï¼Œè€Œè¿›ç¨‹ä¹Ÿæœ‰è‡ªå·±çš„ç§æœ‰å±æ€§è¿›ç¨‹æ§åˆ¶å—PCBï¼Œè¿™äº›ç§æœ‰å±æ€§æ˜¯ä¸è¢«å…±äº«çš„ï¼Œç”¨æ¥æ ‡ç¤ºä¸€ä¸ªè¿›ç¨‹æˆ–ä¸€ä¸ªçº¿ç¨‹çš„æ ‡å¿— åŒæ­¥å’Œå¼‚æ­¥çš„åŒºåˆ« åŒæ­¥(synchronous)ï¼šè¿›ç¨‹ä¹‹é—´çš„å…³ç³»ä¸æ˜¯ç›¸äº’æ’æ–¥ä¸´ç•Œèµ„æºçš„å…³ç³»ï¼Œè€Œæ˜¯ç›¸äº’ä¾èµ–çš„å…³ç³»ã€‚è¿›ä¸€æ­¥çš„è¯´æ˜ï¼šå°±æ˜¯å‰ä¸€ä¸ªè¿›ç¨‹çš„è¾“å‡ºä½œä¸ºåä¸€ä¸ªè¿›ç¨‹çš„è¾“å…¥ï¼Œå½“ç¬¬ä¸€ä¸ªè¿›ç¨‹æ²¡æœ‰è¾“å‡ºæ—¶ç¬¬äºŒä¸ªè¿›ç¨‹å¿…é¡»ç­‰å¾…ã€‚å…·æœ‰åŒæ­¥å…³ç³»çš„ä¸€ç»„å¹¶å‘è¿›ç¨‹ç›¸äº’å‘é€çš„ä¿¡æ¯ç§°ä¸ºæ¶ˆæ¯æˆ–äº‹ä»¶ã€‚ å¼‚æ­¥(asynchronous)ï¼šå¼‚æ­¥å’ŒåŒæ­¥æ˜¯ç›¸å¯¹çš„ï¼ŒåŒæ­¥å°±æ˜¯é¡ºåºæ‰§è¡Œï¼Œæ‰§è¡Œå®Œä¸€ä¸ªå†æ‰§è¡Œä¸‹ä¸€ä¸ªï¼Œéœ€è¦ç­‰å¾…ã€åè°ƒè¿è¡Œã€‚å¼‚æ­¥å°±æ˜¯å½¼æ­¤ç‹¬ç«‹,åœ¨ç­‰å¾…æŸäº‹ä»¶çš„è¿‡ç¨‹ä¸­ç»§ç»­åšè‡ªå·±çš„äº‹ï¼Œä¸éœ€è¦ç­‰å¾…è¿™ä¸€äº‹ä»¶å®Œæˆåå†å·¥ä½œã€‚çº¿ç¨‹å°±æ˜¯å®ç°å¼‚æ­¥çš„ä¸€ä¸ªæ–¹å¼ã€‚å¼‚æ­¥æ˜¯è®©è°ƒç”¨æ–¹æ³•çš„ä¸»çº¿ç¨‹ä¸éœ€è¦åŒæ­¥ç­‰å¾…å¦ä¸€çº¿ç¨‹çš„å®Œæˆï¼Œä»è€Œå¯ä»¥è®©ä¸»çº¿ç¨‹å¹²å…¶å®ƒçš„äº‹æƒ…ã€‚ å¹¶è¡Œå’Œå¹¶å‘çš„åŒºåˆ« å¹¶å‘ï¼šåœ¨æ“ä½œç³»ç»Ÿä¸­ï¼Œæ˜¯æŒ‡ä¸€ä¸ªæ—¶é—´æ®µä¸­æœ‰å‡ ä¸ªç¨‹åºéƒ½å¤„äºå·²å¯åŠ¨è¿è¡Œåˆ°è¿è¡Œå®Œæ¯•ä¹‹é—´ï¼Œä¸”è¿™ä¸ªå‡ ä¸ªç¨‹åºéƒ½æ˜¯åœ¨åŒä¸€ä¸ªå¤„ç†æœºä¸Šè¿è¡Œã€‚å…¶ä¸­ä¸¤ç§å¹¶å‘å…³ç³»åˆ†åˆ«æ˜¯åŒæ­¥å’Œäº’æ–¥ã€‚ äº’æ–¥ï¼šè¿›ç¨‹é—´ç›¸äº’æ’æ–¥çš„ä½¿ç”¨ä¸´ç•Œèµ„æºçš„ç°è±¡ åŒæ­¥ï¼šè¿›ç¨‹ä¹‹é—´çš„å…³ç³»ä¸æ˜¯ç›¸äº’æ’æ–¥ä¸´ç•Œèµ„æºçš„å…³ç³»ï¼Œè€Œæ˜¯ç›¸äº’ä¾èµ–çš„å…³ç³»ã€‚è¿›ä¸€æ­¥è¯´æ˜å°±æ˜¯å‰ä¸€ä¸ªè¿›ç¨‹çš„è¾“å‡ºä½œä¸ºåä¸€ä¸ªè¿›ç¨‹çš„è¾“å…¥ï¼Œå½“ç¬¬ä¸€ä¸ªè¿›ç¨‹æ²¡æœ‰è¾“å‡ºæ—¶ç¬¬äºŒä¸ªè¿›ç¨‹å¿…é¡»ç­‰å¾…ã€‚å…·æœ‰åŒæ­¥å…³ç³»çš„ä¸€ç»„å¹¶å‘è¿›ç¨‹ç›¸äº’å‘é€çš„ä¿¡æ¯ç§°ä¸ºæ¶ˆæ¯æˆ–äº‹ä»¶ã€‚å…¶ä¸­å¹¶å‘åˆæœ‰ä¼ªå¹¶å‘å’ŒçœŸå¹¶å‘ï¼Œä¼ªå¹¶å‘æ˜¯æŒ‡å•æ ¸å¤„ç†å™¨çš„å¹¶å‘ï¼ŒçœŸå¹¶å‘æ˜¯æŒ‡å¤šæ ¸å¤„ç†å™¨çš„å¹¶å‘ã€‚ å¹¶è¡Œ(parallelism)ï¼šåœ¨å•å¤„ç†å™¨ä¸­å¤šé“ç¨‹åºè®¾è®¡ç³»ç»Ÿä¸­ï¼Œè¿›ç¨‹è¢«äº¤æ›¿æ‰§è¡Œï¼Œè¡¨ç°å‡ºä¸€ç§å¹¶å‘çš„å¤–éƒ¨ç‰¹ç§ï¼›åœ¨å¤šå¤„ç†å™¨ç³»ç»Ÿä¸­ï¼Œè¿›ç¨‹ä¸ä»…å¯ä»¥äº¤æ›¿æ‰§è¡Œï¼Œè€Œä¸”å¯ä»¥é‡å æ‰§è¡Œã€‚åœ¨å¤šå¤„ç†å™¨ä¸Šçš„ç¨‹åºæ‰å¯å®ç°å¹¶è¡Œå¤„ç†ã€‚ä»è€Œå¯çŸ¥ï¼Œå¹¶è¡Œæ˜¯é’ˆå¯¹å¤šå¤„ç†å™¨è€Œè¨€çš„ã€‚å¹¶è¡Œæ˜¯åŒæ—¶å‘ç”Ÿçš„å¤šä¸ªå¹¶å‘äº‹ä»¶ï¼Œå…·æœ‰å¹¶å‘çš„å«ä¹‰ï¼Œä½†å¹¶å‘ä¸ä¸€å®šå¹¶è¡Œï¼Œä¹Ÿäº¦æ˜¯è¯´å¹¶å‘äº‹ä»¶ä¹‹é—´ä¸ä¸€å®šè¦åŒä¸€æ—¶åˆ»å‘ç”Ÿã€‚ 14. çº¿ç¨‹é—´é€šä¿¡ï¼Ÿ NSThread - (void)performSelectorOnMainThread:(SEL)aSelector withObject:(nullable id)arg waitUntilDone:(BOOL)wait; - (void)performSelector:(SEL)aSelector onThread:(NSThread *)thr withObject:(nullable id)arg waitUntilDone:(BOOL)wait; CGD dispatch_async(dispatch_get_global_queue(0, 0), ^{â€¦}); 15. GCDçš„ä¸€äº›å¸¸ç”¨çš„å‡½æ•°ï¼Ÿï¼ˆgroupï¼Œbarrierï¼Œä¿¡å·é‡ï¼Œçº¿ç¨‹åŒæ­¥ï¼‰16. å¦‚ä½•è®¿é—®å¹¶ä¿®æ”¹ä¸€ä¸ªç±»çš„ç§æœ‰å±æ€§ï¼Ÿ KVO + KVC runtime (class_copyIvarList, object_setIvar) 17. æ•°æ®æŒä¹…åŒ–çš„å‡ ä¸ªæ–¹æ¡ˆï¼ˆfmdbç”¨æ²¡ç”¨è¿‡ï¼‰ CoreData Sqlite 3 FMDB ï¼ˆSqlite 3å°è£…ï¼‰ é’¥åŒ™ä¸² NSUserDefualt NSKeyedArchiver NSCache æ²™ç›’ 18. è¯´ä¸€ä¸‹AppDelegateçš„å‡ ä¸ªæ–¹æ³•ï¼Ÿä»åå°åˆ°å‰å°è°ƒç”¨äº†å“ªäº›æ–¹æ³•ï¼Ÿç¬¬ä¸€æ¬¡å¯åŠ¨è°ƒç”¨äº†å“ªäº›æ–¹æ³•ï¼Ÿä»å‰å°åˆ°åå°è°ƒç”¨äº†å“ªäº›æ–¹æ³•ï¼Ÿ123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566671.å½“åº”ç”¨ç¨‹åºå°†è¦è¿›å…¥éæ´»åŠ¨çŠ¶æ€æ‰§è¡Œï¼Œåœ¨æ­¤æœŸé—´ï¼Œåº”ç”¨ç¨‹åºä¸æ¥å—æ¶ˆæ¯æˆ–äº‹ä»¶ï¼Œæ¯”å¦‚æ¥ç”µ- (void)applicationWillResignActive:(UIApplication *)application &#123; NSLog(@&quot;åº”ç”¨ç¨‹åºå°†è¦è¿›å…¥éæ´»åŠ¨çŠ¶æ€ï¼Œå³å°†è¿›å…¥åå°&quot;);&#125;2.åº”ç”¨ç¨‹åºå·²ç»è¿›å…¥åå°è¿è¡Œ- (void)applicationDidEnterBackground:(UIApplication *)application &#123; NSLog(@&quot;å¦‚æœåº”ç”¨ç¨‹åºæ”¯æŒåå°è¿è¡Œï¼Œåˆ™åº”ç”¨ç¨‹åºå·²ç»è¿›å…¥åå°è¿è¡Œ&quot;); &#x2F;&#x2F;å¦‚æœéœ€è¦é€€å‡ºåå°,åˆ™åœ¨è¿™é‡ŒåŠ ä¸Š:exit(0);&#125;3.åº”ç”¨ç¨‹åºå°†è¦è¿›å…¥æ´»åŠ¨çŠ¶æ€æ‰§è¡Œ- (void)applicationWillEnterForeground:(UIApplication *)application &#123; NSLog(@&quot;åº”ç”¨ç¨‹åºå°†è¦è¿›å…¥æ´»åŠ¨çŠ¶æ€ï¼Œå³å°†è¿›å…¥å‰å°è¿è¡Œ&quot;);&#125;4.åº”ç”¨ç¨‹åºå·²ç»è¿›å…¥æ´»åŠ¨çŠ¶æ€- (void)applicationDidBecomeActive:(UIApplication *)application &#123; NSLog(@&quot;åº”ç”¨ç¨‹åºå·²è¿›å…¥å‰å°ï¼Œå¤„äºæ´»åŠ¨çŠ¶æ€&quot;);&#125;5.åº”ç”¨ç¨‹åºå°†è¦é€€å‡ºï¼Œé€šå¸¸ç”¨äºä¿å­˜æ•°æ®å’Œä¸€äº›é€€å‡ºå‰çš„æ¸…ç†å·¥ä½œ- (void)applicationWillTerminate:(UIApplication *)application &#123; NSLog(@&quot;åº”ç”¨ç¨‹åºå°†è¦é€€å‡ºï¼Œé€šå¸¸ç”¨äºä¿å­˜æ•°æ®å’Œä¸€äº›é€€å‡ºå‰çš„æ¸…ç†å·¥ä½œ&quot;);&#125;6.å½“è®¾å¤‡ä¸ºåº”ç”¨ç¨‹åºåˆ†é…äº†å¤ªå¤šçš„å†…å­˜ï¼Œæ“ä½œç³»ç»Ÿä¼šç»ˆæ­¢åº”ç”¨ç¨‹åºçš„è¿è¡Œï¼Œåœ¨ç»ˆæ­¢å‰ä¼šæ‰§è¡Œè¿™ä¸ªæ–¹æ³•ï¼Œé€šå¸¸å¯ä»¥åœ¨è¿™é‡Œè¿›è¡Œå†…å­˜æ¸…ç†å·¥ä½œï¼Œé˜²æ­¢ç¨‹åºè¢«ç»ˆæ­¢- (void)applicationDidReceiveMemoryWarning:(UIApplication *)application &#123; NSLog(@&quot;ç³»ç»Ÿå†…å­˜ä¸è¶³ï¼Œéœ€è¦è¿›è¡Œæ¸…ç†å·¥ä½œ&quot;);&#125;7.å½“ç³»ç»Ÿæ—¶é—´å‘ç”Ÿæ”¹å˜æ—¶æ‰§è¡Œ- (void)applicationSignificantTimeChange:(UIApplication *)application &#123; NSLog(@&quot;å½“ç³»ç»Ÿæ—¶é—´å‘ç”Ÿæ”¹å˜æ—¶æ‰§è¡Œ&quot;);&#125;8.æ¨é€æ¶ˆæ¯æ—¶ï¼Œè·å–è®¾å¤‡çš„tokenid- (void)application:(UIApplication *)application didRegisterForRemoteNotificationsWithDeviceToken:(NSData *)deviceToken &#123; NSLog(@&quot;%@&quot;,deviceToken);&#125;9.tokenidè·å–å¤±è´¥æ—¶,åšç›¸åº”å¤„ç†- (void)application:(UIApplication *)app didFailToRegisterForRemoteNotificationsWithError:(NSError *)error &#123; NSLog(@&quot;fail to register for remoteNotifications: %@&quot;, [err description]);&#125;10.æ¥æ”¶åˆ°æ¨é€æ¶ˆæ¯å¤„ç†- (void)application:(UIApplication *)application didReceiveRemoteNotification:(NSDictionary *)userInfo &#123; &#x2F;&#x2F;è®¾ç½®iconä¸Šçš„æ ‡è®°æ•°å­—è®¾ç½®ä¸º0ï¼› &#x2F;&#x2F;application.applicationIconBadgeNumber &#x3D; 0; NSLog(@&quot;%@&quot;,userInfo);&#125;11.å½“ç¨‹åºè½½å…¥åæ‰§è¡Œ- (void)applicationDidFinishLaunching:(UIApplication *)application &#123; NSLog(@&quot;å½“ç¨‹åºè½½å…¥åæ‰§è¡Œ&quot;);&#125; 19. NSCacheä¼˜äºNSDictionaryçš„å‡ ç‚¹ï¼Ÿ NSCache æ˜¯ä¸€ä¸ªå®¹å™¨ç±»ï¼Œç±»ä¼¼äºNSDIctionary,é€šè¿‡key-value å½¢å¼å­˜å‚¨å’ŒæŸ¥è¯¢å€¼ï¼Œç”¨äºä¸´æ—¶å­˜å‚¨å¯¹è±¡ã€‚ æ³¨æ„ä¸€ç‚¹å®ƒå’ŒNSDictionaryåŒºåˆ«å°±æ˜¯ï¼ŒNSCache ä¸­çš„keyä¸å¿…å®ç°copyï¼ŒNSDictionaryä¸­çš„keyå¿…é¡»å®ç°copy NSCacheä¸­å­˜å‚¨çš„å¯¹è±¡ä¹Ÿä¸å¿…å®ç°NSCodingåè®®ï¼Œå› ä¸ºæ¯•ç«Ÿæ˜¯ä¸´æ—¶å­˜å‚¨ï¼Œç±»ä¼¼äºå†…å­˜ç¼“å­˜ï¼Œç¨‹åºé€€å‡ºåå°±è¢«é‡Šæ”¾äº†ã€‚ 20. çŸ¥ä¸çŸ¥é“Designated Initializerï¼Ÿä½¿ç”¨å®ƒçš„æ—¶å€™æœ‰ä»€ä¹ˆéœ€è¦æ³¨æ„çš„é—®é¢˜ï¼Ÿ21. å®ç°descriptionæ–¹æ³•èƒ½å–åˆ°ä»€ä¹ˆæ•ˆæœï¼Ÿ å¯ä»¥è¾“å‡ºå¯¹è±¡å†…éƒ¨çš„ä¸€äº›æˆå˜é‡çš„å€¼ 22. objcä½¿ç”¨ä»€ä¹ˆæœºåˆ¶ç®¡ç†å¯¹è±¡å†…å­˜ï¼Ÿ ARC (automatic reference counting)MRC (manual retain-release) Block blockçš„å®è´¨æ˜¯ä»€ä¹ˆï¼Ÿä¸€å…±æœ‰å‡ ç§blockï¼Ÿéƒ½æ˜¯ä»€ä¹ˆæƒ…å†µä¸‹ç”Ÿæˆçš„ï¼Ÿ ä½¿ç”¨ç³»ç»Ÿçš„æŸäº›block apiï¼Œæ˜¯å¦è€ƒè™‘å¼•ç”¨å¾ªç¯é—®é¢˜ï¼Ÿ è°ˆè°ˆblockçš„ç†è§£ï¼Ÿå¹¶å†™å‡ºä¸€ä¸ªä½¿ç”¨blockæ‰§è¡ŒUIVewåŠ¨ç”»ï¼Ÿ Runtime runtimeå¦‚ä½•å®ç°weakå±æ€§ï¼Ÿ runtimeå¦‚ä½•é€šè¿‡selectoræ‰¾åˆ°å¯¹åº”çš„IMPåœ°å€ï¼Ÿ èƒ½å¦å‘ç¼–è¯‘åå¾—åˆ°çš„ç±»ä¸­å¢åŠ å®ä¾‹å˜é‡ï¼Ÿèƒ½å¦å‘è¿è¡Œæ—¶åˆ›å»ºçš„ç±»ä¸­æ·»åŠ å®ä¾‹å˜é‡ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ runtimeå¦‚ä½•å®ç°weakå˜é‡çš„è‡ªåŠ¨ç½®nilï¼Ÿ åœ¨å¼€å‘ä¸­å¦‚ä½•ä½¿ç”¨runtimeï¼Ÿä»€ä¹ˆåº”ç”¨åœºæ™¯ï¼Ÿ ç±»ç»“æ„ isaæŒ‡é’ˆï¼Ÿï¼ˆå¯¹è±¡çš„isaï¼Œç±»å¯¹è±¡çš„isaï¼Œå…ƒç±»çš„isaéƒ½è¦è¯´ï¼‰ ç±»æ–¹æ³•å’Œå®ä¾‹æ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ ä»‹ç»ä¸€ä¸‹åˆ†ç±»ï¼Œèƒ½ç”¨åˆ†ç±»åšä»€ä¹ˆï¼Ÿå†…éƒ¨æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿå®ƒä¸ºä»€ä¹ˆä¼šè¦†ç›–æ‰åŸæ¥çš„æ–¹æ³•ï¼Ÿ è¿è¡Œæ—¶èƒ½å¢åŠ æˆå‘˜å˜é‡ä¹ˆï¼Ÿèƒ½å¢åŠ å±æ€§ä¹ˆï¼Ÿå¦‚æœèƒ½ï¼Œå¦‚ä½•å¢åŠ ï¼Ÿå¦‚æœä¸èƒ½ï¼Œä¸ºä»€ä¹ˆï¼Ÿ objcä¸­å‘ä¸€ä¸ªnilå¯¹è±¡å‘é€æ¶ˆæ¯å°†ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿï¼ˆè¿”å›å€¼æ˜¯å¯¹è±¡ï¼Œæ˜¯æ ‡é‡ï¼Œç»“æ„ä½“ï¼‰ é«˜çº§ UITableviewçš„ä¼˜åŒ–æ–¹æ³•ï¼ˆç¼“å­˜é«˜åº¦ï¼Œå¼‚æ­¥ç»˜åˆ¶ï¼Œå‡å°‘å±‚çº§ï¼Œhideï¼Œé¿å…ç¦»å±æ¸²æŸ“ï¼‰ æœ‰æ²¡æœ‰ç”¨è¿‡è¿è¡Œæ—¶ï¼Œç”¨å®ƒéƒ½èƒ½åšä»€ä¹ˆï¼Ÿï¼ˆäº¤æ¢æ–¹æ³•ï¼Œåˆ›å»ºç±»ï¼Œç»™æ–°åˆ›å»ºçš„ç±»å¢åŠ æ–¹æ³•ï¼Œæ”¹å˜isaæŒ‡é’ˆï¼‰ çœ‹è¿‡å“ªäº›ç¬¬ä¸‰æ–¹æ¡†æ¶çš„æºç ï¼Ÿéƒ½æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿï¼ˆå¦‚æœæ²¡æœ‰ï¼Œé—®ä¸€ä¸‹å¤šå›¾ä¸‹è½½çš„è®¾è®¡ï¼‰ SDWebImageçš„ç¼“å­˜ç­–ç•¥ï¼Ÿ AFNä¸ºä»€ä¹ˆæ·»åŠ ä¸€æ¡å¸¸é©»çº¿ç¨‹ï¼Ÿ KVOçš„ä½¿ç”¨ï¼Ÿå®ç°åŸç†ï¼Ÿï¼ˆä¸ºä»€ä¹ˆè¦åˆ›å»ºå­ç±»æ¥å®ç°ï¼‰ KVCçš„ä½¿ç”¨ï¼Ÿå®ç°åŸç†ï¼Ÿï¼ˆKVCæ‹¿åˆ°keyä»¥åï¼Œæ˜¯å¦‚ä½•èµ‹å€¼çš„ï¼ŸçŸ¥ä¸çŸ¥é“é›†åˆæ“ä½œç¬¦ï¼Œèƒ½ä¸èƒ½è®¿é—®ç§æœ‰å±æ€§ï¼Œèƒ½ä¸èƒ½ç›´æ¥è®¿é—®_ivarï¼‰ iOSçš„æ²™ç›’ç›®å½•ç»“æ„ AppName.app Documents Library â€“&gt; 3.1 Preferences 3.2 Caches tmp","categories":[{"name":"é¢è¯•é¢˜","slug":"é¢è¯•é¢˜","permalink":"https://github.com/wuvdan/wuvdan.github.io/categories/%E9%9D%A2%E8%AF%95%E9%A2%98/"}],"tags":[{"name":"é¢è¯•æŠ€å·§","slug":"é¢è¯•æŠ€å·§","permalink":"https://github.com/wuvdan/wuvdan.github.io/tags/%E9%9D%A2%E8%AF%95%E6%8A%80%E5%B7%A7/"}]},{"title":"iOSé¢è¯•é¢˜-005","slug":"iOSé¢è¯•é¢˜-005","date":"2020-01-16T08:05:23.295Z","updated":"2020-01-20T01:43:05.285Z","comments":true,"path":"2020/01/16/iOSé¢è¯•é¢˜-005/","link":"","permalink":"https://github.com/wuvdan/wuvdan.github.io/2020/01/16/iOS%E9%9D%A2%E8%AF%95%E9%A2%98-005/","excerpt":"","text":"åŸºç¡€é¢è¯•é¢˜ä¸€ã€ä¸¤ç§æ‹·è´çš„å·®åˆ« æµ…æ‹·è´ï¼šæŒ‡é’ˆï¼ˆåœ°å€ï¼‰æ‹·è´ï¼Œä¸ä¼šäº§ç”Ÿæ–°å¯¹è±¡ æ·±æ‹·è´ï¼šå†…å®¹æ‹·è´ï¼Œä¼šäº§ç”Ÿæ–°å¯¹è±¡ äºŒã€Categoryå’ŒExtensionçš„å·®åˆ« åˆ†ç±»æ˜¯æœ‰åç§°çš„ï¼Œç±»æ‰©å±•æ²¡æœ‰åç§° åˆ†ç±»åªèƒ½æ‰©å……æ–¹æ³•ã€ä¸èƒ½æ‰©å……æˆå‘˜å˜é‡ï¼ˆéœ€è¦åˆ©ç”¨RunTimeé‡å†™setã€getæ–¹æ³•ï¼‰ï¼›ç±»æ‰©å±•å¯ä»¥æ‰©å……æ–¹æ³•å’Œæˆå‘˜å˜é‡ ç±»æ‰©å±•ä¸€èˆ¬å°±å†™åœ¨.mæ–‡ä»¶ä¸­ï¼Œç”¨æ¥æ‰©å……ç§æœ‰çš„æ–¹æ³•å’Œæˆå‘˜å˜é‡ï¼ˆå±æ€§ï¼‰ ä¸‰ã€KVOå’ŒKVCçš„å·®åˆ« KVCæ˜¯é”®å€¼ç¼–ç ï¼Œå¯ä»¥é€šè¿‡ä¸€ä¸ªå­—ç¬¦ä¸²çš„keyï¼ˆå±æ€§åï¼‰ä¿®æ”¹å¯¹è±¡çš„å±æ€§å€¼ KVOæ˜¯é”®å€¼ç›‘å¬ï¼Œå¯ä»¥ç›‘å¬ä¸€ä¸ªå¯¹è±¡å±æ€§å€¼çš„æ”¹å˜ å››ã€propertyå±æ€§ä»‹ç» copyæ˜¯åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œä¸¤ä¸ªå¯¹è±¡å†…å®¹ç›¸åŒï¼Œæ—§å¯¹è±¡æ²¡æœ‰å˜åŒ–ã€‚æ–°çš„å¯¹è±¡retainä¸º1ï¼Œä¸æ—§æœ‰å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¸å˜ã€‚æ—§å¯¹è±¡å‘ç”Ÿæ”¹å˜ä¸å½±å“æ–°å¯¹è±¡ï¼Œcopyå‡å°‘å¯¹è±¡å¯¹ä¸Šä¸‹æ–‡çš„ä¾èµ–ã€‚NSStringã€Blockç­‰ç±»å‹ retainå±æ€§è¡¨ç¤ºä¸¤ä¸ªå¯¹è±¡åœ°å€ç›¸åŒï¼ˆå»ºç«‹ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡é’ˆæ‹·è´ï¼‰ï¼Œå†…å®¹ç›¸åŒï¼Œè¿™ä¸ªå¯¹è±¡çš„retainå€¼+1ã€‚ä¸¤ä¸ªå¯¹è±¡è¦æ”¹å˜å°±ä¸€èµ·æ”¹å˜ã€‚ weakå…¶å®ç±»ä¼¼äºassignï¼Œå«å¼±å¼•ç”¨ï¼Œä¹Ÿæ˜¯ä¸å¢åŠ å¼•ç”¨è®¡æ•°ã€‚ä¸€èˆ¬åªæœ‰åœ¨é˜²æ­¢å¾ªç¯å¼•ç”¨æ—¶ä½¿ç”¨ï¼Œæ¯”å¦‚çˆ¶ç±»å¼•ç”¨äº†å­ç±»ï¼Œå­ç±»åˆå»å¼•ç”¨çˆ¶ç±»ã€‚IBOutletã€Delegateä¸€èˆ¬ç”¨çš„å°±æ˜¯weakï¼Œè¿™æ˜¯å› ä¸ºå®ƒä»¬ä¼šåœ¨ç±»å¤–éƒ¨è¢«è°ƒç”¨ï¼Œé˜²æ­¢å¾ªç¯å¼•ç”¨ã€‚ assignï¼šéOCå¯¹è±¡ç±»å‹ï¼Œ åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆä¸¤ä¸ªå¯¹è±¡ç›¸äº’å¼•ç”¨çš„æ—¶å€™ï¼Œä¸€ç«¯ç”¨retainï¼Œ ä¸€ç«¯ç”¨assignï¼‰ strongå°±ç±»ä¼¼ä¸retainäº†ï¼Œå«å¼ºå¼•ç”¨ï¼Œä¼šå¢åŠ å¼•ç”¨è®¡æ•°ï¼Œç±»å†…éƒ¨ä½¿ç”¨çš„å±æ€§ä¸€èˆ¬éƒ½æ˜¯strongä¿®é¥°çš„ï¼Œç°åœ¨ARCå·²ç»åŸºæœ¬æ›¿ä»£äº†MRCï¼Œæ‰€ä»¥æˆ‘ä»¬æœ€å¸¸è§çš„å°±æ˜¯strongäº†ã€‚retainï¼šOCå¯¹è±¡ç±»å‹ nonatomic åœ¨ä¿®é¥°å±æ€§æ—¶ï¼Œæˆ‘ä»¬å¾€å¾€è¿˜ä¼šåŠ ä¸€ä¸ªnonatomicï¼Œè¿™åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå®ƒçš„åå­—å«éåŸå­è®¿é—®ã€‚å¯¹åº”çš„æœ‰atomicï¼Œæ˜¯åŸå­æ€§çš„è®¿é—®ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨ä½¿ç”¨å¤šçº¿ç¨‹æ—¶ä¸ºäº†é¿å…åœ¨å†™æ“ä½œæ—¶åŒæ—¶è¿›è¡Œå†™å¯¼è‡´é—®é¢˜ï¼Œç»å¸¸ä¼šå¯¹è¦å†™çš„å¯¹è±¡è¿›è¡ŒåŠ é”ï¼Œä¹Ÿå°±æ˜¯åŒä¸€æ—¶åˆ»åªå…è®¸ä¸€ä¸ªçº¿ç¨‹å»æ“ä½œå®ƒã€‚å¦‚æœä¸€ä¸ªå±æ€§æ˜¯ç”±atomicä¿®é¥°çš„ï¼Œé‚£ä¹ˆç³»ç»Ÿå°±ä¼šè¿›è¡Œçº¿ç¨‹ä¿æŠ¤ï¼Œé˜²æ­¢å¤šä¸ªå†™æ“ä½œåŒæ—¶è¿›è¡Œã€‚è¿™æœ‰å¥½å¤„ï¼Œä½†ä¹Ÿæœ‰åå¤„ï¼Œé‚£å°±æ˜¯æ¶ˆè€—ç³»ç»Ÿèµ„æºï¼Œæ‰€ä»¥å¯¹äºiPhoneè¿™ç§å°å‹è®¾å¤‡ï¼Œå¦‚æœä¸æ˜¯è¿›è¡Œå¤šçº¿ç¨‹çš„å†™æ“ä½œï¼Œå°±å¯ä»¥ä½¿ç”¨nonatomicï¼Œå–æ¶ˆçº¿ç¨‹ä¿æŠ¤ï¼Œæé«˜æ€§èƒ½ã€‚ äº”ã€ä»£ç†ï¼Œé€šçŸ¥ï¼Œå’Œblockçš„åŒºåˆ« é€šçŸ¥ï¼šNotificationCenter é€šçŸ¥ä¸­å¿ƒï¼šâ€œä¸€å¯¹å¤šâ€ï¼Œåœ¨APPä¸­ï¼Œå¾ˆå¤šæ§åˆ¶å™¨éƒ½éœ€è¦çŸ¥é“ä¸€ä¸ªäº‹ä»¶ï¼Œåº”è¯¥ç”¨é€šçŸ¥ï¼› ä»£ç†ï¼šä¸€å¯¹ä¸€â€ï¼Œå¯¹åŒä¸€ä¸ªåè®®ï¼Œä¸€ä¸ªå¯¹è±¡åªèƒ½è®¾ç½®ä¸€ä¸ªä»£ç†delegateï¼Œæ‰€ä»¥å•ä¾‹å¯¹è±¡å°±ä¸èƒ½ç”¨ä»£ç†ï¼›ä»£ç†æ›´æ³¨é‡è¿‡ç¨‹ä¿¡æ¯çš„ä¼ è¾“ï¼šæ¯”å¦‚å‘èµ·ä¸€ä¸ªç½‘ç»œè¯·æ±‚ï¼Œå¯èƒ½æƒ³è¦çŸ¥é“æ­¤æ—¶è¯·æ±‚æ˜¯å¦å·²ç»å¼€å§‹ã€æ˜¯å¦æ”¶åˆ°äº†æ•°æ®ã€æ•°æ®æ˜¯å¦å·²ç»æ¥å—å®Œæˆã€æ•°æ®æ¥æ”¶å¤±è´¥ blockï¼šdelegateä¸€æ ·ï¼Œä¸€èˆ¬éƒ½æ˜¯â€œä¸€å¯¹ä¸€â€ä¹‹é—´é€šä¿¡äº¤äº’ï¼Œç›¸æ¯”ä»£ç†blockæœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š 1ã€å†™æ³•æ›´ç®€ç»ƒï¼Œä¸éœ€è¦å†™protocolã€å‡½æ•°ç­‰ç­‰ 2ã€blockæ³¨é‡ç»“æœçš„ä¼ è¾“ï¼šæ¯”å¦‚å¯¹äºä¸€ä¸ªäº‹ä»¶ï¼Œåªæƒ³çŸ¥é“æˆåŠŸæˆ–è€…å¤±è´¥ï¼Œå¹¶ä¸éœ€è¦çŸ¥é“è¿›è¡Œäº†å¤šå°‘æˆ–è€…é¢å¤–çš„ä¸€äº›ä¿¡æ¯ 3ã€blockéœ€è¦æ³¨æ„é˜²æ­¢å¾ªç¯å¼•ç”¨ å…­ã€ç½‘ç»œ HTTPï¼ˆHyperText Transfer Protocolã€è¶…æ–‡æœ¬ä¼ è¾“åè®®)æ˜¯OSIä¸ƒå±‚ä¸­åº”ç”¨å±‚çš„åè®®ã€‚HTTP æ˜¯åŸºäº TCP/IPåè®®çš„åº”ç”¨å±‚åè®®ã€‚å®ƒä¸æ¶‰åŠæ•°æ®åŒ…ï¼ˆpacketï¼‰ä¼ è¾“ï¼Œä¸»è¦è§„å®šäº†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡æ ¼å¼ï¼Œé»˜è®¤ä½¿ç”¨80ç«¯å£ã€‚ TCPï¼ˆTransmission Control Protocolï¼Œä¼ è¾“æ§åˆ¶åè®®ï¼‰æ˜¯OSIä¸ƒå±‚ä¸­ä¼ è¾“å±‚çš„åè®®ã€‚TCPï¼ˆTransmission Control Protocolï¼Œä¼ è¾“æ§åˆ¶åè®®ï¼‰æ˜¯åŸºäºè¿æ¥çš„åè®®ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ­£å¼æ”¶å‘æ•°æ®å‰ï¼Œå¿…é¡»å’Œå¯¹æ–¹å»ºç«‹å¯é çš„è¿æ¥ã€‚TCPæä¾›è¶…æ—¶é‡å‘ï¼Œä¸¢å¼ƒé‡å¤æ•°æ®ï¼Œæ£€éªŒæ•°æ®ï¼Œæµé‡æ§åˆ¶ç­‰åŠŸèƒ½ï¼Œä¿è¯æ•°æ®èƒ½ä»ä¸€ç«¯ä¼ åˆ°å¦ä¸€ç«¯ã€‚ ç†æƒ³çŠ¶æ€ä¸‹ï¼ŒTCPè¿æ¥ä¸€æ—¦å»ºç«‹ï¼Œåœ¨é€šä¿¡åŒæ–¹ä¸­çš„ä»»ä½•ä¸€æ–¹ä¸»åŠ¨å…³é—­è¿æ¥å‰ï¼ŒTCP è¿æ¥éƒ½å°†è¢«ä¸€ç›´ä¿æŒä¸‹å»ã€‚æ–­å¼€è¿æ¥æ—¶æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å‡å¯ä»¥ä¸»åŠ¨å‘èµ·æ–­å¼€TCPè¿æ¥çš„è¯·æ±‚ UDP (User Datagram Protocol,ç”¨æˆ·æ•°æ®æŠ¥åè®®)æ˜¯OSIå‚è€ƒæ¨¡å‹ä¸­æ— è¿æ¥çš„ä¼ è¾“å±‚åè®®.UDPç”¨æˆ·æ•°æ®æŠ¥åè®®ï¼Œæ˜¯ä¸€ä¸ªæ— è¿æ¥çš„ç®€å•çš„é¢å‘æ•°æ®æŠ¥çš„è¿è¾“å±‚åè®®ã€‚UDPä¸æä¾›å¯é æ€§ï¼Œå®ƒåªæ˜¯æŠŠåº”ç”¨ç¨‹åºä¼ ç»™IPå±‚çš„æ•°æ®æŠ¥å‘é€å‡ºå»ï¼Œä½†æ˜¯å¹¶ä¸èƒ½ä¿è¯å®ƒä»¬èƒ½åˆ°è¾¾ç›®çš„åœ°ã€‚ç”±äºUDPåœ¨ä¼ è¾“æ•°æ®æŠ¥å‰ä¸ç”¨åœ¨å®¢æˆ·å’ŒæœåŠ¡å™¨ä¹‹é—´å»ºç«‹ä¸€ä¸ªè¿æ¥ï¼Œä¸”æ²¡æœ‰è¶…æ—¶é‡å‘ç­‰æœºåˆ¶ï¼Œæ•…è€Œä¼ è¾“é€Ÿåº¦å¾ˆå¿«ã€‚ socketæ˜¯å¯¹TCPæˆ–è€…UDPåè®®çš„å°è£…å’Œå®ç°ï¼Œsocketå¹¶ä¸æ˜¯åè®®ï¼Œå·®ä¸å¤šæ¯ä¸€ç§è¯­è¨€éƒ½å®ç°äº†å¯¹TCPå’ŒUDPå°è£…å’Œå®ç°çš„Socketä»£ç åº“ï¼Œæ–¹ä¾¿å¼€å‘ç¨‹åºå‘˜ä½¿ç”¨ï¼Œsocketæ˜¯å¯¹TCPæˆ–è€…UDPåè®®çš„å°è£…å’Œå®ç°ï¼Œè¿™æ ·æˆ‘å°±å¯ä»¥åŸºäºä½ æ‰€ä½¿ç”¨è¯­è¨€çš„Socketæ¥å®ç°æ›´å¤šçš„åŠŸèƒ½ï¼Œæœ‰åŸºäºSocket TCPçš„HTTPè¯·æ±‚ï¼Œæœ‰åŸºäºSocket TCPé•¿è¿æ¥çš„æ¶ˆæ¯æ¨é€ï¼Œä¹Ÿå¯ä»¥åŸºäºSocket TCP/UDPè‡ªå®šä¹‰ä¸€å¥—è‡ªå·±çš„é€šä¿¡åè®®ã€‚ï¼ˆ5ï¼‰å…³ç³»â€”&gt; HTTPåŸºäºTCPï¼ŒHTTPè¯·æ±‚éœ€è¦ä½¿ç”¨Socket TCPæ¥å®Œæˆã€‚ ä¸ƒã€å¤šçº¿ç¨‹ è¿›ç¨‹ï¼šè¿›ç¨‹æ˜¯èµ„æºï¼ˆCPUã€å†…å­˜ç­‰ï¼‰åˆ†é…çš„åŸºæœ¬å•ä½ï¼Œå®ƒæ˜¯ç¨‹åºæ‰§è¡Œæ—¶çš„ä¸€ä¸ªå®ä¾‹ã€‚ çº¿ç¨‹æ˜¯ç¨‹åºæ‰§è¡Œæ—¶çš„æœ€å°å•ä½ï¼Œå®ƒæ˜¯è¿›ç¨‹çš„ä¸€ä¸ªæ‰§è¡Œæµï¼Œæ˜¯CPUè°ƒåº¦å’Œåˆ†æ´¾çš„åŸºæœ¬å•ä½ï¼Œä¸€ä¸ªè¿›ç¨‹å¯ä»¥ç”±å¾ˆå¤šä¸ªçº¿ç¨‹ç»„æˆï¼Œçº¿ç¨‹é—´å…±äº«è¿›ç¨‹çš„æ‰€æœ‰èµ„æºï¼Œæ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„å †æ ˆå’Œå±€éƒ¨å˜é‡ã€‚ pthreadï¼šCè¯­è¨€ç¼–ç¨‹ï¼Œæ‰‹åŠ¨ç®¡ç†çº¿ç¨‹å‘¨æœŸï¼Œä½¿ç”¨éš¾åº¦å¤§ï¼Œä¸å¸¸ç”¨ã€‚ NSThreadï¼šOCè¯­è¨€ç¼–ç¨‹ï¼Œæ‰‹åŠ¨ç®¡ç†çº¿ç¨‹å‘¨æœŸï¼Œé¢å‘å¯¹è±¡ï¼Œå¶å°”ä½¿ç”¨ GCDï¼šCè¯­è¨€ç¼–ç¨‹ï¼Œæ”¯æŒå¤šæ ¸ï¼Œè‡ªåŠ¨ç®¡ç†çº¿ç¨‹å‘¨æœŸï¼Œå¸¸ç”¨ NSOperationï¼šOCè¯­è¨€ç¼–ç¨‹ï¼ŒåŸºäºGCDï¼Œæ¯”GCDæ–°å¢æ–°åŠŸèƒ½ï¼Œå¸¸ç”¨ çº¿ç¨‹é”ï¼šçº¿ç¨‹æ­»é”æœ‰â€œäº’ç­‰â€ï¼Œç„¶åå¡ä½çš„æ„æ€,ä¹Ÿç”±äºå’ŒåŒ/å¼‚æ­¥å¤„ç†é¡ºåºï¼Œçº¿ç¨‹çš„ç­‰å¾…å¯¼è‡´é˜Ÿåˆ—åŠ å…¥çš„é¡ºåºä¸é˜Ÿåˆ—çš„FIFOåŸåˆ™(å…ˆè¿›å…ˆå‡ºï¼‰å†²çªå¼•èµ·ã€‚ å¹¶è¡Œï¼šå¹¶è¡ŒæŒ‡çš„æ˜¯ä¸€ç§æŠ€æœ¯ï¼Œä¸€ä¸ªåŒæ—¶å¤„ç†å¤šä¸ªä»»åŠ¡çš„æŠ€æœ¯ã€‚å®ƒæè¿°äº†ä¸€ç§èƒ½å¤ŸåŒæ—¶å¤„ç†å¤šä¸ªä»»åŠ¡çš„èƒ½åŠ›ï¼Œä¾§é‡ç‚¹åœ¨äºâ€œè¿è¡Œâ€ã€‚ ä¸²è¡Œï¼šè¡¨ç¤ºä»»åŠ¡å¿…é¡»æŒ‰é¡ºåºæ¥ï¼Œä¸€ä¸ªä¸€ä¸ªæ‰§è¡Œï¼Œå‰ä¸€ä¸ªæ‰§è¡Œå®Œäº†æ‰èƒ½æ‰§è¡Œåä¸€ä¸ªã€‚ å¹¶å‘ï¼šå¹¶å‘æŒ‡çš„æ˜¯ä¸€ç§ç°è±¡ï¼Œä¸€ç§ç»å¸¸å‡ºç°ï¼Œæ— å¯é¿å…çš„ç°è±¡ã€‚å®ƒæè¿°çš„æ˜¯â€œå¤šä¸ªä»»åŠ¡åŒæ—¶å‘ç”Ÿï¼Œéœ€è¦è¢«å¤„ç†â€è¿™ä¸€ç°è±¡ã€‚å®ƒçš„ä¾§é‡ç‚¹åœ¨äºâ€œå‘ç”Ÿâ€ã€‚ é˜Ÿåˆ—ï¼šä¸ç®¡æ˜¯ä¸²è¡Œé˜Ÿåˆ—ï¼ˆSerialQueueï¼‰è¿˜æ˜¯å¹¶è¡Œé˜Ÿåˆ—ï¼ˆConcurrencyQueueï¼‰ï¼Œéƒ½æ˜¯FIFOé˜Ÿåˆ—ã€‚ä¹Ÿå°±æ„å‘³ç€ï¼Œä»»åŠ¡ä¸€å®šæ˜¯ä¸€ä¸ªä¸€ä¸ªåœ°ï¼ŒæŒ‰ç…§å…ˆè¿›å…ˆå‡ºçš„é¡ºåºæ¥è°ƒåº¦ã€‚ åŒæ­¥ï¼šå°±æ˜¯åœ¨å‘å‡ºä¸€ä¸ªè°ƒç”¨æ—¶ï¼Œåœ¨æ²¡æœ‰å¾—åˆ°ç»“æœä¹‹å‰ï¼Œè¯¥è°ƒç”¨å°±ä¸è¿”å›ã€‚ä½†æ˜¯ä¸€æ—¦è°ƒç”¨è¿”å›ï¼Œå°±å¾—åˆ°è¿”å›å€¼äº†ã€‚ å¼‚æ­¥ï¼šè°ƒç”¨åœ¨å‘å‡ºä¹‹åï¼Œè¿™ä¸ªè°ƒç”¨å°±ç›´æ¥è¿”å›äº†ï¼Œæ‰€ä»¥æ²¡æœ‰è¿”å›ç»“æœã€‚","categories":[{"name":"é¢è¯•é¢˜","slug":"é¢è¯•é¢˜","permalink":"https://github.com/wuvdan/wuvdan.github.io/categories/%E9%9D%A2%E8%AF%95%E9%A2%98/"}],"tags":[{"name":"é¢è¯•æŠ€å·§","slug":"é¢è¯•æŠ€å·§","permalink":"https://github.com/wuvdan/wuvdan.github.io/tags/%E9%9D%A2%E8%AF%95%E6%8A%80%E5%B7%A7/"}]},{"title":"iOSå¤šçº¿ç¨‹-NSOperation","slug":"iOSå¤šçº¿ç¨‹-NSOperation","date":"2020-01-16T08:05:14.617Z","updated":"2020-01-20T01:45:50.766Z","comments":true,"path":"2020/01/16/iOSå¤šçº¿ç¨‹-NSOperation/","link":"","permalink":"https://github.com/wuvdan/wuvdan.github.io/2020/01/16/iOS%E5%A4%9A%E7%BA%BF%E7%A8%8B-NSOperation/","excerpt":"","text":"1.NSOperationã€NSOperationQueue ç®€ä»‹NSOperationã€NSOperationQueue æ˜¯è‹¹æœæä¾›ç»™æˆ‘ä»¬çš„ä¸€å¥—å¤šçº¿ç¨‹è§£å†³æ–¹æ¡ˆã€‚å®é™…ä¸Š NSOperationã€NSOperationQueue æ˜¯åŸºäº GCD æ›´é«˜ä¸€å±‚çš„å°è£…ï¼Œå®Œå…¨é¢å‘å¯¹è±¡ã€‚ä½†æ˜¯æ¯” GCD æ›´ç®€å•æ˜“ç”¨ã€ä»£ç å¯è¯»æ€§ä¹Ÿæ›´é«˜ã€‚ ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ NSOperationã€NSOperationQueueï¼Ÿ å¯æ·»åŠ å®Œæˆçš„ä»£ç å—ï¼Œåœ¨æ“ä½œå®Œæˆåæ‰§è¡Œã€‚ æ·»åŠ æ“ä½œä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œæ–¹ä¾¿çš„æ§åˆ¶æ‰§è¡Œé¡ºåºã€‚ è®¾å®šæ“ä½œæ‰§è¡Œçš„ä¼˜å…ˆçº§ã€‚ å¯ä»¥å¾ˆæ–¹ä¾¿çš„å–æ¶ˆä¸€ä¸ªæ“ä½œçš„æ‰§è¡Œã€‚ ä½¿ç”¨ KVO è§‚å¯Ÿå¯¹æ“ä½œæ‰§è¡ŒçŠ¶æ€çš„æ›´æ”¹ï¼šisExecuteingã€isFinishedã€isCancelledã€‚ 2. NSOperationã€NSOperationQueue æ“ä½œå’Œæ“ä½œé˜Ÿåˆ—æ—¢ç„¶æ˜¯åŸºäº GCD çš„æ›´é«˜ä¸€å±‚çš„å°è£…ã€‚é‚£ä¹ˆï¼ŒGCD ä¸­çš„ä¸€äº›æ¦‚å¿µåŒæ ·é€‚ç”¨äº NSOperationã€NSOperationQueueã€‚åœ¨ NSOperationã€NSOperationQueue ä¸­ä¹Ÿæœ‰ç±»ä¼¼çš„ä»»åŠ¡ï¼ˆæ“ä½œï¼‰å’Œé˜Ÿåˆ—ï¼ˆæ“ä½œé˜Ÿåˆ—ï¼‰çš„æ¦‚å¿µã€‚ æ“ä½œï¼ˆOperationï¼‰ï¼š æ‰§è¡Œæ“ä½œçš„æ„æ€ï¼Œæ¢å¥è¯è¯´å°±æ˜¯ä½ åœ¨çº¿ç¨‹ä¸­æ‰§è¡Œçš„é‚£æ®µä»£ç ã€‚ åœ¨ GCD ä¸­æ˜¯æ”¾åœ¨ block ä¸­çš„ã€‚åœ¨ NSOperation ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ NSOperation å­ç±» NSInvocationOperationã€NSBlockOperationï¼Œæˆ–è€…è‡ªå®šä¹‰å­ç±»æ¥å°è£…æ“ä½œã€‚æ“ä½œé˜Ÿåˆ—ï¼ˆOperation Queuesï¼‰ï¼š è¿™é‡Œçš„é˜Ÿåˆ—æŒ‡æ“ä½œé˜Ÿåˆ—ï¼Œå³ç”¨æ¥å­˜æ”¾æ“ä½œçš„é˜Ÿåˆ—ã€‚ä¸åŒäº GCD ä¸­çš„è°ƒåº¦é˜Ÿåˆ— FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰çš„åŸåˆ™ã€‚NSOperationQueue å¯¹äºæ·»åŠ åˆ°é˜Ÿåˆ—ä¸­çš„æ“ä½œï¼Œé¦–å…ˆè¿›å…¥å‡†å¤‡å°±ç»ªçš„çŠ¶æ€ï¼ˆå°±ç»ªçŠ¶æ€å–å†³äºæ“ä½œä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼‰ï¼Œç„¶åè¿›å…¥å°±ç»ªçŠ¶æ€çš„æ“ä½œçš„å¼€å§‹æ‰§è¡Œé¡ºåºï¼ˆéç»“æŸæ‰§è¡Œé¡ºåºï¼‰ç”±æ“ä½œä¹‹é—´ç›¸å¯¹çš„ä¼˜å…ˆçº§å†³å®šï¼ˆä¼˜å…ˆçº§æ˜¯æ“ä½œå¯¹è±¡è‡ªèº«çš„å±æ€§ï¼‰ã€‚ æ“ä½œé˜Ÿåˆ—é€šè¿‡è®¾ç½®æœ€å¤§å¹¶å‘æ“ä½œæ•°ï¼ˆmaxConcurrentOperationCountï¼‰æ¥æ§åˆ¶å¹¶å‘ã€ä¸²è¡Œã€‚ NSOperationQueue ä¸ºæˆ‘ä»¬æä¾›äº†ä¸¤ç§ä¸åŒç±»å‹çš„é˜Ÿåˆ—ï¼šä¸»é˜Ÿåˆ—å’Œè‡ªå®šä¹‰é˜Ÿåˆ—ã€‚ä¸»é˜Ÿåˆ—è¿è¡Œåœ¨ä¸»çº¿ç¨‹ä¹‹ä¸Šï¼Œè€Œè‡ªå®šä¹‰é˜Ÿåˆ—åœ¨åå°æ‰§è¡Œã€‚ 3. NSOperationã€NSOperationQueue ä½¿ç”¨æ­¥éª¤NSOperation éœ€è¦é…åˆ NSOperationQueue æ¥å®ç°å¤šçº¿ç¨‹ã€‚å› ä¸ºé»˜è®¤æƒ…å†µä¸‹ï¼ŒNSOperation å•ç‹¬ä½¿ç”¨æ—¶ç³»ç»ŸåŒæ­¥æ‰§è¡Œæ“ä½œï¼Œé…åˆ NSOperationQueue æˆ‘ä»¬èƒ½æ›´å¥½çš„å®ç°å¼‚æ­¥æ‰§è¡Œã€‚NSOperation å®ç°å¤šçº¿ç¨‹çš„ä½¿ç”¨æ­¥éª¤åˆ†ä¸ºä¸‰æ­¥ï¼š åˆ›å»ºæ“ä½œï¼šå…ˆå°†éœ€è¦æ‰§è¡Œçš„æ“ä½œå°è£…åˆ°ä¸€ä¸ª NSOperation å¯¹è±¡ä¸­ã€‚åˆ›å»ºé˜Ÿåˆ—ï¼šåˆ›å»º NSOperationQueue å¯¹è±¡ã€‚å°†æ“ä½œåŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ï¼šå°† NSOperation å¯¹è±¡æ·»åŠ åˆ° NSOperationQueue å¯¹è±¡ä¸­ã€‚ ä¹‹åå‘¢ï¼Œç³»ç»Ÿå°±ä¼šè‡ªåŠ¨å°† NSOperationQueue ä¸­çš„ NSOperation å–å‡ºæ¥ï¼Œåœ¨æ–°çº¿ç¨‹ä¸­æ‰§è¡Œæ“ä½œã€‚ä¸‹é¢æˆ‘ä»¬æ¥å­¦ä¹ ä¸‹ NSOperation å’Œ NSOperationQueue çš„åŸºæœ¬ä½¿ç”¨ã€‚ 4. NSOperation å’Œ NSOperationQueue åŸºæœ¬ä½¿ç”¨4.1 åˆ›å»ºæ“ä½œNSOperation æ˜¯ä¸ªæŠ½è±¡ç±»ï¼Œä¸èƒ½ç”¨æ¥å°è£…æ“ä½œã€‚æˆ‘ä»¬åªæœ‰ä½¿ç”¨å®ƒçš„å­ç±»æ¥å°è£…æ“ä½œã€‚æˆ‘ä»¬æœ‰ä¸‰ç§æ–¹å¼æ¥å°è£…æ“ä½œã€‚ ä½¿ç”¨å­ç±» NSInvocationOperationä½¿ç”¨å­ç±» NSBlockOperationè‡ªå®šä¹‰ç»§æ‰¿è‡ª NSOperation çš„å­ç±»ï¼Œé€šè¿‡å®ç°å†…éƒ¨ç›¸åº”çš„æ–¹æ³•æ¥å°è£…æ“ä½œã€‚ åœ¨ä¸ä½¿ç”¨ NSOperationQueueï¼Œå•ç‹¬ä½¿ç”¨ NSOperation çš„æƒ…å†µä¸‹ç³»ç»ŸåŒæ­¥æ‰§è¡Œæ“ä½œï¼Œä¸‹é¢æˆ‘ä»¬å­¦ä¹ ä»¥ä¸‹æ“ä½œçš„ä¸‰ç§åˆ›å»ºæ–¹å¼ã€‚ 4.1.1 ä½¿ç”¨å­ç±» NSInvocationOperation123456789101112131415161718192021&#x2F;** * ä½¿ç”¨å­ç±» NSInvocationOperation *&#x2F;- (void)useInvocationOperation &#123; &#x2F;&#x2F; 1.åˆ›å»º NSInvocationOperation å¯¹è±¡ NSInvocationOperation *op &#x3D; [[NSInvocationOperation alloc] initWithTarget:self selector:@selector(task1) object:nil]; &#x2F;&#x2F; 2.è°ƒç”¨ start æ–¹æ³•å¼€å§‹æ‰§è¡Œæ“ä½œ [op start];&#125;&#x2F;** * ä»»åŠ¡1 *&#x2F;- (void)task1 &#123; for (int i &#x3D; 0; i &lt; 2; i++) &#123; [NSThread sleepForTimeInterval:2]; &#x2F;&#x2F; æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ NSLog(@&quot;1---%@&quot;, [NSThread currentThread]); &#x2F;&#x2F; æ‰“å°å½“å‰çº¿ç¨‹ &#125;&#125; è¾“å‡ºç»“æœï¼š å¯ä»¥çœ‹åˆ°ï¼šåœ¨æ²¡æœ‰ä½¿ç”¨ NSOperationQueueã€åœ¨ä¸»çº¿ç¨‹ä¸­å•ç‹¬ä½¿ç”¨ä½¿ç”¨å­ç±» NSInvocationOperation æ‰§è¡Œä¸€ä¸ªæ“ä½œçš„æƒ…å†µä¸‹ï¼Œæ“ä½œæ˜¯åœ¨å½“å‰çº¿ç¨‹æ‰§è¡Œçš„ï¼Œå¹¶æ²¡æœ‰å¼€å¯æ–°çº¿ç¨‹ã€‚å¦‚æœåœ¨å…¶ä»–çº¿ç¨‹ä¸­æ‰§è¡Œæ“ä½œï¼Œåˆ™æ‰“å°ç»“æœä¸ºå…¶ä»–çº¿ç¨‹ã€‚12&#x2F;&#x2F; åœ¨å…¶ä»–çº¿ç¨‹ä½¿ç”¨å­ç±» NSInvocationOperation[NSThread detachNewThreadSelector:@selector(useInvocationOperation) toTarget:self withObject:nil]; è¾“å‡ºç»“æœï¼š å¯ä»¥çœ‹åˆ°ï¼šåœ¨å…¶ä»–çº¿ç¨‹ä¸­å•ç‹¬ä½¿ç”¨å­ç±» NSInvocationOperationï¼Œæ“ä½œæ˜¯åœ¨å½“å‰è°ƒç”¨çš„å…¶ä»–çº¿ç¨‹æ‰§è¡Œçš„ï¼Œå¹¶æ²¡æœ‰å¼€å¯æ–°çº¿ç¨‹ã€‚ ä¸‹è¾¹å†æ¥çœ‹çœ‹ NSBlockOperationã€‚ 4.1.2 ä½¿ç”¨å­ç±» NSBlockOperation12345678910111213141516&#x2F;** * ä½¿ç”¨å­ç±» NSBlockOperation *&#x2F;- (void)useBlockOperation &#123; &#x2F;&#x2F; 1.åˆ›å»º NSBlockOperation å¯¹è±¡ NSBlockOperation *op &#x3D; [NSBlockOperation blockOperationWithBlock:^&#123; for (int i &#x3D; 0; i &lt; 2; i++) &#123; [NSThread sleepForTimeInterval:2]; &#x2F;&#x2F; æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ NSLog(@&quot;1---%@&quot;, [NSThread currentThread]); &#x2F;&#x2F; æ‰“å°å½“å‰çº¿ç¨‹ &#125; &#125;]; &#x2F;&#x2F; 2.è°ƒç”¨ start æ–¹æ³•å¼€å§‹æ‰§è¡Œæ“ä½œ [op start];&#125; è¾“å‡ºç»“æœï¼š å¯ä»¥çœ‹åˆ°ï¼šåœ¨æ²¡æœ‰ä½¿ç”¨ NSOperationQueueã€åœ¨ä¸»çº¿ç¨‹ä¸­å•ç‹¬ä½¿ç”¨ NSBlockOperation æ‰§è¡Œä¸€ä¸ªæ“ä½œçš„æƒ…å†µä¸‹ï¼Œæ“ä½œæ˜¯åœ¨å½“å‰çº¿ç¨‹æ‰§è¡Œçš„ï¼Œå¹¶æ²¡æœ‰å¼€å¯æ–°çº¿ç¨‹ã€‚ æ³¨æ„ï¼šå’Œä¸Šè¾¹ NSInvocationOperation ä½¿ç”¨ä¸€æ ·ã€‚å› ä¸ºä»£ç æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­è°ƒç”¨çš„ï¼Œæ‰€ä»¥æ‰“å°ç»“æœä¸ºä¸»çº¿ç¨‹ã€‚å¦‚æœåœ¨å…¶ä»–çº¿ç¨‹ä¸­æ‰§è¡Œæ“ä½œï¼Œåˆ™æ‰“å°ç»“æœä¸ºå…¶ä»–çº¿ç¨‹ã€‚ ä½†æ˜¯ï¼ŒNSBlockOperation è¿˜æä¾›äº†ä¸€ä¸ªæ–¹æ³• addExecutionBlock:ï¼Œé€šè¿‡ addExecutionBlock: å°±å¯ä»¥ä¸º NSBlockOperation æ·»åŠ é¢å¤–çš„æ“ä½œã€‚è¿™äº›æ“ä½œï¼ˆåŒ…æ‹¬ blockOperationWithBlock ä¸­çš„æ“ä½œï¼‰å¯ä»¥åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­åŒæ—¶ï¼ˆå¹¶å‘ï¼‰æ‰§è¡Œã€‚åªæœ‰å½“æ‰€æœ‰ç›¸å…³çš„æ“ä½œå·²ç»å®Œæˆæ‰§è¡Œæ—¶ï¼Œæ‰è§†ä¸ºå®Œæˆã€‚å¦‚æœæ·»åŠ çš„æ“ä½œå¤šçš„è¯ï¼ŒblockOperationWithBlock: ä¸­çš„æ“ä½œä¹Ÿå¯èƒ½ä¼šåœ¨å…¶ä»–çº¿ç¨‹ï¼ˆéå½“å‰çº¿ç¨‹ï¼‰ä¸­æ‰§è¡Œï¼Œè¿™æ˜¯ç”±ç³»ç»Ÿå†³å®šçš„ï¼Œå¹¶ä¸æ˜¯è¯´æ·»åŠ åˆ° blockOperationWithBlock: ä¸­çš„æ“ä½œä¸€å®šä¼šåœ¨å½“å‰çº¿ç¨‹ä¸­æ‰§è¡Œã€‚ï¼ˆå¯ä»¥ä½¿ç”¨ addExecutionBlock: å¤šæ·»åŠ å‡ ä¸ªæ“ä½œè¯•è¯•ï¼‰ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061&#x2F;** * ä½¿ç”¨å­ç±» NSBlockOperation * è°ƒç”¨æ–¹æ³• AddExecutionBlock: *&#x2F;- (void)useBlockOperationAddExecutionBlock &#123; &#x2F;&#x2F; 1.åˆ›å»º NSBlockOperation å¯¹è±¡ NSBlockOperation *op &#x3D; [NSBlockOperation blockOperationWithBlock:^&#123; for (int i &#x3D; 0; i &lt; 2; i++) &#123; [NSThread sleepForTimeInterval:2]; &#x2F;&#x2F; æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ NSLog(@&quot;1---%@&quot;, [NSThread currentThread]); &#x2F;&#x2F; æ‰“å°å½“å‰çº¿ç¨‹ &#125; &#125;]; &#x2F;&#x2F; 2.æ·»åŠ é¢å¤–çš„æ“ä½œ [op addExecutionBlock:^&#123; for (int i &#x3D; 0; i &lt; 2; i++) &#123; [NSThread sleepForTimeInterval:2]; &#x2F;&#x2F; æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ NSLog(@&quot;2---%@&quot;, [NSThread currentThread]); &#x2F;&#x2F; æ‰“å°å½“å‰çº¿ç¨‹ &#125; &#125;]; [op addExecutionBlock:^&#123; for (int i &#x3D; 0; i &lt; 2; i++) &#123; [NSThread sleepForTimeInterval:2]; &#x2F;&#x2F; æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ NSLog(@&quot;3---%@&quot;, [NSThread currentThread]); &#x2F;&#x2F; æ‰“å°å½“å‰çº¿ç¨‹ &#125; &#125;]; [op addExecutionBlock:^&#123; for (int i &#x3D; 0; i &lt; 2; i++) &#123; [NSThread sleepForTimeInterval:2]; &#x2F;&#x2F; æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ NSLog(@&quot;4---%@&quot;, [NSThread currentThread]); &#x2F;&#x2F; æ‰“å°å½“å‰çº¿ç¨‹ &#125; &#125;]; [op addExecutionBlock:^&#123; for (int i &#x3D; 0; i &lt; 2; i++) &#123; [NSThread sleepForTimeInterval:2]; &#x2F;&#x2F; æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ NSLog(@&quot;5---%@&quot;, [NSThread currentThread]); &#x2F;&#x2F; æ‰“å°å½“å‰çº¿ç¨‹ &#125; &#125;]; [op addExecutionBlock:^&#123; for (int i &#x3D; 0; i &lt; 2; i++) &#123; [NSThread sleepForTimeInterval:2]; &#x2F;&#x2F; æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ NSLog(@&quot;6---%@&quot;, [NSThread currentThread]); &#x2F;&#x2F; æ‰“å°å½“å‰çº¿ç¨‹ &#125; &#125;]; [op addExecutionBlock:^&#123; for (int i &#x3D; 0; i &lt; 2; i++) &#123; [NSThread sleepForTimeInterval:2]; &#x2F;&#x2F; æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ NSLog(@&quot;7---%@&quot;, [NSThread currentThread]); &#x2F;&#x2F; æ‰“å°å½“å‰çº¿ç¨‹ &#125; &#125;]; [op addExecutionBlock:^&#123; for (int i &#x3D; 0; i &lt; 2; i++) &#123; [NSThread sleepForTimeInterval:2]; &#x2F;&#x2F; æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ NSLog(@&quot;8---%@&quot;, [NSThread currentThread]); &#x2F;&#x2F; æ‰“å°å½“å‰çº¿ç¨‹ &#125; &#125;]; &#x2F;&#x2F; 3.è°ƒç”¨ start æ–¹æ³•å¼€å§‹æ‰§è¡Œæ“ä½œ [op start];&#125; è¾“å‡ºç»“æœï¼š å¯ä»¥çœ‹å‡ºï¼šä½¿ç”¨å­ç±» NSBlockOperationï¼Œå¹¶è°ƒç”¨æ–¹æ³• AddExecutionBlock: çš„æƒ…å†µä¸‹ï¼ŒblockOperationWithBlock:æ–¹æ³•ä¸­çš„æ“ä½œ å’Œ addExecutionBlock: ä¸­çš„æ“ä½œæ˜¯åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­å¼‚æ­¥æ‰§è¡Œçš„ã€‚è€Œä¸”ï¼Œè¿™æ¬¡æ‰§è¡Œç»“æœä¸­ blockOperationWithBlock:æ–¹æ³•ä¸­çš„æ“ä½œä¹Ÿä¸æ˜¯åœ¨å½“å‰çº¿ç¨‹ï¼ˆä¸»çº¿ç¨‹ï¼‰ä¸­æ‰§è¡Œçš„ã€‚ä»è€Œå°è¯äº†blockOperationWithBlock: ä¸­çš„æ“ä½œä¹Ÿå¯èƒ½ä¼šåœ¨å…¶ä»–çº¿ç¨‹ï¼ˆéå½“å‰çº¿ç¨‹ï¼‰ä¸­æ‰§è¡Œã€‚ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¦‚æœä¸€ä¸ª NSBlockOperation å¯¹è±¡å°è£…äº†å¤šä¸ªæ“ä½œã€‚NSBlockOperation æ˜¯å¦å¼€å¯æ–°çº¿ç¨‹ï¼Œå–å†³äºæ“ä½œçš„ä¸ªæ•°ã€‚å¦‚æœæ·»åŠ çš„æ“ä½œçš„ä¸ªæ•°å¤šï¼Œå°±ä¼šè‡ªåŠ¨å¼€å¯æ–°çº¿ç¨‹ã€‚å½“ç„¶å¼€å¯çš„çº¿ç¨‹æ•°æ˜¯ç”±ç³»ç»Ÿæ¥å†³å®šçš„ã€‚ 4.1.3 ä½¿ç”¨è‡ªå®šä¹‰ç»§æ‰¿è‡ª NSOperation çš„å­ç±»å¦‚æœä½¿ç”¨å­ç±» NSInvocationOperationã€NSBlockOperation ä¸èƒ½æ»¡è¶³æ—¥å¸¸éœ€æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰ç»§æ‰¿è‡ª NSOperation çš„å­ç±»ã€‚å¯ä»¥é€šè¿‡é‡å†™ main æˆ–è€… start æ–¹æ³• æ¥å®šä¹‰è‡ªå·±çš„ NSOperation å¯¹è±¡ã€‚é‡å†™mainæ–¹æ³•æ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬ä¸éœ€è¦ç®¡ç†æ“ä½œçš„çŠ¶æ€å±æ€§ isExecuting å’Œ isFinishedã€‚å½“ main æ‰§è¡Œå®Œè¿”å›çš„æ—¶å€™ï¼Œè¿™ä¸ªæ“ä½œå°±ç»“æŸäº†ã€‚ å…ˆå®šä¹‰ä¸€ä¸ªç»§æ‰¿è‡ª NSOperation çš„å­ç±»ï¼Œé‡å†™mainæ–¹æ³•ã€‚ 12345678910111213141516171819202122&#x2F;&#x2F; YSCOperation.h æ–‡ä»¶#import &lt;Foundation&#x2F;Foundation.h&gt;@interface YSCOperation : NSOperation@end&#x2F;&#x2F; YSCOperation.m æ–‡ä»¶#import &quot;YSCOperation.h&quot;@implementation YSCOperation- (void)main &#123; if (!self.isCancelled) &#123; for (int i &#x3D; 0; i &lt; 2; i++) &#123; [NSThread sleepForTimeInterval:2]; NSLog(@&quot;1---%@&quot;, [NSThread currentThread]); &#125; &#125;&#125;@end ç„¶åä½¿ç”¨çš„æ—¶å€™å¯¼å…¥å¤´æ–‡ä»¶YSCOperation.hã€‚ 123456789&#x2F;** * ä½¿ç”¨è‡ªå®šä¹‰ç»§æ‰¿è‡ª NSOperation çš„å­ç±» *&#x2F;- (void)useCustomOperation &#123; &#x2F;&#x2F; 1.åˆ›å»º YSCOperation å¯¹è±¡ YSCOperation *op &#x3D; [[YSCOperation alloc] init]; &#x2F;&#x2F; 2.è°ƒç”¨ start æ–¹æ³•å¼€å§‹æ‰§è¡Œæ“ä½œ [op start];&#125; è¾“å‡ºç»“æœï¼š å¯ä»¥çœ‹å‡ºï¼šåœ¨æ²¡æœ‰ä½¿ç”¨ NSOperationQueueã€åœ¨ä¸»çº¿ç¨‹å•ç‹¬ä½¿ç”¨è‡ªå®šä¹‰ç»§æ‰¿è‡ª NSOperation çš„å­ç±»çš„æƒ…å†µä¸‹ï¼Œæ˜¯åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œæ“ä½œï¼Œå¹¶æ²¡æœ‰å¼€å¯æ–°çº¿ç¨‹ã€‚ ä¸‹è¾¹æˆ‘ä»¬æ¥è®²è®² NSOperationQueue çš„åˆ›å»ºã€‚ 4.2 åˆ›å»ºé˜Ÿåˆ—NSOperationQueue ä¸€å…±æœ‰ä¸¤ç§é˜Ÿåˆ—ï¼šä¸»é˜Ÿåˆ—ã€è‡ªå®šä¹‰é˜Ÿåˆ—ã€‚å…¶ä¸­è‡ªå®šä¹‰é˜Ÿåˆ—åŒæ—¶åŒ…å«äº†ä¸²è¡Œã€å¹¶å‘åŠŸèƒ½ã€‚ä¸‹è¾¹æ˜¯ä¸»é˜Ÿåˆ—ã€è‡ªå®šä¹‰é˜Ÿåˆ—çš„åŸºæœ¬åˆ›å»ºæ–¹æ³•å’Œç‰¹ç‚¹ã€‚ ä¸»é˜Ÿåˆ— å‡¡æ˜¯æ·»åŠ åˆ°ä¸»é˜Ÿåˆ—ä¸­çš„æ“ä½œï¼Œéƒ½ä¼šæ”¾åˆ°ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œï¼ˆæ³¨ï¼šä¸åŒ…æ‹¬æ“ä½œä½¿ç”¨addExecutionBlock:æ·»åŠ çš„é¢å¤–æ“ä½œï¼Œé¢å¤–æ“ä½œå¯èƒ½åœ¨å…¶ä»–çº¿ç¨‹æ‰§è¡Œï¼Œæ„Ÿè°¢æŒ‡æ­£ï¼‰ã€‚12 &#x2F;&#x2F; ä¸»é˜Ÿåˆ—è·å–æ–¹æ³•NSOperationQueue *queue &#x3D; [NSOperationQueue mainQueue]; è‡ªå®šä¹‰é˜Ÿåˆ—ï¼ˆéä¸»é˜Ÿåˆ—ï¼‰ æ·»åŠ åˆ°è¿™ç§é˜Ÿåˆ—ä¸­çš„æ“ä½œï¼Œå°±ä¼šè‡ªåŠ¨æ”¾åˆ°å­çº¿ç¨‹ä¸­æ‰§è¡Œã€‚ åŒæ—¶åŒ…å«äº†ï¼šä¸²è¡Œã€å¹¶å‘åŠŸèƒ½ã€‚12&#x2F;&#x2F; è‡ªå®šä¹‰é˜Ÿåˆ—åˆ›å»ºæ–¹æ³•NSOperationQueue *queue &#x3D; [[NSOperationQueue alloc] init]; 4.3 å°†æ“ä½œåŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ä¸Šè¾¹æˆ‘ä»¬è¯´åˆ° NSOperation éœ€è¦é…åˆ NSOperationQueue æ¥å®ç°å¤šçº¿ç¨‹ã€‚ é‚£ä¹ˆæˆ‘ä»¬éœ€è¦å°†åˆ›å»ºå¥½çš„æ“ä½œåŠ å…¥åˆ°é˜Ÿåˆ—ä¸­å»ã€‚æ€»å…±æœ‰ä¸¤ç§æ–¹æ³•ï¼š 1.- (void)addOperation:(NSOperation *)op; éœ€è¦å…ˆåˆ›å»ºæ“ä½œï¼Œå†å°†åˆ›å»ºå¥½çš„æ“ä½œåŠ å…¥åˆ°åˆ›å»ºå¥½çš„é˜Ÿåˆ—ä¸­å»ã€‚12345678910111213141516171819202122232425262728293031323334&#x2F;** * ä½¿ç”¨ addOperation: å°†æ“ä½œåŠ å…¥åˆ°æ“ä½œé˜Ÿåˆ—ä¸­ *&#x2F;- (void)addOperationToQueue &#123; &#x2F;&#x2F; 1.åˆ›å»ºé˜Ÿåˆ— NSOperationQueue *queue &#x3D; [[NSOperationQueue alloc] init]; &#x2F;&#x2F; 2.åˆ›å»ºæ“ä½œ &#x2F;&#x2F; ä½¿ç”¨ NSInvocationOperation åˆ›å»ºæ“ä½œ1 NSInvocationOperation *op1 &#x3D; [[NSInvocationOperation alloc] initWithTarget:self selector:@selector(task1) object:nil]; &#x2F;&#x2F; ä½¿ç”¨ NSInvocationOperation åˆ›å»ºæ“ä½œ2 NSInvocationOperation *op2 &#x3D; [[NSInvocationOperation alloc] initWithTarget:self selector:@selector(task2) object:nil]; &#x2F;&#x2F; ä½¿ç”¨ NSBlockOperation åˆ›å»ºæ“ä½œ3 NSBlockOperation *op3 &#x3D; [NSBlockOperation blockOperationWithBlock:^&#123; for (int i &#x3D; 0; i &lt; 2; i++) &#123; [NSThread sleepForTimeInterval:2]; &#x2F;&#x2F; æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ NSLog(@&quot;3---%@&quot;, [NSThread currentThread]); &#x2F;&#x2F; æ‰“å°å½“å‰çº¿ç¨‹ &#125; &#125;]; [op3 addExecutionBlock:^&#123; for (int i &#x3D; 0; i &lt; 2; i++) &#123; [NSThread sleepForTimeInterval:2]; &#x2F;&#x2F; æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ NSLog(@&quot;4---%@&quot;, [NSThread currentThread]); &#x2F;&#x2F; æ‰“å°å½“å‰çº¿ç¨‹ &#125; &#125;]; &#x2F;&#x2F; 3.ä½¿ç”¨ addOperation: æ·»åŠ æ‰€æœ‰æ“ä½œåˆ°é˜Ÿåˆ—ä¸­ [queue addOperation:op1]; &#x2F;&#x2F; [op1 start] [queue addOperation:op2]; &#x2F;&#x2F; [op2 start] [queue addOperation:op3]; &#x2F;&#x2F; [op3 start]&#125; è¾“å‡ºç»“æœï¼š å¯ä»¥çœ‹å‡ºï¼šä½¿ç”¨ NSOperation å­ç±»åˆ›å»ºæ“ä½œï¼Œå¹¶ä½¿ç”¨ addOperation: å°†æ“ä½œåŠ å…¥åˆ°æ“ä½œé˜Ÿåˆ—åèƒ½å¤Ÿå¼€å¯æ–°çº¿ç¨‹ï¼Œè¿›è¡Œå¹¶å‘æ‰§è¡Œ. 2.- (void)addOperationWithBlock:(void (^)(void))block; - æ— éœ€å…ˆåˆ›å»ºæ“ä½œï¼Œåœ¨ block ä¸­æ·»åŠ æ“ä½œï¼Œç›´æ¥å°†åŒ…å«æ“ä½œçš„ block åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ã€‚ 12345678910111213141516171819202122232425262728&#x2F;** * ä½¿ç”¨ addOperationWithBlock: å°†æ“ä½œåŠ å…¥åˆ°æ“ä½œé˜Ÿåˆ—ä¸­ *&#x2F;- (void)addOperationWithBlockToQueue &#123; &#x2F;&#x2F; 1.åˆ›å»ºé˜Ÿåˆ— NSOperationQueue *queue &#x3D; [[NSOperationQueue alloc] init]; &#x2F;&#x2F; 2.ä½¿ç”¨ addOperationWithBlock: æ·»åŠ æ“ä½œåˆ°é˜Ÿåˆ—ä¸­ [queue addOperationWithBlock:^&#123; for (int i &#x3D; 0; i &lt; 2; i++) &#123; [NSThread sleepForTimeInterval:2]; &#x2F;&#x2F; æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ NSLog(@&quot;1---%@&quot;, [NSThread currentThread]); &#x2F;&#x2F; æ‰“å°å½“å‰çº¿ç¨‹ &#125; &#125;]; [queue addOperationWithBlock:^&#123; for (int i &#x3D; 0; i &lt; 2; i++) &#123; [NSThread sleepForTimeInterval:2]; &#x2F;&#x2F; æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ NSLog(@&quot;2---%@&quot;, [NSThread currentThread]); &#x2F;&#x2F; æ‰“å°å½“å‰çº¿ç¨‹ &#125; &#125;]; [queue addOperationWithBlock:^&#123; for (int i &#x3D; 0; i &lt; 2; i++) &#123; [NSThread sleepForTimeInterval:2]; &#x2F;&#x2F; æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ NSLog(@&quot;3---%@&quot;, [NSThread currentThread]); &#x2F;&#x2F; æ‰“å°å½“å‰çº¿ç¨‹ &#125; &#125;];&#125; è¾“å‡ºç»“æœï¼š å¯ä»¥çœ‹å‡ºï¼šä½¿ç”¨ addOperationWithBlock: å°†æ“ä½œåŠ å…¥åˆ°æ“ä½œé˜Ÿåˆ—åèƒ½å¤Ÿå¼€å¯æ–°çº¿ç¨‹ï¼Œè¿›è¡Œå¹¶å‘æ‰§è¡Œã€‚ 5. NSOperationQueue æ§åˆ¶ä¸²è¡Œæ‰§è¡Œã€å¹¶å‘æ‰§è¡Œä¹‹å‰æˆ‘ä»¬è¯´è¿‡ï¼ŒNSOperationQueue åˆ›å»ºçš„è‡ªå®šä¹‰é˜Ÿåˆ—åŒæ—¶å…·æœ‰ä¸²è¡Œã€å¹¶å‘åŠŸèƒ½ï¼Œä¸Šè¾¹æˆ‘ä»¬æ¼”ç¤ºäº†å¹¶å‘åŠŸèƒ½ï¼Œé‚£ä¹ˆä»–çš„ä¸²è¡ŒåŠŸèƒ½æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ è¿™é‡Œæœ‰ä¸ªå…³é”®å±æ€§ maxConcurrentOperationCountï¼Œå«åšæœ€å¤§å¹¶å‘æ“ä½œæ•°ã€‚ç”¨æ¥æ§åˆ¶ä¸€ä¸ªç‰¹å®šé˜Ÿåˆ—ä¸­å¯ä»¥æœ‰å¤šå°‘ä¸ªæ“ä½œåŒæ—¶å‚ä¸å¹¶å‘æ‰§è¡Œã€‚ æ³¨æ„ï¼šè¿™é‡Œ maxConcurrentOperationCount æ§åˆ¶çš„ä¸æ˜¯å¹¶å‘çº¿ç¨‹çš„æ•°é‡ï¼Œè€Œæ˜¯ä¸€ä¸ªé˜Ÿåˆ—ä¸­åŒæ—¶èƒ½å¹¶å‘æ‰§è¡Œçš„æœ€å¤§æ“ä½œæ•°ã€‚è€Œä¸”ä¸€ä¸ªæ“ä½œä¹Ÿå¹¶éåªèƒ½åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­è¿è¡Œã€‚ æœ€å¤§å¹¶å‘æ“ä½œæ•°ï¼šmaxConcurrentOperationCount maxConcurrentOperationCount é»˜è®¤æƒ…å†µä¸‹ä¸º-1ï¼Œè¡¨ç¤ºä¸è¿›è¡Œé™åˆ¶ï¼Œå¯è¿›è¡Œå¹¶å‘æ‰§è¡Œã€‚ maxConcurrentOperationCount ä¸º1æ—¶ï¼Œé˜Ÿåˆ—ä¸ºä¸²è¡Œé˜Ÿåˆ—ã€‚åªèƒ½ä¸²è¡Œæ‰§è¡Œã€‚ maxConcurrentOperationCount å¤§äº1æ—¶ï¼Œé˜Ÿåˆ—ä¸ºå¹¶å‘é˜Ÿåˆ—ã€‚æ“ä½œå¹¶å‘æ‰§è¡Œï¼Œå½“ç„¶è¿™ä¸ªå€¼ä¸åº”è¶…è¿‡ç³»ç»Ÿé™åˆ¶ï¼Œå³ä½¿è‡ªå·±è®¾ç½®ä¸€ä¸ªå¾ˆå¤§çš„å€¼ï¼Œç³»ç»Ÿä¹Ÿä¼šè‡ªåŠ¨è°ƒæ•´ä¸º min{è‡ªå·±è®¾å®šçš„å€¼ï¼Œç³»ç»Ÿè®¾å®šçš„é»˜è®¤æœ€å¤§å€¼}ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839&#x2F;** * è®¾ç½® MaxConcurrentOperationCountï¼ˆæœ€å¤§å¹¶å‘æ“ä½œæ•°ï¼‰ *&#x2F;- (void)setMaxConcurrentOperationCount &#123; &#x2F;&#x2F; 1.åˆ›å»ºé˜Ÿåˆ— NSOperationQueue *queue &#x3D; [[NSOperationQueue alloc] init]; &#x2F;&#x2F; 2.è®¾ç½®æœ€å¤§å¹¶å‘æ“ä½œæ•° queue.maxConcurrentOperationCount &#x3D; 1; &#x2F;&#x2F; ä¸²è¡Œé˜Ÿåˆ—&#x2F;&#x2F; queue.maxConcurrentOperationCount &#x3D; 2; &#x2F;&#x2F; å¹¶å‘é˜Ÿåˆ—&#x2F;&#x2F; queue.maxConcurrentOperationCount &#x3D; 8; &#x2F;&#x2F; å¹¶å‘é˜Ÿåˆ— &#x2F;&#x2F; 3.æ·»åŠ æ“ä½œ [queue addOperationWithBlock:^&#123; for (int i &#x3D; 0; i &lt; 2; i++) &#123; [NSThread sleepForTimeInterval:2]; &#x2F;&#x2F; æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ NSLog(@&quot;1---%@&quot;, [NSThread currentThread]); &#x2F;&#x2F; æ‰“å°å½“å‰çº¿ç¨‹ &#125; &#125;]; [queue addOperationWithBlock:^&#123; for (int i &#x3D; 0; i &lt; 2; i++) &#123; [NSThread sleepForTimeInterval:2]; &#x2F;&#x2F; æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ NSLog(@&quot;2---%@&quot;, [NSThread currentThread]); &#x2F;&#x2F; æ‰“å°å½“å‰çº¿ç¨‹ &#125; &#125;]; [queue addOperationWithBlock:^&#123; for (int i &#x3D; 0; i &lt; 2; i++) &#123; [NSThread sleepForTimeInterval:2]; &#x2F;&#x2F; æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ NSLog(@&quot;3---%@&quot;, [NSThread currentThread]); &#x2F;&#x2F; æ‰“å°å½“å‰çº¿ç¨‹ &#125; &#125;]; [queue addOperationWithBlock:^&#123; for (int i &#x3D; 0; i &lt; 2; i++) &#123; [NSThread sleepForTimeInterval:2]; &#x2F;&#x2F; æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ NSLog(@&quot;4---%@&quot;, [NSThread currentThread]); &#x2F;&#x2F; æ‰“å°å½“å‰çº¿ç¨‹ &#125; &#125;];&#125; æœ€å¤§å¹¶å‘æ“ä½œæ•°ä¸º1 è¾“å‡ºç»“æœï¼š æœ€å¤§å¹¶å‘æ“ä½œæ•°ä¸º2 è¾“å‡ºç»“æœï¼š å¯ä»¥çœ‹å‡ºï¼šå½“æœ€å¤§å¹¶å‘æ“ä½œæ•°ä¸º1æ—¶ï¼Œæ“ä½œæ˜¯æŒ‰é¡ºåºä¸²è¡Œæ‰§è¡Œçš„ï¼Œå¹¶ä¸”ä¸€ä¸ªæ“ä½œå®Œæˆä¹‹åï¼Œä¸‹ä¸€ä¸ªæ“ä½œæ‰å¼€å§‹æ‰§è¡Œã€‚å½“æœ€å¤§æ“ä½œå¹¶å‘æ•°ä¸º2æ—¶ï¼Œæ“ä½œæ˜¯å¹¶å‘æ‰§è¡Œçš„ï¼Œå¯ä»¥åŒæ—¶æ‰§è¡Œä¸¤ä¸ªæ“ä½œã€‚è€Œå¼€å¯çº¿ç¨‹æ•°é‡æ˜¯ç”±ç³»ç»Ÿå†³å®šçš„ï¼Œä¸éœ€è¦æˆ‘ä»¬æ¥ç®¡ç†ã€‚ è¿™æ ·çœ‹æ¥ï¼Œæ˜¯ä¸æ˜¯æ¯” GCD è¿˜è¦ç®€å•äº†è®¸å¤šï¼Ÿ 6. NSOperation æ“ä½œä¾èµ–NSOperationã€NSOperationQueue æœ€å¸å¼•äººçš„åœ°æ–¹æ˜¯å®ƒèƒ½æ·»åŠ æ“ä½œä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚é€šè¿‡æ“ä½œä¾èµ–ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿çš„æ§åˆ¶æ“ä½œä¹‹é—´çš„æ‰§è¡Œå…ˆåé¡ºåºã€‚NSOperation æä¾›äº†3ä¸ªæ¥å£ä¾›æˆ‘ä»¬ç®¡ç†å’ŒæŸ¥çœ‹ä¾èµ–ã€‚ (void)addDependency:(NSOperation *)op; æ·»åŠ ä¾èµ–ï¼Œä½¿å½“å‰æ“ä½œä¾èµ–äºæ“ä½œ op çš„å®Œæˆã€‚ (void)removeDependency:(NSOperation *)op; ç§»é™¤ä¾èµ–ï¼Œå–æ¶ˆå½“å‰æ“ä½œå¯¹æ“ä½œ op çš„ä¾èµ–ã€‚ @property (readonly, copy) NSArray&lt;NSOperation *&gt; *dependencies; åœ¨å½“å‰æ“ä½œå¼€å§‹æ‰§è¡Œä¹‹å‰å®Œæˆæ‰§è¡Œçš„æ‰€æœ‰æ“ä½œå¯¹è±¡æ•°ç»„ã€‚ å½“ç„¶ï¼Œæˆ‘ä»¬ç»å¸¸ç”¨åˆ°çš„è¿˜æ˜¯æ·»åŠ ä¾èµ–æ“ä½œã€‚ç°åœ¨è€ƒè™‘è¿™æ ·çš„éœ€æ±‚ï¼Œæ¯”å¦‚è¯´æœ‰ Aã€B ä¸¤ä¸ªæ“ä½œï¼Œå…¶ä¸­ A æ‰§è¡Œå®Œæ“ä½œï¼ŒB æ‰èƒ½æ‰§è¡Œæ“ä½œã€‚ å¦‚æœä½¿ç”¨ä¾èµ–æ¥å¤„ç†çš„è¯ï¼Œé‚£ä¹ˆå°±éœ€è¦è®©æ“ä½œ B ä¾èµ–äºæ“ä½œ Aã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930&#x2F;** * æ“ä½œä¾èµ– * ä½¿ç”¨æ–¹æ³•ï¼šaddDependency: *&#x2F;- (void)addDependency &#123; &#x2F;&#x2F; 1.åˆ›å»ºé˜Ÿåˆ— NSOperationQueue *queue &#x3D; [[NSOperationQueue alloc] init]; &#x2F;&#x2F; 2.åˆ›å»ºæ“ä½œ NSBlockOperation *op1 &#x3D; [NSBlockOperation blockOperationWithBlock:^&#123; for (int i &#x3D; 0; i &lt; 2; i++) &#123; [NSThread sleepForTimeInterval:2]; &#x2F;&#x2F; æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ NSLog(@&quot;1---%@&quot;, [NSThread currentThread]); &#x2F;&#x2F; æ‰“å°å½“å‰çº¿ç¨‹ &#125; &#125;]; NSBlockOperation *op2 &#x3D; [NSBlockOperation blockOperationWithBlock:^&#123; for (int i &#x3D; 0; i &lt; 2; i++) &#123; [NSThread sleepForTimeInterval:2]; &#x2F;&#x2F; æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ NSLog(@&quot;2---%@&quot;, [NSThread currentThread]); &#x2F;&#x2F; æ‰“å°å½“å‰çº¿ç¨‹ &#125; &#125;]; &#x2F;&#x2F; 3.æ·»åŠ ä¾èµ– [op2 addDependency:op1]; &#x2F;&#x2F; è®©op2 ä¾èµ–äº op1ï¼Œåˆ™å…ˆæ‰§è¡Œop1ï¼Œåœ¨æ‰§è¡Œop2 &#x2F;&#x2F; 4.æ·»åŠ æ“ä½œåˆ°é˜Ÿåˆ—ä¸­ [queue addOperation:op1]; [queue addOperation:op2];&#125; è¾“å‡ºç»“æœï¼š å¯ä»¥çœ‹åˆ°ï¼šé€šè¿‡æ·»åŠ æ“ä½œä¾èµ–ï¼Œæ— è®ºè¿è¡Œå‡ æ¬¡ï¼Œå…¶ç»“æœéƒ½æ˜¯ op1 å…ˆæ‰§è¡Œï¼Œop2 åæ‰§è¡Œã€‚ 7. NSOperation ä¼˜å…ˆçº§NSOperation æä¾›äº†queuePriorityï¼ˆä¼˜å…ˆçº§ï¼‰å±æ€§ï¼ŒqueuePriorityå±æ€§é€‚ç”¨äºåŒä¸€æ“ä½œé˜Ÿåˆ—ä¸­çš„æ“ä½œï¼Œä¸é€‚ç”¨äºä¸åŒæ“ä½œé˜Ÿåˆ—ä¸­çš„æ“ä½œã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰æ–°åˆ›å»ºçš„æ“ä½œå¯¹è±¡ä¼˜å…ˆçº§éƒ½æ˜¯NSOperationQueuePriorityNormalã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡setQueuePriority:æ–¹æ³•æ¥æ”¹å˜å½“å‰æ“ä½œåœ¨åŒä¸€é˜Ÿåˆ—ä¸­çš„æ‰§è¡Œä¼˜å…ˆçº§ã€‚ 12345678&#x2F;&#x2F; ä¼˜å…ˆçº§çš„å–å€¼typedef NS_ENUM(NSInteger, NSOperationQueuePriority) &#123; NSOperationQueuePriorityVeryLow &#x3D; -8L, NSOperationQueuePriorityLow &#x3D; -4L, NSOperationQueuePriorityNormal &#x3D; 0, NSOperationQueuePriorityHigh &#x3D; 4, NSOperationQueuePriorityVeryHigh &#x3D; 8&#125;; ä¸Šè¾¹æˆ‘ä»¬è¯´è¿‡ï¼šå¯¹äºæ·»åŠ åˆ°é˜Ÿåˆ—ä¸­çš„æ“ä½œï¼Œé¦–å…ˆè¿›å…¥å‡†å¤‡å°±ç»ªçš„çŠ¶æ€ï¼ˆå°±ç»ªçŠ¶æ€å–å†³äºæ“ä½œä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼‰ï¼Œç„¶åè¿›å…¥å°±ç»ªçŠ¶æ€çš„æ“ä½œçš„å¼€å§‹æ‰§è¡Œé¡ºåºï¼ˆéç»“æŸæ‰§è¡Œé¡ºåºï¼‰ç”±æ“ä½œä¹‹é—´ç›¸å¯¹çš„ä¼˜å…ˆçº§å†³å®šï¼ˆä¼˜å…ˆçº§æ˜¯æ“ä½œå¯¹è±¡è‡ªèº«çš„å±æ€§ï¼‰ã€‚ é‚£ä¹ˆï¼Œä»€ä¹ˆæ ·çš„æ“ä½œæ‰æ˜¯è¿›å…¥å°±ç»ªçŠ¶æ€çš„æ“ä½œå‘¢ï¼Ÿ å½“ä¸€ä¸ªæ“ä½œçš„æ‰€æœ‰ä¾èµ–éƒ½å·²ç»å®Œæˆæ—¶ï¼Œæ“ä½œå¯¹è±¡é€šå¸¸ä¼šè¿›å…¥å‡†å¤‡å°±ç»ªçŠ¶æ€ï¼Œç­‰å¾…æ‰§è¡Œã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œç°åœ¨æœ‰4ä¸ªä¼˜å…ˆçº§éƒ½æ˜¯ NSOperationQueuePriorityNormalï¼ˆé»˜è®¤çº§åˆ«ï¼‰çš„æ“ä½œï¼šop1ï¼Œop2ï¼Œop3ï¼Œop4ã€‚å…¶ä¸­ op3 ä¾èµ–äº op2ï¼Œop2 ä¾èµ–äº op1ï¼Œå³ op3 -&gt; op2 -&gt; op1ã€‚ç°åœ¨å°†è¿™4ä¸ªæ“ä½œæ·»åŠ åˆ°é˜Ÿåˆ—ä¸­å¹¶å‘æ‰§è¡Œã€‚ å› ä¸º op1 å’Œ op4 éƒ½æ²¡æœ‰éœ€è¦ä¾èµ–çš„æ“ä½œï¼Œæ‰€ä»¥åœ¨ op1ï¼Œop4 æ‰§è¡Œä¹‹å‰ï¼Œå°±æ˜¯å¤„äºå‡†å¤‡å°±ç»ªçŠ¶æ€çš„æ“ä½œã€‚ è€Œ op3 å’Œ op2 éƒ½æœ‰ä¾èµ–çš„æ“ä½œï¼ˆop3 ä¾èµ–äº op2ï¼Œop2 ä¾èµ–äº op1ï¼‰ï¼Œæ‰€ä»¥ op3 å’Œ op2 éƒ½ä¸æ˜¯å‡†å¤‡å°±ç»ªçŠ¶æ€ä¸‹çš„æ“ä½œã€‚ ç†è§£äº†è¿›å…¥å°±ç»ªçŠ¶æ€çš„æ“ä½œï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ç†è§£äº†queuePriority å±æ€§çš„ä½œç”¨å¯¹è±¡ã€‚ queuePriority å±æ€§å†³å®šäº†è¿›å…¥å‡†å¤‡å°±ç»ªçŠ¶æ€ä¸‹çš„æ“ä½œä¹‹é—´çš„å¼€å§‹æ‰§è¡Œé¡ºåºã€‚å¹¶ä¸”ï¼Œä¼˜å…ˆçº§ä¸èƒ½å–ä»£ä¾èµ–å…³ç³»ã€‚ å¦‚æœä¸€ä¸ªé˜Ÿåˆ—ä¸­æ—¢åŒ…å«é«˜ä¼˜å…ˆçº§æ“ä½œï¼ŒåˆåŒ…å«ä½ä¼˜å…ˆçº§æ“ä½œï¼Œå¹¶ä¸”ä¸¤ä¸ªæ“ä½œéƒ½å·²ç»å‡†å¤‡å°±ç»ªï¼Œé‚£ä¹ˆé˜Ÿåˆ—å…ˆæ‰§è¡Œé«˜ä¼˜å…ˆçº§æ“ä½œã€‚æ¯”å¦‚ä¸Šä¾‹ä¸­ï¼Œå¦‚æœ op1 å’Œ op4 æ˜¯ä¸åŒä¼˜å…ˆçº§çš„æ“ä½œï¼Œé‚£ä¹ˆå°±ä¼šå…ˆæ‰§è¡Œä¼˜å…ˆçº§é«˜çš„æ“ä½œã€‚ å¦‚æœï¼Œä¸€ä¸ªé˜Ÿåˆ—ä¸­æ—¢åŒ…å«äº†å‡†å¤‡å°±ç»ªçŠ¶æ€çš„æ“ä½œï¼ŒåˆåŒ…å«äº†æœªå‡†å¤‡å°±ç»ªçš„æ“ä½œï¼Œæœªå‡†å¤‡å°±ç»ªçš„æ“ä½œä¼˜å…ˆçº§æ¯”å‡†å¤‡å°±ç»ªçš„æ“ä½œä¼˜å…ˆçº§é«˜ã€‚é‚£ä¹ˆï¼Œè™½ç„¶å‡†å¤‡å°±ç»ªçš„æ“ä½œä¼˜å…ˆçº§ä½ï¼Œä¹Ÿä¼šä¼˜å…ˆæ‰§è¡Œã€‚ä¼˜å…ˆçº§ä¸èƒ½å–ä»£ä¾èµ–å…³ç³»ã€‚å¦‚æœè¦æ§åˆ¶æ“ä½œé—´çš„å¯åŠ¨é¡ºåºï¼Œåˆ™å¿…é¡»ä½¿ç”¨ä¾èµ–å…³ç³»ã€‚ 8. NSOperationã€NSOperationQueue çº¿ç¨‹é—´çš„é€šä¿¡åœ¨ iOS å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬åœ¨ä¸»çº¿ç¨‹é‡Œè¾¹è¿›è¡Œ UI åˆ·æ–°ï¼Œä¾‹å¦‚ï¼šç‚¹å‡»ã€æ»šåŠ¨ã€æ‹–æ‹½ç­‰äº‹ä»¶ã€‚æˆ‘ä»¬é€šå¸¸æŠŠä¸€äº›è€—æ—¶çš„æ“ä½œæ”¾åœ¨å…¶ä»–çº¿ç¨‹ï¼Œæ¯”å¦‚è¯´å›¾ç‰‡ä¸‹è½½ã€æ–‡ä»¶ä¸Šä¼ ç­‰è€—æ—¶æ“ä½œã€‚è€Œå½“æˆ‘ä»¬æœ‰æ—¶å€™åœ¨å…¶ä»–çº¿ç¨‹å®Œæˆäº†è€—æ—¶æ“ä½œæ—¶ï¼Œéœ€è¦å›åˆ°ä¸»çº¿ç¨‹ï¼Œé‚£ä¹ˆå°±ç”¨åˆ°äº†çº¿ç¨‹ä¹‹é—´çš„é€šè®¯ã€‚ 1234567891011121314151617181920212223242526&#x2F;** * çº¿ç¨‹é—´é€šä¿¡ *&#x2F;- (void)communication &#123; &#x2F;&#x2F; 1.åˆ›å»ºé˜Ÿåˆ— NSOperationQueue *queue &#x3D; [[NSOperationQueue alloc]init]; &#x2F;&#x2F; 2.æ·»åŠ æ“ä½œ [queue addOperationWithBlock:^&#123; &#x2F;&#x2F; å¼‚æ­¥è¿›è¡Œè€—æ—¶æ“ä½œ for (int i &#x3D; 0; i &lt; 2; i++) &#123; [NSThread sleepForTimeInterval:2]; &#x2F;&#x2F; æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ NSLog(@&quot;1---%@&quot;, [NSThread currentThread]); &#x2F;&#x2F; æ‰“å°å½“å‰çº¿ç¨‹ &#125; &#x2F;&#x2F; å›åˆ°ä¸»çº¿ç¨‹ [[NSOperationQueue mainQueue] addOperationWithBlock:^&#123; &#x2F;&#x2F; è¿›è¡Œä¸€äº› UI åˆ·æ–°ç­‰æ“ä½œ for (int i &#x3D; 0; i &lt; 2; i++) &#123; [NSThread sleepForTimeInterval:2]; &#x2F;&#x2F; æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ NSLog(@&quot;2---%@&quot;, [NSThread currentThread]); &#x2F;&#x2F; æ‰“å°å½“å‰çº¿ç¨‹ &#125; &#125;]; &#125;];&#125; è¾“å‡ºç»“æœï¼š å¯ä»¥çœ‹åˆ°ï¼šé€šè¿‡çº¿ç¨‹é—´çš„é€šä¿¡ï¼Œå…ˆåœ¨å…¶ä»–çº¿ç¨‹ä¸­æ‰§è¡Œæ“ä½œï¼Œç­‰æ“ä½œæ‰§è¡Œå®Œäº†ä¹‹åå†å›åˆ°ä¸»çº¿ç¨‹æ‰§è¡Œä¸»çº¿ç¨‹çš„ç›¸åº”æ“ä½œã€‚ 9. NSOperationã€NSOperationQueue çº¿ç¨‹åŒæ­¥å’Œçº¿ç¨‹å®‰å…¨çº¿ç¨‹å®‰å…¨å¦‚æœä½ çš„ä»£ç æ‰€åœ¨çš„è¿›ç¨‹ä¸­æœ‰å¤šä¸ªçº¿ç¨‹åœ¨åŒæ—¶è¿è¡Œï¼Œè€Œè¿™äº›çº¿ç¨‹å¯èƒ½ä¼šåŒæ—¶è¿è¡Œè¿™æ®µä»£ç ã€‚å¦‚æœæ¯æ¬¡è¿è¡Œç»“æœå’Œå•çº¿ç¨‹è¿è¡Œçš„ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œè€Œä¸”å…¶ä»–çš„å˜é‡çš„å€¼ä¹Ÿå’Œé¢„æœŸçš„æ˜¯ä¸€æ ·çš„ï¼Œå°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚è‹¥æ¯ä¸ªçº¿ç¨‹ä¸­å¯¹å…¨å±€å˜é‡ã€é™æ€å˜é‡åªæœ‰è¯»æ“ä½œï¼Œè€Œæ— å†™æ“ä½œï¼Œä¸€èˆ¬æ¥è¯´ï¼Œè¿™ä¸ªå…¨å±€å˜é‡æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼›è‹¥æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œå†™æ“ä½œï¼ˆæ›´æ”¹å˜é‡ï¼‰ï¼Œä¸€èˆ¬éƒ½éœ€è¦è€ƒè™‘çº¿ç¨‹åŒæ­¥ï¼Œå¦åˆ™çš„è¯å°±å¯èƒ½å½±å“çº¿ç¨‹å®‰å…¨ã€‚ çº¿ç¨‹åŒæ­¥å¯ç†è§£ä¸ºçº¿ç¨‹ A å’Œ çº¿ç¨‹ B ä¸€å—é…åˆï¼ŒA æ‰§è¡Œåˆ°ä¸€å®šç¨‹åº¦æ—¶è¦ä¾é çº¿ç¨‹ B çš„æŸä¸ªç»“æœï¼Œäºæ˜¯åœä¸‹æ¥ï¼Œç¤ºæ„ B è¿è¡Œï¼›B ä¾è¨€æ‰§è¡Œï¼Œå†å°†ç»“æœç»™ Aï¼›A å†ç»§ç»­æ“ä½œã€‚ ä¸¾ä¸ªç®€å•ä¾‹å­å°±æ˜¯ï¼šä¸¤ä¸ªäººåœ¨ä¸€èµ·èŠå¤©ã€‚ä¸¤ä¸ªäººä¸èƒ½åŒæ—¶è¯´è¯ï¼Œé¿å…å¬ä¸æ¸…(æ“ä½œå†²çª)ã€‚ç­‰ä¸€ä¸ªäººè¯´å®Œ(ä¸€ä¸ªçº¿ç¨‹ç»“æŸæ“ä½œ)ï¼Œå¦ä¸€ä¸ªå†è¯´(å¦ä¸€ä¸ªçº¿ç¨‹å†å¼€å§‹æ“ä½œ)ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬æ¨¡æ‹Ÿç«è½¦ç¥¨å”®å–çš„æ–¹å¼ï¼Œå®ç° NSOperation çº¿ç¨‹å®‰å…¨å’Œè§£å†³çº¿ç¨‹åŒæ­¥é—®é¢˜ã€‚åœºæ™¯ï¼šæ€»å…±æœ‰50å¼ ç«è½¦ç¥¨ï¼Œæœ‰ä¸¤ä¸ªå”®å–ç«è½¦ç¥¨çš„çª—å£ï¼Œä¸€ä¸ªæ˜¯åŒ—äº¬ç«è½¦ç¥¨å”®å–çª—å£ï¼Œå¦ä¸€ä¸ªæ˜¯ä¸Šæµ·ç«è½¦ç¥¨å”®å–çª—å£ã€‚ä¸¤ä¸ªçª—å£åŒæ—¶å”®å–ç«è½¦ç¥¨ï¼Œå–å®Œä¸ºæ­¢ã€‚ 9.1 NSOperationã€NSOperationQueue éçº¿ç¨‹å®‰å…¨å…ˆæ¥çœ‹çœ‹ä¸è€ƒè™‘çº¿ç¨‹å®‰å…¨çš„ä»£ç ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849&#x2F;** * éçº¿ç¨‹å®‰å…¨ï¼šä¸ä½¿ç”¨ NSLock * åˆå§‹åŒ–ç«è½¦ç¥¨æ•°é‡ã€å–ç¥¨çª—å£(éçº¿ç¨‹å®‰å…¨)ã€å¹¶å¼€å§‹å–ç¥¨ *&#x2F;- (void)initTicketStatusNotSave &#123; NSLog(@&quot;currentThread---%@&quot;,[NSThread currentThread]); &#x2F;&#x2F; æ‰“å°å½“å‰çº¿ç¨‹ self.ticketSurplusCount &#x3D; 50; &#x2F;&#x2F; 1.åˆ›å»º queue1,queue1 ä»£è¡¨åŒ—äº¬ç«è½¦ç¥¨å”®å–çª—å£ NSOperationQueue *queue1 &#x3D; [[NSOperationQueue alloc] init]; queue1.maxConcurrentOperationCount &#x3D; 1; &#x2F;&#x2F; 2.åˆ›å»º queue2,queue2 ä»£è¡¨ä¸Šæµ·ç«è½¦ç¥¨å”®å–çª—å£ NSOperationQueue *queue2 &#x3D; [[NSOperationQueue alloc] init]; queue2.maxConcurrentOperationCount &#x3D; 1; &#x2F;&#x2F; 3.åˆ›å»ºå–ç¥¨æ“ä½œ op1 NSBlockOperation *op1 &#x3D; [NSBlockOperation blockOperationWithBlock:^&#123; [self saleTicketNotSafe]; &#125;]; &#x2F;&#x2F; 4.åˆ›å»ºå–ç¥¨æ“ä½œ op2 NSBlockOperation *op2 &#x3D; [NSBlockOperation blockOperationWithBlock:^&#123; [self saleTicketNotSafe]; &#125;]; &#x2F;&#x2F; 5.æ·»åŠ æ“ä½œï¼Œå¼€å§‹å–ç¥¨ [queue1 addOperation:op1]; [queue2 addOperation:op2];&#125;&#x2F;** * å”®å–ç«è½¦ç¥¨(éçº¿ç¨‹å®‰å…¨) *&#x2F;- (void)saleTicketNotSafe &#123; while (1) &#123; if (self.ticketSurplusCount &gt; 0) &#123; &#x2F;&#x2F;å¦‚æœè¿˜æœ‰ç¥¨ï¼Œç»§ç»­å”®å– self.ticketSurplusCount--; NSLog(@&quot;%@&quot;, [NSString stringWithFormat:@&quot;å‰©ä½™ç¥¨æ•°:%d çª—å£:%@&quot;, self.ticketSurplusCount, [NSThread currentThread]]); [NSThread sleepForTimeInterval:0.2]; &#125; else &#123; NSLog(@&quot;æ‰€æœ‰ç«è½¦ç¥¨å‡å·²å”®å®Œ&quot;); break; &#125; &#125;&#125; è¾“å‡ºç»“æœï¼š çœç•¥ä¸€éƒ¨åˆ†ç»“æœå›¾ã€‚ã€‚ã€‚ å¯ä»¥çœ‹åˆ°ï¼šåœ¨ä¸è€ƒè™‘çº¿ç¨‹å®‰å…¨ï¼Œä¸ä½¿ç”¨ NSLock æƒ…å†µä¸‹ï¼Œå¾—åˆ°ç¥¨æ•°æ˜¯é”™ä¹±çš„ï¼Œè¿™æ ·æ˜¾ç„¶ä¸ç¬¦åˆæˆ‘ä»¬çš„éœ€æ±‚ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚ 9.2 NSOperationã€NSOperationQueue çº¿ç¨‹å®‰å…¨çº¿ç¨‹å®‰å…¨è§£å†³æ–¹æ¡ˆï¼šå¯ä»¥ç»™çº¿ç¨‹åŠ é”ï¼Œåœ¨ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œè¯¥æ“ä½œçš„æ—¶å€™ï¼Œä¸å…è®¸å…¶ä»–çº¿ç¨‹è¿›è¡Œæ“ä½œã€‚iOS å®ç°çº¿ç¨‹åŠ é”æœ‰å¾ˆå¤šç§æ–¹å¼ã€‚@synchronizedã€ NSLockã€NSRecursiveLockã€NSConditionã€NSConditionLockã€pthread_mutexã€dispatch_semaphoreã€OSSpinLockã€atomic(property) set/geç­‰ç­‰å„ç§æ–¹å¼ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ NSLock å¯¹è±¡æ¥è§£å†³çº¿ç¨‹åŒæ­¥é—®é¢˜ã€‚NSLock å¯¹è±¡å¯ä»¥é€šè¿‡è¿›å…¥é”æ—¶è°ƒç”¨ lock æ–¹æ³•ï¼Œè§£é”æ—¶è°ƒç”¨ unlock æ–¹æ³•æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚è€ƒè™‘çº¿ç¨‹å®‰å…¨çš„ä»£ç ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960&#x2F;** * çº¿ç¨‹å®‰å…¨ï¼šä½¿ç”¨ NSLock åŠ é” * åˆå§‹åŒ–ç«è½¦ç¥¨æ•°é‡ã€å–ç¥¨çª—å£(çº¿ç¨‹å®‰å…¨)ã€å¹¶å¼€å§‹å–ç¥¨ *&#x2F;- (void)initTicketStatusSave &#123; NSLog(@&quot;currentThread---%@&quot;,[NSThread currentThread]); &#x2F;&#x2F; æ‰“å°å½“å‰çº¿ç¨‹ self.ticketSurplusCount &#x3D; 50; self.lock &#x3D; [[NSLock alloc] init]; &#x2F;&#x2F; åˆå§‹åŒ– NSLock å¯¹è±¡ &#x2F;&#x2F; 1.åˆ›å»º queue1,queue1 ä»£è¡¨åŒ—äº¬ç«è½¦ç¥¨å”®å–çª—å£ NSOperationQueue *queue1 &#x3D; [[NSOperationQueue alloc] init]; queue1.maxConcurrentOperationCount &#x3D; 1; &#x2F;&#x2F; 2.åˆ›å»º queue2,queue2 ä»£è¡¨ä¸Šæµ·ç«è½¦ç¥¨å”®å–çª—å£ NSOperationQueue *queue2 &#x3D; [[NSOperationQueue alloc] init]; queue2.maxConcurrentOperationCount &#x3D; 1; &#x2F;&#x2F; 3.åˆ›å»ºå–ç¥¨æ“ä½œ op1 NSBlockOperation *op1 &#x3D; [NSBlockOperation blockOperationWithBlock:^&#123; [self saleTicketSafe]; &#125;]; &#x2F;&#x2F; 4.åˆ›å»ºå–ç¥¨æ“ä½œ op2 NSBlockOperation *op2 &#x3D; [NSBlockOperation blockOperationWithBlock:^&#123; [self saleTicketSafe]; &#125;]; &#x2F;&#x2F; 5.æ·»åŠ æ“ä½œï¼Œå¼€å§‹å–ç¥¨ [queue1 addOperation:op1]; [queue2 addOperation:op2];&#125;&#x2F;** * å”®å–ç«è½¦ç¥¨(çº¿ç¨‹å®‰å…¨) *&#x2F;- (void)saleTicketSafe &#123; while (1) &#123; &#x2F;&#x2F; åŠ é” [self.lock lock]; if (self.ticketSurplusCount &gt; 0) &#123; &#x2F;&#x2F;å¦‚æœè¿˜æœ‰ç¥¨ï¼Œç»§ç»­å”®å– self.ticketSurplusCount--; NSLog(@&quot;%@&quot;, [NSString stringWithFormat:@&quot;å‰©ä½™ç¥¨æ•°:%d çª—å£:%@&quot;, self.ticketSurplusCount, [NSThread currentThread]]); [NSThread sleepForTimeInterval:0.2]; &#125; &#x2F;&#x2F; è§£é” [self.lock unlock]; if (self.ticketSurplusCount &lt;&#x3D; 0) &#123; NSLog(@&quot;æ‰€æœ‰ç«è½¦ç¥¨å‡å·²å”®å®Œ&quot;); break; &#125; &#125;&#125; è¾“å‡ºç»“æœï¼š çœç•¥ä¸€éƒ¨åˆ†ç»“æœå›¾ã€‚ã€‚ã€‚ å¯ä»¥çœ‹å‡ºï¼šåœ¨è€ƒè™‘äº†çº¿ç¨‹å®‰å…¨ï¼Œä½¿ç”¨ NSLock åŠ é”ã€è§£é”æœºåˆ¶çš„æƒ…å†µä¸‹ï¼Œå¾—åˆ°çš„ç¥¨æ•°æ˜¯æ­£ç¡®çš„ï¼Œæ²¡æœ‰å‡ºç°æ··ä¹±çš„æƒ…å†µã€‚æˆ‘ä»¬ä¹Ÿå°±è§£å†³äº†å¤šä¸ªçº¿ç¨‹åŒæ­¥çš„é—®é¢˜ã€‚ 10. NSOperationã€NSOperationQueue å¸¸ç”¨å±æ€§å’Œæ–¹æ³•å½’çº³10.1 NSOperation å¸¸ç”¨å±æ€§å’Œæ–¹æ³•1ã€å–æ¶ˆæ“ä½œæ–¹æ³• -(void)cancel; å¯å–æ¶ˆæ“ä½œï¼Œå®è´¨æ˜¯æ ‡è®° isCancelled çŠ¶æ€ã€‚ 2ã€åˆ¤æ–­æ“ä½œçŠ¶æ€æ–¹æ³• -(BOOL)isFinished; åˆ¤æ–­æ“ä½œæ˜¯å¦å·²ç»ç»“æŸã€‚ -(BOOL)isCancelled; åˆ¤æ–­æ“ä½œæ˜¯å¦å·²ç»æ ‡è®°ä¸ºå–æ¶ˆã€‚ -(BOOL)isExecuting; åˆ¤æ–­æ“ä½œæ˜¯å¦æ­£åœ¨åœ¨è¿è¡Œã€‚ -(BOOL)isReady; åˆ¤æ–­æ“ä½œæ˜¯å¦å¤„äºå‡†å¤‡å°±ç»ªçŠ¶æ€ï¼Œè¿™ä¸ªå€¼å’Œæ“ä½œçš„ä¾èµ–å…³ç³»ç›¸å…³ã€‚ 3ã€æ“ä½œåŒæ­¥ -(void)waitUntilFinished; é˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°è¯¥æ“ä½œç»“æŸã€‚å¯ç”¨äºçº¿ç¨‹æ‰§è¡Œé¡ºåºçš„åŒæ­¥ã€‚ -(void)setCompletionBlock:(void (^)(void))block; completionBlock ä¼šåœ¨å½“å‰æ“ä½œæ‰§è¡Œå®Œæ¯•æ—¶æ‰§è¡Œ completionBlockã€‚ -(void)addDependency:(NSOperation *)op; æ·»åŠ ä¾èµ–ï¼Œä½¿å½“å‰æ“ä½œä¾èµ–äºæ“ä½œ op çš„å®Œæˆã€‚ -(void)removeDependency:(NSOperation *)op; ç§»é™¤ä¾èµ–ï¼Œå–æ¶ˆå½“å‰æ“ä½œå¯¹æ“ä½œ op çš„ä¾èµ–ã€‚ @property (readonly, copy) NSArray&lt;NSOperation *&gt; *dependencies; åœ¨å½“å‰æ“ä½œå¼€å§‹æ‰§è¡Œä¹‹å‰å®Œæˆæ‰§è¡Œçš„æ‰€æœ‰æ“ä½œå¯¹è±¡æ•°ç»„ã€‚ 10.2 NSOperationQueue å¸¸ç”¨å±æ€§å’Œæ–¹æ³•1ã€å–æ¶ˆ/æš‚åœ/æ¢å¤æ“ä½œ -(void)cancelAllOperations; å¯ä»¥å–æ¶ˆé˜Ÿåˆ—çš„æ‰€æœ‰æ“ä½œã€‚ -(BOOL)isSuspended; åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦å¤„äºæš‚åœçŠ¶æ€ã€‚ YES ä¸ºæš‚åœçŠ¶æ€ï¼ŒNO ä¸ºæ¢å¤çŠ¶æ€ã€‚ -(void)setSuspended:(BOOL)b; å¯è®¾ç½®æ“ä½œçš„æš‚åœå’Œæ¢å¤ï¼ŒYES ä»£è¡¨æš‚åœé˜Ÿåˆ—ï¼ŒNO ä»£è¡¨æ¢å¤é˜Ÿåˆ—ã€‚ 2ã€æ“ä½œåŒæ­¥ -(void)waitUntilAllOperationsAreFinished; é˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸­çš„æ“ä½œå…¨éƒ¨æ‰§è¡Œå®Œæ¯•ã€‚ 3ã€æ·»åŠ /è·å–æ“ä½œ -(void)addOperationWithBlock:(void (^)(void))block; å‘é˜Ÿåˆ—ä¸­æ·»åŠ ä¸€ä¸ª NSBlockOperation ç±»å‹æ“ä½œå¯¹è±¡ã€‚ -(void)addOperations:(NSArray *)ops waitUntilFinished:(BOOL)wait; å‘é˜Ÿåˆ—ä¸­æ·»åŠ æ“ä½œæ•°ç»„ï¼Œwait æ ‡å¿—æ˜¯å¦é˜»å¡å½“å‰çº¿ç¨‹ç›´åˆ°æ‰€æœ‰æ“ä½œç»“æŸ -(NSArray *)operations; å½“å‰åœ¨é˜Ÿåˆ—ä¸­çš„æ“ä½œæ•°ç»„ï¼ˆæŸä¸ªæ“ä½œæ‰§è¡Œç»“æŸåä¼šè‡ªåŠ¨ä»è¿™ä¸ªæ•°ç»„æ¸…é™¤ï¼‰ã€‚ -(NSUInteger)operationCount; å½“å‰é˜Ÿåˆ—ä¸­çš„æ“ä½œæ•°ã€‚ 4ã€è·å–é˜Ÿåˆ— +(id)currentQueue; è·å–å½“å‰é˜Ÿåˆ—ï¼Œå¦‚æœå½“å‰çº¿ç¨‹ä¸æ˜¯åœ¨ NSOperationQueue ä¸Šè¿è¡Œåˆ™è¿”å› nilã€‚ -(id)mainQueue; è·å–ä¸»é˜Ÿåˆ—ã€‚ æ³¨æ„ï¼š è¿™é‡Œçš„æš‚åœå’Œå–æ¶ˆï¼ˆåŒ…æ‹¬æ“ä½œçš„å–æ¶ˆå’Œé˜Ÿåˆ—çš„å–æ¶ˆï¼‰å¹¶ä¸ä»£è¡¨å¯ä»¥å°†å½“å‰çš„æ“ä½œç«‹å³å–æ¶ˆï¼Œè€Œæ˜¯å½“å½“å‰çš„æ“ä½œæ‰§è¡Œå®Œæ¯•ä¹‹åä¸å†æ‰§è¡Œæ–°çš„æ“ä½œã€‚æš‚åœå’Œå–æ¶ˆçš„åŒºåˆ«å°±åœ¨äºï¼šæš‚åœæ“ä½œä¹‹åè¿˜å¯ä»¥æ¢å¤æ“ä½œï¼Œç»§ç»­å‘ä¸‹æ‰§è¡Œï¼›è€Œå–æ¶ˆæ“ä½œä¹‹åï¼Œæ‰€æœ‰çš„æ“ä½œå°±æ¸…ç©ºäº†ï¼Œæ— æ³•å†æ¥ç€æ‰§è¡Œå‰©ä¸‹çš„æ“ä½œã€‚","categories":[{"name":"Objective-C","slug":"Objective-C","permalink":"https://github.com/wuvdan/wuvdan.github.io/categories/Objective-C/"}],"tags":[{"name":"åº•å±‚åŸç†","slug":"åº•å±‚åŸç†","permalink":"https://github.com/wuvdan/wuvdan.github.io/tags/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/"}]},{"title":"iOSå¤šçº¿ç¨‹-9ç§é”.md","slug":"iOSå¤šçº¿ç¨‹-9ç§é”.md","date":"2020-01-16T08:05:04.041Z","updated":"2020-01-20T01:46:17.485Z","comments":true,"path":"2020/01/16/iOSå¤šçº¿ç¨‹-9ç§é”.md/","link":"","permalink":"https://github.com/wuvdan/wuvdan.github.io/2020/01/16/iOS%E5%A4%9A%E7%BA%BF%E7%A8%8B-9%E7%A7%8D%E9%94%81.md/","excerpt":"","text":"1ã€dispatch_semaphore è‡ªæ—‹é”2ã€@synchronized äº’æ–¥é”3ã€NSLock çº¿ç¨‹é”4ã€NSRecursiveLock é€’å½’é”5ã€NSConditionLock æ¡ä»¶é”6ã€NSCondition æ–­è¨€7ã€OSSpinLock è‡ªæ—‹é”8ã€pthread_mutex äº’æ–¥é”9ã€pthread_mutex(recursive) äº’æ–¥é”","categories":[{"name":"Objective-C","slug":"Objective-C","permalink":"https://github.com/wuvdan/wuvdan.github.io/categories/Objective-C/"}],"tags":[{"name":"åº•å±‚åŸç†","slug":"åº•å±‚åŸç†","permalink":"https://github.com/wuvdan/wuvdan.github.io/tags/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/"}]},{"title":"iOSåŠ¨ç”»-Transitionè½¬åœºåŠ¨ç”»","slug":"iOSåŠ¨ç”»-Transitionè½¬åœºåŠ¨ç”»","date":"2020-01-16T08:04:59.452Z","updated":"2020-01-20T01:46:50.400Z","comments":true,"path":"2020/01/16/iOSåŠ¨ç”»-Transitionè½¬åœºåŠ¨ç”»/","link":"","permalink":"https://github.com/wuvdan/wuvdan.github.io/2020/01/16/iOS%E5%8A%A8%E7%94%BB-Transition%E8%BD%AC%E5%9C%BA%E5%8A%A8%E7%94%BB/","excerpt":"","text":"12345678910111213141516171819202122&#x2F;** * UIViewAnimationOptionTransitionNone &#x2F;&#x2F;æ²¡æœ‰æ•ˆæœ * UIViewAnimationOptionTransitionFlipFromLeft &#x2F;&#x2F;ä»å·¦æ°´å¹³ç¿»è½¬ * UIViewAnimationOptionTransitionFlipFromRight &#x2F;&#x2F;ä»å³æ°´å¹³ç¿»è½¬ * UIViewAnimationOptionTransitionCurlUp &#x2F;&#x2F;ç¿»ä¹¦ä¸Šæ€ * UIViewAnimationOptionTransitionCurlDown &#x2F;&#x2F;ç¿»ä¹¦ä¸‹ç›– * UIViewAnimationOptionTransitionCrossDissolve &#x2F;&#x2F;èåˆ * UIViewAnimationOptionTransitionFlipFromTop &#x2F;&#x2F;ä»ä¸Šå‚ç›´ç¿»è½¬ * UIViewAnimationOptionTransitionFlipFromBottom &#x2F;&#x2F;ä»ä¸‹å‚ç›´ç¿»è½¬ * *&#x2F;[UIView transitionWithView:UIApplication.sharedApplication.keyWindow duration:0.5 options:UIViewAnimationOptionTransitionFlipFromLeft animations:^&#123; &#x2F;&#x2F; TODO: é¡µé¢è·³è½¬ &#125; completion:^(BOOL finished) &#123; &#125;];","categories":[],"tags":[{"name":"åŠ¨ç”»","slug":"åŠ¨ç”»","permalink":"https://github.com/wuvdan/wuvdan.github.io/tags/%E5%8A%A8%E7%94%BB/"}]},{"title":"iOSåŠ¨ç”»-CATransitionç§»åŠ¨åŠ¨ç”»","slug":"iOSåŠ¨ç”»-CATransitionç§»åŠ¨åŠ¨ç”»","date":"2020-01-16T08:04:54.929Z","updated":"2020-01-20T01:46:59.109Z","comments":true,"path":"2020/01/16/iOSåŠ¨ç”»-CATransitionç§»åŠ¨åŠ¨ç”»/","link":"","permalink":"https://github.com/wuvdan/wuvdan.github.io/2020/01/16/iOS%E5%8A%A8%E7%94%BB-CATransition%E7%A7%BB%E5%8A%A8%E5%8A%A8%E7%94%BB/","excerpt":"","text":"12345678910111213141516171819&#x2F;** * UIViewAnimationTransitionNone &#x2F;&#x2F;æ²¡æœ‰æ•ˆæœ * UIViewAnimationTransitionFlipFromLeft &#x2F;&#x2F;ä»å·¦æ°´å¹³ç¿»è½¬ * UIViewAnimationTransitionFlipFromRight &#x2F;&#x2F;ä»å³æ°´å¹³ç¿»è½¬ * UIViewAnimationTransitionCurlUp &#x2F;&#x2F;ç¿»ä¹¦ä¸Šæ€ * UIViewAnimationTransitionCurlDown &#x2F;&#x2F;ç¿»ä¹¦ä¸‹ç›– * UIViewAnimationTransitionCrossDissolve &#x2F;&#x2F;èåˆ * UIViewAnimationTransitionFlipFromTop &#x2F;&#x2F;ä»ä¸Šå‚ç›´ç¿»è½¬ * UIViewAnimationTransitionFlipFromBottom &#x2F;&#x2F;ä»ä¸‹å‚ç›´ç¿»è½¬ * *&#x2F;[UIView beginAnimations:@&quot;animation&quot; context:nil];[UIView setAnimationDuration:1.0f];[UIView setAnimationTransition:UIViewAnimationTransitionNone forView:containerView cache:YES];[UIView setAnimationCurve:UIViewAnimationCurveEaseInOut];&#x2F;&#x2F; äº¤æ¢å±‚çº§å…³ç³»[containerView exchangeSubviewAtIndex:0 withSubviewAtIndex:1];[UIView commitAnimations];","categories":[],"tags":[{"name":"åŠ¨ç”»","slug":"åŠ¨ç”»","permalink":"https://github.com/wuvdan/wuvdan.github.io/tags/%E5%8A%A8%E7%94%BB/"}]},{"title":"iOSåŠ¨ç”»-CATransitionå±æ€§åŠ¨ç”»","slug":"iOSåŠ¨ç”»-CATransitionå±æ€§åŠ¨ç”»","date":"2020-01-16T08:04:50.474Z","updated":"2020-01-20T01:47:06.262Z","comments":true,"path":"2020/01/16/iOSåŠ¨ç”»-CATransitionå±æ€§åŠ¨ç”»/","link":"","permalink":"https://github.com/wuvdan/wuvdan.github.io/2020/01/16/iOS%E5%8A%A8%E7%94%BB-CATransition%E5%B1%9E%E6%80%A7%E5%8A%A8%E7%94%BB/","excerpt":"","text":"ç§æœ‰æ–¹æ³• 123456789101112131415161718192021222324252627&#x2F;* Common transition types. *&#x2F;&#x2F;** * cube &#x2F;&#x2F; ç«‹æ–¹ä½“æ—‹è½¬ * suckEffect &#x2F;&#x2F; æ”¶ç¼©åŠ¨ç”» * oglFlip &#x2F;&#x2F; ç¿»è½¬ * pageCurl &#x2F;&#x2F; é¡µé¢æ­å¼€ * pageUnCurl &#x2F;&#x2F; æ”¾ä¸‹é¡µé¢ * cemeraIrisHollowOpen &#x2F;&#x2F; é•œå¤´æ‰“å¼€ * cameraIrisHollowClose &#x2F;&#x2F; é•œå¤´å…³é—­ *&#x2F;&#x2F;* Common transition subtypes. *&#x2F;&#x2F;** * kCATransitionFromRight * kCATransitionFromLeft * kCATransitionFromTop * kCATransitionFromBottom *&#x2F;CATransition *transition &#x3D; [CATransition animation];transition.duration &#x3D; 3;transition.type &#x3D; @&quot;oglFlip&quot;;transition.subtype &#x3D; kCATransitionFromTop;[containerView.layer addAnimation:transition forKey:nil];[containerView exchangeSubviewAtIndex:0 withSubviewAtIndex:1];","categories":[],"tags":[{"name":"åŠ¨ç”»","slug":"åŠ¨ç”»","permalink":"https://github.com/wuvdan/wuvdan.github.io/tags/%E5%8A%A8%E7%94%BB/"}]},{"title":"iOSåŠ¨ç”»-CATransitionåè½¬åŠ¨ç”»","slug":"iOSåŠ¨ç”»-CATransitionåè½¬åŠ¨ç”»","date":"2020-01-16T08:04:46.019Z","updated":"2020-01-20T01:47:11.314Z","comments":true,"path":"2020/01/16/iOSåŠ¨ç”»-CATransitionåè½¬åŠ¨ç”»/","link":"","permalink":"https://github.com/wuvdan/wuvdan.github.io/2020/01/16/iOS%E5%8A%A8%E7%94%BB-CATransition%E5%8F%8D%E8%BD%AC%E5%8A%A8%E7%94%BB/","excerpt":"","text":"ç§»åŠ¨åŠ¨ç”» 123456789101112131415161718192021222324&#x2F;* Common transition types. *&#x2F;&#x2F;** * kCATransitionFade &#x2F;&#x2F; æ¸å˜ * kCATransitionMoveIn &#x2F;&#x2F; è¦†ç›– * kCATransitionPush &#x2F;&#x2F; æ¨å‡º * kCATransitionReveal &#x2F;&#x2F; æ­å¼€ *&#x2F;&#x2F;* Common transition subtypes. *&#x2F;&#x2F;** * kCATransitionFromRight * kCATransitionFromLeft * kCATransitionFromTop * kCATransitionFromBottom *&#x2F;CATransition *transition &#x3D; [CATransition animation];transition.duration &#x3D; 0.25;transition.type &#x3D; kCATransitionPush;transition.subtype &#x3D; kCATransitionFromRight;[containerView.layer addAnimation:transition forKey:nil];[containerView exchangeSubviewAtIndex:0 withSubviewAtIndex:1];","categories":[],"tags":[{"name":"åŠ¨ç”»","slug":"åŠ¨ç”»","permalink":"https://github.com/wuvdan/wuvdan.github.io/tags/%E5%8A%A8%E7%94%BB/"}]},{"title":"iOSåŠ¨ç”»-CALayerçš„å±æ€§å’Œä½¿ç”¨(æœªå®Œç»“)","slug":"iOSåŠ¨ç”»-CALayerçš„å±æ€§å’Œä½¿ç”¨(æœªå®Œç»“)","date":"2020-01-16T08:04:40.787Z","updated":"2020-01-20T01:47:23.253Z","comments":true,"path":"2020/01/16/iOSåŠ¨ç”»-CALayerçš„å±æ€§å’Œä½¿ç”¨(æœªå®Œç»“)/","link":"","permalink":"https://github.com/wuvdan/wuvdan.github.io/2020/01/16/iOS%E5%8A%A8%E7%94%BB-CALayer%E7%9A%84%E5%B1%9E%E6%80%A7%E5%92%8C%E4%BD%BF%E7%94%A8(%E6%9C%AA%E5%AE%8C%E7%BB%93)/","excerpt":"","text":"ä¸€ã€CALayerçš„å¸¸ç”¨å±æ€§ @propertyCGPoint position;å›¾å±‚ä¸­å¿ƒç‚¹çš„ä½ç½®ï¼Œç±»ä¼¼ä¸UIViewçš„centerï¼›ç”¨æ¥è®¾ç½®CALayeråœ¨çˆ¶å±‚ä¸­çš„ä½ç½®ï¼›ä»¥çˆ¶å±‚çš„å·¦ä¸Šè§’ä¸ºåŸç‚¹ï¼ˆ0ï¼Œ0ï¼‰ @property CGPoint anchorPoint;ç§°ã€å®šä½ç‚¹ã€ã€ã€é”šç‚¹ã€ï¼Œè¯¥æè¿°æ˜¯ç›¸å¯¹äºxã€yä½ç½®æ¯”ä¾‹è€Œè¨€çš„é»˜è®¤åœ¨å›¾åƒä¸­å¿ƒç‚¹ï¼ˆ0.5ã€0.5ï¼‰çš„ä½ç½®ï¼›å†³å®šç€CALayerèº«ä¸Šçš„å“ªä¸ªç‚¹ä¼šå†positionå±æ€§æ‰€æŒ‡çš„ä½ç½®ï¼Œä»¥è‡ªå·±çš„å·¦ä¸Šè§’ä¸ºåŸç‚¹ï¼ˆ0ï¼Œ0ï¼‰ï¼›å®ƒçš„xã€yå–å€¼èŒƒå›´éƒ½æ˜¯0~1 @property(nullable) CGColorRef backgroundColorå›¾å±‚èƒŒæ™¯é¢œè‰² @property(nullable) CGColorRef borderColorå›¾å±‚è¾¹æ¡†é¢œè‰² @property CGFloat borderWidthå›¾å±‚è¾¹æ¡†å®½åº¦ @property CGRect boundså›¾å±‚å¤§å° @property(nullable, strong) id contentså›¾å±‚æ˜¾ç¤ºå†…å®¹ï¼Œä¾‹å¦‚å¯ä»¥å°†å›¾ç‰‡ä½œä¸ºå›¾å±‚å†…å®¹æ˜¾ç¤º @property CGRect contentsRectå›¾å±‚æ˜¾ç¤ºå†…å®¹çš„å¤§å°å’Œä½ç½® @property CGFloat cornerRadiusåœ†è§’åŠå¾„ @property(getter=isDoubleSided) BOOL doubleSidedå›¾å±‚èƒŒæ™¯æ˜¯å¦æ˜¾ç¤ºï¼Œé»˜è®¤æ˜¯YES @property CGRect frameå›¾å±‚å¤§å°å’Œä½ç½®ï¼Œä¸æ”¯æŒéšå¼åŠ¨ç”»ï¼Œæ‰€ä»¥CALyaerä¸­å¾ˆå°‘ä½¿ç”¨frameï¼Œé€šå¸¸ä½¿ç”¨boundå’Œpositionä»£æ›¿ @property(getter=isHidden) BOOL hiddenæ˜¯å¦éšè— @property(nullable, strong) CALayer *maskå›¾å±‚è’™ç‰ˆ @property BOOL masksToBoundså­å›¾å±‚æ˜¯å¦å‰ªåˆ‡å›¾å±‚è¾¹ç•Œï¼Œé»˜è®¤æ˜¯NO @property float opacit;å›¾å±‚é€æ˜åº¦ï¼Œç±»ä¼¼ä¸UIViewçš„alpha @property(nullable) CGColorRef shadowColoré˜´å½±é¢œè‰² @property CGSize shadowOffseté˜´å½±åç§»é‡ @property float shadowOpacityé˜´å½±é€æ˜åº¦ï¼Œæ³¨æ„é»˜è®¤ä¸º0ï¼Œå¦‚æœè®¾ç½®é˜´å½±å¿…é¡»è®¾ç½®æ­¤å±æ€§ @property(nullable) CGPathRef shadowPathé˜´å½±å½¢çŠ¶ @property CGFloat shadowRadiusé˜´å½±æ¨¡ç³ŠåŠå¾„ @property(nullable, copy) NSArray äºŒã€CALayerä¸å¸¸ç”¨å±æ€§ @property CGFloat zPositionå›¾å±‚ä¸­å¿ƒç‚¹åœ¨zè½´ä¸­çš„ä½ç½® @property CGFloat anchorPointZå›¾å±‚åœ¨zè½´ä¸­çš„é”šç‚¹ï¼› æ–¹æ³• - (CGAffineTransform)affineTransform æ–¹æ³• - (void)setAffineTransform:(CGAffineTransform)mä»¥ä¸Šå±æ€§ä¸ºå›¾å±‚å½¢å˜ï¼›è¯¥å±æ€§å€¼æŒ‡å®šä¸€ä¸ªCGAffineTransformå¯¹è±¡ï¼Œè¯¥å¯¹è±¡ä»£è¡¨å¯¹CALayeræ‰§è¡ŒXã€Yä¸¤ä¸ªç»´åº¦ï¼ˆä¹Ÿå°±æ˜¯å¹³é¢ï¼‰ä¸Šçš„æ—‹è½¬ã€ç¼©æ”¾ã€ä½ç§»ã€æ–œåˆ‡ã€é•œåƒç­‰å˜æ¢çŸ©é˜µ @property(nullable, readonly) CALayer *superlayerå›¾å±‚çš„çˆ¶å›¾å±‚ ä¸‰ã€CALayerå›¾å±‚æ“ä½œ æ–¹æ³• - (void)addSublayer:(CALayer *)layeræ·»åŠ å­å›¾å±‚ æ–¹æ³• - (void)removeFromSuperlayerå°†è‡ªå·±ä»çˆ¶å›¾å±‚ä¸­ç§»é™¤ æ–¹æ³• - (void)insertSublayer:(CALayer *)layer atIndex:(unsigned)idxåœ¨è‡ªå·±å­å›¾å±‚æ•°ç»„ä¸­çš„ç¬¬idxä½ç½®æ·»åŠ å›¾å±‚ æ–¹æ³• - (void)insertSublayer:(CALayer )layer below:(nullable CALayer )siblingå°†å›¾å±‚layeræ·»åŠ åœ¨å­å›¾å±‚siblingçš„ä¸‹é¢ æ–¹æ³• - (void)insertSublayer:(CALayer )layer above:(nullable CALayer )siblingå°†å›¾å±‚layeræ·»åŠ åœ¨å­å›¾å±‚siblingçš„ä¸Šé¢ æ–¹æ³• - (void)replaceSublayer:(CALayer )layer with:(CALayer )layer2å°†å›¾å±‚layeræ›¿æ¢layer2ï¼› å››ã€CALayeråŠ¨ç”»æ“ä½œ æ–¹æ³• - (void)addAnimation:(CAAnimation )anim forKey:(nullable NSString )keyå›¾å±‚æ·»åŠ æŸä¸€å±æ€§çš„åŠ¨ç”» æ–¹æ³• - (nullable NSArray&lt; NSString &gt; )animationKeysè·å–æ‰€æœ‰åŠ¨ç”»çš„å±æ€§ æ–¹æ³• - (nullable CAAnimation )animationForKey:(NSString )keyè·å–æŸä¸€å±æ€§çš„åŠ¨ç”» æ–¹æ³• - (void)removeAnimationForKey:(NSString *)keyç§»é™¤æŸä¸€å±æ€§åŠ¨ç”» æ–¹æ³• - (void)removeAllAnimationsç§»é™¤æ‰€æœ‰åŠ¨ç”» äº”ã€CALayerå­ç±»å…¶ä»–è¯´æ˜ å­ç±»åç§° ç”¨é€” CAEmitterLayer å‘å°„å™¨å±‚ï¼Œç”¨æ¥æ§åˆ¶ç²’å­æ•ˆæœ CAGradientLayer æ¢¯åº¦å±‚ï¼Œé¢œè‰²æ¸å˜ CAEAGLayer ç”¨OpenGL ESç»˜åˆ¶çš„å±‚ CAReplicationLayer ç”¨æ¥è‡ªåŠ¨å¤åˆ¶sublayer CAShapeLayer ç»˜åˆ¶ç«‹ä½“çš„è´å¡å°”æ›²çº¿ CAScrollLayer ç”¨æ¥ç®¡ç†å¯æ»‘åŠ¨çš„åŒºåŸŸ CATextLayer å¯ä»¥ç»˜åˆ¶AttributeString CATiledLayer ç”¨æ¥ç®¡ç†ä¸€å‰¯å¯ä»¥è¢«åˆ†å‰²çš„å¤§å›¾ CATransformLayer ç”¨æ¥æ¸²æŸ“3D layerçš„å±‚æ¬¡ç»“æ„ 1. CAShapeLayerCAShapeLayerå±äºQuartzCoreæ¡†æ¶ï¼Œç»§æ‰¿è‡ªCALayerã€‚CAShapeLayeræ˜¯åœ¨åæ ‡ç³»å†…ç»˜åˆ¶è´å¡å°”æ›²çº¿çš„ï¼Œé€šè¿‡ç»˜åˆ¶è´å¡å°”æ›²çº¿ï¼Œè®¾ç½®shape(å½¢çŠ¶)çš„path(è·¯å¾„)ï¼Œä»è€Œç»˜åˆ¶å„ç§å„æ ·çš„å›¾å½¢ä»¥åŠä¸è§„åˆ™å›¾å½¢ã€‚å› æ­¤ï¼Œä½¿ç”¨CAShapeLayeréœ€è¦ä¸UIBezierPathä¸€èµ·ä½¿ç”¨ã€‚UIBezierPathç±»å…è®¸ä½ åœ¨è‡ªå®šä¹‰çš„ View ä¸­ç»˜åˆ¶å’Œæ¸²æŸ“ç”±ç›´çº¿å’Œæ›²çº¿ç»„æˆçš„è·¯å¾„.ã€‚ä½ å¯ä»¥åœ¨åˆå§‹åŒ–çš„æ—¶å€™ç›´æ¥ä¸ºä½ çš„UIBezierPathæŒ‡å®šä¸€ä¸ªå‡ ä½•å›¾å½¢ã€‚é€šä¿—ç‚¹å°±æ˜¯UIBezierPathç”¨æ¥æŒ‡å®šç»˜åˆ¶å›¾å½¢è·¯å¾„ï¼Œè€ŒCAShapeLayerå°±æ˜¯æ ¹æ®è·¯å¾„æ¥ç»˜å›¾çš„ã€‚ å±æ€§ 1ã€@property(nullable) CGPathRef path; å‘ˆç°çš„å½¢çŠ¶çš„è·¯å¾„ 2ã€@property(nullable) CGColorRef fillColor;å¡«å……è·¯å¾„çš„é¢œè‰² 3ã€@property(copy) CAShapeLayerFillRule fillRule; å½“åœ¨å¡«å……é¢œè‰²çš„æ—¶å€™åˆ™å°±éœ€è¦è¿™ç§å¡«å……è§„åˆ™ï¼Œå€¼æœ‰ä¸¤ç§ï¼Œéé›¶å’Œå¥‡å¶æ•°ï¼Œä½†é»˜è®¤æ˜¯éé›¶å€¼ã€‚ 4ã€@property(nullable) CGColorRef strokeColor;è®¾ç½®æè¾¹è‰²ï¼Œé»˜è®¤æ— è‰²ã€‚ 5ã€@property CGFloat strokeStart; ç»˜åˆ¶è¾¹çº¿è½®å»“è·¯å¾„çš„å­åŒºåŸŸã€‚è¯¥å€¼å¿…é¡»åœ¨[0,1]èŒƒå›´ï¼Œ0ä»£è¡¨è·¯å¾„çš„å¼€å§‹ï¼Œ1ä»£è¡¨è·¯å¾„çš„ç»“æŸã€‚ é»˜è®¤ä¸º0 6ã€@property CGFloat strokeEnd; é»˜è®¤ä¸º1 7ã€@property CGFloat lineWidth; çº¿çš„å®½åº¦ é»˜è®¤ä¸º1 8ã€@property CGFloat miterLimit;æœ€å¤§æ–œæ¥é•¿åº¦ã€‚æ–œæ¥é•¿åº¦æŒ‡çš„æ˜¯åœ¨ä¸¤æ¡çº¿äº¤æ±‡å¤„å’Œå¤–äº¤ä¹‹é—´çš„è·ç¦»ã€‚åªæœ‰lineJoinå±æ€§ä¸ºkCALineJoinMiteræ—¶miterLimitæ‰æœ‰æ•ˆã€‚è¾¹è§’çš„è§’åº¦è¶Šå°ï¼Œæ–œæ¥é•¿åº¦å°±ä¼šè¶Šå¤§ã€‚ä¸ºäº†é¿å…æ–œæ¥é•¿åº¦è¿‡é•¿ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨miterLimitå±æ€§ã€‚å¦‚æœæ–œæ¥é•¿åº¦è¶…è¿‡miterLimitçš„å€¼ï¼Œè¾¹è§’ä¼šä»¥lineJoinçš„â€œbevelâ€å³kCALineJoinBevelç±»å‹æ¥æ˜¾ç¤ºã€‚ 9ã€@property(copy) CAShapeLayerLineCap lineCap; çº¿ç«¯ç‚¹ç±»å‹ï¼Œå€¼æœ‰ä¸‰ä¸ªç±»å‹ï¼Œåˆ†åˆ«ä¸ºkCALineCapButt ã€kCALineCapRound ã€kCALineCapSquareï¼Œé»˜è®¤å€¼ä¸ºButtï¼› 10ã€@property(copy) CAShapeLayerLineJoin lineJoin;lineJoinä¸ºçº¿è¿æ¥ç±»å‹ï¼Œå…¶å€¼ä¹Ÿæœ‰ä¸‰ä¸ªç±»å‹ï¼Œåˆ†åˆ«ä¸ºkCALineJoinMiterã€kCALineJoinRoundã€kCALineJoinBevelï¼Œé»˜è®¤å€¼æ˜¯Miterã€‚ 11ã€@property CGFloat lineDashPhase;ä¸ºçº¿å‹æ¨¡ç‰ˆçš„èµ·å§‹ä½ç½®ï¼›lineDashPatternä¸ºçº¿æ€§æ¨¡ç‰ˆï¼Œè¿™æ˜¯ä¸€ä¸ªNSNumberçš„æ•°ç»„ï¼Œç´¢å¼•ä»1å¼€å§‹è®°ï¼Œå¥‡æ•°ä½æ•°å€¼è¡¨ç¤ºå®çº¿é•¿åº¦ï¼Œå¶æ•°ä½æ•°å€¼è¡¨ç¤ºç©ºç™½é•¿åº¦ã€‚æ³¨ï¼šfillColorä¸strokeColoréƒ½æ˜¯åœ¨æœ‰UIBezierPathå‚æ•°é…ç½®çš„æƒ…å†µä¸‹æ‰èƒ½å‘ç”Ÿä½œç”¨ 12ã€@property(nullable, copy) NSArray&lt;NSNumber *&gt; *lineDashPattern; 2.CAReplicationLayerå±æ€§ 1ã€@property NSInteger instanceCount; å¤åˆ¶subLayerä¸ªæ•°ï¼Œé»˜è®¤ä¸º1 2ã€@property BOOL preservesDepth; æ˜¯å¦å°†3Dä¾‹å­ç³»ç»Ÿå¹³é¢åŒ–åˆ°ä¸€ä¸ªå›¾å±‚ï¼ˆé»˜è®¤å€¼ï¼‰æˆ–è€…å¯ä»¥åœ¨3Dç©ºé—´ä¸­æ··åˆå…¶ä»–çš„å›¾å±‚ 3ã€@property CFTimeInterval instanceDelay; è®¾ç½®å¤åˆ¶å­å±‚çš„å»¶è¿ŸåŠ¨ç”»æ—¶é•¿ 4ã€@property CATransform3D instanceTransform; è®¾ç½®å¤åˆ¶å­å±‚çš„ç›¸å¯¹ä½ç½® 5ã€@property(nullable) CGColorRef instanceColor; å­å±‚é¢œè‰²ï¼Œä¼šå’ŒåŸç”Ÿå­å±‚èƒŒæ™¯è‰²å†²çªï¼Œå› æ­¤äºŒè€…é€‰å…¶ä¸€è®¾ç½® 6ã€@property float instanceRedOffset;è®¾ç½®æ¯ä¸ªå¤åˆ¶å›¾å±‚ç›¸å¯¹ä¸Šä¸€ä¸ªå¤åˆ¶å›¾å±‚çš„çº¢è‰²åç§»é‡ 7ã€@property float instanceRedOffset;è®¾ç½®æ¯ä¸ªå¤åˆ¶å›¾å±‚ç›¸å¯¹ä¸Šä¸€ä¸ªå¤åˆ¶å›¾å±‚çš„ç»¿è‰²åç§»é‡ 8ã€@property float instanceBlueOffset;è®¾ç½®æ¯ä¸ªå¤åˆ¶å›¾å±‚ç›¸å¯¹ä¸Šä¸€ä¸ªå¤åˆ¶å›¾å±‚çš„è“è‰²åç§»é‡ 9ã€@property float instanceAlphaOffset;è®¾ç½®æ¯ä¸ªå¤åˆ¶å›¾å±‚ç›¸å¯¹ä¸Šä¸€ä¸ªå¤åˆ¶å›¾å±‚çš„é€æ˜åº¦åç§»é‡","categories":[],"tags":[{"name":"åŠ¨ç”»","slug":"åŠ¨ç”»","permalink":"https://github.com/wuvdan/wuvdan.github.io/tags/%E5%8A%A8%E7%94%BB/"}]},{"title":"iOSåŠ¨ç”»-CAAniamtionçš„å±æ€§å’Œä½¿ç”¨","slug":"iOSåŠ¨ç”»-CAAniamtionçš„å±æ€§å’Œä½¿ç”¨","date":"2020-01-16T08:04:36.468Z","updated":"2020-01-20T01:47:28.698Z","comments":true,"path":"2020/01/16/iOSåŠ¨ç”»-CAAniamtionçš„å±æ€§å’Œä½¿ç”¨/","link":"","permalink":"https://github.com/wuvdan/wuvdan.github.io/2020/01/16/iOS%E5%8A%A8%E7%94%BB-CAAniamtion%E7%9A%84%E5%B1%9E%E6%80%A7%E5%92%8C%E4%BD%BF%E7%94%A8/","excerpt":"","text":"CAAnimationCAAnimationæ˜¯æ‰€æœ‰åŠ¨ç”»å¯¹è±¡çš„çˆ¶ç±»ï¼Œè´Ÿè´£æ§åˆ¶åŠ¨ç”»çš„æŒç»­æ—¶é—´å’Œé€Ÿåº¦ï¼Œæ˜¯ä¸ªæŠ½è±¡ç±»ï¼Œä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼Œåº”è¯¥ä½¿ç”¨å®ƒå…·ä½“çš„å­ç±»ã€‚ å±æ€§ durationï¼šåŠ¨ç”»çš„æŒç»­æ—¶é—´ repeatCountï¼šåŠ¨ç”»çš„é‡å¤æ¬¡æ•° repeatDurationï¼šåŠ¨ç”»çš„é‡å¤æ—¶é—´ removedOnCompletionï¼šé»˜è®¤ä¸ºYESï¼Œä»£è¡¨åŠ¨ç”»æ‰§è¡Œå®Œæ¯•åå°±ä»å›¾å±‚ä¸Šç§»é™¤ï¼Œå›¾å½¢ä¼šæ¢å¤åˆ°åŠ¨ç”»æ‰§è¡Œå‰çš„çŠ¶æ€ã€‚å¦‚æœæƒ³è®©å›¾å±‚ä¿æŒæ˜¾ç¤ºåŠ¨ç”»æ‰§è¡Œåçš„çŠ¶æ€ï¼Œé‚£å°±è®¾ç½®ä¸ºNOï¼Œä¸è¿‡è¿˜è¦è®¾ç½®fillModeä¸ºkCAFillModeForwards fillModeï¼šå†³å®šå½“å‰å¯¹è±¡åœ¨éactiveæ—¶é—´æ®µçš„è¡Œä¸ºã€‚æ¯”å¦‚åŠ¨ç”»å¼€å§‹ä¹‹å‰,åŠ¨ç”»ç»“æŸä¹‹å beginTimeï¼šå¯ä»¥ç”¨æ¥è®¾ç½®åŠ¨ç”»å»¶è¿Ÿæ‰§è¡Œæ—¶é—´ï¼Œè‹¥æƒ³å»¶è¿Ÿ2sï¼Œå°±è®¾ç½®ä¸ºCACurrentMediaTime()+2ï¼ŒCACurrentMediaTime()ä¸ºå›¾å±‚çš„å½“å‰æ—¶é—´ timingFunctionï¼šé€Ÿåº¦æ§åˆ¶å‡½æ•°ï¼Œæ§åˆ¶åŠ¨ç”»è¿è¡Œçš„èŠ‚å¥ delegateï¼šåŠ¨ç”»ä»£ç† å­ç±»1.CAPropertyAnimationæ˜¯CAAnimationçš„å­ç±»ï¼Œä¹Ÿæ˜¯ä¸ªæŠ½è±¡ç±»ï¼Œè¦æƒ³åˆ›å»ºåŠ¨ç”»å¯¹è±¡ï¼Œåº”è¯¥ä½¿ç”¨å®ƒçš„ä¸¤ä¸ªå­ç±»ï¼šCABasicAnimationå’ŒCAKeyframeAnimationã€‚ keyPath é€šè¿‡æŒ‡å®šCALayerçš„ä¸€ä¸ªå±æ€§åç§°ä¸ºkeyPath(NSStringç±»å‹)ï¼Œå¹¶ä¸”å¯¹CALayerçš„è¿™ä¸ªå±æ€§çš„å€¼è¿›è¡Œä¿®æ”¹ï¼Œè¾¾åˆ°ç›¸åº”çš„åŠ¨ç”»æ•ˆæœã€‚æ¯”å¦‚ï¼ŒæŒ‡å®š@â€positionâ€ä¸ºkeyPathï¼Œå°±ä¿®æ”¹CALayerçš„positionå±æ€§çš„å€¼ï¼Œä»¥è¾¾åˆ°å¹³ç§»çš„åŠ¨ç”»æ•ˆæœã€‚ 2.CABasicAnimation fromValueï¼škeyPathç›¸åº”å±æ€§çš„åˆå§‹å€¼ã€‚ toValueï¼škeyPathç›¸åº”å±æ€§çš„ç»“æŸå€¼ã€‚ éšç€åŠ¨ç”»çš„è¿›è¡Œï¼Œåœ¨é•¿åº¦ä¸ºdurationçš„æŒç»­æ—¶é—´å†…ï¼ŒkeyPathç›¸åº”å±æ€§çš„å€¼ä»fromValueæ¸æ¸åœ°å˜ä¸ºtoValueã€‚ å¦‚æœfillMode=kCAFillModeForwardså’ŒremovedOnComletion=NOï¼Œé‚£ä¹ˆåœ¨åŠ¨ç”»æ‰§è¡Œå®Œæ¯•åï¼Œå›¾å±‚ä¼šä¿æŒæ˜¾ç¤ºåŠ¨ç”»æ‰§è¡Œåçš„çŠ¶æ€ã€‚ä½†åœ¨å®è´¨ä¸Šï¼Œå›¾å±‚çš„å±æ€§å€¼è¿˜æ˜¯åŠ¨ç”»æ‰§è¡Œå‰çš„åˆå§‹å€¼ï¼Œå¹¶æ²¡æœ‰çœŸæ­£è¢«æ”¹å˜ã€‚æ¯”å¦‚ï¼ŒCALayerçš„positionåˆå§‹å€¼ä¸º(0,0)ï¼ŒCABasicAnimationçš„fromValueä¸º(10,10)ï¼ŒtoValueä¸º(100,100)ï¼Œè™½ç„¶åŠ¨ç”»æ‰§è¡Œå®Œæ¯•åå›¾å±‚ä¿æŒåœ¨(100,100)è¿™ä¸ªä½ç½®ï¼Œå®è´¨ä¸Šå›¾å±‚çš„positionè¿˜æ˜¯ä¸º(0,0)ã€‚ 3.CAKeyframeAnimationCApropertyAnimationçš„å­ç±»ï¼Œè·ŸCABasicAnimationçš„åŒºåˆ«æ˜¯ï¼šCABasicAnimationåªèƒ½ä»ä¸€ä¸ªæ•°å€¼(fromValue)å˜åˆ°å¦ä¸€ä¸ªæ•°å€¼(toValue)ï¼Œè€ŒCAKeyframeAnimationä¼šä½¿ç”¨ä¸€ä¸ªNSArrayä¿å­˜è¿™äº›æ•°å€¼ã€‚ valuesï¼šå°±æ˜¯ä¸Šè¿°çš„NSArrayå¯¹è±¡ã€‚é‡Œé¢çš„å…ƒç´ ç§°ä¸ºâ€å…³é”®å¸§â€(keyframe)ã€‚åŠ¨ç”»å¯¹è±¡ä¼šåœ¨æŒ‡å®šçš„æ—¶é—´(duration)å†…ï¼Œä¾æ¬¡æ˜¾ç¤ºvaluesæ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå…³é”®å¸§ã€‚ pathï¼šå¯ä»¥è®¾ç½®ä¸€ä¸ªCGPathRef\\CGMutablePathRef,è®©å±‚è·Ÿç€è·¯å¾„ç§»åŠ¨ã€‚pathåªå¯¹CALayerçš„anchorPointå’Œpositionèµ·ä½œç”¨ã€‚å¦‚æœä½ è®¾ç½®äº†pathï¼Œé‚£ä¹ˆvalueså°†è¢«å¿½ç•¥ã€‚ keyTimesï¼šå¯ä»¥ä¸ºå¯¹åº”çš„å…³é”®å¸§æŒ‡å®šå¯¹åº”çš„æ—¶é—´ç‚¹,å…¶å–å€¼èŒƒå›´ä¸º0åˆ°1.0,keyTimesä¸­çš„æ¯ä¸€ä¸ªæ—¶é—´å€¼éƒ½å¯¹åº”valuesä¸­çš„æ¯ä¸€å¸§.å½“keyTimesæ²¡æœ‰è®¾ç½®çš„æ—¶å€™,å„ä¸ªå…³é”®å¸§çš„æ—¶é—´æ˜¯å¹³åˆ†çš„ã€‚ CABasicAnimationå¯çœ‹åšæ˜¯æœ€å¤šåªæœ‰2ä¸ªå…³é”®å¸§çš„CAKeyframeAnimationã€‚ 4.CAAnimationGroupCAAnimationçš„å­ç±»ï¼Œå¯ä»¥ä¿å­˜ä¸€ç»„åŠ¨ç”»å¯¹è±¡ï¼Œå°†CAAnimationGroupå¯¹è±¡åŠ å…¥å±‚åï¼Œç»„ä¸­æ‰€æœ‰åŠ¨ç”»å¯¹è±¡å¯ä»¥åŒæ—¶å¹¶å‘è¿è¡Œã€‚ animationsï¼šç”¨æ¥ä¿å­˜ä¸€ç»„åŠ¨ç”»å¯¹è±¡çš„NSArrayã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸€ç»„åŠ¨ç”»å¯¹è±¡æ˜¯åŒæ—¶è¿è¡Œçš„ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è®¾ç½®åŠ¨ç”»å¯¹è±¡çš„beginTimeå±æ€§æ¥æ›´æ”¹åŠ¨ç”»çš„å¼€å§‹æ—¶é—´ã€‚ 5.CATransitionCAAnimationçš„å­ç±»ï¼Œç”¨äºåšè½¬åœºåŠ¨ç”»ï¼Œèƒ½å¤Ÿä¸ºå±‚æä¾›ç§»å‡ºå±å¹•å’Œç§»å…¥å±å¹•çš„åŠ¨ç”»æ•ˆæœã€‚iOSæ¯”Mac OS Xçš„è½¬åœºåŠ¨ç”»æ•ˆæœå°‘ä¸€ç‚¹ã€‚UINavigationControllerå°±æ˜¯é€šè¿‡CATransitionå®ç°äº†å°†æ§åˆ¶å™¨çš„è§†å›¾æ¨å…¥å±å¹•çš„åŠ¨ç”»æ•ˆæœã€‚ typeï¼šåŠ¨ç”»è¿‡æ¸¡ç±»å‹ã€‚ subtypeï¼šåŠ¨ç”»è¿‡æ¸¡æ–¹å‘ã€‚ startProgressï¼šåŠ¨ç”»èµ·ç‚¹(åœ¨æ•´ä½“åŠ¨ç”»çš„ç™¾åˆ†æ¯”)ã€‚ endProgressï¼šåŠ¨ç”»ç»ˆç‚¹(åœ¨æ•´ä½“åŠ¨ç”»çš„ç™¾åˆ†æ¯”)ã€‚","categories":[],"tags":[{"name":"åŠ¨ç”»","slug":"åŠ¨ç”»","permalink":"https://github.com/wuvdan/wuvdan.github.io/tags/%E5%8A%A8%E7%94%BB/"}]},{"title":"iOSç¬¬ä¸‰æ–¹åº“-YYCache","slug":"iOSç¬¬ä¸‰æ–¹åº“-YYCache","date":"2020-01-16T08:04:32.541Z","updated":"2020-01-20T02:36:22.701Z","comments":true,"path":"2020/01/16/iOSç¬¬ä¸‰æ–¹åº“-YYCache/","link":"","permalink":"https://github.com/wuvdan/wuvdan.github.io/2020/01/16/iOS%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93-YYCache/","excerpt":"","text":"ç®€ä»‹ä¸€ä¸ªé«˜æ€§èƒ½ iOS ç¼“å­˜æ¡†æ¶ã€‚ ä¸»è¦ç”±YYDiskCacheä¸YYMemoryCacheç»„æˆã€‚å…¶ä¸­YYDiskCacheæ˜¯ä½œä¸ºæŒä¹…åŒ–å‚¨å­˜ï¼Œé€šè¿‡sqliteçš„å½¢å¼å‚¨å­˜åœ¨æ²™ç›’ä¸­Library/Caches/&lt;ç¼“å­˜åœ°å€åç§°&gt;ã€‚ç¼“å­˜çš„å¯¹è±¡éœ€è¦éµå¾ªNSCodingåè®®ï¼Œå¹¶å®ç°åè®®æ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡YYModelä¸€é”®å½’æ¡£ã€‚ 12345678- (void)encodeWithCoder:(NSCoder*)aCoder &#123; [self yy_modelEncodeWithCoder:aCoder];&#125;- (id)initWithCoder:(NSCoder*)aDecoder &#123; self &#x3D; [super init]; return [self yy_modelInitWithCoder:aDecoder];&#125; æ¥å£è¯´æ˜123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566@interface YYCache : NSObject&#x2F;** ç¼“å­˜çš„åç§° *&#x2F;@property (copy, readonly) NSString *name;&#x2F;** å†…å­˜ç¼“å­˜ *&#x2F;@property (strong, readonly) YYMemoryCache *memoryCache;&#x2F;** ç£ç›˜ç¼“å­˜ *&#x2F;@property (strong, readonly) YYDiskCache *diskCache;&#x2F;** åˆå§‹åŒ–æ–¹å¼ä¸€ï¼Œè®¾ç½®ç¼“å­˜åç§° *&#x2F;- (nullable instancetype)initWithName:(NSString *)name;&#x2F;** åˆå§‹åŒ–æ–¹å¼äºŒï¼Œè®¾ç½®ç¼“å­˜è·¯å¾„ *&#x2F;- (nullable instancetype)initWithPath:(NSString *)path NS_DESIGNATED_INITIALIZER;&#x2F;** ä¾¿åˆ©æ„é€ åˆå§‹åŒ–ï¼Œè®¾ç½®ç¼“å­˜åç§° *&#x2F;+ (nullable instancetype)cacheWithName:(NSString *)name;&#x2F;** ä¾¿åˆ©æ„é€ åˆå§‹åŒ–ï¼Œè®¾ç½®ç¼“å­˜è·¯å¾„ *&#x2F;+ (nullable instancetype)cacheWithPath:(NSString *)path;&#x2F;** æ–¹æ³•å¤±æ•ˆ *&#x2F;- (instancetype)init UNAVAILABLE_ATTRIBUTE;&#x2F;** æ–¹æ³•å¤±æ•ˆ *&#x2F;+ (instancetype)new UNAVAILABLE_ATTRIBUTE;#pragma mark - Access Methods&#x2F;&#x2F;&#x2F;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x2F;&#x2F;&#x2F; @name Access Methods&#x2F;&#x2F;&#x2F;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x2F;** åˆ¤æ–­ç¼“å­˜ä¸­æ˜¯å¦å­˜åœ¨ç›¸åŒkeyå€¼çš„æ•°æ® *&#x2F;- (BOOL)containsObjectForKey:(NSString *)key;&#x2F;** å¼‚æ­¥ åˆ¤æ–­ç¼“å­˜ä¸­æ˜¯å¦å­˜åœ¨ç›¸åŒkeyå€¼çš„æ•°æ® *&#x2F;- (void)containsObjectForKey:(NSString *)key withBlock:(nullable void(^)(NSString *key, BOOL contains))block;&#x2F;** é€šè¿‡keyå€¼è·å–ç¼“å­˜æ•°æ® *&#x2F;- (nullable id&lt;NSCoding&gt;)objectForKey:(NSString *)key;&#x2F;** å¼‚æ­¥é€šè¿‡keyå€¼è·å–ç¼“å­˜æ•°æ® *&#x2F;- (void)objectForKey:(NSString *)key withBlock:(nullable void(^)(NSString *key, id&lt;NSCoding&gt; object))block;&#x2F;** é€šè¿‡keyå€¼ï¼Œè®¾ç½®ç¼“å­˜æ•°æ® *&#x2F;- (void)setObject:(nullable id&lt;NSCoding&gt;)object forKey:(NSString *)key;&#x2F;** å¼‚æ­¥é€šè¿‡keyå€¼ï¼Œè®¾ç½®ç¼“å­˜æ•°æ® *&#x2F;- (void)setObject:(nullable id&lt;NSCoding&gt;)object forKey:(NSString *)key withBlock:(nullable void(^)(void))block;&#x2F;** é€šè¿‡keyå€¼ï¼Œæ¸…é™¤ç¼“å­˜æ•°æ® *&#x2F;- (void)removeObjectForKey:(NSString *)key;&#x2F;** å¼‚æ­¥é€šè¿‡keyå€¼ï¼Œæ¸…é™¤ç¼“å­˜æ•°æ® *&#x2F;- (void)removeObjectForKey:(NSString *)key withBlock:(nullable void(^)(NSString *key))block;&#x2F;** æ¸…é™¤æ‰€æœ‰ç¼“å­˜æ•°æ® *&#x2F;- (void)removeAllObjects;&#x2F;** å¼‚æ­¥æ¸…é™¤æ‰€æœ‰ç¼“å­˜æ•°æ® *&#x2F;- (void)removeAllObjectsWithBlock:(void(^)(void))block;&#x2F;** å¼‚æ­¥æ¸…é™¤æ‰€æœ‰ç¼“å­˜æ•°æ®ï¼Œå¹¶è·å–æ¸…é™¤è¿›ç¨‹å’Œæ˜¯å¦æ¸…é™¤å¤±è´¥ *&#x2F;- (void)removeAllObjectsWithProgressBlock:(nullable void(^)(int removedCount, int totalCount))progress endBlock:(nullable void(^)(BOOL error))end; ä½¿ç”¨å®ä¾‹Model 12345678910111213141516171819202122232425262728#import &lt;Foundation&#x2F;Foundation.h&gt;NS_ASSUME_NONNULL_BEGIN@interface TestModel : NSObject &lt;NSCoding&gt;@property (nonatomic, copy) NSString *name;@property (nonatomic, assign) NSInteger age;@property (nonatomic, assign) bool sex;@endNS_ASSUME_NONNULL_END&#x2F;&#x2F;--------------------åˆ†ç•Œçº¿--------------------&#x2F;&#x2F;#import &quot;TestModel.h&quot;#import &lt;YYModel.h&gt;@implementation TestModel- (void)encodeWithCoder:(NSCoder*)aCoder &#123; [self yy_modelEncodeWithCoder:aCoder];&#125;- (id)initWithCoder:(NSCoder*)aDecoder &#123; self &#x3D; [super init]; return [self yy_modelInitWithCoder:aDecoder];&#125;@end æ·»åŠ åˆ°ç¼“å­˜ä¸­ 12345678910111213141516171819202122232425YYCache *cache &#x3D; [YYCache cacheWithName:@&quot;CacheName&quot;];TestModel *model &#x3D; [[TestModel alloc] init];model.name &#x3D; @&quot;test&quot;;model.age &#x3D; 11;model.sex &#x3D; NO;TestModel *model1 &#x3D; [[TestModel alloc] init];model1.name &#x3D; @&quot;tes2&quot;;model1.age &#x3D; 22;model1.sex &#x3D; YES;TestModel *model2 &#x3D; [[TestModel alloc] init];model2.name &#x3D; @&quot;tes3&quot;;model2.age &#x3D; 33;model2.sex &#x3D; NO;NSArray&lt;TestModel *&gt; *array &#x3D; @[model, model1, model2];[cache setObject:array forKey:@&quot;Test&quot;];NSArray&lt;TestModel *&gt; *tArray &#x3D; [cache objectForKey:@&quot;Test&quot;];for (TestModel *m in tArray) &#123; NSLog(@&quot;name:%@----age:%ld---sex:%d&quot;, m.name, m.age, m.sex);&#125; è·å–ç¼“å­˜ä¸­çš„æ•°æ® 1232019-05-16 11:59:12.918221+0800 YYKitDemo[8347:173145] name:test----age:11---sex:02019-05-16 11:59:12.918342+0800 YYKitDemo[8347:173145] name:tes2----age:22---sex:12019-05-16 11:59:12.918412+0800 YYKitDemo[8347:173145] name:tes3----age:33---sex:0","categories":[{"name":"åº•å±‚åŸç†","slug":"åº•å±‚åŸç†","permalink":"https://github.com/wuvdan/wuvdan.github.io/categories/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/"}],"tags":[{"name":"ç¬¬ä¸‰æ–¹åº“","slug":"ç¬¬ä¸‰æ–¹åº“","permalink":"https://github.com/wuvdan/wuvdan.github.io/tags/%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93/"}]},{"title":"iOSç¬¬ä¸‰æ–¹åº“-RxSwiftå­¦ä¹ æ—¥å¸¸ï¼ˆåŸºç¡€ä»‹ç»ï¼‰","slug":"iOSç¬¬ä¸‰æ–¹åº“-RxSwiftå­¦ä¹ æ—¥å¸¸ï¼ˆåŸºç¡€ä»‹ç»ï¼‰","date":"2020-01-16T08:04:28.943Z","updated":"2020-01-20T02:35:51.402Z","comments":true,"path":"2020/01/16/iOSç¬¬ä¸‰æ–¹åº“-RxSwiftå­¦ä¹ æ—¥å¸¸ï¼ˆåŸºç¡€ä»‹ç»ï¼‰/","link":"","permalink":"https://github.com/wuvdan/wuvdan.github.io/2020/01/16/iOS%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93-RxSwift%E5%AD%A6%E4%B9%A0%E6%97%A5%E5%B8%B8%EF%BC%88%E5%9F%BA%E7%A1%80%E4%BB%8B%E7%BB%8D%EF%BC%89/","excerpt":"","text":"Observable ä»‹ç»Observable Observable è¿™ä¸ªç±»å°±æ˜¯ Rx æ¡†æ¶çš„åŸºç¡€ï¼Œæˆ‘ä»¬å¯ä»¥ç§°å®ƒä¸ºå¯è§‚å¯Ÿåºåˆ—ã€‚å®ƒçš„ä½œç”¨å°±æ˜¯å¯ä»¥å¼‚æ­¥åœ°äº§ç”Ÿä¸€ç³»åˆ—çš„ Eventï¼ˆäº‹ä»¶ï¼‰ï¼Œå³ä¸€ä¸ª Observable å¯¹è±¡ä¼šéšç€æ—¶é—´æ¨ç§»ä¸å®šæœŸåœ°å‘å‡º event(element : T) è¿™æ ·ä¸€ä¸ªä¸œè¥¿ã€‚ è€Œä¸”è¿™äº› Event è¿˜å¯ä»¥æºå¸¦æ•°æ®ï¼Œå®ƒçš„æ³›å‹ å°±æ˜¯ç”¨æ¥æŒ‡å®šè¿™ä¸ª Event æºå¸¦çš„æ•°æ®çš„ç±»å‹ã€‚ æœ‰äº†å¯è§‚å¯Ÿåºåˆ—ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æœ‰ä¸€ä¸ª Observerï¼ˆè®¢é˜…è€…ï¼‰æ¥è®¢é˜…å®ƒï¼Œè¿™æ ·è¿™ä¸ªè®¢é˜…è€…æ‰èƒ½æ”¶åˆ° Observable ä¸æ—¶å‘å‡ºçš„ Eventã€‚EventæŸ¥çœ‹ RxSwift æºç å¯ä»¥å‘ç°ï¼Œäº‹ä»¶ Event çš„å®šä¹‰å¦‚ä¸‹ï¼š 12345678910public enum Event&lt;Element&gt; &#123; &#x2F;&#x2F;&#x2F; Next element is produced. case next(Element) &#x2F;&#x2F;&#x2F; Sequence terminated with an error. case error(Swift.Error) &#x2F;&#x2F;&#x2F; Sequence completed successfully. case completed&#125; å¯ä»¥çœ‹åˆ° Event å°±æ˜¯ä¸€ä¸ªæšä¸¾ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ª Observable æ˜¯å¯ä»¥å‘å‡º 3 ç§ä¸åŒç±»å‹çš„ Event äº‹ä»¶ï¼š nextï¼šnext äº‹ä»¶å°±æ˜¯é‚£ä¸ªå¯ä»¥æºå¸¦æ•°æ® çš„äº‹ä»¶ï¼Œå¯ä»¥è¯´å®ƒå°±æ˜¯ä¸€ä¸ªâ€œæœ€æ­£å¸¸â€çš„äº‹ä»¶ã€‚ errorï¼šerror äº‹ä»¶è¡¨ç¤ºä¸€ä¸ªé”™è¯¯ï¼Œå®ƒå¯ä»¥æºå¸¦å…·ä½“çš„é”™è¯¯å†…å®¹ï¼Œä¸€æ—¦ Observable å‘å‡ºäº† error eventï¼Œåˆ™è¿™ä¸ª Observable å°±ç­‰äºç»ˆæ­¢äº†ï¼Œä»¥åå®ƒå†ä¹Ÿä¸ä¼šå‘å‡º event äº‹ä»¶äº†ã€‚ completedï¼šcompleted äº‹ä»¶è¡¨ç¤º Observable å‘å‡ºçš„äº‹ä»¶æ­£å¸¸åœ°ç»“æŸäº†ï¼Œè·Ÿ error ä¸€æ ·ï¼Œä¸€æ—¦ Observable å‘å‡ºäº† completed eventï¼Œåˆ™è¿™ä¸ª Observable å°±ç­‰äºç»ˆæ­¢äº†ï¼Œä»¥åå®ƒå†ä¹Ÿä¸ä¼šå‘å‡º event äº‹ä»¶äº†Observable ä¸ Sequenceæ¯”è¾ƒ(1)ã€ä¸ºæ›´å¥½åœ°ç†è§£ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ¯ä¸€ä¸ª Observable çš„å®ä¾‹æƒ³è±¡æˆäºä¸€ä¸ª Swift ä¸­çš„ Sequenceï¼š å³ä¸€ä¸ª Observableï¼ˆObservableTypeï¼‰ç›¸å½“äºä¸€ä¸ªåºåˆ— Sequenceï¼ˆSequenceTypeï¼‰ã€‚ ObservableType.subscribe(_:) æ–¹æ³•å…¶å®å°±ç›¸å½“äº SequenceType.generate()ã€‚ (2)ã€ä½†å®ƒä»¬ä¹‹é—´è¿˜æ˜¯æœ‰è®¸å¤šåŒºåˆ«çš„ï¼š Swift ä¸­çš„ SequenceType æ˜¯åŒæ­¥çš„å¾ªç¯ï¼Œè€Œ Observable æ˜¯å¼‚æ­¥çš„ã€‚ Observable å¯¹è±¡ä¼šåœ¨æœ‰ä»»ä½• Event æ—¶å€™ï¼Œè‡ªåŠ¨å°† Event ä½œä¸ºä¸€ä¸ªå‚æ•°é€šè¿‡ ObservableType.subscribe(_:) å‘å‡ºï¼Œå¹¶ä¸éœ€è¦ä½¿ç”¨ next æ–¹æ³•ã€‚åˆ›å»º Observable åºåˆ—just() æ–¹æ³•ï¼ˆ1ï¼‰è¯¥æ–¹æ³•é€šè¿‡ä¼ å…¥ä¸€ä¸ªé»˜è®¤å€¼æ¥åˆå§‹åŒ–ã€‚ï¼ˆ2ï¼‰ä¸‹é¢æ ·ä¾‹æˆ‘ä»¬æ˜¾å¼åœ°æ ‡æ³¨å‡ºäº† observable çš„ç±»å‹ä¸º Observableï¼Œå³æŒ‡å®šäº†è¿™ä¸ª Observable æ‰€å‘å‡ºçš„äº‹ä»¶æºå¸¦çš„æ•°æ®ç±»å‹å¿…é¡»æ˜¯ Int ç±»å‹çš„ã€‚ 1let observable &#x3D; Observable&lt;Int&gt;.just(5) of() æ–¹æ³•ï¼ˆ1ï¼‰è¯¥æ–¹æ³•å¯ä»¥æ¥å—å¯å˜æ•°é‡çš„å‚æ•°ï¼ˆå¿…éœ€è¦æ˜¯åŒç±»å‹çš„ï¼‰ï¼ˆ2ï¼‰ä¸‹é¢æ ·ä¾‹ä¸­æˆ‘æ²¡æœ‰æ˜¾å¼åœ°å£°æ˜å‡º Observable çš„æ³›å‹ç±»å‹ï¼ŒSwift ä¹Ÿä¼šè‡ªåŠ¨æ¨æ–­ç±»å‹ã€‚ 1let observable &#x3D; Observable.of(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;) from() æ–¹æ³•ï¼ˆ1ï¼‰è¯¥æ–¹æ³•éœ€è¦ä¸€ä¸ªæ•°ç»„å‚æ•°ã€‚ï¼ˆ2ï¼‰ä¸‹é¢æ ·ä¾‹ä¸­æ•°æ®é‡Œçš„å…ƒç´ å°±ä¼šè¢«å½“åšè¿™ä¸ª Observable æ‰€å‘å‡º event æºå¸¦çš„æ•°æ®å†…å®¹ï¼Œæœ€ç»ˆæ•ˆæœåŒä¸Šé¢é¥¿ of() æ ·ä¾‹æ˜¯ä¸€æ ·çš„ã€‚ 1let observable &#x3D; Observable.from([&quot;A&quot;, &quot;B&quot;, &quot;C&quot;]) empty() æ–¹æ³•è¯¥æ–¹æ³•åˆ›å»ºä¸€ä¸ªç©ºå†…å®¹çš„ Observable åºåˆ—ã€‚ 1let observable &#x3D; Observable&lt;Int&gt;.empty() never() æ–¹æ³•è¯¥æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ°¸è¿œä¸ä¼šå‘å‡º Eventï¼ˆä¹Ÿä¸ä¼šç»ˆæ­¢ï¼‰çš„ Observable åºåˆ—ã€‚ 1let observable &#x3D; Observable&lt;Int&gt;.never() error() æ–¹æ³•è¯¥æ–¹æ³•åˆ›å»ºä¸€ä¸ªä¸åšä»»ä½•æ“ä½œï¼Œè€Œæ˜¯ç›´æ¥å‘é€ä¸€ä¸ªé”™è¯¯çš„ Observable åºåˆ—ã€‚ 123456enum MyError: Error &#123; case A case B&#125; let observable &#x3D; Observable&lt;Int&gt;.error(MyError.A) range() æ–¹æ³•ï¼ˆ1ï¼‰è¯¥æ–¹æ³•é€šè¿‡æŒ‡å®šèµ·å§‹å’Œç»“æŸæ•°å€¼ï¼Œåˆ›å»ºä¸€ä¸ªä»¥è¿™ä¸ªèŒƒå›´å†…æ‰€æœ‰å€¼ä½œä¸ºåˆå§‹å€¼çš„ Observable åºåˆ—ã€‚ï¼ˆ2ï¼‰ä¸‹é¢æ ·ä¾‹ä¸­ï¼Œä¸¤ç§æ–¹æ³•åˆ›å»ºçš„ Observable åºåˆ—éƒ½æ˜¯ä¸€æ ·çš„ã€‚ 12345&#x2F;&#x2F;ä½¿ç”¨range()let observable &#x3D; Observable.range(start: 1, count: 5) &#x2F;&#x2F;ä½¿ç”¨of()let observable &#x3D; Observable.of(1, 2, 3 ,4 ,5) repeatElement() æ–¹æ³•è¯¥æ–¹æ³•åˆ›å»ºä¸€ä¸ªå¯ä»¥æ— é™å‘å‡ºç»™å®šå…ƒç´ çš„ Event çš„ Observable åºåˆ—ï¼ˆæ°¸ä¸ç»ˆæ­¢ï¼‰ã€‚ 1let observable &#x3D; Observable.repeatElement(1) generate() æ–¹æ³•ï¼ˆ1ï¼‰è¯¥æ–¹æ³•åˆ›å»ºä¸€ä¸ªåªæœ‰å½“æä¾›çš„æ‰€æœ‰çš„åˆ¤æ–­æ¡ä»¶éƒ½ä¸º true çš„æ—¶å€™ï¼Œæ‰ä¼šç»™å‡ºåŠ¨ä½œçš„ Observable åºåˆ—ã€‚ï¼ˆ2ï¼‰ä¸‹é¢æ ·ä¾‹ä¸­ï¼Œä¸¤ç§æ–¹æ³•åˆ›å»ºçš„ Observable åºåˆ—éƒ½æ˜¯ä¸€æ ·çš„ã€‚ 123456789&#x2F;&#x2F;ä½¿ç”¨generate()æ–¹æ³•let observable &#x3D; Observable.generate( initialState: 0, condition: &#123; $0 &lt;&#x3D; 10 &#125;, iterate: &#123; $0 + 2 &#125;) &#x2F;&#x2F;ä½¿ç”¨of()æ–¹æ³•let observable &#x3D; Observable.of(0 , 2 ,4 ,6 ,8 ,10) create() æ–¹æ³•ï¼ˆ1ï¼‰è¯¥æ–¹æ³•æ¥å—ä¸€ä¸ª block å½¢å¼çš„å‚æ•°ï¼Œä»»åŠ¡æ˜¯å¯¹æ¯ä¸€ä¸ªè¿‡æ¥çš„è®¢é˜…è¿›è¡Œå¤„ç†ã€‚ï¼ˆ2ï¼‰ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„æ ·ä¾‹ã€‚ä¸ºæ–¹ä¾¿æ¼”ç¤ºï¼Œè¿™é‡Œå¢åŠ äº†è®¢é˜…ç›¸å…³ä»£ç ï¼ˆå…³äºè®¢é˜…æˆ‘ä¹‹åä¼šè¯¦ç»†ä»‹ç»çš„ï¼‰ã€‚ 123456789101112131415&#x2F;&#x2F;è¿™ä¸ªblockæœ‰ä¸€ä¸ªå›è°ƒå‚æ•°observerå°±æ˜¯è®¢é˜…è¿™ä¸ªObservableå¯¹è±¡çš„è®¢é˜…è€…&#x2F;&#x2F;å½“ä¸€ä¸ªè®¢é˜…è€…è®¢é˜…è¿™ä¸ªObservableå¯¹è±¡çš„æ—¶å€™ï¼Œå°±ä¼šå°†è®¢é˜…è€…ä½œä¸ºå‚æ•°ä¼ å…¥è¿™ä¸ªblockæ¥æ‰§è¡Œä¸€äº›å†…å®¹let observable &#x3D; Observable&lt;String&gt;.create&#123;observer in &#x2F;&#x2F;å¯¹è®¢é˜…è€…å‘å‡ºäº†.nextäº‹ä»¶ï¼Œä¸”æºå¸¦äº†ä¸€ä¸ªæ•°æ®&quot;hangge.com&quot; observer.onNext(&quot;hangge.com&quot;) &#x2F;&#x2F;å¯¹è®¢é˜…è€…å‘å‡ºäº†.completedäº‹ä»¶ observer.onCompleted() &#x2F;&#x2F;å› ä¸ºä¸€ä¸ªè®¢é˜…è¡Œä¸ºä¼šæœ‰ä¸€ä¸ªDisposableç±»å‹çš„è¿”å›å€¼ï¼Œæ‰€ä»¥åœ¨ç»“å°¾ä¸€å®šè¦returenä¸€ä¸ªDisposable return Disposables.create()&#125; &#x2F;&#x2F;è®¢é˜…æµ‹è¯•observable.subscribe &#123; print($0)&#125; deferred() æ–¹æ³•è¯¥ä¸ªæ–¹æ³•ç›¸å½“äºæ˜¯åˆ›å»ºä¸€ä¸ª Observable å·¥å‚ï¼Œé€šè¿‡ä¼ å…¥ä¸€ä¸ª block æ¥æ‰§è¡Œå»¶è¿Ÿ Observable åºåˆ—åˆ›å»ºçš„è¡Œä¸ºï¼Œè€Œè¿™ä¸ª block é‡Œå°±æ˜¯çœŸæ­£çš„å®ä¾‹åŒ–åºåˆ—å¯¹è±¡çš„åœ°æ–¹ã€‚ 1234567891011121314151617181920212223242526&#x2F;&#x2F;ç”¨äºæ ‡è®°æ˜¯å¥‡æ•°ã€è¿˜æ˜¯å¶æ•°var isOdd &#x3D; true &#x2F;&#x2F;ä½¿ç”¨deferred()æ–¹æ³•å»¶è¿ŸObservableåºåˆ—çš„åˆå§‹åŒ–ï¼Œé€šè¿‡ä¼ å…¥çš„blockæ¥å®ç°Observableåºåˆ—çš„åˆå§‹åŒ–å¹¶ä¸”è¿”å›ã€‚let factory : Observable&lt;Int&gt; &#x3D; Observable.deferred &#123; &#x2F;&#x2F;è®©æ¯æ¬¡æ‰§è¡Œè¿™ä¸ªblockæ—¶å€™éƒ½ä¼šè®©å¥‡ã€å¶æ•°è¿›è¡Œäº¤æ›¿ isOdd &#x3D; !isOdd &#x2F;&#x2F;æ ¹æ®isOddå‚æ•°ï¼Œå†³å®šåˆ›å»ºå¹¶è¿”å›çš„æ˜¯å¥‡æ•°Observableã€è¿˜æ˜¯å¶æ•°Observable if isOdd &#123; return Observable.of(1, 3, 5 ,7) &#125;else &#123; return Observable.of(2, 4, 6, 8) &#125;&#125; &#x2F;&#x2F;ç¬¬1æ¬¡è®¢é˜…æµ‹è¯•factory.subscribe &#123; event in print(&quot;\\(isOdd)&quot;, event)&#125; &#x2F;&#x2F;ç¬¬2æ¬¡è®¢é˜…æµ‹è¯•factory.subscribe &#123; event in print(&quot;\\(isOdd)&quot;, event)&#125; interval() æ–¹æ³•ï¼ˆ1ï¼‰è¿™ä¸ªæ–¹æ³•åˆ›å»ºçš„ Observable åºåˆ—æ¯éš”ä¸€æ®µè®¾å®šçš„æ—¶é—´ï¼Œä¼šå‘å‡ºä¸€ä¸ªç´¢å¼•æ•°çš„å…ƒç´ ã€‚è€Œä¸”å®ƒä¼šä¸€ç›´å‘é€ä¸‹å»ã€‚ï¼ˆ2ï¼‰ä¸‹é¢æ–¹æ³•è®©å…¶æ¯ 1 ç§’å‘é€ä¸€æ¬¡ï¼Œå¹¶ä¸”æ˜¯åœ¨ä¸»çº¿ç¨‹ï¼ˆMainSchedulerï¼‰å‘é€ã€‚ 1234let observable &#x3D; Observable&lt;Int&gt;.interval(1, scheduler: MainScheduler.instance)observable.subscribe &#123; event in print(event)&#125; timer() æ–¹æ³•ï¼ˆ1ï¼‰è¿™ä¸ªæ–¹æ³•æœ‰ä¸¤ç§ç”¨æ³•ï¼Œä¸€ç§æ˜¯åˆ›å»ºçš„ Observable åºåˆ—åœ¨ç»è¿‡è®¾å®šçš„ä¸€æ®µæ—¶é—´åï¼Œäº§ç”Ÿå”¯ä¸€çš„ä¸€ä¸ªå…ƒç´ ã€‚ 12345&#x2F;&#x2F;5ç§’ç§åå‘å‡ºå”¯ä¸€çš„ä¸€ä¸ªå…ƒç´ 0let observable &#x3D; Observable&lt;Int&gt;.timer(5, scheduler: MainScheduler.instance)observable.subscribe &#123; event in print(event)&#125; ï¼ˆ2ï¼‰å¦ä¸€ç§æ˜¯åˆ›å»ºçš„ Observable åºåˆ—åœ¨ç»è¿‡è®¾å®šçš„ä¸€æ®µæ—¶é—´åï¼Œæ¯éš”ä¸€æ®µæ—¶é—´äº§ç”Ÿä¸€ä¸ªå…ƒç´ ã€‚ 12345&#x2F;&#x2F;å»¶æ—¶5ç§’ç§åï¼Œæ¯éš”1ç§’é’Ÿå‘å‡ºä¸€ä¸ªå…ƒç´ let observable &#x3D; Observable&lt;Int&gt;.timer(5, period: 1, scheduler: MainScheduler.instance)observable.subscribe &#123; event in print(event)&#125; è®¢é˜… Observableç¬¬ä¸€ç§ç”¨æ³•ï¼šï¼ˆ1ï¼‰æˆ‘ä»¬ä½¿ç”¨ subscribe() è®¢é˜…äº†ä¸€ä¸ª Observable å¯¹è±¡ï¼Œè¯¥æ–¹æ³•çš„ block çš„å›è°ƒå‚æ•°å°±æ˜¯è¢«å‘å‡ºçš„ event äº‹ä»¶ï¼Œæˆ‘ä»¬å°†å…¶ç›´æ¥æ‰“å°å‡ºæ¥ã€‚ 12345let observable &#x3D; Observable.of(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;) observable.subscribe &#123; event in print(event)&#125; è¾“å…¥ç»“æœå¯ä»¥çœ‹å‡º åˆå§‹åŒ– Observable åºåˆ—æ—¶è®¾ç½®çš„é»˜è®¤å€¼éƒ½æŒ‰é¡ºåºé€šè¿‡ .next äº‹ä»¶å‘é€å‡ºæ¥ã€‚ å½“ Observable åºåˆ—çš„åˆå§‹æ•°æ®éƒ½å‘é€å®Œæ¯•ï¼Œå®ƒè¿˜ä¼šè‡ªåŠ¨å‘ä¸€ä¸ª .completed äº‹ä»¶å‡ºæ¥ã€‚ ï¼ˆ2ï¼‰å¦‚æœæƒ³è¦è·å–åˆ°è¿™ä¸ªäº‹ä»¶é‡Œçš„æ•°æ®ï¼Œå¯ä»¥é€šè¿‡ event.element å¾—åˆ°ã€‚ 12345let observable &#x3D; Observable.of(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;) observable.subscribe &#123; event in print(event.element)&#125; ç¬¬äºŒç§ç”¨æ³•ï¼šï¼ˆ1ï¼‰RxSwift è¿˜æä¾›äº†å¦ä¸€ä¸ª subscribe æ–¹æ³•ï¼Œå®ƒå¯ä»¥æŠŠ event è¿›è¡Œåˆ†ç±»ï¼š é€šè¿‡ä¸åŒçš„ block å›è°ƒå¤„ç†ä¸åŒç±»å‹çš„ eventã€‚ï¼ˆå…¶ä¸­ onDisposed è¡¨ç¤ºè®¢é˜…è¡Œä¸ºè¢« dispose åçš„å›è°ƒï¼Œè¿™ä¸ªæˆ‘åé¢ä¼šè¯´ï¼‰ åŒæ—¶ä¼šæŠŠ event æºå¸¦çš„æ•°æ®ç›´æ¥è§£åŒ…å‡ºæ¥ä½œä¸ºå‚æ•°ï¼Œæ–¹ä¾¿æˆ‘ä»¬ä½¿ç”¨ã€‚1234567891011let observable &#x3D; Observable.of(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;) observable.subscribe(onNext: &#123; element in print(element)&#125;, onError: &#123; error in print(error)&#125;, onCompleted: &#123; print(&quot;completed&quot;)&#125;, onDisposed: &#123; print(&quot;disposed&quot;)&#125;) 2ï¼‰subscribe() æ–¹æ³•çš„ onNextã€onErrorã€onCompleted å’Œ onDisposed è¿™å››ä¸ªå›è°ƒ block å‚æ•°éƒ½æ˜¯æœ‰é»˜è®¤å€¼çš„ï¼Œå³å®ƒä»¬éƒ½æ˜¯å¯é€‰çš„ã€‚æ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯ä»¥åªå¤„ç† onNext è€Œä¸ç®¡å…¶ä»–çš„æƒ…å†µã€‚12345let observable &#x3D; Observable.of(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;) observable.subscribe(onNext: &#123; element in print(element)&#125;) ç›‘å¬äº‹ä»¶çš„ç”Ÿå‘½å‘¨æœŸ1ã€ doOn ä»‹ç»ï¼ˆ1ï¼‰æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ doOn æ–¹æ³•æ¥ç›‘å¬äº‹ä»¶çš„ç”Ÿå‘½å‘¨æœŸï¼Œå®ƒä¼šåœ¨æ¯ä¸€æ¬¡äº‹ä»¶å‘é€å‰è¢«è°ƒç”¨ã€‚ï¼ˆ2ï¼‰åŒæ—¶å®ƒå’Œ subscribe ä¸€æ ·ï¼Œå¯ä»¥é€šè¿‡ä¸åŒçš„ block å›è°ƒå¤„ç†ä¸åŒç±»å‹çš„ eventã€‚æ¯”å¦‚ï¼š do(onNext:) æ–¹æ³•å°±æ˜¯åœ¨ subscribe(onNext:) å‰è°ƒç”¨ è€Œ do(onCompleted:) æ–¹æ³•åˆ™ä¼šåœ¨ subscribe(onCompleted:) å‰é¢è°ƒç”¨ã€‚ ä½¿ç”¨æ ·ä¾‹123456789101112131415161718192021let observable &#x3D; Observable.of(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;) observable .do(onNext: &#123; element in print(&quot;Intercepted Nextï¼š&quot;, element) &#125;, onError: &#123; error in print(&quot;Intercepted Errorï¼š&quot;, error) &#125;, onCompleted: &#123; print(&quot;Intercepted Completed&quot;) &#125;, onDispose: &#123; print(&quot;Intercepted Disposed&quot;) &#125;) .subscribe(onNext: &#123; element in print(element) &#125;, onError: &#123; error in print(error) &#125;, onCompleted: &#123; print(&quot;completed&quot;) &#125;, onDisposed: &#123; print(&quot;disposed&quot;) &#125;) Observable çš„é”€æ¯ï¼ˆDisposeï¼‰1ã€Observable ä»åˆ›å»ºåˆ°ç»ˆç»“æµç¨‹ï¼ˆ1ï¼‰ä¸€ä¸ª Observable åºåˆ—è¢«åˆ›å»ºå‡ºæ¥åå®ƒä¸ä¼šé©¬ä¸Šå°±å¼€å§‹è¢«æ¿€æ´»ä»è€Œå‘å‡º Eventï¼Œè€Œæ˜¯è¦ç­‰åˆ°å®ƒè¢«æŸä¸ªäººè®¢é˜…äº†æ‰ä¼šæ¿€æ´»å®ƒã€‚ï¼ˆ2ï¼‰è€Œ Observable åºåˆ—æ¿€æ´»ä¹‹åè¦ä¸€ç›´ç­‰åˆ°å®ƒå‘å‡ºäº† .error æˆ–è€… .completed çš„ event åï¼Œå®ƒæ‰è¢«ç»ˆç»“ã€‚ 2ã€dispose() æ–¹æ³•ï¼ˆ1ï¼‰ä½¿ç”¨è¯¥æ–¹æ³•æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨å–æ¶ˆä¸€ä¸ªè®¢é˜…è¡Œä¸ºã€‚ï¼ˆ2ï¼‰å¦‚æœæˆ‘ä»¬è§‰å¾—è¿™ä¸ªè®¢é˜…ç»“æŸäº†ä¸å†éœ€è¦äº†ï¼Œå°±å¯ä»¥è°ƒç”¨ dispose() æ–¹æ³•æŠŠè¿™ä¸ªè®¢é˜…ç»™é”€æ¯æ‰ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼ã€‚ï¼ˆ2ï¼‰å½“ä¸€ä¸ªè®¢é˜…è¡Œä¸ºè¢« dispose äº†ï¼Œé‚£ä¹ˆä¹‹å observable å¦‚æœå†å‘å‡º eventï¼Œè¿™ä¸ªå·²ç» dispose çš„è®¢é˜…å°±æ”¶ä¸åˆ°æ¶ˆæ¯äº†ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä½¿ç”¨æ ·ä¾‹ã€‚ 123456789let observable &#x3D; Observable.of(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;) &#x2F;&#x2F;ä½¿ç”¨subscriptionå¸¸é‡å­˜å‚¨è¿™ä¸ªè®¢é˜…æ–¹æ³•let subscription &#x3D; observable.subscribe &#123; event in print(event)&#125; &#x2F;&#x2F;è°ƒç”¨è¿™ä¸ªè®¢é˜…çš„dispose()æ–¹æ³•subscription.dispose() 3ã€DisposeBagé™¤äº† dispose() æ–¹æ³•ä¹‹å¤–ï¼Œæˆ‘ä»¬æ›´ç»å¸¸ç”¨åˆ°çš„æ˜¯ä¸€ä¸ªå« DisposeBag çš„å¯¹è±¡æ¥ç®¡ç†å¤šä¸ªè®¢é˜…è¡Œä¸ºçš„é”€æ¯ï¼šæˆ‘ä»¬å¯ä»¥æŠŠä¸€ä¸ª DisposeBag å¯¹è±¡çœ‹æˆä¸€ä¸ªåƒåœ¾è¢‹ï¼ŒæŠŠç”¨è¿‡çš„è®¢é˜…è¡Œä¸ºéƒ½æ”¾è¿›å»ã€‚è€Œè¿™ä¸ª DisposeBag å°±ä¼šåœ¨è‡ªå·±å¿«è¦ dealloc çš„æ—¶å€™ï¼Œå¯¹å®ƒé‡Œé¢çš„æ‰€æœ‰è®¢é˜…è¡Œä¸ºéƒ½è°ƒç”¨ dispose() æ–¹æ³•ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä½¿ç”¨æ ·ä¾‹ã€‚ 12345678910111213let disposeBag &#x3D; DisposeBag() &#x2F;&#x2F;ç¬¬1ä¸ªObservableï¼ŒåŠå…¶è®¢é˜…let observable1 &#x3D; Observable.of(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;)observable1.subscribe &#123; event in print(event)&#125;.disposed(by: disposeBag) &#x2F;&#x2F;ç¬¬2ä¸ªObservableï¼ŒåŠå…¶è®¢é˜…let observable2 &#x3D; Observable.of(1, 2, 3)observable2.subscribe &#123; event in print(event)&#125;.disposed(by: disposeBag) è§‚å¯Ÿè€…ï¼ˆObserverï¼‰ä»‹ç»è§‚å¯Ÿè€…ï¼ˆObserverï¼‰çš„ä½œç”¨å°±æ˜¯ç›‘å¬äº‹ä»¶ï¼Œç„¶åå¯¹è¿™ä¸ªäº‹ä»¶åšå‡ºå“åº”ã€‚æˆ–è€…è¯´ä»»ä½•å“åº”äº‹ä»¶çš„è¡Œä¸ºéƒ½æ˜¯è§‚å¯Ÿè€…ã€‚æ¯”å¦‚ï¼š å½“æˆ‘ä»¬ç‚¹å‡»æŒ‰é’®ï¼Œå¼¹å‡ºä¸€ä¸ªæç¤ºæ¡†ã€‚é‚£ä¹ˆè¿™ä¸ªâ€œå¼¹å‡ºä¸€ä¸ªæç¤ºæ¡†â€å°±æ˜¯è§‚å¯Ÿè€… Observer å½“æˆ‘ä»¬è¯·æ±‚ä¸€ä¸ªè¿œç¨‹çš„ json æ•°æ®åï¼Œå°†å…¶æ‰“å°å‡ºæ¥ã€‚é‚£ä¹ˆè¿™ä¸ªâ€œæ‰“å° json æ•°æ®â€å°±æ˜¯è§‚å¯Ÿè€… Observer ç›´æ¥åœ¨ subscribeã€bind æ–¹æ³•ä¸­åˆ›å»ºè§‚å¯Ÿè€…1. åœ¨ subscribe æ–¹æ³•ä¸­åˆ›å»ºï¼ˆ1ï¼‰åˆ›å»ºè§‚å¯Ÿè€…æœ€ç›´æ¥çš„æ–¹æ³•å°±æ˜¯åœ¨ Observable çš„ subscribe æ–¹æ³•åé¢æè¿°å½“äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œéœ€è¦å¦‚ä½•åšå‡ºå“åº”ã€‚ï¼ˆ2ï¼‰æ¯”å¦‚ä¸‹é¢çš„æ ·ä¾‹ï¼Œè§‚å¯Ÿè€…å°±æ˜¯ç”±åé¢çš„ onNextï¼ŒonErrorï¼ŒonCompleted è¿™äº›é—­åŒ…æ„å»ºå‡ºæ¥çš„ã€‚ 123456789let observable &#x3D; Observable.of(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;) observable.subscribe(onNext: &#123; element in print(element)&#125;, onError: &#123; error in print(error)&#125;, onCompleted: &#123; print(&quot;completed&quot;)&#125;) 2. åœ¨ bind æ–¹æ³•ä¸­åˆ›å»ºä¸‹é¢ä»£ç æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå®šæ—¶ç”Ÿæˆç´¢å¼•æ•°çš„ Observable åºåˆ—ï¼Œå¹¶å°†ç´¢å¼•æ•°ä¸æ–­æ˜¾ç¤ºåœ¨ label æ ‡ç­¾ä¸Šï¼š 123456789101112131415161718192021222324import UIKitimport RxSwiftimport RxCocoa class ViewController: UIViewController &#123; @IBOutlet weak var label: UILabel! let disposeBag &#x3D; DisposeBag() override func viewDidLoad() &#123; &#x2F;&#x2F;Observableåºåˆ—ï¼ˆæ¯éš”1ç§’é’Ÿå‘å‡ºä¸€ä¸ªç´¢å¼•æ•°ï¼‰ let observable &#x3D; Observable&lt;Int&gt;.interval(1, scheduler: MainScheduler.instance) observable .map &#123; &quot;å½“å‰ç´¢å¼•æ•°ï¼š\\($0 )&quot;&#125; .bind &#123; [weak self](text) in &#x2F;&#x2F;æ”¶åˆ°å‘å‡ºçš„ç´¢å¼•æ•°åæ˜¾ç¤ºåˆ°labelä¸Š self?.label.text &#x3D; text &#125; .disposed(by: disposeBag) &#125;&#125; ä½¿ç”¨ AnyObserver åˆ›å»ºè§‚å¯Ÿè€…AnyObserver å¯ä»¥ç”¨æ¥æå™ä»»æ„ä¸€ç§è§‚å¯Ÿè€…ã€‚ 1ã€é…åˆ subscribe æ–¹æ³•ä½¿ç”¨æ¯”å¦‚ä¸Šé¢ç¬¬ä¸€ä¸ªæ ·ä¾‹æˆ‘ä»¬å¯ä»¥æ”¹æˆå¦‚ä¸‹ä»£ç ï¼š 1234567891011121314&#x2F;&#x2F;è§‚å¯Ÿè€…let observer: AnyObserver&lt;String&gt; &#x3D; AnyObserver &#123; (event) in switch event &#123; case .next(let data): print(data) case .error(let error): print(error) case .completed: print(&quot;completed&quot;) &#125;&#125; let observable &#x3D; Observable.of(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;)observable.subscribe(observer) 2ã€é…åˆ bindTo æ–¹æ³•ä½¿ç”¨ä¹Ÿå¯é…åˆ Observable çš„æ•°æ®ç»‘å®šæ–¹æ³•ï¼ˆbindToï¼‰ä½¿ç”¨ã€‚æ¯”å¦‚ä¸Šé¢çš„ç¬¬äºŒä¸ªæ ·ä¾‹æˆ‘å¯ä»¥æ”¹æˆå¦‚ä¸‹ä»£ç ï¼š 12345678910111213141516171819202122232425262728293031import UIKitimport RxSwiftimport RxCocoa class ViewController: UIViewController &#123; @IBOutlet weak var label: UILabel! let disposeBag &#x3D; DisposeBag() override func viewDidLoad() &#123; &#x2F;&#x2F;è§‚å¯Ÿè€… let observer: AnyObserver&lt;String&gt; &#x3D; AnyObserver &#123; [weak self] (event) in switch event &#123; case .next(let text): &#x2F;&#x2F;æ”¶åˆ°å‘å‡ºçš„ç´¢å¼•æ•°åæ˜¾ç¤ºåˆ°labelä¸Š self?.label.text &#x3D; text default: break &#125; &#125; &#x2F;&#x2F;Observableåºåˆ—ï¼ˆæ¯éš”1ç§’é’Ÿå‘å‡ºä¸€ä¸ªç´¢å¼•æ•°ï¼‰ let observable &#x3D; Observable&lt;Int&gt;.interval(1, scheduler: MainScheduler.instance) observable .map &#123; &quot;å½“å‰ç´¢å¼•æ•°ï¼š\\($0 )&quot;&#125; .bind(to: observer) .disposed(by: disposeBag) &#125;&#125; ä½¿ç”¨ Binder åˆ›å»ºè§‚å¯Ÿè€…1ã€åŸºæœ¬ä»‹ç»ï¼ˆ1ï¼‰ç›¸è¾ƒäº AnyObserver çš„å¤§è€Œå…¨ï¼ŒBinder æ›´ä¸“æ³¨äºç‰¹å®šçš„åœºæ™¯ã€‚Binder ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ä¸ªç‰¹å¾ï¼š ä¸ä¼šå¤„ç†é”™è¯¯äº‹ä»¶ ç¡®ä¿ç»‘å®šéƒ½æ˜¯åœ¨ç»™å®š Scheduler ä¸Šæ‰§è¡Œï¼ˆé»˜è®¤ MainSchedulerï¼‰ ï¼ˆ2ï¼‰ä¸€æ—¦äº§ç”Ÿé”™è¯¯äº‹ä»¶ï¼Œåœ¨è°ƒè¯•ç¯å¢ƒä¸‹å°†æ‰§è¡Œ fatalErrorï¼Œåœ¨å‘å¸ƒç¯å¢ƒä¸‹å°†æ‰“å°é”™è¯¯ä¿¡æ¯ã€‚ ä½¿ç”¨æ ·ä¾‹ï¼ˆ1ï¼‰åœ¨ä¸Šé¢åºåˆ—æ•°æ˜¾ç¤ºæ ·ä¾‹ä¸­ï¼Œlabel æ ‡ç­¾çš„æ–‡å­—æ˜¾ç¤ºå°±æ˜¯ä¸€ä¸ªå…¸å‹çš„ UI è§‚å¯Ÿè€…ã€‚å®ƒåœ¨å“åº”äº‹ä»¶æ—¶ï¼Œåªä¼šå¤„ç† next äº‹ä»¶ï¼Œè€Œä¸”æ›´æ–° UI çš„æ“ä½œéœ€è¦åœ¨ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œã€‚é‚£ä¹ˆè¿™ç§æƒ…å†µä¸‹æ›´å¥½çš„æ–¹æ¡ˆå°±æ˜¯ä½¿ç”¨ Binderã€‚ï¼ˆ2ï¼‰ä¸Šé¢çš„æ ·ä¾‹æˆ‘ä»¬æ”¹ç”¨ Binder ä¼šç®€å•è®¸å¤šï¼š 1234567891011121314151617181920212223242526import UIKitimport RxSwiftimport RxCocoa class ViewController: UIViewController &#123; @IBOutlet weak var label: UILabel! let disposeBag &#x3D; DisposeBag() override func viewDidLoad() &#123; &#x2F;&#x2F;è§‚å¯Ÿè€… let observer: Binder&lt;String&gt; &#x3D; Binder(label) &#123; (view, text) in &#x2F;&#x2F;æ”¶åˆ°å‘å‡ºçš„ç´¢å¼•æ•°åæ˜¾ç¤ºåˆ°labelä¸Š view.text &#x3D; text &#125; &#x2F;&#x2F;Observableåºåˆ—ï¼ˆæ¯éš”1ç§’é’Ÿå‘å‡ºä¸€ä¸ªç´¢å¼•æ•°ï¼‰ let observable &#x3D; Observable&lt;Int&gt;.interval(1, scheduler: MainScheduler.instance) observable .map &#123; &quot;å½“å‰ç´¢å¼•æ•°ï¼š\\($0 )&quot;&#125; .bind(to: observer) .disposed(by: disposeBag) &#125;&#125; é™„ï¼šBinder åœ¨ RxCocoa ä¸­çš„åº”ç”¨ï¼ˆ1ï¼‰å…¶å® RxCocoa åœ¨å¯¹è®¸å¤š UI æ§ä»¶è¿›è¡Œæ‰©å±•æ—¶ï¼Œå°±åˆ©ç”¨ Binder å°†æ§ä»¶å±æ€§å˜æˆè§‚æŸ¥è€…ï¼Œæ¯”å¦‚ UIControl+Rx.swift ä¸­çš„ isEnabled å±æ€§ä¾¿æ˜¯ä¸€ä¸ª observer ï¼š 123456789101112import RxSwiftimport UIKit extension Reactive where Base: UIControl &#123; &#x2F;&#x2F;&#x2F; Bindable sink for &#96;enabled&#96; property. public var isEnabled: Binder&lt;Bool&gt; &#123; return Binder(self.base) &#123; control, value in control.isEnabled &#x3D; value &#125; &#125;&#125; ï¼ˆ2ï¼‰å› æ­¤æˆ‘ä»¬å¯ä»¥å°†åºåˆ—ç›´æ¥ç»‘å®šåˆ°å®ƒä¸Šé¢ã€‚æ¯”å¦‚ä¸‹é¢æ ·ä¾‹ï¼Œbutton ä¼šåœ¨å¯ç”¨ã€ä¸å¯ç”¨è¿™ä¸¤ç§çŠ¶æ€é—´äº¤æ›¿å˜æ¢ï¼ˆæ¯éš”ä¸€ç§’ï¼‰ã€‚ 123456&#x2F;&#x2F;Observableåºåˆ—ï¼ˆæ¯éš”1ç§’é’Ÿå‘å‡ºä¸€ä¸ªç´¢å¼•æ•°ï¼‰let observable &#x3D; Observable&lt;Int&gt;.interval(1, scheduler: MainScheduler.instance)observable .map &#123; $0 % 2 &#x3D;&#x3D; 0 &#125; .bind(to: button.rx.isEnabled) .disposed(by: disposeBag) è‡ªå®šä¹‰å¯ç»‘å®šå±æ€§æœ‰æ—¶æˆ‘ä»¬æƒ³è®© UI æ§ä»¶åˆ›å»ºå‡ºæ¥åé»˜è®¤å°±æœ‰ä¸€äº›è§‚å¯Ÿè€…ï¼Œè€Œä¸å¿…æ¯æ¬¡éƒ½ä¸ºå®ƒä»¬å•ç‹¬å»åˆ›å»ºè§‚å¯Ÿè€…ã€‚æ¯”å¦‚æˆ‘ä»¬æƒ³è¦è®©æ‰€æœ‰çš„ UIlabel éƒ½æœ‰ä¸ª fontSize å¯ç»‘å®šå±æ€§ï¼Œå®ƒä¼šæ ¹æ®äº‹ä»¶å€¼è‡ªåŠ¨æ”¹å˜æ ‡ç­¾çš„å­—ä½“å¤§å°ã€‚ æ–¹å¼ä¸€ï¼šé€šè¿‡å¯¹ UI ç±»è¿›è¡Œæ‰©å±•è¿™é‡Œæˆ‘ä»¬é€šè¿‡å¯¹ UILabel è¿›è¡Œæ‰©å±•ï¼Œå¢åŠ äº†ä¸€ä¸ª fontSize å¯ç»‘å®šå±æ€§ã€‚ 12345678910111213141516171819202122232425262728import UIKitimport RxSwiftimport RxCocoa class ViewController: UIViewController &#123; @IBOutlet weak var label: UILabel! let disposeBag &#x3D; DisposeBag() override func viewDidLoad() &#123; &#x2F;&#x2F;Observableåºåˆ—ï¼ˆæ¯éš”0.5ç§’é’Ÿå‘å‡ºä¸€ä¸ªç´¢å¼•æ•°ï¼‰ let observable &#x3D; Observable&lt;Int&gt;.interval(0.5, scheduler: MainScheduler.instance) observable .map &#123; CGFloat($0) &#125; .bind(to: label.fontSize) &#x2F;&#x2F;æ ¹æ®ç´¢å¼•æ•°ä¸æ–­å˜æ”¾å¤§å­—ä½“ .disposed(by: disposeBag) &#125;&#125; extension UILabel &#123; public var fontSize: Binder&lt;CGFloat&gt; &#123; return Binder(self) &#123; label, fontSize in label.font &#x3D; UIFont.systemFont(ofSize: fontSize) &#125; &#125;&#125; æ–¹å¼äºŒï¼šé€šè¿‡å¯¹ Reactive ç±»è¿›è¡Œæ‰©å±•æ—¢ç„¶ä½¿ç”¨äº† RxSwiftï¼Œé‚£ä¹ˆæ›´è§„èŒƒçš„å†™æ³•åº”è¯¥æ˜¯å¯¹ Reactive è¿›è¡Œæ‰©å±•ã€‚è¿™é‡ŒåŒæ ·æ˜¯ç»™ UILabel å¢åŠ äº†ä¸€ä¸ª fontSize å¯ç»‘å®šå±æ€§ã€‚ï¼ˆæ³¨æ„ï¼šè¿™ç§æ–¹å¼ä¸‹ï¼Œæˆ‘ä»¬ç»‘å®šå±æ€§æ—¶è¦å†™æˆ label.rx.fontSizeï¼‰ 12345678910111213141516171819202122232425262728import UIKitimport RxSwiftimport RxCocoa class ViewController: UIViewController &#123; @IBOutlet weak var label: UILabel! let disposeBag &#x3D; DisposeBag() override func viewDidLoad() &#123; &#x2F;&#x2F;Observableåºåˆ—ï¼ˆæ¯éš”0.5ç§’é’Ÿå‘å‡ºä¸€ä¸ªç´¢å¼•æ•°ï¼‰ let observable &#x3D; Observable&lt;Int&gt;.interval(0.5, scheduler: MainScheduler.instance) observable .map &#123; CGFloat($0) &#125; .bind(to: label.rx.fontSize) &#x2F;&#x2F;æ ¹æ®ç´¢å¼•æ•°ä¸æ–­å˜æ”¾å¤§å­—ä½“ .disposed(by: disposeBag) &#125;&#125; extension Reactive where Base: UILabel &#123; public var fontSize: Binder&lt;CGFloat&gt; &#123; return Binder(self.base) &#123; label, fontSize in label.font &#x3D; UIFont.systemFont(ofSize: fontSize) &#125; &#125;&#125; RxSwift è‡ªå¸¦çš„å¯ç»‘å®šå±æ€§ï¼ˆUI è§‚å¯Ÿè€…ï¼‰ï¼ˆ1ï¼‰å…¶å® RxSwift å·²ç»ä¸ºæˆ‘ä»¬æä¾›è®¸å¤šå¸¸ç”¨çš„å¯ç»‘å®šå±æ€§ã€‚æ¯”å¦‚ UILabel å°±æœ‰ text å’Œ attributedText è¿™ä¸¤ä¸ªå¯ç»‘å®šå±æ€§ã€‚ 1234567891011121314151617181920import RxSwiftimport UIKit extension Reactive where Base: UILabel &#123; &#x2F;&#x2F;&#x2F; Bindable sink for &#96;text&#96; property. public var text: Binder&lt;String?&gt; &#123; return Binder(self.base) &#123; label, text in label.text &#x3D; text &#125; &#125; &#x2F;&#x2F;&#x2F; Bindable sink for &#96;attributedText&#96; property. public var attributedText: Binder&lt;NSAttributedString?&gt; &#123; return Binder(self.base) &#123; label, text in label.attributedText &#x3D; text &#125; &#125; &#125; ï¼ˆ2ï¼‰é‚£ä¹ˆä¸Šæ–‡é‚£ä¸ªå®šæ—¶æ˜¾ç¤ºç´¢å¼•æ•°çš„æ ·ä¾‹ï¼Œæˆ‘ä»¬å…¶å®ä¸éœ€è¦è‡ªå®šä¹‰ UI è§‚å¯Ÿè€…ï¼Œç›´æ¥ä½¿ç”¨ RxSwift æä¾›çš„ç»‘å®šå±æ€§å³å¯ã€‚ 1234567891011121314151617181920import UIKitimport RxSwiftimport RxCocoa class ViewController: UIViewController &#123; @IBOutlet weak var label: UILabel! let disposeBag &#x3D; DisposeBag() override func viewDidLoad() &#123; &#x2F;&#x2F;Observableåºåˆ—ï¼ˆæ¯éš”1ç§’é’Ÿå‘å‡ºä¸€ä¸ªç´¢å¼•æ•°ï¼‰ let observable &#x3D; Observable&lt;Int&gt;.interval(1, scheduler: MainScheduler.instance) observable .map &#123; &quot;å½“å‰ç´¢å¼•æ•°ï¼š\\($0 )&quot;&#125; .bind(to: label.rx.text) &#x2F;&#x2F;æ”¶åˆ°å‘å‡ºçš„ç´¢å¼•æ•°åæ˜¾ç¤ºåˆ°labelä¸Š .disposed(by: disposeBag) &#125;&#125; Subjects ä»‹ç»Subjects åŸºæœ¬ä»‹ç»ï¼ˆ1ï¼‰Subjects æ—¢æ˜¯è®¢é˜…è€…ï¼Œä¹Ÿæ˜¯ Observableï¼š è¯´å®ƒæ˜¯è®¢é˜…è€…ï¼Œæ˜¯å› ä¸ºå®ƒèƒ½å¤ŸåŠ¨æ€åœ°æ¥æ”¶æ–°çš„å€¼ã€‚ è¯´å®ƒåˆæ˜¯ä¸€ä¸ª Observableï¼Œæ˜¯å› ä¸ºå½“ Subjects æœ‰äº†æ–°çš„å€¼ä¹‹åï¼Œå°±ä¼šé€šè¿‡ Event å°†æ–°å€¼å‘å‡ºç»™ä»–çš„æ‰€æœ‰è®¢é˜…è€…ã€‚ ï¼ˆ2ï¼‰ä¸€å…±æœ‰å››ç§ Subjectsï¼Œåˆ†åˆ«ä¸ºï¼šPublishSubjectã€BehaviorSubjectã€ReplaySubjectã€Variableã€‚ä»–ä»¬ä¹‹é—´æ—¢æœ‰å„è‡ªçš„ç‰¹ç‚¹ï¼Œä¹Ÿæœ‰ç›¸åŒä¹‹å¤„ï¼š é¦–å…ˆä»–ä»¬éƒ½æ˜¯ Observableï¼Œä»–ä»¬çš„è®¢é˜…è€…éƒ½èƒ½æ”¶åˆ°ä»–ä»¬å‘å‡ºçš„æ–°çš„ Eventã€‚ ç›´åˆ° Subject å‘å‡º .complete æˆ–è€… .error çš„ Event åï¼Œè¯¥ Subject ä¾¿ç»ˆç»“äº†ï¼ŒåŒæ—¶å®ƒä¹Ÿå°±ä¸ä¼šå†å‘å‡º .next äº‹ä»¶ã€‚ å¯¹äºé‚£äº›åœ¨ Subject ç»ˆç»“åå†è®¢é˜…ä»–çš„è®¢é˜…è€…ï¼Œä¹Ÿèƒ½æ”¶åˆ° subject å‘å‡ºçš„ä¸€æ¡ .complete æˆ– .error çš„ eventï¼Œå‘Šè¯‰è¿™ä¸ªæ–°çš„è®¢é˜…è€…å®ƒå·²ç»ç»ˆç»“äº†ã€‚ ä»–ä»¬ä¹‹é—´æœ€å¤§çš„åŒºåˆ«åªæ˜¯åœ¨äºï¼šå½“ä¸€ä¸ªæ–°çš„è®¢é˜…è€…åˆšè®¢é˜…å®ƒçš„æ—¶å€™ï¼Œèƒ½ä¸èƒ½æ”¶åˆ° Subject ä»¥å‰å‘å‡ºè¿‡çš„æ—§ Eventï¼Œå¦‚æœèƒ½çš„è¯åˆèƒ½æ”¶åˆ°å¤šå°‘ä¸ªã€‚ ï¼ˆ3ï¼‰Subject å¸¸ç”¨çš„å‡ ä¸ªæ–¹æ³•ï¼š onNext(:)ï¼šæ˜¯ on(.next(:)) çš„ç®€ä¾¿å†™æ³•ã€‚è¯¥æ–¹æ³•ç›¸å½“äº subject æ¥æ”¶åˆ°ä¸€ä¸ª .next äº‹ä»¶ã€‚ onError(:)ï¼šæ˜¯ on(.error(:)) çš„ç®€ä¾¿å†™æ³•ã€‚è¯¥æ–¹æ³•ç›¸å½“äº subject æ¥æ”¶åˆ°ä¸€ä¸ª .error äº‹ä»¶ã€‚ onCompleted()ï¼šæ˜¯ on(.completed) çš„ç®€ä¾¿å†™æ³•ã€‚è¯¥æ–¹æ³•ç›¸å½“äº subject æ¥æ”¶åˆ°ä¸€ä¸ª .completed äº‹ä»¶ã€‚ PublishSubjectï¼ˆ1ï¼‰åŸºæœ¬ä»‹ç» PublishSubject æ˜¯æœ€æ™®é€šçš„ Subjectï¼Œå®ƒä¸éœ€è¦åˆå§‹å€¼å°±èƒ½åˆ›å»ºã€‚ PublishSubject çš„è®¢é˜…è€…ä»ä»–ä»¬å¼€å§‹è®¢é˜…çš„æ—¶é—´ç‚¹èµ·ï¼Œå¯ä»¥æ”¶åˆ°è®¢é˜…å Subject å‘å‡ºçš„æ–° Eventï¼Œè€Œä¸ä¼šæ”¶åˆ°ä»–ä»¬åœ¨è®¢é˜…å‰å·²å‘å‡ºçš„ Eventã€‚ï¼ˆ2ï¼‰æ—¶åºå›¾ æœ€ä¸Šé¢ä¸€æ¡æ˜¯ BehaviorSubjectã€‚ ä¸‹é¢ä¸¤æ¡åˆ†åˆ«è¡¨ç¤ºä¸¤ä¸ªæ–°çš„è®¢é˜…ï¼Œå®ƒä»¬è®¢é˜…çš„æ—¶é—´ç‚¹ä¸åŒï¼Œå¯ä»¥å‘ç° BehaviorSubject çš„è®¢é˜…è€…ä¸€å¼€å§‹å°±èƒ½æ”¶åˆ° BehaviorSubjects ä¹‹å‰å‘å‡ºçš„ä¸€ä¸ª Eventã€‚ï¼ˆ3ï¼‰ä½¿ç”¨æ ·ä¾‹1234567891011121314151617181920let disposeBag &#x3D; DisposeBag() &#x2F;&#x2F;åˆ›å»ºä¸€ä¸ªBehaviorSubjectlet subject &#x3D; BehaviorSubject(value: &quot;111&quot;) &#x2F;&#x2F;ç¬¬1æ¬¡è®¢é˜…subjectsubject.subscribe &#123; event in print(&quot;ç¬¬1æ¬¡è®¢é˜…ï¼š&quot;, event)&#125;.disposed(by: disposeBag) &#x2F;&#x2F;å‘é€nextäº‹ä»¶subject.onNext(&quot;222&quot;) &#x2F;&#x2F;å‘é€erroräº‹ä»¶subject.onError(NSError(domain: &quot;local&quot;, code: 0, userInfo: nil)) &#x2F;&#x2F;ç¬¬2æ¬¡è®¢é˜…subjectsubject.subscribe &#123; event in print(&quot;ç¬¬2æ¬¡è®¢é˜…ï¼š&quot;, event)&#125;.disposed(by: disposeBag) ReplaySubjectï¼ˆ1ï¼‰åŸºæœ¬ä»‹ç» ReplaySubject åœ¨åˆ›å»ºæ—¶å€™éœ€è¦è®¾ç½®ä¸€ä¸ª bufferSizeï¼Œè¡¨ç¤ºå®ƒå¯¹äºå®ƒå‘é€è¿‡çš„ event çš„ç¼“å­˜ä¸ªæ•°ã€‚ æ¯”å¦‚ä¸€ä¸ª ReplaySubject çš„ bufferSize è®¾ç½®ä¸º 2ï¼Œå®ƒå‘å‡ºäº† 3 ä¸ª .next çš„ eventï¼Œé‚£ä¹ˆå®ƒä¼šå°†åä¸¤ä¸ªï¼ˆæœ€è¿‘çš„ä¸¤ä¸ªï¼‰event ç»™ç¼“å­˜èµ·æ¥ã€‚æ­¤æ—¶å¦‚æœæœ‰ä¸€ä¸ª subscriber è®¢é˜…äº†è¿™ä¸ª ReplaySubjectï¼Œé‚£ä¹ˆè¿™ä¸ª subscriber å°±ä¼šç«‹å³æ”¶åˆ°å‰é¢ç¼“å­˜çš„ä¸¤ä¸ª .next çš„ eventã€‚ å¦‚æœä¸€ä¸ª subscriber è®¢é˜…å·²ç»ç»“æŸçš„ ReplaySubjectï¼Œé™¤äº†ä¼šæ”¶åˆ°ç¼“å­˜çš„ .next çš„ event å¤–ï¼Œè¿˜ä¼šæ”¶åˆ°é‚£ä¸ªç»ˆç»“çš„ .error æˆ–è€… .complete çš„ eventã€‚ ï¼ˆ2ï¼‰æ—¶åºå›¾ æœ€ä¸Šé¢ä¸€æ¡æ˜¯ ReplaySubjectï¼ˆbufferSize è®¾ä¸ºä¸º 2ï¼‰ã€‚ ä¸‹é¢ä¸¤æ¡åˆ†åˆ«è¡¨ç¤ºä¸¤ä¸ªæ–°çš„è®¢é˜…ï¼Œå®ƒä»¬è®¢é˜…çš„æ—¶é—´ç‚¹ä¸åŒã€‚å¯ä»¥å‘ç° ReplaySubject çš„è®¢é˜…è€…ä¸€å¼€å§‹å°±èƒ½æ”¶åˆ° ReplaySubject ä¹‹å‰å‘å‡ºçš„ä¸¤ä¸ª Eventï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚ï¼ˆ3ï¼‰ä½¿ç”¨æ ·ä¾‹123456789101112131415161718192021222324252627282930let disposeBag &#x3D; DisposeBag() &#x2F;&#x2F;åˆ›å»ºä¸€ä¸ªbufferSizeä¸º2çš„ReplaySubjectlet subject &#x3D; ReplaySubject&lt;String&gt;.create(bufferSize: 2) &#x2F;&#x2F;è¿ç»­å‘é€3ä¸ªnextäº‹ä»¶subject.onNext(&quot;111&quot;)subject.onNext(&quot;222&quot;)subject.onNext(&quot;333&quot;) &#x2F;&#x2F;ç¬¬1æ¬¡è®¢é˜…subjectsubject.subscribe &#123; event in print(&quot;ç¬¬1æ¬¡è®¢é˜…ï¼š&quot;, event)&#125;.disposed(by: disposeBag) &#x2F;&#x2F;å†å‘é€1ä¸ªnextäº‹ä»¶subject.onNext(&quot;444&quot;) &#x2F;&#x2F;ç¬¬2æ¬¡è®¢é˜…subjectsubject.subscribe &#123; event in print(&quot;ç¬¬2æ¬¡è®¢é˜…ï¼š&quot;, event)&#125;.disposed(by: disposeBag) &#x2F;&#x2F;è®©subjectç»“æŸsubject.onCompleted() &#x2F;&#x2F;ç¬¬3æ¬¡è®¢é˜…subjectsubject.subscribe &#123; event in print(&quot;ç¬¬3æ¬¡è®¢é˜…ï¼š&quot;, event)&#125;.disposed(by: disposeBag) Variableï¼ˆæ³¨æ„ï¼šç”±äº Variable åœ¨ä¹‹åç‰ˆæœ¬ä¸­å°†è¢«åºŸå¼ƒï¼Œå»ºè®®ä½¿ç”¨ Varible çš„åœ°æ–¹éƒ½æ”¹ç”¨ä¸‹é¢ä»‹ç»çš„ BehaviorRelay ä½œä¸ºæ›¿ä»£ã€‚ï¼‰ï¼ˆ1ï¼‰åŸºæœ¬ä»‹ç» Variable å…¶å®å°±æ˜¯å¯¹ BehaviorSubject çš„å°è£…ï¼Œæ‰€ä»¥å®ƒä¹Ÿå¿…é¡»è¦é€šè¿‡ä¸€ä¸ªé»˜è®¤çš„åˆå§‹å€¼è¿›è¡Œåˆ›å»ºã€‚ Variable å…·æœ‰ BehaviorSubject çš„åŠŸèƒ½ï¼Œèƒ½å¤Ÿå‘å®ƒçš„è®¢é˜…è€…å‘å‡ºä¸Šä¸€ä¸ª event ä»¥åŠä¹‹åæ–°åˆ›å»ºçš„ eventã€‚ ä¸åŒçš„æ˜¯ï¼ŒVariable è¿˜æŠŠä¼šæŠŠå½“å‰å‘å‡ºçš„å€¼ä¿å­˜ä¸ºè‡ªå·±çš„çŠ¶æ€ã€‚åŒæ—¶å®ƒä¼šåœ¨é”€æ¯æ—¶è‡ªåŠ¨å‘é€ .complete çš„ eventï¼Œä¸éœ€è¦ä¹Ÿä¸èƒ½æ‰‹åŠ¨ç»™ Variables å‘é€ completed æˆ–è€… error äº‹ä»¶æ¥ç»“æŸå®ƒã€‚ ç®€å•åœ°è¯´å°±æ˜¯ Variable æœ‰ä¸€ä¸ª value å±æ€§ï¼Œæˆ‘ä»¬æ”¹å˜è¿™ä¸ª value å±æ€§çš„å€¼å°±ç›¸å½“äºè°ƒç”¨ä¸€èˆ¬ Subjects çš„ onNext() æ–¹æ³•ï¼Œè€Œè¿™ä¸ªæœ€æ–°çš„ onNext() çš„å€¼å°±è¢«ä¿å­˜åœ¨ value å±æ€§é‡Œäº†ï¼Œç›´åˆ°æˆ‘ä»¬å†æ¬¡ä¿®æ”¹å®ƒã€‚ æ³¨æ„ï¼šVariables æœ¬èº«æ²¡æœ‰ subscribe() æ–¹æ³•ï¼Œä½†æ˜¯æ‰€æœ‰ Subjects éƒ½æœ‰ä¸€ä¸ª asObservable() æ–¹æ³•ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•è¿”å›è¿™ä¸ª Variable çš„ Observable ç±»å‹ï¼Œæ‹¿åˆ°è¿™ä¸ª Observable ç±»å‹æˆ‘ä»¬å°±èƒ½è®¢é˜…å®ƒäº†ã€‚ ï¼ˆ2ï¼‰ä½¿ç”¨æ ·ä¾‹ 12345678910111213141516171819202122232425262728293031323334import UIKitimport RxSwiftimport RxCocoa class ViewController: UIViewController &#123; override func viewDidLoad() &#123; super.viewDidLoad() let disposeBag &#x3D; DisposeBag() &#x2F;&#x2F;åˆ›å»ºä¸€ä¸ªåˆå§‹å€¼ä¸º111çš„Variable let variable &#x3D; Variable(&quot;111&quot;) &#x2F;&#x2F;ä¿®æ”¹valueå€¼ variable.value &#x3D; &quot;222&quot; &#x2F;&#x2F;ç¬¬1æ¬¡è®¢é˜… variable.asObservable().subscribe &#123; print(&quot;ç¬¬1æ¬¡è®¢é˜…ï¼š&quot;, $0) &#125;.disposed(by: disposeBag) &#x2F;&#x2F;ä¿®æ”¹valueå€¼ variable.value &#x3D; &quot;333&quot; &#x2F;&#x2F;ç¬¬2æ¬¡è®¢é˜… variable.asObservable().subscribe &#123; print(&quot;ç¬¬2æ¬¡è®¢é˜…ï¼š&quot;, $0) &#125;.disposed(by: disposeBag) &#x2F;&#x2F;ä¿®æ”¹valueå€¼ variable.value &#x3D; &quot;444&quot; &#125;&#125; BehaviorRelayï¼ˆ1ï¼‰åŸºæœ¬ä»‹ç» BehaviorRelay æ˜¯ä½œä¸º Variable çš„æ›¿ä»£è€…å‡ºç°çš„ã€‚å®ƒçš„æœ¬è´¨å…¶å®ä¹Ÿæ˜¯å¯¹ BehaviorSubject çš„å°è£…ï¼Œæ‰€ä»¥å®ƒä¹Ÿå¿…é¡»è¦é€šè¿‡ä¸€ä¸ªé»˜è®¤çš„åˆå§‹å€¼è¿›è¡Œåˆ›å»ºã€‚ BehaviorRelay å…·æœ‰ BehaviorSubject çš„åŠŸèƒ½ï¼Œèƒ½å¤Ÿå‘å®ƒçš„è®¢é˜…è€…å‘å‡ºä¸Šä¸€ä¸ª event ä»¥åŠä¹‹åæ–°åˆ›å»ºçš„ eventã€‚ ä¸ BehaviorSubject ä¸åŒçš„æ˜¯ï¼Œä¸éœ€è¦ä¹Ÿä¸èƒ½æ‰‹åŠ¨ç»™ BehaviorReply å‘é€ completed æˆ–è€… error äº‹ä»¶æ¥ç»“æŸå®ƒï¼ˆBehaviorRelay ä¼šåœ¨é”€æ¯æ—¶ä¹Ÿä¸ä¼šè‡ªåŠ¨å‘é€ .complete çš„ eventï¼‰ã€‚ BehaviorRelay æœ‰ä¸€ä¸ª value å±æ€§ï¼Œæˆ‘ä»¬é€šè¿‡è¿™ä¸ªå±æ€§å¯ä»¥è·å–æœ€æ–°å€¼ã€‚è€Œé€šè¿‡å®ƒçš„ accept() æ–¹æ³•å¯ä»¥å¯¹å€¼è¿›è¡Œä¿®æ”¹ã€‚ ï¼ˆ2ï¼‰ä¸Šé¢çš„ Variable æ ·ä¾‹æˆ‘ä»¬å¯ä»¥æ”¹ç”¨æˆ BehaviorRelayï¼Œä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334import UIKitimport RxSwiftimport RxCocoa class ViewController: UIViewController &#123; override func viewDidLoad() &#123; super.viewDidLoad() let disposeBag &#x3D; DisposeBag() &#x2F;&#x2F;åˆ›å»ºä¸€ä¸ªåˆå§‹å€¼ä¸º111çš„BehaviorRelay let subject &#x3D; BehaviorRelay&lt;String&gt;(value: &quot;111&quot;) &#x2F;&#x2F;ä¿®æ”¹valueå€¼ subject.accept(&quot;222&quot;) &#x2F;&#x2F;ç¬¬1æ¬¡è®¢é˜… subject.asObservable().subscribe &#123; print(&quot;ç¬¬1æ¬¡è®¢é˜…ï¼š&quot;, $0) &#125;.disposed(by: disposeBag) &#x2F;&#x2F;ä¿®æ”¹valueå€¼ subject.accept(&quot;333&quot;) &#x2F;&#x2F;ç¬¬2æ¬¡è®¢é˜… subject.asObservable().subscribe &#123; print(&quot;ç¬¬2æ¬¡è®¢é˜…ï¼š&quot;, $0) &#125;.disposed(by: disposeBag) &#x2F;&#x2F;ä¿®æ”¹valueå€¼ subject.accept(&quot;444&quot;) &#125;&#125; ï¼ˆ3ï¼‰å¦‚æœæƒ³å°†æ–°å€¼åˆå¹¶åˆ°åŸå€¼ä¸Šï¼Œå¯ä»¥é€šè¿‡ accept() æ–¹æ³•ä¸ value å±æ€§é…åˆæ¥å®ç°ã€‚ï¼ˆè¿™ä¸ªå¸¸ç”¨åœ¨è¡¨æ ¼ä¸Šæ‹‰åŠ è½½åŠŸèƒ½ä¸Šï¼ŒBehaviorRelay ç”¨æ¥ä¿å­˜æ‰€æœ‰åŠ è½½åˆ°çš„æ•°æ®ï¼‰ 12345678910111213141516171819202122232425262728293031323334import UIKitimport RxSwiftimport RxCocoa class ViewController: UIViewController &#123; override func viewDidLoad() &#123; super.viewDidLoad() let disposeBag &#x3D; DisposeBag() &#x2F;&#x2F;åˆ›å»ºä¸€ä¸ªåˆå§‹å€¼ä¸ºåŒ…å«ä¸€ä¸ªå…ƒç´ çš„æ•°ç»„çš„BehaviorRelay let subject &#x3D; BehaviorRelay&lt;[String]&gt;(value: [&quot;1&quot;]) &#x2F;&#x2F;ä¿®æ”¹valueå€¼ subject.accept(subject.value + [&quot;2&quot;, &quot;3&quot;]) &#x2F;&#x2F;ç¬¬1æ¬¡è®¢é˜… subject.asObservable().subscribe &#123; print(&quot;ç¬¬1æ¬¡è®¢é˜…ï¼š&quot;, $0) &#125;.disposed(by: disposeBag) &#x2F;&#x2F;ä¿®æ”¹valueå€¼ subject.accept(subject.value + [&quot;4&quot;, &quot;5&quot;]) &#x2F;&#x2F;ç¬¬2æ¬¡è®¢é˜… subject.asObservable().subscribe &#123; print(&quot;ç¬¬2æ¬¡è®¢é˜…ï¼š&quot;, $0) &#125;.disposed(by: disposeBag) &#x2F;&#x2F;ä¿®æ”¹valueå€¼ subject.accept(subject.value + [&quot;6&quot;, &quot;7&quot;]) &#125;&#125;","categories":[],"tags":[{"name":"ç¬¬ä¸‰æ–¹åº“","slug":"ç¬¬ä¸‰æ–¹åº“","permalink":"https://github.com/wuvdan/wuvdan.github.io/tags/%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93/"}]},{"title":"iOSç¬¬ä¸‰æ–¹åº“-FMDB-æ¨¡å‹è¿›è¡Œå­˜å–(Model)","slug":"iOSç¬¬ä¸‰æ–¹åº“-FMDB-æ¨¡å‹è¿›è¡Œå­˜å–(Model)","date":"2020-01-16T08:04:24.813Z","updated":"2020-01-20T01:48:38.873Z","comments":true,"path":"2020/01/16/iOSç¬¬ä¸‰æ–¹åº“-FMDB-æ¨¡å‹è¿›è¡Œå­˜å–(Model)/","link":"","permalink":"https://github.com/wuvdan/wuvdan.github.io/2020/01/16/iOS%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93-FMDB-%E6%A8%A1%E5%9E%8B%E8%BF%9B%E8%A1%8C%E5%AD%98%E5%8F%96(Model)/","excerpt":"","text":"å†™è¿™ä¸ªBlogçš„ç›®çš„æ˜¯ä¸ºäº†è®°å½•çš„å­¦ä¹ ç»å†ï¼Œä»£ç å†™çš„ä¸æ˜¯å¾ˆå¥½ï¼Œå¸Œæœ›è¯»è€…ç†è§£ã€‚æ—¥å¸¸å¯¹æ•°æ®åº“çš„æ“ä½œï¼Œéœ€è¦è®¾è®¡å­—æ®µï¼Œæ„Ÿè§‰å¤ªç¹çäº†ï¼Œæƒ³æ‰¾ä¸ªç®€åŒ–çš„æ–¹æ³•ï¼Œå°±æƒ³é€šè¿‡è¿™æ ·è¿›è¡Œå®ç°ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸€ç§æ€è€ƒæ–¹å¼ã€‚å®é™…å®ç°è¿˜æ˜¯çœ‹éœ€æ±‚ã€‚å…·ä½“çœ‹ä»£ç ï¼š1ã€å¯¼å…¥FMDB 1import FMDB 2ã€ä½¿ç”¨å•åˆ©æ¨¡å¼å’Œå¿…è¦å±æ€§ 1234static let defaultManger &#x3D; WDDataBaseManager()typealias successBlock &#x3D; () -&gt;Voidtypealias failBlock &#x3D; () -&gt;Voidprivate var tableName:String? 3ã€æ‡’åŠ è½½åˆ›å»ºæ•°æ®åº“ï¼ˆåç§°æˆ‘éšä¾¿å–å¾—ï¼‰ 12345lazy var fmdb:FMDatabase &#x3D; &#123; let path &#x3D; NSHomeDirectory().appending(&quot;&#x2F;Documents&#x2F;testDB.db&quot;) let db &#x3D; FMDatabase(path: path) return db &#125;() 4ã€åˆ›å»ºè¡¨ 123456789func creatTable(tableName:String) -&gt; Void &#123; fmdb.open() self.tableName &#x3D; tableName let creatSql &#x3D; &quot;create table if not exists \\(tableName) (id integer primary key autoincrement,model BLOB)&quot; let result &#x3D; fmdb.executeUpdate(creatSql, withArgumentsIn:[]) if result&#123; print(&quot;åˆ›å»ºè¡¨æˆåŠŸ&quot;) &#125; &#125; 5ã€åˆ é™¤è¡¨ 1234567func dropTable() -&gt; Void &#123; let sql &#x3D; &quot;drop table if exists &quot; + tableName! let result &#x3D; fmdb.executeUpdate(sql, withArgumentsIn:[]) if result&#123; print(&quot;åˆ é™¤è¡¨æˆåŠŸ&quot;) &#125; &#125; 6ã€æ’å…¥æ•°æ® 1234567891011func insert(model:NSObject, successBlock: successBlock, failBlock: failBlock) -&gt; Void &#123; let modelData &#x3D; try! NSKeyedArchiver.archivedData(withRootObject: model, requiringSecureCoding: false) let insertSql &#x3D; &quot;insert into &quot; + tableName! + &quot; (model) values(?)&quot; do &#123; try fmdb.executeUpdate(insertSql, values: [modelData]) successBlock() &#125; catch &#123; print(fmdb.lastError()) failBlock() &#125; &#125; 7ã€æ›´æ–°è¡¨ 1234567891011func update(model:NSObject,uid:Int32, successBlock: successBlock, failBlock: failBlock) -&gt; Void &#123; let modelData &#x3D; try! NSKeyedArchiver.archivedData(withRootObject: model, requiringSecureCoding: false) let updateSql &#x3D; &quot;update &quot; + tableName! + &quot; set model &#x3D; ? where id &#x3D; ?&quot; do &#123; try fmdb.executeUpdate(updateSql, values: [modelData, uid]) successBlock() &#125; catch &#123; print(fmdb.lastError()) failBlock() &#125; &#125; 8ã€æŸ¥è¯¢æ•°æ®ï¼ˆè¿™æ˜¯æŸ¥è¯¢æ‰€æœ‰æ•°æ®ï¼Œå…¶ä»–æŒ‰éœ€æ±‚è®¾è®¡ï¼‰ 123456789101112131415161718func selectAll() -&gt; [NSObject] &#123; var tmpArr &#x3D; [NSObject]() let selectSql &#x3D; &quot;select * from &quot; + tableName! do &#123; let rs &#x3D; try fmdb.executeQuery(selectSql, values:nil) while rs.next() &#123; var model &#x3D; NSObject() let modelData &#x3D; rs.data(forColumn:&quot;model&quot;) let id &#x3D; rs.int(forColumn: &quot;id&quot;) model &#x3D; try! NSKeyedUnarchiver.unarchiveTopLevelObjectWithData(modelData!) as! NSObject model.wd_fmdb_id &#x3D; id tmpArr.append(model) &#125; &#125; catch &#123; print(fmdb.lastError()) &#125; return tmpArr &#125; 9ã€åˆ é™¤æ•°æ®ï¼ˆè¿™æ˜¯æ ¹æ®Idåˆ é™¤çš„ï¼‰ 12345678910func delete(uid:Int32, successBlock: successBlock, failBlock: failBlock) -&gt; Void &#123; let deleteSql &#x3D; &quot;delete from &quot; + tableName! + &quot; where id &#x3D; ?&quot; do &#123; try fmdb.executeUpdate(deleteSql, values: [uid]) successBlock() &#125; catch &#123; print(fmdb.lastError()) failBlock() &#125; &#125; 10ã€æ–°å¢åˆ†ç±»æ·»åŠ é»˜è®¤Id 1234567891011private var wd_id_key: String &#x3D; &quot;key&quot;extension NSObject &#123; open var wd_fmdb_id:Int32? &#123; get &#123; return (objc_getAssociatedObject(self, &amp;wd_id_key) as? Int32) &#125; set(newValue) &#123; objc_setAssociatedObject(self, &amp;wd_id_key, newValue, objc_AssociationPolicy.OBJC_ASSOCIATION_ASSIGN) &#125; &#125;&#125; 11ã€ä½¿ç”¨æ–¹æ³• 12345678910111213141516171819202122232425&#x2F;&#x2F;1. åœ¨Appdelegateä¸­æ‰“å¼€æ•°æ®åº“func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?) -&gt; Bool &#123; DataBaseManager.defaultManger.creatTable() return true &#125;&#x2F;&#x2F;2ã€æ·»åŠ æ•°æ®WDDataBaseManager.defaultManger.insert(model: model, successBlock: &#123; print(&quot;æˆåŠŸ&quot;) &#125;, failBlock: &#123; print(&quot;å¤±è´¥&quot;) &#125;)&#x2F;&#x2F;3ã€ä¿®æ”¹æ•°æ®WDDataBaseManager.defaultManger.update(model: model, uid: self.model!.wd_fmdb_id!, successBlock: &#123; print(&quot;æˆåŠŸ&quot;) &#125;, failBlock: &#123; print(&quot;å¤±è´¥&quot;) &#125;)&#x2F;&#x2F;4ã€åˆ é™¤æ•°æ®WDDataBaseManager.defaultManger.delete(uid: model.wd_fmdb_id!, successBlock: &#123; print(&quot;æˆåŠŸ&quot;) &#125;, failBlock: &#123; print(&quot;å¤±è´¥&quot;) &#125;)&#x2F;&#x2F; 5ã€æŸ¥è¯¢æ•°æ®WDDataBaseManager.defaultManger.selectAll() éµå¾ªNSCoding é‡å†™ä¸‰ä¸ªæ–¹æ³•12345678910111213141516171819202122232425import UIKitclass Model: NSObject , NSCoding&#123; public var name:String? public var phone:String? public var addres:String? override init() &#123; super.init() &#125; func encode(with aCoder: NSCoder) &#123; aCoder.encode(name, forKey: &quot;name&quot;) aCoder.encode(phone, forKey: &quot;phone&quot;) aCoder.encode(addres, forKey: &quot;addres&quot;) &#125; required init?(coder aDecoder: NSCoder) &#123; super.init() self.name &#x3D; aDecoder.decodeObject(forKey: &quot;name&quot;) as? String self.addres &#x3D; aDecoder.decodeObject(forKey: &quot;addres&quot;) as? String self.phone &#x3D; aDecoder.decodeObject(forKey: &quot;phone&quot;) as? String &#125;&#125; 12ã€æ•ˆæœå›¾ 13ã€Demoåœ°å€:https://github.com/wudan-ios/FMDB-Model.git è¡¥å……Objective-Cç‰ˆæœ¬1ã€æ¥å£æ–‡ä»¶ 12345678910111213141516171819202122232425262728293031#import &lt;Foundation&#x2F;Foundation.h&gt;NS_ASSUME_NONNULL_BEGIN@interface NSObject (addId)@property (nonatomic) NSInteger wd_fmdb_id;@endtypedef void(^successBlock)(void);typedef void(^failBlock)(void);@interface WDDataBaseManager : NSObject+ (instancetype)manager;&#x2F;** åˆ›å»ºè¡¨ *&#x2F;- (void)createTableWithName:(NSString *)name;&#x2F;** åˆ é™¤è¡¨ *&#x2F;- (void)dropTable;&#x2F;** æ·»åŠ æ•°æ® *&#x2F;- (void)insertDataWithModel:(NSObject *)model successBlock:(successBlock)aSuccessBlock failBlock:(failBlock)aFailBlock;&#x2F;** æ›´æ–°æ•°æ® *&#x2F;- (void)updateDataWithModel:(NSObject *)model uid:(NSInteger)aUid successBlock:(successBlock)aSuccessBlock failBlock:(failBlock)aFailBlock;&#x2F;** åˆ é™¤æ•°æ® *&#x2F;- (void)deleteDataWithUid:(NSInteger)uid successBlock:(successBlock)aSuccessBlock failBlock:(failBlock)aFailBlock;&#x2F;** æŸ¥è¯¢å…¨éƒ¨æ•°æ® *&#x2F;- (NSArray&lt;NSObject *&gt; *)queryAllData;@endNS_ASSUME_NONNULL_END 2ã€å®ç°æ–‡ä»¶ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120#import &quot;WDDataBaseManager.h&quot;#import &lt;FMDB.h&gt;#import &lt;objc&#x2F;runtime.h&gt;static char *wd_id_key &#x3D; &quot;key&quot;;@implementation NSObject (addId)- (NSInteger)wd_fmdb_id &#123; NSNumber *numberValue &#x3D; objc_getAssociatedObject(self, wd_id_key); return numberValue.integerValue;&#125;- (void)setWd_fmdb_id:(NSInteger)wd_fmdb_id &#123; objc_setAssociatedObject(self, wd_id_key, @(wd_fmdb_id), OBJC_ASSOCIATION_ASSIGN);&#125;@end@interface WDDataBaseManager ()@property (nonatomic, strong) FMDatabase *fmdb;@property (nonatomic, copy) NSString *tableName;@end@implementation WDDataBaseManager+ (instancetype)manager &#123; static dispatch_once_t onceToken; static WDDataBaseManager *manager &#x3D; nil; dispatch_once(&amp;onceToken, ^&#123; manager &#x3D; [[WDDataBaseManager alloc] init]; &#125;); return manager;&#125;- (void)createTableWithName:(NSString *)name &#123; [self.fmdb open]; self.tableName &#x3D; name; NSString *sql &#x3D; [NSString stringWithFormat:@&quot;create table if not exists %@ (id integer primary key autoincrement,model BLOB)&quot;, name]; BOOL result &#x3D; [self.fmdb executeUpdate:sql]; if (result) &#123; NSLog(@&quot;è¡¨åˆ›å»ºæˆåŠŸ&quot;); &#125;&#125;- (void)dropTable &#123; NSString *sql &#x3D; [NSString stringWithFormat:@&quot;drop table if exists %@&quot;, self.tableName]; BOOL result &#x3D; [self.fmdb executeUpdate:sql]; if (result) &#123; NSLog(@&quot;è¡¨åˆ é™¤æˆåŠŸ&quot;); &#125;&#125;- (void)insertDataWithModel:(NSObject *)model successBlock:(successBlock)aSuccessBlock failBlock:(failBlock)aFailBlock &#123; NSData *modelData &#x3D; [NSKeyedArchiver archivedDataWithRootObject:model]; NSString *sql &#x3D; [NSString stringWithFormat:@&quot;insert into %@ (model) values(?)&quot;, self.tableName]; BOOL result &#x3D; [self.fmdb executeUpdate:sql withArgumentsInArray:@[modelData]]; if (result) &#123; aSuccessBlock(); &#125; else &#123; aFailBlock(); &#125;&#125;- (void)updateDataWithModel:(NSObject *)model uid:(NSInteger)aUid successBlock:(successBlock)aSuccessBlock failBlock:(failBlock)aFailBlock &#123; NSData *modelData &#x3D; [NSKeyedArchiver archivedDataWithRootObject:model]; NSString *sql &#x3D; [NSString stringWithFormat:@&quot;update %@ set model &#x3D; ? where id &#x3D; ?&quot;, self.tableName]; BOOL result &#x3D; [self.fmdb executeUpdate:sql withArgumentsInArray:@[modelData, @(aUid)]]; if (result) &#123; aSuccessBlock(); &#125; else &#123; aFailBlock(); &#125;&#125;- (void)deleteDataWithUid:(NSInteger)uid successBlock:(successBlock)aSuccessBlock failBlock:(failBlock)aFailBlock &#123; NSString *sql &#x3D; [NSString stringWithFormat:@&quot;delete from %@ where id &#x3D; ?&quot;, self.tableName]; BOOL result &#x3D; [self.fmdb executeUpdate:sql withArgumentsInArray:@[@(uid)]]; if (result) &#123; aSuccessBlock(); &#125; else &#123; aFailBlock(); &#125;&#125;- (NSArray&lt;NSObject *&gt; *)queryAllData &#123; NSMutableArray *array &#x3D; [NSMutableArray array]; NSString *sql &#x3D; [NSString stringWithFormat:@&quot;select * from %@&quot;,self.tableName]; @try &#123; FMResultSet *rs &#x3D; [self.fmdb executeQuery:sql]; while (rs.next) &#123; NSObject *model &#x3D; [[NSObject alloc] init]; NSData *modelData &#x3D; [rs dataForColumn:@&quot;model&quot;]; int uid &#x3D; [rs intForColumn:@&quot;id&quot;]; model &#x3D; [NSKeyedUnarchiver unarchiveObjectWithData:modelData]; model.wd_fmdb_id &#x3D; uid; [array addObject:model]; &#125; &#125; @catch (NSException *exception) &#123; NSLog(@&quot;%@&quot;, self.fmdb.lastError); &#125; @finally &#123; NSLog(@&quot;æŸ¥è¯¢æ•°æ®&quot;); &#125; return array;&#125;- (FMDatabase *)fmdb &#123; if (!_fmdb) &#123; NSString *path &#x3D; [NSHomeDirectory() stringByAppendingString:@&quot;&#x2F;Documents&#x2F;testDB.db&quot;]; _fmdb &#x3D; [[FMDatabase alloc] initWithPath:path]; &#125; return _fmdb;&#125;@end 3ã€ä½¿ç”¨æ–¹æ³• 1234567891011121314151617181920212223242526272829&#x2F;&#x2F; 1ã€æ‰“å¼€æ•°æ®åº“ï¼Œå¹¶åˆ›å»ºè¡¨- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions &#123; [[WDDataBaseManager manager] createTableWithName:@&quot;test&quot;]; return YES;&#125;&#x2F;&#x2F; 2ã€æ·»åŠ æ•°æ® [[WDDataBaseManager manager] insertDataWithModel:model successBlock:^&#123; &#x2F;&#x2F; TODO: &#125; failBlock:^&#123; &#x2F;&#x2F; TODO: &#125;];&#x2F;&#x2F; 3ã€æŸ¥è¯¢æ•°æ®[[WDDataBaseManager manager] queryAllData]&#x2F;&#x2F; 4ã€ä¿®æ”¹æ•°æ®[[WDDataBaseManager manager] updateDataWithModel:model uid:self.model.wd_fmdb_id successBlock:^&#123; &#x2F;&#x2F; TODO: &#125; failBlock:^&#123; &#x2F;&#x2F; TODO: &#125;];&#x2F;&#x2F; 5ã€åˆ é™¤æ•°æ®[[WDDataBaseManager manager] deleteDataWithUid:model.wd_fmdb_id successBlock:^&#123; &#x2F;&#x2F; TODO: &#125; failBlock:^&#123; &#x2F;&#x2F; TODO: &#125;];&#x2F;&#x2F; 6ã€åˆ é™¤è¡¨[[WDDataBaseManager manager] dropTable]; æ’å…¥è¡¨ä¸­çš„Modeléœ€è¦éµå¾ª(å®ä¾‹ä»£ç )1234567891011121314- (void)encodeWithCoder:(nonnull NSCoder *)aCoder &#123; [aCoder encodeObject:self.name forKey:@&quot;name&quot;]; [aCoder encodeObject:self.phone forKey:@&quot;phone&quot;]; [aCoder encodeObject:self.address forKey:@&quot;address&quot;];&#125;- (nullable instancetype)initWithCoder:(nonnull NSCoder *)aDecoder &#123; if (self &#x3D;&#x3D; [super init]) &#123; self.name &#x3D; [aDecoder decodeObjectForKey:@&quot;name&quot;] ; self.phone &#x3D; [aDecoder decodeObjectForKey:@&quot;phone&quot;]; self.address &#x3D; [aDecoder decodeObjectForKey:@&quot;address&quot;]; &#125; return self;&#125;","categories":[],"tags":[{"name":"ç¬¬ä¸‰æ–¹åº“","slug":"ç¬¬ä¸‰æ–¹åº“","permalink":"https://github.com/wuvdan/wuvdan.github.io/tags/%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93/"}]},{"title":"iOSç¬¬ä¸‰æ–¹åº“-AFNetworking&SDWebImageåŸç†","slug":"iOSç¬¬ä¸‰æ–¹åº“-AFNetworking&SDWebImageåŸç†","date":"2020-01-16T08:04:20.887Z","updated":"2020-01-20T01:48:47.482Z","comments":true,"path":"2020/01/16/iOSç¬¬ä¸‰æ–¹åº“-AFNetworking&SDWebImageåŸç†/","link":"","permalink":"https://github.com/wuvdan/wuvdan.github.io/2020/01/16/iOS%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93-AFNetworking&SDWebImage%E5%8E%9F%E7%90%86/","excerpt":"","text":"AFNetworkingNSURLSession NSURLSession NSURLSessionConfiguation NSURLSessionTask NSURLSessionTask NSURLSessionDataTask NSURLSessionDownLoadTask NSURLSessionUploadTask ç½‘ç»œè¯·æ±‚çš„è¿‡ç¨‹ åˆ›å»ºNSURLSessionConfigå¯¹è±¡â€“ç”¨åˆ›å»ºçš„configå¯¹è±¡é…ç½®åˆå§‹åŒ–NSURLSessionâ€“åˆ›å»ºNSURLSessionTaskå¯¹è±¡å¹¶resumeæ‰§è¡Œï¼Œç”¨delegateæˆ–è€…blockå›è°ƒè¿”å›æ•°æ®ã€‚ AFURLSessionManagerå°è£…äº†ä¸Šè¿°ç½‘ç»œäº¤äº’åŠŸèƒ½ AFURLSessionManagerè¯·æ±‚è¿‡ç¨‹ 1.åˆå§‹åŒ–AFURLSessionManagerã€‚ 2.è·å–AFURLSessionManagerçš„Taskå¯¹è±¡ 3.å¯åŠ¨Task AFNetworkingç”±äº”ä¸ªæ¨¡å—ç»„æˆï¼š NSURLSessionï¼šç½‘ç»œé€šä¿¡æ¨¡å—ï¼ˆæ ¸å¿ƒæ¨¡å—ï¼‰ å¯¹åº” AFNetworkingä¸­çš„AFURLSessionManagerå’Œå¯¹HTTPåè®®è¿›è¡Œç‰¹åŒ–å¤„ç†çš„AFHTTPSessionManager,AFHTTPSessionManageræ˜¯ç»§æ‰¿äºAFURLSessionmanager Securityï¼šç½‘ç»œé€šè®¯å®‰å…¨ç­–ç•¥æ¨¡å— å¯¹åº” AFSecurityPolicy Reachabilityï¼šç½‘ç»œçŠ¶æ€ç›‘å¬æ¨¡å— å¯¹åº”AFNetworkReachabilityManager Seriaalizationï¼šç½‘ç»œé€šä¿¡ä¿¡æ¯åºåˆ—åŒ–ã€ååºåˆ—åŒ–æ¨¡å— å¯¹åº” AFURLResponseSerialization UIKitï¼šå¯¹äºIOSUIKitçš„æ‰©å±•åº“ SDWebImageå›¾ç‰‡è§£é‡Šï¼š å†…å­˜å±‚é¢çš„ç›¸å½“æ˜¯ä¸ªç¼“å­˜å™¨ï¼Œä»¥Key-Valueçš„å½¢å¼å­˜å‚¨å›¾ç‰‡ã€‚ å½“å†…å­˜ä¸å¤Ÿçš„æ—¶å€™ä¼šæ¸…é™¤æ‰€æœ‰ç¼“å­˜å›¾ç‰‡ã€‚ ç”¨æœç´¢æ–‡ä»¶ç³»ç»Ÿçš„æ–¹å¼åšç®¡ç†ï¼Œæ–‡ä»¶æ›¿æ¢æ–¹å¼æ˜¯ä»¥æ—¶é—´ä¸ºå•ä½ï¼Œå‰”é™¤æ—¶é—´å¤§äºä¸€å‘¨çš„å›¾ç‰‡æ–‡ä»¶ã€‚ å½“SDWebImageManagerå‘SDImageCacheè¦èµ„æºæ—¶ï¼Œå…ˆæœç´¢å†…å­˜å±‚é¢çš„æ•°æ®ï¼Œå¦‚æœæœ‰ç›´æ¥è¿”å›ï¼Œæ²¡æœ‰çš„è¯å»è®¿é—®ç£ç›˜ï¼Œå°†å›¾ç‰‡ä»ç£ç›˜è¯»å–å‡ºæ¥ï¼Œç„¶ååšDecoderï¼Œå°†å›¾ç‰‡å¯¹è±¡æ”¾åˆ°å†…å­˜å±‚é¢åšå¤‡ä»½ï¼Œå†è¿”å›è°ƒç”¨å±‚ã€‚ å®ç°è¿‡ç¨‹ 1ã€å…¥å£ setImageWithURL:placeholderImage:options: ä¼šå…ˆæŠŠ placeholderImage æ˜¾ç¤ºï¼Œç„¶å SDWebImageManager æ ¹æ® URL å¼€å§‹å¤„ç†å›¾ç‰‡ã€‚ 2ã€è¿›å…¥ SDWebImageManager-downloadWithURL:delegate:options:userInfo:ï¼Œäº¤ç»™ SDImageCache ä»ç¼“å­˜æŸ¥æ‰¾å›¾ç‰‡æ˜¯å¦å·²ç»ä¸‹è½½ queryDiskCacheForKey:delegate:userInfo:. 3ã€å¦‚æœå†…å­˜ä¸­å·²ç»æœ‰å›¾ç‰‡ç¼“å­˜ï¼ŒSDImageCacheDelegate å›è°ƒ imageCache:didFindImage:forKey:userInfo: åˆ° SDWebImageManagerã€‚ 4ã€SDWebImageManagerDelegate å›è°ƒ webImageManager:didFinishWithImage: åˆ° UIImageView+WebCache ç­‰å‰ç«¯å±•ç¤ºå›¾ç‰‡ã€‚ 5ã€å¦‚æœå†…å­˜ç¼“å­˜ä¸­æ²¡æœ‰ï¼Œç”Ÿæˆ NSInvocationOperation æ·»åŠ åˆ°é˜Ÿåˆ—å¼€å§‹ä»ç¡¬ç›˜æŸ¥æ‰¾å›¾ç‰‡æ˜¯å¦å·²ç»ç¼“å­˜ã€‚ 6ã€æ ¹æ® URLKey åœ¨ç¡¬ç›˜ç¼“å­˜ç›®å½•ä¸‹å°è¯•è¯»å–å›¾ç‰‡æ–‡ä»¶ã€‚è¿™ä¸€æ­¥æ˜¯åœ¨ NSOperation è¿›è¡Œçš„æ“ä½œï¼Œæ‰€ä»¥å›ä¸»çº¿ç¨‹è¿›è¡Œç»“æœå›è°ƒ notifyDelegate:ã€‚ 7ã€å¦‚æœç¡¬ç›˜ä¸­æœ‰è¯¥å›¾ç‰‡ï¼Œå°†å›¾ç‰‡æ·»åŠ åˆ°å†…å­˜ç¼“å­˜ä¸­ï¼ˆå¦‚æœç©ºé—²å†…å­˜è¿‡å°ï¼Œä¼šå…ˆæ¸…ç©ºå†…å­˜ç¼“å­˜ï¼‰ã€‚SDImageCacheDelegate å›è°ƒ imageCache:didFindImage:forKey:userInfo:ã€‚è¿›è€Œå›è°ƒå±•ç¤ºå›¾ç‰‡ã€‚ 8ã€å¦‚æœä»ç¡¬ç›˜ç¼“å­˜ç›®å½•è¯»å–ä¸åˆ°å›¾ç‰‡ï¼Œè¯´æ˜æ‰€æœ‰ç¼“å­˜éƒ½ä¸å­˜åœ¨è¯¥å›¾ç‰‡ï¼Œéœ€è¦ä¸‹è½½å›¾ç‰‡ï¼Œå›è°ƒ imageCache:didNotFindImageForKey:userInfo:ã€‚ 9ã€å…±äº«æˆ–é‡æ–°ç”Ÿæˆä¸€ä¸ªä¸‹è½½å™¨ SDWebImageDownloader å¼€å§‹ä¸‹è½½å›¾ç‰‡ã€‚ 10ã€å›¾ç‰‡ä¸‹è½½ç”± NSURLConnection æ¥åšï¼Œå®ç°ç›¸å…³ delegate æ¥åˆ¤æ–­å›¾ç‰‡ä¸‹è½½ä¸­ã€ä¸‹è½½å®Œæˆå’Œä¸‹è½½å¤±è´¥ã€‚ 11ã€imageDownloader:didFinishWithImage: å›è°ƒç»™ SDWebImageManager å‘ŠçŸ¥å›¾ç‰‡ä¸‹è½½å®Œæˆã€‚ 12ã€é€šçŸ¥æ‰€æœ‰çš„ downloadDelegates ä¸‹è½½å®Œæˆï¼Œå›è°ƒç»™éœ€è¦çš„åœ°æ–¹å±•ç¤ºå›¾ç‰‡ã€‚ 13ã€å°†å›¾ç‰‡ä¿å­˜åˆ° SDImageCache ä¸­ï¼Œå†…å­˜ç¼“å­˜å’Œç¡¬ç›˜ç¼“å­˜åŒæ—¶ä¿å­˜ã€‚å†™æ–‡ä»¶åˆ°ç¡¬ç›˜ä¹Ÿåœ¨ä»¥å•ç‹¬ NSInvocationOperation å®Œæˆï¼Œé¿å…æ‹–æ…¢ä¸»çº¿ç¨‹ã€‚SDImageCache åœ¨åˆå§‹åŒ–çš„æ—¶å€™ä¼šæ³¨å†Œä¸€äº›æ¶ˆæ¯é€šçŸ¥ï¼Œåœ¨å†…å­˜è­¦å‘Šæˆ–é€€åˆ°åå°çš„æ—¶å€™æ¸…ç†å†…å­˜å›¾ç‰‡ç¼“å­˜ï¼Œåº”ç”¨ç»“æŸçš„æ—¶å€™æ¸…ç†è¿‡æœŸå›¾ç‰‡ã€‚","categories":[],"tags":[{"name":"ç¬¬ä¸‰æ–¹åº“","slug":"ç¬¬ä¸‰æ–¹åº“","permalink":"https://github.com/wuvdan/wuvdan.github.io/tags/%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93/"}]},{"title":"iOSåº•å±‚-RunLoop","slug":"iOSåº•å±‚-RunLoop","date":"2020-01-16T08:04:14.498Z","updated":"2020-01-20T02:34:50.181Z","comments":true,"path":"2020/01/16/iOSåº•å±‚-RunLoop/","link":"","permalink":"https://github.com/wuvdan/wuvdan.github.io/2020/01/16/iOS%E5%BA%95%E5%B1%82-RunLoop/","excerpt":"","text":"ä¸€ã€æ¦‚å¿µRunLoopæ˜¯é€šè¿‡å†…éƒ¨ç»´æŠ¤çš„äº‹ä»¶å¾ªç¯(Event Loop)æ¥å¯¹äº‹ä»¶/æ¶ˆæ¯è¿›è¡Œç®¡ç†çš„ä¸€ä¸ªå¯¹è±¡ã€‚ 1ã€æ²¡æœ‰æ¶ˆæ¯å¤„ç†æ—¶ï¼Œä¼‘çœ å·²é¿å…èµ„æºå ç”¨ï¼Œç”±ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€(CPU-å†…æ ¸æ€å’Œç”¨æˆ·æ€)2ã€æœ‰æ¶ˆæ¯éœ€è¦å¤„ç†æ—¶ï¼Œç«‹åˆ»è¢«å”¤é†’ï¼Œç”±å†…æ ¸æ€åˆ‡æ¢åˆ°ç”¨æˆ·æ€ ä¸ºä»€ä¹ˆmainå‡½æ•°ä¸ä¼šé€€å‡ºï¼Ÿ 12345int main(int argc, char * argv[]) &#123; @autoreleasepool &#123; return UIApplicationMain(argc, argv, nil, NSStringFromClass([AppDelegate class])); &#125;&#125; UIApplicationMainå†…éƒ¨é»˜è®¤å¼€å¯äº†ä¸»çº¿ç¨‹çš„RunLoopï¼Œå¹¶æ‰§è¡Œäº†ä¸€æ®µæ— é™å¾ªç¯çš„ä»£ç ï¼ˆä¸æ˜¯ç®€å•çš„forå¾ªç¯æˆ–whileå¾ªç¯ï¼‰ 12345678910&#x2F;&#x2F;æ— é™å¾ªç¯ä»£ç æ¨¡å¼(ä¼ªä»£ç )int main(int argc, char * argv[]) &#123; BOOL running &#x3D; YES; do &#123; &#x2F;&#x2F; æ‰§è¡Œå„ç§ä»»åŠ¡ï¼Œå¤„ç†å„ç§äº‹ä»¶ &#x2F;&#x2F; ...... &#125; while (running); return 0;&#125; UIApplicationMainå‡½æ•°ä¸€ç›´æ²¡æœ‰è¿”å›ï¼Œè€Œæ˜¯ä¸æ–­åœ°æ¥æ”¶å¤„ç†æ¶ˆæ¯ä»¥åŠç­‰å¾…ä¼‘çœ ï¼Œæ‰€ä»¥è¿è¡Œç¨‹åºä¹‹åä¼šä¿æŒæŒç»­è¿è¡ŒçŠ¶æ€ã€‚ äºŒã€RunLoopçš„æ•°æ®ç»“æ„NSRunLoop(Foundation)æ˜¯CFRunLoop(CoreFoundation)çš„å°è£…ï¼Œæä¾›äº†é¢å‘å¯¹è±¡çš„APIRunLoop ç›¸å…³çš„ä¸»è¦æ¶‰åŠäº”ä¸ªç±»ï¼š CFRunLoopï¼šRunLoopå¯¹è±¡CFRunLoopModeï¼šè¿è¡Œæ¨¡å¼CFRunLoopSourceï¼šè¾“å…¥æº/äº‹ä»¶æºCFRunLoopTimerï¼šå®šæ—¶æºCFRunLoopObserverï¼šè§‚å¯Ÿè€… 1ã€CFRunLoop ç”±pthread(çº¿ç¨‹å¯¹è±¡ï¼Œè¯´æ˜RunLoopå’Œçº¿ç¨‹æ˜¯ä¸€ä¸€å¯¹åº”çš„)ã€currentMode(å½“å‰æ‰€å¤„çš„è¿è¡Œæ¨¡å¼)ã€modes(å¤šä¸ªè¿è¡Œæ¨¡å¼çš„é›†åˆ)ã€commonModes(æ¨¡å¼åç§°å­—ç¬¦ä¸²é›†åˆ)ã€commonModelItems(Observer,Timer,Sourceé›†åˆ)æ„æˆ 2ã€CFRunLoopMode ç”±nameã€source0ã€source1ã€observersã€timersæ„æˆ 3ã€CFRunLoopSource åˆ†ä¸ºsource0å’Œsource1ä¸¤ç§ source0:å³éåŸºäºportçš„ï¼Œä¹Ÿå°±æ˜¯ç”¨æˆ·è§¦å‘çš„äº‹ä»¶ã€‚éœ€è¦æ‰‹åŠ¨å”¤é†’çº¿ç¨‹ï¼Œå°†å½“å‰çº¿ç¨‹ä»å†…æ ¸æ€åˆ‡æ¢åˆ°ç”¨æˆ·æ€ source1:åŸºäºportçš„ï¼ŒåŒ…å«ä¸€ä¸ª mach_port å’Œä¸€ä¸ªå›è°ƒï¼Œå¯ç›‘å¬ç³»ç»Ÿç«¯å£å’Œé€šè¿‡å†…æ ¸å’Œå…¶ä»–çº¿ç¨‹å‘é€çš„æ¶ˆæ¯ï¼Œèƒ½ä¸»åŠ¨å”¤é†’RunLoopï¼Œæ¥æ”¶åˆ†å‘ç³»ç»Ÿäº‹ä»¶ã€‚å…·å¤‡å”¤é†’çº¿ç¨‹çš„èƒ½åŠ› 4ã€CFRunLoopTimer åŸºäºæ—¶é—´çš„è§¦å‘å™¨ï¼ŒåŸºæœ¬ä¸Šè¯´çš„å°±æ˜¯NSTimerã€‚åœ¨é¢„è®¾çš„æ—¶é—´ç‚¹å”¤é†’RunLoopæ‰§è¡Œå›è°ƒã€‚å› ä¸ºå®ƒæ˜¯åŸºäºRunLoopçš„ï¼Œå› æ­¤å®ƒä¸æ˜¯å®æ—¶çš„ï¼ˆå°±æ˜¯NSTimer æ˜¯ä¸å‡†ç¡®çš„ã€‚ å› ä¸ºRunLoopåªè´Ÿè´£åˆ†å‘æºçš„æ¶ˆæ¯ã€‚å¦‚æœçº¿ç¨‹å½“å‰æ­£åœ¨å¤„ç†ç¹é‡çš„ä»»åŠ¡ï¼Œå°±æœ‰å¯èƒ½å¯¼è‡´Timeræœ¬æ¬¡å»¶æ—¶ï¼Œæˆ–è€…å°‘æ‰§è¡Œä¸€æ¬¡ï¼‰ã€‚ 5ã€CFRunLoopObserver ç›‘å¬ä»¥ä¸‹æ—¶é—´ç‚¹:CFRunLoopActivity kCFRunLoopEntryRunLoopå‡†å¤‡å¯åŠ¨ kCFRunLoopBeforeTimersRunLoopå°†è¦å¤„ç†ä¸€äº›Timerç›¸å…³äº‹ä»¶ kCFRunLoopBeforeSourcesRunLoopå°†è¦å¤„ç†ä¸€äº›Sourceäº‹ä»¶ kCFRunLoopBeforeWaitingRunLoopå°†è¦è¿›è¡Œä¼‘çœ çŠ¶æ€,å³å°†ç”±ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€ kCFRunLoopAfterWaitingRunLoopè¢«å”¤é†’ï¼Œå³ä»å†…æ ¸æ€åˆ‡æ¢åˆ°ç”¨æˆ·æ€å kCFRunLoopExitRunLoopé€€å‡º kCFRunLoopAllActivitiesç›‘å¬æ‰€æœ‰çŠ¶æ€ 6ã€å„æ•°æ®ç»“æ„ä¹‹é—´çš„è”ç³» çº¿ç¨‹å’ŒRunLoopä¸€ä¸€å¯¹åº”ï¼Œ RunLoopå’ŒModeæ˜¯ä¸€å¯¹å¤šçš„ï¼ŒModeå’Œsourceã€timerã€observerä¹Ÿæ˜¯ä¸€å¯¹å¤šçš„ ä¸‰ã€RunLoopçš„Modeå…³äºModeé¦–å…ˆè¦çŸ¥é“ä¸€ä¸ªRunLoop å¯¹è±¡ä¸­å¯èƒ½åŒ…å«å¤šä¸ªModeï¼Œä¸”æ¯æ¬¡è°ƒç”¨ RunLoop çš„ä¸»å‡½æ•°æ—¶ï¼Œåªèƒ½æŒ‡å®šå…¶ä¸­ä¸€ä¸ª Mode(CurrentMode)ã€‚åˆ‡æ¢ Modeï¼Œéœ€è¦é‡æ–°æŒ‡å®šä¸€ä¸ª Mode ã€‚ä¸»è¦æ˜¯ä¸ºäº†åˆ†éš”å¼€ä¸åŒçš„ Sourceã€Timerã€Observerï¼Œè®©å®ƒä»¬ä¹‹é—´äº’ä¸å½±å“ã€‚ å½“RunLoopè¿è¡Œåœ¨Mode1ä¸Šæ—¶ï¼Œæ˜¯æ— æ³•æ¥å—å¤„ç†Mode2æˆ–Mode3ä¸Šçš„Sourceã€Timerã€Observeräº‹ä»¶çš„ æ€»å…±æ˜¯æœ‰äº”ç§CFRunLoopMode: kCFRunLoopDefaultModeï¼šé»˜è®¤æ¨¡å¼ï¼Œä¸»çº¿ç¨‹æ˜¯åœ¨è¿™ä¸ªè¿è¡Œæ¨¡å¼ä¸‹è¿è¡Œ UITrackingRunLoopModeï¼šè·Ÿè¸ªç”¨æˆ·äº¤äº’äº‹ä»¶ï¼ˆç”¨äº ScrollView è¿½è¸ªè§¦æ‘¸æ»‘åŠ¨ï¼Œä¿è¯ç•Œé¢æ»‘åŠ¨æ—¶ä¸å—å…¶ä»–Modeå½±å“ï¼‰ UIInitializationRunLoopModeï¼šåœ¨åˆšå¯åŠ¨Appæ—¶ç¬¬è¿›å…¥çš„ç¬¬ä¸€ä¸ª Modeï¼Œå¯åŠ¨å®Œæˆåå°±ä¸å†ä½¿ç”¨ GSEventReceiveRunLoopModeï¼šæ¥å—ç³»ç»Ÿå†…éƒ¨äº‹ä»¶ï¼Œé€šå¸¸ç”¨ä¸åˆ° kCFRunLoopCommonModesï¼šä¼ªæ¨¡å¼ï¼Œä¸æ˜¯ä¸€ç§çœŸæ­£çš„è¿è¡Œæ¨¡å¼ï¼Œæ˜¯åŒæ­¥Source/Timer/Observeråˆ°å¤šä¸ªModeä¸­çš„ä¸€ç§è§£å†³æ–¹æ¡ˆ å››ã€RunLoopçš„å®ç°æœºåˆ¶å¯¹äºRunLoopè€Œè¨€æœ€æ ¸å¿ƒçš„äº‹æƒ…å°±æ˜¯ä¿è¯çº¿ç¨‹åœ¨æ²¡æœ‰æ¶ˆæ¯çš„æ—¶å€™ä¼‘çœ ï¼Œåœ¨æœ‰æ¶ˆæ¯æ—¶å”¤é†’ï¼Œä»¥æé«˜ç¨‹åºæ€§èƒ½ã€‚RunLoopè¿™ä¸ªæœºåˆ¶æ˜¯ä¾é ç³»ç»Ÿå†…æ ¸æ¥å®Œæˆçš„ï¼ˆè‹¹æœæ“ä½œç³»ç»Ÿæ ¸å¿ƒç»„ä»¶Darwinä¸­çš„Machï¼‰ã€‚ RunLoopé€šè¿‡mach_msg()å‡½æ•°æ¥æ”¶ã€å‘é€æ¶ˆæ¯ã€‚å®ƒçš„æœ¬è´¨æ˜¯è°ƒç”¨å‡½æ•°mach_msg_trap()ï¼Œç›¸å½“äºæ˜¯ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œä¼šè§¦å‘å†…æ ¸çŠ¶æ€åˆ‡æ¢ã€‚åœ¨ç”¨æˆ·æ€è°ƒç”¨ mach_msg_trap()æ—¶ä¼šåˆ‡æ¢åˆ°å†…æ ¸æ€ï¼›å†…æ ¸æ€ä¸­å†…æ ¸å®ç°çš„mach_msg()å‡½æ•°ä¼šå®Œæˆå®é™…çš„å·¥ä½œã€‚å³åŸºäºportçš„source1ï¼Œç›‘å¬ç«¯å£ï¼Œç«¯å£æœ‰æ¶ˆæ¯å°±ä¼šè§¦å‘å›è°ƒï¼›è€Œsource0ï¼Œè¦æ‰‹åŠ¨æ ‡è®°ä¸ºå¾…å¤„ç†å’Œæ‰‹åŠ¨å”¤é†’RunLoop Machæ¶ˆæ¯å‘é€æœºåˆ¶å¤§è‡´é€»è¾‘ä¸ºï¼š1ã€é€šçŸ¥è§‚å¯Ÿè€… RunLoop å³å°†å¯åŠ¨ã€‚2ã€é€šçŸ¥è§‚å¯Ÿè€…å³å°†è¦å¤„ç†Timeräº‹ä»¶ã€‚3ã€é€šçŸ¥è§‚å¯Ÿè€…å³å°†è¦å¤„ç†source0äº‹ä»¶ã€‚4ã€å¤„ç†source0äº‹ä»¶ã€‚5ã€å¦‚æœåŸºäºç«¯å£çš„æº(Source1)å‡†å¤‡å¥½å¹¶å¤„äºç­‰å¾…çŠ¶æ€ï¼Œè¿›å…¥æ­¥éª¤9ã€‚6ã€é€šçŸ¥è§‚å¯Ÿè€…çº¿ç¨‹å³å°†è¿›å…¥ä¼‘çœ çŠ¶æ€ã€‚7ã€å°†çº¿ç¨‹ç½®äºä¼‘çœ çŠ¶æ€ï¼Œç”±ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€ï¼Œç›´åˆ°ä¸‹é¢çš„ä»»ä¸€äº‹ä»¶å‘ç”Ÿæ‰å”¤é†’çº¿ç¨‹ã€‚ ä¸€ä¸ªåŸºäº port çš„Source1 çš„äº‹ä»¶(å›¾é‡Œåº”è¯¥æ˜¯source0)ã€‚ ä¸€ä¸ª Timer åˆ°æ—¶é—´äº†ã€‚ RunLoop è‡ªèº«çš„è¶…æ—¶æ—¶é—´åˆ°äº†ã€‚ è¢«å…¶ä»–è°ƒç”¨è€…æ‰‹åŠ¨å”¤é†’ã€‚ 8ã€é€šçŸ¥è§‚å¯Ÿè€…çº¿ç¨‹å°†è¢«å”¤é†’ã€‚9ã€å¤„ç†å”¤é†’æ—¶æ”¶åˆ°çš„äº‹ä»¶ã€‚ å¦‚æœç”¨æˆ·å®šä¹‰çš„å®šæ—¶å™¨å¯åŠ¨ï¼Œå¤„ç†å®šæ—¶å™¨äº‹ä»¶å¹¶é‡å¯RunLoopã€‚è¿›å…¥æ­¥éª¤2ã€‚ å¦‚æœè¾“å…¥æºå¯åŠ¨ï¼Œä¼ é€’ç›¸åº”çš„æ¶ˆæ¯ã€‚ å¦‚æœRunLoopè¢«æ˜¾ç¤ºå”¤é†’è€Œä¸”æ—¶é—´è¿˜æ²¡è¶…æ—¶ï¼Œé‡å¯RunLoopã€‚è¿›å…¥æ­¥éª¤2 10ã€é€šçŸ¥è§‚å¯Ÿè€…RunLoopç»“æŸã€‚ äº”ã€RunLoopä¸NSTimerä¸€ä¸ªæ¯”è¾ƒå¸¸è§çš„é—®é¢˜ï¼šæ»‘åŠ¨tableViewæ—¶ï¼Œå®šæ—¶å™¨è¿˜ä¼šç”Ÿæ•ˆå—ï¼Ÿé»˜è®¤æƒ…å†µä¸‹RunLoopè¿è¡Œåœ¨kCFRunLoopDefaultModeä¸‹ï¼Œè€Œå½“æ»‘åŠ¨tableViewæ—¶ï¼ŒRunLoopåˆ‡æ¢åˆ°UITrackingRunLoopModeï¼Œè€ŒTimeræ˜¯åœ¨kCFRunLoopDefaultModeä¸‹çš„ï¼Œå°±æ— æ³•æ¥å—å¤„ç†Timerçš„äº‹ä»¶ã€‚æ€ä¹ˆå»è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼ŸæŠŠTimeræ·»åŠ åˆ°UITrackingRunLoopModeä¸Šå¹¶ä¸èƒ½è§£å†³é—®é¢˜ï¼Œå› ä¸ºè¿™æ ·åœ¨é»˜è®¤æƒ…å†µä¸‹å°±æ— æ³•æ¥å—å®šæ—¶å™¨äº‹ä»¶äº†ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦æŠŠTimeråŒæ—¶æ·»åŠ åˆ°UITrackingRunLoopModeå’ŒkCFRunLoopDefaultModeä¸Šã€‚é‚£ä¹ˆå¦‚ä½•æŠŠtimeråŒæ—¶æ·»åŠ åˆ°å¤šä¸ªmodeä¸Šå‘¢ï¼Ÿå°±è¦ç”¨åˆ°NSRunLoopCommonModesäº† 1[[NSRunLoop currentRunLoop] addTimer:timer forMode:NSRunLoopCommonModes]; Timerå°±è¢«æ·»åŠ åˆ°å¤šä¸ªmodeä¸Šï¼Œè¿™æ ·å³ä½¿RunLoopç”±kCFRunLoopDefaultModeåˆ‡æ¢åˆ°UITrackingRunLoopModeä¸‹ï¼Œä¹Ÿä¸ä¼šå½±å“æ¥æ”¶Timeräº‹ä»¶ å…­ã€RunLoopå’Œçº¿ç¨‹ çº¿ç¨‹å’ŒRunLoopæ˜¯ä¸€ä¸€å¯¹åº”çš„,å…¶æ˜ å°„å…³ç³»æ˜¯ä¿å­˜åœ¨ä¸€ä¸ªå…¨å±€çš„ Dictionary é‡Œ è‡ªå·±åˆ›å»ºçš„çº¿ç¨‹é»˜è®¤æ˜¯æ²¡æœ‰å¼€å¯RunLoopçš„ 1ã€æ€ä¹ˆåˆ›å»ºä¸€ä¸ªå¸¸é©»çº¿ç¨‹ï¼Ÿ 1ã€ä¸ºå½“å‰çº¿ç¨‹å¼€å¯ä¸€ä¸ªRunLoopï¼ˆç¬¬ä¸€æ¬¡è°ƒç”¨ [NSRunLoop currentRunLoop]æ–¹æ³•æ—¶å®é™…æ˜¯ä¼šå…ˆå»åˆ›å»ºä¸€ä¸ªRunLoopï¼‰2ã€å‘å½“å‰RunLoopä¸­æ·»åŠ ä¸€ä¸ªPort/Sourceç­‰ç»´æŒRunLoopçš„äº‹ä»¶å¾ªç¯ï¼ˆå¦‚æœRunLoopçš„modeä¸­ä¸€ä¸ªiteméƒ½æ²¡æœ‰ï¼ŒRunLoopä¼šé€€å‡ºï¼‰3ã€å¯åŠ¨è¯¥RunLoop 123456789@autoreleasepool &#123; NSRunLoop *runLoop &#x3D; [NSRunLoop currentRunLoop]; [[NSRunLoop currentRunLoop] addPort:[NSMachPort port] forMode:NSDefaultRunLoopMode]; [runLoop run]; &#125; 2ã€è¾“å‡ºä¸‹è¾¹ä»£ç çš„æ‰§è¡Œé¡ºåº 123456789101112131415161718NSLog(@&quot;1&quot;);dispatch_async(dispatch_get_global_queue(0, 0), ^&#123; NSLog(@&quot;2&quot;); [self performSelector:@selector(test) withObject:nil afterDelay:10]; NSLog(@&quot;3&quot;);&#125;);NSLog(@&quot;4&quot;);- (void)test&#123; NSLog(@&quot;5&quot;);&#125; ç­”æ¡ˆæ˜¯1423ï¼Œtestæ–¹æ³•å¹¶ä¸ä¼šæ‰§è¡Œã€‚åŸå› æ˜¯å¦‚æœæ˜¯å¸¦afterDelayçš„å»¶æ—¶å‡½æ•°ï¼Œä¼šåœ¨å†…éƒ¨åˆ›å»ºä¸€ä¸ª NSTimerï¼Œç„¶åæ·»åŠ åˆ°å½“å‰çº¿ç¨‹çš„RunLoopä¸­ã€‚ä¹Ÿå°±æ˜¯å¦‚æœå½“å‰çº¿ç¨‹æ²¡æœ‰å¼€å¯RunLoopï¼Œè¯¥æ–¹æ³•ä¼šå¤±æ•ˆã€‚é‚£ä¹ˆæˆ‘ä»¬æ”¹æˆ: 12345678910dispatch_async(dispatch_get_global_queue(0, 0), ^&#123; NSLog(@&quot;2&quot;); [[NSRunLoop currentRunLoop] run]; [self performSelector:@selector(test) withObject:nil afterDelay:10]; NSLog(@&quot;3&quot;); &#125;); ç„¶è€Œtestæ–¹æ³•ä¾ç„¶ä¸æ‰§è¡Œã€‚åŸå› æ˜¯å¦‚æœRunLoopçš„modeä¸­ä¸€ä¸ªiteméƒ½æ²¡æœ‰ï¼ŒRunLoopä¼šé€€å‡ºã€‚å³åœ¨è°ƒç”¨RunLoopçš„runæ–¹æ³•åï¼Œç”±äºå…¶modeä¸­æ²¡æœ‰æ·»åŠ ä»»ä½•itemå»ç»´æŒRunLoopçš„æ—¶é—´å¾ªç¯ï¼ŒRunLoopéšå³è¿˜æ˜¯ä¼šé€€å‡ºã€‚æ‰€ä»¥æˆ‘ä»¬è‡ªå·±å¯åŠ¨RunLoopï¼Œä¸€å®šè¦åœ¨æ·»åŠ itemå 12345678910dispatch_async(dispatch_get_global_queue(0, 0), ^&#123; NSLog(@&quot;2&quot;); [self performSelector:@selector(test) withObject:nil afterDelay:10]; [[NSRunLoop currentRunLoop] run]; NSLog(@&quot;3&quot;); &#125;); 3ã€æ€æ ·ä¿è¯å­çº¿ç¨‹æ•°æ®å›æ¥æ›´æ–°UIçš„æ—¶å€™ä¸æ‰“æ–­ç”¨æˆ·çš„æ»‘åŠ¨æ“ä½œï¼Ÿ å½“æˆ‘ä»¬åœ¨å­è¯·æ±‚æ•°æ®çš„åŒæ—¶æ»‘åŠ¨æµè§ˆå½“å‰é¡µé¢ï¼Œå¦‚æœæ•°æ®è¯·æ±‚æˆåŠŸè¦åˆ‡å›ä¸»çº¿ç¨‹æ›´æ–°UIï¼Œé‚£ä¹ˆå°±ä¼šå½±å“å½“å‰æ­£åœ¨æ»‘åŠ¨çš„ä½“éªŒã€‚æˆ‘ä»¬å°±å¯ä»¥å°†æ›´æ–°UIäº‹ä»¶æ”¾åœ¨ä¸»çº¿ç¨‹çš„NSDefaultRunLoopModeä¸Šæ‰§è¡Œå³å¯ï¼Œè¿™æ ·å°±ä¼šç­‰ç”¨æˆ·ä¸å†æ»‘åŠ¨é¡µé¢ï¼Œä¸»çº¿ç¨‹RunLoopç”±UITrackingRunLoopModeåˆ‡æ¢åˆ°NSDefaultRunLoopModeæ—¶å†å»æ›´æ–°UI 1[self performSelectorOnMainThread:@selector(reloadData) withObject:nil waitUntilDone:NO modes:@[NSDefaultRunLoopMode]]; é—®é¢˜1. å¦‚ä½•ä½¿ç”¨ Runloop å®ç°ä¸€ä¸ªå¸¸é©»çº¿ç¨‹ï¼Ÿè¿™ç§çº¿ç¨‹ä¸€èˆ¬æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿä¸€èˆ¬åšæ³•æ˜¯å‘ Runloop ä¸­æ”¾ä¸€ä¸ª portã€‚åˆ›å»ºä¸€æ¡å¸¸é©»çš„åå°çº¿ç¨‹ï¼Œåšä»»ä½•ä½ æƒ³åšçš„äº‹ã€‚ 2. ä¸ºä»€ä¹ˆ NSTimer æœ‰æ—¶å€™ä¸å¥½ä½¿ï¼Ÿå› ä¸ºåˆ›å»ºçš„ NSTimer é»˜è®¤æ˜¯è¢«åŠ å…¥åˆ°äº† defaultModeï¼Œæ‰€ä»¥å½“ Runloop çš„ Mode å˜åŒ–æ—¶ï¼Œå½“å‰çš„ NSTimer å°±ä¸ä¼šå·¥ä½œäº†ã€‚ 3. autoreleasePool åœ¨ä½•æ—¶è¢«é‡Šæ”¾ï¼ŸAppå¯åŠ¨åï¼Œè‹¹æœåœ¨ä¸»çº¿ç¨‹ RunLoop é‡Œæ³¨å†Œäº†ä¸¤ä¸ª Observerï¼Œå…¶å›è°ƒéƒ½æ˜¯ _wrapRunLoopWithAutoreleasePoolHandler()ã€‚ ç¬¬ä¸€ä¸ª Observer ç›‘è§†çš„äº‹ä»¶æ˜¯ Entry(å³å°†è¿›å…¥Loop)ï¼Œå…¶å›è°ƒå†…ä¼šè°ƒç”¨ _objc_autoreleasePoolPush() åˆ›å»ºè‡ªåŠ¨é‡Šæ”¾æ± ã€‚å…¶ order æ˜¯ -2147483647ï¼Œä¼˜å…ˆçº§æœ€é«˜ï¼Œä¿è¯åˆ›å»ºé‡Šæ”¾æ± å‘ç”Ÿåœ¨å…¶ä»–æ‰€æœ‰å›è°ƒä¹‹å‰ã€‚ ç¬¬äºŒä¸ª Observer ç›‘è§†äº†ä¸¤ä¸ªäº‹ä»¶ï¼š BeforeWaiting(å‡†å¤‡è¿›å…¥ä¼‘çœ ) æ—¶è°ƒç”¨_objc_autoreleasePoolPop() å’Œ _objc_autoreleasePoolPush() é‡Šæ”¾æ—§çš„æ± å¹¶åˆ›å»ºæ–°æ± ï¼›Exit(å³å°†é€€å‡ºLoop) æ—¶è°ƒç”¨ _objc_autoreleasePoolPop() æ¥é‡Šæ”¾è‡ªåŠ¨é‡Šæ”¾æ± ã€‚è¿™ä¸ª Observer çš„ order æ˜¯ 2147483647ï¼Œä¼˜å…ˆçº§æœ€ä½ï¼Œä¿è¯å…¶é‡Šæ”¾æ± å­å‘ç”Ÿåœ¨å…¶ä»–æ‰€æœ‰å›è°ƒä¹‹åã€‚ åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œçš„ä»£ç ï¼Œé€šå¸¸æ˜¯å†™åœ¨è¯¸å¦‚äº‹ä»¶å›è°ƒã€Timerå›è°ƒå†…çš„ã€‚è¿™äº›å›è°ƒä¼šè¢« RunLoop åˆ›å»ºå¥½çš„ AutoreleasePool ç¯ç»•ç€ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°å†…å­˜æ³„æ¼ï¼Œå¼€å‘è€…ä¹Ÿä¸å¿…æ˜¾ç¤ºåˆ›å»º Pool äº†ã€‚ 4. PerformSelector çš„å®ç°åŸç†ï¼Ÿå½“è°ƒç”¨ NSObject çš„ performSelecter:afterDelay: åï¼Œå®é™…ä¸Šå…¶å†…éƒ¨ä¼šåˆ›å»ºä¸€ä¸ª Timer å¹¶æ·»åŠ åˆ°å½“å‰çº¿ç¨‹çš„ RunLoop ä¸­ã€‚æ‰€ä»¥å¦‚æœå½“å‰çº¿ç¨‹æ²¡æœ‰ RunLoopï¼Œåˆ™è¿™ä¸ªæ–¹æ³•ä¼šå¤±æ•ˆã€‚ å½“è°ƒç”¨ performSelector:onThread: æ—¶ï¼Œå®é™…ä¸Šå…¶ä¼šåˆ›å»ºä¸€ä¸ª Timer åŠ åˆ°å¯¹åº”çš„çº¿ç¨‹å»ï¼ŒåŒæ ·çš„ï¼Œå¦‚æœå¯¹åº”çº¿ç¨‹æ²¡æœ‰ RunLoop è¯¥æ–¹æ³•ä¹Ÿä¼šå¤±æ•ˆã€‚ 5. PerformSelector:afterDelay:è¿™ä¸ªæ–¹æ³•åœ¨å­çº¿ç¨‹ä¸­æ˜¯å¦èµ·ä½œç”¨ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿæ€ä¹ˆè§£å†³ï¼Ÿä¸èµ·ä½œç”¨ï¼Œå­çº¿ç¨‹é»˜è®¤æ²¡æœ‰ Runloopï¼Œä¹Ÿå°±æ²¡æœ‰ Timerã€‚è§£å†³çš„åŠæ³•æ˜¯å¯ä»¥ä½¿ç”¨ GCD æ¥å®ç°ï¼šDispatch_after\u0010 6. è®²ä¸€ä¸‹ Observer ï¼Ÿ12345678typedef CF_OPTIONS(CFOptionFlags, CFRunLoopActivity) &#123; kCFRunLoopEntry = (1UL &lt;&lt; 0), // å³å°†è¿›å…¥Loop kCFRunLoopBeforeTimers = (1UL &lt;&lt; 1), // å³å°†å¤„ç† Timer kCFRunLoopBeforeSources = (1UL &lt;&lt; 2), // å³å°†å¤„ç† Source kCFRunLoopBeforeWaiting = (1UL &lt;&lt; 5), // å³å°†è¿›å…¥ä¼‘çœ  kCFRunLoopAfterWaiting = (1UL &lt;&lt; 6), // åˆšä»ä¼‘çœ ä¸­å”¤é†’ kCFRunLoopExit = (1UL &lt;&lt; 7), // å³å°†é€€å‡ºLoop&#125;; 7. è§£é‡Šä¸€ä¸‹ äº‹ä»¶å“åº” çš„è¿‡ç¨‹ï¼Ÿè‹¹æœæ³¨å†Œäº†ä¸€ä¸ª Source1 (åŸºäº mach port çš„) ç”¨æ¥æ¥æ”¶ç³»ç»Ÿäº‹ä»¶ï¼Œå…¶å›è°ƒå‡½æ•°ä¸º __IOHIDEventSystemClientQueueCallback()ã€‚ å½“ä¸€ä¸ªç¡¬ä»¶äº‹ä»¶(è§¦æ‘¸/é”å±/æ‘‡æ™ƒç­‰)å‘ç”Ÿåï¼Œé¦–å…ˆç”± IOKit.framework ç”Ÿæˆä¸€ä¸ª IOHIDEvent äº‹ä»¶å¹¶ç”± SpringBoard æ¥æ”¶ã€‚è¿™ä¸ªè¿‡ç¨‹çš„è¯¦ç»†æƒ…å†µå¯ä»¥å‚è€ƒè¿™é‡Œã€‚SpringBoard åªæ¥æ”¶æŒ‰é”®(é”å±/é™éŸ³ç­‰)ï¼Œè§¦æ‘¸ï¼ŒåŠ é€Ÿï¼Œæ¥è¿‘ä¼ æ„Ÿå™¨ç­‰å‡ ç§ Eventï¼Œéšåç”¨ mach port è½¬å‘ç»™éœ€è¦çš„ App è¿›ç¨‹ã€‚éšåè‹¹æœæ³¨å†Œçš„é‚£ä¸ª Source1 å°±ä¼šè§¦å‘å›è°ƒï¼Œå¹¶è°ƒç”¨ _UIApplicationHandleEventQueue() è¿›è¡Œåº”ç”¨å†…éƒ¨çš„åˆ†å‘ã€‚ _UIApplicationHandleEventQueue() ä¼šæŠŠ IOHIDEvent å¤„ç†å¹¶åŒ…è£…æˆ UIEvent è¿›è¡Œå¤„ç†æˆ–åˆ†å‘ï¼Œå…¶ä¸­åŒ…æ‹¬è¯†åˆ« UIGesture/å¤„ç†å±å¹•æ—‹è½¬/å‘é€ç»™ UIWindow ç­‰ã€‚é€šå¸¸äº‹ä»¶æ¯”å¦‚ UIButton ç‚¹å‡»ã€touchesBegin/Move/End/Cancel äº‹ä»¶éƒ½æ˜¯åœ¨è¿™ä¸ªå›è°ƒä¸­å®Œæˆçš„ã€‚ 8. è§£é‡Šä¸€ä¸‹ æ‰‹åŠ¿è¯†åˆ« çš„è¿‡ç¨‹ï¼Ÿå½“ä¸Šé¢çš„ _UIApplicationHandleEventQueue()è¯†åˆ«äº†ä¸€ä¸ªæ‰‹åŠ¿æ—¶ï¼Œå…¶é¦–å…ˆä¼šè°ƒç”¨ Cancel å°†å½“å‰çš„ touchesBegin/Move/End ç³»åˆ—å›è°ƒæ‰“æ–­ã€‚éšåç³»ç»Ÿå°†å¯¹åº”çš„ UIGestureRecognizer æ ‡è®°ä¸ºå¾…å¤„ç†ã€‚ è‹¹æœæ³¨å†Œäº†ä¸€ä¸ª Observer ç›‘æµ‹ BeforeWaiting (Loopå³å°†è¿›å…¥ä¼‘çœ ) äº‹ä»¶ï¼Œè¿™ä¸ª Observer çš„å›è°ƒå‡½æ•°æ˜¯ _UIGestureRecognizerUpdateObserver()ï¼Œå…¶å†…éƒ¨ä¼šè·å–æ‰€æœ‰åˆšè¢«æ ‡è®°ä¸ºå¾…å¤„ç†çš„ GestureRecognizerï¼Œå¹¶æ‰§è¡ŒGestureRecognizer çš„å›è°ƒã€‚ å½“æœ‰ UIGestureRecognizer çš„å˜åŒ–(åˆ›å»º/é”€æ¯/çŠ¶æ€æ”¹å˜)æ—¶ï¼Œè¿™ä¸ªå›è°ƒéƒ½ä¼šè¿›è¡Œç›¸åº”å¤„ç†ã€‚ 9. è§£é‡Šä¸€ä¸‹ GCD åœ¨ Runloop ä¸­çš„ä½¿ç”¨ï¼ŸGCDç”± å­çº¿ç¨‹ è¿”å›åˆ° ä¸»çº¿ç¨‹,åªæœ‰åœ¨è¿™ç§æƒ…å†µä¸‹æ‰ä¼šè§¦å‘ RunLoopã€‚ä¼šè§¦å‘ RunLoop çš„ Source 1 äº‹ä»¶ã€‚ 10. è§£é‡Šä¸€ä¸‹ NSTimerã€‚NSTimer å…¶å®å°±æ˜¯ CFRunLoopTimerRefï¼Œä»–ä»¬ä¹‹é—´æ˜¯ toll-free bridged çš„ã€‚ä¸€ä¸ª NSTimer æ³¨å†Œåˆ° RunLoop åï¼ŒRunLoop ä¼šä¸ºå…¶é‡å¤çš„æ—¶é—´ç‚¹æ³¨å†Œå¥½äº‹ä»¶ã€‚ä¾‹å¦‚ 10:00, 10:10, 10:20 è¿™å‡ ä¸ªæ—¶é—´ç‚¹ã€‚RunLoop ä¸ºäº†èŠ‚çœèµ„æºï¼Œå¹¶ä¸ä¼šåœ¨éå¸¸å‡†ç¡®çš„æ—¶é—´ç‚¹å›è°ƒè¿™ä¸ªTimerã€‚Timer æœ‰ä¸ªå±æ€§å«åš Tolerance (å®½å®¹åº¦)ï¼Œæ ‡ç¤ºäº†å½“æ—¶é—´ç‚¹åˆ°åï¼Œå®¹è®¸æœ‰å¤šå°‘æœ€å¤§è¯¯å·®ã€‚ å¦‚æœæŸä¸ªæ—¶é—´ç‚¹è¢«é”™è¿‡äº†ï¼Œä¾‹å¦‚æ‰§è¡Œäº†ä¸€ä¸ªå¾ˆé•¿çš„ä»»åŠ¡ï¼Œåˆ™é‚£ä¸ªæ—¶é—´ç‚¹çš„å›è°ƒä¹Ÿä¼šè·³è¿‡å»ï¼Œä¸ä¼šå»¶åæ‰§è¡Œã€‚å°±æ¯”å¦‚ç­‰å…¬äº¤ï¼Œå¦‚æœ 10:10 æ—¶æˆ‘å¿™ç€ç©æ‰‹æœºé”™è¿‡äº†é‚£ä¸ªç‚¹çš„å…¬äº¤ï¼Œé‚£æˆ‘åªèƒ½ç­‰ 10:20 è¿™ä¸€è¶Ÿäº†ã€‚ CADisplayLink æ˜¯ä¸€ä¸ªå’Œå±å¹•åˆ·æ–°ç‡ä¸€è‡´çš„å®šæ—¶å™¨ï¼ˆä½†å®é™…å®ç°åŸç†æ›´å¤æ‚ï¼Œå’Œ NSTimer å¹¶ä¸ä¸€æ ·ï¼Œå…¶å†…éƒ¨å®é™…æ˜¯æ“ä½œäº†ä¸€ä¸ª Sourceï¼‰ã€‚å¦‚æœåœ¨ä¸¤æ¬¡å±å¹•åˆ·æ–°ä¹‹é—´æ‰§è¡Œäº†ä¸€ä¸ªé•¿ä»»åŠ¡ï¼Œé‚£å…¶ä¸­å°±ä¼šæœ‰ä¸€å¸§è¢«è·³è¿‡å»ï¼ˆå’Œ NSTimer ç›¸ä¼¼ï¼‰ï¼Œé€ æˆç•Œé¢å¡é¡¿çš„æ„Ÿè§‰ã€‚åœ¨å¿«é€Ÿæ»‘åŠ¨ TableView æ—¶ï¼Œå³ä½¿ä¸€å¸§çš„å¡é¡¿ä¹Ÿä¼šè®©ç”¨æˆ·æœ‰æ‰€å¯Ÿè§‰ã€‚Facebook å¼€æºçš„ AsyncDisplayLink å°±æ˜¯ä¸ºäº†è§£å†³ç•Œé¢å¡é¡¿çš„é—®é¢˜ï¼Œå…¶å†…éƒ¨ä¹Ÿç”¨åˆ°äº† RunLoopã€‚ 11. åˆ©ç”¨ runloop è§£é‡Šä¸€ä¸‹é¡µé¢çš„æ¸²æŸ“çš„è¿‡ç¨‹ï¼Ÿå½“æˆ‘ä»¬è°ƒç”¨ [UIView setNeedsDisplay] æ—¶ï¼Œè¿™æ—¶ä¼šè°ƒç”¨å½“å‰ View.layer çš„ [view.layer setNeedsDisplay]æ–¹æ³•ã€‚ è¿™ç­‰äºç»™å½“å‰çš„ layer æ‰“ä¸Šäº†ä¸€ä¸ªè„æ ‡è®°ï¼Œè€Œæ­¤æ—¶å¹¶æ²¡æœ‰ç›´æ¥è¿›è¡Œç»˜åˆ¶å·¥ä½œã€‚è€Œæ˜¯ä¼šåˆ°å½“å‰çš„ Runloop å³å°†ä¼‘çœ ï¼Œä¹Ÿå°±æ˜¯ beforeWaiting æ—¶æ‰ä¼šè¿›è¡Œç»˜åˆ¶å·¥ä½œã€‚ ç´§æ¥ç€ä¼šè°ƒç”¨ [CALayer display]ï¼Œè¿›å…¥åˆ°çœŸæ­£ç»˜åˆ¶çš„å·¥ä½œã€‚CALayer å±‚ä¼šåˆ¤æ–­è‡ªå·±çš„ delegate æœ‰æ²¡æœ‰å®ç°å¼‚æ­¥ç»˜åˆ¶çš„ä»£ç†æ–¹æ³• displayer:ï¼Œè¿™ä¸ªä»£ç†æ–¹æ³•æ˜¯å¼‚æ­¥ç»˜åˆ¶çš„å…¥å£ï¼Œå¦‚æœæ²¡æœ‰å®ç°è¿™ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆä¼šç»§ç»­è¿›è¡Œç³»ç»Ÿç»˜åˆ¶çš„æµç¨‹ï¼Œç„¶åç»˜åˆ¶ç»“æŸã€‚ CALayer å†…éƒ¨ä¼šåˆ›å»ºä¸€ä¸ª Backing Storeï¼Œç”¨æ¥è·å–å›¾å½¢ä¸Šä¸‹æ–‡ã€‚æ¥ä¸‹æ¥ä¼šåˆ¤æ–­è¿™ä¸ª layer æ˜¯å¦æœ‰ delegateã€‚ å¦‚æœæœ‰çš„è¯ï¼Œä¼šè°ƒç”¨ [layer.delegate drawLayer:inContext:]ï¼Œå¹¶ä¸”ä¼šè¿”å›ç»™æˆ‘ä»¬ [UIView DrawRect:] çš„å›è°ƒï¼Œè®©æˆ‘ä»¬åœ¨ç³»ç»Ÿç»˜åˆ¶çš„åŸºç¡€ä¹‹ä¸Šå†åšä¸€äº›äº‹æƒ…ã€‚ å¦‚æœæ²¡æœ‰ delegateï¼Œé‚£ä¹ˆä¼šè°ƒç”¨ [CALayer drawInContext:]ã€‚ ä»¥ä¸Šä¸¤ä¸ªåˆ†æ”¯ï¼Œæœ€ç»ˆ CALayer éƒ½ä¼šå°†ä½å›¾æäº¤åˆ° Backing Storeï¼Œæœ€åæäº¤ç»™ GPUã€‚ è‡³æ­¤ç»˜åˆ¶çš„è¿‡ç¨‹ç»“æŸã€‚","categories":[{"name":"åº•å±‚åŸç†","slug":"åº•å±‚åŸç†","permalink":"https://github.com/wuvdan/wuvdan.github.io/categories/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/"}],"tags":[{"name":"runloop","slug":"runloop","permalink":"https://github.com/wuvdan/wuvdan.github.io/tags/runloop/"}]},{"title":"iOSåº•å±‚-Block","slug":"iOSåº•å±‚-Block","date":"2020-01-16T08:01:00.860Z","updated":"2020-01-20T01:49:59.044Z","comments":true,"path":"2020/01/16/iOSåº•å±‚-Block/","link":"","permalink":"https://github.com/wuvdan/wuvdan.github.io/2020/01/16/iOS%E5%BA%95%E5%B1%82-Block/","excerpt":"","text":"Blockçš„å®è´¨æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªOCå¯¹è±¡ï¼Œä»–å†…éƒ¨ä¹Ÿæœ‰ä¸€ä¸ªisaæŒ‡é’ˆã€‚Blockæ˜¯å°è£…äº†å‡½æ•°è°ƒç”¨ä»¥åŠå‡½æ•°è°ƒç”¨ç¯å¢ƒçš„OCå¯¹è±¡ã€‚ Blockä¸‰ç§ç±»å‹ ç±»å‹ å­˜å‚¨åŒºåŸŸ GlobalBlock æ•°æ®åŒº StackBlock æ ˆåŒº MallocBlock å †åŒº Blocké¿å…å¾ªç¯å¼•ç”¨çš„ä¸‰ç§æ–¹å¼1ã€åˆ©ç”¨ __weakå’Œ__strong 123456 __weak typeof(self) weakSelf &#x3D; self;self.block &#x3D; ^&#123; __strong typeof(self) strongSelf &#x3D; weakSelf; NSLog(@&quot;%@&quot;, NSStringFromCGRect(strongSelf.view.frame));&#125;;self.block(); 2ã€åˆ©ç”¨é€ æˆå¾ªç¯å¼•ç”¨çš„ä¸´æ—¶å˜é‡ 123456__block ViewController *vc &#x3D; self;self.block &#x3D; ^&#123; NSLog(@&quot;%@&quot;, NSStringFromCGRect(vc.view.frame)); vc &#x3D; nil;&#125;;self.block(); 3ã€ç›´æ¥å£°æ˜Blockä¸­æ·»åŠ é€ æˆå¾ªç¯å¼•ç”¨çš„å‚æ•° 123456typedef void(^Block)(UIViewController *vc);self.block &#x3D; ^(UIViewController *vc)&#123; NSLog(@&quot;%@&quot;, NSStringFromCGRect(vc.view.frame));&#125;;self.block(self);","categories":[{"name":"åº•å±‚åŸç†","slug":"åº•å±‚åŸç†","permalink":"https://github.com/wuvdan/wuvdan.github.io/categories/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/"}],"tags":[{"name":"Block","slug":"Block","permalink":"https://github.com/wuvdan/wuvdan.github.io/tags/Block/"}]},{"title":"iOSå¤šçº¿ç¨‹-GCD","slug":"iOSå¤šçº¿ç¨‹-GCD","date":"2020-01-16T08:00:40.362Z","updated":"2020-01-20T01:46:03.175Z","comments":true,"path":"2020/01/16/iOSå¤šçº¿ç¨‹-GCD/","link":"","permalink":"https://github.com/wuvdan/wuvdan.github.io/2020/01/16/iOS%E5%A4%9A%E7%BA%BF%E7%A8%8B-GCD/","excerpt":"","text":"ä»»åŠ¡å°±æ˜¯æ‰§è¡Œæ“ä½œçš„æ„æ€ï¼Œæ¢å¥è¯è¯´å°±æ˜¯ä½ åœ¨çº¿ç¨‹ä¸­æ‰§è¡Œçš„é‚£æ®µä»£ç ã€‚åœ¨ GCD ä¸­æ˜¯æ”¾åœ¨ block ä¸­çš„ã€‚æ‰§è¡Œä»»åŠ¡æœ‰ä¸¤ç§æ–¹å¼ï¼šåŒæ­¥æ‰§è¡Œï¼ˆsyncï¼‰å’Œå¼‚æ­¥æ‰§è¡Œï¼ˆasyncï¼‰ã€‚ä¸¤è€…çš„ä¸»è¦åŒºåˆ«æ˜¯ï¼šæ˜¯å¦ç­‰å¾…é˜Ÿåˆ—çš„ä»»åŠ¡æ‰§è¡Œç»“æŸï¼Œä»¥åŠæ˜¯å¦å…·å¤‡å¼€å¯æ–°çº¿ç¨‹çš„èƒ½åŠ›ã€‚ åŒæ­¥æ‰§è¡Œï¼ˆsyncï¼‰åŒæ­¥æ·»åŠ ä»»åŠ¡åˆ°æŒ‡å®šçš„é˜Ÿåˆ—ä¸­ï¼Œåœ¨æ·»åŠ çš„ä»»åŠ¡æ‰§è¡Œç»“æŸä¹‹å‰ï¼Œä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°é˜Ÿåˆ—é‡Œé¢çš„ä»»åŠ¡å®Œæˆä¹‹åå†ç»§ç»­æ‰§è¡Œã€‚åªèƒ½åœ¨å½“å‰çº¿ç¨‹ä¸­æ‰§è¡Œä»»åŠ¡ï¼Œä¸å…·å¤‡å¼€å¯æ–°çº¿ç¨‹çš„èƒ½åŠ›ã€‚ å¼‚æ­¥æ‰§è¡Œï¼ˆasyncï¼‰å¼‚æ­¥æ·»åŠ ä»»åŠ¡åˆ°æŒ‡å®šçš„é˜Ÿåˆ—ä¸­ï¼Œå®ƒä¸ä¼šåšä»»ä½•ç­‰å¾…ï¼Œå¯ä»¥ç»§ç»­æ‰§è¡Œä»»åŠ¡ã€‚å¯ä»¥åœ¨æ–°çš„çº¿ç¨‹ä¸­æ‰§è¡Œä»»åŠ¡ï¼Œå…·å¤‡å¼€å¯æ–°çº¿ç¨‹çš„èƒ½åŠ›ã€‚ é˜Ÿåˆ—æ‰§è¡Œä»»åŠ¡çš„ç­‰å¾…é˜Ÿåˆ—ï¼Œå³ç”¨æ¥å­˜æ”¾ä»»åŠ¡çš„é˜Ÿåˆ—ã€‚é˜Ÿåˆ—æ˜¯ä¸€ç§ç‰¹æ®Šçš„çº¿æ€§è¡¨ï¼Œé‡‡ç”¨ FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰çš„åŸåˆ™ï¼Œå³æ–°ä»»åŠ¡æ€»æ˜¯è¢«æ’å…¥åˆ°é˜Ÿåˆ—çš„æœ«å°¾ï¼Œè€Œè¯»å–ä»»åŠ¡çš„æ—¶å€™æ€»æ˜¯ä»é˜Ÿåˆ—çš„å¤´éƒ¨å¼€å§‹è¯»å–ã€‚æ¯è¯»å–ä¸€ä¸ªä»»åŠ¡ï¼Œåˆ™ä»é˜Ÿåˆ—ä¸­é‡Šæ”¾ä¸€ä¸ªä»»åŠ¡ã€‚åœ¨ GCD ä¸­æœ‰ä¸¤ç§é˜Ÿåˆ—ï¼šä¸²è¡Œé˜Ÿåˆ—å’Œå¹¶å‘é˜Ÿåˆ—ã€‚ä¸¤è€…éƒ½ç¬¦åˆ FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰çš„åŸåˆ™ã€‚ä¸¤è€…çš„ä¸»è¦åŒºåˆ«æ˜¯ï¼šæ‰§è¡Œé¡ºåºä¸åŒï¼Œä»¥åŠå¼€å¯çº¿ç¨‹æ•°ä¸åŒã€‚ ä¸²è¡Œé˜Ÿåˆ—ï¼ˆSerial Dispatch Queueï¼‰æ¯æ¬¡åªæœ‰ä¸€ä¸ªä»»åŠ¡è¢«æ‰§è¡Œã€‚è®©ä»»åŠ¡ä¸€ä¸ªæ¥ç€ä¸€ä¸ªåœ°æ‰§è¡Œã€‚ï¼ˆåªå¼€å¯ä¸€ä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå®Œæ¯•åï¼Œå†æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡ï¼‰ å¹¶å‘é˜Ÿåˆ—ï¼ˆConcurrent Dispatch Queueï¼‰å¯ä»¥è®©å¤šä¸ªä»»åŠ¡å¹¶å‘ï¼ˆåŒæ—¶ï¼‰æ‰§è¡Œã€‚ï¼ˆå¯ä»¥å¼€å¯å¤šä¸ªçº¿ç¨‹ï¼Œå¹¶ä¸”åŒæ—¶æ‰§è¡Œä»»åŠ¡ï¼‰ æ³¨æ„ï¼šå¹¶å‘é˜Ÿåˆ— çš„å¹¶å‘åŠŸèƒ½åªæœ‰åœ¨å¼‚æ­¥ï¼ˆdispatch_asyncï¼‰å‡½æ•°ä¸‹æ‰æœ‰æ•ˆ dispatch_queue_t ä»»åŠ¡ é˜Ÿåˆ— åŒæ­¥ ä¸²è¡Œ å¼‚æ­¥ å¹¶å‘ #### ç»„åˆç»“æœ ç»„åˆ ç»“æœ â€” â€” åŒæ­¥æ‰§è¡Œ + å¹¶å‘é˜Ÿåˆ— åœ¨å½“å‰çº¿ç¨‹ä¸­æ‰§è¡Œä»»åŠ¡ï¼Œä¸ä¼šå¼€å¯æ–°çº¿ç¨‹ï¼Œæ‰§è¡Œå®Œä¸€ä¸ªä»»åŠ¡ï¼Œå†æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡ å¼‚æ­¥æ‰§è¡Œ + å¹¶å‘é˜Ÿåˆ— å¯ä»¥å¼€å¯å¤šä¸ªçº¿ç¨‹ï¼Œä»»åŠ¡äº¤æ›¿ï¼ˆåŒæ—¶ï¼‰æ‰§è¡Œ åŒæ­¥æ‰§è¡Œ + ä¸²è¡Œé˜Ÿåˆ— ä¸ä¼šå¼€å¯æ–°çº¿ç¨‹ï¼Œåœ¨å½“å‰çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ã€‚ä»»åŠ¡æ˜¯ä¸²è¡Œçš„ï¼Œæ‰§è¡Œå®Œä¸€ä¸ªä»»åŠ¡ï¼Œå†æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡ å¼‚æ­¥æ‰§è¡Œ + ä¸²è¡Œé˜Ÿåˆ— ä¼šå¼€å¯æ–°çº¿ç¨‹ï¼Œä½†æ˜¯å› ä¸ºä»»åŠ¡æ˜¯ä¸²è¡Œçš„ï¼Œæ‰§è¡Œå®Œä¸€ä¸ªä»»åŠ¡ï¼Œå†æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡ åŒæ­¥æ‰§è¡Œ + ä¸»é˜Ÿåˆ— åœ¨ä¸»çº¿ç¨‹ä¸­è°ƒç”¨ä¼šå‡ºç°æ­»é”ï¼Œè€Œåœ¨å…¶ä»–çº¿ç¨‹ä¸­åˆ™ä¸ä¼š å¼‚æ­¥æ‰§è¡Œ + ä¸»é˜Ÿåˆ— äº’ç›¸ç­‰å¾…å¡ä½ä¸å¯è¡Œ åˆ›å»ºä¸²è¡Œé˜Ÿåˆ—å¸¸ç”¨å®å®šä¹‰ åç§° å€¼ DISPATCH_QUEUE_SERIAL NULL DISPATCH_QUEUE_SERIAL_INACTIVE dispatch_queue_attr_make_initially_inactive(DISPATCH_QUEUE_SERIAL) DISPATCH_QUEUE_SERIAL_WITH_AUTORELEASE_POOL dispatch_queue_attr_make_with_autorelease_frequency(DISPATCH_QUEUE_SERIAL, DISPATCH_AUTORELEASE_FREQUENCY_WORK_ITEM) 1dispatch_queue_create(&quot;æ ‡è¯†&quot;, DISPATCH_QUEUE_SERIAL); å¹¶å‘é˜Ÿåˆ—å¸¸ç”¨å®å®šä¹‰ åç§° å€¼ DISPATCH_QUEUE_CONCURRENT NULL DISPATCH_QUEUE_CONCURRENT_INACTIVE dispatch_queue_attr_make_initially_inactive(DISPATCH_QUEUE_CONCURRENT) DISPATCH_QUEUE_CONCURRENT_WITH_AUTORELEASE_POOL dispatch_queue_attr_make_with_autorelease_frequency(DISPATCH_QUEUE_SERIAL,DISPATCH_AUTORELEASE_FREQUENCY_WORK_ITEM) 1dispatch_queue_t queue &#x3D; dispatch_queue_create(&quot;æ ‡è¯†&quot;, DISPATCH_QUEUE_CONCURRENT); è·å–ä¸»çº¿ç¨‹1dispatch_get_main_queue(); è·å–ç³»ç»Ÿé»˜è®¤çš„å…¨å±€å¹¶å‘é˜Ÿåˆ—iOS 8.0 åç§° æ„ä¹‰ QOS_CLASS_USER_INTERACTIVE ç”¨æˆ·äº¤äº’(å¸Œæœ›å°½å¿«å®Œæˆï¼Œç”¨æˆ·å¯¹ç»“æœå¾ˆæœŸæœ›ï¼Œä¸è¦æ”¾å¤ªè€—æ—¶æ“ä½œ) QOS_CLASS_USER_INITIATED ç”¨æˆ·æœŸæœ›(ä¸è¦æ”¾å¤ªè€—æ—¶æ“ä½œ) QOS_CLASS_DEFAULT é»˜è®¤(ä¸æ˜¯ç»™ç¨‹åºå‘˜ä½¿ç”¨çš„ï¼Œç”¨æ¥é‡ç½®å¯¹åˆ—ä½¿ç”¨çš„) QOS_CLASS_UTILITY å®ç”¨å·¥å…·(è€—æ—¶æ“ä½œï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªé€‰é¡¹) QOS_CLASS_BACKGROUND åå° QOS_CLASS_UNSPECIFIED æœªæŒ‡å®š iOS 8.0ä¹‹å‰ åç§° æ„ä¹‰ DISPATCH_QUEUE_PRIORITY_HIGH é«˜ä¼˜å…ˆçº§ DISPATCH_QUEUE_PRIORITY_DEFAULT é»˜è®¤ä¼˜å…ˆçº§ DISPATCH_QUEUE_PRIORITY_LOW ä½ä¼˜å…ˆçº§ DISPATCH_QUEUE_PRIORITY_BACKGROUND åå°ä¼˜å…ˆçº§ 1dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0); å¼‚æ­¥æ‰§è¡Œ123456789101112131415161718int context &#x3D; 10;&#x2F;** é˜Ÿåˆ—å¼‚æ­¥æ‰§è¡Œ @param queue é˜Ÿåˆ— @param context è¦ä¼ é€’ç»™å‡½æ•°çš„åº”ç”¨ç¨‹åºå®šä¹‰çš„ä¸Šä¸‹æ–‡å‚æ•°ã€‚ @param asyncMethod cæ“ä½œæ–¹æ³• @return dispatch_queue_t*&#x2F;dispatch_async_f(queue, &amp;context, asyncMethod);void asyncMethod() &#123; &#x2F;&#x2F; TODO&#125;dispatch_sync(queue, ^&#123; &#x2F;&#x2F; TODO&#125;); åŒæ­¥æ‰§è¡Œ123456789101112131415161718int context &#x3D; 10;&#x2F;** é˜Ÿåˆ—åŒæ­¥æ‰§è¡Œ @param queue é˜Ÿåˆ— @param context è¦ä¼ é€’ç»™å‡½æ•°çš„åº”ç”¨ç¨‹åºå®šä¹‰çš„ä¸Šä¸‹æ–‡å‚æ•°ã€‚ @param syncMethod cæ“ä½œæ–¹æ³• @return dispatch_queue_t *&#x2F;dispatch_sync_f(queue, &amp;context, syncMethod);void syncMethod() &#123; &#x2F;&#x2F; TODO&#125;dispatch_sync(queue, ^&#123; &#x2F;&#x2F; TODO&#125;); å»¶è¿Ÿæ“ä½œ12345678910int context &#x3D; 10;dispatch_after_f(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(1.2 * NSEC_PER_SEC)), queue, &amp;context, afterMethod);void afterMethod() &#123; &#x2F;&#x2F; TODO&#125;dispatch_queue_t queue &#x3D; dispatch_get_main_queue(); dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(1.2 * NSEC_PER_SEC)), queue, ^&#123; &#x2F;&#x2F; TODO&#125;); å¿«é€Ÿè¿­ä»£12345678910int context &#x3D; 1;&#x2F;&#x2F; æ‰§è¡Œ10æ¬¡applyMethodå‡½æ•°dispatch_apply_f(10, queue, &amp;context, applyMethod);void applyMethod() &#123; &#x2F;&#x2F; TODO&#125;dispatch_apply(10, queue, ^(size_t index) &#123; &#x2F;&#x2F; TODO&#125;); æ‰§è¡Œä¸€æ¬¡123456789dispatch_once_f(&amp;onceToken, &amp;context, onceMethod);void onceMethod() &#123; &#x2F;&#x2F; TODO&#125;static dispatch_once_t onceToken;dispatch_once(&amp;onceToken, ^&#123; &#x2F;&#x2F; TODO&#125;); æ …æ æ–¹æ³•å°†é˜Ÿåˆ—æ‰§è¡Œçš„æ“ä½œç»„ç»™åˆ†å‰²èµ·æ¥ã€‚ dispatch_barrier_async12345678910int context &#x3D; 10;dispatch_barrier_async_f(queue, &amp;context, barrierAsync);void barrierAsync() &#123; &#x2F;&#x2F; TODO&#125;dispatch_barrier_async(queue, ^&#123; &#x2F;&#x2F; TODO&#125;); dispatch_barrier_sync12345678910int context &#x3D; 10;dispatch_barrier_sync_f(queue, &amp;context, barrierAsync);void barrierSync() &#123; &#x2F;&#x2F; TODO&#125;dispatch_barrier_sync(queue, ^&#123; &#x2F;&#x2F; TODO&#125;); dispatch_barrier_syncå’Œdispatch_barrier_asyncçš„å…±åŒç‚¹ï¼š 1ã€éƒ½ä¼šç­‰å¾…åœ¨å®ƒå‰é¢æ’å…¥é˜Ÿåˆ—çš„ä»»åŠ¡å…ˆæ‰§è¡Œå®Œ 2ã€éƒ½ä¼šç­‰å¾…ä»–ä»¬è‡ªå·±çš„ä»»åŠ¡æ‰§è¡Œå®Œå†æ‰§è¡Œåé¢çš„ä»»åŠ¡ dispatch_barrier_syncå’Œdispatch_barrier_asyncçš„ä¸å…±åŒç‚¹ï¼š åœ¨å°†ä»»åŠ¡æ’å…¥åˆ°queueçš„æ—¶å€™ï¼Œdispatch_barrier_syncéœ€è¦ç­‰å¾…è‡ªå·±çš„ä»»åŠ¡ç»“æŸä¹‹åæ‰ä¼šç»§ç»­ç¨‹åºï¼Œç„¶åæ’å…¥è¢«å†™åœ¨å®ƒåé¢çš„ä»»åŠ¡ï¼Œç„¶åæ‰§è¡Œåé¢çš„ä»»åŠ¡è€Œdispatch_barrier_asyncå°†è‡ªå·±çš„ä»»åŠ¡æ’å…¥åˆ°queueä¹‹åï¼Œä¸ä¼šç­‰å¾…è‡ªå·±çš„ä»»åŠ¡ç»“æŸï¼Œå®ƒä¼šç»§ç»­æŠŠåé¢çš„ä»»åŠ¡æ’å…¥åˆ°queueã€‚ æ‰€ä»¥ï¼Œdispatch_barrier_asyncçš„ä¸ç­‰å¾…ï¼ˆå¼‚æ­¥ï¼‰ç‰¹æ€§ä½“ç°åœ¨å°†ä»»åŠ¡æ’å…¥é˜Ÿåˆ—çš„è¿‡ç¨‹ï¼Œå®ƒçš„ç­‰å¾…ç‰¹æ€§ä½“ç°åœ¨ä»»åŠ¡çœŸæ­£æ‰§è¡Œçš„è¿‡ç¨‹ã€‚ dispatch_semaphoreGCD ä¸­çš„ä¿¡å·é‡æ˜¯æŒ‡ Dispatch Semaphoreï¼Œæ˜¯æŒæœ‰è®¡æ•°çš„ä¿¡å·ã€‚ç±»ä¼¼äºè¿‡é«˜é€Ÿè·¯æ”¶è´¹ç«™çš„æ æ†ã€‚å¯ä»¥é€šè¿‡æ—¶ï¼Œæ‰“å¼€æ æ†ï¼Œä¸å¯ä»¥é€šè¿‡æ—¶ï¼Œå…³é—­æ æ†ã€‚åœ¨ Dispatch Semaphore ä¸­ï¼Œä½¿ç”¨è®¡æ•°æ¥å®Œæˆè¿™ä¸ªåŠŸèƒ½ï¼Œè®¡æ•°ä¸º0æ—¶ç­‰å¾…ï¼Œä¸å¯é€šè¿‡ã€‚è®¡æ•°ä¸º1æˆ–å¤§äº1æ—¶ï¼Œè®¡æ•°å‡1ä¸”ä¸ç­‰å¾…ï¼Œå¯é€šè¿‡ã€‚ Dispatch Semaphore æä¾›äº†ä¸‰ä¸ªå‡½æ•°ã€‚ dispatch_semaphore_createï¼šåˆ›å»ºä¸€ä¸ªSemaphoreå¹¶åˆå§‹åŒ–ä¿¡å·çš„æ€»é‡ dispatch_semaphore_signalï¼šå‘é€ä¸€ä¸ªä¿¡å·ï¼Œè®©ä¿¡å·æ€»é‡åŠ 1 dispatch_semaphore_waitï¼šå¯ä»¥ä½¿æ€»ä¿¡å·é‡å‡1ï¼Œå½“ä¿¡å·æ€»é‡ä¸º0æ—¶å°±ä¼šä¸€ç›´ç­‰å¾…ï¼ˆé˜»å¡æ‰€åœ¨çº¿ç¨‹ï¼‰ï¼Œå¦åˆ™å°±å¯ä»¥æ­£å¸¸æ‰§è¡Œã€‚ æ³¨æ„ï¼šä¿¡å·é‡çš„ä½¿ç”¨å‰ææ˜¯ï¼šæƒ³æ¸…æ¥šä½ éœ€è¦å¤„ç†å“ªä¸ªçº¿ç¨‹ç­‰å¾…ï¼ˆé˜»å¡ï¼‰ï¼Œåˆè¦å“ªä¸ªçº¿ç¨‹ç»§ç»­æ‰§è¡Œï¼Œç„¶åä½¿ç”¨ä¿¡å·é‡ã€‚ Dispatch Semaphore åœ¨å®é™…å¼€å‘ä¸­ä¸»è¦ç”¨äºï¼š ä¿æŒçº¿ç¨‹åŒæ­¥ï¼Œå°†å¼‚æ­¥æ‰§è¡Œä»»åŠ¡è½¬æ¢ä¸ºåŒæ­¥æ‰§è¡Œä»»åŠ¡ ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œä¸ºçº¿ç¨‹åŠ é” Dispatch Semaphore çº¿ç¨‹åŒæ­¥æˆ‘ä»¬åœ¨å¼€å‘ä¸­ï¼Œä¼šé‡åˆ°è¿™æ ·çš„éœ€æ±‚ï¼šå¼‚æ­¥æ‰§è¡Œè€—æ—¶ä»»åŠ¡ï¼Œå¹¶ä½¿ç”¨å¼‚æ­¥æ‰§è¡Œçš„ç»“æœè¿›è¡Œä¸€äº›é¢å¤–çš„æ“ä½œã€‚æ¢å¥è¯è¯´ï¼Œç›¸å½“äºï¼Œå°†å°†å¼‚æ­¥æ‰§è¡Œä»»åŠ¡è½¬æ¢ä¸ºåŒæ­¥æ‰§è¡Œä»»åŠ¡ã€‚æ¯”å¦‚è¯´ï¼šAFNetworking ä¸­ AFURLSessionManager.m é‡Œé¢çš„ tasksForKeyPath: æ–¹æ³•ã€‚é€šè¿‡å¼•å…¥ä¿¡å·é‡çš„æ–¹å¼ï¼Œç­‰å¾…å¼‚æ­¥æ‰§è¡Œä»»åŠ¡ç»“æœï¼Œè·å–åˆ° tasksï¼Œç„¶åå†è¿”å›è¯¥ tasksã€‚ 123456789101112131415161718192021- (NSArray *)tasksForKeyPath:(NSString *)keyPath &#123; __block NSArray *tasks &#x3D; nil; dispatch_semaphore_t semaphore &#x3D; dispatch_semaphore_create(0); [self.session getTasksWithCompletionHandler:^(NSArray *dataTasks, NSArray *uploadTasks, NSArray *downloadTasks) &#123; if ([keyPath isEqualToString:NSStringFromSelector(@selector(dataTasks))]) &#123; tasks &#x3D; dataTasks; &#125; else if ([keyPath isEqualToString:NSStringFromSelector(@selector(uploadTasks))]) &#123; tasks &#x3D; uploadTasks; &#125; else if ([keyPath isEqualToString:NSStringFromSelector(@selector(downloadTasks))]) &#123; tasks &#x3D; downloadTasks; &#125; else if ([keyPath isEqualToString:NSStringFromSelector(@selector(tasks))]) &#123; tasks &#x3D; [@[dataTasks, uploadTasks, downloadTasks] valueForKeyPath:@&quot;@unionOfArrays.self&quot;]; &#125; dispatch_semaphore_signal(semaphore); &#125;]; dispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER); return tasks;&#125; Dispatch Semaphore çº¿ç¨‹å®‰å…¨å’Œçº¿ç¨‹åŒæ­¥ï¼ˆä¸ºçº¿ç¨‹åŠ é”ï¼‰ çº¿ç¨‹å®‰å…¨ï¼šå¦‚æœä½ çš„ä»£ç æ‰€åœ¨çš„è¿›ç¨‹ä¸­æœ‰å¤šä¸ªçº¿ç¨‹åœ¨åŒæ—¶è¿è¡Œï¼Œè€Œè¿™äº›çº¿ç¨‹å¯èƒ½ä¼šåŒæ—¶è¿è¡Œè¿™æ®µä»£ç ã€‚å¦‚æœæ¯æ¬¡è¿è¡Œç»“æœå’Œå•çº¿ç¨‹è¿è¡Œçš„ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œè€Œä¸”å…¶ä»–çš„å˜é‡çš„å€¼ä¹Ÿå’Œé¢„æœŸçš„æ˜¯ä¸€æ ·çš„ï¼Œå°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚è‹¥æ¯ä¸ªçº¿ç¨‹ä¸­å¯¹å…¨å±€å˜é‡ã€é™æ€å˜é‡åªæœ‰è¯»æ“ä½œï¼Œè€Œæ— å†™æ“ä½œï¼Œä¸€èˆ¬æ¥è¯´ï¼Œè¿™ä¸ªå…¨å±€å˜é‡æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼›è‹¥æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œå†™æ“ä½œï¼ˆæ›´æ”¹å˜é‡ï¼‰ï¼Œä¸€èˆ¬éƒ½éœ€è¦è€ƒè™‘çº¿ç¨‹åŒæ­¥ï¼Œå¦åˆ™çš„è¯å°±å¯èƒ½å½±å“çº¿ç¨‹å®‰å…¨ã€‚ çº¿ç¨‹åŒæ­¥ï¼šå¯ç†è§£ä¸ºçº¿ç¨‹ A å’Œ çº¿ç¨‹ B ä¸€å—é…åˆï¼ŒA æ‰§è¡Œåˆ°ä¸€å®šç¨‹åº¦æ—¶è¦ä¾é çº¿ç¨‹ B çš„æŸä¸ªç»“æœï¼Œäºæ˜¯åœä¸‹æ¥ï¼Œç¤ºæ„ B è¿è¡Œï¼›B ä¾è¨€æ‰§è¡Œï¼Œå†å°†ç»“æœç»™ Aï¼›A å†ç»§ç»­æ“ä½œã€‚ ä¸¾ä¸ªç®€å•ä¾‹å­å°±æ˜¯ï¼šä¸¤ä¸ªäººåœ¨ä¸€èµ·èŠå¤©ã€‚ä¸¤ä¸ªäººä¸èƒ½åŒæ—¶è¯´è¯ï¼Œé¿å…å¬ä¸æ¸…(æ“ä½œå†²çª)ã€‚ç­‰ä¸€ä¸ªäººè¯´å®Œ(ä¸€ä¸ªçº¿ç¨‹ç»“æŸæ“ä½œ)ï¼Œå¦ä¸€ä¸ªå†è¯´(å¦ä¸€ä¸ªçº¿ç¨‹å†å¼€å§‹æ“ä½œ)ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬æ¨¡æ‹Ÿç«è½¦ç¥¨å”®å–çš„æ–¹å¼ï¼Œå®ç° NSThread çº¿ç¨‹å®‰å…¨å’Œè§£å†³çº¿ç¨‹åŒæ­¥é—®é¢˜ã€‚åœºæ™¯ï¼šæ€»å…±æœ‰50å¼ ç«è½¦ç¥¨ï¼Œæœ‰ä¸¤ä¸ªå”®å–ç«è½¦ç¥¨çš„çª—å£ï¼Œä¸€ä¸ªæ˜¯åŒ—äº¬ç«è½¦ç¥¨å”®å–çª—å£ï¼Œå¦ä¸€ä¸ªæ˜¯ä¸Šæµ·ç«è½¦ç¥¨å”®å–çª—å£ã€‚ä¸¤ä¸ªçª—å£åŒæ—¶å”®å–ç«è½¦ç¥¨ï¼Œå–å®Œä¸ºæ­¢ã€‚ éçº¿ç¨‹å®‰å…¨ï¼ˆä¸ä½¿ç”¨ semaphoreï¼‰å…ˆæ¥çœ‹çœ‹ä¸è€ƒè™‘çº¿ç¨‹å®‰å…¨çš„ä»£ç ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142&#x2F;** * éçº¿ç¨‹å®‰å…¨ï¼šä¸ä½¿ç”¨ semaphore * åˆå§‹åŒ–ç«è½¦ç¥¨æ•°é‡ã€å–ç¥¨çª—å£(éçº¿ç¨‹å®‰å…¨)ã€å¹¶å¼€å§‹å–ç¥¨ *&#x2F;- (void)initTicketStatusNotSave &#123; NSLog(@&quot;currentThread---%@&quot;,[NSThread currentThread]); &#x2F;&#x2F; æ‰“å°å½“å‰çº¿ç¨‹ NSLog(@&quot;semaphore---begin&quot;); self.ticketSurplusCount &#x3D; 50; &#x2F;&#x2F; queue1 ä»£è¡¨åŒ—äº¬ç«è½¦ç¥¨å”®å–çª—å£ dispatch_queue_t queue1 &#x3D; dispatch_queue_create(&quot;net.bujige.testQueue1&quot;, DISPATCH_QUEUE_SERIAL); &#x2F;&#x2F; queue2 ä»£è¡¨ä¸Šæµ·ç«è½¦ç¥¨å”®å–çª—å£ dispatch_queue_t queue2 &#x3D; dispatch_queue_create(&quot;net.bujige.testQueue2&quot;, DISPATCH_QUEUE_SERIAL); __weak typeof(self) weakSelf &#x3D; self; dispatch_async(queue1, ^&#123; [weakSelf saleTicketNotSafe]; &#125;); dispatch_async(queue2, ^&#123; [weakSelf saleTicketNotSafe]; &#125;);&#125;&#x2F;** * å”®å–ç«è½¦ç¥¨(éçº¿ç¨‹å®‰å…¨) *&#x2F;- (void)saleTicketNotSafe &#123; while (1) &#123; if (self.ticketSurplusCount &gt; 0) &#123; &#x2F;&#x2F;å¦‚æœè¿˜æœ‰ç¥¨ï¼Œç»§ç»­å”®å– self.ticketSurplusCount--; NSLog(@&quot;%@&quot;, [NSString stringWithFormat:@&quot;å‰©ä½™ç¥¨æ•°ï¼š%d çª—å£ï¼š%@&quot;, self.ticketSurplusCount, [NSThread currentThread]]); [NSThread sleepForTimeInterval:0.2]; &#125; else &#123; &#x2F;&#x2F;å¦‚æœå·²å–å®Œï¼Œå…³é—­å”®ç¥¨çª—å£ NSLog(@&quot;æ‰€æœ‰ç«è½¦ç¥¨å‡å·²å”®å®Œ&quot;); break; &#125; &#125;&#125; è¾“å‡ºç»“æœï¼ˆéƒ¨åˆ†ï¼‰ï¼š2018-02-23 22:25:35.789072+0800 YSC-GCD-demo[20712:5258914] currentThreadâ€”&lt;NSThread: 0x604000068880&gt;{number = 1, name = main} 2018-02-23 22:25:35.789260+0800 YSC-GCD-demo[20712:5258914] semaphoreâ€”begin 2018-02-23 22:25:35.789641+0800 YSC-GCD-demo[20712:5259176] å‰©ä½™ç¥¨æ•°ï¼š48 çª—å£ï¼š&lt;NSThread: 0x60000027db80&gt;{number = 3, name = (null)} 2018-02-23 22:25:35.789646+0800 YSC-GCD-demo[20712:5259175] å‰©ä½™ç¥¨æ•°ï¼š49 çª—å£ï¼š&lt;NSThread: 0x60000027e740&gt;{number = 4, name = (null)} 2018-02-23 22:25:35.994113+0800 YSC-GCD-demo[20712:5259175] å‰©ä½™ç¥¨æ•°ï¼š47 çª—å£ï¼š&lt;NSThread: 0x60000027e740&gt;{number = 4, name = (null)} 2018-02-23 22:25:35.994129+0800 YSC-GCD-demo[20712:5259176] å‰©ä½™ç¥¨æ•°ï¼š46 çª—å£ï¼š&lt;NSThread: 0x60000027db80&gt;{number = 3, name = (null)} 2018-02-23 22:25:36.198993+0800 YSC-GCD-demo[20712:5259176] å‰©ä½™ç¥¨æ•°ï¼š45 çª—å£ï¼š&lt;NSThread: 0x60000027db80&gt;{number = 3, name = (null)} å¯ä»¥çœ‹åˆ°åœ¨ä¸è€ƒè™‘çº¿ç¨‹å®‰å…¨ï¼Œä¸ä½¿ç”¨ semaphore çš„æƒ…å†µä¸‹ï¼Œå¾—åˆ°ç¥¨æ•°æ˜¯é”™ä¹±çš„ï¼Œè¿™æ ·æ˜¾ç„¶ä¸ç¬¦åˆæˆ‘ä»¬çš„éœ€æ±‚ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚ çº¿ç¨‹å®‰å…¨ï¼ˆä½¿ç”¨ semaphore åŠ é”ï¼‰è€ƒè™‘çº¿ç¨‹å®‰å…¨çš„ä»£ç ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051&#x2F;** * çº¿ç¨‹å®‰å…¨ï¼šä½¿ç”¨ semaphore åŠ é” * åˆå§‹åŒ–ç«è½¦ç¥¨æ•°é‡ã€å–ç¥¨çª—å£(çº¿ç¨‹å®‰å…¨)ã€å¹¶å¼€å§‹å–ç¥¨ *&#x2F;- (void)initTicketStatusSave &#123; NSLog(@&quot;currentThread---%@&quot;,[NSThread currentThread]); &#x2F;&#x2F; æ‰“å°å½“å‰çº¿ç¨‹ NSLog(@&quot;semaphore---begin&quot;); semaphoreLock &#x3D; dispatch_semaphore_create(1); self.ticketSurplusCount &#x3D; 50; &#x2F;&#x2F; queue1 ä»£è¡¨åŒ—äº¬ç«è½¦ç¥¨å”®å–çª—å£ dispatch_queue_t queue1 &#x3D; dispatch_queue_create(&quot;net.bujige.testQueue1&quot;, DISPATCH_QUEUE_SERIAL); &#x2F;&#x2F; queue2 ä»£è¡¨ä¸Šæµ·ç«è½¦ç¥¨å”®å–çª—å£ dispatch_queue_t queue2 &#x3D; dispatch_queue_create(&quot;net.bujige.testQueue2&quot;, DISPATCH_QUEUE_SERIAL); __weak typeof(self) weakSelf &#x3D; self; dispatch_async(queue1, ^&#123; [weakSelf saleTicketSafe]; &#125;); dispatch_async(queue2, ^&#123; [weakSelf saleTicketSafe]; &#125;);&#125;&#x2F;** * å”®å–ç«è½¦ç¥¨(çº¿ç¨‹å®‰å…¨) *&#x2F;- (void)saleTicketSafe &#123; while (1) &#123; &#x2F;&#x2F; ç›¸å½“äºåŠ é” dispatch_semaphore_wait(semaphoreLock, DISPATCH_TIME_FOREVER); if (self.ticketSurplusCount &gt; 0) &#123; &#x2F;&#x2F;å¦‚æœè¿˜æœ‰ç¥¨ï¼Œç»§ç»­å”®å– self.ticketSurplusCount--; NSLog(@&quot;%@&quot;, [NSString stringWithFormat:@&quot;å‰©ä½™ç¥¨æ•°ï¼š%d çª—å£ï¼š%@&quot;, self.ticketSurplusCount, [NSThread currentThread]]); [NSThread sleepForTimeInterval:0.2]; &#125; else &#123; &#x2F;&#x2F;å¦‚æœå·²å–å®Œï¼Œå…³é—­å”®ç¥¨çª—å£ NSLog(@&quot;æ‰€æœ‰ç«è½¦ç¥¨å‡å·²å”®å®Œ&quot;); &#x2F;&#x2F; ç›¸å½“äºè§£é” dispatch_semaphore_signal(semaphoreLock); break; &#125; &#x2F;&#x2F; ç›¸å½“äºè§£é” dispatch_semaphore_signal(semaphoreLock); &#125;&#125; è¾“å‡ºç»“æœä¸ºï¼š2018-02-23 22:32:19.814232+0800 YSC-GCD-demo[20862:5290531] currentThreadâ€”&lt;NSThread: 0x6000000783c0&gt;{number = 1, name = main} 2018-02-23 22:32:19.814412+0800 YSC-GCD-demo[20862:5290531] semaphoreâ€”begin 2018-02-23 22:32:19.814837+0800 YSC-GCD-demo[20862:5290687] å‰©ä½™ç¥¨æ•°ï¼š49 çª—å£ï¼š&lt;NSThread: 0x6040002709c0&gt;{number = 3, name = (null)} 2018-02-23 22:32:20.017745+0800 YSC-GCD-demo[20862:5290689] å‰©ä½™ç¥¨æ•°ï¼š48 çª—å£ï¼š&lt;NSThread: 0x60000046c640&gt;{number = 4, name = (null)} 2018-02-23 22:32:20.222039+0800 YSC-GCD-demo[20862:5290687] å‰©ä½™ç¥¨æ•°ï¼š47 çª—å£ï¼š&lt;NSThread: 0x6040002709c0&gt;{number = 3, name = (null)} â€¦2018-02-23 22:32:29.024817+0800 YSC-GCD-demo[20862:5290689] å‰©ä½™ç¥¨æ•°ï¼š4 çª—å£ï¼š&lt;NSThread: 0x60000046c640&gt;{number = 4, name = (null)} 2018-02-23 22:32:29.230110+0800 YSC-GCD-demo[20862:5290687] å‰©ä½™ç¥¨æ•°ï¼š3 çª—å£ï¼š&lt;NSThread: 0x6040002709c0&gt;{number = 3, name = (null)} 2018-02-23 22:32:29.433615+0800 YSC-GCD-demo[20862:5290689] å‰©ä½™ç¥¨æ•°ï¼š2 çª—å£ï¼š&lt;NSThread: 0x60000046c640&gt;{number = 4, name = (null)} 2018-02-23 22:32:29.637572+0800 YSC-GCD-demo[20862:5290687] å‰©ä½™ç¥¨æ•°ï¼š1 çª—å£ï¼š&lt;NSThread: 0x6040002709c0&gt;{number = 3, name = (null)} 2018-02-23 22:32:29.840234+0800 YSC-GCD-demo[20862:5290689] å‰©ä½™ç¥¨æ•°ï¼š0 çª—å£ï¼š&lt;NSThread: 0x60000046c640&gt;{number = 4, name = (null)} 2018-02-23 22:32:30.044960+0800 YSC-GCD-demo[20862:5290687] æ‰€æœ‰ç«è½¦ç¥¨å‡å·²å”®å®Œ 2018-02-23 22:32:30.045260+0800 YSC-GCD-demo[20862:5290689] æ‰€æœ‰ç«è½¦ç¥¨å‡å·²å”®å®Œ å¯ä»¥çœ‹å‡ºï¼Œåœ¨è€ƒè™‘äº†çº¿ç¨‹å®‰å…¨çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨ dispatch_semaphoreæœºåˆ¶ä¹‹åï¼Œå¾—åˆ°çš„ç¥¨æ•°æ˜¯æ­£ç¡®çš„ï¼Œæ²¡æœ‰å‡ºç°æ··ä¹±çš„æƒ…å†µã€‚æˆ‘ä»¬ä¹Ÿå°±è§£å†³äº†å¤šä¸ªçº¿ç¨‹åŒæ­¥çš„é—®é¢˜ã€‚ dispatch_groupå¤šä¸ªä»»åŠ¡æ”¾åˆ°ä¸€ä¸ªç»„ä¸­ã€‚ dispatch_group_tåˆ›å»º1dispatch_group_t group &#x3D; dispatch_group_create(); æ·»åŠ ä»»åŠ¡1234567891011dispatch_queue_t queue &#x3D; dispatch_queue_create(&quot;name&quot;, DISPATCH_QUEUE_SERIAL);int context &#x3D; 10;dispatch_group_async_f(group, queue, &amp;context, groupMethod);void groupMethod() &#123; &#x2F;&#x2F; TODO&#125;dispatch_queue_t queue &#x3D; dispatch_queue_create(&quot;name&quot;, DISPATCH_QUEUE_SERIAL);dispatch_group_async(group, queue, ^&#123; &#x2F;&#x2F; TODO&#125;); å…¶ä»–æ“ä½œ1. è·å–ä»»åŠ¡ç»„ä»»åŠ¡å®Œæˆï¼Œè¿›è¡Œæ“ä½œ1234567891011&#x2F;&#x2F; æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œå®Œï¼Œé€šçŸ¥è°ƒåº¦ç»„ï¼Œåœ¨queueä¸Šå¼‚æ­¥æ‰§è¡Œblockï¼Œä¸ä¼šé˜»å¡å½“å‰ä»»åŠ¡dispatch_group_notify_f(group, queue5, &amp;context, groupMethod);void groupMethod() &#123; &#x2F;&#x2F; TODO&#125;&#x2F;&#x2F; dispatch_group_notify_fçš„å°è£… dispatch_group_notify(group, queue, ^&#123; &#x2F;&#x2F; TODO&#125;); 2. é€šçŸ¥groupï¼Œä¸‹é¢çš„ä»»åŠ¡é©¬ä¸Šè¦æ”¾åˆ°groupä¸­æ‰§è¡Œäº†ã€‚1dispatch_group_enter(group); 3. é€šçŸ¥groupï¼Œä»»åŠ¡å®Œæˆäº†ï¼Œè¯¥ä»»åŠ¡è¦ä»groupä¸­ç§»é™¤äº†ã€‚1dispatch_group_leave(group); 4. è®¾ç½®è¶…æ—¶å‡è®¾åˆ›å»ºdispatch_group_waité‡Œçš„dispatch_timeç­‰å¾…æ—¶é—´æ˜¯4ç§’,é‚£ä¹ˆgroupé‡Œçš„å†…å®¹åœ¨4så†…å®Œæˆçš„è¯,é‚£waitç›´æ¥ç»“æŸ,å¦‚æœgroupåœ¨4så†…æ²¡æœ‰æ‰§è¡Œå®Œ,é‚£ä¹ˆwaitä¹Ÿä¼šç»“æŸ,ç»“æŸä¹‹å,å‘¨æœ«çš„ä»»åŠ¡å°±ä¼šè¢«åŠ è¿›æ¥äº†ã€‚ 123456long result &#x3D; dispatch_group_wait(group, dispatch_time(DISPATCH_TIME_NOW, 4.0 * NSEC_PER_SEC));if (result) &#123; NSLog(@&quot;è¶…è¿‡ç­‰å¾…æ—¶é—´äº†&quot;);&#125; else &#123; NSLog(@&quot;æ—¶é—´æ²¡æœ‰è¶…è¿‡ç­‰å¾…æ—¶é—´&quot;);&#125;","categories":[{"name":"Objective-C","slug":"Objective-C","permalink":"https://github.com/wuvdan/wuvdan.github.io/categories/Objective-C/"}],"tags":[{"name":"åº•å±‚åŸç†","slug":"åº•å±‚åŸç†","permalink":"https://github.com/wuvdan/wuvdan.github.io/tags/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/"}]},{"title":"iOSåº•å±‚-Runtime-æ¶ˆæ¯è½¬å‘","slug":"iOSåº•å±‚-Runtime-æ¶ˆæ¯è½¬å‘","date":"2020-01-16T07:59:00.220Z","updated":"2020-01-20T01:49:12.480Z","comments":true,"path":"2020/01/16/iOSåº•å±‚-Runtime-æ¶ˆæ¯è½¬å‘/","link":"","permalink":"https://github.com/wuvdan/wuvdan.github.io/2020/01/16/iOS%E5%BA%95%E5%B1%82-Runtime-%E6%B6%88%E6%81%AF%E8%BD%AC%E5%8F%91/","excerpt":"","text":"iOS æ–¹æ³•çš„åŠ¨æ€è§£æå’Œæ¶ˆæ¯è½¬å‘ ä»¥åˆ›å»ºçš„Messageç±»ä¸ºç¤ºä¾‹Message.h 1234567@interface Message : NSObject- (void)sendMessage:(NSString *)message;+ (void)sendClassMessage:(NSString *)message;@end Message.m 123@implementation Message@end åŠ¨æ€æ–¹æ³•è§£æå¾è¯¢æ¥æ”¶è€…æ‰€å±çš„ç±»ï¼Œæ˜¯å¦éœ€è¦åŠ¨æ€æ·»åŠ ç±»æ–¹æ³•æˆ–å®ä¾‹æ–¹æ³•ï¼Œæ¥å¤„ç†è¿™ä¸ªæœªæ‰¾åˆ°çš„æ–¹æ³•ã€‚ é¦–å…ˆåˆ¤æ–­æ˜¯å¦å®ç°äº† resolveInstanceMethodï¼Œå¦‚æœæ²¡æœ‰å®ç°ï¼Œè¿›å…¥ä¸‹ä¸€æ­¥å¤„ç†ï¼› å¦‚æœå®ç°äº†ï¼Œè°ƒç”¨ resolveInstanceMethodï¼Œè·å–è¿”å›å€¼ï¼› å¦‚æœè¿”å›å€¼ä¸º YESï¼Œè¡¨ç¤º resolveInstanceMethod å£°ç§°å®ƒå·²ç»æä¾›äº† selector çš„å®ç°ï¼Œå› æ­¤å†æ¬¡æŸ¥æ‰¾ method listï¼Œå¦‚æœæ‰¾åˆ°å¯¹åº”çš„ IMPï¼Œåˆ™è¿”å›è¯¥å®ç°ï¼Œå¦åˆ™æç¤ºè­¦å‘Šä¿¡æ¯ï¼Œè¿›å…¥ä¸‹ä¸€æ­¥å¤„ç†ï¼› å¦‚æœè¿”å›å€¼ä¸º NOï¼Œè¿›å…¥ä¸‹ä¸€æ­¥å¤„ç†ï¼›1. å¯¹è±¡æ–¹æ³•é€šè¿‡+ (BOOL)resolveInstanceMethod:(SEL)sel;æ–¹æ³•è¿›è¡Œè§£æ1234567891011+ (BOOL)resolveInstanceMethod:(SEL)sel &#123; if (sel &#x3D;&#x3D; @selector(sendMessage:)) &#123; class_addMethod([self class], sel, (IMP)innerSenderMessageMetod, &quot;v@:@&quot;); return YES; &#125; return [super resolveInstanceMethod:sel];&#125;void innerSenderMessageMetod(id obj, SEL _cmd) &#123; NSLog(@&quot;å¯¹è±¡æ–¹æ³•ï¼ŒåŠ¨æ€è§£æ&quot;);&#125; 2. ç±»æ–¹æ³•é€šè¿‡+ (BOOL)resolveClassMethod:(SEL)sel;æ–¹æ³•è¿›è¡Œè§£æ1234567891011+ (BOOL)resolveClassMethod:(SEL)sel &#123; if (sel &#x3D;&#x3D; @selector(sendClassMessage:)) &#123; class_addMethod(object_getClass(self), sel, (IMP)innerSenderClassMessageMetod, &quot;v@:@&quot;); return YES; &#125; return [super resolveClassMethod:sel];&#125;void innerSenderClassMessageMetod(id obj, SEL _cmd) &#123; NSLog(@&quot;ç±»æ–¹æ³•ï¼ŒåŠ¨æ€è§£æ&quot;);&#125; é‡å®šå‘å¦‚æœæ²¡æœ‰åŠ¨æ€æ·»åŠ æ–¹æ³•ï¼Œåˆ™ä¼šè¿›å…¥æ­¤é˜¶æ®µï¼Œæ­¤æ—¶è¯¢é—®æ˜¯å¦è¦å°†è¿™æ¡æ¶ˆæ¯è½¬å‘ç»™å…¶ä»–çš„å¯¹è±¡ï¼Œæ¥å¤„ç†è¿™ä¸ªæ–¹æ³•ã€‚å¦‚æœè¿”å›nilï¼Œå³è¡¨ç¤ºä¸è½¬å‘ç»™å…¶ä»–å¯¹è±¡ï¼Œæ­¤æ—¶ä¼šè¿›å…¥ç¬¬3é˜¶æ®µåˆ›å»ºäº†ä¸€ä¸ªå¤‡ç”¨ç±»MessageTempMessageTemp.h12345@interface MessageTemp : NSObject- (void)sendMessage:(NSString *)message;- (void)sendClassMessage:(NSString *)message;@end MessageTemp.m12345678@implementation MessageTemp- (void)sendMessage:(NSString *)message &#123; NSLog(@&quot;å¤‡ç”¨Messageï¼Œè§£æå¯¹è±¡æ–¹æ³•&quot;);&#125;- (void)sendClassMessage:(NSString *)message &#123; NSLog(@&quot;å¤‡ç”¨Messageï¼Œè§£æç±»æ–¹æ³•&quot;);&#125;@end 1. å¯¹è±¡æ–¹æ³•123456- (id)forwardingTargetForSelector:(SEL)aSelector &#123; if (aSelector &#x3D;&#x3D; @selector(sendMessage:)) &#123; return [MessageTemp new]; &#125; return [super forwardingTargetForSelector:aSelector];&#125; 2. ç±»æ–¹æ³•123456+ (id)forwardingTargetForSelector:(SEL)aSelector &#123; if (aSelector &#x3D;&#x3D; @selector(sendClassMessage:)) &#123; return [MessageTemp new]; &#125; return [super forwardingTargetForSelector:aSelector];&#125; æ¶ˆæ¯è½¬å‘å½“ forwardingTargetForSelector: æ–¹æ³•æœªåšå‡ºä»»ä½•å“åº”çš„è¯ï¼Œä¼šæ¥åˆ°æ¶ˆæ¯è½¬å‘æµç¨‹ã€‚æ¶ˆæ¯è½¬å‘æ—¶ä¼šé¦–å…ˆè°ƒç”¨ methodSignatureForSelector: æ–¹æ³•ï¼Œåœ¨æ–¹æ³•å†…éƒ¨ç”Ÿæˆ NSMethodSignature ç±»å‹çš„æ–¹æ³•ç­¾åå¯¹è±¡ã€‚åœ¨ç”Ÿæˆç­¾åå¯¹è±¡æ—¶ï¼Œå¯ä»¥æŒ‡å®š target å’Œ SELï¼Œå¯ä»¥å°†è¿™ä¸¤ä¸ªå‚æ•°æ¢æˆå…¶ä»–å‚æ•°ï¼Œå°†æ¶ˆæ¯è½¬å‘ç»™å…¶ä»–å¯¹è±¡ã€‚1. å¯¹è±¡æ–¹æ³•1234567891011121314- (void)forwardInvocation:(NSInvocation *)anInvocation &#123; if ([anInvocation selector] &#x3D;&#x3D; @selector(sendMessage:)) &#123; [anInvocation invokeWithTarget:[MessageTemp new]]; &#125; else &#123; [super forwardInvocation:anInvocation]; &#125;&#125;- (NSMethodSignature *)methodSignatureForSelector:(SEL)aSelector &#123; if (aSelector &#x3D;&#x3D; @selector(sendMessage:)) &#123; return [NSMethodSignature signatureWithObjCTypes:&quot;v@:@&quot;]; &#125; return [super methodSignatureForSelector:aSelector];&#125; 2. ç±»æ–¹æ³•1234567891011121314+ (void)forwardInvocation:(NSInvocation *)anInvocation &#123; if ([anInvocation selector] &#x3D;&#x3D; @selector(sendClassMessage:)) &#123; [anInvocation invokeWithTarget:[MessageTemp new]]; &#125; else &#123; [super forwardInvocation:anInvocation]; &#125;&#125;+ (NSMethodSignature *)methodSignatureForSelector:(SEL)aSelector &#123; if (aSelector &#x3D;&#x3D; @selector(sendClassMessage:)) &#123; return [NSMethodSignature signatureWithObjCTypes:&quot;v@:@&quot;]; &#125; return [super methodSignatureForSelector:aSelector];&#125; åº”ç”¨åœºæ™¯ é€‚ç”¨äºæŠŠæ“ä½œç»™å¦å¤–ä¸€ä¸ªç±»æ¥å®ç° åˆ©ç”¨åˆ†ç±»ï¼Œé˜²æ­¢åº”ç”¨ç¨‹åºå› ä¸ºæœªå¤„ç†æ¶ˆæ¯è€Œå´©æºƒ Jspatch Aspects BlocksKit","categories":[{"name":"åº•å±‚åŸç†","slug":"åº•å±‚åŸç†","permalink":"https://github.com/wuvdan/wuvdan.github.io/categories/%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/"}],"tags":[{"name":"runtime","slug":"runtime","permalink":"https://github.com/wuvdan/wuvdan.github.io/tags/runtime/"}]}]}