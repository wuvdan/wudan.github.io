<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>iOSè‡ªå®šä¹‰æ§ä»¶-è‡ªå®šä¹‰Alterå¼¹çª—</title>
      <link href="/2020/01/20/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-%E8%87%AA%E5%AE%9A%E4%B9%89Alter%E5%BC%B9%E7%AA%97/"/>
      <url>/2020/01/20/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-%E8%87%AA%E5%AE%9A%E4%B9%89Alter%E5%BC%B9%E7%AA%97/</url>
      
        <content type="html"><![CDATA[<p>åœ¨ä¸‹å°ç™½ä¸€ä¸ªï¼Œå‡†å¤‡å†™å†™å’Œè‡ªå·±å¼€å‘æ¯æ¯ç›¸å…³çš„æ§ä»¶ï¼Œå¸Œæœ›å¤§å®¶æ‰¹è¯„æŒ‡æ­£ã€‚è¿™æ˜¯ç¬¬ä¸€ä¸ªå¸¸ç”¨çš„åº•éƒ¨å¼¹çª—ï¼Œä½¿ç”¨äº†æœ€ç®€å•çš„åˆ†è£…æ–¹å¼ã€‚</p><h3 id="1ã€å¤´æ–‡ä»¶é‡Œé¢å£°æ˜äº†ä¸€ä¸ªä»£ç†å’Œåˆå§‹åŒ–æ–¹æ³•ã€‚"><a href="#1ã€å¤´æ–‡ä»¶é‡Œé¢å£°æ˜äº†ä¸€ä¸ªä»£ç†å’Œåˆå§‹åŒ–æ–¹æ³•ã€‚" class="headerlink" title="1ã€å¤´æ–‡ä»¶é‡Œé¢å£°æ˜äº†ä¸€ä¸ªä»£ç†å’Œåˆå§‹åŒ–æ–¹æ³•ã€‚"></a>1ã€å¤´æ–‡ä»¶é‡Œé¢å£°æ˜äº†ä¸€ä¸ªä»£ç†å’Œåˆå§‹åŒ–æ–¹æ³•ã€‚</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;UIKit&#x2F;UIKit.h&gt;</span><br><span class="line"></span><br><span class="line">NS_ASSUME_NONNULL_BEGIN</span><br><span class="line"></span><br><span class="line">@interface WDActionSheet : UIView</span><br><span class="line"></span><br><span class="line">+ (void)showWithActionTitles:(NSArray&lt;NSString *&gt; *)titles</span><br><span class="line">                  cancelText:( NSString * _Nullable)cancel</span><br><span class="line">              didSelectBlock:(void(^)(NSInteger index))selectBlock;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">NS_ASSUME_NONNULL_END</span><br></pre></td></tr></table></figure><h3 id="2ã€å®ç°æ–‡ä»¶é‡Œé¢è¿›è¡Œé¡µé¢çš„ç»˜åˆ¶ã€æ•°æ®å¤„ç†å’Œäº‹ä»¶å¤„ç†ã€‚"><a href="#2ã€å®ç°æ–‡ä»¶é‡Œé¢è¿›è¡Œé¡µé¢çš„ç»˜åˆ¶ã€æ•°æ®å¤„ç†å’Œäº‹ä»¶å¤„ç†ã€‚" class="headerlink" title="2ã€å®ç°æ–‡ä»¶é‡Œé¢è¿›è¡Œé¡µé¢çš„ç»˜åˆ¶ã€æ•°æ®å¤„ç†å’Œäº‹ä»¶å¤„ç†ã€‚"></a>2ã€å®ç°æ–‡ä»¶é‡Œé¢è¿›è¡Œé¡µé¢çš„ç»˜åˆ¶ã€æ•°æ®å¤„ç†å’Œäº‹ä»¶å¤„ç†ã€‚</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;WDActionSheet.h&quot;</span><br><span class="line"></span><br><span class="line">#define kDevice_iPhoneX \</span><br><span class="line">(&#123;BOOL isPhoneX &#x3D; NO;\</span><br><span class="line">if (@available(iOS 11.0, *)) &#123;\</span><br><span class="line">isPhoneX &#x3D; [[UIApplication sharedApplication] delegate].window.safeAreaInsets.bottom &gt; 0.0;\</span><br><span class="line">&#125;\</span><br><span class="line">(isPhoneX);&#125;)</span><br><span class="line"></span><br><span class="line">static CGFloat RowHeight &#x3D; 45.0;</span><br><span class="line">static CGFloat RowSpace &#x3D; 10.0;</span><br><span class="line"></span><br><span class="line">@interface WDActionSheetCancelButton : UIButton</span><br><span class="line">@property (nonatomic, strong) UILabel *textLabel;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation WDActionSheetCancelButton</span><br><span class="line"></span><br><span class="line">- (instancetype)init &#123;</span><br><span class="line">    self &#x3D; [super init];</span><br><span class="line">    if (self) &#123;</span><br><span class="line">        self.textLabel &#x3D; [[UILabel alloc] init];</span><br><span class="line">        self.textLabel.textAlignment &#x3D; NSTextAlignmentCenter;</span><br><span class="line">        self.textLabel.font &#x3D; [UIFont systemFontOfSize:15 weight:UIFontWeightLight];</span><br><span class="line">        [self addSubview:self.textLabel];</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)layoutSubviews &#123;</span><br><span class="line">    [super layoutSubviews];</span><br><span class="line">    </span><br><span class="line">    if (kDevice_iPhoneX) &#123;</span><br><span class="line">        self.textLabel.frame &#x3D; CGRectMake(0, 0, self.bounds.size.width, RowHeight);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        self.textLabel.frame &#x3D; self.bounds;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@interface UIView (Line)</span><br><span class="line">- (void)setupLine;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation UIView (Line)</span><br><span class="line">- (void)setupLine &#123;</span><br><span class="line">    UIView *lineView &#x3D; [[UIView alloc] init];</span><br><span class="line">    lineView.backgroundColor &#x3D; [UIColor colorWithRed:0.95 green:0.95 blue:0.95 alpha:1];</span><br><span class="line">    [self addSubview:lineView];</span><br><span class="line">    lineView.frame &#x3D; CGRectMake(0, CGRectGetMaxY(self.frame) - 1, CGRectGetWidth(self.frame), 1);</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@interface WDActionSheet ()</span><br><span class="line">@property (nonatomic, copy) void (^selectItemBlock)(NSInteger index);</span><br><span class="line">@property (nonatomic, strong) UIButton *backViewButton;</span><br><span class="line">@property (nonatomic, strong) UIView *containerView;</span><br><span class="line">@property (nonatomic, strong) UIView *spreadView;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation WDActionSheet</span><br><span class="line"></span><br><span class="line">+ (instancetype)manager &#123;</span><br><span class="line">    static dispatch_once_t onceToken;</span><br><span class="line">    static WDActionSheet *actionSheet;</span><br><span class="line">    dispatch_once(&amp;onceToken, ^&#123;</span><br><span class="line">        actionSheet &#x3D; [[WDActionSheet alloc] init];</span><br><span class="line">        actionSheet.frame &#x3D; [[UIScreen mainScreen] bounds];</span><br><span class="line">    &#125;);</span><br><span class="line">    return actionSheet;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (void)setupRoundedCornersWithView:(UIView *)view &#123;</span><br><span class="line"></span><br><span class="line">    CAShapeLayer *mask &#x3D; [CAShapeLayer layer];</span><br><span class="line">    UIBezierPath * path &#x3D; [UIBezierPath bezierPathWithRoundedRect:view.bounds</span><br><span class="line">                                                byRoundingCorners:(UIRectCornerTopLeft | UIRectCornerTopRight)</span><br><span class="line">                                                      cornerRadii:CGSizeMake(15, 15)];</span><br><span class="line">    mask.path &#x3D; path.CGPath;</span><br><span class="line">    mask.frame &#x3D; view.bounds;</span><br><span class="line">    </span><br><span class="line">    CAShapeLayer *borderLayer &#x3D; [CAShapeLayer layer];</span><br><span class="line">    borderLayer.path &#x3D; path.CGPath;</span><br><span class="line">    borderLayer.fillColor &#x3D; [UIColor clearColor].CGColor;</span><br><span class="line">    borderLayer.strokeColor &#x3D; [UIColor clearColor].CGColor;</span><br><span class="line">    borderLayer.lineWidth &#x3D; 0;</span><br><span class="line">    borderLayer.frame &#x3D; view.bounds;</span><br><span class="line">    view.layer.mask &#x3D; mask;</span><br><span class="line">    [view.layer addSublayer:borderLayer];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (void)showWithActionTitles:(NSArray&lt;NSString *&gt; *)titles</span><br><span class="line">                  cancelText:(NSString *)cancel</span><br><span class="line">              didSelectBlock:(void (^)(NSInteger))selectBlock &#123;</span><br><span class="line">    </span><br><span class="line">    WDActionSheet *actionSheet &#x3D; [self manager];</span><br><span class="line">    actionSheet.selectItemBlock &#x3D; selectBlock;</span><br><span class="line">    [actionSheet showAlterSheet];</span><br><span class="line">        </span><br><span class="line">    [titles enumerateObjectsUsingBlock:^(NSString * _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) &#123;</span><br><span class="line">        UIButton *button &#x3D; [actionSheet setupActionWithTitle:obj];</span><br><span class="line">        button.frame &#x3D; CGRectMake(0, RowHeight * idx, kScreenWidth, RowHeight);</span><br><span class="line">        if (idx !&#x3D; titles.count - 1) &#123;</span><br><span class="line">            [button setupLine];</span><br><span class="line">        &#125;</span><br><span class="line">        button.tag &#x3D; 1000 + idx;</span><br><span class="line">        [actionSheet.containerView addSubview:button];</span><br><span class="line">    &#125;];</span><br><span class="line">    </span><br><span class="line">    if (cancel.length &gt; 0) &#123;</span><br><span class="line">        actionSheet.spreadView.frame &#x3D; CGRectMake(0, RowHeight * titles.count, kScreenWidth, RowSpace);</span><br><span class="line">        UIButton *button &#x3D; [actionSheet cancelButtonWithTitle:cancel];</span><br><span class="line">        if (kDevice_iPhoneX) &#123;</span><br><span class="line">            button.frame &#x3D; CGRectMake(0, RowHeight * titles.count + RowSpace, kScreenWidth, RowHeight + 34);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            button.frame &#x3D; CGRectMake(0, RowHeight * titles.count + RowSpace, kScreenWidth, RowHeight);</span><br><span class="line">        &#125;</span><br><span class="line">        [actionSheet.containerView addSubview:button];</span><br><span class="line">    &#125; </span><br><span class="line">    </span><br><span class="line">    CGFloat totalHeight &#x3D; 0;</span><br><span class="line">    if (kDevice_iPhoneX) &#123;</span><br><span class="line">        if (cancel.length &gt; 0) &#123;</span><br><span class="line">            totalHeight &#x3D; (titles.count + 1) * RowHeight + RowSpace + 34;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            totalHeight &#x3D; titles.count * RowHeight + 34;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        if (cancel.length &gt; 0) &#123;</span><br><span class="line">            totalHeight &#x3D; (titles.count + 1) * RowHeight + RowSpace;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            totalHeight &#x3D; titles.count * RowHeight;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    actionSheet.containerView.frame &#x3D; CGRectMake(0, kScreenHeight, kScreenWidth, totalHeight);</span><br><span class="line">    [self setupRoundedCornersWithView:actionSheet.containerView];</span><br><span class="line">    actionSheet.backViewButton.backgroundColor &#x3D; [UIColor colorWithWhite:0 alpha:0];</span><br><span class="line"></span><br><span class="line">    [UIView animateWithDuration:0.3 animations:^&#123;</span><br><span class="line">        actionSheet.backViewButton.backgroundColor &#x3D; [UIColor colorWithWhite:0 alpha:0.3];</span><br><span class="line">        actionSheet.containerView.frame &#x3D; CGRectMake(0, kScreenHeight - totalHeight, kScreenWidth, totalHeight);</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (UIButton *)setupActionWithTitle:(NSString *)title &#123;</span><br><span class="line">    UIButton *button       &#x3D; [[UIButton alloc] init];</span><br><span class="line">    [button setTitle:title forState:UIControlStateNormal];</span><br><span class="line">    [button setTitleColor:UIColor.blackColor forState:UIControlStateNormal];</span><br><span class="line">    button.backgroundColor &#x3D; [UIColor whiteColor];</span><br><span class="line">    button.titleLabel.font &#x3D; [UIFont systemFontOfSize:15 weight:UIFontWeightLight];</span><br><span class="line">    [button addTarget:self action:@selector(buttonTouched:) forControlEvents:UIControlEventTouchUpInside];</span><br><span class="line">    return button;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (UIButton *)cancelButtonWithTitle:(NSString *)title &#123;</span><br><span class="line">    WDActionSheetCancelButton *button &#x3D; [[WDActionSheetCancelButton alloc] init];</span><br><span class="line">    button.textLabel.text &#x3D; title;</span><br><span class="line">    [button addTarget:self action:@selector(hidenAlterSheet) forControlEvents:UIControlEventTouchUpInside];</span><br><span class="line">    return button;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)buttonTouched:(UIButton *)sender &#123;</span><br><span class="line">    [self hidenAlterSheet];</span><br><span class="line">    if (self.selectItemBlock) &#123;</span><br><span class="line">        self.selectItemBlock(sender.tag - 1000);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)showAlterSheet &#123;</span><br><span class="line">    [[UIApplication sharedApplication].keyWindow addSubview:self];</span><br><span class="line">    self.backViewButton.frame &#x3D; [[UIScreen mainScreen] bounds];</span><br><span class="line">    [self addSubview:self.backViewButton];</span><br><span class="line">    [self.backViewButton addSubview:self.containerView];</span><br><span class="line">    [self.containerView addSubview:self.spreadView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)hidenAlterSheet &#123;</span><br><span class="line">    [UIView animateWithDuration:0.3 animations:^&#123;</span><br><span class="line">        self.containerView.frame &#x3D; CGRectMake(0, kScreenHeight, kScreenHeight, 0);</span><br><span class="line">        self.backViewButton.backgroundColor &#x3D; [UIColor colorWithWhite:0 alpha:0];</span><br><span class="line">    &#125; completion:^(BOOL finished) &#123;</span><br><span class="line">        for (UIView *view in self.containerView.subviews) &#123;</span><br><span class="line">            [view removeFromSuperview];</span><br><span class="line">        &#125;</span><br><span class="line">        [self removeFromSuperview];</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - Lazy</span><br><span class="line"></span><br><span class="line">- (UIButton *)backViewButton &#123;</span><br><span class="line">    if (!_backViewButton) &#123;</span><br><span class="line">        _backViewButton &#x3D; [[UIButton alloc] init];</span><br><span class="line">        [_backViewButton addTarget:self action:@selector(hidenAlterSheet) forControlEvents:UIControlEventTouchUpInside];</span><br><span class="line">    &#125;</span><br><span class="line">    return _backViewButton;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (UIView *)containerView &#123;</span><br><span class="line">    if (!_containerView) &#123;</span><br><span class="line">        _containerView &#x3D; [[UIView alloc] init];</span><br><span class="line">        _containerView.backgroundColor &#x3D; [UIColor whiteColor];</span><br><span class="line">    &#125;</span><br><span class="line">    return _containerView;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (UIView *)spreadView &#123;</span><br><span class="line">    if (!_spreadView) &#123;</span><br><span class="line">        _spreadView &#x3D; [[UIView alloc] init];</span><br><span class="line">        _spreadView.backgroundColor &#x3D; [UIColor colorWithRed:0.95 green:0.95 blue:0.95 alpha:1];</span><br><span class="line">    &#125;</span><br><span class="line">    return _spreadView;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure><h3 id="3ã€ä½¿ç”¨æ–¹æ³•"><a href="#3ã€ä½¿ç”¨æ–¹æ³•" class="headerlink" title="3ã€ä½¿ç”¨æ–¹æ³•"></a>3ã€ä½¿ç”¨æ–¹æ³•</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[WDActionSheet showWithActionTitles:@[@&quot;æ ‡é¢˜1&quot;, @&quot;æ ‡é¢˜2&quot;] cancelText:@&quot;å–æ¶ˆ&quot; didSelectBlock:^(NSInteger index) &#123;</span><br><span class="line">    </span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure><p>ç»“å°¾ï¼šæœ‰é—®é¢˜å¸Œæœ›å¤§å®¶æŒ‡æ­£ï¼ğŸ˜„ğŸ˜„ğŸ˜„</p>]]></content>
      
      
      <categories>
          
          <category> Objective-C </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è‡ªå®šä¹‰æ§ä»¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iOSåº•å±‚-KVO</title>
      <link href="/2020/01/16/iOS%E5%BA%95%E5%B1%82-KVO/"/>
      <url>/2020/01/16/iOS%E5%BA%95%E5%B1%82-KVO/</url>
      
        <content type="html"><![CDATA[<h3 id="ç±»çš„å•ä¸ªå±æ€§è§‚å¯Ÿ"><a href="#ç±»çš„å•ä¸ªå±æ€§è§‚å¯Ÿ" class="headerlink" title="ç±»çš„å•ä¸ªå±æ€§è§‚å¯Ÿ"></a>ç±»çš„å•ä¸ªå±æ€§è§‚å¯Ÿ</h3><p>è§‚å¯Ÿå€¼çš„4ä¸­æ¨¡å¼</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> *  NSKeyValueObservingOptionNew     æ–°å€¼</span><br><span class="line"> *  NSKeyValueObservingOptionOld     æ—§å€¼</span><br><span class="line"> *  NSKeyValueObservingOptionInitial æ³¨å†Œå‘é€é€šçŸ¥ï¼Œæ”¹å˜æ—¶å‘é€é€šçŸ¥</span><br><span class="line"> *  NSKeyValueObservingOptionPrior   æ”¹å˜ä¹‹å‰å‘é€é€šçŸ¥ï¼Œæ”¹å˜åå‘é€é€šçŸ¥</span><br><span class="line"> *&#x2F;</span><br></pre></td></tr></table></figure><p>é’ˆå¯¹<code>Person</code>ç±»é‡Œé¢çš„<code>name</code>å±æ€§è¿›è¡Œè§‚å¯Ÿ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[person addObserver:self forKeyPath:@&quot;name&quot; options:NSKeyValueObservingOptionNew context:nil];</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹è§‚å¯Ÿ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (void)observeValueForKeyPath:(NSString *)keyPath ofObject:(id)object change:(NSDictionary&lt;NSKeyValueChangeKey,id&gt; *)change context:(void *)context &#123;</span><br><span class="line">    NSLog(@&quot;%@&quot;, change);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰“å°æ•ˆæœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2019-03-22 09:20:16.875033+0800 KVO[1844:81256] &#123;</span><br><span class="line">    kind &#x3D; 1;</span><br><span class="line">    new &#x3D; 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç±»çš„é‡Œé¢åµŒå¥—å…¶ä»–çš„å±æ€§è§‚å¯Ÿ"><a href="#ç±»çš„é‡Œé¢åµŒå¥—å…¶ä»–çš„å±æ€§è§‚å¯Ÿ" class="headerlink" title="ç±»çš„é‡Œé¢åµŒå¥—å…¶ä»–çš„å±æ€§è§‚å¯Ÿ"></a>ç±»çš„é‡Œé¢åµŒå¥—å…¶ä»–çš„å±æ€§è§‚å¯Ÿ</h3><p>è§‚å¯Ÿ<code>Person</code>é‡Œé¢<code>Dog</code>ç±»çš„<code>age</code>ï¼Œé€šè¿‡ç‚¹è¯­æ³•ç›´æ¥ç›‘å¬</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[person addObserver:self forKeyPath:@&quot;dog.age&quot; options:NSKeyValueObservingOptionNew context:nil];</span><br></pre></td></tr></table></figure><p>è¾“å…¥ç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2019-03-22 09:23:25.854859+0800 KVO[1876:84141] &#123;</span><br><span class="line">    kind &#x3D; 1;</span><br><span class="line">    new &#x3D; 11;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä¸€æ¬¡æ€§è§‚å¯Ÿå¤šä¸ªå€¼"><a href="#ä¸€æ¬¡æ€§è§‚å¯Ÿå¤šä¸ªå€¼" class="headerlink" title="ä¸€æ¬¡æ€§è§‚å¯Ÿå¤šä¸ªå€¼"></a>ä¸€æ¬¡æ€§è§‚å¯Ÿå¤šä¸ªå€¼</h3><p>ä¾‹å¦‚è§‚å¯Ÿ<code>Person</code>é‡Œé¢çš„<code>Dog</code>çš„<code>age</code>å’Œ<code>level</code>ï¼Œåˆ™åœ¨<code>Person</code>ç±»ä¸­é‡æ–°<code>+ (NSSet&lt;NSString *&gt; *)keyPathsForValuesAffectingValueForKey:(NSString *)key</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+ (NSSet&lt;NSString *&gt; *)keyPathsForValuesAffectingValueForKey:(NSString *)key &#123;</span><br><span class="line">    NSSet *keyPaths &#x3D; [super keyPathsForValuesAffectingValueForKey:key];</span><br><span class="line">    if ([key isEqualToString:@&quot;dog&quot;]) &#123;</span><br><span class="line">        NSArray *array &#x3D; @[@&quot;_dog.name&quot;, @&quot;_dog.level&quot;];</span><br><span class="line">        keyPaths &#x3D; [keyPaths setByAddingObjectsFromArray:array];</span><br><span class="line">    &#125;</span><br><span class="line">    return keyPaths;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›´æ¥è§‚å¯Ÿ<code>Dog</code>ç±»</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[person addObserver:self forKeyPath:@&quot;dog&quot; options:NSKeyValueObservingOptionNew context:nil];</span><br></pre></td></tr></table></figure><p>æ‰“å°ç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2019-03-22 09:27:11.485240+0800 KVO[1929:87568] &#123;</span><br><span class="line">    kind &#x3D; 1;</span><br><span class="line">    new &#x3D; &quot;&lt;Dog: 0x6000027c0b80&gt;&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ‰‹åŠ¨æ¨¡å¼"><a href="#æ‰‹åŠ¨æ¨¡å¼" class="headerlink" title="æ‰‹åŠ¨æ¨¡å¼"></a>æ‰‹åŠ¨æ¨¡å¼</h3><p>åœ¨Personç±»ä¸­é‡å†™<code>+ (BOOL)automaticallyNotifiesObserversForKey:(NSString *)key</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">+ (BOOL)automaticallyNotifiesObserversForKey:(NSString *)key &#123;</span><br><span class="line">    &#x2F;&#x2F; ä¿®æ”¹ä¸ºæ‰‹åŠ¨æ¨¡å¼</span><br><span class="line">    return NO;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰‹åŠ¨è§¦å‘</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[self.person willChangeValueForKey:@&quot;name&quot;];</span><br><span class="line">[self.person didChangeValueForKey:@&quot;name&quot;];</span><br></pre></td></tr></table></figure><h3 id="è§‚å¯Ÿå®¹å™¨ç±»"><a href="#è§‚å¯Ÿå®¹å™¨ç±»" class="headerlink" title="è§‚å¯Ÿå®¹å™¨ç±»"></a>è§‚å¯Ÿå®¹å™¨ç±»</h3><p>éœ€è¦åˆ©ç”¨<code>KVC</code><br>ä¾‹å¦‚è§‚å¯Ÿ<code>person</code>ä¸­çš„<code>array</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[self.person mutableArrayValueForKey:@&quot;array&quot;] addObject:@&quot;obj&quot;];</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">2019-03-22 11:02:13.996095+0800 KVO[5521:170395] &#123;</span><br><span class="line">    indexes &#x3D; &quot;&lt;_NSCachedIndexSet: 0x600002216160&gt;[number of indexes: 1 (in 1 ranges), indexes: (0)]&quot;;</span><br><span class="line">    kind &#x3D; 2;</span><br><span class="line">    new &#x3D;     (</span><br><span class="line">        obj</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="KVOçš„åº•å±‚å®ç°"><a href="#KVOçš„åº•å±‚å®ç°" class="headerlink" title="KVOçš„åº•å±‚å®ç°"></a>KVOçš„åº•å±‚å®ç°</h3><p>å®è´¨ï¼šè§‚å¯Ÿå€¼çš„setteræ–¹æ³•<br>é€šè¿‡runtimeï¼Œæ–°å»ºä¸€ä¸ªå­ç±»ç»§æ‰¿äºè§‚å¯Ÿç±»ï¼ˆNSKVONotifing_ç±»åï¼‰ï¼ŒåŠ¨æ€çš„ä¿®æ”¹äº†è§‚å¯Ÿç±»çš„ç±»å‹ä¸ºå­ç±»çš„ç±»å‹,åœ¨å­ç±»é‡Œé¢é‡å†™setæ–¹æ³•ï¼Œè°ƒç”¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- (void)setName:(NSString *)name &#123;</span><br><span class="line">    [self willChangeValueForKey:@&quot;name&quot;];</span><br><span class="line">    [super setName:name];</span><br><span class="line">    [self didChangeValueForKey:@&quot;name&quot;];   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åº•å±‚åŸç† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> KVO </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iOSåº•å±‚-å±æ€§å…³é”®è¯</title>
      <link href="/2020/01/16/iOS%E5%BA%95%E5%B1%82-%E5%B1%9E%E6%80%A7%E5%85%B3%E9%94%AE%E8%AF%8D/"/>
      <url>/2020/01/16/iOS%E5%BA%95%E5%B1%82-%E5%B1%9E%E6%80%A7%E5%85%B3%E9%94%AE%E8%AF%8D/</url>
      
        <content type="html"><![CDATA[<h3 id="property"><a href="#property" class="headerlink" title="@property"></a>@property</h3><p>é»˜è®¤æ ¼å¼ï¼š<code>@syntheszie var = _var;</code></p><p><code>ARC</code>ä¸­ï¼Œé»˜è®¤ä¿®é¥°<br></p><ul><li>åŸºæœ¬æ•°æ®ç±»å‹<code>@property (atomic, assign)</code><br></li><li>å¯¹è±¡æ•°æ®ç±»å‹<code>@property (atomic, strong)</code></li></ul><h3 id="ä¿®é¥°è¯è§£é‡Š"><a href="#ä¿®é¥°è¯è§£é‡Š" class="headerlink" title="ä¿®é¥°è¯è§£é‡Š"></a>ä¿®é¥°è¯è§£é‡Š</h3><ul><li><p><code>nonatomic</code> éåŸå­æ€§è®¿é—®ï¼Œä¸å¯¹setæ–¹æ³•åŠ é”ï¼Œä¸æ˜¯å®‰å…¨çº¿ç¨‹ï¼Œä½†æ˜¯æ€§èƒ½é«˜ã€‚</p></li><li><p><code>atomic</code> åŸå­æ€§è®¿é—®ï¼Œå¯¹ç”Ÿæˆçš„ set æ–¹æ³•åŠ äº’æ–¥é” @synchronized(é”å¯¹è±¡ï¼‰ï¼Œå®‰å…¨çº¿ç¨‹ï¼ˆä¸æ˜¯ç»å¯¹å®‰å…¨çº¿ç¨‹ï¼‰,æ€§èƒ½å·®ã€‚</p></li><li><p><code>strong</code>ARCä¸­ä½¿ç”¨ï¼Œä¿®é¥°OCå¯¹è±¡ï¼Œ<code>æ‹¥æœ‰å…³ç³»</code>ï¼Œå¼•ç”¨è®¡æ•°å™¨+1ã€‚</p></li><li><p><code>reatain</code>MRCä¸­ä½¿ç”¨ï¼Œä¿®é¥°OCå¯¹è±¡ï¼Œ<code>æ‹¥æœ‰å…³ç³»</code>ï¼Œå¼•ç”¨è®¡æ•°å™¨+1ã€‚</p></li><li><p><code>assign</code>ä¿®é¥°åŸºç¡€æ•°æ®ç±»å‹ï¼Œç›´æ¥èµ‹å€¼ï¼Œ<code>éæ‹¥æœ‰å…³ç³»</code>ï¼Œä¸ä½¿ç”¨å¼•ç”¨è®¡æ•°å™¨ã€‚</p></li><li><p><code>weak</code>ä¿®é¥°åè®®ï¼Œæ§ä»¶ï¼Œ<code>éæ‹¥æœ‰å…³ç³»</code>ï¼ŒæŒ‡å‘çš„å¯¹è±¡é”€æ¯ï¼ŒæŒ‡é’ˆä¼šè‡ªåŠ¨ç½®ä¸ºnilï¼Œä¸ä½¿ç”¨å¼•ç”¨è®¡æ•°å™¨ã€‚</p></li><li><p><code>unsafe_unretained</code>ä¸weakç±»ä¼¼ï¼Œä¸ä¼šè‡ªåŠ¨nilåŒ–ï¼Œå¦‚æœæ‰€æŒ‡å‘çš„å†…å­˜åŒºåŸŸè¢«é‡Šæ”¾äº†ï¼Œè¿™ä¸ªæŒ‡é’ˆå°±æ˜¯ä¸€ä¸ªé‡æŒ‡é’ˆã€‚</p></li><li><p><code>copy</code>åœ¨ MRC æ—¶æ˜¯è¿™æ ·åšçš„ release æ—§å¯¹è±¡( æ—§å¯¹è±¡çš„å¼•ç”¨è®¡æ•°å™¨ -1 ) , copy æ–°å¯¹è±¡( æ–°å¯¹è±¡çš„å¼•ç”¨è®¡æ•°å™¨ +1 ) , ç„¶åæŒ‡å‘æ–°å¯¹è±¡ .ï¼ˆæ–°å¯¹è±¡æ˜¯æŒ‡æœ€ç»ˆæŒ‡å‘çš„é‚£ä¸ªå¯¹è±¡ï¼Œä¸ç®¡æ·±æ‹·è´è¿˜æ˜¯æµ…æ‹·è´ï¼‰ï¼Œåœ¨ ARC æ—¶æ˜¯è¿™ä¹ˆå¹²çš„ copy æ–°å¯¹è±¡( æ–°å¯¹è±¡çš„å¼•ç”¨è®¡æ•°å™¨ +1 ) , ç„¶åæŒ‡å‘æ–°å¯¹è±¡ã€‚</p></li><li><p><code>readonly</code>åªç”Ÿæˆgetæ–¹æ³•ï¼Œä¸æƒ³æŠŠæš´éœ²çš„å±æ€§è¢«äººéšä¾¿æ›¿æ¢æ—¶ , å¯ä»¥ä½¿ç”¨ã€‚</p></li><li><p><code>readwrite</code>ç”Ÿæˆget/setæ–¹æ³•ã€‚</p></li></ul><h3 id="dynamic"><a href="#dynamic" class="headerlink" title="@dynamic"></a>@dynamic</h3><p>å‘Šè¯‰ç¼–è¯‘å™¨:å±æ€§çš„ setter ä¸ getter æ–¹æ³•ç”±ç”¨æˆ·è‡ªå·±å®ç°,ä¸è‡ªåŠ¨ç”Ÿæˆã€‚(å½“ç„¶å¯¹äº readonly çš„å±æ€§åªéœ€æä¾› getter å³å¯)</p><h3 id="synthesize"><a href="#synthesize" class="headerlink" title="@synthesize"></a>@synthesize</h3><p>å¦‚æœä½ æ²¡æœ‰æ‰‹åŠ¨å®ç° setter æ–¹æ³•å’Œ getter æ–¹æ³•,é‚£ä¹ˆç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ä¸ºä½ åŠ ä¸Šè¿™ä¸¤ä¸ªæ–¹æ³•ã€‚</p><h3 id="synchronized"><a href="#synchronized" class="headerlink" title="@synchronized"></a>@synchronized</h3><p>çº¿ç¨‹åŒæ­¥é”</p><h3 id="é—®é¢˜ï¼š"><a href="#é—®é¢˜ï¼š" class="headerlink" title="é—®é¢˜ï¼š"></a>é—®é¢˜ï¼š</h3><p>ï¼ˆ1ï¼‰ä»€ä¹ˆæƒ…å†µä½¿ç”¨ weak å…³é”®å­—ï¼Ÿç›¸æ¯” assign æœ‰ä»€ä¹ˆä¸åŒ?</p><ul><li>ä½¿ç”¨<blockquote><ol><li>åè®®å£°æ˜ä½¿ç”¨weak</li><li>IBOutlet ä½¿ç”¨weak</li></ol></blockquote></li><li>weak å’Œ assign çš„ä¸åŒç‚¹:<blockquote><p>weak ç­–ç•¥åœ¨å±æ€§æ‰€æŒ‡çš„å¯¹è±¡é­åˆ°æ‘§æ¯æ—¶,ç³»ç»Ÿä¼šå°† weak ä¿®é¥°çš„å±æ€§å¯¹è±¡çš„æŒ‡é’ˆæŒ‡å‘ nil,åœ¨ OC ç»™ nil å‘æ¶ˆæ¯æ˜¯ä¸ä¼šæœ‰ä»€ä¹ˆé—®é¢˜çš„;å¦‚æœä½¿ç”¨ assign ç­–ç•¥åœ¨å±æ€§æ‰€æŒ‡çš„å¯¹è±¡é­åˆ°æ‘§æ¯æ—¶,å±æ€§å¯¹è±¡æŒ‡é’ˆè¿˜æŒ‡å‘åŸæ¥çš„å¯¹è±¡,ç”±äºå¯¹è±¡å·²ç»è¢«é”€æ¯,è¿™æ—¶å€™å°±äº§ç”Ÿäº†é‡æŒ‡é’ˆ,å¦‚æœè¿™æ—¶å€™åœ¨ç»™æ­¤å¯¹è±¡å‘é€æ¶ˆæ¯,å¾ˆå®¹é€ æˆç¨‹åºå¥”æºƒassigin å¯ä»¥ç”¨äºä¿®é¥°é OC å¯¹è±¡,è€Œ weak å¿…é¡»ç”¨äº OC å¯¹è±¡ã€‚</p></blockquote></li></ul><p>ï¼ˆ2ï¼‰ä½¿ç”¨ atomic ä¸€å®šæ˜¯çº¿ç¨‹å®‰å…¨çš„å—?</p><ul><li>ä¸æ˜¯,atomic çš„æœ¬æ„æ˜¯æŒ‡å±æ€§çš„å­˜å–æ–¹æ³•æ˜¯çº¿ç¨‹å®‰å…¨çš„,å¹¶ä¸ä¿è¯æ•´ä¸ªå¯¹è±¡æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚<blockquote><p>ä¾‹å¦‚ï¼š å£°æ˜ä¸€ä¸ª NSMutableArray çš„åŸå­å±æ€§ stuff,æ­¤æ—¶ self.stuff å’Œ self.stuff =othersulf éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä½†æ˜¯,ä½¿ç”¨[self.stuff objectAtIndex:index]å°±ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„,éœ€è¦ç”¨äº’æ–¥é”æ¥ä¿è¯çº¿ç¨‹å®‰å…¨æ€§ã€‚</p></blockquote></li></ul><p>ï¼ˆ3ï¼‰@synthesize å’Œ @dynamic åˆ†åˆ«æœ‰ä»€ä¹ˆä½œç”¨</p><ul><li><p>@property æœ‰ä¸¤ä¸ªå¯¹åº”çš„è¯,ä¸€ä¸ªæ˜¯@synthesize,ä¸€ä¸ªæ˜¯@dynamicã€‚<br>å¦‚æœ@synthesize å’Œ@dynamic éƒ½æ²¡å†™,é‚£ä¹ˆé»˜è®¤çš„å°±æ˜¯<br>@syntheszie var = _var;</p></li><li><p>@synthesize çš„è¯­ä¹‰æ˜¯å¦‚æœä½ æ²¡æœ‰æ‰‹åŠ¨å®ç° setter æ–¹æ³•å’Œ getter æ–¹æ³•,é‚£ä¹ˆç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ä¸ºä½ åŠ ä¸Šè¿™ä¸¤ä¸ªæ–¹æ³•ã€‚</p></li><li><p>@dynamic å‘Šè¯‰ç¼–è¯‘å™¨:å±æ€§çš„ setter ä¸ getter æ–¹æ³•ç”±ç”¨æˆ·è‡ªå·±å®ç°,ä¸è‡ªåŠ¨ç”Ÿæˆã€‚(å½“ç„¶å¯¹äº readonly çš„å±æ€§åªéœ€æä¾› getter å³å¯)</p></li><li><p>å‡å¦‚ä¸€ä¸ªå±æ€§è¢«å£°æ˜ä¸º@dynamic varï¼›ç„¶åä½ æ²¡æœ‰æä¾›@setter æ–¹æ³•å’Œ@getter æ–¹æ³•,ç¼–è¯‘çš„æ—¶å€™æ²¡é—®é¢˜,ä½†æ˜¯å½“ç¨‹åºè¿è¡Œåˆ° instance.var = someVar,ç”±äºç¼º setteræ–¹æ³•ä¼šå¯¼è‡´ç¨‹åºå´©æºƒ;<br>æˆ–è€…å½“è¿è¡Œåˆ° someVar = instance.var æ—¶,ç”±äºç¼º getter æ–¹æ³•åŒæ ·ä¼šå¯¼è‡´å´©æºƒã€‚</p></li></ul><p>ï¼ˆ4ï¼‰ARC ä¸‹,ä¸æ˜¾å¼æŒ‡å®šä»»ä½•å±æ€§å…³é”®å­—æ—¶,é»˜è®¤çš„å…³é”®å­—éƒ½æœ‰å“ªäº›?</p><ul><li><p>åŸºæœ¬æ•°æ®ï¼š  <code>atomic,readwrite,assign</code></p></li><li><p>æ™®é€šçš„ OC å¯¹è±¡: <code>atomic,readwrite,strong</code></p></li></ul><p>ï¼ˆ5ï¼‰ç”¨@property å£°æ˜çš„ NSString(æˆ– NSArray,NSDictionary)ç»å¸¸ä½¿ç”¨ copy å…³é”®å­—,ä¸ºä»€ä¹ˆ?å¦‚æœæ”¹ç”¨ strong å…³é”®å­—,å¯èƒ½é€ æˆä»€ä¹ˆé—®é¢˜?</p><blockquote><p>å› ä¸ºçˆ¶ç±»æŒ‡é’ˆå¯ä»¥æŒ‡å‘å­ç±»å¯¹è±¡,ä½¿ç”¨ copy çš„ç›®çš„æ˜¯ä¸ºäº†è®©æœ¬å¯¹è±¡çš„å±æ€§ä¸å—å¤–ç•Œå½±å“,ä½¿ç”¨ copy æ— è®ºç»™æˆ‘ä¼ å…¥æ˜¯ä¸€ä¸ªå¯å˜å¯¹è±¡è¿˜æ˜¯ä¸å¯å¯¹è±¡,æˆ‘æœ¬èº«æŒæœ‰çš„å°±æ˜¯ä¸€ä¸ªä¸å¯å˜çš„å‰¯æœ¬.</p><p>å¦‚æœæˆ‘ä»¬ä½¿ç”¨æ˜¯ strong,é‚£ä¹ˆè¿™ä¸ªå±æ€§å°±æœ‰å¯èƒ½æŒ‡å‘ä¸€ä¸ªå¯å˜å¯¹è±¡,å¦‚æœè¿™ä¸ªå¯å˜å¯¹è±¡åœ¨å¤–éƒ¨è¢«ä¿®æ”¹äº†,é‚£ä¹ˆä¼šå½±å“è¯¥å±æ€§.</p></blockquote><p>ï¼ˆ6ï¼‰è¿™ä¸ªå†™æ³•ä¼šå‡ºä»€ä¹ˆé—®é¢˜: @property(copy)NSMutableArray *array;</p><blockquote><p>å› ä¸º copy ç­–ç•¥æ‹·è´å‡ºæ¥çš„æ˜¯ä¸€ä¸ªä¸å¯å˜å¯¹è±¡,ç„¶è€Œå´æŠŠå®ƒå½“æˆå¯å˜å¯¹è±¡ä½¿ç”¨,å¾ˆå®¹æ˜“é€ æˆç¨‹åºå¥”æºƒè¿™é‡Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜,è¯¥å±æ€§ä½¿ç”¨äº†åŒæ­¥é”,ä¼šåœ¨åˆ›å»ºæ—¶ç”Ÿæˆä¸€äº›é¢å¤–çš„ä»£ç ç”¨äºå¸®åŠ©ç¼–å†™å¤šçº¿ç¨‹ç¨‹åº,è¿™ä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜,é€šè¿‡å£°æ˜ nonatomic å¯ä»¥èŠ‚çœè¿™äº›è™½ç„¶<br>å¾ˆå°ä½†æ˜¯ä¸å¿…è¦é¢å¤–å¼€é”€,åœ¨ iOS å¼€å‘ä¸­åº”è¯¥ä½¿ç”¨ nonatomic æ›¿ä»£ atomic.</p></blockquote><p>ï¼ˆ7ï¼‰å¦‚ä½•è®©è‡ªå®šä¹‰ç±»å¯ä»¥ç”¨ copy ä¿®é¥°ç¬¦?å¦‚ä½•é‡å†™å¸¦ copy å…³é”®å­—çš„ setter?</p><blockquote><p>è‹¥æƒ³ä»¤è‡ªå·±æ‰€å†™çš„å¯¹è±¡å…·æœ‰æ‹·è´åŠŸèƒ½,åˆ™éœ€å®ç° NSCopying åè®®ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; å®ç°ä¸å¯å˜ç‰ˆæœ¬æ‹·è´</span><br><span class="line">- (id)copyWithZone:(NSZone *)zone; &#x2F;&#x2F; å®ç°å¯å˜ç‰ˆæœ¬æ‹·è´</span><br><span class="line">- (id)mutableCopyWithZone:(NSZone *)zone;</span><br><span class="line">&#x2F;&#x2F; é‡å†™å¸¦ copy å…³é”®å­—çš„ setter</span><br><span class="line">- (void)setName:(NSString *)name &#123;</span><br><span class="line">    _name &#x3D; [name copy];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ·±æ‹·è´å’Œæµ…æ‹·è´"><a href="#æ·±æ‹·è´å’Œæµ…æ‹·è´" class="headerlink" title="æ·±æ‹·è´å’Œæµ…æ‹·è´"></a>æ·±æ‹·è´å’Œæµ…æ‹·è´</h3><h4 id="copy-å’Œ-mutableCopy"><a href="#copy-å’Œ-mutableCopy" class="headerlink" title="copy å’Œ mutableCopy"></a>copy å’Œ mutableCopy</h4><ul><li><p><code>copy</code>æ‹·è´å‡ºæ¥çš„å¯¹è±¡ç±»å‹æ€»æ˜¯ä¸å¯å˜ç±»å‹(ä¾‹å¦‚, NSString, NSDictionary, NSArrayç­‰ç­‰)</p></li><li><p><code>mutableCopy</code>æ‹·è´å‡ºæ¥çš„å¯¹è±¡ç±»å‹æ€»æ˜¯å¯å˜ç±»å‹(ä¾‹å¦‚, NSMutableString, NSMutableDictionary, NSMutableArrayç­‰ç­‰)</p></li></ul><hr><ul><li><code>copy</code> å¯¹äºå¯å˜å¯¹è±¡ä¸ºæ·±æ‹·è´ï¼Œå¯¹äºä¸å¯å˜å¯¹è±¡ä¸ºæµ…æ‹·è´</li><li><code>mutableCopy</code> å§‹ç»ˆæ˜¯æ·±æ‹·è´</li></ul>]]></content>
      
      
      <categories>
          
          <category> Objective-C </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åº•å±‚åŸç† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iOSè‡ªå®šä¹‰æ§ä»¶-èº«ä»½è¯é”®ç›˜</title>
      <link href="/2020/01/16/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-%E8%BA%AB%E4%BB%BD%E8%AF%81%E9%94%AE%E7%9B%98/"/>
      <url>/2020/01/16/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-%E8%BA%AB%E4%BB%BD%E8%AF%81%E9%94%AE%E7%9B%98/</url>
      
        <content type="html"><![CDATA[<p>åˆ©ç”¨<code>UIInputViewController</code>è‡ªå®šä¹‰é”®ç›˜ï¼Œåˆæ¬¡å°è¯•ã€‚</p><h3 id="å®ç°ä»£ç "><a href="#å®ç°ä»£ç " class="headerlink" title="å®ç°ä»£ç "></a>å®ç°ä»£ç </h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line">fileprivate class WDCustomKeybordButton: UIButton &#123;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; æŒ‰é’®ç‚¹å‡»å›è°ƒ</span><br><span class="line">    var didInputBlock: ((_ text: String) -&gt; Void)?</span><br><span class="line">    </span><br><span class="line">    override var isHighlighted: Bool &#123;</span><br><span class="line">        didSet &#123;</span><br><span class="line">            &#x2F;&#x2F; ç›‘å¬æ˜¯å¦æ˜¯é«˜äº®çŠ¶æ€ï¼Œå¹¶è®¾ç½®èƒŒæ™¯é¢œè‰²</span><br><span class="line">            backgroundColor &#x3D; isHighlighted ? UIColor(red:0.66, green:0.69, blue:0.73, alpha:1.00) : .white</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    override init(frame: CGRect) &#123;</span><br><span class="line">        super.init(frame: frame)</span><br><span class="line">        backgroundColor &#x3D; .white</span><br><span class="line">        layer.cornerRadius &#x3D; 5</span><br><span class="line">        setTitleColor(.black, for: .normal)</span><br><span class="line">        addTarget(self, action: #selector(buttonTargetAction(sender:)), for: .touchUpInside)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @objc func buttonTargetAction(sender: UIButton) &#123;</span><br><span class="line">        let text &#x3D; (sender.titleLabel?.text) ?? &quot;&quot;</span><br><span class="line">        if didInputBlock !&#x3D; nil &#123;</span><br><span class="line">            didInputBlock!(text)</span><br><span class="line">        &#125;</span><br><span class="line">        &#x2F;&#x2F; æ·»åŠ éœ‡åŠ¨åé¦ˆ</span><br><span class="line">        UIImpactFeedbackGenerator().impactOccurred()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    required init?(coder: NSCoder) &#123;</span><br><span class="line">        fatalError(&quot;init(coder:) has not been implemented&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@objc protocol WDCustomKeybordDelegate: NSObjectProtocol &#123;</span><br><span class="line">    func keybord(keybord: WDCustomKeybord, isDelete: Bool, text: String) -&gt; Void</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class WDCustomKeybord: UIInputViewController &#123;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F;&#x2F; é”®ç›˜ç‚¹å‡»Blockå›è°ƒï¼ŒisDeleteï¼š æ˜¯å¦æ˜¯åˆ é™¤æŒ‰é’®</span><br><span class="line">    public var didInputBlock: ((_ isDelete: Bool, _ text: String) -&gt; Void)?</span><br><span class="line">    &#x2F;&#x2F;&#x2F; ä»£ç†å›è°ƒ</span><br><span class="line">    public weak var delegate: WDCustomKeybordDelegate?</span><br><span class="line">    &#x2F;&#x2F;&#x2F; æŒ‰é’®çš„å®½åº¦</span><br><span class="line">    private let buttonWidth: CGFloat &#x3D; (UIScreen.main.bounds.width - 4.0 * 5.0) &#x2F; 3.0</span><br><span class="line">    &#x2F;&#x2F;&#x2F; æŒ‰é’®é«˜åº¦</span><br><span class="line">    private let buttonHeight: CGFloat &#x3D; 40.0</span><br><span class="line">    &#x2F;&#x2F;&#x2F; é—´éš™</span><br><span class="line">    private let margin: CGFloat &#x3D; 5.0</span><br><span class="line">    &#x2F;&#x2F;&#x2F; æŒ‰é’®æ•°ç»„</span><br><span class="line">    private let numArray &#x3D; [&quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, &quot;6&quot;, &quot;7&quot;, &quot;8&quot;, &quot;9&quot;, &quot;X&quot;, &quot;0&quot;, &quot;&quot;]</span><br><span class="line">    &#x2F;&#x2F;&#x2F; åˆ˜æµ·å±é€‚é…</span><br><span class="line">    private var isiPhoneX: Bool &#123;</span><br><span class="line">        var iPhoneX &#x3D; false</span><br><span class="line">        if UIDevice.current.userInterfaceIdiom !&#x3D; .phone &#123;</span><br><span class="line">            return iPhoneX</span><br><span class="line">        &#125;</span><br><span class="line">        if #available(iOS 11.0, *) &#123;</span><br><span class="line">            let mainWindow &#x3D; UIApplication.shared.keyWindow</span><br><span class="line">            if (mainWindow?.safeAreaInsets.bottom)! &gt; CGFloat(0.0) &#123;</span><br><span class="line">                iPhoneX &#x3D; true</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return iPhoneX</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    override func viewDidLoad() &#123;</span><br><span class="line">        let height &#x3D; buttonHeight * 4.0 + margin * 5.0</span><br><span class="line">        if isiPhoneX &#123;</span><br><span class="line">            view.frame &#x3D; CGRect(x: 0, y: 0, width: UIScreen.main.bounds.width, height: height + 34)</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            view.frame &#x3D; CGRect(x: 0, y: 0, width: UIScreen.main.bounds.width, height: height)</span><br><span class="line">        &#125;</span><br><span class="line">        setupSubviews()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F;&#x2F; forå¾ªç¯æ·»åŠ æŒ‰é’®</span><br><span class="line">    private  func setupSubviews() &#123;</span><br><span class="line">        for (i, text) in numArray.enumerated() &#123;</span><br><span class="line">            let button &#x3D; WDCustomKeybordButton()</span><br><span class="line">            button.setTitle(text, for: .normal)</span><br><span class="line">            button.tag &#x3D; 1000 + I</span><br><span class="line">            if i &lt; 3 &#123;</span><br><span class="line">                button.frame &#x3D; CGRect(x: margin + (margin + buttonWidth) * CGFloat(i), y: margin, width: buttonWidth, height: buttonHeight)</span><br><span class="line">            &#125; else if i &lt; 6 &#123;</span><br><span class="line">                button.frame &#x3D; CGRect(x: margin + (margin + buttonWidth) * CGFloat(i - 3), y: margin * 2 + buttonHeight, width: buttonWidth, height: buttonHeight)</span><br><span class="line">            &#125; else if i &lt; 9 &#123;</span><br><span class="line">                button.frame &#x3D; CGRect(x: margin + (margin + buttonWidth) * CGFloat(i - 6), y: margin * 3 + buttonHeight * 2, width: buttonWidth, height: buttonHeight)</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                button.frame &#x3D; CGRect(x: margin + (margin + buttonWidth) * CGFloat(i - 9), y: margin * 4 + buttonHeight * 3, width: buttonWidth, height: buttonHeight)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            if i &#x3D;&#x3D; 11 &#123;</span><br><span class="line">                button.imageView?.contentMode &#x3D; .scaleAspectFit</span><br><span class="line">                &#x2F;&#x2F; åˆ é™¤æŒ‰é’®&lt;è‡ªå®šä¹‰å›¾ç‰‡&gt;</span><br><span class="line">                button.setImage(UIImage(named: &quot;delete&quot;), for: .normal)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            button.didInputBlock &#x3D; &#123;</span><br><span class="line">                if self.didInputBlock !&#x3D; nil &#123;</span><br><span class="line">                    if $0.count &#x3D;&#x3D; 0 &#123;</span><br><span class="line">                        self.didInputBlock!(true, $0)</span><br><span class="line">                    &#125; else &#123;</span><br><span class="line">                        self.didInputBlock!(false, $0)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                if (self.delegate?.responds(to: #selector(WDCustomKeybordDelegate.keybord(keybord:isDelete:text:))))! &#123;</span><br><span class="line">                    if $0.count &#x3D;&#x3D; 0 &#123;</span><br><span class="line">                        self.delegate?.keybord(keybord: self, isDelete:true , text: $0)</span><br><span class="line">                    &#125; else &#123;</span><br><span class="line">                        self.delegate?.keybord(keybord: self, isDelete:false , text: $0)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            view.addSubview(button)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨æ–¹æ³•ï¼ˆä¸€ï¼‰"><a href="#ä½¿ç”¨æ–¹æ³•ï¼ˆä¸€ï¼‰" class="headerlink" title="ä½¿ç”¨æ–¹æ³•ï¼ˆä¸€ï¼‰"></a>ä½¿ç”¨æ–¹æ³•ï¼ˆä¸€ï¼‰</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">let inputController &#x3D; WDCustomKeybord()</span><br><span class="line">inputController.didInputBlock &#x3D; &#123;</span><br><span class="line">    if $0 &#123; &#x2F;&#x2F; åˆ é™¤</span><br><span class="line">       var varText &#x3D; &quot;&quot;</span><br><span class="line">       if let tText &#x3D; self.textField.text &#123;</span><br><span class="line">            for (i, text) in tText.enumerated() &#123;</span><br><span class="line">                if i &lt; tText.count - 1 &#123;</span><br><span class="line">                    varText.append(text)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            self.textField.text &#x3D; varText</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; else &#123;&#x2F;&#x2F; è¾“å…¥</span><br><span class="line">        self.textField.text?.append($1)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">textField.inputView &#x3D; inputController.inputView</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨æ–¹æ³•ï¼ˆäºŒï¼‰"><a href="#ä½¿ç”¨æ–¹æ³•ï¼ˆäºŒï¼‰" class="headerlink" title="ä½¿ç”¨æ–¹æ³•ï¼ˆäºŒï¼‰"></a>ä½¿ç”¨æ–¹æ³•ï¼ˆäºŒï¼‰</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">        let inputController &#x3D; WDCustomKeybord()</span><br><span class="line">        inputController.delegate &#x3D; self</span><br><span class="line">        textField.inputView &#x3D; inputController.inputView</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; MARK: WDCustomKeybord Delegate Method</span><br><span class="line">extension ViewController: WDCustomKeybordDelegate &#123;</span><br><span class="line">    func keybord(keybord: WDCustomKeybord, isDelete: Bool, text: String) &#123;</span><br><span class="line">        if isDelete &#123; &#x2F;&#x2F; åˆ é™¤</span><br><span class="line">            var varText &#x3D; &quot;&quot;</span><br><span class="line">            if let tText &#x3D; textField.text &#123;</span><br><span class="line">                for (i, text) in tText.enumerated() &#123;</span><br><span class="line">                    if i &lt; tText.count - 1 &#123;</span><br><span class="line">                        varText.append(text)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                textField.text &#x3D; varText</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123; &#x2F;&#x2F; è¾“å…¥</span><br><span class="line">            textField.text?.append(text)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ•ˆæœå›¾"><a href="#æ•ˆæœå›¾" class="headerlink" title="æ•ˆæœå›¾"></a>æ•ˆæœå›¾</h3><p><img src="https://s2.ax1x.com/2020/01/20/1PajXQ.gif" alt="æ•ˆæœå›¾.gif"></p>]]></content>
      
      
      <categories>
          
          <category> Swift </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è‡ªå®šä¹‰æ§ä»¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iOSè‡ªå®šä¹‰æ§ä»¶-æœç´¢å†å²æ ‡ç­¾</title>
      <link href="/2020/01/16/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-%E6%90%9C%E7%B4%A2%E5%8E%86%E5%8F%B2%E6%A0%87%E7%AD%BE/"/>
      <url>/2020/01/16/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-%E6%90%9C%E7%B4%A2%E5%8E%86%E5%8F%B2%E6%A0%87%E7%AD%BE/</url>
      
        <content type="html"><![CDATA[<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line">import UIKit</span><br><span class="line"></span><br><span class="line">@objc protocol WDTagsViewDelegate: NSObjectProtocol &#123;</span><br><span class="line">    &#x2F;&#x2F;&#x2F; å•ä¸ªæ ‡ç­¾ç‚¹å‡»å›è°ƒ</span><br><span class="line">    func tagsView(view: WDTagsView, didTappedAtIndex index: Int, didTappedAtText text: String) -&gt; Void</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class WDTagsView: UIView &#123;</span><br><span class="line">    &#x2F;&#x2F; MARK: Public</span><br><span class="line">    public weak var delegate: WDTagsViewDelegate?</span><br><span class="line">    public var tagHeight: CGFloat          &#x3D; 32 &#x2F;&#x2F; æ ‡ç­¾é«˜åº¦ï¼Œé»˜è®¤ä¸º32</span><br><span class="line">    public var viewHMargin: CGFloat        &#x3D; 10 &#x2F;&#x2F; æ•´ä½“å·¦å³é—´è· é»˜è®¤ä¸º10</span><br><span class="line">    public var viewVMargin: CGFloat        &#x3D; 10 &#x2F;&#x2F; æ•´ä½“ä¸Šä¸‹é—´è· é»˜è®¤ä¸º10</span><br><span class="line">    public var tagInnerSpace: CGFloat      &#x3D; 10 &#x2F;&#x2F; æ ‡ç­¾å†…éƒ¨å·¦å³é—´è· é»˜è®¤ä¸º10</span><br><span class="line">    public var tagHMargin: CGFloat         &#x3D; 10 &#x2F;&#x2F; æ ‡ç­¾ä¹‹é—´çš„æ°´å¹³é—´è· é»˜è®¤ä¸º10</span><br><span class="line">    public var tagVMargin: CGFloat         &#x3D; 5  &#x2F;&#x2F; æ ‡ç­¾ä¹‹é—´çš„è¡Œé—´è· é»˜è®¤ä¸º5</span><br><span class="line">    public var tagFont: UIFont             &#x3D; .systemFont(ofSize: 14) &#x2F;&#x2F; æ ‡ç­¾å­—ä½“ é»˜è®¤ä¸º5</span><br><span class="line">    public var tagTextColor: UIColor       &#x3D; .black &#x2F;&#x2F; æ ‡ç­¾å­—ä½“é¢œè‰²</span><br><span class="line">    public var tagBackgroundColor: UIColor &#x3D; UIColor(red: 0.95, green: 0.95, blue: 0.95, alpha: 1) &#x2F;&#x2F; æ ‡ç­¾èƒŒæ™¯é¢œè‰²</span><br><span class="line">    public var itemArray: Array&lt;String&gt; &#x3D; Array() &#123;</span><br><span class="line">        didSet &#123;</span><br><span class="line">            setupViews()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; MARK: Private</span><br><span class="line">    private var tagsArray: Array&lt;UIButton&gt;  &#x3D; Array()</span><br><span class="line"></span><br><span class="line">    override init(frame: CGRect) &#123;</span><br><span class="line">        super.init(frame: frame)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    func refreshView() &#123;</span><br><span class="line">        DispatchQueue.main.async &#123;</span><br><span class="line">             self.setupViews()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    private func setupViews() &#123;</span><br><span class="line">        for v in self.subviews &#123;</span><br><span class="line">            v.removeFromSuperview()</span><br><span class="line">        &#125;</span><br><span class="line">        tagsArray.removeAll()</span><br><span class="line">        for (index, item) in itemArray.enumerated() &#123;</span><br><span class="line">            let b &#x3D; UIButton()</span><br><span class="line">            b.setTitle(item, for: .normal)</span><br><span class="line">            b.setTitleColor(tagTextColor, for: .normal)</span><br><span class="line">            b.titleLabel?.font &#x3D; tagFont</span><br><span class="line">            b.backgroundColor &#x3D; tagBackgroundColor</span><br><span class="line">            b.layer.cornerRadius &#x3D; 10</span><br><span class="line">            b.tag &#x3D; index</span><br><span class="line">            b.addTarget(self, action: #selector(buttonTargetAction(sender:)), for: .touchUpInside)</span><br><span class="line">            addSubview(b)</span><br><span class="line">            tagsArray.append(b)</span><br><span class="line">        &#125;</span><br><span class="line">        layoutItems()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private func layoutItems() &#123;</span><br><span class="line">        var tagLineWidth   &#x3D; viewHMargin                &#x2F;&#x2F; å•è¡Œçš„æ€»å®½åº¦</span><br><span class="line">        let allWidth       &#x3D; UIScreen.main.bounds.width &#x2F;&#x2F; é»˜è®¤ä¸ºå±å¹•å®½åº¦</span><br><span class="line">        var isChange: Bool &#x3D; false                      &#x2F;&#x2F; æ˜¯å¦éœ€è¦æ¢è¡Œ</span><br><span class="line"></span><br><span class="line">        var lastItem: UIButton!</span><br><span class="line">        for index in 0..&lt;tagsArray.count &#123;</span><br><span class="line">            let button &#x3D; tagsArray[index]</span><br><span class="line">            let tagTitle: NSString &#x3D; itemArray[index] as NSString</span><br><span class="line">            var tagWidth &#x3D; tagTitle.boundingRect(with: CGSize(width: CGFloat(MAXFLOAT), height: tagHeight),</span><br><span class="line">                                                 options: .usesLineFragmentOrigin,</span><br><span class="line">                                                 attributes: [.font : tagFont],</span><br><span class="line">                                                 context: nil).size.width + 2 * tagInnerSpace + 0.5</span><br><span class="line">            tagLineWidth +&#x3D; (tagWidth + tagHMargin)</span><br><span class="line">            if tagLineWidth &gt; (allWidth - viewHMargin) &#123;</span><br><span class="line">                isChange &#x3D; true</span><br><span class="line">                if (tagWidth + 2 * tagHMargin) &gt; allWidth &#123;</span><br><span class="line">                    tagWidth &#x3D; allWidth - 2 * tagHMargin</span><br><span class="line">                    button.titleEdgeInsets &#x3D; UIEdgeInsets(top: 0, left: tagInnerSpace &#x2F; 2, bottom: 0, right: tagInnerSpace &#x2F; 2)</span><br><span class="line">                &#125;</span><br><span class="line">                tagLineWidth &#x3D; viewHMargin + tagWidth + tagHMargin</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            button.snp.makeConstraints &#123; (make) in</span><br><span class="line">                make.height.equalTo(tagHeight)</span><br><span class="line">                make.width.equalTo(tagWidth)</span><br><span class="line">                if lastItem &#x3D;&#x3D; nil &#123;</span><br><span class="line">                    make.top.equalTo(viewVMargin)</span><br><span class="line">                    make.leading.equalTo(viewHMargin)</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    if isChange &#123;</span><br><span class="line">                        make.leading.equalTo(viewVMargin)</span><br><span class="line">                        make.top.equalTo(lastItem.snp.bottom).offset(tagVMargin)</span><br><span class="line">                        isChange &#x3D; false</span><br><span class="line">                    &#125; else &#123;</span><br><span class="line">                        make.leading.equalTo(lastItem.snp.trailing).offset(tagHMargin)</span><br><span class="line">                        make.top.equalTo(lastItem.snp.top)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            lastItem &#x3D; button</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        lastItem.snp.makeConstraints &#123; (make) in</span><br><span class="line">            make.bottom.equalTo(-viewVMargin).priority(.high)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    required init?(coder: NSCoder) &#123;</span><br><span class="line">        fatalError(&quot;init(coder:) has not been implemented&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @objc private func buttonTargetAction(sender: UIButton) &#123;</span><br><span class="line">        delegate?.tagsView(view: self, didTappedAtIndex: sender.tag, didTappedAtText: itemArray[sender.tag])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">var tagsView: WDTagsView!</span><br><span class="line"></span><br><span class="line">&#x2F;**é¡µé¢æ·»åŠ ï¼Œç®€å•æ ·å¼é…ç½®**&#x2F;</span><br><span class="line">tagsView &#x3D; WDTagsView()</span><br><span class="line">tagsView.delegate &#x3D; self</span><br><span class="line">tagsView.tagTextColor &#x3D; .black</span><br><span class="line">tagsView.tagFont &#x3D; .systemFont(ofSize: 14)</span><br><span class="line">tagsView.backgroundColor &#x3D; UIColor(red: 0.9, green: 0.9, blue: 0.9, alpha: 1)</span><br><span class="line">tagsView.tagHeight &#x3D; 30</span><br><span class="line">tagsView.itemArray &#x3D; [&quot;æ‰‹æœº&quot;, &quot;ç”µè„‘&quot;, &quot;æ˜¾å¡&quot;, &quot;ä¸»æœº&quot;, &quot;å•¥å•¥&quot;, &quot;æˆ‘æ“¦&quot;, &quot;æˆ‘æ˜¯å“¦å‘ç”Ÿçš„æ´»åŠ¨å¼€å§‹å¯¹æ–¹æ“¦&quot;, &quot;æˆ‘å±®è‰¸èŠ”èŒ»&quot;,&quot;æ‰‹æœº&quot;, &quot;ç”µè„‘&quot;, &quot;æ˜¾å¡&quot;, &quot;ä¸»æœº&quot;, &quot;å•¥å•¥&quot;, &quot;æˆ‘æ“¦&quot;, &quot;æˆ‘å±®è‰¸èŠ”èŒ»&quot;,&quot;æ‰‹æœº&quot;, &quot;ç”µè„‘&quot;, &quot;æ˜¾å¡&quot;, &quot;ä¸»æœº&quot;, &quot;å•¥å•¥&quot;, &quot;æˆ‘æ“¦&quot;, &quot;æˆ‘å±®è‰¸èŠ”èŒ»&quot;, &quot;å•¥å•¥&quot;, &quot;æˆ‘æ“¦&quot;, &quot;æˆ‘å±®è‰¸èŠ”èŒ»&quot;]</span><br><span class="line">view.addSubview(tagsView)</span><br><span class="line"></span><br><span class="line">&#x2F;**é¡µé¢å¸ƒå±€**&#x2F;</span><br><span class="line">tagsView.snp.makeConstraints &#123; (make) in    </span><br><span class="line">    make.leading.top.trailing.equalToSuperview()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;**åˆ·æ–°å®å›¾**&#x2F;</span><br><span class="line">tagsView.itemArray &#x3D; [&quot;æ‰‹æœº&quot;, &quot;ç”µè„‘&quot;, &quot;æ˜¾å¡&quot;, &quot;ä¸»æœº&quot;]</span><br><span class="line">tagsView.refreshView()</span><br></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2020/01/20/1Pa7kt.png" alt="æ•ˆæœå›¾"></p>]]></content>
      
      
      <categories>
          
          <category> Swift </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è‡ªå®šä¹‰æ§ä»¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iOSè‡ªå®šä¹‰æ§ä»¶-ä»¿äº¬ä¸œåœ°å€é€‰æ‹©å™¨</title>
      <link href="/2020/01/16/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-%E4%BB%BF%E4%BA%AC%E4%B8%9C%E5%9C%B0%E5%9D%80%E9%80%89%E6%8B%A9%E5%99%A8/"/>
      <url>/2020/01/16/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-%E4%BB%BF%E4%BA%AC%E4%B8%9C%E5%9C%B0%E5%9D%80%E9%80%89%E6%8B%A9%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<p>å†™è¿™ä¸ªçš„ä¸»è¦æ˜¯ä¸ºäº†ç»ƒä¹ <code>Swift</code>çš„ä½¿ç”¨ã€‚</p><h3 id="Plistæ–‡ä»¶å†…å®¹"><a href="#Plistæ–‡ä»¶å†…å®¹" class="headerlink" title="Plistæ–‡ä»¶å†…å®¹"></a>Plistæ–‡ä»¶å†…å®¹</h3><p><a href="https://github.com/mumuy/data_location" target="_blank" rel="noopener">ä¸‹è½½åœ°å€</a></p><h3 id="æ–‡ä»¶è¯»å–"><a href="#æ–‡ä»¶è¯»å–" class="headerlink" title="æ–‡ä»¶è¯»å–"></a>æ–‡ä»¶è¯»å–</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">fileprivate class WDAddressPickerDataManger: NSObject &#123;</span><br><span class="line">    </span><br><span class="line">    static let manager &#x3D; WDAddressPickerDataManger()</span><br><span class="line">    &#x2F;&#x2F; è¯»å–listæ–‡ä»¶</span><br><span class="line">    func readPlistFile() -&gt; Dictionary&lt;String, Any&gt; &#123;</span><br><span class="line">        let path &#x3D; Bundle.main.path(forResource: &quot;list.plist&quot;, ofType: nil) ?? &quot;&quot;</span><br><span class="line">        let dict &#x3D; NSDictionary(contentsOfFile: path)</span><br><span class="line">        if dict !&#x3D; nil &#123;</span><br><span class="line">            return dict as! Dictionary&lt;String, Any&gt;</span><br><span class="line">        &#125;</span><br><span class="line">        return [:]</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; è¯»å–æ‰€æœ‰çœä»½</span><br><span class="line">    func getProvinceNameArray() -&gt; Array&lt;String&gt; &#123;</span><br><span class="line">        var array: [String] &#x3D; Array()</span><br><span class="line">        for item in readPlistFile().keys &#123;</span><br><span class="line">            array.append(item)</span><br><span class="line">        &#125;</span><br><span class="line">        return array</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; è¯»å–æ™®é€šçœä»½ä¸­çš„åŸå¸‚</span><br><span class="line">    func getNormalCityNameArray(with provinceName: String) -&gt; Array&lt;String&gt; &#123;</span><br><span class="line">        var array: [String] &#x3D; Array()</span><br><span class="line">        for item in readPlistFile() &#123;</span><br><span class="line">           if item.key.contains(provinceName) &#123;</span><br><span class="line">                let name &#x3D; (item.value as! Dictionary&lt;String, Any&gt;).keys</span><br><span class="line">                for cityName in name &#123;</span><br><span class="line">                    array.append(cityName)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return array</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; è¯»å–ç›´è¾–å¸‚ï¼Œç‰¹åŒºä¸­çš„åŒº</span><br><span class="line">    func getSpecailCityNameArray(with provinceName: String) -&gt; Array&lt;String&gt; &#123;</span><br><span class="line">        var array: [String] &#x3D; Array()</span><br><span class="line">        for item in readPlistFile() &#123;</span><br><span class="line">           if item.key.contains(provinceName) &#123;</span><br><span class="line">                let name &#x3D; item.value as! Array&lt;String&gt;</span><br><span class="line">                for cityName in name &#123;</span><br><span class="line">                    array.append(cityName)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return array</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; è¯»å–æ™®é€šåŸå¸‚ä¸­çš„åŒº</span><br><span class="line">    func getRegionNameArray(with provinceName: String, cityName: String) -&gt; Array&lt;String&gt; &#123;</span><br><span class="line">        var array: [String] &#x3D; Array()</span><br><span class="line">        for item in readPlistFile() &#123;</span><br><span class="line">            if item.key.contains(provinceName) &#123;</span><br><span class="line">                let provinceDic &#x3D; item.value as! Dictionary&lt;String, Array&lt;String&gt;&gt;</span><br><span class="line">                for city in provinceDic.keys &#123;</span><br><span class="line">                    if city.contains(cityName)  &#123;</span><br><span class="line">                        for last in provinceDic[city]! &#123;</span><br><span class="line">                            array.append(last)</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return array</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="HeaderView"><a href="#HeaderView" class="headerlink" title="HeaderView"></a>HeaderView</h3><p>æç¤ºæ–‡å­—ï¼Œä¸é¡µé¢æ¶ˆå¤±æŒ‰é’®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">fileprivate class WDAddressPickerHeaderView: UIView &#123;</span><br><span class="line">    </span><br><span class="line">    var textLabel: UILabel!</span><br><span class="line">    var clearButton: UIButton!</span><br><span class="line">    </span><br><span class="line">    override init(frame: CGRect) &#123;</span><br><span class="line">        super.init(frame: frame)</span><br><span class="line">        setupSubviews()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    required init?(coder: NSCoder) &#123;</span><br><span class="line">        fatalError(&quot;init(coder:) has not been implemented&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    func setupSubviews() &#123;</span><br><span class="line">        backgroundColor &#x3D; .white</span><br><span class="line">        layer.cornerRadius &#x3D; 10</span><br><span class="line">        </span><br><span class="line">        textLabel &#x3D; UILabel()</span><br><span class="line">        textLabel.text &#x3D; &quot;åœ°å€é€‰æ‹©&quot;</span><br><span class="line">        textLabel.textColor &#x3D; .black</span><br><span class="line">        textLabel.font &#x3D; .systemFont(ofSize: 20, weight: .bold)</span><br><span class="line">        addSubview(textLabel)</span><br><span class="line">        </span><br><span class="line">        &#x2F;&#x2F; è‡ªå®šä¹‰æŒ‰é’®å›¾ç‰‡</span><br><span class="line">        clearButton &#x3D; UIButton(type: .custom)</span><br><span class="line">        clearButton.setImage(UIImage(named: &quot;clear&quot;), for: .normal)</span><br><span class="line">        addSubview(clearButton)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    override func layoutSubviews() &#123;</span><br><span class="line">        super.layoutSubviews()</span><br><span class="line">        textLabel.frame &#x3D; CGRect(x: 15, y: 0, width: bounds.width &#x2F; 2.0, height: bounds.height)</span><br><span class="line">        let cycleWidth &#x3D; (bounds.height - 10.0) &#x2F; 2</span><br><span class="line">        clearButton.frame &#x3D; CGRect(x: bounds.width - 15 - cycleWidth, y: (bounds.height - 10.0 - cycleWidth) &#x2F; 2.0, width: cycleWidth, height: cycleWidth)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="TopView"><a href="#TopView" class="headerlink" title="TopView"></a>TopView</h3><p>é¡µé¢æ ‡é¢˜æ˜¾ç¤ºä¸åˆ‡æ¢</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">fileprivate class WDAddressPickerTopView: UIView &#123;</span><br><span class="line">    &#x2F;&#x2F; ç‚¹å‡»å›è°ƒ</span><br><span class="line">    var didSelectedIndexBlock: ((_ index: Int) -&gt; Void) &#x3D; &#123;(_) in&#125;</span><br><span class="line">    &#x2F;&#x2F; æ ‡é¢˜åº•éƒ¨æŒ‡ç¤ºå™¨</span><br><span class="line">    var indicatorView: UIView!</span><br><span class="line">    &#x2F;&#x2F; æ ‡é¢˜ä¹‹é—´çš„é—´è·</span><br><span class="line">    let margin: CGFloat &#x3D; 15</span><br><span class="line">    &#x2F;&#x2F; åº•éƒ¨æŒ‡ç¤ºå™¨çš„å¸ƒå±€ï¼Œç”¨æ¥è¿›è¡Œå¸ƒå±€ä¿®æ”¹ä¸åŠ¨ç”»å¤„ç†</span><br><span class="line">    var indicatorViewConstraints: [NSLayoutConstraint]!</span><br><span class="line"></span><br><span class="line">    override init(frame: CGRect) &#123;</span><br><span class="line">        super.init(frame: frame)</span><br><span class="line">        setupSubviews()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    required init?(coder: NSCoder) &#123;</span><br><span class="line">        fatalError(&quot;init(coder:) has not been implemented&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    func setupSubviews() &#123;</span><br><span class="line">        backgroundColor &#x3D; .white</span><br><span class="line">        indicatorView &#x3D; UIView()</span><br><span class="line">        indicatorView.backgroundColor &#x3D; .red</span><br><span class="line">        addSubview(indicatorView)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; forå¾ªç¯æ˜¾ç¤ºæ ‡é¢˜</span><br><span class="line">    func setup(with items: [String], selectIndex: Int) &#123;</span><br><span class="line">        var lastButton &#x3D; UIButton()</span><br><span class="line">        var newItems &#x3D; items</span><br><span class="line">        if items.isEmpty &#123;</span><br><span class="line">            newItems.append(&quot;è¯·é€‰æ‹©&quot;)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        for view in subviews &#123;</span><br><span class="line">            if view.isKind(of: UIButton.self) &#123;</span><br><span class="line">                view.removeFromSuperview()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        for (i, title) in newItems.enumerated() &#123;</span><br><span class="line">            let button &#x3D; UIButton(type: .custom)</span><br><span class="line">            button.setTitle(title, for: .normal)</span><br><span class="line">            button.titleLabel?.font &#x3D; .systemFont(ofSize: 15, weight: .bold)</span><br><span class="line">            button.setTitleColor(.black, for: .normal)</span><br><span class="line">            button.addTarget(self, action: #selector(buttonTargetAction(sender:)), for: .touchUpInside)</span><br><span class="line">            button.tag &#x3D; 1000 + I</span><br><span class="line">            addSubview(button)</span><br><span class="line">            button.translatesAutoresizingMaskIntoConstraints &#x3D; false</span><br><span class="line">            if i &#x3D;&#x3D; 0 &#123;</span><br><span class="line">                addConstraint(NSLayoutConstraint(item: button, attribute: .leading, relatedBy: .equal, toItem: self, attribute: .leading, multiplier: 1, constant: margin))</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                addConstraint(NSLayoutConstraint(item: button, attribute: .leading, relatedBy: .equal, toItem: lastButton, attribute: .trailing, multiplier: 1, constant: margin))</span><br><span class="line">            &#125;</span><br><span class="line">            addConstraints([</span><br><span class="line">                NSLayoutConstraint(item: button, attribute: .centerY, relatedBy: .equal, toItem: self, attribute: .centerY, multiplier: 1, constant: 0)</span><br><span class="line">            ])</span><br><span class="line">            lastButton &#x3D; button</span><br><span class="line">            </span><br><span class="line">            if i &#x3D;&#x3D; selectIndex &#123;</span><br><span class="line">                indicatorView.translatesAutoresizingMaskIntoConstraints &#x3D; false</span><br><span class="line">                indicatorViewConstraints &#x3D; [</span><br><span class="line">                    NSLayoutConstraint(item: indicatorView, attribute: .leading, relatedBy: .equal, toItem: button, attribute: .leading, multiplier: 1, constant: 0),</span><br><span class="line">                    NSLayoutConstraint(item: indicatorView, attribute: .trailing, relatedBy: .equal, toItem: button, attribute: .trailing, multiplier: 1, constant: 0),</span><br><span class="line">                    NSLayoutConstraint(item: indicatorView, attribute: .bottom, relatedBy: .equal, toItem: self, attribute: .bottom, multiplier: 1, constant: -3),</span><br><span class="line">                    NSLayoutConstraint(item: indicatorView, attribute: .height, relatedBy: .equal, toItem: nil, attribute: .height, multiplier: 1, constant: 5),</span><br><span class="line">                ]</span><br><span class="line">                addConstraints(indicatorViewConstraints)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    @objc func buttonTargetAction(sender: UIButton) &#123;</span><br><span class="line">        &#x2F;&#x2F; ç§»é™¤å…ˆå‰æ·»åŠ çš„å¸ƒå±€</span><br><span class="line">        removeConstraints(indicatorViewConstraints)</span><br><span class="line">        indicatorViewConstraints &#x3D; [</span><br><span class="line">            NSLayoutConstraint(item: indicatorView, attribute: .leading, relatedBy: .equal, toItem: sender, attribute: .leading, multiplier: 1, constant: 0),</span><br><span class="line">            NSLayoutConstraint(item: indicatorView, attribute: .trailing, relatedBy: .equal, toItem: sender, attribute: .trailing, multiplier: 1, constant: 0),</span><br><span class="line">            NSLayoutConstraint(item: indicatorView, attribute: .bottom, relatedBy: .equal, toItem: self, attribute: .bottom, multiplier: 1, constant: -3),</span><br><span class="line">            NSLayoutConstraint(item: indicatorView, attribute: .height, relatedBy: .equal, toItem: nil, attribute: .height, multiplier: 1, constant: 5),</span><br><span class="line">        ]</span><br><span class="line">        &#x2F;&#x2F; æ·»åŠ ç‚¹å‡»å˜åŒ–åçš„å¸ƒå±€</span><br><span class="line">        addConstraints(indicatorViewConstraints)</span><br><span class="line">        setNeedsUpdateConstraints()</span><br><span class="line">        UIView.animate(withDuration: 0.3) &#123;</span><br><span class="line">            self.layoutIfNeeded()</span><br><span class="line">        &#125;</span><br><span class="line">        didSelectedIndexBlock(sender.tag - 1000)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åˆ—è¡¨å•å…ƒæ ¼"><a href="#åˆ—è¡¨å•å…ƒæ ¼" class="headerlink" title="åˆ—è¡¨å•å…ƒæ ¼"></a>åˆ—è¡¨å•å…ƒæ ¼</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">fileprivate class WDAddressPickerTableViewCell: UITableViewCell &#123;</span><br><span class="line">    </span><br><span class="line">    var titleLabel: UILabel!</span><br><span class="line">    var checkedImageView: UIImageView!</span><br><span class="line">        </span><br><span class="line">    override init(style: UITableViewCell.CellStyle, reuseIdentifier: String?) &#123;</span><br><span class="line">        super.init(style: style, reuseIdentifier: reuseIdentifier)</span><br><span class="line">        setupSubviews()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    required init?(coder: NSCoder) &#123;</span><br><span class="line">         fatalError(&quot;init(coder:) has not been implemented&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    func setupSubviews() &#123;</span><br><span class="line">        titleLabel &#x3D; UILabel()</span><br><span class="line">        titleLabel.font &#x3D; .systemFont(ofSize: 15)</span><br><span class="line">        titleLabel.textColor &#x3D; .black</span><br><span class="line">        contentView.addSubview(titleLabel)</span><br><span class="line">        </span><br><span class="line">        &#x2F;&#x2F; è‡ªå®šä¹‰æ˜¾ç¤ºå›¾ç‰‡</span><br><span class="line">        checkedImageView &#x3D; UIImageView()</span><br><span class="line">        checkedImageView.image &#x3D; UIImage(named: &quot;duihao&quot;)</span><br><span class="line">        contentView.addSubview(checkedImageView)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    private var _cellChecked: Bool &#x3D; false</span><br><span class="line">    var cellChecked: Bool &#123;</span><br><span class="line">        set &#123;</span><br><span class="line">            _cellChecked &#x3D; newValue</span><br><span class="line">            if !newValue &#123;</span><br><span class="line">                checkedImageView.frame &#x3D; CGRect(x: 15, y: 15, width: 0, height: 0)</span><br><span class="line">                titleLabel.frame &#x3D; CGRect(x: 15, y: 0, width: UIScreen.main.bounds.width - 30, height: 45)</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                checkedImageView.frame &#x3D; CGRect(x: 15, y: 15, width: 15, height: 15)</span><br><span class="line">                titleLabel.frame &#x3D; CGRect(x: checkedImageView.frame.maxX + 15, y: 0, width: UIScreen.main.bounds.width - checkedImageView.frame.maxX - 15 - 15 , height: 45)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; get &#123;</span><br><span class="line">            return _cellChecked</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="BottomView"><a href="#BottomView" class="headerlink" title="BottomView"></a>BottomView</h3><p>åº•éƒ¨åˆ—è¡¨è§†å›¾è½½ä½“ï¼Œä½¿ç”¨<code>UIScrollView</code>åµŒå¥—<code>UITableView</code>æ¥å®ç°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br></pre></td><td class="code"><pre><span class="line">fileprivate class WDAddressPickerBottomView: UIView &#123;</span><br><span class="line">    &#x2F;&#x2F; Action</span><br><span class="line">    var didSelectedBlock: ((_ page: Int, _ index: Int, _ name: String) -&gt; Void) &#x3D; &#123;(_,_,_) in &#125;</span><br><span class="line">    &#x2F;&#x2F; UI</span><br><span class="line">    var scrollView: UIScrollView!</span><br><span class="line">    var provinceTableView: UITableView!</span><br><span class="line">    var cityTableView: UITableView!</span><br><span class="line">    var regionTableView: UITableView!</span><br><span class="line">    &#x2F;&#x2F; Data</span><br><span class="line">    var proVinceSelectedIndexRow &#x3D; -1</span><br><span class="line">    var citySelectedIndexRow &#x3D; -1</span><br><span class="line">    var regionSelectedIndexRow &#x3D; -1</span><br><span class="line">    var selectedIndexRow &#x3D; -1</span><br><span class="line">    var regionNameArray: [String] &#x3D; Array()</span><br><span class="line">    var cityNameArray: [String] &#x3D; Array()</span><br><span class="line">    var cityName: String &#x3D; &quot;&quot; &#123;</span><br><span class="line">        didSet &#123;</span><br><span class="line">            regionSelectedIndexRow &#x3D; -1</span><br><span class="line">            regionNameArray &#x3D; WDAddressPickerDataManger.manager.getRegionNameArray(with: provinceName, cityName: cityName)</span><br><span class="line">            regionTableView.reloadData()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    let provinceNameArray: [String] &#x3D; WDAddressPickerDataManger.manager.getProvinceNameArray()</span><br><span class="line">    var provinceName: String &#x3D; &quot;&quot; &#123;</span><br><span class="line">        didSet &#123;</span><br><span class="line">            if provinceName.contains(&quot;åŒ—äº¬&quot;) ||</span><br><span class="line">                provinceName.contains(&quot;ä¸Šæµ·&quot;) ||</span><br><span class="line">                provinceName.contains(&quot;å¤©æ´¥&quot;) ||</span><br><span class="line">                provinceName.contains(&quot;é¦™æ¸¯&quot;) ||</span><br><span class="line">                provinceName.contains(&quot;æ¾³é—¨&quot;) ||</span><br><span class="line">                provinceName.contains(&quot;é‡åº†&quot;) &#123;</span><br><span class="line">                cityNameArray &#x3D; WDAddressPickerDataManger.manager.getSpecailCityNameArray(with: provinceName)</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                cityNameArray &#x3D; WDAddressPickerDataManger.manager.getNormalCityNameArray(with: provinceName)</span><br><span class="line">            &#125;</span><br><span class="line">            citySelectedIndexRow &#x3D; -1</span><br><span class="line">            regionSelectedIndexRow &#x3D; -1</span><br><span class="line">            cityTableView.reloadData()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    override init(frame: CGRect) &#123;</span><br><span class="line">        super.init(frame: frame)</span><br><span class="line">        backgroundColor &#x3D; .white</span><br><span class="line">        setupSubviews()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    required init?(coder: NSCoder) &#123;</span><br><span class="line">        fatalError(&quot;init(coder:) has not been implemented&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    override func layoutSubviews() &#123;</span><br><span class="line">        super.layoutSubviews()</span><br><span class="line">        scrollView.frame &#x3D; bounds</span><br><span class="line">        provinceTableView.frame &#x3D; scrollView.bounds</span><br><span class="line">        cityTableView.frame &#x3D; CGRect(x: scrollView.bounds.width, y: 0, width: scrollView.bounds.width, height: scrollView.bounds.height)</span><br><span class="line">        regionTableView.frame &#x3D; CGRect(x: scrollView.bounds.width * 2.0, y: 0, width: scrollView.bounds.width, height: scrollView.bounds.height)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; MARK: Views Set Up</span><br><span class="line">private extension WDAddressPickerBottomView &#123;</span><br><span class="line">    func setupSubviews() &#123;</span><br><span class="line">        scrollView &#x3D; UIScrollView()</span><br><span class="line">        scrollView.isScrollEnabled &#x3D; false</span><br><span class="line">        scrollView.isPagingEnabled &#x3D; true</span><br><span class="line">        scrollView.showsHorizontalScrollIndicator &#x3D; false</span><br><span class="line">        scrollView.bounces &#x3D; false</span><br><span class="line">        addSubview(scrollView)</span><br><span class="line"></span><br><span class="line">        provinceTableView &#x3D; UITableView(frame: .zero, style: .plain)</span><br><span class="line">        provinceTableView.delegate &#x3D; self</span><br><span class="line">        provinceTableView.dataSource &#x3D; self</span><br><span class="line">        provinceTableView.rowHeight &#x3D; 45</span><br><span class="line">        provinceTableView.register(WDAddressPickerTableViewCell.self, forCellReuseIdentifier: &quot;WDAddressPickerTableViewCell&quot;)</span><br><span class="line">        scrollView.addSubview(provinceTableView)</span><br><span class="line">        </span><br><span class="line">        cityTableView &#x3D; UITableView(frame: .zero, style: .plain)</span><br><span class="line">        cityTableView.delegate &#x3D; self</span><br><span class="line">        cityTableView.dataSource &#x3D; self</span><br><span class="line">        cityTableView.rowHeight &#x3D; 45</span><br><span class="line">        cityTableView.register(WDAddressPickerTableViewCell.self, forCellReuseIdentifier: &quot;WDAddressPickerTableViewCell&quot;)</span><br><span class="line">        scrollView.addSubview(cityTableView)</span><br><span class="line">        </span><br><span class="line">        regionTableView &#x3D; UITableView(frame: .zero, style: .plain)</span><br><span class="line">        regionTableView.delegate &#x3D; self</span><br><span class="line">        regionTableView.dataSource &#x3D; self</span><br><span class="line">        regionTableView.rowHeight &#x3D; 45</span><br><span class="line">        regionTableView.register(WDAddressPickerTableViewCell.self, forCellReuseIdentifier: &quot;WDAddressPickerTableViewCell&quot;)</span><br><span class="line">        scrollView.addSubview(regionTableView)</span><br><span class="line">        </span><br><span class="line">        scrollView.contentSize &#x3D; CGSize(width: UIScreen.main.bounds.width, height: 0)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; MARK: UITableView DataSource Methods</span><br><span class="line">extension WDAddressPickerBottomView: UITableViewDataSource &#123;</span><br><span class="line">    func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int) -&gt; Int &#123;</span><br><span class="line">        if tableView &#x3D;&#x3D; provinceTableView &#123;</span><br><span class="line">            return provinceNameArray.count</span><br><span class="line">        &#125; else if tableView &#x3D;&#x3D; cityTableView &#123;</span><br><span class="line">            return cityNameArray.count</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            return regionNameArray.count</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -&gt; UITableViewCell &#123;</span><br><span class="line">        let cell &#x3D; tableView.dequeueReusableCell(withIdentifier: &quot;WDAddressPickerTableViewCell&quot;, for: indexPath) as! WDAddressPickerTableViewCell</span><br><span class="line">        if tableView &#x3D;&#x3D; provinceTableView &#123;</span><br><span class="line">            cell.titleLabel.text &#x3D; (provinceNameArray[indexPath.row] as NSString).substring(from: 6)</span><br><span class="line">            if indexPath.row &#x3D;&#x3D; proVinceSelectedIndexRow &#123;</span><br><span class="line">                 cell.cellChecked &#x3D; true</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                 cell.cellChecked &#x3D; false</span><br><span class="line">            &#125;</span><br><span class="line">         &#125; else if tableView &#x3D;&#x3D; cityTableView &#123;</span><br><span class="line">            cell.titleLabel.text &#x3D; (cityNameArray[indexPath.row] as NSString).substring(from: 6)</span><br><span class="line">            if indexPath.row &#x3D;&#x3D; citySelectedIndexRow &#123;</span><br><span class="line">                cell.cellChecked &#x3D; true</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                cell.cellChecked &#x3D; false</span><br><span class="line">            &#125;</span><br><span class="line">         &#125; else &#123;</span><br><span class="line">            cell.titleLabel.text &#x3D; (regionNameArray[indexPath.row] as NSString).substring(from: 6)</span><br><span class="line">             if indexPath.row &#x3D;&#x3D; regionSelectedIndexRow &#123;</span><br><span class="line">                 cell.cellChecked &#x3D; true</span><br><span class="line">             &#125; else &#123;</span><br><span class="line">                 cell.cellChecked &#x3D; false</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br><span class="line">        return cell</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; MARK: UITableView Delegate Method</span><br><span class="line">extension WDAddressPickerBottomView: UITableViewDelegate &#123;</span><br><span class="line">    func tableView(_ tableView: UITableView, didSelectRowAt indexPath: IndexPath) &#123;</span><br><span class="line">        tableView.deselectRow(at: indexPath, animated: true)</span><br><span class="line">        let cell &#x3D; tableView.cellForRow(at: indexPath) as! WDAddressPickerTableViewCell</span><br><span class="line">        if tableView &#x3D;&#x3D; provinceTableView &#123;</span><br><span class="line">            proVinceSelectedIndexRow &#x3D; indexPath.row</span><br><span class="line">            scrollView.contentSize &#x3D; CGSize(width: UIScreen.main.bounds.width * 2, height: 0)</span><br><span class="line">            scrollView.setContentOffset(CGPoint(x: UIScreen.main.bounds.width, y: 0), animated: true)</span><br><span class="line">        &#125; else if tableView &#x3D;&#x3D; cityTableView &#123;</span><br><span class="line">            citySelectedIndexRow &#x3D; indexPath.row</span><br><span class="line">            scrollView.contentSize &#x3D; CGSize(width: UIScreen.main.bounds.width * 3, height: 0)</span><br><span class="line">            scrollView.setContentOffset(CGPoint(x: UIScreen.main.bounds.width * 2, y: 0), animated: true)</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            regionSelectedIndexRow &#x3D; indexPath.row</span><br><span class="line">        &#125;</span><br><span class="line">        tableView.reloadData()</span><br><span class="line">        selectedIndexRow &#x3D; indexPath.row</span><br><span class="line">        didSelectedBlock(Int(scrollView.contentOffset.x &#x2F; UIScreen.main.bounds.width), indexPath.row, cell.titleLabel.text ?? &quot;&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="AddressPickerView"><a href="#AddressPickerView" class="headerlink" title="AddressPickerView"></a>AddressPickerView</h3><p>ä»¥ä¸Šçš„æ˜¾ç¤ºçš„è§†å›¾çš„è½½ä½“è§†å›¾</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">fileprivate class WDAddressPickerView: UIView &#123;</span><br><span class="line">    </span><br><span class="line">    var headerView: WDAddressPickerHeaderView!</span><br><span class="line">    var topView: WDAddressPickerTopView!</span><br><span class="line">    var bottomView: WDAddressPickerBottomView!</span><br><span class="line">    </span><br><span class="line">    override init(frame: CGRect) &#123;</span><br><span class="line">        super.init(frame: frame)</span><br><span class="line">        setupSubviews()</span><br><span class="line">        setupSubviewsConstraint()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    required init?(coder: NSCoder) &#123;</span><br><span class="line">        fatalError(&quot;init(coder:) has not been implemented&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; MARK: é¡µé¢å¸ƒå±€</span><br><span class="line">@objc private extension WDAddressPickerView &#123;</span><br><span class="line">    &#x2F;&#x2F; é¡µé¢æ§ä»¶åˆå§‹åŒ–</span><br><span class="line">    func setupSubviews() &#123;</span><br><span class="line">        headerView &#x3D; WDAddressPickerHeaderView()</span><br><span class="line">        addSubview(headerView)</span><br><span class="line">        </span><br><span class="line">        topView &#x3D; WDAddressPickerTopView()</span><br><span class="line">        topView.setup(with: [], selectIndex: 0)</span><br><span class="line">        addSubview(topView)</span><br><span class="line">        </span><br><span class="line">        bottomView &#x3D; WDAddressPickerBottomView()</span><br><span class="line">        addSubview(bottomView)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; é¡µé¢æ§ä»¶å¸ƒå±€</span><br><span class="line">    func setupSubviewsConstraint() &#123;</span><br><span class="line">        headerView.frame &#x3D; CGRect(x: 0, y: 0, width: UIScreen.main.bounds.width, height: 50)</span><br><span class="line">        topView.frame &#x3D; CGRect(x: 0, y: headerView.frame.maxY - 10, width: UIScreen.main.bounds.width, height: 45)</span><br><span class="line">        bottomView.frame &#x3D; CGRect(x: 0, y: topView.frame.maxY, width: UIScreen.main.bounds.width, height: UIScreen.main.bounds.height - 100 - topView.frame.maxY)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åœ°å€é€‰å–ç®¡ç†å™¨"><a href="#åœ°å€é€‰å–ç®¡ç†å™¨" class="headerlink" title="åœ°å€é€‰å–ç®¡ç†å™¨"></a>åœ°å€é€‰å–ç®¡ç†å™¨</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">class WDAddressPickerManager: NSObject &#123;</span><br><span class="line">    static let manager &#x3D; WDAddressPickerManager()</span><br><span class="line">    private var backView: UIView!</span><br><span class="line">    private var addressPickerView: WDAddressPickerView!</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F;&#x2F; æ˜¾ç¤ºé€‰æ‹©å™¨</span><br><span class="line">    &#x2F;&#x2F;&#x2F; - Parameter completeBlock: provinceï¼š çœï¼ˆç›´è¾–å¸‚ï¼‰ï¼Œ cityï¼šå¸‚ï¼ˆç›´è¾–å¸‚ä¸­çš„åŒºï¼‰ï¼Œregionï¼š åŒº</span><br><span class="line">    func showPicker(completeBlock: @escaping ((_ province: String, _ city: String, _ region: String) -&gt; Void)) &#123;</span><br><span class="line">        backView &#x3D; UIView()</span><br><span class="line">        backView.backgroundColor &#x3D; UIColor(white: 0, alpha: 0)</span><br><span class="line">        backView.frame &#x3D; UIScreen.main.bounds</span><br><span class="line">        backView.addGestureRecognizer(UITapGestureRecognizer(target: self, action: #selector(tapGuestureTargetAction(sender:))))</span><br><span class="line">        UIApplication.shared.keyWindow?.addSubview(backView)</span><br><span class="line"></span><br><span class="line">        var titleItems: [String] &#x3D; Array()</span><br><span class="line">        var provinceName &#x3D; &quot;&quot;</span><br><span class="line">        var cityName &#x3D; &quot;&quot;</span><br><span class="line">        var reginName &#x3D; &quot;&quot;</span><br><span class="line">        </span><br><span class="line">        addressPickerView &#x3D; WDAddressPickerView()</span><br><span class="line">        addressPickerView.frame &#x3D; CGRect(x: 0, y: UIScreen.main.bounds.height, width: UIScreen.main.bounds.width, height: UIScreen.main.bounds.height - 100)</span><br><span class="line">        addressPickerView.headerView.clearButton.addTarget(self, action: #selector(tapGuestureTargetAction(sender:)), for: .touchUpInside)</span><br><span class="line">        addressPickerView.bottomView.didSelectedBlock &#x3D; &#123; [weak self] (page, index, name) in</span><br><span class="line">            if page &#x3D;&#x3D; 0 &#123;</span><br><span class="line">                provinceName &#x3D; name</span><br><span class="line">                cityName &#x3D; &quot;&quot;</span><br><span class="line">                reginName &#x3D; &quot;&quot;</span><br><span class="line">                titleItems &#x3D; [name, &quot;è¯·é€‰æ‹©&quot;]</span><br><span class="line">                self?.addressPickerView.bottomView.provinceName &#x3D; name</span><br><span class="line">                self?.addressPickerView.topView.setup(with: titleItems, selectIndex: page + 1)</span><br><span class="line">            &#125; else if page &#x3D;&#x3D; 1 &#123;</span><br><span class="line">                cityName &#x3D; name</span><br><span class="line">                reginName &#x3D; &quot;&quot;</span><br><span class="line">                if provinceName.contains(&quot;åŒ—äº¬&quot;) ||</span><br><span class="line">                    provinceName.contains(&quot;ä¸Šæµ·&quot;) ||</span><br><span class="line">                    provinceName.contains(&quot;å¤©æ´¥&quot;) ||</span><br><span class="line">                    provinceName.contains(&quot;é¦™æ¸¯&quot;) ||</span><br><span class="line">                    provinceName.contains(&quot;æ¾³é—¨&quot;) ||</span><br><span class="line">                    provinceName.contains(&quot;é‡åº†&quot;) &#123;</span><br><span class="line">                    self?.hidenView()</span><br><span class="line">                    completeBlock(provinceName, cityName, reginName)</span><br><span class="line">                    return</span><br><span class="line">                &#125;</span><br><span class="line">                titleItems &#x3D; [(provinceName), (cityName), &quot;è¯·é€‰æ‹©&quot;]</span><br><span class="line">                self?.addressPickerView.bottomView.cityName &#x3D; name</span><br><span class="line">                self?.addressPickerView.topView.setup(with: titleItems, selectIndex: page + 1)</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                reginName &#x3D; name</span><br><span class="line">                titleItems &#x3D; [provinceName, cityName, reginName]</span><br><span class="line">                self?.addressPickerView.topView.setup(with: titleItems, selectIndex: page)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            if page &#x3D;&#x3D; 2 &#123;</span><br><span class="line">                self?.hidenView()</span><br><span class="line">                completeBlock(provinceName, cityName, reginName)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        addressPickerView.topView.didSelectedIndexBlock &#x3D; &#123; [weak self] index in</span><br><span class="line">            self?.addressPickerView.bottomView.scrollView.setContentOffset(CGPoint(x: UIScreen.main.bounds.width * CGFloat(index), y: 0), animated: true)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        UIApplication.shared.keyWindow?.addSubview(addressPickerView)</span><br><span class="line">        </span><br><span class="line">        UIView.animate(withDuration: 0.5) &#123;</span><br><span class="line">            self.backView.backgroundColor &#x3D; UIColor(white: 0, alpha: 0.3)</span><br><span class="line">            self.addressPickerView.frame &#x3D; CGRect(x: 0, y: 100, width: UIScreen.main.bounds.width, height: UIScreen.main.bounds.height - 100)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @objc private func tapGuestureTargetAction(sender: Any) &#123;</span><br><span class="line">        hidenView()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    private func hidenView() &#123;</span><br><span class="line">        UIView.animate(withDuration: 0.5, animations: &#123;</span><br><span class="line">            self.backView.backgroundColor &#x3D; UIColor(white: 0, alpha: 0)</span><br><span class="line">            self.addressPickerView.frame &#x3D; CGRect(x: 0, y: UIScreen.main.bounds.height, width: UIScreen.main.bounds.width, height: UIScreen.main.bounds.height - 100)</span><br><span class="line">        &#125;) &#123; (finished) in</span><br><span class="line">            self.backView.removeFromSuperview()</span><br><span class="line">            self.addressPickerView.removeFromSuperview()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ•ˆæœå›¾"><a href="#æ•ˆæœå›¾" class="headerlink" title="æ•ˆæœå›¾"></a>æ•ˆæœå›¾</h3><p><img src="https://s2.ax1x.com/2020/01/20/1PaAeA.gif" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> Swift </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è‡ªå®šä¹‰æ§ä»¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iOSå•å…ƒæµ‹è¯•</title>
      <link href="/2020/01/16/iOS%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/"/>
      <url>/2020/01/16/iOS%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/</url>
      
        <content type="html"><![CDATA[<h2 id="å•å…ƒæµ‹è¯•"><a href="#å•å…ƒæµ‹è¯•" class="headerlink" title="å•å…ƒæµ‹è¯•"></a>å•å…ƒæµ‹è¯•</h2><p>ä»¥æµ‹è¯•ViewControllerä¸ºä¾‹ã€‚</p><h5 id="ViewController-hæ–‡ä»¶"><a href="#ViewController-hæ–‡ä»¶" class="headerlink" title="ViewController.hæ–‡ä»¶"></a>ViewController.hæ–‡ä»¶</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;UIKit&#x2F;UIKit.h&gt;</span><br><span class="line"></span><br><span class="line">@interface ViewController : UIViewController</span><br><span class="line">&#x2F;** é€»è¾‘æµ‹è¯• *&#x2F;</span><br><span class="line">- (int)getSumWithNum1:(int)a num2:(int)b;</span><br><span class="line">&#x2F;** å¼‚æ­¥æµ‹è¯• *&#x2F;</span><br><span class="line">- (void)loadDataComplete:(void(^)(id info))complete;</span><br><span class="line">&#x2F;** æ€§èƒ½æµ‹è¯• *&#x2F;</span><br><span class="line">- (void)openCamera;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure><h5 id="ViewController-mæ–‡ä»¶"><a href="#ViewController-mæ–‡ä»¶" class="headerlink" title="ViewController.mæ–‡ä»¶"></a>ViewController.mæ–‡ä»¶</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">- (int)getSumWithNum1:(int)a num2:(int)b &#123;</span><br><span class="line">    return a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)loadDataComplete:(void (^)(id))complete &#123;    </span><br><span class="line">    dispatch_async(dispatch_get_global_queue(0, 0), ^&#123;</span><br><span class="line">        sleep(2);</span><br><span class="line">        NSString *data &#x3D; @&quot;ğŸ˜&quot;;</span><br><span class="line">        dispatch_async(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">            complete(data);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)openCamera &#123;</span><br><span class="line">    for(int i &#x3D; 0; i &lt; 1000; ++i) &#123;</span><br><span class="line">        NSLog(@&quot;è¿™æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²%d&quot;, i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸ºäº†è¿›è¡Œå•å…ƒåŒ–æµ‹è¯•ï¼Œæ‰€ä»¥æ–°å»ºä¸€ä¸ª<code>ViewControllerTest</code>æ–‡ä»¶ã€‚<br>æ­¥éª¤<br><img src="https://s2.ax1x.com/2020/01/20/1Pd6Bj.png" alt=""></p><ul><li>å¯¼å…¥æµ‹è¯•å¤´æ–‡ä»¶<code>#import &quot;ViewController.h&quot;</code></li><li>å£°æ˜å±æ€§<code>@property (nonatomic, strong) ViewController *vc;</code></li><li>åœ¨<code>- (void)setUp;</code>è¿›è¡Œåˆå§‹åŒ–ä»£ç <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (void)setUp &#123;</span><br><span class="line">    self.vc &#x3D; [[ViewController alloc] init];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1ã€é€»è¾‘æµ‹è¯•"><a href="#1ã€é€»è¾‘æµ‹è¯•" class="headerlink" title="1ã€é€»è¾‘æµ‹è¯•"></a>1ã€é€»è¾‘æµ‹è¯•</h3></li></ul><ol><li><p>ç»™å‡ºæµ‹è¯•æ•°æ®</p></li><li><p>è¿›è¡Œæµ‹è¯•</p></li><li><p>ä½¿ç”¨æ–­è¨€è¿›è¡Œåˆ¤å®š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">- (void)testSum &#123;</span><br><span class="line">    &#x2F;&#x2F; 1. given</span><br><span class="line">    int a &#x3D; 10;</span><br><span class="line">    int b &#x3D; 22;</span><br><span class="line">    &#x2F;&#x2F; 2. when</span><br><span class="line">    int sum &#x3D; [self.vc getSumWithNum1:a num2:b];</span><br><span class="line">    &#x2F;&#x2F; 3. then</span><br><span class="line">    XCTAssertEqual(sum, 32, @&quot;é”™è¯¯&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2ã€å¼‚æ­¥æµ‹è¯•"><a href="#2ã€å¼‚æ­¥æµ‹è¯•" class="headerlink" title="2ã€å¼‚æ­¥æµ‹è¯•"></a>2ã€å¼‚æ­¥æµ‹è¯•</h3></li><li><p>åˆ›å»º<code>XCTestExpectation</code>ï¼Œè®¾ç½®é”™è¯¯æç¤º</p></li><li><p>è°ƒç”¨æ–¹æ³•ï¼Œåœ¨å¼‚æ­¥ä¸­è°ƒç”¨<code>fulfill</code></p></li><li><p>è¿›è¡Œåˆ¤æ–­æ—¶é—´ï¼Œæ˜¯å¦åœ¨é¢„æœŸæ—¶é—´å†…å®¹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">XCTestExpectation *exp &#x3D; [self expectationWithDescription:@&quot;è¶…è¿‡é¢„æœŸæ—¶é—´&quot;];</span><br><span class="line">[self.vc loadDataComplete:^(id info) &#123;</span><br><span class="line">    XCTAssertNil(info, @&quot;æ•°æ®ä¸ºç©º&quot;);</span><br><span class="line">    [exp fulfill];</span><br><span class="line">&#125;];</span><br><span class="line">[self waitForExpectationsWithTimeout:4 handler:^(NSError * _Nullable error) &#123;</span><br><span class="line">    NSLog(@&quot;%@&quot;, error);</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure><h3 id="3ã€æ€§èƒ½æµ‹è¯•"><a href="#3ã€æ€§èƒ½æµ‹è¯•" class="headerlink" title="3ã€æ€§èƒ½æµ‹è¯•"></a>3ã€æ€§èƒ½æµ‹è¯•</h3><p><img src="https://s2.ax1x.com/2020/01/20/1Pd2En.png" alt="æ€§èƒ½æµ‹è¯•"></p></li><li><p>è®¾ç½®Baselineæ—¶é—´</p></li><li><p>Max STDDEV æœ€å¤§æ ·æœ¬æ ‡å‡†åå·®æ¯”ä¾‹</p></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- (void)testPerformanceExample &#123;</span><br><span class="line">    [self measureBlock:^&#123;</span><br><span class="line">        [self.vc openCamera];</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="UIæµ‹è¯•"><a href="#UIæµ‹è¯•" class="headerlink" title="UIæµ‹è¯•"></a>UIæµ‹è¯•</h2><p><img src="https://s2.ax1x.com/2020/01/20/1PdTu4.png" alt="è„šæœ¬å½•åˆ¶"></p><p>1ã€å½•åˆ¶è„šæœ¬<br><br>2ã€ç¼–è¾‘è„šæœ¬<br><br>3ã€è‡ªåŠ¨åŒ–æµ‹è¯•</p><h2 id="è·å–ä»£ç è¦†ç›–ç‡"><a href="#è·å–ä»£ç è¦†ç›–ç‡" class="headerlink" title="è·å–ä»£ç è¦†ç›–ç‡"></a>è·å–ä»£ç è¦†ç›–ç‡</h2><p>1ã€ç‚¹å‡»<code>Edit Secheme</code><br><img src="https://s2.ax1x.com/2020/01/20/1PdLU1.png" alt="Edit Secheme"></p><p>2ã€é€‰æ‹©<code>Test</code>-&gt;<code>Options</code>-&gt;<code>Code Coverage</code>å‹¾èµ·<br><img src="https://s2.ax1x.com/2020/01/20/1PdzvD.png" alt="Code Coverage"></p><p>3ã€è¿è¡Œä»£ç æŸ¥çœ‹ç»“æœ<br><img src="https://s2.ax1x.com/2020/01/20/1PwiVA.png" alt="æŸ¥çœ‹ç»“æœ"></p>]]></content>
      
      
      <categories>
          
          <category> Objective-C </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¼€å‘æŠ€å·§ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¼€å‘æŠ€å·§</title>
      <link href="/2020/01/16/%E5%BC%80%E5%8F%91%E6%8A%80%E5%B7%A7/"/>
      <url>/2020/01/16/%E5%BC%80%E5%8F%91%E6%8A%80%E5%B7%A7/</url>
      
        <content type="html"><![CDATA[<p><img src="https://s2.ax1x.com/2020/01/20/1PtYFK.jpg" alt=""></p><a id="more"></a><p>1ã€PrefixHeaderå¯¼å…¥ä½ç½®å†™æ³•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(SRCROOT)&#x2F;$(PROJECT_NAME)&#x2F;&lt;#æ–‡ä»¶æ‰€åœ¨æ–‡ä»¶å¤¹åç§°#&gt;&#x2F;PrefixHeader.pch</span><br></pre></td></tr></table></figure><p>2ã€éšè—å¯¼èˆªæ çš„ä¸¤ç§æ–¹å¼</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;æ–¹å¼ä¸€ ã€Šæ¨èã€‹</span><br><span class="line">&#x2F;&#x2F;åœ¨éœ€è¦éšè—çš„viewControllerä¸­éµå¾ª&lt;UINavigationControllerDelegate&gt;</span><br><span class="line">- (void)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line"> &#x2F;&#x2F; è®¾ç½®å¯¼èˆªæ§åˆ¶å™¨çš„ä»£ç†ä¸ºself</span><br><span class="line">    self.navigationController.delegate &#x3D; self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - UINavigationControllerDelegate</span><br><span class="line">&#x2F;&#x2F; å°†è¦æ˜¾ç¤ºæ§åˆ¶å™¨</span><br><span class="line">- (void)navigationController:(UINavigationController *)navigationController willShowViewController:(UIViewController *)viewController animated:(BOOL)animated &#123;</span><br><span class="line">    &#x2F;&#x2F; åˆ¤æ–­è¦æ˜¾ç¤ºçš„æ§åˆ¶å™¨æ˜¯å¦æ˜¯è‡ªå·±</span><br><span class="line">    BOOL isShowHomePage &#x3D; [viewController isKindOfClass:[self class]];</span><br><span class="line">    </span><br><span class="line">    [self.navigationController setNavigationBarHidden:isShowHomePage animated:YES];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;æ–¹å¼äºŒ</span><br><span class="line">- (void)viewWillAppear:(BOOL)animated &#123;</span><br><span class="line">    [super viewWillAppear:animated];</span><br><span class="line"></span><br><span class="line">    [self.navigationController setNavigationBarHidden:YES animated:YES];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)viewWillDisappear:(BOOL)animated &#123;</span><br><span class="line">    [super viewWillDisappear:animated];</span><br><span class="line"></span><br><span class="line">    [self.navigationController setNavigationBarHidden:NO animated:YES];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3ã€TabBarItemè¦æ±‚åªæ˜¾ç¤ºå›¾ç‰‡ä¸æ˜¾ç¤ºæ–‡å­—</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; self è¡¨ç¤ºéœ€è¦è®¾ç½®æ ·å¼çš„æ§åˆ¶å™¨</span><br><span class="line">[self.tabBarItem setImageInsets:UIEdgeInsetsMake(6, 0, -6, 0)];</span><br></pre></td></tr></table></figure><p>4ã€TableViewæˆ–CollectionViewå•é€‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--æ­¥éª¤ä¸€ã€ å£°æ˜ä¸€ä¸ªå…¨å±€å˜é‡--&gt;</span><br><span class="line">@property (nonatomic, assign) NSInteger selectedIndex;</span><br><span class="line">&lt;!--æ­¥éª¤äºŒã€TableViewæˆ–CollectionViewç‚¹å‡»äº‹ä»¶çš„æ–¹æ³•ä¸­ä¿å­˜ç‚¹å‡»çš„indexï¼Œå¹¶åˆ·æ–°--&gt;</span><br><span class="line">self.selectedIndex &#x3D; indexPath.row;</span><br><span class="line">[collectionView reloadData];æˆ–[tableView reloadData];</span><br><span class="line">&lt;!--æ­¥éª¤ä¸‰ã€åœ¨cellForItemAtIndexPathæˆ–cellForRowAtIndexPathæ–¹æ³•ä¸­åˆ¤æ–­æ˜¯å¦æ˜¯æ‰€ä¿å­˜çš„index--&gt;</span><br><span class="line">if (self.selectedIndex &#x3D;&#x3D; indexPath.row) &#123;</span><br><span class="line">    &#x2F;&#x2F; è®¾ç½®é€‰ä¸­æ ·å¼</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    &#x2F;&#x2F; è®¾ç½®æˆé»˜è®¤æ ·å¼    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>5ã€æ€ä¹ˆåŒºåˆ†çœŸæœºè¿˜æ˜¯æ¨¡æ‹Ÿå™¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#if TARGET_IPHONE_SIMULATOR  </span><br><span class="line">    NSLog(@&quot;run on simulator&quot;);  </span><br><span class="line">#define SIMULATOR_TEST</span><br><span class="line">#else  </span><br><span class="line">&#x2F;&#x2F;ä¸å®šä¹‰SIMULATOR_TESTè¿™ä¸ªå®</span><br><span class="line">    NSLog(@&quot;run on device&quot;);  </span><br><span class="line">#endif</span><br></pre></td></tr></table></figure><p>6ã€if Debug</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#ifdef DEBUG    </span><br><span class="line">&#x2F;&#x2F; do sth</span><br><span class="line">#else   </span><br><span class="line">&#x2F;&#x2F; do sth</span><br><span class="line">#endif</span><br></pre></td></tr></table></figure><p>7ã€ä¸€é”®æ¸…ç†æ‰€æœ‰æ¨¡æ‹Ÿå™¨å®‰è£…è¿‡çš„APP</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; å…ˆå…³é—­æ‰€æœ‰æ¨¡æ‹Ÿå™¨ åœ¨ç»ˆç«¯ä¸­è¾“å…¥ä¸‹é¢å‘½ä»¤å³å¯</span><br><span class="line">xcrun simctl erase all</span><br></pre></td></tr></table></figure><p>8ã€SDWebImageæ¸…ç†ç¼“å­˜</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- (void)didReceiveMemoryWarning &#123;</span><br><span class="line">    [super didReceiveMemoryWarning];</span><br><span class="line">    [[[SDWebImageManager sharedManager] imageCache] clearMemory];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>9ã€UITableViewçš„HeaderViewä¸‹æ‹‰æ”¾å¤§</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">1ã€View1:ä½œä¸ºæ˜¾ç¤ºView</span><br><span class="line">2ã€View2:ä½œä¸ºtableViewçš„tableHeaderViewï¼Œå¹¶æ·»åŠ View1ï¼ŒView2çš„å¤§å°å’ŒView1å¤§å°ç›¸åŒ.</span><br><span class="line">3ã€åœ¨UIScrollViewDelegateæ–¹æ³•ä¸­è¿›è¡Œè®¾è®¡</span><br><span class="line">- (void)scrollViewDidScroll:(UIScrollView *)scrollView &#123;</span><br><span class="line">    CGFloat width &#x3D; UIScreen.mainScreen.bounds.size.width;</span><br><span class="line">    CGFloat viewHeight &#x3D; kScreenWidth * 0.5; &#x2F;&#x2F; View1çš„åˆå§‹é«˜åº¦</span><br><span class="line">    CGFloat yOffset &#x3D; scrollView.contentOffset.y;</span><br><span class="line">    if (yOffset &lt; 0) &#123;</span><br><span class="line">        CGFloat totalOffset &#x3D; viewHeight + ABS(yOffset);</span><br><span class="line">        CGFloat f &#x3D; totalOffset &#x2F; viewHeight;</span><br><span class="line">        self.headerView.frame &#x3D; CGRectMake(- (width * f - width) &#x2F; 2, yOffset, width * f, totalOffset);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>10ã€Masonryåˆ¶ä½œå°±å®«æ ¼</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;Objective-C ----&gt; Masonry</span><br><span class="line">&#x2F;**</span><br><span class="line"> å¤šè§†å›¾å¸ƒå±€</span><br><span class="line"></span><br><span class="line"> @param viewArray è§†å›¾æ•°ç»„</span><br><span class="line"> @param column åˆ—æ•°</span><br><span class="line"> @param tbSpeace è§†å›¾ä¸Šä¸‹é—´è·</span><br><span class="line"> @param lrSpeace è§†å›¾å·¦å³é—´è·</span><br><span class="line"> @param topSpeace å’Œçˆ¶è§†å›¾ä¸Šé—´è·</span><br><span class="line"> @param lrSuperViewSpeace çˆ¶è§†å›¾å·¦å³é—´è·</span><br><span class="line"> @param superView çˆ¶è§†å›¾</span><br><span class="line"> @param viewHeight è§†å›¾é«˜åº¦</span><br><span class="line"> *&#x2F;</span><br><span class="line">- (void)wd_masLayoutSubViewsWithViewArray:(NSArray&lt;UIView *&gt; *)viewArray</span><br><span class="line">                              columnOfRow:(NSInteger)column</span><br><span class="line">                    topBottomOfItemSpeace:(CGFloat)tbSpeace</span><br><span class="line">                      leftRightItemSpeace:(CGFloat)lrSpeace</span><br><span class="line">                     topOfSuperViewSpeace:(CGFloat)topSpeace</span><br><span class="line">                 leftRightSuperViewSpeace:(CGFloat)lrSuperViewSpeace</span><br><span class="line">                          addToSubperView:(UIView *)superView</span><br><span class="line">                               viewHeight:(CGFloat)viewHeight&#123;</span><br><span class="line">  </span><br><span class="line">                    CGFloat viewWidth &#x3D; superView.bounds.size.width;</span><br><span class="line">                    CGFloat itemWidth &#x3D; (viewWidth - lrSuperViewSpeace * 2 - (column - 1) * lrSpeace) &#x2F; column * 1.0f;</span><br><span class="line">                    CGFloat itemHeight &#x3D; viewHeight;</span><br><span class="line">                    UIView *last &#x3D; nil;</span><br><span class="line">  </span><br><span class="line">                    for (int i &#x3D; 0; i &lt; viewArray.count; i++) &#123;</span><br><span class="line">                        UIView *item &#x3D; viewArray[i];</span><br><span class="line">                        [superView addSubview:item];</span><br><span class="line"></span><br><span class="line">                        [item mas_makeConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class="line">                            make.width.mas_equalTo(itemWidth);</span><br><span class="line">                            make.height.mas_equalTo(itemHeight);</span><br><span class="line">                          </span><br><span class="line">                            CGFloat top &#x3D; topSpeace + (i &#x2F; column) * (itemHeight + tbSpeace);</span><br><span class="line">                            make.top.mas_offset(top);</span><br><span class="line">                            if (!last || (i % column) &#x3D;&#x3D; 0) &#123;</span><br><span class="line">                                make.left.mas_offset(lrSuperViewSpeace);</span><br><span class="line">                            &#125;else&#123;</span><br><span class="line">                                make.left.mas_equalTo(last.mas_right).mas_offset(lrSpeace);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;];</span><br><span class="line">                      </span><br><span class="line">                        last &#x3D; item;</span><br><span class="line">                    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>11ã€Snapkitåˆ¶ä½œä¹å®«æ ¼</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;Swift ----&gt; SnapKit</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F;&#x2F; å¤šè§†å›¾å¸ƒå±€</span><br><span class="line">    &#x2F;&#x2F;&#x2F;</span><br><span class="line">    &#x2F;&#x2F;&#x2F; - Parameters:</span><br><span class="line">    &#x2F;&#x2F;&#x2F;   - viewArray: è§†å›¾æ•°ç»„</span><br><span class="line">    &#x2F;&#x2F;&#x2F;   - columnOfRow: åˆ—æ•°</span><br><span class="line">    &#x2F;&#x2F;&#x2F;   - topBottomOfItemSpeace: è§†å›¾ä¸Šä¸‹é—´è·</span><br><span class="line">    &#x2F;&#x2F;&#x2F;   - leftRightItemSpeace: è§†å›¾å·¦å³é—´è·</span><br><span class="line">    &#x2F;&#x2F;&#x2F;   - topOfSuperViewSpeace: å’Œçˆ¶è§†å›¾ä¸Šé—´è·</span><br><span class="line">    &#x2F;&#x2F;&#x2F;   - leftRightSuperViewSpeace: çˆ¶è§†å›¾å·¦å³é—´è·</span><br><span class="line">    &#x2F;&#x2F;&#x2F;   - addToSubperView: çˆ¶è§†å›¾</span><br><span class="line">    &#x2F;&#x2F;&#x2F;   - viewHeight: è§†å›¾é«˜åº¦</span><br><span class="line">    func wd_masLayoutSubViews(viewArray:Array&lt;UIView&gt;,</span><br><span class="line">                              columnOfRow:Int,</span><br><span class="line">                              topBottomOfItemSpeace:CGFloat,</span><br><span class="line">                              leftRightItemSpeace:CGFloat,</span><br><span class="line">                              topOfSuperViewSpeace:CGFloat,</span><br><span class="line">                              leftRightSuperViewSpeace:CGFloat,</span><br><span class="line">                              addToSubperView:UIView,</span><br><span class="line">                              viewHeight:CGFloat) -&gt; Void &#123;</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        let viewWidth &#x3D; addToSubperView.bounds.width</span><br><span class="line">        let tempW &#x3D; leftRightSuperViewSpeace * 2 + CGFloat(columnOfRow - 1) * leftRightItemSpeace</span><br><span class="line">        let itemWidth &#x3D; (viewWidth - tempW) &#x2F; CGFloat(columnOfRow)</span><br><span class="line">        let itemHeight &#x3D; viewHeight</span><br><span class="line">        </span><br><span class="line">        print(leftRightSuperViewSpeace,leftRightItemSpeace,itemWidth)</span><br><span class="line">        </span><br><span class="line">        var lastView:UIView?</span><br><span class="line">        </span><br><span class="line">        for (index) in viewArray.enumerated() &#123;</span><br><span class="line">            </span><br><span class="line">            let item &#x3D; viewArray[i]</span><br><span class="line">            addToSubperView.addSubview(item)</span><br><span class="line">            </span><br><span class="line">            item.snp.makeConstraints &#123; (make) in</span><br><span class="line">                make.width.equalTo(itemWidth)</span><br><span class="line">                make.height.equalTo(itemHeight)</span><br><span class="line">                let top &#x3D; topOfSuperViewSpeace + CGFloat(i &#x2F; columnOfRow) * (itemHeight + topBottomOfItemSpeace)</span><br><span class="line">                make.top.equalTo(top)</span><br><span class="line">                </span><br><span class="line">                if !(lastView !&#x3D; nil) || i%columnOfRow &#x3D;&#x3D; 0 &#123;</span><br><span class="line">                    make.left.equalTo(leftRightSuperViewSpeace)</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    make.left.equalTo((lastView?.snp.right)!).offset(leftRightItemSpeace)</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                lastView &#x3D; item</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>12ã€æ²‰æµ¸å¼TableView(ScrollViewã€CollectionView)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if (@available(iOS 11.0, *)) &#123;</span><br><span class="line">    self.tableView.contentInsetAdjustmentBehavior &#x3D; UIScrollViewContentInsetAdjustmentNever;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    self.automaticallyAdjustsScrollViewInsets &#x3D; false;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>13ã€é€šè¿‡èº«ä»½è¯è®¡ç®—å¹´é¾„</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;** é€šè¿‡èº«ä»½è¯è®¡ç®—å¹´é¾„ *&#x2F;</span><br><span class="line">- (NSString *)calculationAgeWithBirthday: (NSString *)birthday &#123;</span><br><span class="line">    NSCalendar *calendar &#x3D; [NSCalendar currentCalendar];</span><br><span class="line">    NSDate *nowDate &#x3D; [NSDate date];</span><br><span class="line">    NSString *birth &#x3D; birthday;</span><br><span class="line">    NSDateFormatter *dateFormatter &#x3D; [[NSDateFormatter alloc]init];</span><br><span class="line">    [dateFormatter setDateFormat:@&quot;yyyy-MM-dd&quot;];</span><br><span class="line">    NSDate *birthDay &#x3D; [dateFormatter dateFromString:birth];</span><br><span class="line">    unsigned int unitFlags &#x3D; NSCalendarUnitYear | NSCalendarUnitMonth | NSCalendarUnitDay;</span><br><span class="line">    NSDateComponents *date &#x3D; [calendar components:unitFlags fromDate:birthDay toDate:nowDate options:0];</span><br><span class="line">    if ([date year] &gt; 0) &#123;</span><br><span class="line">        return [NSString stringWithFormat:@&quot;%ldå²&quot;, (long)[date year]];</span><br><span class="line">    &#125; else if([date month] &gt; 0) &#123;</span><br><span class="line">        return [NSString stringWithFormat:@&quot;%ldæœˆ&quot;, (long)[date month]];</span><br><span class="line">    &#125;  else if([date day] &gt; 0)&#123;</span><br><span class="line">        return [NSString stringWithFormat:@&quot;%ldå¤©&quot;, (long)[date day]];</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        return @&quot;0å¤©&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (NSString *)ageStrFromIdentityCard:(NSString *)numberStr &#123;</span><br><span class="line">    NSString *dateSt;</span><br><span class="line">    NSMutableString *dateS;</span><br><span class="line">    if (numberStr.length &gt; 15) &#123;</span><br><span class="line">        dateSt &#x3D; [numberStr substringWithRange:NSMakeRange(6, 8)];</span><br><span class="line">        dateS &#x3D; [NSMutableString stringWithFormat:@&quot;%@&quot;, dateSt];</span><br><span class="line">        [dateS insertString:@&quot;-&quot; atIndex:4];</span><br><span class="line">        [dateS insertString:@&quot;-&quot; atIndex:7];</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">        &#x2F;&#x2F; åªè€ƒè™‘ 19å¼€å¤´çš„15ä½çš„èº«ä»½è¯å·</span><br><span class="line">        dateSt &#x3D; [NSString stringWithFormat:@&quot;19%@&quot;,[numberStr substringWithRange:NSMakeRange(6, 6)]];</span><br><span class="line">        dateS &#x3D; [NSMutableString stringWithFormat:@&quot;%@&quot;, dateSt];</span><br><span class="line">        [dateS insertString:@&quot;-&quot; atIndex:4];</span><br><span class="line">        [dateS insertString:@&quot;-&quot; atIndex:7];</span><br><span class="line">    &#125;</span><br><span class="line">    return [self calculationAgeWithBirthday:dateS];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> iOSå¼€å‘æŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¼€å‘æŠ€å·§ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä»£ç å—(Snippet)</title>
      <link href="/2020/01/16/%E4%BB%A3%E7%A0%81%E5%9D%97(Snippet)/"/>
      <url>/2020/01/16/%E4%BB%A3%E7%A0%81%E5%9D%97(Snippet)/</url>
      
        <content type="html"><![CDATA[<p>ä»£ç å—(Snippet)ï¼Œæ–¹ä¾¿äº†ä»£ç å¿«é€Ÿåˆ›å»ºã€‚</p><h4 id="ç®¡ç†ï¼šåœ¨æ–°ç‰ˆXcodeä¸­ç®¡ç†é¡µé¢åœ¨ç¼–è¯‘å™¨çš„å³ä¸Šè§’"><a href="#ç®¡ç†ï¼šåœ¨æ–°ç‰ˆXcodeä¸­ç®¡ç†é¡µé¢åœ¨ç¼–è¯‘å™¨çš„å³ä¸Šè§’" class="headerlink" title="ç®¡ç†ï¼šåœ¨æ–°ç‰ˆXcodeä¸­ç®¡ç†é¡µé¢åœ¨ç¼–è¯‘å™¨çš„å³ä¸Šè§’"></a>ç®¡ç†ï¼šåœ¨æ–°ç‰ˆXcodeä¸­ç®¡ç†é¡µé¢åœ¨ç¼–è¯‘å™¨çš„å³ä¸Šè§’</h4><p><img src="https://s2.ax1x.com/2020/01/20/1PwEPP.png" alt="ä»£ç å—ç®¡ç†"></p><h4 id="æ·»åŠ ï¼šé€‰ä¸­ä»£ç é¼ æ ‡å³å‡»"><a href="#æ·»åŠ ï¼šé€‰ä¸­ä»£ç é¼ æ ‡å³å‡»" class="headerlink" title="æ·»åŠ ï¼šé€‰ä¸­ä»£ç é¼ æ ‡å³å‡»"></a>æ·»åŠ ï¼šé€‰ä¸­ä»£ç é¼ æ ‡å³å‡»</h4><p><img src="https://s2.ax1x.com/2020/01/20/1PwexS.png" alt="æ·»åŠ "></p><h4 id="ç¼–è¾‘"><a href="#ç¼–è¾‘" class="headerlink" title="ç¼–è¾‘"></a>ç¼–è¾‘</h4><p><img src="https://s2.ax1x.com/2020/01/20/1PwKbj.png" alt="ç¼–è¾‘"></p><ol><li><p>Titleï¼šæ ‡é¢˜ã€‚ </p></li><li><p>Summaryï¼šæè¿°æ–‡å­—ã€‚ </p></li><li><p>Platformï¼šå¯ä»¥ä½¿ç”¨çš„å¹³å°ï¼ˆå¦‚iOSã€Mac OSï¼‰ã€‚ </p></li><li><p>Languageï¼šå¯ä»¥åœ¨å“ªäº›è¯­è¨€ä¸­ä½¿ç”¨ï¼ˆå¦‚ Objective-Cã€Swiftï¼‰ã€‚ </p></li><li><p>Completion Shortcutï¼šå¿«æ·æ–¹å¼ï¼Œä»¥å­—æ¯å¼€å¤´ï¼ˆæ”¯æŒå°‘æ•°ç¬¦å·ï¼Œå¦‚@ï¼‰ã€‚ </p></li><li><p>Completion Scopesï¼šä½œç”¨èŒƒå›´ï¼Œä¸€èˆ¬å†™åœ¨æ­£ç¡®çš„ä½ç½®æ‹–åŠ¨å³å¯ï¼ŒXcodeä¼šè‡ªè¡Œé€‰æ‹©å¥½ã€‚</p><h4 id="å±æ€§"><a href="#å±æ€§" class="headerlink" title="å±æ€§"></a>å±æ€§</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@property (nonatomic, strong) &lt;#ClassName#&gt; *&lt;#class#&gt;; &#x2F;&#x2F;&#x2F;&lt; &lt;#æ³¨é‡Š#&gt;</span><br><span class="line">@property (nonatomic, assign) &lt;#DataType#&gt; &lt;#name#&gt;; &#x2F;&#x2F;&#x2F;&lt; &lt;#æ³¨é‡Š#&gt;</span><br><span class="line">@property (nonatomic, copy) &lt;#ClassName#&gt; *&lt;#name#&gt;; &#x2F;&#x2F;&#x2F;&lt; &lt;#æ³¨é‡Š#&gt;</span><br><span class="line">@property (nonatomic, weak) id&lt;&lt;#delegateOrDataSouce#&gt;&gt; &lt;#delegateOrDataSouce#&gt;; &#x2F;&#x2F;&#x2F;&lt; &lt;#æ³¨é‡Š#&gt;</span><br><span class="line">@property (nonatomic, weak) &lt;#Class#&gt; *&lt;#name#&gt;; &#x2F;&#x2F;&#x2F;&lt; &lt;#æ³¨é‡Š#&gt;</span><br></pre></td></tr></table></figure><h4 id="å¸¸ç”¨æ³¨é‡Š"><a href="#å¸¸ç”¨æ³¨é‡Š" class="headerlink" title="å¸¸ç”¨æ³¨é‡Š"></a>å¸¸ç”¨æ³¨é‡Š</h4></li><li><p>é¡¶éƒ¨æ³¨é‡Š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;** &lt;#å±æ€§æ³¨é‡Š#&gt; *&#x2F;</span><br></pre></td></tr></table></figure></li><li><p>å³ä¾§æ³¨é‡Š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;&#x2F;&lt; &lt;#æ³¨é‡Š#&gt;</span><br></pre></td></tr></table></figure></li><li><p>ç®€è¿°é¡¶éƒ¨æ³¨é‡Š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;** &lt;#ç®€è¦æè¿°#&gt;</span><br><span class="line"> * &lt;#è¯¦ç»†æè¿°#&gt;</span><br><span class="line"> *&#x2F;</span><br></pre></td></tr></table></figure></li><li><p>Pragma</p></li></ol><ul><li>æœ‰åˆ†å‰²çº¿<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#pragma mark &lt;#mark#&gt;</span><br></pre></td></tr></table></figure></li><li>æ— åˆ†å‰²çº¿<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#pragma mark - &lt;#mark&gt; æˆ– &#x2F;&#x2F; MARK: &lt;#mark#&gt;</span><br></pre></td></tr></table></figure></li></ul><ol start="5"><li><p>Warning(è­¦å‘Š)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#warning &lt;#message#&gt;</span><br></pre></td></tr></table></figure></li><li><p>???(ä¸ç¡®å®š)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; ???: &lt;#???#&gt;</span><br></pre></td></tr></table></figure></li><li><p>!!!(è­¦å‘Š)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; !!!: &lt;#???#&gt;</span><br></pre></td></tr></table></figure></li><li><p>FIXME(éœ€è¦ä¿®æ”¹çš„åœ°æ–¹)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; FIXME: &lt;#Fixè¯¦æƒ…#&gt;</span><br></pre></td></tr></table></figure></li><li><p>å¸¸ç”¨æ–¹æ³•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#pragma mark - é¡µé¢æ§ä»¶é…ç½®</span><br><span class="line">- (void)setupSubViewsProperties &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - é¡µé¢æ§ä»¶å¸ƒå±€</span><br><span class="line">- (void)setupSubViewsConstraint &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>æšä¸¾</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">typedef NS_ENUM(NSInteger, &lt;#TypeName#&gt;) &#123;</span><br><span class="line">    </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">typedef NS_OPTIONS(NSUInteger, &lt;#TypeName#&gt;) &#123;</span><br><span class="line">                </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li><li><p>IFDEBUG</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#if DEBUG</span><br><span class="line">&lt;#TODO#&gt;</span><br><span class="line">#else</span><br><span class="line">&lt;#TODO#&gt;</span><br><span class="line">#endif</span><br></pre></td></tr></table></figure></li><li><p>å¿«æ·åˆå§‹åŒ–UILabel</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">UILabel *l &#x3D; [[UILabel alloc] init];</span><br><span class="line">l.font &#x3D; [UIFont &lt;#font#&gt;];</span><br><span class="line">l.text &#x3D; @&quot;&lt;#conent#&gt;&quot;;</span><br><span class="line">l.textColor &#x3D; [UIColor &lt;#textColor#&gt;];</span><br><span class="line">l.numberOfLines &#x3D; 0;</span><br><span class="line">[&lt;#view#&gt; addSubview:l];</span><br></pre></td></tr></table></figure></li><li><p>å¿«æ·åˆå§‹åŒ–UIButton</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">UIButton *b &#x3D; [UIButton buttonWithType:UIButtonTypeCustom];</span><br><span class="line">b.backgroundColor &#x3D; [UIColor &lt;#backgroundColor#&gt;];</span><br><span class="line">b.titleLabel.font &#x3D; [UIFont &lt;#font#&gt;];</span><br><span class="line">[b setTitle:&lt;#title#&gt; forState:UIControlStateNormal];</span><br><span class="line">[b setTitleColor:[UIColor &lt;#titleColor#&gt;] forState:UIControlStateNormal];</span><br><span class="line">[b setImage:[UIImage imageNamed:&lt;#(nonnull NSString *)#&gt;] forState:UIControlStateNormal]</span><br><span class="line">[b addTarget:self action:@selector(didTapped&lt;#Button Name#&gt;:) forControlEvents:UIControlEventTouchUpInside];</span><br><span class="line">[&lt;#view#&gt; addSubview:b];</span><br></pre></td></tr></table></figure></li><li><p>UIButton ç‚¹å‡»äº‹ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;** &lt;#ButtonName#&gt;ç‚¹å‡»äº‹ä»¶ *&#x2F;</span><br><span class="line">- (void)didTapped&lt;#ButtonName#&gt;:(UIButton *)sender &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>Notificationäº‹ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;** &lt;#Notification Name#&gt;é€šçŸ¥äº‹ä»¶ *&#x2F;</span><br><span class="line">- (void)didReceive&lt;#Notification Name#&gt;:(NSNotification *)notification &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>UIGestureRecognizerè§¦æ‘¸äº‹ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;** &lt;#GestureRecognizer Name#&gt;è§¦æ‘¸äº‹ä»¶ *&#x2F;</span><br><span class="line">- (void)didRecognized&lt;#GestureRecognizer Name#&gt;:(UIGestureRecognizer *)recognizer &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ç»“æŸè¯­"><a href="#ç»“æŸè¯­" class="headerlink" title="ç»“æŸè¯­"></a>ç»“æŸè¯­</h4><p>è¿™ä¹Ÿæ˜¯ä¸ºäº†ä¸ªäººæ„è§ï¼Œå…¶ä»–è¿˜æœ‰å¾ˆå¤šå¯ä»¥åšæˆä»£ç å—çš„ï¼Œä¾‹å¦‚CGDï¼ŒTableViewDataSourceç­‰ç­‰ï¼Œå¸Œæœ›çŸ­çŸ­çš„æ–‡ç« å¯ä»¥è®©ä½ ä»£ç å¯ä»¥å†™çš„æ›´å¥½ã€‚</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> iOSå¼€å‘æŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¼€å‘æŠ€å·§ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScriptä¸åŸç”Ÿäº¤äº’</title>
      <link href="/2020/01/16/JavaScript%E4%B8%8E%E5%8E%9F%E7%94%9F%E4%BA%A4%E4%BA%92/"/>
      <url>/2020/01/16/JavaScript%E4%B8%8E%E5%8E%9F%E7%94%9F%E4%BA%A4%E4%BA%92/</url>
      
        <content type="html"><![CDATA[<p> <img src="https://s2.ax1x.com/2020/01/17/lz5tbT.png" alt="å®ä¾‹æ ·å¼"></p><p>åŸç”Ÿé¡µé¢ä¸HTMLé¡µé¢è¿›è¡Œç›¸äº’è°ƒç”¨<br>æ–¹å¼ | é€‚ç”¨å¯¹è±¡<br>â€”|â€”<br>æ‹¦æˆªURL | <code>UIWebView</code>å’Œ<code>WKWebView</code><br>JavaScriptCore | <code>UIWebView</code><br>MessageHandler | <code>WKWebView</code><br>WebViewJavascriptBridge| <code>UIWebView</code>å’Œ<code>WKWebView</code></p><h3 id="å®ä¾‹HTMLä»£ç "><a href="#å®ä¾‹HTMLä»£ç " class="headerlink" title="å®ä¾‹HTMLä»£ç "></a>å®ä¾‹HTMLä»£ç </h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h2&gt;æŒ‰é’®ç‚¹å‡»&lt;&#x2F;h2&gt;</span><br><span class="line">    &lt;button type&#x3D;&quot;submit&quot; onclick&#x3D;&quot;buttonEvent()&quot; id&#x3D;&quot;submitButto&quot;&gt;æäº¤&lt;&#x2F;button&gt;</span><br><span class="line">    &lt;h2&gt;æ–‡ä»¶ä¸Šä¼ &lt;&#x2F;h2&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;file&quot; &#x2F;&gt;</span><br><span class="line">    &lt;h2&gt;åŸç”Ÿæ³¨å…¥æ•°æ®&lt;&#x2F;h2&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;text&quot; id&#x3D;&quot;textField&quot;&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;button&quot; onclick&#x3D;&quot;getTextEvent()&quot; value&#x3D;&quot;å¼€å§‹æ³¨å…¥&quot;&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">        function loadURL(url) &#123;</span><br><span class="line">            var iFrame;</span><br><span class="line">            iFrame &#x3D; document.createElement(&quot;iframe&quot;);</span><br><span class="line">            iFrame.setAttribute(&quot;src&quot;, url);</span><br><span class="line">            iFrame.setAttribute(&quot;style&quot;, &quot;display:none;&quot;);</span><br><span class="line">            iFrame.setAttribute(&quot;height&quot;, &quot;0px&quot;);</span><br><span class="line">            iFrame.setAttribute(&quot;width&quot;, &quot;0px&quot;);</span><br><span class="line">            iFrame.setAttribute(&quot;frameborder&quot;, &quot;0&quot;);</span><br><span class="line">            document.body.appendChild(iFrame);</span><br><span class="line">            iFrame.parentNode.removeChild(iFrame);</span><br><span class="line">            iFrame &#x3D; null;</span><br><span class="line">        &#125;</span><br><span class="line">        function buttonEvent()&#123;</span><br><span class="line">            loadURL(&quot;&#x2F;buttonEvent&quot;);</span><br><span class="line">            buttonDidPapped();</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        function getTextEvent() &#123;</span><br><span class="line">            loadURL(&quot;&#x2F;getText&quot;);</span><br><span class="line">            getTextButtonDidPapped();</span><br><span class="line">        &#125;</span><br><span class="line">        function getText(text)&#123;</span><br><span class="line">            document.getElementById(&quot;textField&quot;).value &#x3D; text;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;&#x2F;script&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br></pre></td></tr></table></figure><h2 id="æ‹¦æˆªURL"><a href="#æ‹¦æˆªURL" class="headerlink" title="æ‹¦æˆªURL"></a>æ‹¦æˆªURL</h2><h4 id="UIWebView"><a href="#UIWebView" class="headerlink" title="UIWebView"></a>UIWebView</h4><p>éµå¾ª<code>UIWebViewDelegate</code>è°ƒç”¨<code>- (BOOL)webView:(UIWebView *)webView shouldStartLoadWithRequest:(NSURLRequest *)request navigationType:(UIWebViewNavigationType)navigationType</code>æ–¹æ³•ï¼Œåˆ¤æ–­è·å–çš„Urlåœ°å€</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; è°ƒç”¨JS</span><br><span class="line">if ([request.URL.absoluteString hasSuffix:@&quot;buttonEvent&quot;]) &#123;</span><br><span class="line">    UIAlertController *vc &#x3D; [UIAlertControlleralertControllerWithTitle:@&quot;æ¸©é¦¨æç¤º&quot; message:@&quot;ç‚¹å‡»äº†æäº¤æŒ‰é’®&quot; preferredStyle:UIAlertControllerStyleAlert];</span><br><span class="line">        [vc addAction:[UIAlertAction actionWithTitle:@&quot;ç¡®å®š&quot; style:UIAlertActionStyleDefault handler:^(UIAlertAction * _Nonnull action) &#123;</span><br><span class="line">            </span><br><span class="line">    &#125;]];</span><br><span class="line">    [self presentViewController:vc animated:true completion:nil];  </span><br><span class="line">    return NO;</span><br><span class="line">&#125; </span><br><span class="line">&#x2F;&#x2F; æ³¨å…¥æ•°æ®ç»™JS</span><br><span class="line">if ([request.URL.absoluteString hasSuffix:@&quot;getText&quot;]) &#123; </span><br><span class="line">    [webView stringByEvaluatingJavaScriptFromString:@&quot;getText(&#39;å“ˆå“ˆ&#39;)&quot;];</span><br><span class="line">     return NO;</span><br><span class="line">&#125;</span><br><span class="line">return YES;</span><br></pre></td></tr></table></figure><h4 id="WKWebView"><a href="#WKWebView" class="headerlink" title="WKWebView"></a>WKWebView</h4><p>éµå¾ª<code>WKNavigationDelegate</code>è°ƒç”¨<code>- (void)webView:(WKWebView *)webView decidePolicyForNavigationAction:(WKNavigationAction *)navigationAction decisionHandler:(void (^)(WKNavigationActionPolicy))decisionHandler</code>æ–¹æ³•åˆ¤æ–­è·å–çš„åœ°å€</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">NSString *strRequest &#x3D; [navigationAction.request.URL.absoluteString stringByRemovingPercentEncoding];</span><br><span class="line">&#x2F;&#x2F; è°ƒç”¨JS</span><br><span class="line">if ([strRequest hasSuffix:@&quot;buttonEvent&quot;]) &#123;</span><br><span class="line">    UIAlertController *vc &#x3D; [UIAlertController alertControllerWithTitle:@&quot;æ¸©é¦¨æç¤º&quot; message:@&quot;ç‚¹å‡»äº†æäº¤æŒ‰é’®&quot; preferredStyle:UIAlertControllerStyleAlert];</span><br><span class="line">    [vc addAction:[UIAlertAction actionWithTitle:@&quot;ç¡®å®š&quot; style:UIAlertActionStyleDefault handler:^(UIAlertAction * _Nonnull action) &#123;</span><br><span class="line">            </span><br><span class="line">    &#125;]];</span><br><span class="line">    [self presentViewController:vc animated:true completion:nil];</span><br><span class="line">    decisionHandler(WKNavigationActionPolicyCancel);</span><br><span class="line">&#125; else if ([strRequest hasSuffix:@&quot;getText&quot;]) &#123; &#x2F;&#x2F; æ³¨å…¥æ•°æ®ç»™JS</span><br><span class="line">    [webView evaluateJavaScript:@&quot;getText(&#39;å“ˆå“ˆ&#39;)&quot; completionHandler:^(id _Nullable info, NSError * _Nullable error) &#123;</span><br><span class="line">        NSLog(@&quot;Error--%@, info--%@&quot;, error, info);</span><br><span class="line">    &#125;];</span><br><span class="line">    decisionHandler(WKNavigationActionPolicyCancel);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    decisionHandler(WKNavigationActionPolicyAllow);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="JavaScriptCore"><a href="#JavaScriptCore" class="headerlink" title="JavaScriptCore"></a>JavaScriptCore</h2><ol><li>å¯¼å…¥<code>&lt;JavaScriptCore/JavaScriptCore.h&gt;</code></li><li>éµå¾ª<code>&lt;UIWebViewDelegate&gt;</code>å¹¶å®ç°<code>- (void)webViewDidFinishLoad:(UIWebView *)webView</code>æ–¹æ³•ã€‚<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; å¯¹JSContextå¯¹è±¡è¿›è¡Œåˆå§‹åŒ–</span><br><span class="line">JSContext *context &#x3D; [self.webView valueForKeyPath:@&quot;documentView.webView.mainFrame.javaScriptContext&quot;];</span><br><span class="line">&#x2F;&#x2F; éªŒè¯JSContextå¯¹è±¡æ˜¯å¦åˆå§‹åŒ–æˆåŠŸ</span><br><span class="line">context.exceptionHandler &#x3D; ^(JSContext *context, JSValue *exceptionValue)&#123;</span><br><span class="line">    context.exception &#x3D; exceptionValue;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line">&#x2F;&#x2F; è°ƒç”¨JS  </span><br><span class="line">context[@&quot;buttonDidPapped&quot;] &#x3D; ^&#123;</span><br><span class="line">    UIAlertController *vc &#x3D; [UIAlertController alertControllerWithTitle:@&quot;æ¸©é¦¨æç¤º&quot; message:@&quot;ç‚¹å‡»äº†æäº¤æŒ‰é’®&quot; preferredStyle:UIAlertControllerStyleAlert];</span><br><span class="line">    [vc addAction:[UIAlertAction actionWithTitle:@&quot;ç¡®å®š&quot; style:UIAlertActionStyleDefault handler:^(UIAlertAction * _Nonnull action) &#123;</span><br><span class="line">            </span><br><span class="line">    &#125;]];</span><br><span class="line">    [self presentViewController:vc animated:true completion:nil];</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line">&#x2F;&#x2F; æ³¨å…¥æ•°æ®ç»™JS   </span><br><span class="line">context[@&quot;getTextButtonDidPapped&quot;] &#x3D; ^&#123;</span><br><span class="line">    dispatch_async(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">      [self.webView stringByEvaluatingJavaScriptFromString:@&quot;getText(&#39;å“ˆå“ˆ&#39;)&quot;];</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></li></ol><h2 id="MessageHandler"><a href="#MessageHandler" class="headerlink" title="MessageHandler"></a>MessageHandler</h2><ol><li>ä¿®æ”¹jsä¸­çš„æ–¹æ³•ï¼Œ é€šè¿‡<code>window.webkit.messageHandlers</code>+æ“ä½œæ–¹æ³•<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function buttonEvent()&#123;</span><br><span class="line">    window.webkit.messageHandlers.buttonEvent.postMessage(null);</span><br><span class="line">&#125;</span><br><span class="line">        </span><br><span class="line">function getTextEvent() &#123;</span><br><span class="line">    window.webkit.messageHandlers.getTextEvent.postMessage(null);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>éµå¾ª<code>WKScriptMessageHandler</code></li><li>åœ¨<code>- (void)viewWillAppear:(BOOL)animated</code>ä¸­æ·»åŠ <code>scriptMessageHandler</code></li><li>åœ¨<code>- (void)viewWillDisappear:(BOOL)animated</code>ä¸­ç§»é™¤<code>scriptMessageHandler</code></li><li>å®ç°<code>WKScriptMessageHandler</code>æ–¹æ³•<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">- (void)viewWillAppear:(BOOL)animated &#123;</span><br><span class="line">    [super viewWillAppear:animated];</span><br><span class="line">    [self.webView.configuration.userContentController addScriptMessageHandler:self name:@&quot;buttonEvent&quot;];</span><br><span class="line">    [self.webView.configuration.userContentController addScriptMessageHandler:self name:@&quot;getTextEvent&quot;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)viewWillDisappear:(BOOL)animated &#123;</span><br><span class="line">    [super viewWillDisappear:animated];</span><br><span class="line">    [self.webView.configuration.userContentController removeScriptMessageHandlerForName:@&quot;buttonEvent&quot;];</span><br><span class="line">    [self.webView.configuration.userContentController removeScriptMessageHandlerForName:@&quot;getTextEvent&quot;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - WKScriptMessageHandler Method</span><br><span class="line">- (void)userContentController:(WKUserContentController *)userContentController didReceiveScriptMessage:(WKScriptMessage *)message &#123;</span><br><span class="line">    &#x2F;&#x2F; è°ƒç”¨JS</span><br><span class="line">    if ([message.name isEqualToString:@&quot;buttonEvent&quot;]) &#123;</span><br><span class="line">        UIAlertController *vc &#x3D; [UIAlertController alertControllerWithTitle:@&quot;æ¸©é¦¨æç¤º&quot; message:@&quot;ç‚¹å‡»äº†æäº¤æŒ‰é’®&quot; preferredStyle:UIAlertControllerStyleAlert];</span><br><span class="line">        [vc addAction:[UIAlertAction actionWithTitle:@&quot;ç¡®å®š&quot; style:UIAlertActionStyleDefault handler:^(UIAlertAction * _Nonnull action) &#123;</span><br><span class="line">            </span><br><span class="line">        &#125;]];</span><br><span class="line">        [self presentViewController:vc animated:true completion:nil];</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; æ³¨å…¥æ•°æ®ç»™JS</span><br><span class="line">    if  ([message.name isEqualToString:@&quot;getTextEvent&quot;]) &#123;</span><br><span class="line">        [self.webView evaluateJavaScript:@&quot;getText(&#39;å“ˆå“ˆ&#39;)&quot; completionHandler:^(id _Nullable info, NSError * _Nullable error) &#123;</span><br><span class="line">            NSLog(@&quot;Error--%@, info--%@&quot;, error, info);</span><br><span class="line">        &#125;];</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="WebViewJavascriptBridge"><a href="#WebViewJavascriptBridge" class="headerlink" title="WebViewJavascriptBridge"></a>WebViewJavascriptBridge</h2><p>HTMLä»£ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h2&gt;æŒ‰é’®ç‚¹å‡»&lt;&#x2F;h2&gt;</span><br><span class="line">    &lt;input id &#x3D; &#39;submitBtn&#39; type&#x3D;&quot;button&quot; value&#x3D;&quot;æäº¤æŒ‰é’®&quot; onclick&#x3D;&quot;submitClick()&quot;&#x2F;&gt;</span><br><span class="line">    &lt;h2&gt;æ–‡ä»¶é€‰æ‹©&lt;&#x2F;h2&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;file&quot; id&#x3D;&quot;image&quot;&gt;</span><br><span class="line">    &lt;h2&gt;æ³¨å…¥æ•°æ®&lt;&#x2F;h2&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;text&quot; id&#x3D;&quot;getTextField&quot; &#x2F;&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;button&quot; value&#x3D;&quot;å¼€å§‹è·å–&quot; id &#x3D; &#39;startGet&#39; onclick&#x3D;&quot;getTextClick()&quot;&#x2F;&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">        function setupWebViewJavascriptBridge(callback) &#123;</span><br><span class="line">        if (window.WebViewJavascriptBridge) &#123; return callback(WebViewJavascriptBridge); &#125;</span><br><span class="line">        if (window.WVJBCallbacks) &#123; return window.WVJBCallbacks.push(callback); &#125;</span><br><span class="line">        window.WVJBCallbacks &#x3D; [callback];</span><br><span class="line">        var WVJBIframe &#x3D; document.createElement(&#39;iframe&#39;);</span><br><span class="line">        WVJBIframe.style.display &#x3D; &#39;none&#39;;</span><br><span class="line">        WVJBIframe.src &#x3D; &#39;https:&#x2F;&#x2F;__bridge_loaded__&#39;;</span><br><span class="line">        document.documentElement.appendChild(WVJBIframe);</span><br><span class="line">        setTimeout(function() &#123; document.documentElement.removeChild(WVJBIframe) &#125;, 0)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        setupWebViewJavascriptBridge(function(bridge) &#123;</span><br><span class="line"></span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        function submitClick() &#123;</span><br><span class="line">            WebViewJavascriptBridge.callHandler(&#39;submitClick&#39;, null, function(response) &#123;</span><br><span class="line">                </span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        function getTextClick() &#123;</span><br><span class="line">            WebViewJavascriptBridge.callHandler(&#39;getTextClick&#39;, null, function(response) &#123;</span><br><span class="line">                document.getElementById(&quot;getTextField&quot;).value &#x3D; response;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;&#x2F;script&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸‰æ–¹åº“ï¼š<a href="https://github.com/marcuswestin/WebViewJavascriptBridge" target="_blank" rel="noopener">åœ°å€</a></p><ol><li>æ·»åŠ <code>WebViewJavascriptBridge</code>åº“</li><li>å¯¼å…¥å¤´æ–‡ä»¶<code>#import &lt;WebViewJavascriptBridge.h&gt;</code></li><li>å£°æ˜æ–¹æ³•<code>@property WebViewJavascriptBridge* bridge;</code></li><li>ä¸WebViewå…³è”<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">_bridge &#x3D; [WebViewJavascriptBridge bridgeForWebView:self.webView];</span><br><span class="line"></span><br><span class="line">[_bridge setWebViewDelegate:self];</span><br></pre></td></tr></table></figure></li><li>è°ƒç”¨js<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[_bridge registerHandler:@&quot;submitClick&quot; handler:^(id data, WVJBResponseCallback responseCallback) &#123;</span><br><span class="line">        UIAlertController *vc &#x3D; [UIAlertController alertControllerWithTitle:@&quot;æ¸©é¦¨æç¤º&quot; message:@&quot;ç‚¹å‡»äº†æäº¤æŒ‰é’®&quot; preferredStyle:UIAlertControllerStyleAlert];</span><br><span class="line">        [vc addAction:[UIAlertAction actionWithTitle:@&quot;ç¡®å®š&quot; style:UIAlertActionStyleDefault handler:^(UIAlertAction * _Nonnull action) &#123;</span><br><span class="line">            </span><br><span class="line">        &#125;]];</span><br><span class="line">        [self presentViewController:vc animated:true completion:nil];</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure></li><li>æ³¨å…¥æ•°æ®<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[_bridge registerHandler:@&quot;getTextClick&quot; handler:^(id data, WVJBResponseCallback responseCallback) &#123;</span><br><span class="line">        responseCallback(@&quot;å“ˆå“ˆå“ˆ&quot;);</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>iOSè‡ªå®šä¹‰æ§ä»¶-è‡ªå®šä¹‰åˆ†ç±»ä¸‹æ‹‰</title>
      <link href="/2020/01/16/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%88%86%E7%B1%BB%E4%B8%8B%E6%8B%89/"/>
      <url>/2020/01/16/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%88%86%E7%B1%BB%E4%B8%8B%E6%8B%89/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘è‡ªç”±æ—¶é—´æœ‰ç‚¹å¤šï¼Œå°±å¼€å§‹æ’¸æ§ä»¶ã€‚è¿™ä¸ªæ˜¯æˆ‘ä»¬å¸¸ç”¨çš„ä¸€ä¸ªä¸‹æ‹‰åˆ†ç±»æ§ä»¶ï¼Œçœ‹äº†å¾ˆå¤šåˆ«äººå†™çš„ï¼Œéƒ½æ˜¯ç”¨TableViewæˆ–è€…CollectionViewæ•´åˆåœ¨ä¸€èµ·çš„æ„Ÿè§‰è‡ªå®šä¹‰æ€§æ²¡æœ‰é‚£ä¹ˆå¼ºï¼Œæ‰€ä»¥å°±å°è¯•ç”¨æŠŠTableViewå’ŒCollectionViewæ›¿æ¢æˆUIViewControllerã€‚å…¶ä»–åºŸè¯ä¸å¤šè¯´äº†ã€‚</p><h4 id="1ã€-æ¥å£æ–‡ä»¶"><a href="#1ã€-æ¥å£æ–‡ä»¶" class="headerlink" title="1ã€ æ¥å£æ–‡ä»¶"></a>1ã€ æ¥å£æ–‡ä»¶</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;UIKit&#x2F;UIKit.h&gt;</span><br><span class="line"></span><br><span class="line">UIKIT_EXTERN NSString *lzDropViewNotification;</span><br><span class="line"></span><br><span class="line">NS_ASSUME_NONNULL_BEGIN</span><br><span class="line"></span><br><span class="line">@class LZDropView;</span><br><span class="line">@protocol LZDropViewDataSource &lt;NSObject&gt;</span><br><span class="line"></span><br><span class="line">@required</span><br><span class="line"></span><br><span class="line">&#x2F;** Height corresponding to controller display *&#x2F;</span><br><span class="line">- (NSArray&lt;NSNumber *&gt; *)setupCategoryControllerHeightInDropView:(LZDropView *)dropView;</span><br><span class="line">&#x2F;** Title corresponding controller array *&#x2F;</span><br><span class="line">- (NSArray&lt;UIViewController *&gt; *)setupCategoryControllerInDropView:(LZDropView *)dropView;</span><br><span class="line">&#x2F;** Default display of Title Array *&#x2F;</span><br><span class="line">- (NSArray&lt;NSString *&gt; *)setupCategoryTitleNameInDropView:(LZDropView *)dropView;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@protocol LZDropViewDelegate &lt;NSObject&gt;</span><br><span class="line"></span><br><span class="line">&#x2F;** Click the column and select the information. *&#x2F;</span><br><span class="line">- (void)dropView:(LZDropView *)dropView didSelectAtColumn:(NSInteger)column info:(NSString *)info;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@interface LZDropView : UIView</span><br><span class="line">&#x2F;** Simple page configuration *&#x2F;</span><br><span class="line">@property (nonatomic, weak) id &lt;LZDropViewDataSource&gt; dataSorce;</span><br><span class="line">&#x2F;** Click proxy event&lt;##&gt; *&#x2F;</span><br><span class="line">@property (nonatomic, weak) id &lt;LZDropViewDelegate&gt; delegate;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">NS_ASSUME_NONNULL_END</span><br></pre></td></tr></table></figure><h4 id="2ã€-å®ç°æ–‡ä»¶"><a href="#2ã€-å®ç°æ–‡ä»¶" class="headerlink" title="2ã€ å®ç°æ–‡ä»¶"></a>2ã€ å®ç°æ–‡ä»¶</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;LZDropView.h&quot;</span><br><span class="line"></span><br><span class="line">NSString *lzDropViewNotification &#x3D; @&quot;nitification&quot;;</span><br><span class="line"></span><br><span class="line">@interface LZDropView ()</span><br><span class="line"></span><br><span class="line">@property (nonatomic, strong) NSArray&lt;UIViewController *&gt; *controllerArray;</span><br><span class="line">@property (nonatomic, strong) NSArray&lt;NSString *&gt; *titleArray;</span><br><span class="line">@property (nonatomic, strong) UIButton *containerView;</span><br><span class="line">@property (nonatomic, strong) NSArray&lt;NSNumber *&gt; *controllerHeightArray;</span><br><span class="line">@property (nonatomic, strong) NSMutableArray&lt;UIButton *&gt; *buttonArray;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation LZDropView</span><br><span class="line"></span><br><span class="line">#pragma mark - Release memory</span><br><span class="line"></span><br><span class="line">- (void)dealloc &#123;</span><br><span class="line">    [[NSNotificationCenter defaultCenter] removeObserver:self];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - Initialization</span><br><span class="line"></span><br><span class="line">- (instancetype)init &#123;</span><br><span class="line">    self &#x3D; [super init];</span><br><span class="line">    if (self) &#123;</span><br><span class="line">        [[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(notificationAction:) name:lzDropViewNotification object:nil];</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - Draw the page</span><br><span class="line"></span><br><span class="line">- (void)setupTitleButton:(NSArray&lt;NSString *&gt; *)array &#123;</span><br><span class="line">    CGFloat width &#x3D; UIScreen.mainScreen.bounds.size.width &#x2F; array.count;</span><br><span class="line">    self.buttonArray &#x3D; [NSMutableArray array];</span><br><span class="line">    for (NSString *name in array) &#123;</span><br><span class="line">        NSInteger index &#x3D; [array indexOfObject:name];</span><br><span class="line">        UIButton *button &#x3D; [UIButton buttonWithType:UIButtonTypeCustom];</span><br><span class="line">        button.titleLabel.font &#x3D; [UIFont systemFontOfSize:15];</span><br><span class="line">        [button setTitle:[NSString stringWithFormat:@&quot;%@ â–¼&quot;, name] forState:UIControlStateNormal];</span><br><span class="line">        [button setTitle:[NSString stringWithFormat:@&quot;%@ â–²&quot;, name] forState:UIControlStateSelected];</span><br><span class="line">        [button setTitleColor:UIColor.grayColor forState:UIControlStateNormal];</span><br><span class="line">        [button setTitleColor:UIColor.orangeColor forState:UIControlStateSelected];</span><br><span class="line">        button.frame &#x3D; CGRectMake(width * index, 0, width, 45);</span><br><span class="line">        button.tag &#x3D; index + 1000;</span><br><span class="line">        [button addTarget:self action:@selector(buttonTouched:) forControlEvents:UIControlEventTouchUpInside];</span><br><span class="line">        [self addSubview:button];</span><br><span class="line">        [self.buttonArray addObject:button];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - Button click event</span><br><span class="line"></span><br><span class="line">- (void)buttonTouched:(UIButton *)sender &#123;</span><br><span class="line">    if (sender.selected) &#123;</span><br><span class="line">        [self closeControllerView];</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        [self openControllerViewWithButton:sender];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)backButtonTouched:(UIButton *)sender &#123;</span><br><span class="line">    [self closeControllerView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - Notification event</span><br><span class="line"></span><br><span class="line">- (void)notificationAction:(NSNotification *)notification &#123;    </span><br><span class="line">    if (![self.controllerArray containsObject:notification.object]) &#123;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    NSInteger index &#x3D; [self.controllerArray indexOfObject:notification.object];</span><br><span class="line">    UIButton *button &#x3D; self.buttonArray[index];</span><br><span class="line">    [button setTitle:[NSString stringWithFormat:@&quot;%@ â–¼&quot;, notification.userInfo.allValues.firstObject] forState:UIControlStateNormal];</span><br><span class="line">    </span><br><span class="line">    if (self.delegate &amp;&amp; [self.delegate respondsToSelector:@selector(dropView:didSelectAtColumn:info:)]) &#123;</span><br><span class="line">        [self.delegate dropView:self didSelectAtColumn:index info:notification.userInfo.allValues.firstObject];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    [self closeControllerView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - Close all controllers.</span><br><span class="line"></span><br><span class="line">- (void)closeControllerView &#123;</span><br><span class="line">    </span><br><span class="line">    [UIView animateWithDuration:0.8 animations:^&#123;</span><br><span class="line">        self.containerView.alpha &#x3D; 0;</span><br><span class="line">        self.containerView.frame &#x3D; CGRectMake(0, CGRectGetMaxY(self.frame), UIScreen.mainScreen.bounds.size.width, 0);</span><br><span class="line">    &#125; completion:^(BOOL finished) &#123;</span><br><span class="line">        [self.containerView removeFromSuperview];</span><br><span class="line">    &#125;];</span><br><span class="line">    </span><br><span class="line">    for (UIButton *button in self.buttonArray) &#123;</span><br><span class="line">        button.selected &#x3D; false;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - Open the corresponding controller.</span><br><span class="line"></span><br><span class="line">- (void)openControllerViewWithButton:(UIButton *)sender &#123;</span><br><span class="line">    for (UIButton *button in self.buttonArray) &#123;</span><br><span class="line">        button.selected &#x3D; false;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    self.containerView.alpha &#x3D; 1;</span><br><span class="line">    </span><br><span class="line">    for (UIView *view in self.containerView.subviews) &#123;</span><br><span class="line">        [view removeFromSuperview];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    UIViewController *vc &#x3D; self.controllerArray[sender.tag - 1000];</span><br><span class="line">    double vcHeight &#x3D; [self.controllerHeightArray[sender.tag - 1000] doubleValue];</span><br><span class="line">    </span><br><span class="line">    self.containerView.frame &#x3D; CGRectMake(0, CGRectGetMaxY(self.frame), self.frame.size.width, 0);</span><br><span class="line">    vc.view.frame &#x3D; CGRectMake(0, 0, UIScreen.mainScreen.bounds.size.width, 0);</span><br><span class="line">    [self.superview addSubview:self.containerView];</span><br><span class="line">    [self.containerView addSubview:vc.view];</span><br><span class="line">    </span><br><span class="line">    [UIView animateWithDuration:0.6 animations:^&#123;</span><br><span class="line">        self.containerView.frame &#x3D; CGRectMake(0, CGRectGetMaxY(self.frame), self.frame.size.width, UIScreen.mainScreen.bounds.size.height);</span><br><span class="line">        vc.view.frame &#x3D; CGRectMake(0, 0, UIScreen.mainScreen.bounds.size.width, vcHeight);</span><br><span class="line">    &#125; completion:^(BOOL finished) &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;];</span><br><span class="line">    sender.selected &#x3D; true;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - Getter</span><br><span class="line"></span><br><span class="line">- (UIView *)containerView &#123;</span><br><span class="line">    if (!_containerView) &#123;</span><br><span class="line">        _containerView &#x3D; [[UIButton alloc] init];</span><br><span class="line">        _containerView.backgroundColor &#x3D; [UIColor colorWithWhite:0 alpha:0.1];</span><br><span class="line">        [_containerView addTarget:self action:@selector(backButtonTouched:) forControlEvents:UIControlEventTouchUpInside];</span><br><span class="line">    &#125;</span><br><span class="line">    return _containerView;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - Setter</span><br><span class="line"></span><br><span class="line">- (void)setDataSorce:(id&lt;LZDropViewDataSource&gt;)dataSorce &#123;</span><br><span class="line">    _dataSorce &#x3D; dataSorce;</span><br><span class="line">    </span><br><span class="line">    if (self.dataSorce &amp;&amp; [self.dataSorce respondsToSelector:@selector(setupCategoryControllerInDropView:)])&#123;</span><br><span class="line">        self.controllerArray &#x3D; [self.dataSorce setupCategoryControllerInDropView:self];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if (self.dataSorce &amp;&amp; [self.dataSorce respondsToSelector:@selector(setupCategoryTitleNameInDropView:)])&#123;</span><br><span class="line">        self.titleArray &#x3D; [self.dataSorce setupCategoryTitleNameInDropView:self];</span><br><span class="line">        [self setupTitleButton:self.titleArray];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if (self.dataSorce &amp;&amp; [self.dataSorce respondsToSelector:@selector(setupCategoryControllerHeightInDropView:)]) &#123;</span><br><span class="line">        self.controllerHeightArray &#x3D; [self.dataSorce setupCategoryControllerHeightInDropView:self];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if (self.controllerArray.count !&#x3D; self.titleArray.count ||</span><br><span class="line">        self.controllerArray.count !&#x3D; self.controllerHeightArray.count) &#123;</span><br><span class="line">        @throw [NSException exceptionWithName:NSStringFromClass([self class]) reason:@&quot;The number of corresponding arrays is inconsistent.&quot; userInfo:nil];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure><h4 id="ä½¿ç”¨æ–¹å¼"><a href="#ä½¿ç”¨æ–¹å¼" class="headerlink" title="ä½¿ç”¨æ–¹å¼"></a>ä½¿ç”¨æ–¹å¼</h4><p> 1.éµå¾ªåè®®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;LZDropViewDataSource, LZDropViewDelegate&gt;</span><br></pre></td></tr></table></figure><p>2.åˆå§‹åŒ–</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">LZDropView *view     &#x3D; [[LZDropView alloc] init];</span><br><span class="line">    view.dataSorce       &#x3D; self;</span><br><span class="line">    view.delegate        &#x3D; self;</span><br><span class="line">    view.backgroundColor &#x3D; UIColor.whiteColor;</span><br><span class="line">    view.frame           &#x3D; CGRectMake(0, 100, UIScreen.mainScreen.bounds.size.width, 45);</span><br><span class="line">    [self.view addSubview:view];</span><br></pre></td></tr></table></figure><ol start="3"><li>å®ç°ä»£ç†å’Œæ•°æ®æº<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#pragma mark - LZDropViewDataSource</span><br><span class="line"></span><br><span class="line">- (NSArray&lt;UIViewController *&gt; *)setupCategoryControllerInDropView:(LZDropView *)dropView &#123;</span><br><span class="line">    return @[[[TableViewController alloc] init],</span><br><span class="line">             [[TableViewController alloc] init],</span><br><span class="line">             [[TableViewController alloc] init],</span><br><span class="line">             [[TableViewController alloc] init]];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (NSArray&lt;NSString *&gt; *)setupCategoryTitleNameInDropView:(LZDropView *)dropView &#123;</span><br><span class="line">    return @[@&quot;å…¨éƒ¨&quot;,</span><br><span class="line">             @&quot;é™„è¿‘&quot;,</span><br><span class="line">             @&quot;åªèƒ½æ’åº&quot;,</span><br><span class="line">             @&quot;ç­›é€‰&quot;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (NSArray&lt;NSNumber *&gt; *)setupCategoryControllerHeightInDropView:(LZDropView *)dropView &#123;</span><br><span class="line">    return @[[NSNumber numberWithFloat:300],</span><br><span class="line">             [NSNumber numberWithFloat:400],</span><br><span class="line">             [NSNumber numberWithFloat:410],</span><br><span class="line">             [NSNumber numberWithFloat:420]];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - LZDropViewDelegate</span><br><span class="line"></span><br><span class="line">- (void)dropView:(LZDropView *)dropView didSelectAtColumn:(NSInteger)column info:(NSString *)info &#123;</span><br><span class="line">    NSLog(@&quot;%ld---%@&quot;, column, info);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>ç‚¹å‡»controllerä¸­çš„æ•°æ®æ˜¾ç¤ºåœ¨æŒ‰é’®çš„æ ‡é¢˜ä¸­ï¼Œè¿™å› ä¸ºè·¨ç•Œé¢æ˜¾ç¤ºï¼Œæˆ‘æš‚æ—¶æ²¡æœ‰æƒ³åˆ°å¥½çš„åŠæ³•ï¼Œæ‰€ä»¥ä½¿ç”¨å¼ºå¤§çš„é€šçŸ¥ä¼ å€¼ã€‚</li><li>è®°å½•é€‰ä¸­çŠ¶æ€ï¼Œåº”è¯¥æ˜¯æ§åˆ¶å™¨é‡Œé¢çš„æ“ä½œï¼Œè¿™é‡Œå°±æ²¡æœ‰å®ç°<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[NSNotificationCenter defaultCenter] postNotificationName:lzDropViewNotification object:self userInfo:@&#123;@&quot;key&quot;:[NSString stringWithFormat:@&quot;ç¬¬%ldcell&quot;, indexPath.row]&#125;];</span><br></pre></td></tr></table></figure><img src="https://s2.ax1x.com/2020/01/20/1PJLNT.gif" alt="æ•ˆæœå›¾"></li></ol><p>å¦‚æœæœ‰ä»€ä¹ˆä¸å¥½å¦‚æœå»ºè®®çš„åœ°æ–¹ï¼Œè¯·æ‰¹è¯„æŒ‡æ­£ï¼</p>]]></content>
      
      
      <categories>
          
          <category> Objective-C </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è‡ªå®šä¹‰æ§ä»¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iOSè‡ªå®šä¹‰æ§ä»¶-ä¸€ä¸ªç®€æ˜“çš„Combobox</title>
      <link href="/2020/01/16/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-%E4%B8%80%E4%B8%AA%E7%AE%80%E6%98%93%E7%9A%84Combobox/"/>
      <url>/2020/01/16/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-%E4%B8%80%E4%B8%AA%E7%AE%80%E6%98%93%E7%9A%84Combobox/</url>
      
        <content type="html"><![CDATA[<p>ä»£ç ç®€å•æ˜“æ‡‚ï¼Œå±äºè‡ªå·±ç»ƒæ‰‹çš„ä»£ç ï¼Œè¿˜åœ¨å­¦ä¹ ï¼Œå†™çš„ä¸å¥½ï¼Œå¸Œæœ›å‹¿å–·<br>1ã€å¤´æ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;UIKit&#x2F;UIKit.h&gt;</span><br><span class="line"></span><br><span class="line">NS_ASSUME_NONNULL_BEGIN</span><br><span class="line"></span><br><span class="line">typedef NS_ENUM(NSInteger, WDComboBoxControlDirection) &#123;</span><br><span class="line">    WDComboBoxControlDirectionTop,</span><br><span class="line">    WDComboBoxControlDirectionLeading,</span><br><span class="line">    WDComboBoxControlDirectionTrailing,</span><br><span class="line">    WDComboBoxControlDirectionBottom,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">@protocol WDComboBoxControlDataSource &lt;NSObject&gt;</span><br><span class="line">@optional</span><br><span class="line">&#x2F;** &lt; æ•°æ®æ•°ç»„ &gt; *&#x2F;</span><br><span class="line">- (NSArray&lt;NSArray&lt;NSString *&gt; *&gt; *)dataSourceOfColunm;</span><br><span class="line">@required</span><br><span class="line">&#x2F;** &lt; æ ‡é¢˜æ•°ç»„ &gt; *&#x2F;</span><br><span class="line">- (NSArray&lt;NSString *&gt; *)titleOfSection;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@protocol WDComboBoxControlDelegate &lt;NSObject&gt;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> ç‚¹å‡»äº‹ä»¶</span><br><span class="line"> </span><br><span class="line"> @param indexPath indexPath description</span><br><span class="line"> @param title title description</span><br><span class="line"> @param sourceView sourceView description</span><br><span class="line"> *&#x2F;</span><br><span class="line">- (void)selectedAtIndexPath:(NSIndexPath *)indexPath resultTitle:(NSString *)title fromSourceView:(UIView *)sourceView;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@interface WDComboBoxControl : UIView</span><br><span class="line"></span><br><span class="line">@property (nonatomic, weak) id &lt;WDComboBoxControlDataSource&gt; dataSource;</span><br><span class="line">@property (nonatomic, weak) id &lt;WDComboBoxControlDelegate&gt; delegate;</span><br><span class="line">&#x2F;** &lt; èƒŒæ™¯æŒ‰é’®ï¼Œå¯ä»¥å®šä¹‰éœ€è¦çš„å±æ€§ &gt; *&#x2F;</span><br><span class="line">@property (nonatomic, strong) UIButton *backgroundButton;</span><br><span class="line">&#x2F;** &lt; å†…å®¹TableViewï¼Œä¹Ÿå¯ä»¥å®šä¹‰ä¸€äº›å±æ€§ &gt; *&#x2F;</span><br><span class="line">@property (nonatomic, strong) UITableView *tableView;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> åˆå§‹åŒ–æ–¹æ³•</span><br><span class="line"></span><br><span class="line"> @param height æ˜¾ç¤ºå†…å®¹é«˜åº¦</span><br><span class="line"> @param view å‚è€ƒView</span><br><span class="line"> @return return value description</span><br><span class="line"> *&#x2F;</span><br><span class="line">- (instancetype)initViewWithMaxHeight:(CGFloat)height fromView:(UIView *)view showDirection:(WDComboBoxControlDirection)direction;</span><br><span class="line">&#x2F;**</span><br><span class="line"> æ˜¾ç¤ºé¡µé¢</span><br><span class="line"> *&#x2F;</span><br><span class="line">- (void)showInView;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">NS_ASSUME_NONNULL_END</span><br></pre></td></tr></table></figure><p>2ã€å®ç°æ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;WDComboBoxControl.h&quot;</span><br><span class="line"></span><br><span class="line">@interface WDComboBoxControl () &lt;UITableViewDelegate, UITableViewDataSource&gt;</span><br><span class="line"></span><br><span class="line">@property (nonatomic, assign) CGFloat viewHeight;</span><br><span class="line">@property (nonatomic, strong) NSArray&lt;NSArray&lt;NSString *&gt; *&gt; * dataArray;</span><br><span class="line">@property (nonatomic, strong) NSArray&lt;NSString *&gt; * titleArray;</span><br><span class="line">@property (nonatomic, strong) UIView *sourceView;</span><br><span class="line">@property (nonatomic, assign) WDComboBoxControlDirection direction;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation WDComboBoxControl</span><br><span class="line"></span><br><span class="line">#pragma mark &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; åˆå§‹åŒ–é¡µé¢ &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">- (instancetype)initViewWithMaxHeight:(CGFloat)height fromView:(UIView *)view showDirection:(WDComboBoxControlDirection)direction &#123;</span><br><span class="line">    self &#x3D; [super init];</span><br><span class="line">    if (self) &#123;</span><br><span class="line">        _viewHeight &#x3D; height;</span><br><span class="line">        _sourceView &#x3D; view;</span><br><span class="line">        _direction &#x3D; direction;</span><br><span class="line">        [self setupSubViewsPropertys];</span><br><span class="line">        [self setupSubViewsConstraints];</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; æ˜¾ç¤ºé¡µé¢ &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">- (void)showInView &#123;</span><br><span class="line">    self.frame &#x3D; UIScreen.mainScreen.bounds;</span><br><span class="line">    [UIApplication.sharedApplication.delegate.window addSubview:self];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; è®©é¡µé¢æ¶ˆå¤± &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">- (void)dismisssView &#123;</span><br><span class="line">    [self removeFromSuperview];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; è·å–æ•°æ®æº &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">- (void)setDataSource:(id&lt;WDComboBoxControlDataSource&gt;)dataSource &#123;</span><br><span class="line">    _dataSource &#x3D; dataSource;</span><br><span class="line">    if (self.dataSource &amp;&amp; [self.dataSource respondsToSelector:@selector(dataSourceOfColunm)]) &#123;</span><br><span class="line">        self.dataArray &#x3D; [self.dataSource dataSourceOfColunm];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if (self.dataArray &amp;&amp; [self.dataSource respondsToSelector:@selector(titleOfSection)]) &#123;</span><br><span class="line">        self.titleArray &#x3D;  [self.dataSource titleOfSection];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    [self.tableView reloadData];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; Add controls, set properties &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">- (void)setupSubViewsPropertys &#123;</span><br><span class="line">    self.backgroundButton &#x3D; [[UIButton alloc] init];</span><br><span class="line">    self.backgroundButton.backgroundColor &#x3D; UIColor.clearColor;</span><br><span class="line">    [self.backgroundButton addTarget:self action:@selector(dismisssView) forControlEvents:UIControlEventTouchUpInside];</span><br><span class="line">    [self addSubview:self.backgroundButton];</span><br><span class="line">    </span><br><span class="line">    self.tableView &#x3D; [[UITableView alloc] init];</span><br><span class="line">    self.tableView.delegate &#x3D; self;</span><br><span class="line">    self.tableView.dataSource &#x3D; self;</span><br><span class="line">    self.tableView.tableFooterView &#x3D; [[UIView alloc] init];</span><br><span class="line">    self.tableView.layer.borderColor &#x3D; UIColor.lightGrayColor.CGColor;</span><br><span class="line">    self.tableView.layer.borderWidth &#x3D; 0.5;</span><br><span class="line">    self.tableView.estimatedRowHeight &#x3D; 45;</span><br><span class="line">    self.tableView.layer.cornerRadius &#x3D; 5;</span><br><span class="line">    self.tableView.rowHeight &#x3D; UITableViewAutomaticDimension;</span><br><span class="line">    [self addSubview:self.tableView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; Setting control layout constraints &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">- (void)setupSubViewsConstraints &#123;</span><br><span class="line">    self.backgroundButton.frame &#x3D; UIScreen.mainScreen.bounds;</span><br><span class="line">    </span><br><span class="line">    switch (self.direction) &#123;</span><br><span class="line">        case WDComboBoxControlDirectionBottom:&#123;</span><br><span class="line">            self.tableView.frame &#x3D; CGRectMake(CGRectGetMinX(self.sourceView.frame),</span><br><span class="line">                                              CGRectGetMaxY(self.sourceView.frame),</span><br><span class="line">                                              self.sourceView.frame.size.width,</span><br><span class="line">                                              self.viewHeight);</span><br><span class="line">        &#125;</span><br><span class="line">            break;</span><br><span class="line">        case WDComboBoxControlDirectionTop:&#123;</span><br><span class="line">            self.tableView.frame &#x3D; CGRectMake(CGRectGetMinX(self.sourceView.frame),</span><br><span class="line">                                              CGRectGetMaxY(self.sourceView.frame) - self.viewHeight - self.sourceView.frame.size.height,</span><br><span class="line">                                              self.sourceView.frame.size.width,</span><br><span class="line">                                              self.viewHeight);</span><br><span class="line">        &#125;</span><br><span class="line">            break;</span><br><span class="line">        case WDComboBoxControlDirectionLeading:&#123;</span><br><span class="line">            self.tableView.frame &#x3D; CGRectMake(CGRectGetMinX(self.sourceView.frame) - self.sourceView.frame.size.width,</span><br><span class="line">                                              CGRectGetMinY(self.sourceView.frame),</span><br><span class="line">                                              self.sourceView.frame.size.width,</span><br><span class="line">                                              self.viewHeight);</span><br><span class="line">        &#125;</span><br><span class="line">            break;</span><br><span class="line">        case WDComboBoxControlDirectionTrailing:&#123;</span><br><span class="line">            self.tableView.frame &#x3D; CGRectMake(CGRectGetMinX(self.sourceView.frame) + self.sourceView.frame.size.width,</span><br><span class="line">                                              CGRectGetMinY(self.sourceView.frame),</span><br><span class="line">                                              self.sourceView.frame.size.width,</span><br><span class="line">                                              self.viewHeight);</span><br><span class="line">        &#125;</span><br><span class="line">            break;</span><br><span class="line">        default:</span><br><span class="line">            break;</span><br><span class="line">    &#125;    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; UITableViewDelegate, UITableViewDataSource &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">- (NSString *)tableView:(UITableView *)tableView titleForHeaderInSection:(NSInteger)section &#123;</span><br><span class="line">    return self.titleArray[section];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (NSInteger)numberOfSectionsInTableView:(UITableView *)tableView &#123;</span><br><span class="line">    return self.dataArray.count;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section &#123;</span><br><span class="line">    return [self.dataArray[section] count];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath &#123;</span><br><span class="line">    </span><br><span class="line">    UITableViewCell *cell &#x3D; [tableView dequeueReusableCellWithIdentifier:@&quot;cell&quot;];</span><br><span class="line">    if (!cell) &#123;</span><br><span class="line">        cell &#x3D; [[UITableViewCell alloc] initWithStyle:UITableViewCellStyleDefault reuseIdentifier:@&quot;cell&quot;];</span><br><span class="line">    &#125;</span><br><span class="line">    cell.textLabel.text &#x3D; self.dataArray[indexPath.section][indexPath.row];</span><br><span class="line">    cell.textLabel.numberOfLines &#x3D; 0;</span><br><span class="line">    </span><br><span class="line">    return cell;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath &#123;</span><br><span class="line">    if (self.delegate &amp;&amp; [self.delegate respondsToSelector:@selector(selectedAtIndexPath:resultTitle: fromSourceView:)]) &#123;</span><br><span class="line">        [self.delegate selectedAtIndexPath:indexPath resultTitle:self.dataArray[indexPath.section][indexPath.row] fromSourceView:self.sourceView];</span><br><span class="line">        [self dismisssView];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure><p>3ã€ä½¿ç”¨æ–¹æ³•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 1ã€å¯¼å…¥å¤´æ–‡ä»¶</span><br><span class="line">#import &quot;WDComboBoxControl.h&quot;</span><br><span class="line">&#x2F;&#x2F; 2ã€éµå¾ªä»£ç†å’Œæ•°æ®æº</span><br><span class="line">&lt;WDComboBoxControlDataSource, WDComboBoxControlDelegate&gt;</span><br><span class="line">&#x2F;&#x2F; 3ã€å®ç°æ–¹æ³•</span><br><span class="line">#pragma mark &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; WDComBoxControlDataSource &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">- (NSArray&lt;NSString *&gt; *)titleOfSection;</span><br><span class="line">- (NSArray&lt;NSArray&lt;NSString *&gt; *&gt; *)dataSourceOfColunm;</span><br><span class="line"></span><br><span class="line">#pragma mark &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; WDComBoxControlDelegate &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">- (void)selectedAtIndexPath:(NSIndexPath *)indexPath resultTitle:(NSString *)title fromSourceView:(UIView *)sourceView;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; ä¸‹é¢æ˜¯å®ä¾‹ï¼š</span><br><span class="line">@property (nonatomic, strong) UIButton *button;</span><br><span class="line">@property (nonatomic, strong) UIButton *button2;</span><br><span class="line">- (void)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">    &#x2F;&#x2F; Do any additional setup after loading the view.</span><br><span class="line">    </span><br><span class="line">    UIButton *button &#x3D; [[UIButton alloc] init];</span><br><span class="line">    [button setTitleColor:UIColor.blackColor forState:UIControlStateNormal];</span><br><span class="line">    [button addTarget:self action:@selector(buttonShow:) forControlEvents:UIControlEventTouchUpInside];</span><br><span class="line">    [self.view addSubview:button];</span><br><span class="line">    button.layer.borderColor &#x3D; UIColor.lightGrayColor.CGColor;</span><br><span class="line">    button.layer.borderWidth &#x3D; 0.5;</span><br><span class="line">    [button setTitle:@&quot;æŒ‰é’®&quot; forState:UIControlStateNormal];</span><br><span class="line">    [button mas_makeConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class="line">        make.centerX.mas_equalTo(self.view);</span><br><span class="line">        make.top.mas_equalTo(self.wdNavigationBar.mas_bottom);</span><br><span class="line">        make.width.mas_equalTo(300);</span><br><span class="line"></span><br><span class="line">    &#125;];</span><br><span class="line">    self.button &#x3D; button;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    UIButton *button2 &#x3D; [[UIButton alloc] init];</span><br><span class="line">    [button2 setTitleColor:UIColor.blackColor forState:UIControlStateNormal];</span><br><span class="line">    [button2 addTarget:self action:@selector(buttonShow:) forControlEvents:UIControlEventTouchUpInside];</span><br><span class="line">    [self.view addSubview:button2];</span><br><span class="line">    button2.layer.borderColor &#x3D; UIColor.lightGrayColor.CGColor;</span><br><span class="line">    button2.layer.borderWidth &#x3D; 0.5;</span><br><span class="line">    [button2 setTitle:@&quot;æŒ‰é’®2&quot; forState:UIControlStateNormal];</span><br><span class="line">    button2.bounds &#x3D; CGRectMake(0, 0, 300, 50);</span><br><span class="line">    button2.center &#x3D; self.view.center;</span><br><span class="line">    self.button2 &#x3D; button2;</span><br><span class="line">&#125;</span><br><span class="line">- (void)buttonShow:(UIButton *)sender &#123;</span><br><span class="line">    WDComboBoxControl *view &#x3D; [[WDComboBoxControl alloc] initViewWithMaxHeight:400 fromView:sender showDirection:WDComboBoxControlDirectionBottom];</span><br><span class="line">    view.dataSource &#x3D; self;</span><br><span class="line">    view.delegate &#x3D; self;</span><br><span class="line">    view.backgroundButton.backgroundColor &#x3D; [UIColor colorWithWhite:0 alpha:0.3];</span><br><span class="line">    [view showInView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; WDComBoxControlDataSource &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">- (NSArray&lt;NSString *&gt; *)titleOfSection &#123;</span><br><span class="line">    return @[@&quot;å®‰å¾½çœ&quot;, @&quot;æµ™æ±Ÿçœ&quot;, @&quot;æ±Ÿè‹çœ&quot;, @&quot;å®‰å¾½çœ&quot;, @&quot;æµ™æ±Ÿçœ&quot;, @&quot;æ±Ÿè‹çœ&quot;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (NSArray&lt;NSArray&lt;NSString *&gt; *&gt; *)dataSourceOfColunm &#123;</span><br><span class="line">    return @[@[@&quot;åˆè‚¥&quot;, @&quot;èŠœæ¹–&quot;, @&quot;å®‰åº†&quot;],</span><br><span class="line">             @[@&quot;å—äº¬&quot;, @&quot;è‹å·&quot;, @&quot;æ— é”¡&quot;],</span><br><span class="line">             @[@&quot;æ­å·&quot;, @&quot;å®æ³¢&quot;, @&quot;æ¸©å·&quot;],</span><br><span class="line">             @[@&quot;åˆè‚¥&quot;, @&quot;èŠœæ¹–&quot;, @&quot;å®‰åº†&quot;],</span><br><span class="line">             @[@&quot;å—äº¬&quot;, @&quot;è‹å·&quot;, @&quot;æ— é”¡&quot;],</span><br><span class="line">             @[@&quot;æ­å·&quot;, @&quot;å®æ³¢&quot;, @&quot;æ¸©å·&quot;]];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; WDComBoxControlDelegate &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">- (void)selectedAtIndexPath:(NSIndexPath *)indexPath resultTitle:(NSString *)title fromSourceView:(UIView *)sourceView &#123;</span><br><span class="line">    UIButton *sender &#x3D; (UIButton *)sourceView;</span><br><span class="line">    [sender setTitle:title forState:UIControlStateNormal];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4ã€æ•ˆæœå›¾</p><p><img src="https://s2.ax1x.com/2020/01/20/1PYnKA.gif" alt="æ•ˆæœå›¾"></p><p>5ã€Demoåœ°å€ï¼ˆä»£ç éƒ½åœ¨è¿™é‡Œäº†ï¼Œå°±ä¸å¼„ä¸ªDemoäº†ï¼Œè¿™ä¸ªå¯ä»¥è‡ªå®šä¹‰çš„åœ°æ–¹è¿˜æœ‰å¾ˆå¤šï¼ŒTableViewå’ŒèƒŒæ™¯çš„Buttonéƒ½å¯ä»¥ï¼Œéšå¿ƒæ‰€æ¬²å§ï¼ï¼‰</p>]]></content>
      
      
      <categories>
          
          <category> Objective-C </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è‡ªå®šä¹‰æ§ä»¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iOSè‡ªå®šä¹‰æ§ä»¶-å›¾ç‰‡æµè§ˆå™¨</title>
      <link href="/2020/01/16/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-%E5%9B%BE%E7%89%87%E6%B5%8F%E8%A7%88%E5%99%A8/"/>
      <url>/2020/01/16/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-%E5%9B%BE%E7%89%87%E6%B5%8F%E8%A7%88%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<p>ä¸€ç›´æƒ³å†™ä¸€ä¸ªè‡ªå·±çš„å›¾ç‰‡æµè§ˆå™¨ï¼Œä½†æ˜¯è‡ªå·±èƒ½åŠ›åˆä¸æ˜¯å¾ˆå¤Ÿï¼Œæ‰€ä»¥ä¸€ç›´æ‹–è¿™ï¼Œæœ€è¿‘è¶è‡ªå·±æ—¶é—´å……è£•ï¼Œè‡ªå·±ç ”ç©¶äº†ä¸€ä¸‹è¿™æ–¹é¢çš„çŸ¥è¯†ã€‚æ„Ÿè§‰æœ‰ä»¥ä¸‹å‡ ä¸ªéš¾ç‚¹ï¼š</p><ol><li>æ˜¾ç¤ºå’Œæ¶ˆå¤±çš„è½¬åœºåŠ¨ç”»</li><li>æ‰‹åŠ¿æ‹–æ‹½</li><li>å›¾ç‰‡åŠ è½½</li></ol><h2 id="åŠ è½½æ–¹å¼å’Œè½¬åœºåŠ¨ç”»"><a href="#åŠ è½½æ–¹å¼å’Œè½¬åœºåŠ¨ç”»" class="headerlink" title="åŠ è½½æ–¹å¼å’Œè½¬åœºåŠ¨ç”»"></a>åŠ è½½æ–¹å¼å’Œè½¬åœºåŠ¨ç”»</h2><ul><li>é€šè¿‡<code>Controller</code>åŠ è½½ï¼šéœ€è¦ä½¿ç”¨<code>ViewController</code>å®ç°<code>UIViewControllerAnimatedTransitioning</code>å®ç°è½¬åœºæ•ˆæœ</li><li>é€šè¿‡<code>View</code>åŠ è½½ï¼šä½¿ç”¨<code>UIView</code>åŠ¨ç”»è¯•ä¸‹è½¬åœºæ•ˆæœ</li></ul><p>è½¬åœºåŠ¨ç”»å¿…è¦å…ƒç´ </p><ol><li>æ˜¾ç¤ºæ—¶éœ€è¦<code>fromView</code>çš„<code>frame</code></li><li>æ¶ˆå¤±æ—¶éœ€è¦<code>toView</code>çš„<code>frame</code><h4 id="æ˜¾ç¤º"><a href="#æ˜¾ç¤º" class="headerlink" title="æ˜¾ç¤º"></a>æ˜¾ç¤º</h4>é€šè¿‡ä¿®æ”¹å½“å‰éœ€è¦æ˜¾ç¤ºå›¾ç‰‡çš„<code>CollectionViewCell</code>ä¸­<code>ImageView</code>çš„<code>frame</code>ï¼ŒåŒæ—¶ä¿®æ”¹å½“æœŸ<code>View</code>çš„èƒŒæ™¯é¢œè‰²é€æ˜åº¦<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">WDImageCollectionViewCell *cell &#x3D; (WDImageCollectionViewCell *)[self.collectionView cellForItemAtIndexPath:[NSIndexPath indexPathForRow:self.tappedIndex inSection:0]];</span><br><span class="line">CGRect fromFrame                &#x3D; [self.originView convertRect:self.originView.bounds toView:cell.contentView];</span><br><span class="line">cell.imageView.frame            &#x3D; fromFrame;</span><br><span class="line">[UIView animateWithDuration:0.5 animations:^&#123;</span><br><span class="line">    self.backgroundColor &#x3D; [[UIColor alloc] initWithWhite:0 alpha:1];</span><br><span class="line">    cell.imageView.frame &#x3D; cell.contentView.bounds;</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure><h4 id="æ¶ˆå¤±"><a href="#æ¶ˆå¤±" class="headerlink" title="æ¶ˆå¤±"></a>æ¶ˆå¤±</h4>åŸç†ä¸æ˜¾ç¤ºç›¸åŒ<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">CGRect toRect &#x3D; [self.originView convertRect:self.originView.bounds toView:self.window];</span><br><span class="line">[UIView animateWithDuration:0.5 animations:^&#123;</span><br><span class="line">    cell.imageView.clipsToBounds &#x3D; YES;</span><br><span class="line">    cell.imageView.frame         &#x3D; toRect;</span><br><span class="line">    self.backgroundColor         &#x3D; [[UIColor alloc] initWithWhite:0 alpha:0];</span><br><span class="line">&#125; completion:^(BOOL finished) &#123;</span><br><span class="line">    [self removeFromSuperview];</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure><h2 id="æ‹–æ‹½çš„æ‰‹åŠ¿"><a href="#æ‹–æ‹½çš„æ‰‹åŠ¿" class="headerlink" title="æ‹–æ‹½çš„æ‰‹åŠ¿"></a>æ‹–æ‹½çš„æ‰‹åŠ¿</h2>å°†æ‰‹åŠ¿æ·»åŠ åœ¨<code>CollectionViewCell</code>ä¸­<code>ScrollView</code>ä¸Šï¼Œå¹¶éµå¾ª<code>UIGestureRecognizerDelegate</code>åè®®ï¼Œä¸ç„¶ä¼š<code>CollectionView</code>æ— æ³•è¿›è¡Œæ»šåŠ¨æ“ä½œã€‚</li><li>å£°æ˜ä¸€ä¸ªå…¨å±€å±æ€§<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CGPoint firstTouchPoint;</span><br></pre></td></tr></table></figure></li><li>å®ç°ä»£ç†<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#pragma mark - UIGestureRecognizer Delegate Method</span><br><span class="line">- (BOOL)gestureRecognizer:(UIGestureRecognizer *)gestureRecognizer shouldReceiveTouch:(UITouch *)touch &#123;</span><br><span class="line">    firstTouchPoint &#x3D; [touch locationInView:self.window];</span><br><span class="line">    return YES;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (BOOL)gestureRecognizerShouldBegin:(UIGestureRecognizer *)gestureRecognizer &#123;</span><br><span class="line">    CGPoint touchPoint &#x3D; [gestureRecognizer locationInView:self.window];</span><br><span class="line">    CGFloat dirTop &#x3D; firstTouchPoint.y - touchPoint.y;</span><br><span class="line">    if (dirTop &gt; -10 &amp;&amp; dirTop &lt; 10) &#123;</span><br><span class="line">        return NO;</span><br><span class="line">    &#125;</span><br><span class="line">    CGFloat dirLift &#x3D; firstTouchPoint.x - touchPoint.x;</span><br><span class="line">    if (dirLift &gt; -10 &amp;&amp; dirLift &lt; 10 &amp;&amp; self.scrollView.frame.size.height &gt; [[UIScreen mainScreen] bounds].size.height) &#123;</span><br><span class="line">        return NO;</span><br><span class="line">    &#125;</span><br><span class="line">    return YES;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>æ‹–åŠ¨æ‰‹åŠ¿æ“ä½œï¼ŒåŒæ„ä»£ç†ä¼ ç»™<code>View</code></li></ol><ul><li>åè®®æ–¹æ³•<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@class WDImageCollectionViewCell;</span><br><span class="line">@protocol WDImageCollectionViewCellDelegate &lt;NSObject&gt;</span><br><span class="line">- (void)collectionViewCell:(WDImageCollectionViewCell *)cell singleTapActionWithImageUrl:(NSString *)imageUrl;</span><br><span class="line">- (void)collectionViewCell:(WDImageCollectionViewCell *)cell panActionWithPercent:(CGFloat)percent;</span><br><span class="line">- (void)collectionViewCell:(WDImageCollectionViewCell *)cell dimssViewWithImageUrl:(NSString *)imageUrl;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure></li><li>æ‹–åŠ¨æ‰‹åŠ¿æ–¹æ³•<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">#pragma mark - UIGestureRecognizer Target Event</span><br><span class="line">&#x2F;** æ»‘åŠ¨æ‰‹åŠ¿ *&#x2F;</span><br><span class="line">- (void)didRecognizedPanGuesture:(UIPanGestureRecognizer *)pan &#123;</span><br><span class="line">    CGPoint point &#x3D; [pan translationInView:self.window];</span><br><span class="line">    CGFloat scale &#x3D; 1.0 - ABS(point.y) &#x2F; [[UIScreen mainScreen] bounds].size.height;</span><br><span class="line">    switch (pan.state) &#123;</span><br><span class="line">        case UIGestureRecognizerStateBegan: &#123;&#125;</span><br><span class="line">            break;</span><br><span class="line">        case UIGestureRecognizerStateChanged:</span><br><span class="line">        &#123;</span><br><span class="line">            scale &#x3D; MAX(scale, 0);</span><br><span class="line">            CGFloat s &#x3D; MAX(scale, 0.5);</span><br><span class="line">            CGAffineTransform translation &#x3D; CGAffineTransformMakeTranslation(point.x &#x2F; s, point.y &#x2F; s);</span><br><span class="line">            CGAffineTransform translationScale &#x3D; CGAffineTransformMakeScale(s, s);</span><br><span class="line">            self.imageView.transform &#x3D; CGAffineTransformConcat(translation, translationScale);</span><br><span class="line">            &#x2F;&#x2F; ä¼ å‡ºtranslationScaleï¼Œä¿®æ”¹èƒŒæ™¯é¢œè‰²é€æ˜åº¦</span><br><span class="line">            if (self.delegate &amp;&amp; [self.delegate respondsToSelector:@selector(collectionViewCell:panActionWithPercent:)]) &#123;</span><br><span class="line">                [self.delegate collectionViewCell:self panActionWithPercent:scale];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">            break;</span><br><span class="line">        case  UIGestureRecognizerStateCancelled | UIGestureRecognizerStateFailed:</span><br><span class="line">        &#123;</span><br><span class="line">            self.imageView.transform &#x3D; CGAffineTransformIdentity;</span><br><span class="line">            &#x2F;&#x2F; å›å¤åˆå§‹æ ·å¼ï¼Œä¼ å‡ºtranslationScaleï¼Œä¿®æ”¹èƒŒæ™¯é¢œè‰²é€æ˜åº¦</span><br><span class="line">            if (self.delegate &amp;&amp; [self.delegate respondsToSelector:@selector(collectionViewCell:panActionWithPercent:)]) &#123;</span><br><span class="line">                [self.delegate collectionViewCell:self panActionWithPercent:1];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">            break;</span><br><span class="line">        case UIGestureRecognizerStateEnded:</span><br><span class="line">        &#123;</span><br><span class="line">            [UIView animateWithDuration:0.5 animations:^&#123;</span><br><span class="line">                CGAffineTransform transform1 &#x3D; CGAffineTransformMakeTranslation(0,0);</span><br><span class="line">                self.imageView.transform &#x3D; CGAffineTransformScale(transform1, 1, 1);</span><br><span class="line">            &#125;];</span><br><span class="line">            </span><br><span class="line">            &#x2F;&#x2F; å›å¤åˆå§‹æ ·å¼ï¼Œä¼ å‡ºtranslationScaleï¼Œä¿®æ”¹èƒŒæ™¯é¢œè‰²é€æ˜åº¦</span><br><span class="line">            if (self.delegate &amp;&amp; [self.delegate respondsToSelector:@selector(collectionViewCell:panActionWithPercent:)]) &#123;</span><br><span class="line">                [self.delegate collectionViewCell:self panActionWithPercent:scale];</span><br><span class="line">            &#125;</span><br><span class="line">            if (scale &lt; 0.7) &#123;</span><br><span class="line">                &#x2F;&#x2F; æ‹–åŠ¨ç»“æŸï¼Œè®©é¡µé¢æ¶ˆå¤±</span><br><span class="line">                if (self.delegate &amp;&amp; [self.delegate respondsToSelector:@selector(collectionViewCell:dimssViewWithImageUrl:)]) &#123;</span><br><span class="line">                    [self.delegate collectionViewCell:self dimssViewWithImageUrl:self.imageUrl];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                &#x2F;&#x2F; å›å¤åˆå§‹æ ·å¼ï¼Œä¼ å‡ºtranslationScaleï¼Œä¿®æ”¹èƒŒæ™¯é¢œè‰²é€æ˜åº¦</span><br><span class="line">                if (self.delegate &amp;&amp; [self.delegate respondsToSelector:@selector(collectionViewCell:panActionWithPercent:)]) &#123;</span><br><span class="line">                    [self.delegate collectionViewCell:self panActionWithPercent:1];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">            break;</span><br><span class="line">        default:</span><br><span class="line">            break;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å›¾ç‰‡åŠ è½½"><a href="#å›¾ç‰‡åŠ è½½" class="headerlink" title="å›¾ç‰‡åŠ è½½"></a>å›¾ç‰‡åŠ è½½</h2>ä½¿ç”¨<code>SDWebImage</code>è·å–å›¾ç‰‡ï¼Œé€šè¿‡<code>FLAnimatedImageView</code>åŠ è½½<code>gif</code>å›¾<h2 id="Githubåœ°å€"><a href="#Githubåœ°å€" class="headerlink" title="Githubåœ°å€"></a>Githubåœ°å€</h2><a href="https://github.com/wudan-ios/WDImageBrowser.git" target="_blank" rel="noopener">é¡¹ç›®åœ°å€</a><h2 id="æ•ˆæœå›¾"><a href="#æ•ˆæœå›¾" class="headerlink" title="æ•ˆæœå›¾"></a>æ•ˆæœå›¾</h2><img src="https://s2.ax1x.com/2020/01/20/1PaDm9.gif" alt=""></li></ul>]]></content>
      
      
      <categories>
          
          <category> Objective-C </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è‡ªå®šä¹‰æ§ä»¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iOSè‡ªå®šä¹‰æ§ä»¶-æé†’æ¡</title>
      <link href="/2020/01/16/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-%E6%8F%90%E9%86%92%E6%9D%A1/"/>
      <url>/2020/01/16/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-%E6%8F%90%E9%86%92%E6%9D%A1/</url>
      
        <content type="html"><![CDATA[<p>ç®€å•çš„æé†’æ¡ï¼Œä»£ç æ¯”è¾ƒç®€å•ï¼Œä½¿ç”¨å®¹æ˜“ï¼Œä»£ç ä¸­ç›®å‰æä¾›äº†ä¸‰ç§æ˜¾ç¤ºçš„é¢œè‰²ï¼Œé»˜è®¤æ˜¾ç¤ºæ–‡æœ¬å†…å®¹ä¸ºä¸€è¡Œæ–‡å­—ï¼Œé»˜è®¤é«˜åº¦ä¸º20ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±éœ€æ±‚è‡ªå®šä¹‰æ ·å¼ã€‚ä»£ç åŒæ—¶æ”¯æŒObjective-Cå’ŒSwiftï¼Œä½¿ç”¨æ–¹å¼æœ‰ç‚¹ç‚¹å·®åˆ«ï¼Œè¯¦æƒ…çœ‹ä»£ç ã€‚</p><h4 id="æ¥å£æ–‡ä»¶"><a href="#æ¥å£æ–‡ä»¶" class="headerlink" title="æ¥å£æ–‡ä»¶"></a>æ¥å£æ–‡ä»¶</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;UIKit&#x2F;UIKit.h&gt;</span><br><span class="line"></span><br><span class="line">NS_ASSUME_NONNULL_BEGIN</span><br><span class="line"></span><br><span class="line">typedef NS_ENUM(NSInteger, RemindBarStyle) &#123;</span><br><span class="line">    RemindBarStyleInfo, &#x2F;&#x2F; æé†’ â‡ï¸</span><br><span class="line">    RemindBarStyleWarn, &#x2F;&#x2F; è­¦å‘Š âš ï¸</span><br><span class="line">    RemindBarStyleError &#x2F;&#x2F; é”™è¯¯ âŒ</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">typedef NS_ENUM(NSInteger, RemindBarPosition) &#123;</span><br><span class="line">    RemindBarPositionStatusBar,     &#x2F;&#x2F; çŠ¶æ€æ ä¸‹é¢</span><br><span class="line">    RemindBarPositionNavigationBar, &#x2F;&#x2F; å¯¼èˆªæ ä¸‹é¢</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">@interface LZRemindBar : UIView</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> é…ç½®æ˜¾ç¤ºæ ·å¼</span><br><span class="line"></span><br><span class="line"> @param style æ ·å¼</span><br><span class="line"> @param position ä½ç½®</span><br><span class="line"> @param text å†…å®¹</span><br><span class="line"> @return return value description</span><br><span class="line"> *&#x2F;</span><br><span class="line">+ (LZRemindBar *)configurationWithStyle:(RemindBarStyle)style showPosition:(RemindBarPosition)position contentText:(NSString *)text;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> æ˜¾ç¤º å¹¶è®¾ç½®æ˜¾ç¤ºæ—¶é—´</span><br><span class="line"></span><br><span class="line"> @param interval æ˜¾ç¤ºæ—¶é—´</span><br><span class="line"> *&#x2F;</span><br><span class="line">- (void)showBarAfterTimeInterval:(NSTimeInterval)interval;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line">NS_ASSUME_NONNULL_END</span><br></pre></td></tr></table></figure><h4 id="å®ç°æ–‡ä»¶"><a href="#å®ç°æ–‡ä»¶" class="headerlink" title="å®ç°æ–‡ä»¶"></a>å®ç°æ–‡ä»¶</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;LZRemindBar.h&quot;</span><br><span class="line"></span><br><span class="line">#define bar_IsPhoneX  UIApplication.sharedApplication.statusBarFrame.size.height !&#x3D; 20</span><br><span class="line">#define bar_topInterval  bar_IsPhoneX ? UIApplication.sharedApplication.statusBarFrame.size.height : 0</span><br><span class="line"></span><br><span class="line">@interface LZRemindBar ()</span><br><span class="line"></span><br><span class="line">@property (nonatomic, strong) UILabel           *contentLabel; &#x2F;&#x2F;*! æ–‡å­—Label</span><br><span class="line">@property (nonatomic, assign) RemindBarPosition position;      &#x2F;&#x2F;*! æ˜¾ç¤ºä½ç½®</span><br><span class="line">@property (nonatomic, assign) BOOL              isShowing;     &#x2F;&#x2F;*! æ˜¯å¦æ­£åœ¨æ˜¾ç¤º</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation LZRemindBar</span><br><span class="line"></span><br><span class="line">+ (instancetype)remind &#123;</span><br><span class="line">    static dispatch_once_t onceToken;</span><br><span class="line">    static LZRemindBar *remind;</span><br><span class="line">    dispatch_once(&amp;onceToken, ^&#123;</span><br><span class="line">        remind &#x3D; [[LZRemindBar alloc] init];</span><br><span class="line">    &#125;);</span><br><span class="line">    return remind;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (LZRemindBar *)configurationWithStyle:(RemindBarStyle)style showPosition:(RemindBarPosition)position contentText:(NSString *)text &#123;</span><br><span class="line">    </span><br><span class="line">    if ([LZRemindBar remind].isShowing) &#123;</span><br><span class="line">        return [LZRemindBar remind];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    [LZRemindBar remind].contentLabel &#x3D; (&#123;</span><br><span class="line">        UILabel *label &#x3D; [[UILabel alloc] init];</span><br><span class="line">        label.backgroundColor &#x3D; UIColor.clearColor;</span><br><span class="line">        label.numberOfLines &#x3D; 1;</span><br><span class="line">        label.textAlignment &#x3D; NSTextAlignmentCenter;</span><br><span class="line">        label.font &#x3D; [UIFont systemFontOfSize:13];</span><br><span class="line">        label.textColor &#x3D; UIColor.whiteColor;</span><br><span class="line">        [[LZRemindBar remind] addSubview:label];</span><br><span class="line">        label.translatesAutoresizingMaskIntoConstraints &#x3D; false;</span><br><span class="line">        [[label.leadingAnchor constraintEqualToAnchor:[LZRemindBar remind].leadingAnchor] setActive:true];</span><br><span class="line">        [[label.trailingAnchor constraintEqualToAnchor:[LZRemindBar remind].trailingAnchor] setActive:true];</span><br><span class="line">        [[label.topAnchor constraintEqualToAnchor:[LZRemindBar remind].topAnchor] setActive:true];</span><br><span class="line">        [[label.bottomAnchor constraintEqualToAnchor:[LZRemindBar remind].bottomAnchor] setActive:true];</span><br><span class="line">        label.text &#x3D; text;</span><br><span class="line">        label;</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    [LZRemindBar remind].isShowing &#x3D; true;</span><br><span class="line">    [LZRemindBar remind].position  &#x3D; position;</span><br><span class="line">    </span><br><span class="line">    switch (style) &#123;</span><br><span class="line">        case RemindBarStyleInfo:</span><br><span class="line">            [LZRemindBar remind].backgroundColor &#x3D; [UIColor colorWithRed:0 green:166.0&#x2F;255 blue:124.0&#x2F;255 alpha:1];</span><br><span class="line">            break;</span><br><span class="line">        case RemindBarStyleWarn:</span><br><span class="line">            [LZRemindBar remind].backgroundColor &#x3D; UIColor.orangeColor;</span><br><span class="line">            break;</span><br><span class="line">        case RemindBarStyleError:</span><br><span class="line">            [LZRemindBar remind].backgroundColor &#x3D; UIColor.redColor;</span><br><span class="line">            break;</span><br><span class="line">        default:</span><br><span class="line">            break;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if (position &#x3D;&#x3D; RemindBarPositionStatusBar) &#123;</span><br><span class="line">        [[LZRemindBar remind] setupShowStatusBarBottomWithStutus:true];</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        [[LZRemindBar remind] setupShowNavigationBarBottomWithStutus:true];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    return [LZRemindBar remind];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)setupShowStatusBarBottomWithStutus:(BOOL)show &#123;</span><br><span class="line">    if (show) &#123;</span><br><span class="line">        UIApplication.sharedApplication.delegate.window.windowLevel &#x3D; bar_IsPhoneX ? UIWindowLevelNormal : UIWindowLevelAlert;</span><br><span class="line">        self.frame &#x3D; CGRectMake(0, bar_topInterval, UIScreen.mainScreen.bounds.size.width, 0);</span><br><span class="line">        [UIView animateWithDuration:0.5 animations:^&#123;</span><br><span class="line">            self.frame &#x3D; CGRectMake(0, bar_topInterval, UIScreen.mainScreen.bounds.size.width, 20);</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        [UIView animateWithDuration:0.5 animations:^&#123;</span><br><span class="line">            self.frame &#x3D; CGRectMake(0, bar_topInterval, UIScreen.mainScreen.bounds.size.width, 0);</span><br><span class="line">        &#125; completion:^(BOOL finished) &#123;</span><br><span class="line">            UIApplication.sharedApplication.delegate.window.windowLevel &#x3D; UIWindowLevelNormal;</span><br><span class="line">            [self dismissBar];</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)setupShowNavigationBarBottomWithStutus:(BOOL)show &#123;</span><br><span class="line">    if (show) &#123;</span><br><span class="line">        self.frame &#x3D; CGRectMake(0, UIApplication.sharedApplication.statusBarFrame.size.height + 44, UIScreen.mainScreen.bounds.size.width, 0);</span><br><span class="line">        [UIView animateWithDuration:0.5 animations:^&#123;</span><br><span class="line">            self.frame &#x3D; CGRectMake(0, UIApplication.sharedApplication.statusBarFrame.size.height + 44, UIScreen.mainScreen.bounds.size.width, 20);</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        [UIView animateWithDuration:0.5 animations:^&#123;</span><br><span class="line">            self.frame &#x3D; CGRectMake(0, UIApplication.sharedApplication.statusBarFrame.size.height + 44, UIScreen.mainScreen.bounds.size.width, 0);</span><br><span class="line">        &#125; completion:^(BOOL finished) &#123;</span><br><span class="line">            [self dismissBar];</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)showBarAfterTimeInterval:(NSTimeInterval)interval &#123;</span><br><span class="line">    [UIApplication.sharedApplication.delegate.window addSubview:self];</span><br><span class="line">    </span><br><span class="line">    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(interval * NSEC_PER_SEC)), dispatch_get_main_queue(), ^&#123;</span><br><span class="line">        if (self.position &#x3D;&#x3D; RemindBarPositionStatusBar) &#123;</span><br><span class="line">            [self setupShowStatusBarBottomWithStutus:false];</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            [self setupShowNavigationBarBottomWithStutus:false];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)dismissBar &#123;</span><br><span class="line">    self.isShowing &#x3D; false;</span><br><span class="line">    [self.contentLabel removeFromSuperview];</span><br><span class="line">    [self removeFromSuperview];</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure><h4 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;  å‚æ•°RemindBarStyleï¼š æ˜¾ç¤ºæ ·å¼</span><br><span class="line">&#x2F;&#x2F;  å‚æ•°RemindBarPosition: æ˜¾ç¤ºä½ç½® </span><br><span class="line">&#x2F;&#x2F;  å‚æ•°contentText: æ˜¾ç¤ºæ–‡å­—å†…å®¹ </span><br><span class="line">&#x2F;&#x2F;  intervalï¼šæ˜¾ç¤ºæ—¶é—´</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Objc</span><br><span class="line">[[LZRemindBar configurationWithStyle:RemindBarStyleInfo showPosition:RemindBarPositionStatusBar contentText:@&quot;è¿™æ˜¯ä¸€ä¸ªæç¤º&quot;] showBarAfterTimeInterval:1.2];</span><br><span class="line">&#x2F;&#x2F; Swift</span><br><span class="line">LZRemindBar.configuration(with: .info, show: .statusBar, contentText: &quot;æç¤ºæ–‡å­—&quot;).show(afterTimeInterval: 1.2)</span><br></pre></td></tr></table></figure><h4 id="æ•ˆæœå›¾"><a href="#æ•ˆæœå›¾" class="headerlink" title="æ•ˆæœå›¾"></a>æ•ˆæœå›¾</h4><p><img src="https://s2.ax1x.com/2020/01/20/1Paf6e.gif" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> Objective-C </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è‡ªå®šä¹‰æ§ä»¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iOSè‡ªå®šä¹‰æ§ä»¶-å¼€å±å¹¿å‘Š</title>
      <link href="/2020/01/16/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-%E5%BC%80%E5%B1%8F%E5%B9%BF%E5%91%8A/"/>
      <url>/2020/01/16/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-%E5%BC%80%E5%B1%8F%E5%B9%BF%E5%91%8A/</url>
      
        <content type="html"><![CDATA[<p>å¾ˆä¹…æ²¡æœ‰å»å†™åšå®¢äº†ï¼Œæœ€è¿‘ç”±äºå…¬å¸éœ€æ±‚å˜åŒ–ï¼Œéœ€è¦åšä¸€ä¸ªæ–°çš„å¼€å±å¹¿å‘Šçš„é¡µé¢ï¼Œæ‰€ä»¥æˆ‘å°±ç®€å•çš„å»ç ”ç©¶äº†ä¸€ä¸‹ã€‚å…¶ä¸­æ˜¾ç¤ºåˆ†ä¸ºè§†é¢‘å’Œå›¾ç‰‡ï¼Œå…¶ä¸­å›¾ç‰‡ç›¸æ¯”è€Œè¨€å®ç°èµ·æ¥å°±ç®€å•çš„å¤šäº†ã€‚</p><h3 id="å›¾ç‰‡åŠ è½½"><a href="#å›¾ç‰‡åŠ è½½" class="headerlink" title="å›¾ç‰‡åŠ è½½"></a>å›¾ç‰‡åŠ è½½</h3><p>å¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„åŠ è½½å’Œç¼“å­˜ï¼Œä¾‹å¦‚ï¼š<code>SDWebImage</code>æˆ–è€…<code>Kingfisher</code>ã€‚å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ç³»ç»Ÿçš„<code>URLSession</code>ä¸‹è½½åˆ°æœ¬åœ°å†è¿›è¡Œè¯»å–åŠ è½½ã€‚</p><h3 id="è§†é¢‘åŠ è½½"><a href="#è§†é¢‘åŠ è½½" class="headerlink" title="è§†é¢‘åŠ è½½"></a>è§†é¢‘åŠ è½½</h3><p>æˆ‘è¿™è¾¹åˆ©ç”¨çš„å°±<code>URLSession</code>çš„<code>downloadTask</code>è¿›è¡Œä¸‹è½½åˆ°æœ¬åœ°å†è¿›è¡Œæ’­æ”¾çš„ã€‚</p><h3 id="è§†é¢‘ä¸‹è½½çš„ä»£ç "><a href="#è§†é¢‘ä¸‹è½½çš„ä»£ç " class="headerlink" title="è§†é¢‘ä¸‹è½½çš„ä»£ç "></a>è§†é¢‘ä¸‹è½½çš„ä»£ç </h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line">import UIKit</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;&#x2F; ä¿å­˜URLåœ°å€è¿›è¡ŒåŒ¹é…</span><br><span class="line">fileprivate let kURL_DOWNLOAD_PATH &#x3D; &quot;WDDownloadUrlPath&quot;</span><br><span class="line">&#x2F;&#x2F;&#x2F; ä¿å­˜è·¯å¾„</span><br><span class="line">fileprivate let kDOCUMENTS_PATH &#x3D; NSHomeDirectory() + &quot;&#x2F;Documents&#x2F;Advertisement.mp4&quot;</span><br><span class="line"></span><br><span class="line">fileprivate class UserDefaultsTools &#123;</span><br><span class="line">    &#x2F;&#x2F; è®¾ç½®åœ°å€</span><br><span class="line">    static func wd_set(value: String) &#123;</span><br><span class="line">        UserDefaults.standard.setValue(value, forKey: kURL_DOWNLOAD_PATH)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; è¯»å–åœ°å€</span><br><span class="line">    static func wd_get() -&gt; String &#123;</span><br><span class="line">        return UserDefaults.standard.object(forKey: kURL_DOWNLOAD_PATH) as? String ?? &quot;&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fileprivate class FileManagerTools &#123;</span><br><span class="line">    &#x2F;&#x2F; æ˜¯å¦å­˜åœ¨æ–‡ä»¶</span><br><span class="line">    static func isExistFile(atPath: String) -&gt; Bool &#123;</span><br><span class="line">        return FileManager.default.fileExists(atPath: atPath)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; ç§»åŠ¨æ–‡ä»¶</span><br><span class="line">    static func moveFile(fromPath: String, toPath: String) &#123;</span><br><span class="line">        try! FileManager.default.moveItem(atPath: fromPath, toPath: toPath)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; åˆ é™¤æ–‡ä»¶</span><br><span class="line">    static func deleteFile(atPath: String) &#123;</span><br><span class="line">        try! FileManager.default.removeItem(atPath: atPath)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; æ–‡ä»¶å¤§å°</span><br><span class="line">    static func fileSize(atPath: String) -&gt; Float &#123;</span><br><span class="line">        if self.isExistFile(atPath: kDOCUMENTS_PATH) &#123;</span><br><span class="line">            let attributes &#x3D; try! FileManager.default.attributesOfItem(atPath: atPath)</span><br><span class="line">            let size &#x3D; attributes[FileAttributeKey.size] as! Int</span><br><span class="line">            return Float(size)</span><br><span class="line">        &#125;</span><br><span class="line">        return 0</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class WDLaunchADDownloader: NSObject &#123;</span><br><span class="line">    &#x2F;&#x2F;&#x2F; ä¸‹è½½è§†é¢‘çš„è·¯å¾„</span><br><span class="line">    private var downloadUrlPath: String &#x3D; &quot;&quot;</span><br><span class="line">    &#x2F;&#x2F;&#x2F; ä¸‹è½½çš„Session</span><br><span class="line">    private var session: URLSession!</span><br><span class="line">    &#x2F;&#x2F;&#x2F; ä¸‹è½½çš„ä»»åŠ¡</span><br><span class="line">    private var downloadTask: URLSessionDownloadTask!</span><br><span class="line">    &#x2F;&#x2F;&#x2F; è®°å½•æ˜¯å¦åœ¨ä¸‹è½½</span><br><span class="line">    private var downloading: Bool &#x3D; false</span><br><span class="line">    &#x2F;&#x2F;&#x2F; è®°å½•å·²ä¸‹è½½çš„æ•°æ®</span><br><span class="line">    private var downloadData: Data?</span><br><span class="line"></span><br><span class="line">    &#x2F;* ä¸‹è½½è§†é¢‘ *&#x2F;</span><br><span class="line">    static func downloadVideo(path: String) -&gt; String &#123;</span><br><span class="line">        let downloader &#x3D; WDLaunchADDownloader()</span><br><span class="line">        return downloader.setupDownload(with: path)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    private func setupDownload(with path: String) -&gt; String &#123;</span><br><span class="line">        downloadUrlPath &#x3D; path &#x2F;&#x2F; è·å–è§†é¢‘æ’­æ”¾ç½‘ç»œè·¯å¾„</span><br><span class="line"></span><br><span class="line">        let configuration &#x3D; URLSessionConfiguration.default</span><br><span class="line">        configuration.isDiscretionary &#x3D; true</span><br><span class="line">        session &#x3D; URLSession(configuration: configuration, delegate: self, delegateQueue: nil)</span><br><span class="line">        </span><br><span class="line">        let request &#x3D; URLRequest.init(url: URL(string: path)!)</span><br><span class="line">        downloadTask &#x3D; session.downloadTask(with: request)</span><br><span class="line">        </span><br><span class="line">        &#x2F;&#x2F; ç½‘å€ä¸åŒï¼Œåˆ é™¤åŸæœ¬çš„ï¼Œä¸‹è½½æœ€æ–°çš„</span><br><span class="line">        if UserDefaultsTools.wd_get() !&#x3D; path &#123;</span><br><span class="line">            UserDefaultsTools.wd_set(value: &quot;&quot;)</span><br><span class="line">            if FileManagerTools.isExistFile(atPath: kDOCUMENTS_PATH) &#123;</span><br><span class="line">                FileManagerTools.deleteFile(atPath: kDOCUMENTS_PATH)</span><br><span class="line">            &#125;</span><br><span class="line">            &#x2F;&#x2F; å¼€å§‹ä¸‹è½½</span><br><span class="line">            startDownload()</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        &#x2F;&#x2F; å¦‚æœå·²å­˜åœ¨æ–‡ä»¶ å°±åŠ è½½è§†é¢‘ å¦åˆ™åŠ è½½å›¾ç‰‡</span><br><span class="line">        if FileManagerTools.isExistFile(atPath: kDOCUMENTS_PATH) &#123;</span><br><span class="line">            return kDOCUMENTS_PATH</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            return &quot;&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; MARK: - å¼€å§‹ä¸‹è½½</span><br><span class="line">    private func startDownload() &#123;</span><br><span class="line">        downloading &#x3D; true</span><br><span class="line">        downloadTask.resume()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; MARK: - æš‚åœä¸‹è½½</span><br><span class="line">    private func pauseDownload() &#123;</span><br><span class="line">        downloadTask.cancel &#123; [weak self] (resumeData) in</span><br><span class="line">            self?.downloadData &#x3D; resumeData</span><br><span class="line">        &#125;</span><br><span class="line">        downloading &#x3D; false</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">extension WDLaunchADDownloader: URLSessionDownloadDelegate &#123;</span><br><span class="line">    &#x2F;&#x2F; ä¸‹è½½ä»£ç†æ–¹æ³•ï¼Œä¸‹è½½ç»“æŸ</span><br><span class="line">    func urlSession(_ session: URLSession, downloadTask: URLSessionDownloadTask, didFinishDownloadingTo location: URL) &#123;</span><br><span class="line">        let locationPath &#x3D; location.path</span><br><span class="line">        FileManagerTools.moveFile(fromPath: locationPath, toPath: kDOCUMENTS_PATH)</span><br><span class="line">        UserDefaultsTools.wd_set(value: downloadUrlPath)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; ä¸‹è½½ä»£ç†æ–¹æ³•ï¼Œç›‘å¬ä¸‹è½½è¿›åº¦</span><br><span class="line">    func urlSession(_ session: URLSession, downloadTask: URLSessionDownloadTask, didWriteData bytesWritten: Int64, totalBytesWritten: Int64, totalBytesExpectedToWrite: Int64) &#123;</span><br><span class="line">        if FileManagerTools.fileSize(atPath: kDOCUMENTS_PATH) &gt;&#x3D; Float(totalBytesExpectedToWrite) &#123;</span><br><span class="line">            pauseDownload()</span><br><span class="line">            return</span><br><span class="line">        &#125;</span><br><span class="line">        print(String(format: &quot;ğŸ‰ Advertising Video Download Progress: %0.2f&quot;, Float(totalBytesWritten) &#x2F; Float(totalBytesExpectedToWrite)))</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; å¦‚æœä¸‹è½½å¤±è´¥äº†</span><br><span class="line">    func urlSession(_ session: URLSession, task: URLSessionTask, didCompleteWithError error: Error?) &#123;</span><br><span class="line">        if error !&#x3D; nil &#123;</span><br><span class="line">            UserDefaultsTools.wd_set(value: &quot;&quot;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è§†é¢‘æ’­æ”¾ä»£ç "><a href="#è§†é¢‘æ’­æ”¾ä»£ç " class="headerlink" title="è§†é¢‘æ’­æ”¾ä»£ç "></a>è§†é¢‘æ’­æ”¾ä»£ç </h3><p>å…¶ä¸­è·å–åˆ°åŠ è½½çš„ç§ç±»(å›¾ç‰‡ã€è§†é¢‘)ï¼Œé¡µé¢è¿›è¡Œç›¸åº”çš„å¸ƒå±€</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">import UIKit</span><br><span class="line">import AVFoundation</span><br><span class="line"></span><br><span class="line">class WDLaunchADPlayerManager: NSObject &#123;</span><br><span class="line">    </span><br><span class="line">    static let share &#x3D; WDLaunchADPlayerManager()</span><br><span class="line">    </span><br><span class="line">    var playerItem: AVPlayerItem!</span><br><span class="line">    var player: AVPlayer!</span><br><span class="line">    var playerLayer: CALayer!</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; å¼€å§‹æ’­æ”¾ &lt;æ’­æ”¾ä¸‹è½½å¥½å†æœ¬åœ°æ–‡ä»¶å¤¹é‡Œé¢çš„è§†é¢‘æ–‡ä»¶&gt;</span><br><span class="line">    func playItem(with url: String) &#123;</span><br><span class="line">        playerItem &#x3D; AVPlayerItem(url: URL(fileURLWithPath: url))</span><br><span class="line">        player &#x3D; AVPlayer(playerItem: playerItem)</span><br><span class="line">        playerLayer &#x3D; AVPlayerLayer(player: player)</span><br><span class="line">        player.usesExternalPlaybackWhileExternalScreenIsActive &#x3D; true</span><br><span class="line">        player.play()</span><br><span class="line">        player.volume &#x3D; 0 &#x2F;&#x2F; é™éŸ³æ’­æ”¾</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; åœæ­¢æ’­æ”¾</span><br><span class="line">    func stopPlay() &#123;</span><br><span class="line">        player.pause()</span><br><span class="line">        player &#x3D; nil</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é¡µé¢æ˜¾ç¤º"><a href="#é¡µé¢æ˜¾ç¤º" class="headerlink" title="é¡µé¢æ˜¾ç¤º"></a>é¡µé¢æ˜¾ç¤º</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">import UIKit</span><br><span class="line">import SDWebImage</span><br><span class="line"></span><br><span class="line">class WDLaunchADController: UIViewController &#123;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F;&#x2F; æ’­æ”¾å™¨çš„layerå±‚</span><br><span class="line">    private var playerLayer: CALayer &#x3D; CALayer()</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F;&#x2F; å›¾ç‰‡åŠ è½½</span><br><span class="line">    private let imageView: UIImageView &#x3D; &#123;</span><br><span class="line">        let imageV &#x3D; UIImageView()</span><br><span class="line">        imageV.contentMode &#x3D; .scaleAspectFill</span><br><span class="line">        imageV.clipsToBounds &#x3D; true</span><br><span class="line">        return imageV</span><br><span class="line">    &#125;()</span><br><span class="line">    </span><br><span class="line">    deinit &#123;</span><br><span class="line">        print(&quot;&#x3D;&#x3D;[\(type(of: self))] deinit&#x3D;&#x3D;&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    override func viewDidLoad() &#123;</span><br><span class="line">        super.viewDidLoad()</span><br><span class="line">        view.backgroundColor &#x3D; .white</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; é…ç½®é¡µé¢æ ·å¼</span><br><span class="line">    func setup(with adType: WDLaunchADType, url: String, bottomLogoView: UIView? &#x3D; UIView(), bottomLogoViewHeight: CGFloat &#x3D; 180) &#123;</span><br><span class="line">        if adType &#x3D;&#x3D; .image &#123;</span><br><span class="line">            imageView.isUserInteractionEnabled &#x3D; true</span><br><span class="line">            view.addSubview(imageView)</span><br><span class="line">            imageView.sd_setImage(with: URL(string: url), completed: nil)</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            WDLaunchADPlayerManager.share.playItem(with: url)</span><br><span class="line">            if let layer &#x3D; WDLaunchADPlayerManager.share.playerLayer &#123;</span><br><span class="line">                self.view.layer.addSublayer(layer)</span><br><span class="line">                playerLayer &#x3D; layer</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        if let logoView &#x3D; bottomLogoView &#123;</span><br><span class="line">            view.addSubview(logoView)</span><br><span class="line">            logoView.frame &#x3D; CGRect(x: 0, y: view.frame.height - bottomLogoViewHeight, width: view.frame.width, height: bottomLogoViewHeight)</span><br><span class="line">            if adType &#x3D;&#x3D; .image &#123;</span><br><span class="line">                imageView.frame &#x3D; CGRect(x: 0, y: 0, width: view.frame.width, height: view.frame.height - bottomLogoViewHeight)</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                playerLayer.frame &#x3D; CGRect(x: 0, y: 0, width: view.frame.width, height: view.frame.height)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            if adType &#x3D;&#x3D; .image &#123;</span><br><span class="line">                imageView.frame &#x3D; view.bounds</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                playerLayer.frame &#x3D; view.bounds</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">    override var shouldAutorotate: Bool &#123;</span><br><span class="line">        return false</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    override var prefersHomeIndicatorAutoHidden: Bool &#123;</span><br><span class="line">        return false</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åŠ è½½æ§åˆ¶ä»£ç "><a href="#åŠ è½½æ§åˆ¶ä»£ç " class="headerlink" title="åŠ è½½æ§åˆ¶ä»£ç "></a>åŠ è½½æ§åˆ¶ä»£ç </h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br></pre></td><td class="code"><pre><span class="line">import UIKit</span><br><span class="line"></span><br><span class="line">enum WDLaunchADType &#123;</span><br><span class="line">    case image</span><br><span class="line">    case video</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;&#x2F; æ˜¯å¦æ˜¯åˆ˜æµ·å±ç³»åˆ—</span><br><span class="line">var kIS_IPHONEX: Bool &#123;</span><br><span class="line">    var iPhoneX &#x3D; false</span><br><span class="line">    if UIDevice.current.userInterfaceIdiom !&#x3D; .phone &#123;</span><br><span class="line">        return iPhoneX</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if #available(iOS 11.0, *) &#123;</span><br><span class="line">        if let mainWindow &#x3D; UIApplication.shared.delegate?.window &#123;</span><br><span class="line">            if (mainWindow?.safeAreaInsets.bottom)! &gt; CGFloat(0.0) &#123;</span><br><span class="line">                iPhoneX &#x3D; true</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return iPhoneX</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;&#x2F; çŠ¶æ€æ é«˜åº¦</span><br><span class="line">var kSTATUS_HEIGHT: CGFloat &#123;</span><br><span class="line">    return kIS_IPHONEX ? UIApplication.shared.statusBarFrame.height : 22</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; MARK: - Main</span><br><span class="line">class WDLaunchAD: NSObject &#123;</span><br><span class="line">    &#x2F;&#x2F; MARK: Public</span><br><span class="line">    &#x2F;&#x2F;&#x2F; é™æ€æ–¹æ³•</span><br><span class="line">    &#x2F;&#x2F;&#x2F;</span><br><span class="line">    &#x2F;&#x2F;&#x2F; - Parameters:</span><br><span class="line">    &#x2F;&#x2F;&#x2F;   - adType: å¹¿å‘Šç±»å‹ &#96;å›¾ç‰‡&#96; &#96;è§†é¢‘&lt;æ— å£°éŸ³&gt;&#96;</span><br><span class="line">    &#x2F;&#x2F;&#x2F;   - url: å¹¿å‘Šåœ°å€</span><br><span class="line">    &#x2F;&#x2F;&#x2F;   - durition: æ˜¾ç¤ºæ—¶é—´</span><br><span class="line">    &#x2F;&#x2F;&#x2F;   - bottomView: åº•éƒ¨è§†å›¾</span><br><span class="line">    &#x2F;&#x2F;&#x2F;   - buttomViewHeight: åº•éƒ¨è§†å›¾é«˜åº¦</span><br><span class="line">    &#x2F;&#x2F;&#x2F;   - clickBlock: å¹¿å‘Šç‚¹å‡»äº‹ä»¶å›è°ƒ</span><br><span class="line">    static func setup(with adType: WDLaunchADType &#x3D; .image,</span><br><span class="line">                      url: String, durition: Int,</span><br><span class="line">                      bottomView: UIView? &#x3D; UIView(),</span><br><span class="line">                      buttomViewHeight: CGFloat &#x3D; 0,</span><br><span class="line">                      clickBlock: @escaping (() -&gt; Void)) &#123;</span><br><span class="line">        </span><br><span class="line">        let manager &#x3D; WDLaunchAD()</span><br><span class="line">        manager.show(with: adType, url: url, durition: durition, bottomView: bottomView, buttomViewHeight: buttomViewHeight ,clickBlock: clickBlock)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; MARK: Private</span><br><span class="line">    &#x2F;&#x2F;&#x2F; é¡µé¢æ˜¾ç¤ºçš„windowæ ¹æ§åˆ¶å™¨ï¼Œé™¤äº†å€’è®¡æ—¶æŒ‰é’®ï¼Œå…¶ä»–å…ƒç´ åœ¨æ§åˆ¶å™¨ä¸­é…ç½®</span><br><span class="line">    private let wdLaunchADViewController &#x3D; WDLaunchADController()</span><br><span class="line">    &#x2F;&#x2F;&#x2F; æ˜¾ç¤ºçš„æ—¶é—´</span><br><span class="line">    private var timerInterval: Int &#x3D; 0</span><br><span class="line">    &#x2F;&#x2F;&#x2F; å®šæ—¶å™¨</span><br><span class="line">    private var timer: Timer?</span><br><span class="line">    &#x2F;&#x2F;&#x2F; ç‚¹å‡»äº‹ä»¶å›è°ƒ</span><br><span class="line">    private var clickBlockHandle: (() -&gt; Void)?</span><br><span class="line">    &#x2F;&#x2F;&#x2F; é¡µé¢æ˜¾ç¤ºçš„window</span><br><span class="line">    private let window: UIWindow &#x3D; &#123;</span><br><span class="line">        let window &#x3D; UIWindow.init(frame: UIScreen.main.bounds)</span><br><span class="line">        window.rootViewController?.view.backgroundColor &#x3D; .black</span><br><span class="line">        window.rootViewController?.view.isUserInteractionEnabled &#x3D; false</span><br><span class="line">        window.windowLevel &#x3D; UIWindow.Level.statusBar + 1</span><br><span class="line">        window.isHidden &#x3D; false</span><br><span class="line">        window.alpha &#x3D; 1</span><br><span class="line">        return window</span><br><span class="line">    &#125;()</span><br><span class="line">    &#x2F;&#x2F;&#x2F; å€’è®¡æ—¶æŒ‰é’®</span><br><span class="line">    private let timeButton: UIButton &#x3D; &#123;</span><br><span class="line">        let button &#x3D; UIButton(type: .custom)</span><br><span class="line">        button.backgroundColor &#x3D; UIColor(white: 0, alpha: 0.5)</span><br><span class="line">        button.setTitleColor(.white, for: .normal)</span><br><span class="line">        button.titleLabel?.font &#x3D; UIFont.systemFont(ofSize: 15)</span><br><span class="line">        return button</span><br><span class="line">    &#125;()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; MARK: - é¡µé¢åˆå§‹åŒ–ä¸é”€æ¯</span><br><span class="line">fileprivate extension WDLaunchAD &#123;</span><br><span class="line">    &#x2F;&#x2F; æ§åˆ¶å™¨åˆå§‹åŒ–é¡µé¢</span><br><span class="line">    func show(with adType: WDLaunchADType, url: String, durition: Int, bottomView: UIView?, buttomViewHeight: CGFloat, clickBlock: @escaping (() -&gt; Void)) &#123;</span><br><span class="line">        clickBlockHandle &#x3D; clickBlock</span><br><span class="line">        timerInterval &#x3D; durition</span><br><span class="line">        window.rootViewController &#x3D; wdLaunchADViewController</span><br><span class="line">        wdLaunchADViewController.view.addGestureRecognizer(UITapGestureRecognizer.init(target: self, action: #selector(adGuestureTargetAction)))</span><br><span class="line">        wdLaunchADViewController.setup(with: adType, url: url, bottomLogoView: bottomView, bottomLogoViewHeight: buttomViewHeight)</span><br><span class="line">        addTimeButton()</span><br><span class="line">        </span><br><span class="line">        &#x2F;&#x2F; å¼€å§‹å€’è®¡æ—¶</span><br><span class="line">        DispatchQueue.main.asyncAfter(deadline: .now() + 1) &#123;</span><br><span class="line">            self.timer &#x3D; Timer.scheduledTimer(timeInterval: 1, target: self, selector: #selector(self.timerDown(timer:)), userInfo: nil, repeats: true)</span><br><span class="line">            if let timer &#x3D; self.timer &#123;</span><br><span class="line">                timer.fire()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; ç§»é™¤å®šæ—¶å™¨ä¸è§†å›¾</span><br><span class="line">    func removeWindow() &#123;</span><br><span class="line">        &#x2F;&#x2F; åœæ­¢æ’­æ”¾è§†é¢‘</span><br><span class="line">        if WDLaunchADPlayerManager.share.player !&#x3D; nil  &#123;</span><br><span class="line">            WDLaunchADPlayerManager.share.stopPlay()</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        &#x2F;&#x2F; åœæ­¢å€’è®¡æ—¶å¹¶ç§»é™¤</span><br><span class="line">        if let timer &#x3D; timer &#123;</span><br><span class="line">            timer.invalidate()</span><br><span class="line">        &#125;</span><br><span class="line">        timer &#x3D; nil</span><br><span class="line">        </span><br><span class="line">        &#x2F;&#x2F; ç§»é™¤å½“å‰è§†å›¾</span><br><span class="line">        UIView.transition(with: window, duration: 0.8, options: UIView.AnimationOptions.curveEaseOut, animations: &#123;</span><br><span class="line">            self.window.alpha &#x3D; 0;</span><br><span class="line">        &#125;) &#123; (finished) in</span><br><span class="line">            self.window.rootViewController &#x3D; nil</span><br><span class="line">            self.window.removeFromSuperview()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; MARK: - é¡µé¢æ§ä»¶é…ç½®</span><br><span class="line">private extension WDLaunchAD &#123;</span><br><span class="line">    &#x2F;&#x2F; é…ç½®æ—¶é—´æŒ‰é’®</span><br><span class="line">    func addTimeButton() &#123;</span><br><span class="line">        timeButton.setTitle(&quot;   è·³è¿‡ \(timerInterval)   &quot;, for: .normal)</span><br><span class="line">        timeButton.addTarget(self, action: #selector(buttonTargetAction(sender:)), for: .touchUpInside)</span><br><span class="line">        window.addSubview(timeButton)</span><br><span class="line">        timeButton.translatesAutoresizingMaskIntoConstraints &#x3D; false</span><br><span class="line">        window.addConstraints([</span><br><span class="line">            NSLayoutConstraint(item: timeButton, attribute: .trailing, relatedBy: .equal, toItem: window, attribute: .trailing, multiplier: 1, constant: -15),</span><br><span class="line">            NSLayoutConstraint(item: timeButton, attribute: .top, relatedBy: .equal, toItem: window, attribute: .top, multiplier: 1, constant: kSTATUS_HEIGHT),</span><br><span class="line">        ])</span><br><span class="line">        timeButton.layoutIfNeeded()</span><br><span class="line">        timeButton.layer.cornerRadius &#x3D; timeButton.frame.height &#x2F; 2.0</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; MARK: - å€’è®¡æ—¶ä¸å€’è®¡æ—¶ç‚¹å‡»äº‹ä»¶</span><br><span class="line">@objc private extension WDLaunchAD &#123;</span><br><span class="line">    &#x2F;&#x2F; å€’è®¡æ—¶</span><br><span class="line">    func timerDown(timer: Timer) &#123;</span><br><span class="line">        timerInterval -&#x3D; 1</span><br><span class="line">        timeButton.setTitle(&quot;   è·³è¿‡ \(timerInterval)   &quot;, for: .normal)</span><br><span class="line">        if timerInterval &#x3D;&#x3D; 0 &#123;</span><br><span class="line">            removeWindow()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; å¹¿å‘Šé¡µç§»é™¤</span><br><span class="line">    func buttonTargetAction(sender: UIButton) &#123;</span><br><span class="line">        removeWindow()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; ç‚¹å‡»æ‰‹åŠ¿</span><br><span class="line">    func adGuestureTargetAction() &#123;</span><br><span class="line">        if clickBlockHandle !&#x3D; nil &#123;</span><br><span class="line">            clickBlockHandle!()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åŠ è½½æ–¹å¼"><a href="#åŠ è½½æ–¹å¼" class="headerlink" title="åŠ è½½æ–¹å¼"></a>åŠ è½½æ–¹å¼</h3><p>åœ¨<code>AppDelgate</code>ä¸­çš„<code>didFinishLaunchingWithOptions</code>æ–¹æ³•ä¸­è°ƒç”¨æ–¹æ³•ã€‚<br>æˆ‘è¿™ä¸ºäº†é€‚åº”å˜åŒ–çš„éœ€è¦ï¼Œæä¾›äº†ç›¸å¯¹è‡ªç”±çš„æ˜¾ç¤ºæ–¹å¼</p><p>åº•éƒ¨çš„logoè§†å›¾æ˜¯å¯ä»¥è‡ªå®šä¹‰çš„ï¼Œä¼ å…¥å¯¹åº”æ˜¾ç¤ºçš„é«˜åº¦å³å¯ã€‚</p><p>å›¾ç‰‡åœ°å€</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">let imagePath &#x3D; &quot;https:&#x2F;&#x2F;timgsa.baidu.com&#x2F;timg?image&amp;quality&#x3D;80&amp;size&#x3D;b9999_10000&amp;sec&#x3D;1567682065374&amp;di&#x3D;4c2a4d2008a4e951b34b3d130db19d12&amp;imgtype&#x3D;0&amp;src&#x3D;http%3A%2F%2Fb-ssl.duitang.com%2Fuploads%2Fitem%2F201704%2F14%2F20170414155109_Cmz24.jpeg&quot;</span><br></pre></td></tr></table></figure><ul><li><p>ä»…æ˜¾ç¤ºå›¾ç‰‡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">WDLaunchAD.setup(with: .image, url: imagePath, durition: 5, bottomView: WDLaunchADBottomLogoView(), buttomViewHeight: 180) &#123;</span><br><span class="line">    print(&quot;âœ¨ ç‚¹å‡»äº†å¹¿å‘Š&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2020/01/20/1Pdk1U.png" alt=""></p></li><li><p>æ˜¾ç¤ºå›¾ç‰‡ä¸åº•éƒ¨logoè§†å›¾<br>åº•éƒ¨è§†å›¾ä»£ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; MARK: - åº•éƒ¨logoè§†å›¾</span><br><span class="line">class WDLaunchADBottomLogoView: UIView &#123;</span><br><span class="line">    &#x2F;&#x2F; logo</span><br><span class="line">    let logoImageView: UIImageView &#x3D; &#123;</span><br><span class="line">        let imageV &#x3D; UIImageView()</span><br><span class="line">        imageV.image &#x3D; UIImage(named: &quot;nav-logo-4c7bbafe27adc892f3046e6978459bac&quot;)?.withRenderingMode(.alwaysTemplate)</span><br><span class="line">        imageV.tintColor &#x3D; .red</span><br><span class="line">        return imageV</span><br><span class="line">    &#125;()</span><br><span class="line">    </span><br><span class="line">    override init(frame: CGRect) &#123;</span><br><span class="line">        super.init(frame: frame)</span><br><span class="line">        setupSubviews()</span><br><span class="line">        setupSubviewsLayouts()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    required init?(coder aDecoder: NSCoder) &#123;</span><br><span class="line">        fatalError(&quot;init(coder:) has not been implemented&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; MARK: åº•éƒ¨logoè§†å›¾é¡µé¢é…ç½®ä¸å¸ƒå±€</span><br><span class="line">extension WDLaunchADBottomLogoView &#123;</span><br><span class="line">    func setupSubviews() &#123;</span><br><span class="line">        backgroundColor &#x3D; .white</span><br><span class="line">        addSubview(logoImageView)</span><br><span class="line">        logoImageView.translatesAutoresizingMaskIntoConstraints &#x3D; false</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    func setupSubviewsLayouts() &#123;</span><br><span class="line">        addConstraints([</span><br><span class="line">            NSLayoutConstraint(item: logoImageView, attribute: .centerX, relatedBy: .equal, toItem: self, attribute: .centerX, multiplier: 1, constant: 0),</span><br><span class="line">            NSLayoutConstraint(item: logoImageView, attribute: .centerY, relatedBy: .equal, toItem: self, attribute: .centerY, multiplier: 1, constant: 0)</span><br><span class="line">        ])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŠ è½½ä»£ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">WDLaunchAD.setup(with: .image, url: imagePath, durition: 5, bottomView: WDLaunchADBottomLogoView(), buttomViewHeight: 180) &#123;</span><br><span class="line">    print(&quot;âœ¨ ç‚¹å‡»äº†å¹¿å‘Š&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://s2.ax1x.com/2020/01/20/1PdeB9.png" alt=""></p></li><li><p>åŠ è½½è§†é¢‘<br>é¦–å…ˆéœ€è¦ç°åœ¨æœ‰ç½‘çš„ç¯å¢ƒç¼“å­˜åˆ°æœ¬åœ°ï¼Œæˆ‘è¿™è¾¹çš„æ€æƒ³æ˜¯ï¼Œé¦–æ¬¡è¿›å…¥Appé»˜è®¤åŠ è½½å›¾ç‰‡ï¼Œç„¶åä¸‹è½½å¹¿å‘Šçš„è§†é¢‘åˆ°æœ¬åœ°ã€‚å†æ¬¡è¿›å…¥çš„æ—¶å€™ï¼Œåˆ¤æ–­æ˜¯å¦æ˜¯ç¼“å­˜çš„è§†é¢‘ï¼Œæ˜¯åˆ™è¿›è¡Œæ’­æ”¾ã€‚æ˜¯å¦åŠ è½½çš„<code>URL</code>ä¸ç¼“å­˜çš„ä¸åŒï¼Œåˆ™ä¾æ—§åŠ è½½å›¾ç‰‡ï¼Œå¹¶ä¸‹è½½æœ€æ–°<code>URL</code>ä¸‹çš„è§†é¢‘ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">let path &#x3D; WDLaunchADDownloader.downloadVideo(path: &quot;http:&#x2F;&#x2F;wvideo.spriteapp.cn&#x2F;video&#x2F;2018&#x2F;0514&#x2F;eede6198571f11e8b5ca842b2b4c75ab_wpd.mp4&quot;)</span><br><span class="line">    if path.count &gt; 0 &#123;</span><br><span class="line">        WDLaunchAD.setup(with: .video, url: path, durition: 5, bottomView: WDLaunchADBottomLogoView(), buttomViewHeight: 180) &#123;</span><br><span class="line">            print(&quot;âœ¨ ç‚¹å‡»äº†å¹¿å‘Š&quot;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        WDLaunchAD.setup(with: .image, url: imagePath, durition: 5, bottomView: WDLaunchADBottomLogoView(), buttomViewHeight: 180) &#123;</span><br><span class="line">            print(&quot;âœ¨ ç‚¹å‡»äº†å¹¿å‘Š&quot;)</span><br><span class="line">        &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ•ˆæœå›¾ï¼Œæ²¡æœ‰æ‰¾åˆ°åˆé€‚å¤§å°çš„è§†é¢‘å°±å‡‘åˆç€ç”¨äº†ã€‚</p></blockquote></li></ul><p><img src="https://s2.ax1x.com/2020/01/20/1PdMh6.png" alt=""></p><blockquote><p>è¯´æ˜:</p><ol><li>é¡µé¢æ¶ˆå¤±çš„åŠ¨ç”»ï¼Œæ²¡æœ‰åšè¿‡å¤šçš„å¤„ç†</li><li>è§†é¢‘æ²¡æœ‰åšå¾ªç¯æ’­æ”¾</li></ol></blockquote>]]></content>
      
      
      <categories>
          
          <category> Swift </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è‡ªå®šä¹‰æ§ä»¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iOSè‡ªå®šä¹‰æ§ä»¶-åˆ†æ®µé€‰æ‹©å™¨</title>
      <link href="/2020/01/16/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-%E5%88%86%E6%AE%B5%E9%80%89%E6%8B%A9%E5%99%A8/"/>
      <url>/2020/01/16/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-%E5%88%86%E6%AE%B5%E9%80%89%E6%8B%A9%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<p>åºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥ä¸Šä»£ç </p><h5 id="1ã€æ•°æ®æºæ–¹æ³•"><a href="#1ã€æ•°æ®æºæ–¹æ³•" class="headerlink" title="1ã€æ•°æ®æºæ–¹æ³•"></a>1ã€æ•°æ®æºæ–¹æ³•</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; MARK: &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; SegmentSelectorManagerDataSource &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">@objc protocol  SegmentSelectorManagerDataSource:NSObjectProtocol &#123;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F;&#x2F; ä¸»è¦é…ç½® -&gt; å¿…é¡»è¦å®ç°</span><br><span class="line">    func nameOfSliderItems(segemntControl:SegmentSelectorManager) -&gt; Array&lt;String&gt;</span><br><span class="line">    func childViewControllers(segemntControl:SegmentSelectorManager) -&gt; Array&lt;UIViewController&gt;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F;&#x2F; å­—ä½“é¢œè‰²é…ç½® -&gt; æœ‰é»˜è®¤</span><br><span class="line">    @objc optional func colorOfSlider(segemntControl:SegmentSelectorManager) -&gt; UIColor</span><br><span class="line">    @objc optional func colorOfTopView(segemntControl:SegmentSelectorManager) -&gt; UIColor</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F;&#x2F; èƒŒæ™¯é¢œè‰²é…ç½® -&gt; æœ‰é»˜è®¤</span><br><span class="line">    @objc optional func colorOfSliderItemsTitle(segemntControl:SegmentSelectorManager) -&gt; UIColor</span><br><span class="line">    @objc optional func colorOfHighlightedSliderItemsTitle(segemntControl:SegmentSelectorManager) -&gt; UIColor</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F;&#x2F; é«˜åº¦é…ç½® -&gt; æœ‰é»˜è®¤</span><br><span class="line">    @objc optional func heightOfTopView(segemntControl:SegmentSelectorManager) -&gt; CGFloat</span><br><span class="line">    @objc optional func heightOfSlider(segemntControl:SegmentSelectorManager) -&gt; CGFloat</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="2ã€ä»£ç†æ–¹æ³•"><a href="#2ã€ä»£ç†æ–¹æ³•" class="headerlink" title="2ã€ä»£ç†æ–¹æ³•"></a>2ã€ä»£ç†æ–¹æ³•</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; MARK: &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; SegmentSelectorManagerDelegate &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">protocol SegmentSelectorManagerDelegate &#123;</span><br><span class="line">    func slideView(sliderView:SegmentSelectorManager, didSelectItemAtIndex:Int) -&gt; Void</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="3ã€é¡µé¢å®ç°"><a href="#3ã€é¡µé¢å®ç°" class="headerlink" title="3ã€é¡µé¢å®ç°"></a>3ã€é¡µé¢å®ç°</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">override init(frame: CGRect) &#123;</span><br><span class="line">        super.init(frame: frame)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    required init?(coder aDecoder: NSCoder) &#123;</span><br><span class="line">        fatalError(&quot;init(coder:) has not been implemented&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F;&#x2F; æ•°æ®æº</span><br><span class="line">    public weak var dataSource:SegmentSelectorManagerDataSource? &#123;</span><br><span class="line">        didSet &#123;</span><br><span class="line">            &#x2F;&#x2F; åç§°æ•°ç»„</span><br><span class="line">            namesOfSlideItems &#x3D; dataSource?.nameOfSliderItems(segemntControl: self)</span><br><span class="line">            &#x2F;&#x2F; æ§åˆ¶å™¨æ•°ç»„</span><br><span class="line">            childControllersArray &#x3D; dataSource?.childViewControllers(segemntControl: self)</span><br><span class="line">            </span><br><span class="line">            if let ds &#x3D; dataSource &#123;</span><br><span class="line"></span><br><span class="line">                if (ds.responds(to: #selector(ds.colorOfHighlightedSliderItemsTitle(segemntControl:)))) &#123;</span><br><span class="line">                    &#x2F;&#x2F;æŒ‰é’®å­—ä½“é¢œè‰²é»˜è®¤</span><br><span class="line">                    colorOfSlideItemsTitle &#x3D; ds.colorOfSliderItemsTitle!(segemntControl: self)</span><br><span class="line">                &#125;</span><br><span class="line">            </span><br><span class="line">                if (ds.responds(to: #selector(ds.colorOfHighlightedSliderItemsTitle(segemntControl:)))) &#123;</span><br><span class="line">                    &#x2F;&#x2F; æŒ‰é’®å­—ä½“é¢œè‰²é€‰ä¸­</span><br><span class="line">                    colorOfHighlightedSlideItemsTitle &#x3D; ds.colorOfHighlightedSliderItemsTitle!(segemntControl: self)</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                if (ds.responds(to: #selector(ds.colorOfSlider(segemntControl:)))) &#123;</span><br><span class="line">                    &#x2F;&#x2F; æŒ‡ç¤ºå™¨é¢œè‰²</span><br><span class="line">                    colorOfSlider &#x3D; ds.colorOfSlider!(segemntControl: self)</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                if ds.responds(to: #selector(ds.heightOfTopView(segemntControl:))) &#123;</span><br><span class="line">                    &#x2F;&#x2F; é¡¶éƒ¨è§†å›¾é«˜åº¦</span><br><span class="line">                    heightOfTopView &#x3D; (ds.heightOfTopView!(segemntControl: self))</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                if ds.responds(to: #selector(ds.heightOfTopView(segemntControl:))) &#123;</span><br><span class="line">                    &#x2F;&#x2F; æŒ‡ç¤ºå™¨é«˜åº¦</span><br><span class="line">                    heightOfSlider &#x3D; (ds.heightOfSlider!(segemntControl: self))</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; ä»£ç†</span><br><span class="line">    public var delegate:SegmentSelectorManagerDelegate?</span><br><span class="line">    </span><br><span class="line">    var namesOfSlideItems: Array&lt;String&gt;? &#x3D; []                           &#x2F;&#x2F; åç§°æ•°ç»„</span><br><span class="line">    var colorOfSlider: UIColor? &#x3D;  UIColor.orange                        &#x2F;&#x2F; æŒ‡ç¤ºå™¨é¢œè‰²</span><br><span class="line">    var colorOfSlideView: UIColor? &#x3D; UIColor.white                       &#x2F;&#x2F; é¡¶éƒ¨è§†å›¾é¢œè‰²</span><br><span class="line">    var colorOfSlideItemsTitle: UIColor? &#x3D; UIColor.gray                  &#x2F;&#x2F; é»˜è®¤å­—ä½“é¢œè‰²</span><br><span class="line">    var colorOfHighlightedSlideItemsTitle: UIColor? &#x3D; UIColor.orange     &#x2F;&#x2F; é€‰ä¸­å­—ä½“é¢œè‰²</span><br><span class="line">    var heightOfTopView:CGFloat &#x3D; 45                                     &#x2F;&#x2F; é¡¶éƒ¨è§†å›¾é«˜åº¦</span><br><span class="line">    var heightOfSlider:CGFloat &#x3D; 2                                       &#x2F;&#x2F; æŒ‡ç¤ºå™¨é«˜åº¦</span><br><span class="line">    let SliderThanSliderView_WidthRatio:CGFloat &#x3D; 1                      &#x2F;&#x2F; æŒ‰é’®å’ŒæŒ‡ç¤ºå™¨å®½åº¦æ¯”</span><br><span class="line">    var buttonsArray:Array&lt;UIButton&gt;? &#x3D; []                               &#x2F;&#x2F; æ‰€æœ‰æŒ‰é’®çš„æ•°ç»„</span><br><span class="line">    var childControllersArray:Array&lt;UIViewController&gt;? &#x3D; []              &#x2F;&#x2F; æ§åˆ¶å™¨æ•°ç»„</span><br><span class="line">    </span><br><span class="line">    let SCREEN_WIDTH &#x3D; UIScreen.main.bounds.size.width</span><br><span class="line">    let SCREEN_HEIGHT &#x3D; UIScreen.main.bounds.height</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F;&#x2F; é¡¶éƒ¨View</span><br><span class="line">    lazy var slideBar:UIView &#x3D; &#123;</span><br><span class="line">        let view &#x3D; UIView.init()</span><br><span class="line">        view.backgroundColor &#x3D; colorOfSlideView</span><br><span class="line">        addSubview(view)</span><br><span class="line">        view.translatesAutoresizingMaskIntoConstraints &#x3D; false</span><br><span class="line">        view.leadingAnchor.constraint(equalTo: leadingAnchor).isActive &#x3D; true</span><br><span class="line">        view.trailingAnchor.constraint(equalTo: trailingAnchor).isActive &#x3D; true</span><br><span class="line">        view.topAnchor.constraint(equalTo: topAnchor).isActive &#x3D; true</span><br><span class="line">        view.heightAnchor.constraint(equalToConstant: self.heightOfTopView).isActive &#x3D; true</span><br><span class="line">        return view</span><br><span class="line">    &#125;()</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; åº•éƒ¨æŒ‡ç¤ºå™¨</span><br><span class="line">    var slider:UIView?</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F;&#x2F; æ§åˆ¶å™¨ScrollView</span><br><span class="line">    lazy var contentScrollView:UIScrollView &#x3D; &#123;</span><br><span class="line">        let sc &#x3D; UIScrollView.init()</span><br><span class="line">        sc.isDirectionalLockEnabled &#x3D; true</span><br><span class="line">        sc.backgroundColor &#x3D; UIColor.white</span><br><span class="line">        sc.isPagingEnabled &#x3D; true</span><br><span class="line">        sc.showsHorizontalScrollIndicator &#x3D; false</span><br><span class="line">        sc.delegate &#x3D; self</span><br><span class="line">        sc.bounces &#x3D; false</span><br><span class="line">        addSubview(sc)</span><br><span class="line">        sc.translatesAutoresizingMaskIntoConstraints &#x3D; false</span><br><span class="line">        sc.leadingAnchor.constraint(equalTo: leadingAnchor).isActive &#x3D; true</span><br><span class="line">        sc.trailingAnchor.constraint(equalTo: trailingAnchor).isActive &#x3D; true</span><br><span class="line">        sc.topAnchor.constraint(equalTo: self.slideBar.bottomAnchor).isActive &#x3D; true</span><br><span class="line">        sc.bottomAnchor.constraint(equalTo: bottomAnchor).isActive &#x3D; true</span><br><span class="line">        return sc</span><br><span class="line">    &#125;()</span><br></pre></td></tr></table></figure><p>#####4ã€ç»˜åˆ¶é¡µé¢UI</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line">    &#x2F;&#x2F; è·å–å½“å‰é¡µé¢çš„æ§åˆ¶å™¨</span><br><span class="line">    public func viewController()-&gt;UIViewController? &#123;</span><br><span class="line">        var nextResponder: UIResponder? &#x3D; self</span><br><span class="line">        repeat &#123;</span><br><span class="line">            nextResponder &#x3D; nextResponder?.next</span><br><span class="line">            if let viewController &#x3D; nextResponder as? UIViewController &#123;</span><br><span class="line">                return viewController</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; while nextResponder !&#x3D; nil</span><br><span class="line">        </span><br><span class="line">        return nil</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">override func layoutSubviews() &#123;</span><br><span class="line">        super.layoutSubviews()</span><br><span class="line">        addSlider()</span><br><span class="line">        addButton()</span><br><span class="line">        addContentScrollView()</span><br><span class="line">    &#125;</span><br><span class="line">&#x2F;&#x2F;&#x2F; æ·»åŠ æŒ‰é’®åˆ°é¡¶éƒ¨è§†å›¾</span><br><span class="line">    func addButton() &#123;</span><br><span class="line">        </span><br><span class="line">        let numberOfItems:Int &#x3D; (namesOfSlideItems?.count)!</span><br><span class="line">        let slideItemWidth &#x3D; SCREEN_WIDTH &#x2F; CGFloat(numberOfItems)</span><br><span class="line">        let sliderWidth &#x3D; slideItemWidth * SliderThanSliderView_WidthRatio</span><br><span class="line">        let position_x &#x3D; (slideItemWidth - sliderWidth) &#x2F; 2.0</span><br><span class="line">        </span><br><span class="line">        for index in 0..&lt;numberOfItems &#123;</span><br><span class="line">            let b &#x3D; UIButton.init(type: .custom)</span><br><span class="line">            b.tag &#x3D; index</span><br><span class="line">            b.setTitle(namesOfSlideItems![index], for: .normal)</span><br><span class="line">            b.setTitleColor(colorOfSlideItemsTitle, for: .normal)</span><br><span class="line">            b.titleLabel?.textAlignment &#x3D; .center</span><br><span class="line">            b.addTarget(self, action: #selector(buttonTouched(button:)), for: .touchUpInside)</span><br><span class="line">            buttonsArray?.append(b)</span><br><span class="line">            b.frame &#x3D; CGRect(x: position_x + slideItemWidth * CGFloat(index),</span><br><span class="line">                             y: 5,</span><br><span class="line">                             width: sliderWidth,</span><br><span class="line">                             height: heightOfTopView-5)</span><br><span class="line">            slideBar.addSubview(b)</span><br><span class="line">            </span><br><span class="line">            if index &#x3D;&#x3D; 0 &#123;</span><br><span class="line">                b.setTitleColor(colorOfHighlightedSlideItemsTitle!, for: .normal)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; æ·»åŠ åº•éƒ¨æŒ‡ç¤ºå™¨åˆ°é¡¶éƒ¨è§†å›¾</span><br><span class="line">    func addSlider() &#123;</span><br><span class="line">        let slideItemWidth &#x3D;  SCREEN_WIDTH &#x2F; CGFloat((namesOfSlideItems?.count)!)</span><br><span class="line">        let sliderWidth &#x3D; slideItemWidth * SliderThanSliderView_WidthRatio</span><br><span class="line">        let position_x &#x3D; (slideItemWidth - sliderWidth) &#x2F; 2.0</span><br><span class="line">        slideBar.addSubview(sliderView(frame: CGRect(x: position_x,</span><br><span class="line">                                                     y: heightOfTopView - heightOfSlider,</span><br><span class="line">                                                     width: sliderWidth,</span><br><span class="line">                                                     height: heightOfSlider)))</span><br><span class="line">        slideBar.backgroundColor &#x3D; colorOfSlideView</span><br><span class="line">        slider?.backgroundColor &#x3D; colorOfSlider</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">     &#x2F;&#x2F; æ·»åŠ ScrollView</span><br><span class="line">    func addContentScrollView() &#123;</span><br><span class="line">        contentScrollView.contentSize &#x3D; CGSize(width: SCREEN_WIDTH * CGFloat((namesOfSlideItems?.count)!), height: 0)</span><br><span class="line"></span><br><span class="line">        for (index) in (childControllersArray?.enumerated())! &#123;</span><br><span class="line">            index.element.view.frame &#x3D; CGRect(x: CGFloat(index.offset) * SCREEN_WIDTH,</span><br><span class="line">                                              y: 0,</span><br><span class="line">                                              width: contentScrollView.frame.width,</span><br><span class="line">                                              height: contentScrollView.frame.height)</span><br><span class="line">            contentScrollView.addSubview(index.element.view)</span><br><span class="line">            viewController()?.addChild(index.element)</span><br><span class="line">            index.element.didMove(toParent: viewController())</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; vcæ»šåŠ¨åŠ¨ç”»</span><br><span class="line">    func animateSlider(tag:Int) -&gt; Void &#123;</span><br><span class="line">        contentScrollView.setContentOffset(CGPoint(x: SCREEN_WIDTH * CGFloat(tag), y: 0), animated: true)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; æŒ‡ç¤ºå™¨æ»šåŠ¨åŠ¨ç”»</span><br><span class="line">    func animateSliderToPosition(offset:CGPoint) -&gt; Void &#123;</span><br><span class="line">        </span><br><span class="line">        let slideItemWidth &#x3D;  SCREEN_WIDTH &#x2F; CGFloat((namesOfSlideItems?.count)!)</span><br><span class="line">        let sliderWidth &#x3D;  slideItemWidth * SliderThanSliderView_WidthRatio</span><br><span class="line">        let position_x &#x3D;  (slideItemWidth - sliderWidth) &#x2F; 2.0</span><br><span class="line">        </span><br><span class="line">        let newFrame &#x3D; CGRect(x: (offset.x &#x2F; SCREEN_WIDTH) * slideItemWidth + position_x,</span><br><span class="line">                              y: (slider?.frame.origin.y)!,</span><br><span class="line">                              width: (slider?.frame.width)!,</span><br><span class="line">                              height: (slider?.frame.height)!)</span><br><span class="line">        slider?.frame &#x3D; newFrame</span><br><span class="line">        </span><br><span class="line">        for (index) in (buttonsArray?.enumerated())! &#123;</span><br><span class="line">            index.element.setTitleColor(colorOfSlideItemsTitle, for: .normal)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        var buttonTag &#x3D; 0</span><br><span class="line">        let ratio &#x3D; offset.x &#x2F; SCREEN_WIDTH</span><br><span class="line">        let tempRation &#x3D; Int(ratio)</span><br><span class="line">        </span><br><span class="line">        let decimal:CGFloat &#x3D; ratio - CGFloat(tempRation)</span><br><span class="line"></span><br><span class="line">        if decimal &gt;&#x3D; 0.5 &#123;</span><br><span class="line">            buttonTag &#x3D; Int(ratio) + 1</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            buttonTag &#x3D; Int(ratio)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        buttonsArray![buttonTag].setTitleColor(colorOfHighlightedSlideItemsTitle, for: .normal)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F;&#x2F; æ ¹æ®frameåˆå§‹åŒ–æŒ‡ç¤ºå™¨</span><br><span class="line">    func sliderView(frame:CGRect) -&gt; UIView &#123;</span><br><span class="line">        slider &#x3D; UIView.init(frame: frame)</span><br><span class="line">        return slider!</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    &#x2F;&#x2F;&#x2F; ç‚¹å‡»äº‹ä»¶</span><br><span class="line">    @objc func buttonTouched(button:UIButton) &#123;</span><br><span class="line">        delegate?.slideView(sliderView: self, didSelectItemAtIndex: button.tag)</span><br><span class="line">        animateSlider(tag: tag)</span><br><span class="line">        contentScrollView.setContentOffset(CGPoint(x: SCREEN_WIDTH * CGFloat(button.tag), y: 0), animated: true)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h5 id="5ã€ä½¿ç”¨Extensionå®ç°UIScrollViewDidScrollDelegate"><a href="#5ã€ä½¿ç”¨Extensionå®ç°UIScrollViewDidScrollDelegate" class="headerlink" title="5ã€ä½¿ç”¨Extensionå®ç°UIScrollViewDidScrollDelegate"></a>5ã€ä½¿ç”¨Extensionå®ç°UIScrollViewDidScrollDelegate</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; MARK: &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; UIScrollViewDidScrollDelegate &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">extension SegmentSelectorManager:UIScrollViewDelegate &#123;</span><br><span class="line">    func scrollViewDidScroll(_ scrollView: UIScrollView) &#123;</span><br><span class="line">        animateSliderToPosition(offset: scrollView.contentOffset)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="6ã€ä½¿ç”¨æ–¹æ³•-å®ä¾‹ä»£ç "><a href="#6ã€ä½¿ç”¨æ–¹æ³•-å®ä¾‹ä»£ç " class="headerlink" title="6ã€ä½¿ç”¨æ–¹æ³•(å®ä¾‹ä»£ç )"></a>6ã€ä½¿ç”¨æ–¹æ³•(å®ä¾‹ä»£ç )</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">override func setupSubViewsProperties() &#123;</span><br><span class="line">        segmentView &#x3D; SegmentSelectorManager.init(frame: CGRect.zero)</span><br><span class="line">        segmentView?.delegate &#x3D; self</span><br><span class="line">        segmentView?.dataSource &#x3D; self</span><br><span class="line">        view.addSubview(segmentView!)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    override func setupSubViewsConstrains() &#123;</span><br><span class="line">        if let seg &#x3D; segmentView &#123;</span><br><span class="line">            seg.translatesAutoresizingMaskIntoConstraints &#x3D; false</span><br><span class="line">            seg.leadingAnchor.constraint(equalTo: view.leadingAnchor).isActive &#x3D; true</span><br><span class="line">            seg.trailingAnchor.constraint(equalTo: view.trailingAnchor).isActive &#x3D; true</span><br><span class="line">            seg.bottomAnchor.constraint(equalTo: view.bottomAnchor, constant: -kTabBarHeight).isActive &#x3D; true</span><br><span class="line">            seg.topAnchor.constraint(equalTo: wd_navgationBar_normal.bottomAnchor).isActive &#x3D; true</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><hr><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">extension HotPlayController: SegmentSelectorManagerDataSource &#123;</span><br><span class="line"></span><br><span class="line">    func nameOfSliderItems(segemntControl: SegmentSelectorManager) -&gt; Array&lt;String&gt; &#123;</span><br><span class="line">        return [&quot;æ­£åœ¨çƒ­æ˜ &quot;, &quot;å³å°†ä¸Šæ˜ &quot;]</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    func childViewControllers(segemntControl: SegmentSelectorManager) -&gt; Array&lt;UIViewController&gt; &#123;</span><br><span class="line">        return [HotPlayingController(), HotWillPlayViewController()]</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    func heightOfTopView(segemntControl: SegmentSelectorManager) -&gt; CGFloat &#123;</span><br><span class="line">        return 45</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    func heightOfSlider(segemntControl: SegmentSelectorManager) -&gt; CGFloat &#123;</span><br><span class="line">        return 3</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    func colorOfSlider(segemntControl slider: SegmentSelectorManager) -&gt; UIColor &#123;</span><br><span class="line">        return UIColor.wd_init(r: 73, g: 73, b: 73)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    func colorOfTopView(segemntControl: SegmentSelectorManager) -&gt; UIColor &#123;</span><br><span class="line">        return UIColor.white</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    func colorOfSliderItemsTitle(segemntControl: SegmentSelectorManager) -&gt; UIColor &#123;</span><br><span class="line">        return UIColor.gray</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    func colorOfHighlightedSliderItemsTitle(segemntControl: SegmentSelectorManager) -&gt; UIColor &#123;</span><br><span class="line">        return UIColor.wd_init(r: 73, g: 73, b: 73)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">extension HotPlayController: SegmentSelectorManagerDelegate &#123;</span><br><span class="line">    func slideView(sliderView: SegmentSelectorManager, didSelectItemAtIndex: Int) &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="7ã€æ•ˆæœå›¾"><a href="#7ã€æ•ˆæœå›¾" class="headerlink" title="7ã€æ•ˆæœå›¾"></a>7ã€æ•ˆæœå›¾</h5><p><img src="https://s2.ax1x.com/2020/01/20/1Pd8je.gif" alt="æ•ˆæœå›¾.gif"></p>]]></content>
      
      
      <categories>
          
          <category> Swift </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è‡ªå®šä¹‰æ§ä»¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iOSè‡ªå®šä¹‰æ§ä»¶-ä»¿QQä¾§è¾¹èœå•</title>
      <link href="/2020/01/16/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-%E4%BB%BFQQ%E4%BE%A7%E8%BE%B9%E8%8F%9C%E5%8D%95/"/>
      <url>/2020/01/16/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-%E4%BB%BFQQ%E4%BE%A7%E8%BE%B9%E8%8F%9C%E5%8D%95/</url>
      
        <content type="html"><![CDATA[<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;UIKit&#x2F;UIKit.h&gt;</span><br><span class="line"></span><br><span class="line">NS_ASSUME_NONNULL_BEGIN</span><br><span class="line"></span><br><span class="line">@interface LZSliderContainerViewController : UIViewController</span><br><span class="line">&#x2F;&#x2F; æ˜¯å¦å…è®¸ä¾§æ»‘æ‰‹åŠ¿</span><br><span class="line">@property (nonatomic, assign) BOOL allowOpenSliderView;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; å•ä¾‹</span><br><span class="line">+ (instancetype)mamager;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> åˆå§‹åŒ–æ–¹æ³•</span><br><span class="line"></span><br><span class="line"> @param mainController ä¸»é¡µé¢æ§åˆ¶å™¨</span><br><span class="line"> @param sliderController èœå•é¡µé¢æ§åˆ¶å™¨</span><br><span class="line"> @param space ç©ºéš™</span><br><span class="line"> @return UIViewController</span><br><span class="line"> *&#x2F;</span><br><span class="line">- (UIViewController *)lz_setupMainController:(UIViewController *)mainController sliderController:(UIViewController *)sliderController space:(CGFloat)space;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> æ‰“å¼€ä¾§è¾¹èœå•</span><br><span class="line"> *&#x2F;</span><br><span class="line">- (void)lz_openSlderView;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> å…³é—­ä¾§è¾¹èœå•</span><br><span class="line"> *&#x2F;</span><br><span class="line">- (void)lz_closeSliderView;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;LZSliderContainerViewController.h&quot;</span><br><span class="line"></span><br><span class="line">@interface UIView (Frame)</span><br><span class="line"></span><br><span class="line">@property (nonatomic) CGFloat left;</span><br><span class="line">@property (nonatomic) CGFloat right;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation UIView (Frame)</span><br><span class="line"></span><br><span class="line">- (CGFloat)left &#123;</span><br><span class="line">    return self.frame.origin.x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)setLeft:(CGFloat)x &#123;</span><br><span class="line">    CGRect frame &#x3D; self.frame;</span><br><span class="line">    frame.origin.x &#x3D; x;</span><br><span class="line">    self.frame &#x3D; frame;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (CGFloat)right &#123;</span><br><span class="line">    return self.frame.origin.x + self.frame.size.width;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)setRight:(CGFloat)right &#123;</span><br><span class="line">    CGRect frame &#x3D; self.frame;</span><br><span class="line">    frame.origin.x &#x3D; right - frame.size.width;</span><br><span class="line">    self.frame &#x3D; frame;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@interface LZSliderContainerViewController ()</span><br><span class="line"></span><br><span class="line">@property (nonatomic, strong) UIViewController *mainController;</span><br><span class="line">@property (nonatomic, strong) UIViewController *sliderController;</span><br><span class="line">@property (nonatomic, assign) CGFloat spece;</span><br><span class="line">@property (nonatomic, assign) CGFloat panStartX;</span><br><span class="line">@property (nonatomic, strong) UIView *coverView;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation LZSliderContainerViewController</span><br><span class="line">#pragma mark - å•ä¾‹æ–¹æ³•</span><br><span class="line">+ (instancetype)mamager &#123;</span><br><span class="line">    static dispatch_once_t onceToken;</span><br><span class="line">    static LZSliderContainerViewController *vc;</span><br><span class="line">    dispatch_once(&amp;onceToken, ^&#123;</span><br><span class="line">        vc &#x3D; [[LZSliderContainerViewController alloc] init];</span><br><span class="line">    &#125;);</span><br><span class="line">    return vc;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - åˆå§‹åŒ–æ–¹æ³•</span><br><span class="line">- (UIViewController *)lz_setupMainController:(UIViewController *)mainController sliderController:(UIViewController *)sliderController space:(CGFloat)space &#123;</span><br><span class="line">    [self lz_addChildControllerWithMainController:mainController sliderController:sliderController];</span><br><span class="line">    [self lz_setupCoverView];</span><br><span class="line">    _spece &#x3D; space;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - é…ç½®é®ç½©å±‚</span><br><span class="line">- (void)lz_setupCoverView &#123;</span><br><span class="line">    self.coverView &#x3D; [[UIView alloc] init];</span><br><span class="line">    self.coverView.frame &#x3D; UIScreen.mainScreen.bounds;</span><br><span class="line">    self.coverView.backgroundColor &#x3D; [[UIColor blackColor] colorWithAlphaComponent:0];</span><br><span class="line">    self.coverView.hidden &#x3D; true;</span><br><span class="line">    [self.coverView addGestureRecognizer:[[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(lz_closeSliderView)]];</span><br><span class="line">    [self.view addSubview:self.coverView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - æ·»åŠ VC</span><br><span class="line">- (void)lz_addChildControllerWithMainController:(UIViewController *)mainController sliderController:(UIViewController *)sliderController &#123;</span><br><span class="line">    [self addChildViewController:mainController];</span><br><span class="line">    [mainController didMoveToParentViewController:self];</span><br><span class="line">    mainController.view.frame &#x3D; UIScreen.mainScreen.bounds;</span><br><span class="line">    [self.view addSubview:mainController.view];</span><br><span class="line">    </span><br><span class="line">    [self addChildViewController:sliderController];</span><br><span class="line">    [sliderController didMoveToParentViewController:self];</span><br><span class="line">    sliderController.view.frame &#x3D; CGRectMake(-UIScreen.mainScreen.bounds.size.width, 0, UIScreen.mainScreen.bounds.size.width, UIScreen.mainScreen.bounds.size.height);</span><br><span class="line">    [self.view addSubview:sliderController.view];</span><br><span class="line">    </span><br><span class="line">    self.mainController &#x3D; mainController;</span><br><span class="line">    self.sliderController &#x3D; sliderController;</span><br><span class="line">    </span><br><span class="line">    [self lz_setupGusture];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - æ·»åŠ å¹³ç§»æ‰‹åŠ¿</span><br><span class="line">- (void)lz_setupGusture &#123;</span><br><span class="line">    UIPanGestureRecognizer *panGusture &#x3D; [[UIPanGestureRecognizer alloc] initWithTarget:self action:@selector(lz_panGestureRecognizer:)];</span><br><span class="line">    [self.view addGestureRecognizer:panGusture];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#pragma mark - UIPanGestureRecognizer Action</span><br><span class="line">- (void)lz_panGestureRecognizer:(UIPanGestureRecognizer *)sender &#123;</span><br><span class="line">    UIView *rootView &#x3D; self.mainController.view;</span><br><span class="line">    UIView *menuView &#x3D; self.sliderController.view;</span><br><span class="line">    </span><br><span class="line">    if (sender.state &#x3D;&#x3D; UIGestureRecognizerStateBegan) &#123;</span><br><span class="line">        CGFloat startPointX &#x3D; [sender translationInView:self.view].x;</span><br><span class="line">        self.panStartX &#x3D; startPointX;</span><br><span class="line">        self.coverView.hidden &#x3D; false;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if (self.panStartX &gt;&#x3D; 40 &amp;&amp; rootView.frame.origin.x &#x3D;&#x3D; 0) &#123;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    CGFloat translationX &#x3D; [sender translationInView:rootView].x;</span><br><span class="line">    CGFloat rootViewX &#x3D; rootView.frame.origin.x;</span><br><span class="line">    </span><br><span class="line">    rootViewX &#x3D; [self lz_minmumWithValueA:(rootViewX + translationX) valueB:(UIScreen.mainScreen.bounds.size.width - self.spece)];</span><br><span class="line">    rootViewX &#x3D; [self lz_maxmumWithValueA:rootViewX valueB:0];</span><br><span class="line">    </span><br><span class="line">    rootView.left &#x3D; rootViewX;</span><br><span class="line">    menuView.right &#x3D; rootView.left;</span><br><span class="line">    self.coverView.frame &#x3D; rootView.frame;</span><br><span class="line">    </span><br><span class="line">    CGFloat aphal &#x3D; 0.5 * rootView.frame.origin.x &#x2F; (UIScreen.mainScreen.bounds.size.width - self.spece);</span><br><span class="line">    self.coverView.backgroundColor &#x3D; [[UIColor blackColor] colorWithAlphaComponent:aphal];</span><br><span class="line">    </span><br><span class="line">    [sender setTranslation:CGPointZero inView:rootView];</span><br><span class="line">    </span><br><span class="line">    if (sender.state &#x3D;&#x3D; UIGestureRecognizerStateEnded || sender.state &#x3D;&#x3D; UIGestureRecognizerStateCancelled) &#123;</span><br><span class="line">        if (rootViewX &gt;&#x3D; (UIScreen.mainScreen.bounds.size.width - self.spece)&#x2F;2) &#123;</span><br><span class="line">            [self lz_openSlderView];</span><br><span class="line">        &#125; else&#123;</span><br><span class="line">            [self lz_closeSliderView];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - æ‰“å¼€ä¾§è¾¹èœå•</span><br><span class="line">- (void)lz_openSlderView &#123;</span><br><span class="line">    [self lz_setupGusture];</span><br><span class="line">    </span><br><span class="line">    UIView *rootView &#x3D; self.mainController.view;</span><br><span class="line">    UIView *menuView &#x3D; self.sliderController.view;</span><br><span class="line">    </span><br><span class="line">    self.coverView.hidden &#x3D; false;</span><br><span class="line">    </span><br><span class="line">    [UIView animateWithDuration:0.4 animations:^&#123;</span><br><span class="line">        rootView.left &#x3D; UIScreen.mainScreen.bounds.size.width - self.spece;</span><br><span class="line">        menuView.right &#x3D; rootView.left;</span><br><span class="line">        self.coverView.frame &#x3D; rootView.frame;</span><br><span class="line">        self.coverView.backgroundColor &#x3D; [[UIColor blackColor] colorWithAlphaComponent:0.5];</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - å…³é—­ä¾§è¾¹èœå•</span><br><span class="line">- (void)lz_closeSliderView &#123;</span><br><span class="line">    UIView *rootView &#x3D; self.mainController.view;</span><br><span class="line">    UIView *menuView &#x3D; self.sliderController.view;</span><br><span class="line">    </span><br><span class="line">    [UIView animateWithDuration:0.4 animations:^&#123;</span><br><span class="line">        self.coverView.backgroundColor &#x3D; [[UIColor blackColor] colorWithAlphaComponent:0];</span><br><span class="line">        rootView.left &#x3D; 0;</span><br><span class="line">        menuView.right &#x3D; rootView.left;</span><br><span class="line">        self.coverView.frame &#x3D; rootView.frame;</span><br><span class="line">    &#125; completion:^(BOOL finished) &#123;</span><br><span class="line">        if (finished) &#123;</span><br><span class="line">            self.coverView.hidden &#x3D; true;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - æ¯”è¾ƒå¤§å°å–æœ€å°å€¼</span><br><span class="line">- (CGFloat)lz_minmumWithValueA:(CGFloat)a valueB:(CGFloat)b &#123;</span><br><span class="line">    return a &gt; b ? b : a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - æ¯”è¾ƒå¤§å°å–æœ€å¤§å€¼</span><br><span class="line">- (CGFloat)lz_maxmumWithValueA:(CGFloat)a valueB:(CGFloat)b &#123;</span><br><span class="line">    return a &gt; b ? a : b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - Setter</span><br><span class="line">- (void)setAllowOpenSliderView:(BOOL)allowOpenSliderView &#123;</span><br><span class="line">    _allowOpenSliderView &#x3D; allowOpenSliderView;</span><br><span class="line">    if (allowOpenSliderView) &#123;</span><br><span class="line">        [self lz_setupGusture];</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        for (UIGestureRecognizer *pan in self.view.gestureRecognizers) &#123;</span><br><span class="line">            [self.view removeGestureRecognizer:pan];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure><p>AppDelegateä¸­è®¾ç½®ä¸ºæ ¹æ§åˆ¶å™¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">self.window.rootViewController &#x3D; [[LZSliderContainerViewController mamager] lz_setupMainController:tab sliderController:sldier space:200];</span><br></pre></td></tr></table></figure><p>// å•ç‹¬æ‰“å¼€æˆ–å…³é—­</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; æ‰“å¼€é¡µé¢</span><br><span class="line">[[LZSliderContainerViewController mamager] lz_openSlderView];</span><br><span class="line">&#x2F;&#x2F; å…³é—­é¡µé¢</span><br><span class="line">[[LZSliderContainerViewController mamager] lz_closeSliderView];</span><br></pre></td></tr></table></figure><p>é»˜è®¤æ‰€æœ‰é¡µé¢éƒ½æ˜¯æ‰“å¼€çš„ï¼Œå¦‚æœéœ€è¦å…³é—­</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">- (void)viewWillAppear:(BOOL)animated&#123;</span><br><span class="line">    [super viewWillAppear:animated];</span><br><span class="line">    [LZSliderContainerViewController mamager].allowOpenSliderView &#x3D; NO;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)viewDidDisappear:(BOOL)animated &#123;</span><br><span class="line">    [super viewDidDisappear:animated];</span><br><span class="line">    [LZSliderContainerViewController mamager].allowOpenSliderView &#x3D; true;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Objective-C </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è‡ªå®šä¹‰æ§ä»¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iOSè‡ªå®šä¹‰æ§ä»¶-TableViewã€CollectionViewç©ºæ•°æ®å ä½å›¾</title>
      <link href="/2020/01/16/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-TableView%E3%80%81CollectionView%E7%A9%BA%E6%95%B0%E6%8D%AE%E5%8D%A0%E4%BD%8D%E5%9B%BE/"/>
      <url>/2020/01/16/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-TableView%E3%80%81CollectionView%E7%A9%BA%E6%95%B0%E6%8D%AE%E5%8D%A0%E4%BD%8D%E5%9B%BE/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘ç”±äºä¸šåŠ¡éœ€æ±‚ï¼Œéœ€è¦å°è£…è¿™æ ·çš„ä¸€ä¸ªæç¤ºé¡µé¢ã€‚çœ‹äº†ç½‘ä¸Šæ–¹æ³•æ„Ÿè§‰éƒ½å¤§åŒå°å¼‚ï¼Œå…¶ä¸­<a href="https://link.jianshu.com/?t=https://github.com/dzenbot/DZNEmptyDataSet" target="_blank" rel="noopener">DZNEmptyDataSet</a>æ˜¯å¾ˆå¥½çš„ä¸€ä¸ªåº“ï¼Œä½†æ˜¯å¯¹æˆ‘ä¸ªäººè€Œè¨€æœ‰ç‚¹å¤§è´¢å°ç”¨äº†ã€‚æ‰€ä»¥å°±å€Ÿé‰´ä¸€ä¸‹å…¶æ–¹æ³•ï¼Œè‡ªå·±å°è£…ä¸€ä¸ªã€‚æ„Ÿè§‰æœ‰æ›´é«˜çš„è‡ªå®šä¹‰æ€§å§ã€‚ï¼ˆæˆ‘æ˜¯åˆå­¦è€…ï¼Œè¯·å¤§ä½¬çˆ±æŠ¤ï¼Œå‹¿å–·ï¼‰<br>ä¸€ã€å°è£…ä»£ç ï¼šåˆ©ç”¨UIScrollViewçš„åˆ†ç±»å®ç°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;UIKit&#x2F;UIKit.h&gt;</span><br><span class="line"></span><br><span class="line">NS_ASSUME_NONNULL_BEGIN</span><br><span class="line"></span><br><span class="line">@interface UIScrollView (WD_NoData)</span><br><span class="line">&#x2F;&#x2F; éœ€è¦æ˜¾ç¤ºçš„å ä½é¡µé¢</span><br><span class="line">@property (nonatomic, strong) UIView *noDataView;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">NS_ASSUME_NONNULL_END</span><br></pre></td></tr></table></figure><p>å®ç°ä»£ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;UIScrollView+WD_NoData.h&quot;</span><br><span class="line">#import &lt;objc&#x2F;runtime.h&gt;</span><br><span class="line"></span><br><span class="line">static char *noDataViewKey &#x3D; &quot;noDataViewKey&quot;;</span><br><span class="line"></span><br><span class="line">@implementation UIScrollView (WD_NoData)</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> äº¤æ¢æ–¹æ³•</span><br><span class="line"></span><br><span class="line"> @param sel1 åŸæ–¹æ³•</span><br><span class="line"> @param sel2 è‡ªå®šä¹‰æ–¹æ³•</span><br><span class="line"> @param cls ç±»</span><br><span class="line"> *&#x2F;</span><br><span class="line">void exchangeSelector(SEL sel1, SEL sel2, Class cls) &#123;</span><br><span class="line">    Class class &#x3D; [cls class];</span><br><span class="line">    Method originalMethod &#x3D; class_getInstanceMethod(class, sel1);</span><br><span class="line">    Method swizzledMethod &#x3D; class_getInstanceMethod(class, sel2);</span><br><span class="line">    BOOL success &#x3D; class_addMethod(class, sel1, method_getImplementation(swizzledMethod), method_getTypeEncoding(swizzledMethod));</span><br><span class="line">    if (success) &#123;</span><br><span class="line">        class_replaceMethod(class, sel2, method_getImplementation(originalMethod), method_getTypeEncoding(originalMethod));</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        method_exchangeImplementations(originalMethod, swizzledMethod);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; Setter &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">- (void)setNoDataView:(UIView *)noDataView &#123;</span><br><span class="line">    static dispatch_once_t onceToken;</span><br><span class="line">    dispatch_once(&amp;onceToken, ^&#123;</span><br><span class="line">        exchangeSelector(@selector(reloadData), @selector(wd_reloadData), [self class]);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    objc_setAssociatedObject(self, noDataViewKey, noDataView, OBJC_ASSOCIATION_RETAIN_NONATOMIC);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; Getter &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">- (UIView *)noDataView &#123;</span><br><span class="line">    UIView *noDataView &#x3D; objc_getAssociatedObject(self, noDataViewKey);</span><br><span class="line">    noDataView.frame &#x3D; self.frame;</span><br><span class="line">    return noDataView;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (void)wd_reloadData &#123;</span><br><span class="line">    [self wd_reloadData];</span><br><span class="line">    [self wd_checkData];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; è·å–æ•°æ® &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">- (void)wd_checkData &#123;</span><br><span class="line">    NSInteger items &#x3D; 0;</span><br><span class="line">    </span><br><span class="line">    if (![self respondsToSelector:@selector(dataSource)]) &#123;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; UITableView support</span><br><span class="line">    if ([self isKindOfClass:[UITableView class]]) &#123;</span><br><span class="line">        </span><br><span class="line">        UITableView *tableView &#x3D; (UITableView *)self;</span><br><span class="line">        id &lt;UITableViewDataSource&gt; dataSource &#x3D; tableView.dataSource;</span><br><span class="line">        </span><br><span class="line">        NSInteger sections &#x3D; 1;</span><br><span class="line">        </span><br><span class="line">        if (dataSource &amp;&amp; [dataSource respondsToSelector:@selector(numberOfSectionsInTableView:)]) &#123;</span><br><span class="line">            sections &#x3D; [dataSource numberOfSectionsInTableView:tableView];</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        if (dataSource &amp;&amp; [dataSource respondsToSelector:@selector(tableView:numberOfRowsInSection:)]) &#123;</span><br><span class="line">            for (NSInteger section &#x3D; 0; section &lt; sections; section++) &#123;</span><br><span class="line">                items +&#x3D; [dataSource tableView:tableView numberOfRowsInSection:section];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;&#x2F; UICollectionView support</span><br><span class="line">    else if ([self isKindOfClass:[UICollectionView class]]) &#123;</span><br><span class="line">        </span><br><span class="line">        UICollectionView *collectionView &#x3D; (UICollectionView *)self;</span><br><span class="line">        id &lt;UICollectionViewDataSource&gt; dataSource &#x3D; collectionView.dataSource;</span><br><span class="line">        </span><br><span class="line">        NSInteger sections &#x3D; 1;</span><br><span class="line">        </span><br><span class="line">        if (dataSource &amp;&amp; [dataSource respondsToSelector:@selector(numberOfSectionsInCollectionView:)]) &#123;</span><br><span class="line">            sections &#x3D; [dataSource numberOfSectionsInCollectionView:collectionView];</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        if (dataSource &amp;&amp; [dataSource respondsToSelector:@selector(collectionView:numberOfItemsInSection:)]) &#123;</span><br><span class="line">            for (NSInteger section &#x3D; 0; section &lt; sections; section++) &#123;</span><br><span class="line">                items +&#x3D; [dataSource collectionView:collectionView numberOfItemsInSection:section];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if ( items &#x3D;&#x3D; 0 ) &#123;</span><br><span class="line">        [self.superview addSubview:self.noDataView];</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        [self.noDataView removeFromSuperview];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure><p>äºŒã€ä½¿ç”¨æ–¹æ³•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;UIScrollView+WD_NoData.h&quot;</span><br><span class="line">&#x2F;&#x2F; è‡ªå®šä¹‰é¡µé¢</span><br><span class="line">#import &quot;WDTestEmptyView.h&quot;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;ç¤ºä¾‹çš„è§†å›¾</span><br><span class="line"> WDTestEmptyView *view &#x3D; [NSBundle.mainBundle loadNibNamed:@&quot;WDTestEmptyView&quot; owner:self options:nil].firstObject;</span><br><span class="line">&#x2F;&#x2F; è®¾ç½®è§†å›¾</span><br><span class="line">self.tableView.noDataView &#x3D; view;</span><br></pre></td></tr></table></figure><p>ä¸‰ã€æ•ˆæœå›¾</p><p><img src="https://s2.ax1x.com/2020/01/17/lz5xRs.gif" alt="æ•ˆæœå›¾.gif"></p>]]></content>
      
      
      <categories>
          
          <category> Objective-C </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è‡ªå®šä¹‰æ§ä»¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iOSè‡ªå®šä¹‰æ§ä»¶-PopMenu</title>
      <link href="/2020/01/16/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-PopMenu/"/>
      <url>/2020/01/16/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-PopMenu/</url>
      
        <content type="html"><![CDATA[<p>ç°åœ¨å¾ˆå¤šçš„åº”ç”¨éƒ½æœ‰ç±»ä¼¼çš„å¼¹çª—æ§ä»¶ï¼Œæœ€å‡ºååº”è¯¥æ˜¯ä¼é¹…å’Œå¾®ä¿¡äº†å§ã€‚æƒ³ç€ä¸ºäº†æ»¡è¶³è‡ªå·±çš„æ•ˆæœå°±åŠ¨æ‰‹å†™äº†è¿™ä¸ªã€‚é¦–å…ˆè¦æ„Ÿè°¢å†™å‡ºå¼¹çª—ç®­å¤´çš„ä»£ç çš„äºº<a href="https://github.com/iHandle/BubbleLayer" target="_blank" rel="noopener">iHandle</a>ï¼Œè¿™æ–¹é¢çš„çŸ¥è¯†æˆ‘å¾ˆæ¬ ç¼ºï¼Œä»¥åæ‰¾æœºä¼šæ¶è¡¥ä¸€ä¸‹ã€‚<br>å…ˆä¸Šä¸¤å¼ å‡ºåçš„æ•ˆæœå›¾ï¼š<br><img src="https://s2.ax1x.com/2020/01/17/lzowcR.png" alt="ğŸ§"></p><p><img src="https://s2.ax1x.com/2020/01/17/lzoHUS.png" alt="å¾®ä¿¡"></p><h2 id="æ ·å¼å®šä¹‰"><a href="#æ ·å¼å®šä¹‰" class="headerlink" title="æ ·å¼å®šä¹‰"></a>æ ·å¼å®šä¹‰</h2><p>ä¸»è¦ä»¥UITableViewä½œä¸ºå®¹å™¨æ˜¾ç¤ºæ ·å¼</p><ol><li>èƒŒæ™¯é¢œè‰²</li><li>æ–‡å­—æ ·å¼ï¼šé¢œè‰²ï¼Œå­—ä½“å¤§å°ï¼Œå¯¹é½æ–¹å¼</li><li>æ˜¾ç¤ºç±»å‹ï¼šä»…æ–‡å­—ï¼Œä»…å›¾æ ‡ï¼Œæ–‡å­— + å›¾æ ‡</li><li>æ˜¯å¦æ˜¾ç¤ºä¸‹åˆ’çº¿</li><li>ç®­å¤´æ–¹å‘</li><li>å¼¹çª—å®½åº¦</li><li>å•å…ƒæ ¼çš„é«˜åº¦ </li></ol><h2 id="ç®­å¤´ç”Ÿæˆ"><a href="#ç®­å¤´ç”Ÿæˆ" class="headerlink" title="ç®­å¤´ç”Ÿæˆ"></a>ç®­å¤´ç”Ÿæˆ</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line">typedef NS_ENUM(NSInteger, ArrowDirection) &#123;</span><br><span class="line">    ArrowDirectionRight &#x3D; 0,</span><br><span class="line">    ArrowDirectionBottom,</span><br><span class="line">    ArrowDirectionLeft,</span><br><span class="line">    ArrowDirectionTop,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">#define CORNER_RADIUS   8   &#x2F;&#x2F; é»˜è®¤çŸ©å½¢æ¡†åœ†è§’åŠå¾„</span><br><span class="line">#define ARROW_WIDTH     30  &#x2F;&#x2F; é»˜è®¤ç®­å¤´å®½å¸¦</span><br><span class="line">#define ARROW_HEIGHT    12  &#x2F;&#x2F; é»˜è®¤ç®­å¤´é«˜åº¦</span><br><span class="line">#define ARROW_DIRECTION 1   &#x2F;&#x2F; é»˜è®¤ç®­å¤´æ–¹å‘ï¼Œå‘ä¸‹</span><br><span class="line">#define ARROW_POSITION  0.5 &#x2F;&#x2F; é»˜è®¤ç®­å¤´ç›¸å¯¹ä½ç½®ï¼Œå±…ä¸­</span><br><span class="line">#define ARROW_RADIUS    3   &#x2F;&#x2F; é»˜è®¤ç®­å¤´æŒ‡å‘å¤„çš„åœ†è§’åŠå¾„</span><br><span class="line"></span><br><span class="line">@interface WudanLayer : NSObject</span><br><span class="line">@property (nonatomic, assign) CGFloat cornerRadius;</span><br><span class="line">@property (nonatomic, assign) CGFloat arrowRadius;</span><br><span class="line">@property (nonatomic, assign) CGFloat arrowHeight;</span><br><span class="line">@property (nonatomic, assign) CGFloat arrowWidth;</span><br><span class="line">@property (nonatomic, assign) ArrowDirection arrowDirection;</span><br><span class="line">@property (nonatomic, assign) CGFloat arrowPosition;</span><br><span class="line">@property (nonatomic, assign) CGSize size;</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithSize:(CGSize)size;</span><br><span class="line">- (CAShapeLayer *)layer;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation WudanLayer</span><br><span class="line"></span><br><span class="line">#pragma mark - preparation</span><br><span class="line">- (NSMutableArray *)keyPoints &#123;</span><br><span class="line">    NSMutableArray *points &#x3D; [NSMutableArray array];</span><br><span class="line">    CGPoint beginPoint;</span><br><span class="line">    CGPoint topPoint;</span><br><span class="line">    CGPoint endPoint;</span><br><span class="line">    CGFloat validWidthForTopPoint &#x3D; _size.width - 2 * _cornerRadius - _arrowWidth;</span><br><span class="line">    CGFloat validHeightForTopPoint &#x3D; _size.height - 2 * _cornerRadius - _arrowWidth;</span><br><span class="line">    CGFloat x &#x3D; 0, y &#x3D; 0;</span><br><span class="line">    CGFloat width &#x3D; _size.width, height &#x3D; _size.height;</span><br><span class="line">    </span><br><span class="line">    switch (_arrowDirection)</span><br><span class="line">    &#123;</span><br><span class="line">        case ArrowDirectionRight:</span><br><span class="line">        &#123;</span><br><span class="line">            width -&#x3D; _arrowHeight;</span><br><span class="line">            topPoint &#x3D; CGPointMake(_size.width , _size.height &#x2F; 2 + validHeightForTopPoint*(_arrowPosition - 0.5));</span><br><span class="line">            beginPoint &#x3D; CGPointMake(topPoint.x - _arrowHeight, topPoint.y - _arrowWidth&#x2F;2);</span><br><span class="line">            endPoint &#x3D; CGPointMake(beginPoint.x, beginPoint.y + _arrowWidth);</span><br><span class="line">        &#125;</span><br><span class="line">            break;</span><br><span class="line">        case ArrowDirectionBottom:</span><br><span class="line">        &#123;</span><br><span class="line">            height -&#x3D; _arrowHeight;</span><br><span class="line">            </span><br><span class="line">            topPoint &#x3D; CGPointMake(_size.width &#x2F; 2 + validWidthForTopPoint*(_arrowPosition - 0.5), _size.height);</span><br><span class="line">            beginPoint &#x3D; CGPointMake(topPoint.x + _arrowWidth&#x2F;2, topPoint.y - _arrowHeight);</span><br><span class="line">            endPoint &#x3D; CGPointMake(beginPoint.x - _arrowWidth, beginPoint.y);</span><br><span class="line">        &#125;</span><br><span class="line">            break;</span><br><span class="line">        case ArrowDirectionLeft:</span><br><span class="line">        &#123;</span><br><span class="line">            x &#x3D; _arrowHeight;</span><br><span class="line">            width -&#x3D; _arrowHeight;</span><br><span class="line">            </span><br><span class="line">            topPoint &#x3D; CGPointMake(0, _size.height &#x2F; 2 + validHeightForTopPoint*(_arrowPosition - 0.5));</span><br><span class="line">            beginPoint &#x3D; CGPointMake(topPoint.x + _arrowHeight, topPoint.y + _arrowWidth&#x2F;2);</span><br><span class="line">            endPoint &#x3D; CGPointMake(beginPoint.x, beginPoint.y - _arrowWidth);</span><br><span class="line">        &#125;</span><br><span class="line">            break;</span><br><span class="line">        case ArrowDirectionTop:</span><br><span class="line">        &#123;</span><br><span class="line">            y &#x3D; _arrowHeight;</span><br><span class="line">            height -&#x3D; _arrowHeight;</span><br><span class="line">            </span><br><span class="line">            topPoint &#x3D; CGPointMake(_size.width &#x2F; 2 + validWidthForTopPoint*(_arrowPosition - 0.5), 0);</span><br><span class="line">            beginPoint &#x3D; CGPointMake(topPoint.x - _arrowWidth&#x2F;2, topPoint.y + _arrowHeight);</span><br><span class="line">            endPoint &#x3D; CGPointMake(beginPoint.x + _arrowWidth, beginPoint.y);</span><br><span class="line">        &#125;</span><br><span class="line">            break;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    points &#x3D; [NSMutableArray arrayWithObjects: [NSValue valueWithCGPoint:beginPoint],</span><br><span class="line">              [NSValue valueWithCGPoint:topPoint],</span><br><span class="line">              [NSValue valueWithCGPoint:endPoint],</span><br><span class="line">              nil];</span><br><span class="line">    CGPoint bottomRight &#x3D; CGPointMake(x + width, y + height);</span><br><span class="line">    CGPoint bottomLeft &#x3D; CGPointMake(x, y + height);</span><br><span class="line">    CGPoint topLeft &#x3D; CGPointMake(x, y);</span><br><span class="line">    CGPoint topRight &#x3D; CGPointMake(x + width, y);</span><br><span class="line">    NSMutableArray *rectPoints &#x3D; [NSMutableArray arrayWithObjects: [NSValue valueWithCGPoint:bottomRight],</span><br><span class="line">                                  [NSValue valueWithCGPoint:bottomLeft],</span><br><span class="line">                                  [NSValue valueWithCGPoint:topLeft],</span><br><span class="line">                                  [NSValue valueWithCGPoint:topRight],</span><br><span class="line">                                  nil];</span><br><span class="line">    int rectPointIndex &#x3D; (int)_arrowDirection;</span><br><span class="line">    for(int i &#x3D; 0; i &lt; 4; ++i) &#123;</span><br><span class="line">        [points addObject:[rectPoints objectAtIndex:rectPointIndex]];</span><br><span class="line">        rectPointIndex &#x3D; (rectPointIndex + 1) % 4;</span><br><span class="line">    &#125;</span><br><span class="line">    return points;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - Draw bubblePath</span><br><span class="line">- (CGPathRef)bubblePath &#123;</span><br><span class="line">    UIGraphicsBeginImageContextWithOptions(self.size, NO, 0.0);</span><br><span class="line">    CGContextRef ctx &#x3D; UIGraphicsGetCurrentContext();</span><br><span class="line">    NSMutableArray *points &#x3D; [self keyPoints];</span><br><span class="line">    CGPoint currentPoint &#x3D; [[points objectAtIndex:6] CGPointValue];</span><br><span class="line">    CGContextMoveToPoint(ctx, currentPoint.x, currentPoint.y);</span><br><span class="line">    CGPoint pointA, pointB;</span><br><span class="line">    CGFloat radius;</span><br><span class="line">    int i &#x3D; 0;</span><br><span class="line">    while(1) &#123;</span><br><span class="line">        if (i &gt; 6)</span><br><span class="line">            break;</span><br><span class="line">        radius &#x3D; i &lt; 3 ?  _arrowRadius : _cornerRadius;</span><br><span class="line">        pointA &#x3D; [[points objectAtIndex:i] CGPointValue];</span><br><span class="line">        pointB &#x3D; [[points objectAtIndex:(i + 1) % 7] CGPointValue];</span><br><span class="line">        CGContextAddArcToPoint(ctx, pointA.x, pointA.y, pointB.x, pointB.y, radius);</span><br><span class="line">        i &#x3D; i + 1;</span><br><span class="line">    &#125;</span><br><span class="line">    CGContextClosePath(ctx);</span><br><span class="line">    CGPathRef path &#x3D; CGContextCopyPath(ctx);</span><br><span class="line">    CGContextRelease(ctx);</span><br><span class="line">    return path;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (CAShapeLayer *)layer&#123;</span><br><span class="line">    CAShapeLayer *layer &#x3D; [CAShapeLayer layer];</span><br><span class="line">    layer.path &#x3D; [self bubblePath];</span><br><span class="line">    return layer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - Setup</span><br><span class="line">- (void)setDefaultProperty &#123;</span><br><span class="line">    _cornerRadius   &#x3D; CORNER_RADIUS;</span><br><span class="line">    _arrowWidth     &#x3D; ARROW_WIDTH;</span><br><span class="line">    _arrowHeight    &#x3D; ARROW_HEIGHT;</span><br><span class="line">    _arrowDirection &#x3D; ARROW_DIRECTION;</span><br><span class="line">    _arrowPosition  &#x3D; ARROW_POSITION;</span><br><span class="line">    _arrowRadius    &#x3D; ARROW_RADIUS;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - Init</span><br><span class="line">- (instancetype)initWithSize:(CGSize)size &#123;</span><br><span class="line">    if(self &#x3D; [super init]) &#123;</span><br><span class="line">        [self setDefaultProperty];</span><br><span class="line">        _size &#x3D; size;</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure><h2 id="å•å…ƒæ ¼é»˜è®¤æ ·å¼"><a href="#å•å…ƒæ ¼é»˜è®¤æ ·å¼" class="headerlink" title="å•å…ƒæ ¼é»˜è®¤æ ·å¼"></a>å•å…ƒæ ¼é»˜è®¤æ ·å¼</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">typedef NS_ENUM(NSInteger, WDPopMenuType) &#123;</span><br><span class="line">    WDPopMenuTypeNormal,</span><br><span class="line">    WDPopMenuTypeOnlyTitle,</span><br><span class="line">    WDPopMenuTypeOnlyIcon,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">@interface WDPopMenuCell : UITableViewCell</span><br><span class="line">@property (nonatomic, strong) UIImageView *iconImageView;</span><br><span class="line">@property (nonatomic, strong) UILabel *titleLabel;</span><br><span class="line">@property (nonatomic, assign) WDPopMenuType showType;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation WDPopMenuCell</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithStyle:(UITableViewCellStyle)style reuseIdentifier:(NSString *)reuseIdentifier &#123;</span><br><span class="line">    self &#x3D; [super initWithStyle:style reuseIdentifier:reuseIdentifier];</span><br><span class="line">    if (self) &#123;</span><br><span class="line">        [self setupSubViewsProperties];</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)setupSubViewsProperties &#123;</span><br><span class="line">    self.iconImageView                                           &#x3D; [[UIImageView alloc] init];</span><br><span class="line">    self.iconImageView.contentMode                               &#x3D; UIViewContentModeScaleAspectFit;</span><br><span class="line">    self.iconImageView.translatesAutoresizingMaskIntoConstraints &#x3D; NO;</span><br><span class="line">    [self.contentView addSubview:self.iconImageView];</span><br><span class="line"></span><br><span class="line">    self.titleLabel                                              &#x3D; [[UILabel alloc] init];</span><br><span class="line">    self.titleLabel.font                                         &#x3D; [UIFont systemFontOfSize:15];</span><br><span class="line">    self.titleLabel.textColor                                    &#x3D; [UIColor blackColor];</span><br><span class="line">    self.titleLabel.translatesAutoresizingMaskIntoConstraints    &#x3D; NO;</span><br><span class="line">    [self.contentView addSubview:self.titleLabel];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)setShowType:(WDPopMenuType)showType &#123;</span><br><span class="line">    _showType &#x3D; showType;</span><br><span class="line">    [self setupSubViewsConstraint];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)setTitleLabel:(UILabel *)titleLabel &#123;</span><br><span class="line">    _titleLabel &#x3D; titleLabel;</span><br><span class="line">    titleLabel.translatesAutoresizingMaskIntoConstraints &#x3D; NO;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)setupSubViewsConstraint &#123;</span><br><span class="line">    if (self.showType &#x3D;&#x3D; WDPopMenuTypeNormal) &#123;</span><br><span class="line">        self.titleLabel.textAlignment &#x3D; NSTextAlignmentLeft;</span><br><span class="line">        </span><br><span class="line">        [self.contentView addConstraints:@[</span><br><span class="line">                                           [NSLayoutConstraint constraintWithItem:self.iconImageView attribute:NSLayoutAttributeLeading relatedBy:NSLayoutRelationEqual toItem:self.contentView attribute:NSLayoutAttributeLeading multiplier:1 constant:15],</span><br><span class="line">                                           [NSLayoutConstraint constraintWithItem:self.iconImageView attribute:NSLayoutAttributeCenterY relatedBy:NSLayoutRelationEqual toItem:self.contentView attribute:NSLayoutAttributeCenterY multiplier:1 constant:0],</span><br><span class="line">                                           ]];</span><br><span class="line">        </span><br><span class="line">        [self.contentView addConstraints:@[</span><br><span class="line">                                           [NSLayoutConstraint constraintWithItem:self.titleLabel attribute:NSLayoutAttributeLeading relatedBy:NSLayoutRelationEqual toItem:self.iconImageView attribute:NSLayoutAttributeTrailing multiplier:1 constant:10],</span><br><span class="line">                                           [NSLayoutConstraint constraintWithItem:self.titleLabel attribute:NSLayoutAttributeCenterY relatedBy:NSLayoutRelationEqual toItem:self.contentView attribute:NSLayoutAttributeCenterY multiplier:1 constant:0],</span><br><span class="line">                                           ]];</span><br><span class="line">    &#125; else if (self.showType &#x3D;&#x3D; WDPopMenuTypeOnlyTitle)&#123;</span><br><span class="line">        self.titleLabel.textAlignment &#x3D; NSTextAlignmentCenter;</span><br><span class="line">        [self.contentView addConstraints:@[</span><br><span class="line">                                           [NSLayoutConstraint constraintWithItem:self.titleLabel attribute:NSLayoutAttributeCenterX relatedBy:NSLayoutRelationEqual toItem:self.contentView attribute:NSLayoutAttributeCenterX multiplier:1 constant:0],</span><br><span class="line">                                           [NSLayoutConstraint constraintWithItem:self.titleLabel attribute:NSLayoutAttributeCenterY relatedBy:NSLayoutRelationEqual toItem:self.contentView attribute:NSLayoutAttributeCenterY multiplier:1 constant:0],</span><br><span class="line">                                           ]];</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        [self.contentView addConstraints:@[</span><br><span class="line">                                           [NSLayoutConstraint constraintWithItem:self.iconImageView attribute:NSLayoutAttributeCenterX relatedBy:NSLayoutRelationEqual toItem:self.contentView attribute:NSLayoutAttributeCenterX multiplier:1 constant:0],</span><br><span class="line">                                           [NSLayoutConstraint constraintWithItem:self.iconImageView attribute:NSLayoutAttributeCenterY relatedBy:NSLayoutRelationEqual toItem:self.contentView attribute:NSLayoutAttributeCenterY multiplier:1 constant:0],</span><br><span class="line">                                           ]];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure><h2 id="æ¥å£ä»£ç "><a href="#æ¥å£ä»£ç " class="headerlink" title="æ¥å£ä»£ç "></a>æ¥å£ä»£ç </h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;UIKit&#x2F;UIKit.h&gt;</span><br><span class="line"></span><br><span class="line">NS_ASSUME_NONNULL_BEGIN</span><br><span class="line"></span><br><span class="line">@interface WDPopMenu : UIView</span><br><span class="line">@property (nonatomic, copy, readonly) NSArray&lt;NSString *&gt; *titles;</span><br><span class="line">@property (nonatomic, copy, readonly) NSArray&lt;NSString *&gt; *iconImageNames;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> ä»…æ˜¾ç¤ºå›¾æ ‡ + é»˜è®¤æ ·å¼</span><br><span class="line"> </span><br><span class="line"> @param iconImageNames å›¾æ ‡æ•°ç»„</span><br><span class="line"> @param position åˆå§‹ä½ç½®</span><br><span class="line"> @param complete ç‚¹å‡»å›è°ƒ</span><br><span class="line"> *&#x2F;</span><br><span class="line">+ (void)showPopMenuWithIconImageNames:(NSArray&lt;NSString *&gt; *)iconImageNames</span><br><span class="line">                       originPosition:(CGPoint)position</span><br><span class="line">                 selectedItemComplete:(void(^)(NSInteger currentIndex))complete;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> ä»…æ˜¾ç¤ºå›¾æ ‡ + é»˜è®¤æ ·å¼</span><br><span class="line"> </span><br><span class="line"> @param iconImageNames å›¾æ ‡æ•°ç»„</span><br><span class="line"> @param position åˆå§‹ä½ç½®</span><br><span class="line"> @param isNeedSeparatorLine æ˜¯å¦æ˜¾ç¤ºåˆ†å‰²çº¿</span><br><span class="line"> @param complete ç‚¹å‡»å›è°ƒ</span><br><span class="line"> *&#x2F;</span><br><span class="line">+ (void)showPopMenuWithIconImageNames:(NSArray&lt;NSString *&gt; *)iconImageNames</span><br><span class="line">                       originPosition:(CGPoint)position</span><br><span class="line">                    needSeparatorLine:(BOOL)isNeedSeparatorLine</span><br><span class="line">                 selectedItemComplete:(void(^)(NSInteger currentIndex))complete;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> ä»…æ˜¾ç¤ºæ ‡é¢˜ + é»˜è®¤æ ·å¼</span><br><span class="line"> </span><br><span class="line"> @param titles æ ‡é¢˜æ•°ç»„</span><br><span class="line"> @param position åˆå§‹ä½ç½®</span><br><span class="line"> @param complete ç‚¹å‡»å›è°ƒ</span><br><span class="line"> *&#x2F;</span><br><span class="line">+ (void)showPopMenuWithTitles:(NSArray&lt;NSString *&gt; *)titles</span><br><span class="line">               originPosition:(CGPoint)position</span><br><span class="line">         selectedItemComplete:(void(^)(NSInteger currentIndex))complete;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> ä»…æ˜¾ç¤ºæ ‡é¢˜ + é»˜è®¤æ ·å¼</span><br><span class="line"> </span><br><span class="line"> @param titles æ ‡é¢˜æ•°ç»„</span><br><span class="line"> @param position åˆå§‹ä½ç½®</span><br><span class="line"> @param isNeedSeparatorLine æ˜¯å¦æ˜¾ç¤ºåˆ†å‰²çº¿</span><br><span class="line"> @param complete ç‚¹å‡»å›è°ƒ</span><br><span class="line"> *&#x2F;</span><br><span class="line">+ (void)showPopMenuWithTitles:(NSArray&lt;NSString *&gt; *)titles</span><br><span class="line">               originPosition:(CGPoint)position</span><br><span class="line">            needSeparatorLine:(BOOL)isNeedSeparatorLine</span><br><span class="line">         selectedItemComplete:(void(^)(NSInteger currentIndex))complete;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> æ˜¾ç¤ºæ–‡å­—å’Œå›¾æ ‡ + é»˜è®¤æ ·å¼</span><br><span class="line"> </span><br><span class="line"> @param iconImageNames å›¾æ ‡æ•°ç»„</span><br><span class="line"> @param titles æ ‡é¢˜æ•°ç»„</span><br><span class="line"> @param position åˆå§‹ä½ç½®</span><br><span class="line"> @param complete ç‚¹å‡»å›è°ƒ</span><br><span class="line"> *&#x2F;</span><br><span class="line">+ (void)showPopMenuWithIconImageNames:(NSArray&lt;NSString *&gt; * _Nullable)iconImageNames</span><br><span class="line">                               titles:(NSArray&lt;NSString *&gt; * _Nullable)titles</span><br><span class="line">                       originPosition:(CGPoint)position</span><br><span class="line">                 selectedItemComplete:(void(^)(NSInteger currentIndex))complete;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> æ˜¾ç¤ºæ–‡å­—å’Œå›¾æ ‡ + é»˜è®¤æ ·å¼</span><br><span class="line"> </span><br><span class="line"> @param iconImageNames å›¾æ ‡æ•°ç»„</span><br><span class="line"> @param titles æ ‡é¢˜æ•°ç»„</span><br><span class="line"> @param position åˆå§‹ä½ç½®</span><br><span class="line"> @param isNeedSeparatorLine æ˜¯å¦æ˜¾ç¤ºåˆ†å‰²çº¿</span><br><span class="line"> @param complete ç‚¹å‡»å›è°ƒ</span><br><span class="line"> *&#x2F;</span><br><span class="line">+ (void)showPopMenuWithIconImageNames:(NSArray&lt;NSString *&gt; * _Nullable)iconImageNames</span><br><span class="line">                               titles:(NSArray&lt;NSString *&gt; * _Nullable)titles</span><br><span class="line">                       originPosition:(CGPoint)position</span><br><span class="line">                    needSeparatorLine:(BOOL)isNeedSeparatorLine</span><br><span class="line">                 selectedItemComplete:(void(^)(NSInteger currentIndex))complete;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> å¯é€‰æ˜¾ç¤ºå›¾æ ‡ã€æ ‡é¢˜</span><br><span class="line"> </span><br><span class="line"> @param iconImageNames å›¾ç‰‡æ•°ç»„ å¯ä»¥ä¸ºç©º</span><br><span class="line"> @param titles æ ‡é¢˜æ•°ç»„ å¯ä»¥ä¸ºç©º</span><br><span class="line"> @param position åˆå§‹ä½ç½®</span><br><span class="line"> @param height å•ä¸ªitemé«˜åº¦ é»˜è®¤ä¸º45</span><br><span class="line"> @param width æ˜¾ç¤ºViewçš„é«˜åº¦ é»˜è®¤ä¸ºå±å¹•å®½åº¦çš„ä¸€åŠ</span><br><span class="line"> @param color æ˜¾ç¤ºViewçš„èƒŒæ™¯é¢œè‰²</span><br><span class="line"> @param isNeedSeparatorLine æ˜¯å¦æ˜¾ç¤ºåˆ†å‰²çº¿</span><br><span class="line"> @param complete ç‚¹å‡»å›è°ƒ</span><br><span class="line"> *&#x2F;</span><br><span class="line">+ (void)showPopMenuWithIconImageNames:(NSArray&lt;NSString *&gt; * _Nullable)iconImageNames</span><br><span class="line">                               titles:(NSArray&lt;NSString *&gt; * _Nullable)titles</span><br><span class="line">                       originPosition:(CGPoint)position</span><br><span class="line">                         heightOfItem:(CGFloat)height</span><br><span class="line">                          widthOfView:(CGFloat)width</span><br><span class="line">                backgroundColorOfView:(UIColor *)color</span><br><span class="line">                    needSeparatorLine:(BOOL)isNeedSeparatorLine</span><br><span class="line">                 selectedItemComplete:(void(^)(NSInteger currentIndex))complete;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> å¯é€‰æ˜¾ç¤ºå›¾æ ‡ã€æ ‡é¢˜</span><br><span class="line"> </span><br><span class="line"> @param iconImageNames å›¾ç‰‡æ•°ç»„ å¯ä»¥ä¸ºç©º</span><br><span class="line"> @param titles æ ‡é¢˜æ•°ç»„ å¯ä»¥ä¸ºç©º</span><br><span class="line"> @param position åˆå§‹ä½ç½®</span><br><span class="line"> @param height å•ä¸ªitemé«˜åº¦ é»˜è®¤ä¸º45</span><br><span class="line"> @param width æ˜¾ç¤ºViewçš„é«˜åº¦ é»˜è®¤ä¸ºå±å¹•å®½åº¦çš„ä¸€åŠ</span><br><span class="line"> @param color æ˜¾ç¤ºViewçš„èƒŒæ™¯é¢œè‰²</span><br><span class="line"> @param isNeedSeparatorLine æ˜¯å¦æ˜¾ç¤ºåˆ†å‰²çº¿</span><br><span class="line"> @param titleLabel è‡ªå®šä¹‰Itemçš„Labelæ ·å¼</span><br><span class="line"> @param complete ç‚¹å‡»å›è°ƒ</span><br><span class="line"> *&#x2F;</span><br><span class="line">+ (void)showPopMenuWithIconImageNames:(NSArray&lt;NSString *&gt; * _Nullable)iconImageNames</span><br><span class="line">                               titles:(NSArray&lt;NSString *&gt; * _Nullable)titles</span><br><span class="line">                       originPosition:(CGPoint)position</span><br><span class="line">                         heightOfItem:(CGFloat)height</span><br><span class="line">                          widthOfView:(CGFloat)width</span><br><span class="line">                backgroundColorOfView:(UIColor *)color</span><br><span class="line">                     titleLabelOfItem:(UILabel * _Nullable)titleLabel</span><br><span class="line">                    needSeparatorLine:(BOOL)isNeedSeparatorLine</span><br><span class="line">                 selectedItemComplete:(void(^)(NSInteger currentIndex))complete;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">NS_ASSUME_NONNULL_END</span><br></pre></td></tr></table></figure><h2 id="å®ç°ä»£ç "><a href="#å®ç°ä»£ç " class="headerlink" title="å®ç°ä»£ç "></a>å®ç°ä»£ç </h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br></pre></td><td class="code"><pre><span class="line">#define WD_SCREEN_WIDTH ([[UIScreen mainScreen] bounds].size.width)</span><br><span class="line">#define WD_SCREEN_HEIGHT ([[UIScreen mainScreen] bounds].size.height)</span><br><span class="line"></span><br><span class="line">@interface WDPopMenu () &lt;UITableViewDataSource, UITableViewDelegate&gt;</span><br><span class="line">@property (nonatomic, copy) void (^selectedItemComplete)(NSInteger currentIndex);</span><br><span class="line">@property (nonatomic, strong) UIView *backgroundView;</span><br><span class="line">@property (nonatomic, strong) UITableView *tableView;</span><br><span class="line">@property (nonatomic, strong) UILabel *titleLabel;</span><br><span class="line">@property (nonatomic, assign) CGFloat viewWidth;</span><br><span class="line">@property (nonatomic, assign) CGFloat itemHeight;</span><br><span class="line">@property (nonatomic, assign) CGPoint beginPosition;</span><br><span class="line">@property (nonatomic, strong) UIColor *cellColor;</span><br><span class="line">@property (nonatomic, copy, readwrite) NSArray&lt;NSString *&gt; *titles;</span><br><span class="line">@property (nonatomic, copy, readwrite) NSArray&lt;NSString *&gt; *iconImageNames;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation WDPopMenu</span><br><span class="line"></span><br><span class="line">- (instancetype)init &#123;</span><br><span class="line">    self &#x3D; [super init];</span><br><span class="line">    if (self) &#123;</span><br><span class="line">        [self addSubview:self.tableView];</span><br><span class="line">        UITapGestureRecognizer *tap &#x3D; [[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(backgroundTappedTarget:)];</span><br><span class="line">        [self.backgroundView addGestureRecognizer:tap];</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (void)showPopMenuWithIconImageNames:(NSArray&lt;NSString *&gt; *)iconImageNames</span><br><span class="line">                       originPosition:(CGPoint)position</span><br><span class="line">                 selectedItemComplete:(void(^)(NSInteger currentIndex))complete &#123;</span><br><span class="line">    </span><br><span class="line">    [self showPopMenuWithIconImageNames:iconImageNames</span><br><span class="line">                         originPosition:position</span><br><span class="line">                      needSeparatorLine:YES</span><br><span class="line">                   selectedItemComplete:complete];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (void)showPopMenuWithIconImageNames:(NSArray&lt;NSString *&gt; *)iconImageNames</span><br><span class="line">                       originPosition:(CGPoint)position</span><br><span class="line">                    needSeparatorLine:(BOOL)isNeedSeparatorLine</span><br><span class="line">                 selectedItemComplete:(void(^)(NSInteger currentIndex))complete &#123;</span><br><span class="line">    </span><br><span class="line">    [self showPopMenuWithIconImageNames:iconImageNames</span><br><span class="line">                                 titles:nil</span><br><span class="line">                         originPosition:position</span><br><span class="line">                      needSeparatorLine:isNeedSeparatorLine</span><br><span class="line">                   selectedItemComplete:complete];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (void)showPopMenuWithTitles:(NSArray&lt;NSString *&gt; *)titles</span><br><span class="line">               originPosition:(CGPoint)position</span><br><span class="line">         selectedItemComplete:(void(^)(NSInteger currentIndex))complete &#123;</span><br><span class="line">    </span><br><span class="line">    [self showPopMenuWithTitles:titles</span><br><span class="line">                 originPosition:position</span><br><span class="line">              needSeparatorLine:YES</span><br><span class="line">           selectedItemComplete:complete];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (void)showPopMenuWithTitles:(NSArray&lt;NSString *&gt; *)titles</span><br><span class="line">               originPosition:(CGPoint)position</span><br><span class="line">            needSeparatorLine:(BOOL)isNeedSeparatorLine</span><br><span class="line">         selectedItemComplete:(void(^)(NSInteger currentIndex))complete &#123;</span><br><span class="line">    </span><br><span class="line">    [self showPopMenuWithIconImageNames:nil</span><br><span class="line">                                 titles:titles</span><br><span class="line">                         originPosition:position</span><br><span class="line">                      needSeparatorLine:isNeedSeparatorLine</span><br><span class="line">                   selectedItemComplete:complete];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (void)showPopMenuWithIconImageNames:(NSArray&lt;NSString *&gt; * _Nullable)iconImageNames</span><br><span class="line">                               titles:(NSArray&lt;NSString *&gt; * _Nullable)titles</span><br><span class="line">                       originPosition:(CGPoint)position</span><br><span class="line">                 selectedItemComplete:(void(^)(NSInteger currentIndex))complete &#123;</span><br><span class="line">    </span><br><span class="line">    [self showPopMenuWithIconImageNames:iconImageNames</span><br><span class="line">                                 titles:titles</span><br><span class="line">                         originPosition:position</span><br><span class="line">                      needSeparatorLine:YES</span><br><span class="line">                   selectedItemComplete:complete];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (void)showPopMenuWithIconImageNames:(NSArray&lt;NSString *&gt; * _Nullable)iconImageNames</span><br><span class="line">                               titles:(NSArray&lt;NSString *&gt; * _Nullable)titles</span><br><span class="line">                       originPosition:(CGPoint)position</span><br><span class="line">                    needSeparatorLine:(BOOL)isNeedSeparatorLine</span><br><span class="line">                 selectedItemComplete:(void(^)(NSInteger currentIndex))complete &#123;</span><br><span class="line">    </span><br><span class="line">    [self showPopMenuWithIconImageNames:iconImageNames</span><br><span class="line">                                 titles:titles</span><br><span class="line">                         originPosition:position</span><br><span class="line">                           heightOfItem:0</span><br><span class="line">                            widthOfView:0</span><br><span class="line">                  backgroundColorOfView:[UIColor whiteColor]</span><br><span class="line">                      needSeparatorLine:isNeedSeparatorLine</span><br><span class="line">                   selectedItemComplete:complete];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (void)showPopMenuWithIconImageNames:(NSArray&lt;NSString *&gt; * _Nullable)iconImageNames</span><br><span class="line">                               titles:(NSArray&lt;NSString *&gt; * _Nullable)titles</span><br><span class="line">                       originPosition:(CGPoint)position</span><br><span class="line">                         heightOfItem:(CGFloat)height</span><br><span class="line">                          widthOfView:(CGFloat)width</span><br><span class="line">                backgroundColorOfView:(UIColor *)color</span><br><span class="line">                    needSeparatorLine:(BOOL)isNeedSeparatorLine</span><br><span class="line">                 selectedItemComplete:(void(^)(NSInteger currentIndex))complete &#123;</span><br><span class="line">    </span><br><span class="line">    [self showPopMenuWithIconImageNames:iconImageNames</span><br><span class="line">                                 titles:titles</span><br><span class="line">                         originPosition:position</span><br><span class="line">                           heightOfItem:height</span><br><span class="line">                            widthOfView:width</span><br><span class="line">                  backgroundColorOfView:color</span><br><span class="line">                       titleLabelOfItem:nil</span><br><span class="line">                      needSeparatorLine:isNeedSeparatorLine</span><br><span class="line">                   selectedItemComplete:complete];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (void)showPopMenuWithIconImageNames:(NSArray&lt;NSString *&gt; * _Nullable)iconImageNames</span><br><span class="line">                               titles:(NSArray&lt;NSString *&gt; * _Nullable)titles</span><br><span class="line">                       originPosition:(CGPoint)position</span><br><span class="line">                         heightOfItem:(CGFloat)height</span><br><span class="line">                          widthOfView:(CGFloat)width</span><br><span class="line">                backgroundColorOfView:(UIColor *)color</span><br><span class="line">                     titleLabelOfItem:(UILabel * _Nullable)titleLabel</span><br><span class="line">                    needSeparatorLine:(BOOL)isNeedSeparatorLine</span><br><span class="line">                 selectedItemComplete:(void(^)(NSInteger currentIndex))complete &#123;</span><br><span class="line">    </span><br><span class="line">    WDPopMenu *v                &#x3D; [[WDPopMenu alloc] init];</span><br><span class="line">    v.iconImageNames            &#x3D; iconImageNames;</span><br><span class="line">    v.titles                    &#x3D; titles;</span><br><span class="line">    v.beginPosition             &#x3D; position;</span><br><span class="line">    v.itemHeight                &#x3D; height &#x3D;&#x3D; 0 ? 45 : height;</span><br><span class="line">    v.viewWidth                 &#x3D; width &#x3D;&#x3D; 0 ? [[UIScreen mainScreen] bounds].size.width &#x2F; 2 : width;</span><br><span class="line">    v.tableView.backgroundColor &#x3D; color;</span><br><span class="line">    v.cellColor                 &#x3D; color;</span><br><span class="line">    v.titleLabel                &#x3D; titleLabel;</span><br><span class="line">    v.selectedItemComplete      &#x3D; complete;</span><br><span class="line">    v.tableView.rowHeight       &#x3D; v.itemHeight;</span><br><span class="line">    if (isNeedSeparatorLine) &#123;</span><br><span class="line">        v.tableView.separatorStyle  &#x3D; UITableViewCellSeparatorStyleSingleLine;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        v.tableView.separatorStyle  &#x3D; UITableViewCellSeparatorStyleNone;</span><br><span class="line">    &#125;</span><br><span class="line">    [v.tableView reloadData];</span><br><span class="line">    [v showView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)backgroundTappedTarget:(id)sender &#123;</span><br><span class="line">    [self hidenView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)showView &#123;</span><br><span class="line">    [[[UIApplication sharedApplication] keyWindow] addSubview:self.backgroundView];</span><br><span class="line">    [[[UIApplication sharedApplication] keyWindow] addSubview:self];</span><br><span class="line">    [self setupViewAndArrowShape];</span><br><span class="line">    [self showAnimation];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)setupViewAndArrowShape &#123;</span><br><span class="line">    CGRect toFrame &#x3D; CGRectZero;</span><br><span class="line">    toFrame.size.width &#x3D; self.viewWidth;</span><br><span class="line">    if (self.iconImageNames.count &#x3D;&#x3D; 0 || self.iconImageNames &#x3D;&#x3D; nil) &#123;</span><br><span class="line">        toFrame.size.height &#x3D; self.itemHeight * self.titles.count + 15;</span><br><span class="line">    &#125; else if (self.titles &#x3D;&#x3D; nil || self.titles.count &#x3D;&#x3D; 0) &#123;</span><br><span class="line">        toFrame.size.height &#x3D; self.itemHeight * self.iconImageNames.count + 15;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        toFrame.size.height &#x3D; self.itemHeight * self.titles.count + 15;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    WudanLayer *bbLayer &#x3D; [[WudanLayer alloc] initWithSize:toFrame.size];</span><br><span class="line">    </span><br><span class="line">    if (self.beginPosition.x + self.viewWidth &#x2F; 2 &gt; WD_SCREEN_WIDTH) &#123;</span><br><span class="line">        toFrame.origin.x &#x3D; WD_SCREEN_WIDTH - 10 - self.viewWidth;</span><br><span class="line">        bbLayer.arrowDirection &#x3D; ArrowDirectionTop;</span><br><span class="line">        bbLayer.arrowPosition &#x3D; (self.beginPosition.x - toFrame.origin.x + 15) &#x2F; self.viewWidth;</span><br><span class="line">        self.layer.anchorPoint &#x3D; CGPointMake(bbLayer.arrowPosition, 0);</span><br><span class="line">    &#125; else if (self.beginPosition.x - self.viewWidth &#x2F; 2 &lt; 0)&#123;</span><br><span class="line">        toFrame.origin.x &#x3D; 10;</span><br><span class="line">        bbLayer.arrowDirection &#x3D; ArrowDirectionTop;</span><br><span class="line">        bbLayer.arrowPosition &#x3D; (self.beginPosition.x - toFrame.origin.x - 15) &#x2F; self.viewWidth;</span><br><span class="line">        self.layer.anchorPoint &#x3D; CGPointMake(bbLayer.arrowPosition, 0);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        toFrame.origin.x &#x3D; self.beginPosition.x - self.viewWidth &#x2F; 2;</span><br><span class="line">        bbLayer.arrowDirection &#x3D; ArrowDirectionTop;</span><br><span class="line">        bbLayer.arrowPosition &#x3D; (self.beginPosition.x - toFrame.origin.x) &#x2F; self.viewWidth;</span><br><span class="line">        self.layer.anchorPoint &#x3D; CGPointMake(bbLayer.arrowPosition, 0);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if (self.beginPosition.y + toFrame.size.height &gt; WD_SCREEN_HEIGHT) &#123;</span><br><span class="line">        toFrame.origin.y &#x3D; self.beginPosition.y - toFrame.size.height - 15;</span><br><span class="line">        bbLayer.arrowDirection &#x3D; ArrowDirectionBottom;</span><br><span class="line">        self.layer.anchorPoint &#x3D; CGPointMake(bbLayer.arrowPosition, 1);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        toFrame.origin.y &#x3D; self.beginPosition.y + 15;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    self.tableView.frame &#x3D; CGRectZero;</span><br><span class="line">    self.frame &#x3D; CGRectMake(self.beginPosition.x, self.beginPosition.y, 0, 0);</span><br><span class="line">    self.alpha &#x3D; 0;</span><br><span class="line">    self.frame &#x3D; toFrame;</span><br><span class="line">    if (self.beginPosition.y + toFrame.size.height &gt; WD_SCREEN_HEIGHT) &#123;</span><br><span class="line">        self.tableView.contentInset &#x3D; UIEdgeInsetsZero;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        self.tableView.contentInset &#x3D; UIEdgeInsetsMake(15, 0, 0, 0);</span><br><span class="line">    &#125;</span><br><span class="line">    self.tableView.frame &#x3D; CGRectMake(0, 0, toFrame.size.width, toFrame.size.height);</span><br><span class="line">    </span><br><span class="line">    bbLayer.cornerRadius &#x3D; 8;</span><br><span class="line">    bbLayer.arrowHeight &#x3D; 15;</span><br><span class="line">    bbLayer.arrowWidth &#x3D; 30;</span><br><span class="line">    bbLayer.arrowRadius &#x3D; 0;</span><br><span class="line">    [self.layer setMask:[bbLayer layer]];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)showAnimation &#123;</span><br><span class="line">    self.layer.affineTransform &#x3D; CGAffineTransformMakeScale(0.1, 0.1);</span><br><span class="line">    [UIView animateWithDuration:0.35 animations:^&#123;</span><br><span class="line">        self.backgroundView.backgroundColor &#x3D; [UIColor colorWithWhite:0 alpha:0.1];</span><br><span class="line">        self.alpha &#x3D; 1;</span><br><span class="line">        self.layer.affineTransform &#x3D; CGAffineTransformIdentity;</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)hidenView &#123;</span><br><span class="line">    [UIView animateWithDuration:0.35 animations:^&#123;</span><br><span class="line">        self.alpha &#x3D; 0;</span><br><span class="line">        self.layer.affineTransform &#x3D; CGAffineTransformMakeScale(0.1, 0.1);</span><br><span class="line">        self.backgroundView.backgroundColor &#x3D; [UIColor colorWithWhite:0 alpha:0];</span><br><span class="line">    &#125; completion:^(BOOL finished) &#123;</span><br><span class="line">        [self removeFromSuperview];</span><br><span class="line">        self.layer.affineTransform &#x3D; CGAffineTransformIdentity;</span><br><span class="line">        [self.backgroundView removeFromSuperview];</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - UITableView DataSource Method</span><br><span class="line">- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section &#123;</span><br><span class="line">    if (self.titles.count &gt; 0) &#123;</span><br><span class="line">        return self.titles.count;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if (self.iconImageNames.count &gt; 0)&#123;</span><br><span class="line">        return self.iconImageNames.count;</span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath &#123;</span><br><span class="line">    WDPopMenuCell *cell &#x3D; [tableView dequeueReusableCellWithIdentifier:@&quot;WDPopMenuCell&quot;];</span><br><span class="line">    if (!cell) &#123;</span><br><span class="line">        cell &#x3D; [[WDPopMenuCell alloc] initWithStyle:UITableViewCellStyleDefault reuseIdentifier:@&quot;WDPopMenuCell&quot;];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    if (self.iconImageNames.count &#x3D;&#x3D; 0 || self.iconImageNames &#x3D;&#x3D; nil) &#123;</span><br><span class="line">        cell.showType &#x3D; WDPopMenuTypeOnlyTitle;</span><br><span class="line">        cell.titleLabel.text &#x3D; self.titles[indexPath.row];</span><br><span class="line">        </span><br><span class="line">    &#125; else if (self.titles &#x3D;&#x3D; nil || self.titles.count &#x3D;&#x3D; 0) &#123;</span><br><span class="line">        cell.showType &#x3D; WDPopMenuTypeOnlyIcon;</span><br><span class="line">        cell.iconImageView.image &#x3D; [UIImage imageNamed:self.iconImageNames[indexPath.row]];</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        cell.showType &#x3D; WDPopMenuTypeNormal;</span><br><span class="line">        cell.iconImageView.image &#x3D; [UIImage imageNamed:self.iconImageNames[indexPath.row]];</span><br><span class="line">        cell.titleLabel.text &#x3D; self.titles[indexPath.row];</span><br><span class="line">    &#125;</span><br><span class="line">    if (self.titleLabel) &#123;</span><br><span class="line">        cell.titleLabel.textColor &#x3D; self.titleLabel.textColor;</span><br><span class="line">        cell.titleLabel.textAlignment &#x3D; self.titleLabel.textAlignment;</span><br><span class="line">        cell.titleLabel.font &#x3D; self.titleLabel.font;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    cell.contentView.backgroundColor &#x3D; self.cellColor;</span><br><span class="line">    </span><br><span class="line">    if (indexPath.row &#x3D;&#x3D; [tableView numberOfRowsInSection:indexPath.section] - 1) &#123;</span><br><span class="line">        cell.separatorInset &#x3D; UIEdgeInsetsMake(0, self.bounds.size.width, 0, 0);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        cell.separatorInset &#x3D; UIEdgeInsetsMake(0, 0, 0, 0);</span><br><span class="line">    &#125;</span><br><span class="line">    return cell;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - UITableView Delegate Method</span><br><span class="line">- (void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath &#123;</span><br><span class="line">    [tableView deselectRowAtIndexPath:indexPath animated:YES];</span><br><span class="line">    [self hidenView];</span><br><span class="line">    self.selectedItemComplete(indexPath.row);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - Setter</span><br><span class="line">- (UITableView *)tableView &#123;</span><br><span class="line">    if (!_tableView) &#123;</span><br><span class="line">        _tableView                 &#x3D; [[UITableView alloc] initWithFrame:CGRectZero style:UITableViewStylePlain];</span><br><span class="line">        _tableView.tableFooterView &#x3D; [[UIView alloc] init];</span><br><span class="line">        _tableView.dataSource      &#x3D; self;</span><br><span class="line">        _tableView.delegate        &#x3D; self;</span><br><span class="line">        _tableView.scrollEnabled   &#x3D; NO;</span><br><span class="line">    &#125;</span><br><span class="line">    return _tableView;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (UIView *)backgroundView &#123;</span><br><span class="line">    if (!_backgroundView) &#123;</span><br><span class="line">        _backgroundView &#x3D; [[UIView alloc] initWithFrame:[[UIScreen mainScreen] bounds]];</span><br><span class="line">    &#125;</span><br><span class="line">    return _backgroundView;</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure><h2 id="å®ç°æ•ˆæœå›¾"><a href="#å®ç°æ•ˆæœå›¾" class="headerlink" title="å®ç°æ•ˆæœå›¾"></a>å®ç°æ•ˆæœå›¾</h2><p><img src="https://s2.ax1x.com/2020/01/17/lzT9ET.gif" alt="æ•ˆæœå›¾"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>iOSè‡ªå®šä¹‰æ§ä»¶-AVPlayerå°è£…</title>
      <link href="/2020/01/16/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-AVPlayer%E5%B0%81%E8%A3%85/"/>
      <url>/2020/01/16/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-AVPlayer%E5%B0%81%E8%A3%85/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨å†™å…³äºéŸ³è§†é¢‘æ’­æ”¾çš„æ¡ˆä¾‹ï¼Œæ‰€ä»¥å°±è¶æœºä¼šç ”ç©¶äº†ä¸€ä¸‹AVPlayerçš„å†…å®¹ã€‚æˆ‘å°è£…çš„ç›®å‰åªèƒ½æ’­æ”¾ç½‘ç»œéŸ³è§†é¢‘ã€‚è¿˜æœªæ·»åŠ ç¼“å­˜ï¼Œä»¥åæ‰¾æœºä¼šç ”ç©¶ä¸€ä¸‹å†æ›´æ–°ã€‚ä»£ç ä¸­æä¾›äº†éŸ³è§†é¢‘çš„ä¸Šä¸€æ›²ã€ä¸‹ä¸€æ›²ã€æš‚åœã€å¼€å§‹ã€åœæ­¢ã€å•æ›²æ’­æ”¾ã€é¡ºåºæ’­æ”¾ã€éšæœºæ’­æ”¾ç­‰åŠŸèƒ½ã€‚ä»£ç å†™çš„ä¸å¥½ï¼Œä»…ä¾›å‚è€ƒ~</p><h3 id="ä»£ç æ¥å£æ–‡ä»¶"><a href="#ä»£ç æ¥å£æ–‡ä»¶" class="headerlink" title="ä»£ç æ¥å£æ–‡ä»¶"></a>ä»£ç æ¥å£æ–‡ä»¶</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;Foundation&#x2F;Foundation.h&gt;</span><br><span class="line">#import &lt;AVFoundation&#x2F;AVFoundation.h&gt;</span><br><span class="line"></span><br><span class="line">NS_ASSUME_NONNULL_BEGIN</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; å½“å‰æ’­æ”¾å™¨çš„æ’­æ”¾å½¢å¼</span><br><span class="line">typedef NS_ENUM(NSInteger, MediaPlayType) &#123;</span><br><span class="line">    MediaPlayTypeCycle,   &#x2F;&#x2F;&#x2F;&lt; é¡ºåº</span><br><span class="line">    MediaPlayTypeSingle,  &#x2F;&#x2F;&#x2F;&lt; å•æ›²å¾ªç¯</span><br><span class="line">    MediaPlayTypeRandom   &#x2F;&#x2F;&#x2F;&lt; éšæœºæ’­æ”¾</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; å½“å‰æ’­æ”¾å™¨çš„æ’­æ”¾çŠ¶æ€</span><br><span class="line">typedef NS_ENUM(NSInteger, MediaPlayStatus) &#123;</span><br><span class="line">    MediaPlayStatusStop,        &#x2F;&#x2F;&#x2F;&lt; åœæ­¢æ’­æ”¾</span><br><span class="line">    MediaPlayStatusPause,       &#x2F;&#x2F;&#x2F;&lt; æš‚åœæ’­æ”¾</span><br><span class="line">    MediaPlayStatusPlaying      &#x2F;&#x2F;&#x2F;&lt; æ­£åœ¨æ’­æ”¾</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; åª’ä½“åŠ è½½çŠ¶æ€</span><br><span class="line">typedef NS_ENUM(NSInteger, MediaLoadStatus) &#123;</span><br><span class="line">    MediaLoadStatusReadyToPlay,  &#x2F;&#x2F;&#x2F;&lt; å‡†å¤‡æ’­æ”¾</span><br><span class="line">    MediaLoadStatusUnknown,      &#x2F;&#x2F;&#x2F;&lt; æœªçŸ¥</span><br><span class="line">    MediaPlayStatusFailed        &#x2F;&#x2F;&#x2F;&lt; å¤±è´¥</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">@class MediaPlyerManager;</span><br><span class="line"></span><br><span class="line">@protocol MediaPlyerManagerDelegate &lt;NSObject&gt;</span><br><span class="line">@optional</span><br><span class="line">&#x2F;&#x2F; æ•°æ®åŠ è½½çŠ¶æ€ æ ¹æ®çŠ¶æ€è¿›è¡Œæ’­æ”¾æˆ–å…¶ä»–æ“ä½œ</span><br><span class="line">- (void)MediaPlayer:(MediaPlyerManager *)playerManager playerItemStatus:(MediaLoadStatus)status;</span><br><span class="line">&#x2F;&#x2F; ç¼“å†²è¿›åº¦</span><br><span class="line">- (void)MediaPlayer:(MediaPlyerManager *)playerManager netBufferValue:(CGFloat)value;</span><br><span class="line">&#x2F;&#x2F; ç¼“å†²æ˜¯å¦è¶³å¤Ÿæ’­æ”¾</span><br><span class="line">- (void)MediaPlayer:(MediaPlyerManager *)playerManager bufferHasEnough:(BOOL)enough;</span><br><span class="line">&#x2F;&#x2F; å½“å‰æ’­æ”¾çš„æ—¶é—´</span><br><span class="line">- (void)MediaPlayer:(MediaPlyerManager *)playerManager currentPlayTime:(NSString *)time currentPlayTimeValue:(CGFloat)value;</span><br><span class="line">&#x2F;&#x2F; æ’­æ”¾æ€»æ—¶é—´</span><br><span class="line">- (void)MediaPlayer:(MediaPlyerManager *)playerManager mediaEndTime:(NSString *)time mediaEndTimeValue:(CGFloat)value;</span><br><span class="line">&#x2F;&#x2F; æ’­æ”¾ç»“æŸ</span><br><span class="line">- (void)MediaPlayerCurrentMediaPlayFinish:(MediaPlyerManager *)playerManager;</span><br><span class="line">&#x2F;&#x2F; æ’­æ”¾çŠ¶æ€</span><br><span class="line">- (void)MediaPlayer:(MediaPlyerManager *)playerManager playeStatus:(MediaPlayStatus)status;</span><br><span class="line">&#x2F;&#x2F; è·å–æ•°æ®åˆ‡æ¢æ—¶è·å–æ­£åœ¨æ’­æ”¾çš„URLå’Œå½“å‰çš„index</span><br><span class="line">- (void)MediaPlayer:(MediaPlyerManager *)playerManager currentUrl:(NSString *)url currentIndex:(NSInteger)index;</span><br><span class="line">&#x2F;&#x2F; ä¸ºäº†é…åˆæ‰‹æœºåå°æ’­æ”¾ å®æ—¶è·å–æ’­æ”¾çš„è¿›åº¦ï¼Œæ€»çš„æ—¶é—´ï¼Œå½“å‰çš„index&lt;é€šè¿‡indexè·å–å›¾ç‰‡ç­‰ä¿¡æ¯&gt;</span><br><span class="line">- (void)MediaPlayer:(MediaPlyerManager *)playerManager currentProgressValue:(CGFloat)value totalValue:(CGFloat)totalValue currentIndex:(NSInteger)index;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">typedef MediaPlyerManager *(^playerCurrentTime)(NSString *time);</span><br><span class="line"></span><br><span class="line">@interface MediaPlyerManager : NSObject</span><br><span class="line">@property (nonatomic, strong, readonly) AVPlayer                  *mediaPlayer;          &#x2F;&#x2F;&#x2F;&lt; æ’­æ”¾å™¨</span><br><span class="line">@property (nonatomic, strong, readonly) AVPlayerItem              *meidaPlayerItem;      &#x2F;&#x2F;&#x2F;&lt; æ’­æ”¾å™¨çš„CurrentItem</span><br><span class="line">@property (nonatomic, strong, readonly) NSMutableArray&lt;NSString*&gt; *dataUrlArray;         &#x2F;&#x2F;&#x2F;&lt; æ­£åœ¨æ’­æ”¾çš„åˆ—è¡¨æ•°æ®</span><br><span class="line">@property (nonatomic, assign, readonly) MediaPlayType              playType;             &#x2F;&#x2F;&#x2F;&lt; å½“å‰æ’­æ”¾ç±»å‹</span><br><span class="line">@property (nonatomic, assign, readonly) MediaPlayStatus            playStatus;           &#x2F;&#x2F;&#x2F;&lt; å½“å‰æ’­æ”¾çŠ¶æ€</span><br><span class="line">@property (nonatomic, assign, readonly) NSInteger                  currentIndex;         &#x2F;&#x2F;&#x2F;&lt; å½“å‰æ’­æ”¾çš„ç´¢å¼•</span><br><span class="line">@property (nonatomic, assign, readonly) BOOL                       isPlaying;            &#x2F;&#x2F;&#x2F;&lt; æ˜¯å¦åœ¨æ’­æ”¾</span><br><span class="line">@property (nonatomic, assign, readonly) CGFloat                    curentPlayTimeValue;  &#x2F;&#x2F;&#x2F;&lt; å½“å‰æ’­æ”¾æ—¶é—´å€¼</span><br><span class="line">@property (nonatomic, copy, readonly) NSString                    *curentPlayTime;       &#x2F;&#x2F;&#x2F;&lt; å½“å‰æ’­æ”¾æ—¶é—´</span><br><span class="line">@property (nonatomic, assign, readonly) CGFloat                    endPlayTimeValue;     &#x2F;&#x2F;&#x2F;&lt; å½“å‰æ’­æ”¾æ—¶é—´å€¼</span><br><span class="line">@property (nonatomic, copy, readonly) NSString                    *endPlayTime;          &#x2F;&#x2F;&#x2F;&lt; å½“å‰æ’­æ”¾æ—¶é—´</span><br><span class="line">+ (instancetype)defaultManager;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> åˆ—è¡¨æ’­æ”¾ âš ï¸&lt;é»˜è®¤ä¸è‡ªåŠ¨æ’­æ”¾&gt;</span><br><span class="line"></span><br><span class="line"> @param urls æ–‡ä»¶è·¯å¾„æ•°ç»„</span><br><span class="line"> @param delegate å›è°ƒä»£ç†</span><br><span class="line"> @return MediaPlyerManager</span><br><span class="line"> *&#x2F;</span><br><span class="line">- (MediaPlyerManager *)playerWithUrls:(NSArray&lt;NSString *&gt; *)urls actionWithDelegate:(id&lt;MediaPlyerManagerDelegate&gt;)delegate;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> å•ä¸ªéŸ³è§†é¢‘æ’­æ”¾ âš ï¸&lt;é»˜è®¤ä¸è‡ªåŠ¨æ’­æ”¾&gt;</span><br><span class="line"></span><br><span class="line"> @param url æ–‡ä»¶è·¯å¾„</span><br><span class="line"> @param delegate å›è°ƒä»£ç†</span><br><span class="line"> @return MediaPlyerManager</span><br><span class="line"> *&#x2F;</span><br><span class="line">- (MediaPlyerManager *)playerWithUrl:(NSString *)url actionWithDelegate:(id&lt;MediaPlyerManagerDelegate&gt;)delegate;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line">    å¼€å§‹æ’­æ”¾</span><br><span class="line"> *&#x2F;</span><br><span class="line">- (void)play;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line">    æš‚åœæ’­æ”¾</span><br><span class="line"> *&#x2F;</span><br><span class="line">- (void)pause;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line">    åœæ­¢æ’­æ”¾</span><br><span class="line"> *&#x2F;</span><br><span class="line">- (void)stop;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line">    ä¸‹ä¸€æ›²</span><br><span class="line"> *&#x2F;</span><br><span class="line">- (void)next;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line">    ä¸Šä¸€æ›²</span><br><span class="line"> *&#x2F;</span><br><span class="line">- (void)previous;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> æŒ‡å®šè¿›åº¦å¼€å§‹æ’­æ”¾</span><br><span class="line"></span><br><span class="line"> @param progress è¿›åº¦ç™¾åˆ†æ¯”</span><br><span class="line"> *&#x2F;</span><br><span class="line">- (void)setupPlayerSeekToProgress:(CGFloat)progress;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> åˆ¶å®šæ’­æ”¾ç±»å‹</span><br><span class="line"></span><br><span class="line"> @param type ç±»å‹</span><br><span class="line"> *&#x2F;</span><br><span class="line">- (void)setupMediaPlayerType:(MediaPlayType)type;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> æŒ‡å®šæ’­æ”¾çš„index</span><br><span class="line"></span><br><span class="line"> @param index ç´¢å¼•</span><br><span class="line"> *&#x2F;</span><br><span class="line">- (void)setupPlayerIndex:(NSInteger)index;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> æ·»åŠ æ•°æ®</span><br><span class="line"></span><br><span class="line"> @param files æ–‡ä»¶æ•°ç»„</span><br><span class="line"> @param index ç´¢å¼•</span><br><span class="line"> *&#x2F;</span><br><span class="line">- (void)insertMediaFile:(NSArray&lt;NSString *&gt; *)files atIndex:(NSInteger)index;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line">    ç§»é™¤å…¨éƒ¨æ•°æ®</span><br><span class="line"> *&#x2F;</span><br><span class="line">- (void)removeAllFiles;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> ç§»é™¤ç´¢å¼•ä¸­çš„å•ä¸ªæ•°æ®</span><br><span class="line"></span><br><span class="line"> @param index ç´¢å¼•</span><br><span class="line"> *&#x2F;</span><br><span class="line">- (void)removeObjectAtIndex:(NSInteger)index;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> è®¾ç½®é”å±æ ·å¼</span><br><span class="line"></span><br><span class="line"> @param coverImage ä¸“è¾‘å›¾ç‰‡</span><br><span class="line"> @param size æ˜¾ç¤ºå¤§å°</span><br><span class="line"> @param title æ ‡é¢˜</span><br><span class="line"> @param author ä¸“è¾‘ä½œè€…</span><br><span class="line"> @param album ä¸“è¾‘åç§°</span><br><span class="line"> @param currentTime å½“å‰æ’­æ”¾æ—¶é—´</span><br><span class="line"> @param duration æ’­æ”¾æ€»æ—¶é•¿</span><br><span class="line"> *&#x2F;</span><br><span class="line">- (void)setupLockScreenPlayInfo:(UIImage *)coverImage</span><br><span class="line">                      imageSize:(CGSize)size</span><br><span class="line">                          title:(NSString *)title</span><br><span class="line">                         ahthor:(NSString *)author</span><br><span class="line">                         album:(NSString *)album</span><br><span class="line">                currentPlayTime:(CGFloat)currentTime</span><br><span class="line">                       duration:(CGFloat)duration;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">NS_ASSUME_NONNULL_END</span><br></pre></td></tr></table></figure><h3 id="ä»£ç å®ç°æ–‡ä»¶"><a href="#ä»£ç å®ç°æ–‡ä»¶" class="headerlink" title="ä»£ç å®ç°æ–‡ä»¶"></a>ä»£ç å®ç°æ–‡ä»¶</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;MediaPlyerManager.h&quot;</span><br><span class="line">#import &lt;MediaPlayer&#x2F;MediaPlayer.h&gt;</span><br><span class="line"></span><br><span class="line">@interface MediaPlyerManager ()</span><br><span class="line">@property (nonatomic, strong, readwrite) NSMutableArray&lt;NSString *&gt; *dataUrlArray;</span><br><span class="line">@property (nonatomic, strong, readwrite) AVPlayer                  *mediaPlayer;</span><br><span class="line">@property (nonatomic, assign, readwrite) BOOL                      isPlaying;</span><br><span class="line">@property (nonatomic, strong, readwrite) AVPlayerItem              *meidaPlayerItem;</span><br><span class="line">@property (nonatomic, assign, readwrite) MediaPlayType             playeType;</span><br><span class="line">@property (nonatomic, assign, readwrite) NSInteger                 currentIndex;</span><br><span class="line">@property (nonatomic, assign, readwrite) MediaPlayStatus           playStatus;</span><br><span class="line">@property (nonatomic, assign, readwrite) CGFloat                   curentPlayTimeValue;</span><br><span class="line">@property (nonatomic, copy, readwrite  ) NSString                  *curentPlayTime;</span><br><span class="line">@property (nonatomic, assign, readwrite) CGFloat                   endPlayTimeValue;</span><br><span class="line">@property (nonatomic, copy, readwrite  ) NSString                  *endPlayTime;</span><br><span class="line">@property (nonatomic, weak             ) id &lt;MediaPlyerManagerDelegate&gt; delegate;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation MediaPlyerManager</span><br><span class="line"></span><br><span class="line">+ (instancetype)defaultManager &#123;</span><br><span class="line">    static dispatch_once_t onceToken;</span><br><span class="line">    static MediaPlyerManager *manger;</span><br><span class="line">    dispatch_once(&amp;onceToken, ^&#123;</span><br><span class="line">        manger &#x3D; [[MediaPlyerManager alloc] init];</span><br><span class="line">    &#125;);</span><br><span class="line">    return manger;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - åˆå§‹åŒ–</span><br><span class="line"></span><br><span class="line">- (MediaPlyerManager *)playerWithUrl:(NSString *)url actionWithDelegate:(id&lt;MediaPlyerManagerDelegate&gt;)delegate &#123;</span><br><span class="line">    [self playerWithUrls:@[url] actionWithDelegate:delegate];</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (MediaPlyerManager *)playerWithUrls:(NSArray&lt;NSString *&gt; *)urls actionWithDelegate:(id&lt;MediaPlyerManagerDelegate&gt;)delegate &#123;</span><br><span class="line">    self.delegate         &#x3D; delegate;</span><br><span class="line">    self.currentIndex     &#x3D; 0;</span><br><span class="line">    self.dataUrlArray     &#x3D; [NSMutableArray array];</span><br><span class="line">    NSMutableArray *array &#x3D; [NSMutableArray arrayWithCapacity:urls.count];</span><br><span class="line">    for (NSString *urlStr in urls) &#123;</span><br><span class="line">        [array addObject:[self createPlayerItemWithUrl:urlStr]];</span><br><span class="line">        [self.dataUrlArray addObject:urlStr];</span><br><span class="line">    &#125;</span><br><span class="line">    self.playeType &#x3D; MediaPlayTypeCycle;</span><br><span class="line">    self.mediaPlayer &#x3D; [[AVPlayer alloc] initWithPlayerItem:array.firstObject];</span><br><span class="line">    self.meidaPlayerItem &#x3D; self.mediaPlayer.currentItem;</span><br><span class="line">    [self getCurrentIndex:self.currentIndex];</span><br><span class="line">    [self addObserver];</span><br><span class="line">    </span><br><span class="line">    __weak typeof(self) weakself &#x3D; self;</span><br><span class="line">    [self.mediaPlayer addPeriodicTimeObserverForInterval:CMTimeMake(1, 1) queue:NULL usingBlock:^(CMTime time) &#123;</span><br><span class="line">        NSString *currentString &#x3D; [weakself getStringFromCMTime:time];</span><br><span class="line">        weakself.curentPlayTime &#x3D; currentString;</span><br><span class="line">        weakself.curentPlayTimeValue &#x3D; (CGFloat)time.value&#x2F;time.timescale;        </span><br><span class="line">#pragma mark - è·å–å½“å‰æ’­æ”¾æ—¶é—´</span><br><span class="line">        if (weakself.delegate &amp;&amp; [weakself.delegate respondsToSelector:@selector(MediaPlayer:currentPlayTime:currentPlayTimeValue:)]) &#123;</span><br><span class="line">            [weakself.delegate MediaPlayer:weakself currentPlayTime:currentString currentPlayTimeValue:(CGFloat)time.value&#x2F;time.timescale];</span><br><span class="line">        &#125;</span><br><span class="line">#pragma mark - å®æ—¶è·å–æ’­æ”¾ä¿¡æ¯</span><br><span class="line">        if (self.delegate &amp;&amp; [self.delegate respondsToSelector:@selector(MediaPlayer:currentProgressValue:totalValue:currentIndex:)]) &#123;</span><br><span class="line">            [weakself.delegate MediaPlayer:weakself currentProgressValue:weakself.curentPlayTimeValue totalValue:weakself.endPlayTimeValue currentIndex:weakself.currentIndex];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">    </span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - æ’­æ”¾ç»“æŸ</span><br><span class="line"></span><br><span class="line">- (void)playFinish:(NSNotification *)notification &#123;</span><br><span class="line">    if (self.delegate &amp;&amp; [self.delegate respondsToSelector:@selector(MediaPlayerCurrentMediaPlayFinish:)]) &#123;</span><br><span class="line">        [self.delegate MediaPlayerCurrentMediaPlayFinish:self];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (self.playeType &#x3D;&#x3D; MediaPlayTypeSingle) &#123;</span><br><span class="line">        [self.mediaPlayer seekToTime:kCMTimeZero];</span><br><span class="line">        [self play];</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        if (self.currentIndex &lt; self.dataUrlArray.count - 1) &#123;</span><br><span class="line">            self.currentIndex +&#x3D; 1;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            self.currentIndex &#x3D; 0;</span><br><span class="line">        &#125;</span><br><span class="line">        [self.mediaPlayer replaceCurrentItemWithPlayerItem:[self createPlayerItemWithUrl:self.dataUrlArray[self.currentIndex]]];</span><br><span class="line">        self.meidaPlayerItem &#x3D; self.mediaPlayer.currentItem;</span><br><span class="line">        [self getCurrentIndex:self.currentIndex];</span><br><span class="line">        [self play];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - KVO</span><br><span class="line"></span><br><span class="line">- (void)observeValueForKeyPath:(NSString *)keyPath</span><br><span class="line">                      ofObject:(id)object</span><br><span class="line">                        change:(NSDictionary&lt;NSKeyValueChangeKey,id&gt; *)change</span><br><span class="line">                       context:(void *)context &#123;</span><br><span class="line">    </span><br><span class="line">    AVPlayerItem *playerItem &#x3D; object;</span><br><span class="line">    if ([keyPath isEqualToString:@&quot;status&quot;]) &#123;</span><br><span class="line">        MediaLoadStatus status &#x3D; [change[@&quot;new&quot;] integerValue];</span><br><span class="line">#pragma mark - è·å–åª’ä½“åŠ è½½çŠ¶æ€</span><br><span class="line">        if (self.delegate &amp;&amp; [self.delegate respondsToSelector:@selector(MediaPlayer:playerItemStatus:)]) &#123;</span><br><span class="line">            [self.delegate MediaPlayer:self playerItemStatus:status];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; else if ([keyPath isEqualToString:@&quot;loadedTimeRanges&quot;]) &#123;</span><br><span class="line">        NSArray * timeRanges         &#x3D; playerItem.loadedTimeRanges;</span><br><span class="line">        CMTimeRange timeRange        &#x3D; [timeRanges.firstObject CMTimeRangeValue];</span><br><span class="line">        NSTimeInterval totalLoadTime &#x3D; CMTimeGetSeconds(timeRange.start) \</span><br><span class="line">                                                + CMTimeGetSeconds(timeRange.duration);</span><br><span class="line">        NSTimeInterval duration      &#x3D; CMTimeGetSeconds(playerItem.duration);</span><br><span class="line">        NSTimeInterval scale         &#x3D; totalLoadTime&#x2F;duration;</span><br><span class="line">        </span><br><span class="line">#pragma mark - è·å–åª’ä½“æ€»æ—¶é—´</span><br><span class="line">        if ((CGFloat)duration&#x2F;scale &gt;&#x3D; 0) &#123;</span><br><span class="line">            self.endPlayTime &#x3D; [self getStringFromCMTime:playerItem.duration];</span><br><span class="line">            self.endPlayTimeValue &#x3D; (CGFloat)duration&#x2F;scale;</span><br><span class="line">            if (self.delegate &amp;&amp; [self.delegate respondsToSelector:@selector(MediaPlayer:mediaEndTime:mediaEndTimeValue:)]) &#123;</span><br><span class="line">                [self.delegate MediaPlayer:self mediaEndTime:[self getStringFromCMTime:playerItem.duration] mediaEndTimeValue:(CGFloat)duration&#x2F;scale];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">#pragma mark - ç¼“å†²ç™¾åˆ†æ¯”</span><br><span class="line">        if (self.delegate &amp;&amp; [self.delegate respondsToSelector:@selector(MediaPlayer:netBufferValue:)]) &#123;</span><br><span class="line">            [self.delegate MediaPlayer:self netBufferValue:scale];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; else if ([keyPath isEqualToString:@&quot;playbackBufferEmpty&quot;]) &#123;</span><br><span class="line">        </span><br><span class="line">#pragma mark - ç¼“å†²ä¸è¶³å¤Ÿæ’­æ”¾</span><br><span class="line">        if (self.delegate &amp;&amp; [self.delegate respondsToSelector:@selector(MediaPlayer:bufferHasEnough:)]) &#123;</span><br><span class="line">            [self.delegate MediaPlayer:self bufferHasEnough:false];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; else if ([keyPath isEqualToString:@&quot;playbackLikelyToKeepUp&quot;]) &#123;</span><br><span class="line">        </span><br><span class="line">#pragma mark - ç¼“å†²è¶³å¤Ÿæ’­æ”¾</span><br><span class="line">        if (self.delegate &amp;&amp; [self.delegate respondsToSelector:@selector(MediaPlayer:bufferHasEnough:)]) &#123;</span><br><span class="line">            [self.delegate MediaPlayer:self bufferHasEnough:true];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#pragma mark - å¼€å§‹æ’­æ”¾</span><br><span class="line"></span><br><span class="line">- (void)play &#123;</span><br><span class="line">    [self.mediaPlayer play];</span><br><span class="line">    [self getPlayStatus:MediaPlayStatusPlaying];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - æš‚åœæ’­æ”¾</span><br><span class="line"></span><br><span class="line">- (void)pause &#123;</span><br><span class="line">    [self.mediaPlayer pause];</span><br><span class="line">    [self getPlayStatus:MediaPlayStatusPause];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - åœæ­¢æ’­æ”¾</span><br><span class="line"></span><br><span class="line">- (void)stop &#123;</span><br><span class="line">    [self.mediaPlayer replaceCurrentItemWithPlayerItem:nil];</span><br><span class="line">    [self getPlayStatus:MediaPlayStatusStop];</span><br><span class="line">    [self removeObserver];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - ä¸‹ä¸€ä¸ª</span><br><span class="line"></span><br><span class="line">- (void)next &#123;</span><br><span class="line">    if (self.playeType &#x3D;&#x3D; MediaPlayTypeRandom) &#123;</span><br><span class="line">        self.currentIndex &#x3D; (NSInteger)arc4random_uniform((int32_t)(self.dataUrlArray.count - 1));</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        if (self.currentIndex &#x3D;&#x3D; self.dataUrlArray.count - 1) &#123;</span><br><span class="line">            self.currentIndex &#x3D; 0;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            self.currentIndex +&#x3D; 1;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    [self.mediaPlayer replaceCurrentItemWithPlayerItem:[self createPlayerItemWithUrl:self.dataUrlArray[self.currentIndex]]];</span><br><span class="line">    self.meidaPlayerItem &#x3D; self.mediaPlayer.currentItem;</span><br><span class="line">    [self getCurrentIndex:self.currentIndex];</span><br><span class="line">    [self addObserver];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - ä¸Šä¸€ä¸ª</span><br><span class="line"></span><br><span class="line">- (void)previous &#123;</span><br><span class="line">    if (self.playeType &#x3D;&#x3D; MediaPlayTypeRandom) &#123;</span><br><span class="line">        self.currentIndex &#x3D; (NSInteger)arc4random_uniform((int32_t)(self.dataUrlArray.count - 1));</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        if (self.currentIndex &#x3D;&#x3D; 0) &#123;</span><br><span class="line">            self.currentIndex &#x3D; self.dataUrlArray.count - 1;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            self.currentIndex -&#x3D; 1;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    [self.mediaPlayer replaceCurrentItemWithPlayerItem:[self createPlayerItemWithUrl:self.dataUrlArray[self.currentIndex]]];</span><br><span class="line">    self.meidaPlayerItem &#x3D; self.mediaPlayer.currentItem;</span><br><span class="line">    [self getCurrentIndex:self.currentIndex];</span><br><span class="line">    [self addObserver];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - æ’­æ”¾çŠ¶æ€</span><br><span class="line"></span><br><span class="line">- (void)getPlayStatus:(MediaPlayStatus)status &#123;</span><br><span class="line">    if (self.delegate &amp;&amp; [self.delegate respondsToSelector:@selector(MediaPlayer:playeStatus:)]) &#123;</span><br><span class="line">        [self.delegate MediaPlayer:self playeStatus:status];</span><br><span class="line">    &#125;</span><br><span class="line">    self.playStatus &#x3D; status;</span><br><span class="line"></span><br><span class="line">    if (status &#x3D;&#x3D; MediaPlayStatusPlaying) &#123;</span><br><span class="line">        self.isPlaying &#x3D; true;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        self.isPlaying &#x3D; false;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - æ ¹æ®indexè¿›è¡Œå›è°ƒ</span><br><span class="line"></span><br><span class="line">- (void)getCurrentIndex:(NSInteger)index &#123;</span><br><span class="line">    if (self.delegate &amp;&amp; [self.delegate respondsToSelector:@selector(MediaPlayer:currentUrl:currentIndex:)]) &#123;</span><br><span class="line">        [self.delegate MediaPlayer:self currentUrl:self.dataUrlArray[index] currentIndex:index];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - è®¾ç½®æ’­æ”¾è¿›åº¦ç™¾åˆ†æ¯”</span><br><span class="line"></span><br><span class="line">- (void)setupPlayerSeekToProgress:(CGFloat)progress &#123;</span><br><span class="line">    float timeValue &#x3D; progress * CMTimeGetSeconds(self.mediaPlayer.currentItem.duration);</span><br><span class="line">    [self.mediaPlayer seekToTime:CMTimeMake(timeValue, 1)];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - è®¾ç½®æ’­æ”¾å½¢å¼</span><br><span class="line"></span><br><span class="line">- (void)setupMediaPlayerType:(MediaPlayType)type &#123;</span><br><span class="line">    self.playeType &#x3D; type;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - æ’­æ”¾æŒ‡å®šindexçš„åª’ä½“</span><br><span class="line"></span><br><span class="line">- (void)setupPlayerIndex:(NSInteger)index &#123;</span><br><span class="line">    if (index &gt; (self.dataUrlArray.count - 1)) &#123;</span><br><span class="line">        @throw [NSException exceptionWithName:@&quot;è¶Šç•Œé”™è¯¯&quot; reason:@&quot;index ä¸èƒ½è¶…å‡ºURLæ•°ç»„çš„é•¿åº¦&quot; userInfo:nil];</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    self.currentIndex &#x3D; index;</span><br><span class="line">    [self.mediaPlayer replaceCurrentItemWithPlayerItem:[self createPlayerItemWithUrl:self.dataUrlArray[self.currentIndex]]];</span><br><span class="line">    self.meidaPlayerItem &#x3D; self.mediaPlayer.currentItem;</span><br><span class="line">    [self getCurrentIndex:self.currentIndex];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - æ’å…¥æ•°æ®</span><br><span class="line"></span><br><span class="line">- (void)insertMediaFile:(NSArray&lt;NSString *&gt; *)files atIndex:(NSInteger)index &#123;</span><br><span class="line">    for (NSString *urlStr in files) &#123;</span><br><span class="line">        NSInteger i &#x3D; [files indexOfObject:urlStr];</span><br><span class="line">        [self.dataUrlArray insertObject:urlStr atIndex:index + i];</span><br><span class="line">    &#125;</span><br><span class="line">    if (index &lt; self.currentIndex) &#123;</span><br><span class="line">        self.currentIndex +&#x3D; 1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - åˆ é™¤æ•°æ®</span><br><span class="line"></span><br><span class="line">- (void)removeAllFiles &#123;</span><br><span class="line">    [self stop];</span><br><span class="line">    [self.dataUrlArray removeAllObjects];</span><br><span class="line">    self.dataUrlArray &#x3D; [NSMutableArray array];</span><br><span class="line">    self.currentIndex &#x3D; 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)removeObjectAtIndex:(NSInteger)index &#123;</span><br><span class="line">    if (self.dataUrlArray.count &#x3D;&#x3D; 1) &#123;</span><br><span class="line">        [self removeAllFiles];</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        [self.dataUrlArray removeObjectAtIndex:index];</span><br><span class="line">        if (index &#x3D;&#x3D; self.currentIndex) &#123;</span><br><span class="line">            if (index &#x3D;&#x3D; 0) &#123;</span><br><span class="line">                self.currentIndex &#x3D; 0;</span><br><span class="line">                [self next];</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                self.currentIndex -&#x3D; 1;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            if (self.currentIndex &gt; index) &#123;</span><br><span class="line">                self.currentIndex -&#x3D; 1;</span><br><span class="line">            &#125; </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - Utils</span><br><span class="line"></span><br><span class="line">- (NSString *)getStringFromCMTime:(CMTime)time &#123;</span><br><span class="line">    float currentTimeValue       &#x3D; (CGFloat)time.value&#x2F;time.timescale;</span><br><span class="line">    NSDate * currentDate         &#x3D; [NSDate dateWithTimeIntervalSince1970:currentTimeValue];</span><br><span class="line">    NSCalendar *calendar         &#x3D; [[NSCalendar alloc] initWithCalendarIdentifier:NSCalendarIdentifierGregorian];</span><br><span class="line">    NSInteger unitFlags          &#x3D; NSCalendarUnitHour | NSCalendarUnitMinute | NSCalendarUnitSecond;</span><br><span class="line">    NSDateComponents *components &#x3D; [calendar components:unitFlags fromDate:currentDate];</span><br><span class="line">    if (currentTimeValue &gt;&#x3D; 3600 ) &#123;</span><br><span class="line">        return [NSString stringWithFormat:@&quot;%02ld:%02ld:%02ld&quot;, (long)components.hour, (long)components.minute, (long)components.second];</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        return [NSString stringWithFormat:@&quot;%02ld:%02ld&quot;, (long)components.minute, (long)components.second];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)addObserver &#123;</span><br><span class="line">    &#x2F;&#x2F; ç›‘æ§çŠ¶æ€å±æ€§</span><br><span class="line">    [self.meidaPlayerItem addObserver:self</span><br><span class="line">                           forKeyPath:@&quot;status&quot;</span><br><span class="line">                              options:(NSKeyValueObservingOptionOld|NSKeyValueObservingOptionNew)</span><br><span class="line">                              context:nil];</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; ç›‘æ§ç¼“å†²åŠ è½½æƒ…å†µå±æ€§</span><br><span class="line">    [self.meidaPlayerItem addObserver:self</span><br><span class="line">                           forKeyPath:@&quot;loadedTimeRanges&quot;</span><br><span class="line">                              options:(NSKeyValueObservingOptionOld|NSKeyValueObservingOptionNew)</span><br><span class="line">                              context:nil];</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; ç›‘å¬ç¼“å†²ä¸è¶³å¤Ÿæ’­æ”¾</span><br><span class="line">    [self.meidaPlayerItem addObserver:self</span><br><span class="line">                           forKeyPath:@&quot;playbackBufferEmpty&quot;</span><br><span class="line">                              options:NSKeyValueObservingOptionNew</span><br><span class="line">                              context:nil];</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; ç›‘å¬ç¼“å†²è¶³å¤Ÿæ’­æ”¾</span><br><span class="line">    [self.meidaPlayerItem addObserver:self</span><br><span class="line">                           forKeyPath:@&quot;playbackLikelyToKeepUp&quot;</span><br><span class="line">                              options:NSKeyValueObservingOptionNew</span><br><span class="line">                              context:nil];</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; è·å–æ˜¯å¦æ’­æ”¾ç»“æŸ</span><br><span class="line">    [[NSNotificationCenter defaultCenter] addObserver:self</span><br><span class="line">                                             selector:@selector(playFinish:)</span><br><span class="line">                                                 name:AVPlayerItemDidPlayToEndTimeNotification</span><br><span class="line">                                               object:self.meidaPlayerItem];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)removeObserver &#123;</span><br><span class="line">    [[NSNotificationCenter defaultCenter] removeObserver:self];</span><br><span class="line">    @try &#123;</span><br><span class="line">        [self.meidaPlayerItem removeObserver:self forKeyPath:@&quot;loadedTimeRanges&quot;];</span><br><span class="line">        [self.meidaPlayerItem removeObserver:self forKeyPath:@&quot;playbackBufferEmpty&quot;];</span><br><span class="line">        [self.meidaPlayerItem removeObserver:self forKeyPath:@&quot;playbackLikelyToKeepUp&quot;];</span><br><span class="line">        [self.meidaPlayerItem removeObserver:self forKeyPath:@&quot;status&quot;];</span><br><span class="line">    &#125;</span><br><span class="line">    @catch(NSException *exception) &#123;</span><br><span class="line">        NSLog(@&quot;%@&quot;, exception);</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - è®¾ç½®é”å±æ ·å¼</span><br><span class="line"></span><br><span class="line">- (void)setupLockScreenPlayInfo:(UIImage *)coverImage</span><br><span class="line">                      imageSize:(CGSize)size</span><br><span class="line">                          title:(NSString *)title</span><br><span class="line">                         ahthor:(NSString *)author</span><br><span class="line">                          album:(NSString *)album</span><br><span class="line">                currentPlayTime:(CGFloat)currentTime</span><br><span class="line">                       duration:(CGFloat)duration &#123;</span><br><span class="line">    </span><br><span class="line">    Class playingInfoCenter &#x3D; NSClassFromString(@&quot;MPNowPlayingInfoCenter&quot;);</span><br><span class="line">    if (playingInfoCenter) &#123;</span><br><span class="line">        NSMutableDictionary *songInfo &#x3D; [[NSMutableDictionary alloc] init];</span><br><span class="line">        MPMediaItemArtwork *albumArt &#x3D; [[MPMediaItemArtwork alloc] initWithBoundsSize:size requestHandler:^UIImage * _Nonnull(CGSize size) &#123;</span><br><span class="line">            return coverImage;</span><br><span class="line">        &#125;];</span><br><span class="line">        [songInfo setObject:title forKey:MPMediaItemPropertyTitle];</span><br><span class="line">        [songInfo setObject:author forKey:MPMediaItemPropertyArtist];</span><br><span class="line">        [songInfo setObject:album forKey:MPMediaItemPropertyAlbumTitle];</span><br><span class="line">        [songInfo setObject:albumArt forKey:MPMediaItemPropertyArtwork];</span><br><span class="line">        [songInfo setObject:[NSNumber numberWithDouble:currentTime] forKey:MPNowPlayingInfoPropertyElapsedPlaybackTime];</span><br><span class="line">        [songInfo setObject:[NSNumber numberWithDouble:duration] forKey:MPMediaItemPropertyPlaybackDuration];</span><br><span class="line">        [[MPNowPlayingInfoCenter defaultCenter] setNowPlayingInfo:songInfo];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (AVPlayerItem *)createPlayerItemWithUrl:(NSString *)url &#123;</span><br><span class="line">    return [AVPlayerItem playerItemWithURL:[NSURL URLWithString:url]];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure><h3 id="æé—®"><a href="#æé—®" class="headerlink" title="æé—®"></a>æé—®</h3><p>æœ¬æ¥ç›¸åŒä½¿ç”¨AVQueuePlayeræ¥è¿›è¡Œåˆ—è¡¨æ’­æ”¾çš„ï¼Œä½†æ˜¯å½“åšå•æ›²å¾ªç¯çš„æ—¶å€™é‡åˆ°é—®é¢˜ï¼šé€šè¿‡é€šçŸ¥ç›‘å¬æ’­æ”¾å®Œæˆï¼Œåœ¨é€šçŸ¥çš„æ–¹æ³•é‡Œè¿›è¡Œå…·ä½“æ“ä½œï¼Œä½†æ˜¯è®¾ç½®æ— æ•ˆï¼Œç›´æ¥æ’­æ”¾çš„è¿˜æ˜¯ä¸‹ä¸€ä¸ªæ–‡ä»¶ã€‚å¦‚æœæœ‰äººçŸ¥é“å¦‚ä½•è§£å†³ï¼Œå¸®å¿™å›å¤ä¸€ä¸‹ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Objective-C </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è‡ªå®šä¹‰æ§ä»¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iOSé¢è¯•é¢˜-007</title>
      <link href="/2020/01/16/iOS%E9%9D%A2%E8%AF%95%E9%A2%98-007/"/>
      <url>/2020/01/16/iOS%E9%9D%A2%E8%AF%95%E9%A2%98-007/</url>
      
        <content type="html"><![CDATA[<h3 id="çº¿ç¨‹æ­»é”çš„å¿…è¦æ¡ä»¶"><a href="#çº¿ç¨‹æ­»é”çš„å¿…è¦æ¡ä»¶" class="headerlink" title="çº¿ç¨‹æ­»é”çš„å¿…è¦æ¡ä»¶"></a>çº¿ç¨‹æ­»é”çš„å¿…è¦æ¡ä»¶</h3><ol><li>äº’æ–¥æ¡ä»¶ : ä¸€ä¸ªèµ„æºæ¯æ¬¡åªèƒ½è¢«ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨ã€‚</li><li>è¯·æ±‚ä¸ä¿æŒæ¡ä»¶ : ä¸€ä¸ªè¿›ç¨‹å› è¯·æ±‚èµ„æºè€Œé˜»å¡æ—¶ï¼Œå¯¹å·²è·å¾—çš„èµ„æºä¿æŒä¸æ”¾ã€‚</li><li>ä¸å‰¥å¤ºæ¡ä»¶ : è¿›ç¨‹å·²è·å¾—çš„èµ„æºï¼Œåœ¨æœ«ä½¿ç”¨å®Œä¹‹å‰ï¼Œä¸èƒ½å¼ºè¡Œå‰¥å¤ºã€‚</li><li>å¾ªç¯ç­‰å¾…æ¡ä»¶ : è‹¥å¹²è¿›ç¨‹ä¹‹é—´å½¢æˆä¸€ç§å¤´å°¾ç›¸æ¥çš„å¾ªç¯ç­‰å¾…èµ„æºå…³ç³»ã€‚</li></ol><h4 id="å¤šå›¾ä¸‹è½½ï¼Œæœ€ååˆå¹¶æˆä¸€ä¸ªå›¾ç‰‡çš„æ–¹å¼"><a href="#å¤šå›¾ä¸‹è½½ï¼Œæœ€ååˆå¹¶æˆä¸€ä¸ªå›¾ç‰‡çš„æ–¹å¼" class="headerlink" title="å¤šå›¾ä¸‹è½½ï¼Œæœ€ååˆå¹¶æˆä¸€ä¸ªå›¾ç‰‡çš„æ–¹å¼"></a>å¤šå›¾ä¸‹è½½ï¼Œæœ€ååˆå¹¶æˆä¸€ä¸ªå›¾ç‰‡çš„æ–¹å¼</h4><ol><li>dispatch_group</li><li>ä¿¡å·é‡</li><li>NSOperationQueue</li></ol><h3 id="çº¿ç¨‹ä¸è¿›ç¨‹çš„å…³ç³»"><a href="#çº¿ç¨‹ä¸è¿›ç¨‹çš„å…³ç³»" class="headerlink" title="çº¿ç¨‹ä¸è¿›ç¨‹çš„å…³ç³»"></a>çº¿ç¨‹ä¸è¿›ç¨‹çš„å…³ç³»</h3><ol><li>è¿›ç¨‹æ˜¯èµ„æºçš„åˆ†é…å’Œè°ƒåº¦çš„ä¸€ä¸ªç‹¬ç«‹å•å…ƒï¼Œè€Œçº¿ç¨‹æ˜¯CPUè°ƒåº¦çš„åŸºæœ¬å•å…ƒ</li><li>åŒä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥åŒ…æ‹¬å¤šä¸ªçº¿ç¨‹ï¼Œå¹¶ä¸”çº¿ç¨‹å…±äº«æ•´ä¸ªè¿›ç¨‹çš„èµ„æºï¼ˆå¯„å­˜å™¨ã€å †æ ˆã€ä¸Šä¸‹æ–‡ï¼‰ï¼Œä¸€ä¸ªè¿›è¡Œè‡³å°‘åŒ…æ‹¬ä¸€ä¸ªçº¿ç¨‹ã€‚</li><li>è¿›ç¨‹çš„åˆ›å»ºè°ƒç”¨forkæˆ–è€…vforkï¼Œè€Œçº¿ç¨‹çš„åˆ›å»ºè°ƒç”¨pthread_createï¼Œè¿›ç¨‹ç»“æŸåå®ƒæ‹¥æœ‰çš„æ‰€æœ‰çº¿ç¨‹éƒ½å°†é”€æ¯ï¼Œè€Œçº¿ç¨‹çš„ç»“æŸä¸ä¼šå½±å“åŒä¸ªè¿›ç¨‹ä¸­çš„å…¶ä»–çº¿ç¨‹çš„ç»“æŸ</li><li>çº¿ç¨‹æ˜¯è½»ä¸¤çº§çš„è¿›ç¨‹ï¼Œå®ƒçš„åˆ›å»ºå’Œé”€æ¯æ‰€éœ€è¦çš„æ—¶é—´æ¯”è¿›ç¨‹å°å¾ˆå¤šï¼Œæ‰€æœ‰æ“ä½œç³»ç»Ÿä¸­çš„æ‰§è¡ŒåŠŸèƒ½éƒ½æ˜¯åˆ›å»ºçº¿ç¨‹å»å®Œæˆçš„</li><li>çº¿ç¨‹ä¸­æ‰§è¡Œæ—¶ä¸€èˆ¬éƒ½è¦è¿›è¡ŒåŒæ­¥å’Œäº’æ–¥ï¼Œå› ä¸ºä»–ä»¬å…±äº«åŒä¸€è¿›ç¨‹çš„æ‰€æœ‰èµ„æº</li><li>çº¿ç¨‹æœ‰è‡ªå·±çš„ç§æœ‰å±æ€§TCBï¼Œçº¿ç¨‹idï¼Œå¯„å­˜å™¨ã€ç¡¬ä»¶ä¸Šä¸‹æ–‡ï¼Œè€Œè¿›ç¨‹ä¹Ÿæœ‰è‡ªå·±çš„ç§æœ‰å±æ€§è¿›ç¨‹æ§åˆ¶å—PCBï¼Œè¿™äº›ç§æœ‰å±æ€§æ˜¯ä¸è¢«å…±äº«çš„ï¼Œç”¨æ¥æ ‡ç¤ºä¸€ä¸ªè¿›ç¨‹æˆ–ä¸€ä¸ªçº¿ç¨‹çš„æ ‡å¿—</li></ol><h3 id="çº¿ç¨‹ä¸Runloopçš„å…³ç³»"><a href="#çº¿ç¨‹ä¸Runloopçš„å…³ç³»" class="headerlink" title="çº¿ç¨‹ä¸Runloopçš„å…³ç³»"></a>çº¿ç¨‹ä¸Runloopçš„å…³ç³»</h3><ol><li>RunLoop çš„ä½œç”¨å°±æ˜¯æ¥ç®¡ç†çº¿ç¨‹çš„ï¼Œå½“çº¿ç¨‹çš„ RunLoopå¼€å¯åï¼Œçº¿ç¨‹å°±ä¼šåœ¨æ‰§è¡Œå®Œä»»åŠ¡åï¼Œå¤„äºä¼‘çœ çŠ¶æ€ï¼Œéšæ—¶ç­‰å¾…æ¥å—æ–°çš„ä»»åŠ¡ï¼Œè€Œä¸æ˜¯é€€å‡ºã€‚</li><li>åªæœ‰ä¸»çº¿ç¨‹çš„RunLoopæ˜¯é»˜è®¤å¼€å¯çš„ï¼Œæ‰€ä»¥ç¨‹åºåœ¨å¼€å¯åï¼Œä¼šä¸€ç›´è¿è¡Œï¼Œä¸ä¼šé€€å‡ºã€‚å…¶ä»–çº¿ç¨‹çš„RunLoopå¦‚æœéœ€è¦å¼€å¯ï¼Œå°±æ‰‹åŠ¨å¼€å¯ã€‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> é¢è¯•é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¢è¯•æŠ€å·§ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iOSé¢è¯•é¢˜-006</title>
      <link href="/2020/01/16/iOS%E9%9D%A2%E8%AF%95%E9%A2%98-006/"/>
      <url>/2020/01/16/iOS%E9%9D%A2%E8%AF%95%E9%A2%98-006/</url>
      
        <content type="html"><![CDATA[<h3 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h3><ul><li><p>å¦‚ä½•æ˜¯è‡ªå·±å†™çš„å¯¹è±¡å…·æœ‰æ‹·è´åŠŸèƒ½</p><blockquote><p> éœ€å®ç° NSCopying åè®®ã€‚</p></blockquote></li><li><p>è¯´è¯´ä½ å¦‚ä½•ç†è§£weakå±æ€§</p><blockquote><p>Runtimeç»´æŠ¤äº†ä¸€ä¸ªweakè¡¨ï¼Œç”¨äºå­˜å‚¨æŒ‡å‘æŸä¸ªå¯¹è±¡çš„æ‰€æœ‰weakæŒ‡é’ˆã€‚weakè¡¨å…¶å®æ˜¯ä¸€ä¸ªhashï¼ˆå“ˆå¸Œï¼‰è¡¨ï¼ŒKeyæ˜¯æ‰€æŒ‡å¯¹è±¡çš„åœ°å€ï¼ŒValueæ˜¯weakæŒ‡é’ˆçš„åœ°å€ï¼ˆè¿™ä¸ªåœ°å€çš„å€¼æ˜¯æ‰€æŒ‡å¯¹è±¡çš„åœ°å€ï¼‰æ•°ç»„ã€‚<br><br>1ã€åˆå§‹åŒ–æ—¶ï¼šruntimeä¼šè°ƒç”¨objc_initWeakå‡½æ•°ï¼Œåˆå§‹åŒ–ä¸€ä¸ªæ–°çš„weakæŒ‡é’ˆæŒ‡å‘å¯¹è±¡çš„åœ°å€ã€‚<br><br>2ã€æ·»åŠ å¼•ç”¨æ—¶ï¼šobjc_initWeakå‡½æ•°ä¼šè°ƒç”¨ objc_storeWeak() å‡½æ•°ï¼Œ objc_storeWeak() çš„ä½œç”¨æ˜¯æ›´æ–°æŒ‡é’ˆæŒ‡å‘ï¼Œåˆ›å»ºå¯¹åº”çš„å¼±å¼•ç”¨è¡¨ã€‚<br><br>3ã€é‡Šæ”¾æ—¶ï¼Œè°ƒç”¨clearDeallocatingå‡½æ•°ã€‚clearDeallocatingå‡½æ•°é¦–å…ˆæ ¹æ®å¯¹è±¡åœ°å€è·å–æ‰€æœ‰weakæŒ‡é’ˆåœ°å€çš„æ•°ç»„ï¼Œç„¶åéå†è¿™ä¸ªæ•°ç»„æŠŠå…¶ä¸­çš„æ•°æ®è®¾ä¸ºnilï¼Œæœ€åæŠŠè¿™ä¸ªentryä»weakè¡¨ä¸­åˆ é™¤ï¼Œæœ€åæ¸…ç†å¯¹è±¡çš„è®°å½•ã€‚</p></blockquote></li><li><p>UIViewå’ŒCALayerçš„å…³ç³»</p><blockquote><p>æ¯ä¸ªUIViewéƒ½å¯¹åº”ç€ä¸€ä¸ªCALayer,å½“æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªUIViewä¹‹åä¹Ÿä¼šåˆ›å»ºå¯¹åº”çš„CALayerã€‚UIViewä¹‹æ‰€ä»¥èƒ½å¤Ÿæ˜¾ç¤ºå†…å®¹ï¼Œå…¶å®è¿˜æ˜¯é CALayeræ¥ç»˜åˆ¶çš„ã€‚UIViewæœ¬èº«å°±åƒæ˜¯CALayerçš„ç®¡ç†è€…ï¼Œè®¿é—®UIViewçš„åæ ‡ï¼Œä¾‹å¦‚ï¼šframeï¼Œcenterç­‰ï¼Œå…¶å®æ˜¯è®¿é—®å†…éƒ¨layerçš„frameã€positionç­‰ç›¸å…³å±æ€§ã€‚</p></blockquote></li></ul><ul><li><p>@synthesizeå’Œ@dynamicåˆ†åˆ«ä»€ä¹ˆä½œç”¨?</p><blockquote><p>1ã€@propertyæœ‰ä¸¤ä¸ªå¯¹åº”çš„è¯ï¼Œä¸€ä¸ªæ˜¯ @synthesizeï¼Œä¸€ä¸ªæ˜¯ @dynamicã€‚å¦‚æœ @synthesizeå’Œ @dynamicéƒ½æ²¡å†™ï¼Œé‚£ä¹ˆé»˜è®¤çš„å°±æ˜¯@syntheszie var = _var;<br><br>2ã€@synthesize çš„è¯­ä¹‰æ˜¯å¦‚æœä½ æ²¡æœ‰æ‰‹åŠ¨å®ç° setter æ–¹æ³•å’Œ getter æ–¹æ³•ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ä¸ºä½ åŠ ä¸Šè¿™ä¸¤ä¸ªæ–¹æ³•ã€‚<br><br>3ã€@dynamic å‘Šè¯‰ç¼–è¯‘å™¨ï¼šå±æ€§çš„ setter ä¸ getter æ–¹æ³•ç”±ç”¨æˆ·è‡ªå·±å®ç°ï¼Œä¸è‡ªåŠ¨ç”Ÿæˆã€‚ï¼ˆå½“ç„¶å¯¹äº readonly çš„å±æ€§åªéœ€æä¾› getter å³å¯ï¼‰ã€‚å‡å¦‚ä¸€ä¸ªå±æ€§è¢«å£°æ˜ä¸º @dynamic varï¼Œç„¶åä½ æ²¡æœ‰æä¾› @setteræ–¹æ³•å’Œ @getter æ–¹æ³•ï¼Œç¼–è¯‘çš„æ—¶å€™æ²¡é—®é¢˜ï¼Œä½†æ˜¯å½“ç¨‹åºè¿è¡Œåˆ° instance.var = someVarï¼Œç”±äºç¼º setter æ–¹æ³•ä¼šå¯¼è‡´ç¨‹åºå´©æºƒï¼›æˆ–è€…å½“è¿è¡Œåˆ° someVar = var æ—¶ï¼Œç”±äºç¼º getter æ–¹æ³•åŒæ ·ä¼šå¯¼è‡´å´©æºƒã€‚ç¼–è¯‘æ—¶æ²¡é—®é¢˜ï¼Œè¿è¡Œæ—¶æ‰æ‰§è¡Œç›¸åº”çš„æ–¹æ³•ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„åŠ¨æ€ç»‘å®šã€‚</p></blockquote></li><li><p>åŠ¨æ€ç»‘å®š</p></li><li><p>Category(ç±»åˆ«)ã€Extension(æ‰©å±•)å’Œç»§æ‰¿çš„åŒºåˆ«</p><blockquote><p>1ã€Categoryï¼šåˆ†ç±»å°±æ˜¯å¯¹ä¸€ä¸ªç±»çš„åŠŸèƒ½è¿›è¡Œæ‰©å±•,,è®©è¿™ä¸ªç±»èƒ½å¤Ÿé€‚åº”ä¸ä¸åŒæƒ…å†µçš„éœ€æ±‚.åœ¨ä¸€èˆ¬çš„å®é™…å¼€å‘ä¸­,æˆ‘ä»¬éƒ½ä¼šå¯¹ç³»ç»Ÿçš„ä¸€äº›å¸¸ç”¨ç±»è¿›è¡Œæ‰©å±•,æ¯”å¦‚,NSString,Button,Labelç­‰ç­‰,ç®€å•æ¥è¯´ç±»åˆ«æ˜¯ä¸€ç§ä¸ºç°æœ‰çš„ç±»æ·»åŠ æ–°æ–¹æ³•çš„æ–¹å¼ã€‚<br><br><br>2ã€Extensionï¼šæ˜¯Categoryçš„ä¸€ä¸ªç‰¹ä¾‹<br>ä½œç”¨:ä¸ºä¸€ä¸ªç±»å¢åŠ ç§æœ‰æ–¹æ³•,å±æ€§æˆ–æˆå‘˜å˜é‡,ä¹Ÿå°±æ˜¯è¯´åªèƒ½è¿™äº›åªèƒ½åœ¨æœ¬æ–‡ä»¶ä¸­è¢«ä½¿ç”¨å…¶åå­—ä¸ºåŒ¿å(ä¸ºç©º),<br>å¹¶ä¸”æ–°æ·»åŠ çš„æ–¹æ³•ä¸€å®šè¦äºˆä»¥å®ç°ã€‚(Categoryæ²¡æœ‰è¿™ä¸ªé™åˆ¶)<br><br><br>3ã€ç»§æ‰¿ï¼šå¤šä¸ªç±»å…·æœ‰ç›¸åŒçš„å®ä¾‹å˜é‡å’Œæ–¹æ³•æ—¶ï¼Œè€ƒè™‘ç”¨ç»§æ‰¿ã€‚å³å­ç±»å¯ä»¥ç»§æ‰¿çˆ¶ç±»çš„ç›¸åŒç‰¹æ€§ã€‚å¦‚animalå…·æœ‰å¹´é¾„å’Œä½“é‡ä¸¤ä¸ªå±æ€§ï¼Œdogä¹Ÿå…·æœ‰å¹´é¾„å’Œä½“é‡ä¸¤ ä¸ªå±æ€§ï¼Œdogå¯ä»¥ç»§æ‰¿animalçš„è¿™ä¸¤ä¸ªå±æ€§ï¼Œå³ä¸ºç»§æ‰¿ã€‚</p></blockquote></li><li><p>ä¸ºä»€ä¹ˆä»£ç†è¦ç”¨weakï¼Ÿdelegateå’ŒDataSourceæœ‰ä»€ä¹ˆåŒºåˆ«ï¼ŸBlockå’Œä»£ç†çš„åŒºåˆ«ï¼Ÿ</p></li></ul><ul><li><p>idå’ŒNSObject *çš„åŒºåˆ«</p><blockquote><p>1ã€NSObjectåŒ…å«äº†ä¸€äº›å…¶ä»–çš„æ–¹æ³•ï¼Œéœ€è¦å®ç°NSObjectåè®®ï¼Œå¯ä»¥ç”¨NSObjectæ¥è¡¨ç¤ºidï¼Œä½†æ˜¯ä¸èƒ½ç”¨idæ¥è¡¨ç¤ºNSObjectã€‚<br><br>2ã€idå…³é”®å­—åœ¨ç¼–è¯‘çš„æ—¶å€™ä¸ä¼šè¢«æ£€æŸ¥ï¼Œè€ŒNSObjectåœ¨ç¼–è¯‘çš„æ—¶å€™è¢«è¢«æ£€æŸ¥æ˜¯å¦å«æœ‰ä¸€äº›é”™è¯¯çš„æ–¹æ³•<br><br>3ã€idå¯ä»¥æ˜¯ä»»ä½•å¯¹è±¡ï¼ŒåŒ…æ‹¬ä¸æ˜¯NSObjectçš„å¯¹è±¡<br><br>4ã€å®šä¹‰idçš„æ—¶å€™ä¸éœ€è¦*ï¼Œè€Œå®šä¹‰NSOjectçš„æ—¶å€™éœ€è¦ã€‚</p></blockquote></li><li><p>é’ˆå¯¹ç³»ç»Ÿæä¾›çš„Block APIï¼Œæ˜¯å¦ä¹Ÿè¦è€ƒè™‘å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼Ÿ</p><blockquote><p>ç³»ç»Ÿçš„æŸäº›block apiä¸­ï¼ŒUIViewçš„blockç‰ˆæœ¬å†™åŠ¨ç”»æ—¶ä¸éœ€è¦è€ƒè™‘ï¼Œä½†ä¹Ÿæœ‰ä¸€äº›api éœ€è¦è€ƒè™‘ã€‚<br>ä»¥ä¸‹è¿™äº›ä½¿ç”¨æ–¹å¼ä¸ä¼šå¼•èµ·å¾ªç¯å¼•ç”¨çš„é—®é¢˜</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[UIView animateWithDuration:1.2 animations:^&#123;</span><br><span class="line">        [self.view layoutIfNeeded];</span><br><span class="line">    &#125;];</span><br><span class="line">    </span><br><span class="line">    [[NSOperationQueue mainQueue] addOperationWithBlock:^&#123;</span><br><span class="line">       &#x2F;&#x2F; Do Some Thing</span><br><span class="line">    &#125;];</span><br><span class="line">    </span><br><span class="line">    [[NSNotificationCenter defaultCenter] addObserverForName:@&quot;someNotification&quot; object:nil queue:[NSOperationQueue mainQueue] usingBlock:^(NSNotification * _Nonnull note) &#123;</span><br><span class="line">         &#x2F;&#x2F; Do Some Thing</span><br><span class="line">    &#125;];</span><br></pre></td></tr></table></figure><p>ä½†å¦‚æœæ–¹æ³•ä¸­çš„ä¸€äº›å‚æ•°æ˜¯ æˆå‘˜å˜é‡ï¼Œé‚£ä¹ˆå¯ä»¥é€ æˆå¾ªç¯å¼•ç”¨ï¼Œå¦‚ GCD ã€NSNotificationCenterè°ƒç”¨å°±è¦å°å¿ƒä¸€ç‚¹ï¼Œæ¯”å¦‚ GCD å†…éƒ¨å¦‚æœå¼•ç”¨äº† selfï¼Œè€Œä¸” GCD çš„å‚æ•°æ˜¯ æˆå‘˜å˜é‡ï¼Œåˆ™è¦è€ƒè™‘åˆ°å¾ªç¯å¼•ç”¨ï¼Œä¸¾ä¾‹å¦‚ä¸‹ï¼š<br><br>GCD-&gt;åˆ†æï¼šselfâ€“&gt;_operationsQueueâ€“&gt;blockâ€“&gt;selfå½¢æˆé—­ç¯ï¼Œå°±é€ æˆäº†å¾ªç¯å¼•ç”¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;dispatch_group_async(_operationsGroup, _operationsQueue, ^&#123;</span><br><span class="line">       &#x2F;&#x2F; Do Some Thing</span><br><span class="line">&gt;&#125;);</span><br></pre></td></tr></table></figure><p>NSNotificationCenter-&gt;åˆ†æ:selfâ€“&gt;_observerâ€“&gt;blockâ€“&gt;selfå½¢æˆé—­ç¯ï¼Œå°±é€ æˆäº†å¾ªç¯å¼•ç”¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;_observer &#x3D; [[NSNotificationCenter defaultCenter] addObserverForName:@&quot;testKey&quot; object:nil queue:nil usingBlock:^(NSNotification *note)&#123;</span><br><span class="line">&#x2F;&#x2F; Do Some Thing</span><br><span class="line">&gt;&#125;];</span><br></pre></td></tr></table></figure></blockquote></li><li><p>åœ¨@propertyä¸­ä¸ºä»€ä¹ˆ NSString ï¼ˆæˆ–NSArrayï¼ŒNSDictionaryï¼‰ä½¿ç”¨copyå…³é”®å­—ï¼Ÿæ”¹æˆStrongæœ‰å¯èƒ½ä¼šé€ æˆä»€ä¹ˆé—®é¢˜ï¼Ÿ</p><blockquote><p>1ã€å› ä¸ºçˆ¶ç±»æŒ‡é’ˆå¯ä»¥æŒ‡å‘å­ç±»å¯¹è±¡,ä½¿ç”¨copyçš„ç›®çš„æ˜¯ä¸ºäº†è®©æœ¬å¯¹è±¡çš„å±æ€§ä¸å—å¤–ç•Œå½±å“,ä½¿ç”¨copyæ— è®ºç»™æˆ‘ä¼ å…¥æ˜¯ä¸€ä¸ªå¯å˜å¯¹è±¡è¿˜æ˜¯ä¸å¯å¯¹è±¡,æˆ‘æœ¬èº«æŒæœ‰çš„å°±æ˜¯ä¸€ä¸ªä¸å¯å˜çš„å‰¯æœ¬.<br><br>2ã€å¦‚æœæˆ‘ä»¬ä½¿ç”¨æ˜¯strong,é‚£ä¹ˆè¿™ä¸ªå±æ€§å°±æœ‰å¯èƒ½æŒ‡å‘ä¸€ä¸ªå¯å˜å¯¹è±¡,å¦‚æœè¿™ä¸ªå¯å˜å¯¹è±¡åœ¨å¤–éƒ¨è¢«ä¿®æ”¹äº†,é‚£ä¹ˆä¼šå½±å“è¯¥å±æ€§.</p></blockquote></li><li><p>å…³é”®å­—const/static/externã€UIKIT_EXTERNåŒºåˆ«å’Œç”¨æ³•</p><blockquote><p>1ã€const<br><br>ï¼ˆ1ï¼‰constç”¨æ¥ä¿®é¥°å³è¾¹çš„åŸºæœ¬å˜é‡æˆ–æŒ‡é’ˆå˜é‡<br><br>ï¼ˆ2ï¼‰è¢«ä¿®é¥°çš„å˜é‡åªè¯»ï¼Œä¸èƒ½è¢«ä¿®æ”¹<br><br> <br>2ã€static<br><br>ï¼ˆ1ï¼‰ä¿®é¥°å±€éƒ¨å˜é‡<br><br>ï¼ˆ2ï¼‰ä¿®é¥°å…¨å±€å˜é‡<br><br>ï¼ˆ3ï¼‰ä¿®é¥°å‡½æ•°<br><br><br>3ã€extern<br><br>ï¼ˆ1ï¼‰å£°æ˜å¤–éƒ¨å…¨å±€å˜é‡ã€‚è¿™é‡Œéœ€è¦ç‰¹åˆ«æ³¨æ„externåªèƒ½å£°æ˜ï¼Œä¸èƒ½ç”¨äºå®ç°ï¼Œè€Œä¸”å®šä¹‰å’Œåˆ†é…å†…å­˜éƒ½åœ¨åŸæ¥ç±»ä¸­ã€‚<br><br><br>4ã€UIKIT_EXTERN<br><br>ï¼ˆ1ï¼‰å°†å‡½æ•°ä¿®é¥°ä¸ºå…¼å®¹ä»¥å¾€Cç¼–è¯‘æ–¹å¼çš„ã€å…·æœ‰externå±æ€§(æ–‡ä»¶å¤–å¯è§æ€§)ã€publicä¿®é¥°çš„æ–¹æ³•æˆ–å˜é‡åº“å¤–ä»å¯è§çš„å±æ€§</p></blockquote><h3 id="åº•å±‚"><a href="#åº•å±‚" class="headerlink" title="åº•å±‚"></a>åº•å±‚</h3><ul><li>main()ä¹‹å‰æœ‰å“ªäº›è¿‡ç¨‹ï¼Ÿ</li></ul></li></ul><ul><li>KVOçš„åŸç†</li></ul><blockquote><p>å½“è§‚å¯ŸæŸå¯¹è±¡æ—¶ï¼ŒKVOåŠ¨æ€åˆ›å»ºè¯¥å¯¹è±¡çš„å­ç±»ï¼Œå¹¶é‡å†™å­ç±»è¢«è§‚å¯Ÿå±æ€§setteræ–¹æ³•ï¼Œéšåé€šçŸ¥è§‚å¯Ÿè€…è¯¥å±æ€§çš„å˜åŒ–çŠ¶å†µã€‚</p></blockquote><ul><li><p>Swiftå¦‚ä½•ä½¿ç”¨KVOï¼Ÿ</p></li><li><p>Swiftæœ‰å“ªäº›åŒ¹é…æ¨¡å¼ï¼Ÿ</p></li><li><p>Objcå‘ä¸€ä¸ªå¯¹è±¡å‘é€æ¶ˆæ¯ï¼Œå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</p><blockquote><p>Runtimeåº“ä¼šæ ¹æ®å¯¹è±¡çš„isaæŒ‡é’ˆæ‰¾åˆ°è¯¥å¯¹è±¡å®é™…æ‰€å±çš„ç±»ï¼Œç„¶ååœ¨è¯¥ç±»ä¸­çš„æ–¹æ³•åˆ—è¡¨ä»¥åŠå…¶çˆ¶ç±»æ–¹æ³•åˆ—è¡¨ä¸­å¯»æ‰¾æ–¹æ³•è¿è¡Œï¼Œç„¶ååœ¨å‘é€æ¶ˆæ¯çš„æ—¶å€™ï¼Œobjc_msgSendæ–¹æ³•ä¸ä¼šè¿”å›å€¼ï¼Œæ‰€è°“çš„è¿”å›å†…å®¹éƒ½æ˜¯å…·ä½“è°ƒç”¨æ—¶æ‰§è¡Œçš„ã€‚</p></blockquote></li><li><p>é™æ€åº“çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿä½ æœ‰æ²¡æœ‰å†™è¿‡å“ªäº›é™æ€åº“? é‡åˆ°å“ªäº›é—®é¢˜ï¼Ÿ</p></li><li><p>Runloopæ˜¯ç”¨æ¥åšä»€ä¹ˆçš„ï¼Ÿrunloopå’Œçº¿ç¨‹çš„å…³ç³»ï¼Ÿä¸»çº¿ç¨‹é»˜è®¤å¼€å§‹runloopäº†å—ï¼Ÿ å­çº¿ç¨‹å‘¢ï¼Ÿ</p><blockquote></blockquote></li><li><p>ä¸æ‰‹åŠ¨æŒ‡å®šautoreleasepoolçš„å‰æä¸‹ï¼Œautoreleasepoolåœ¨ä»€ä¹ˆä»€ä¹ˆæ—¶åˆ»é‡Šæ”¾ï¼Ÿï¼ˆæ¯”å¦‚åœ¨vcçš„viewDidLoadä¸­åˆ›å»ºï¼‰</p><blockquote><ul><li>æ‰‹åŠ¨å¹²é¢„é‡Šæ”¾æ—¶æœº - æŒ‡å®šautoreleasepoolå°±æ˜¯æ‰€è°“çš„ï¼šå½“å‰ä½œç”¨åŸŸå¤§æ‹¬å·ç»“æŸæ—¶é‡Šæ”¾ã€‚</li><li>ç³»ç»Ÿè‡ªåŠ¨å»é‡Šæ”¾ - ä¸æ‰‹åŠ¨æŒ‡å®šautoreleasepool<br>Autoreleaseå¯¹è±¡å‡ºäº†ä½œç”¨åŸŸä¹‹åï¼Œä¼šè¢«æ·»åŠ åˆ°æœ€è¿‘ä¸€æ¬¡åˆ›å»ºçš„è‡ªåŠ¨é‡Šæ”¾æ± ä¸­ï¼Œå¹¶ä¼šåœ¨å½“å‰çš„ runloop è¿­ä»£ç»“æŸæ—¶é‡Šæ”¾ã€‚<br>å¦‚æœåœ¨ä¸€ä¸ªvcçš„viewDidLoadä¸­åˆ›å»ºä¸€ä¸ª Autoreleaseå¯¹è±¡ï¼Œé‚£ä¹ˆè¯¥å¯¹è±¡ä¼šåœ¨ viewDidAppear æ–¹æ³•æ‰§è¡Œå‰å°±è¢«é”€æ¯äº†ã€‚</li></ul></blockquote></li></ul><ul><li><p>OCä¸­çš„æ¶ˆæ¯è½¬å‘æœºåˆ¶+ä»£ç å®ç°</p><blockquote></blockquote></li><li><p>ä»¥ + scheduledTimerWithTimeIntervalâ€¦çš„æ–¹å¼è§¦å‘çš„NSTimerï¼Œåœ¨æ»‘åŠ¨çš„åˆ—è¡¨æ—¶ï¼Œtimerä¼šæš‚æ—¶å›è°ƒï¼Œä¸ºä»€ä¹ˆï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ</p><blockquote></blockquote></li><li><p>å¦‚ä½•æ‰‹åŠ¨è§¦å‘ä¸€ä¸ªvalueçš„KVOï¼Ÿ</p><blockquote><p>è‡ªåŠ¨è§¦å‘ï¼š</p><blockquote><p>è‡ªåŠ¨è§¦å‘æ˜¯æŒ‡ç±»ä¼¼çš„è¿™ç§åœºæ™¯ï¼šåœ¨æ³¨å†ŒKVOä¹‹å‰è®¾ç½®ä¸€ä¸ªåˆå§‹å€¼ï¼Œ<br>æ³¨å†Œä¹‹åè®¾ç½®ä¸€ä¸ªä¸ä¸€æ ·çš„å€¼ï¼Œå°±å¯ä»¥è§¦å‘äº†ã€‚</p></blockquote></blockquote></li></ul><blockquote><p>æ‰‹åŠ¨è§¦å‘ï¼š</p><blockquote><p>é”®å€¼è§‚å¯Ÿé€šçŸ¥ä¾èµ–äºNSObjectçš„ä¸¤ä¸ªæ–¹æ³•ï¼š<br>willChangeValueForKeyï¼šå’ŒdidChangeValueForKeyï¼šã€‚<br>åœ¨ä¸€ä¸ªè¢«è§‚å¯Ÿå±æ€§å‘ç”Ÿæ”¹å˜ä¹‹å‰ï¼ŒwillChangeValueForKeyï¼šä¸€å®šä¼šè¢«è°ƒç”¨ï¼Œè¿™å°±ä¼šè®°å½•æ—§çš„å€¼ã€‚<br>è€Œå½“æ”¹å˜å‘ç”Ÿåï¼ŒdidChangeValueForKeyï¼šä¼šè¢«è°ƒç”¨ï¼Œ<br>ç»§è€ŒobjectServeValueForKeyï¼šofObjectï¼šchangeï¼šcontentï¼šä¹Ÿä¼šè¢«è°ƒç”¨ã€‚<br>å¦‚æœå¯ä»¥æ‰‹åŠ¨å®ç°è¿™äº›è°ƒç”¨ï¼Œå°±å¯ä»¥å®ç°â€œæ‰‹åŠ¨è§¦å‘â€äº†ã€‚</p></blockquote></blockquote><ul><li>å¦‚ä½•å®šä½å’Œåˆ†æé¡¹ç›®ä¸­å½±å“æ€§èƒ½çš„åœ°æ–¹ï¼Ÿä»¥åŠå¦‚ä½•è¿›è¡Œæ€§èƒ½ä¼˜åŒ–ï¼Ÿ</li><li>ä¸²è¡Œå¹¶è¡Œï¼Œå¼‚æ­¥åŒæ­¥çš„åŒºåˆ«<blockquote><ul><li>ä¸²è¡Œå¹¶è¡Œ<blockquote><p>æŒ‡çš„æ˜¯èƒ½å¦å¼€å¯æ–°çš„çº¿ç¨‹ã€‚åŒæ­¥ä¸èƒ½å¼€å¯æ–°çš„çº¿ç¨‹ï¼Œå¼‚æ­¥å¯ä»¥ã€‚</p></blockquote></li><li>å¼‚æ­¥åŒæ­¥<blockquote><p>æŒ‡çš„æ˜¯ä»»åŠ¡çš„æ‰§è¡Œæ–¹å¼ã€‚ä¸²è¡Œæ˜¯æŒ‡å¤šä¸ªä»»åŠ¡æ—¶ï¼Œå„ä¸ªä»»åŠ¡æŒ‰é¡ºåºæ‰§è¡Œï¼Œå®Œæˆä¸€ä¸ªä¹‹åæ‰èƒ½è¿›è¡Œä¸‹ä¸€ä¸ªã€‚å¹¶è¡ŒæŒ‡çš„æ˜¯å¤šä¸ªä»»åŠ¡å¯ä»¥åŒæ—¶æ‰§è¡Œã€‚å¼‚æ­¥æ˜¯å¤šä¸ªä»»åŠ¡å¹¶è¡Œçš„å‰ææ¡ä»¶ã€‚</p></blockquote></li></ul></blockquote></li></ul><ul><li>çº¿ç¨‹æ˜¯ä»€ä¹ˆï¼Ÿè¿›ç¨‹æ˜¯ä»€ä¹ˆï¼ŸäºŒè€…æœ‰ä»€ä¹ˆåŒºåˆ«å’Œè”ç³»ï¼Ÿ<blockquote><ul><li>çº¿ç¨‹æ˜¯CPUç‹¬ç«‹è¿è¡Œå’Œç‹¬ç«‹è°ƒåº¦çš„åŸºæœ¬å•ä½</li><li>è¿›ç¨‹æ˜¯èµ„æºåˆ†é…çš„åŸºæœ¬å•ä½ï¼›</li><li>ä¸¤è€…çš„è”ç³»ï¼šè¿›ç¨‹å’Œçº¿ç¨‹éƒ½æ˜¯æ“ä½œç³»ç»Ÿæ‰€è¿è¡Œçš„ç¨‹åºè¿è¡Œçš„åŸºæœ¬å•å…ƒã€‚</li><li>åŒºåˆ«ï¼š<blockquote><ul><li>è¿›ç¨‹å…·æœ‰ç‹¬ç«‹çš„ç©ºé—´åœ°å€ï¼Œä¸€ä¸ªè¿›ç¨‹å´©æºƒåï¼Œåœ¨ä¿æŠ¤æ¨¡å¼ä¸‹ä¸ä¼šå¯¹å…¶å®ƒè¿›ç¨‹äº§ç”Ÿå½±å“ã€‚</li><li>çº¿ç¨‹åªæ˜¯ä¸€ä¸ªè¿›ç¨‹çš„ä¸åŒæ‰§è¡Œè·¯å¾„ï¼Œçº¿ç¨‹æœ‰è‡ªå·±çš„å †æ ˆå’Œå±€éƒ¨å˜é‡ï¼Œä½†çº¿ç¨‹ä¹‹é—´æ²¡æœ‰å•ç‹¬çš„åœ°å€ç©ºé—´ï¼Œä¸€ä¸ªçº¿ç¨‹æ­»æ‰å°±ç­‰äºæ•´ä¸ªè¿›ç¨‹æ­»æ‰ã€‚</li></ul></blockquote></li></ul></blockquote></li></ul>]]></content>
      
      
      <categories>
          
          <category> é¢è¯•é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¢è¯•æŠ€å·§ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iOSé¢è¯•é¢˜-004</title>
      <link href="/2020/01/16/iOS%E9%9D%A2%E8%AF%95%E9%A2%98-004/"/>
      <url>/2020/01/16/iOS%E9%9D%A2%E8%AF%95%E9%A2%98-004/</url>
      
        <content type="html"><![CDATA[<p>1ã€swiftå’Œocçš„åŒºåˆ«</p><p>2ã€ç¼–è¯‘é“¾æ¥</p><p>3ã€synthesize &amp; denamic</p><p>4ã€åœ¨é¡¹ç›®å¼€å‘ä¸­å¸¸ç”¨çš„å¼€å‘å·¥å…·æœ‰å“ªäº›ï¼Ÿ</p><p>5ã€UITableView &amp; UICollection</p><p>6ã€NSProxy &amp; NSObject</p><p>7ã€Object &amp; Swift</p><p>8ã€ä¼ å€¼é€šçŸ¥ &amp; æ¨é€é€šçŸ¥ï¼ˆæœ¬åœ°&amp;è¿œç¨‹ï¼‰</p><p>9ã€ç¬¬ä¸‰æ–¹åº“ &amp; ç¬¬ä¸‰æ–¹å¹³å°</p><p>10ã€NSCache &amp; NSDcitionary</p><p>11ã€ UIViewçš„setNeedsDisplayå’ŒsetNeedsLayoutæ–¹æ³•</p><p>12ã€UILayer &amp; UIView</p><p>13ã€layoutSubViews &amp; drawRects</p><p>14ã€UDID &amp; UUID</p><p>15ã€CPU &amp; GPU</p><p>16ã€ç‚¹ï¼ˆptï¼‰&amp; åƒç´ ï¼ˆpxï¼‰</p><p>17ã€å±æ€§ä¸æˆå‘˜å˜é‡</p><p>18ã€intå’ŒNSIntegerçš„åŒºåˆ«</p><p>ï¼ˆ1ï¼‰importå’Œinclude</p><p>ï¼ˆ2ï¼‰@class</p><p>ï¼ˆ3ï¼‰å…¨å±€ &amp; é™æ€å˜é‡</p><p>19ã€ç±»å’Œå¯¹è±¡</p><p>ï¼ˆ1ï¼‰åˆ†ç±»æ‹“å±•åè®®ä¸­å“ªäº›å¯ä»¥å£°æ˜å±æ€§?</p><p>ï¼ˆ2ï¼‰ç»§æ‰¿å’Œç±»åˆ«çš„åŒºåˆ«</p><p>ï¼ˆ3ï¼‰åˆ†ç±»çš„ä½œç”¨</p><p>ï¼ˆ4ï¼‰åˆ†ç±»çš„å±€é™æ€§</p><p>20ã€category &amp; extension</p><p>21ã€Foundation</p><p>ï¼ˆ1ï¼‰å­—ç¬¦ä¸²</p><p>ï¼ˆ2ï¼‰å­—ç¬¦ä¸²æˆªå–</p><p>ï¼ˆ3ï¼‰æ ¼å¼</p><p>22ã€NSArrayå’ŒNSDictionary</p><p>ï¼ˆ1ï¼‰iOSéå†æ•°ç»„/å­—å…¸çš„æ–¹æ³•</p><p>ï¼ˆ2ï¼‰NSValue NSNumber</p><p>ï¼ˆ3ï¼‰å…¶å®ƒ</p><p>ï¼ˆ4ï¼‰å¦‚ä½•é¿å…å¾ªç¯å¼•ç”¨</p><p>23ã€CFSocketä½¿ç”¨æœ‰å“ªå‡ ä¸ªæ­¥éª¤</p><p>24ã€Core Foundationä¸­æä¾›äº†å“ªå‡ ç§æ“ä½œSocketçš„æ–¹æ³•ï¼Ÿ</p><p>25ã€è§£æXMLæ–‡ä»¶æœ‰å“ªå‡ ç§æ–¹å¼ï¼Ÿ</p><p>26ã€ä»€ä¹ˆæ˜¯æ²™ç›’æ¨¡å‹ï¼Ÿå“ªäº›æ“ä½œæ˜¯å±äºç§æœ‰apièŒƒç•´?</p><p>27ã€åœ¨ä¸€ä¸ªå¯¹è±¡çš„æ–¹æ³•é‡Œé¢ï¼šself.name= â€œobjectâ€ï¼›å’Œ name =â€objectâ€ æœ‰ä»€ä¹ˆä¸åŒå—?</p><p>28ã€è¯·ç®€è¦è¯´æ˜viewDidLoadå’ŒviewDidUnloadä½•æ—¶è°ƒç”¨</p><p>29ã€åˆ›å»ºæ§åˆ¶å™¨ã€è§†å›¾çš„æ–¹å¼</p><p>30ã€ç®€è¿°å†…å­˜åˆ†åŒºæƒ…å†µ</p><p>31ã€é˜Ÿåˆ—å’Œæ ˆæœ‰ä»€ä¹ˆåŒºåˆ«</p><p>32ã€iOSçš„ç³»ç»Ÿæ¶æ„</p><p>33ã€æ§ä»¶ä¸»è¦å“åº”3ç§äº‹ä»¶</p><p>34ã€xibæ–‡ä»¶çš„æ„æˆåˆ†ä¸ºå“ª3ä¸ªå›¾æ ‡ï¼Ÿéƒ½å…·æœ‰ä»€ä¹ˆåŠŸèƒ½</p><p>35ã€ç®€è¿°è§†å›¾æ§ä»¶å™¨çš„ç”Ÿå‘½å‘¨æœŸ</p><p>36ã€app é¡¹ç›®çš„ç”Ÿå‘½å‘¨æœŸ</p><p>ï¼ˆ1ï¼‰åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸ</p><p>ï¼ˆ2ï¼‰ç®€è¦è¯´æ˜ä¸€ä¸‹APPçš„å¯åŠ¨è¿‡ç¨‹ï¼Œmainæ–‡ä»¶è¯´èµ·ï¼Œmainå‡½æ•°ä¸­æœ‰ä»€ä¹ˆå‡½æ•°ï¼Ÿä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>ï¼ˆ3ï¼‰UIApplicationMainå‡½æ•°ä½œç”¨</p><p>ï¼ˆ4ï¼‰mainå‡½æ•°ä½œç”¨</p><p>37ã€ åŠ¨ç”»æœ‰åŸºæœ¬ç±»å‹æœ‰å“ªå‡ ç§ï¼›è¡¨è§†å›¾æœ‰å“ªå‡ ç§åŸºæœ¬æ ·å¼ã€‚</p><p>38ã€å®ç°ç®€å•çš„è¡¨æ ¼æ˜¾ç¤ºéœ€è¦è®¾ç½®UITableViewçš„ä»€ä¹ˆå±æ€§ã€å®ç°ä»€ä¹ˆåè®®ï¼Ÿ</p><p>39ã€Cocoa Touchæä¾›äº†å“ªå‡ ç§Core Animationè¿‡æ¸¡ç±»å‹ï¼Ÿ</p><p>40ã€UIViewä¸CLayeræœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p><p>41ã€Quatrz 2Dçš„ç»˜å›¾åŠŸèƒ½çš„ä¸‰ä¸ªæ ¸å¿ƒæ¦‚å¿µæ˜¯ä»€ä¹ˆå¹¶ç®€è¿°å…¶ä½œç”¨</p><p>42ã€iPhone OSä¸»è¦æä¾›äº†å‡ ç§æ’­æ”¾éŸ³é¢‘çš„æ–¹æ³•ï¼Ÿ</p><p>43ã€ä½¿ç”¨AVAudioPlayerç±»è°ƒç”¨å“ªä¸ªæ¡†æ¶ã€ä½¿ç”¨æ­¥éª¤ï¼Ÿ</p><p>44ã€æœ‰å“ªå‡ ç§æ‰‹åŠ¿é€šçŸ¥æ–¹æ³•ã€å†™æ¸…æ¥šæ–¹æ³•åï¼Ÿ</p><p>45ã€ViewControllerçš„didReceiveMemoryWarningæ€ä¹ˆè¢«è°ƒç”¨</p><p>46ã€ä»€ä¹ˆæ—¶å€™ç”¨delegate,ä»€ä¹ˆæ—¶å€™ç”¨Notification?</p><p>47ã€ç”¨é¢„å¤„ç†æŒ‡ä»¤#defineå£°æ˜ä¸€ä¸ªå¸¸æ•°ï¼Œç”¨ä»¥è¡¨æ˜1å¹´ä¸­æœ‰å¤šå°‘ç§’ï¼ˆå¿½ç•¥é—°å¹´é—®é¢˜ï¼‰</p><p>48ã€å†™ä¸€ä¸ªâ€æ ‡å‡†â€å®MIN ï¼Œè¿™ä¸ªå®è¾“å…¥ä¸¤ä¸ªå‚æ•°å¹¶è¿”å›è¾ƒå°çš„ä¸€ä¸ªã€‚</p><p>49ã€å…³é”®å­—constæœ‰ä»€ä¹ˆå«æ„ï¼Ÿä¿®é¥°ç±»å‘¢?staticçš„ä½œç”¨,ç”¨äºç±»å‘¢?è¿˜æœ‰extern cçš„ä½œç”¨</p><p>50ã€å…³é”®å­—volatileæœ‰ä»€ä¹ˆå«æ„?å¹¶ç»™å‡ºä¸‰ä¸ªä¸åŒçš„ä¾‹å­</p><p>51ã€ä¸€ä¸ªå‚æ•°æ—¢å¯ä»¥æ˜¯constè¿˜å¯ä»¥æ˜¯volatileå—ï¼Ÿ ä¸€ä¸ªæŒ‡é’ˆå¯ä»¥æ˜¯volatile å—ï¼Ÿè§£é‡Šä¸ºä»€ä¹ˆã€‚</p><p>52ã€static å…³é”®å­—çš„ä½œç”¨</p><p>53ã€åˆ—ä¸¾å‡ ç§è¿›ç¨‹çš„åŒæ­¥æœºåˆ¶ï¼Œå¹¶æ¯”è¾ƒå…¶ä¼˜ç¼ºç‚¹ã€‚</p><p>54ã€è¿›ç¨‹ä¹‹é—´é€šä¿¡çš„é€”å¾„</p><p>55ã€è¿›ç¨‹æ­»é”çš„åŸå› </p><p>56ã€æ­»é”çš„4ä¸ªå¿…è¦æ¡ä»¶</p><p>57ã€æ­»é”çš„å¤„ç†</p><p>58ã€cocoa touchæ¡†æ¶</p><p>59ã€è‡ªåŠ¨é‡Šæ”¾æ± æ˜¯ä»€ä¹ˆ,å¦‚ä½•å·¥ä½œ</p><p>60ã€sprintf,strcpy,memcpyä½¿ç”¨ä¸Šæœ‰ä»€ä¹ˆè¦æ³¨æ„çš„åœ°æ–¹</p><p>61ã€ä½ äº†è§£svn,cvsç­‰ç‰ˆæœ¬æ§åˆ¶å·¥å…·ä¹ˆï¼Ÿ</p><p>62ã€ä»€ä¹ˆæ˜¯push</p><p>63ã€é™æ€é“¾æ¥åº“</p><p>64ã€OCä¸‰å¤§ç‰¹æ€§</p><p>ï¼ˆ1ï¼‰å°è£…_ç‚¹è¯­æ³•</p><p>ï¼ˆ2ï¼‰ç»§æ‰¿</p><p>ï¼ˆ3ï¼‰å¤šæ€</p><p>65ã€OCä¸­å¦‚ä½•å®ç°å¤šæ€</p><p>66ã€Objective-Cçš„ä¼˜ç¼ºç‚¹</p><p>67ã€å¯¹äºOC,ä½ è®¤ä¸ºæœ€å¤§çš„ä¼˜ç‚¹å’Œæœ€å¤§çš„ä¸è¶³æ˜¯ä»€ä¹ˆï¼Ÿå¯¹äºä¸è¶³ä¹‹å¤„ï¼Œç°åœ¨æœ‰æ²¡æœ‰å¯ç”¨çš„æ–¹æ³•ç»•è¿‡è¿™äº›ä¸è¶³æ¥å®ç°éœ€æ±‚ã€‚å¦‚æœå¯ä»¥è¯ï¼Œæœ‰æ²¡æœ‰è€ƒè™‘æˆ–è€…å®ç°è¿‡é‡æ–°å®ç°OCçš„åŠŸèƒ½ï¼Œå¦‚æœæœ‰ï¼Œå…·ä½“æ€ä¹ˆåšï¼Ÿ</p><p>68ã€ocä¸­å¯ä¿®æ”¹å’Œä¸å¯ä»¥ä¿®æ”¹ç±»å‹</p><p>69ã€æˆ‘ä»¬è¯´çš„ocæ˜¯åŠ¨æ€è¿è¡Œæ—¶è¯­è¨€æ˜¯ä»€ä¹ˆæ„æ€?</p><p>70ã€é€šçŸ¥å’Œåè®®çš„ä¸åŒä¹‹å¤„?</p><p>71ã€ä»€ä¹ˆæ˜¯æ¨é€æ¶ˆæ¯?</p><p>72ã€å…³äºå¤šæ€æ€§</p><p>73ã€ä»€ä¹ˆæ˜¯è°“è¯?</p><p>74ã€åšè¿‡çš„é¡¹ç›®æ˜¯å¦æ¶‰åŠç½‘ç»œè®¿é—®åŠŸèƒ½ï¼Œä½¿ç”¨ä»€ä¹ˆå¯¹è±¡å®Œæˆç½‘ç»œåŠŸèƒ½?</p><p>75ã€ç®€å•ä»‹ç»ä¸‹NSURLConnectionç±»åŠ+sendSynchronousRequest:returningResponse:error:ä¸â€“ initWithRequest:delegate:ä¸¤ä¸ªæ–¹æ³•çš„åŒºåˆ«?</p><p>76ã€è°ˆè°ˆObject-Cçš„å†…å­˜ç®¡ç†æ–¹å¼åŠè¿‡ç¨‹ï¼Ÿ</p><p>77ã€Object-Cæœ‰ç§æœ‰æ–¹æ³•å—ï¼Ÿç§æœ‰å˜é‡å‘¢ï¼Ÿ</p><p>78ã€è¯´è¯´å“åº”é“¾</p><p>79ã€æ—¶é—´ä¼ é€’ &amp; å“åº”è€…é“¾</p><p>80ã€frameå’Œboundsæœ‰ä»€ä¹ˆä¸åŒ?</p><p>81ã€æ–¹æ³•å’Œé€‰æ‹©å™¨æœ‰ä½•ä¸åŒ?</p><p>82ã€OCçš„åƒåœ¾å›æ”¶æœºåˆ¶?</p><p>83ã€ä»€ä¹ˆæ˜¯å»¶è¿ŸåŠ è½½?</p><p>84ã€æ˜¯å¦åœ¨ä¸€ä¸ªè§†å›¾æ§åˆ¶å™¨ä¸­åµŒå…¥ä¸¤ä¸ªtableviewæ§åˆ¶å™¨?</p><p>85ã€ä¸€ä¸ªtableViewæ˜¯å¦å¯ä»¥å…³è”ä¸¤ä¸ªä¸åŒçš„æ•°æ®æº?ä½ ä¼šæ€ä¹ˆå¤„ç†?</p><p>86ã€ä»€ä¹ˆæ—¶å€™ä½¿ç”¨NSMutableArrayï¼Œä»€ä¹ˆæ—¶å€™ä½¿ç”¨NSArray?</p><p>87ã€ç»™å‡ºå§”æ‰˜æ–¹æ³•çš„å®ä¾‹ï¼Œå¹¶ä¸”è¯´å‡ºUITableVIewçš„Data Sourceæ–¹æ³•</p><p>88ã€åœ¨åº”ç”¨ä¸­å¯ä»¥åˆ›å»ºå¤šå°‘autoreleaseå¯¹è±¡ï¼Œæ˜¯å¦æœ‰é™åˆ¶?</p><p>89ã€å¦‚æœæˆ‘ä»¬ä¸åˆ›å»ºå†…å­˜æ± ï¼Œæ˜¯å¦æœ‰å†…å­˜æ± æä¾›ç»™æˆ‘ä»¬?</p><p>90ã€ä»€ä¹ˆæ—¶å€™éœ€è¦åœ¨ç¨‹åºä¸­åˆ›å»ºå†…å­˜æ± ?</p><p>91ã€ç±»NSObjectçš„é‚£äº›æ–¹æ³•ç»å¸¸è¢«ä½¿ç”¨?</p><p>92ã€ä»€ä¹ˆæ˜¯ç®€ä¾¿æ„é€ æ–¹æ³•?</p><p>93ã€å¦‚ä½•ä½¿ç”¨Xcodeè®¾è®¡é€šç”¨åº”ç”¨?</p><p>94ã€ UIViewçš„åŠ¨ç”»æ•ˆæœæœ‰é‚£äº›?</p><p>95ã€Object-Cæœ‰å¤šç»§æ‰¿å—ï¼Ÿæ²¡æœ‰çš„è¯ç”¨ä»€ä¹ˆä»£æ›¿ï¼Ÿcocoa ä¸­æ‰€æœ‰çš„ç±»éƒ½æ˜¯NSObject çš„å­ç±»</p><p>96ã€å†…å­˜ç®¡ç† Autoreleaseã€retainã€copyã€assignçš„setæ–¹æ³•å’Œå«ä¹‰ï¼Ÿ</p><p>97ã€Cå’Œobj-c å¦‚ä½•æ··ç”¨</p><p>98ã€ç±»åˆ«çš„ä½œç”¨?ç»§æ‰¿å’Œç±»åˆ«åœ¨å®ç°ä¸­æœ‰ä½•åŒºåˆ«?</p><p>99ã€ç±»åˆ«å’Œç±»æ‰©å±•çš„åŒºåˆ«ã€‚</p><p>100ã€ocä¸­çš„åè®®å’Œjavaä¸­çš„æ¥å£æ¦‚å¿µæœ‰ä½•ä¸åŒ?</p><p>101ã€æ·±æ‹·è´ä¸å‰æ‹·è´åŒºåˆ«</p><p>ï¼ˆ1ï¼‰ä»€ä¹ˆæ˜¯æ·±æ‹·è´æµ…æ‹·è´</p><p>ï¼ˆ2ï¼‰å­—ç¬¦ä¸²ä»€ä¹ˆæ—¶å€™ä½¿ç”¨copy,strong</p><p>ï¼ˆ3ï¼‰å­—ç¬¦ä¸²æ‰€åœ¨å†…å­˜åŒºåŸŸ</p><p>ï¼ˆ4ï¼‰mutablecopyå’Œcopy @property(copy) NSMutableArray *arr;è¿™æ ·å†™æœ‰ä»€ä¹ˆé—®é¢˜</p><p>ï¼ˆ5ï¼‰å¦‚ä½•è®©è‡ªå®šä¹‰ç±»å¯ä»¥ä½¿ç”¨copyä¿®é¥°ç¬¦</p><p>102ã€å¯¹äºè¯­å¥NSString*obj = [[NSData alloc] init]; objåœ¨ç¼–è¯‘æ—¶å’Œè¿è¡Œæ—¶åˆ†åˆ«æ—¶ä»€ä¹ˆç±»å‹çš„å¯¹è±¡ï¼Ÿ</p><p>103ã€#import è·Ÿ#include åˆä»€ä¹ˆåŒºåˆ«ï¼Œ@classå‘¢, ï¼ƒimport&lt;&gt; è·Ÿ #importâ€â€åˆä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p><p>104ã€Objective-Cçš„ç±»å¯ä»¥å¤šé‡ç»§æ‰¿ä¹ˆ?å¯ä»¥å®ç°å¤šä¸ªæ¥å£ä¹ˆ?Categoryæ˜¯ä»€ä¹ˆ?é‡å†™ä¸€ä¸ªç±»çš„æ–¹æ³•ç”¨ç»§æ‰¿å¥½è¿˜æ˜¯åˆ†ç±»å¥½?ä¸ºä»€ä¹ˆ?</p><p>105ã€ #import è·Ÿ#include åˆä»€ä¹ˆåŒºåˆ«ï¼Œ@classå‘¢, #import&lt;&gt; è·Ÿ #importâ€â€åˆä»€ä¹ˆåŒºåˆ«?</p><p>106ã€å†™ä¸€ä¸ªsetteræ–¹æ³•ç”¨äºå®Œæˆ@property (nonatomic,retain)NSString name,å†™ä¸€ä¸ªsetteræ–¹æ³•ç”¨äºå®Œæˆ@property(nonatomicï¼Œcopy)NSString name</p><p>107ã€å¸¸è§çš„Objective-Cçš„æ•°æ®ç±»å‹æœ‰é‚£äº›ï¼Œ å’ŒCçš„åŸºæœ¬æ•°æ®ç±»å‹æœ‰ä»€ä¹ˆåŒºåˆ«?å¦‚ï¼šNSIntegerå’Œint</p><p>108ã€id å£°æ˜çš„å¯¹è±¡æœ‰ä»€ä¹ˆç‰¹æ€§?</p><p>109ã€Objective-Cå¦‚ä½•å¯¹å†…å­˜ç®¡ç†çš„,è¯´è¯´ä½ çš„çœ‹æ³•å’Œè§£å†³æ–¹æ³•?</p><p>110ã€åŸå­(atomic)è·ŸéåŸå­(non-atomic)å±æ€§æœ‰ä»€ä¹ˆåŒºåˆ«?</p><p>111ã€çœ‹ä¸‹é¢çš„ç¨‹åº,ç¬¬ä¸€ä¸ªNSLogä¼šè¾“å‡ºä»€ä¹ˆ?è¿™æ—¶strçš„retainCountæ˜¯å¤šå°‘?ç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªå‘¢? ä¸ºä»€ä¹ˆ?</p><p>112ã€å†…å­˜ç®¡ç†çš„å‡ æ¡åŸåˆ™æ—¶ä»€ä¹ˆ?æŒ‰ç…§é»˜è®¤æ³•åˆ™.é‚£äº›å…³é”®å­—ç”Ÿæˆçš„å¯¹è±¡éœ€è¦æ‰‹åŠ¨é‡Šæ”¾?åœ¨å’Œpropertyç»“åˆçš„æ—¶å€™æ€æ ·æœ‰æ•ˆçš„é¿å…å†…å­˜æ³„éœ²?</p><p>113ã€å¦‚ä½•å¯¹iOSè®¾å¤‡è¿›è¡Œæ€§èƒ½æµ‹è¯•?</p><p>114ã€è®¾è®¡æ¨¡å¼</p><p>ï¼ˆ1ï¼‰mvcæ¨¡å¼</p><p>ï¼ˆ2ï¼‰å•ä¾‹æ¨¡å¼</p><p>ï¼ˆ3ï¼‰mvvmæ¨¡å¼</p><p>ï¼ˆ4ï¼‰è§‚å¯Ÿè€…æ¨¡å¼</p><p>ï¼ˆ5ï¼‰å·¥å‚æ¨¡å¼</p><p>ï¼ˆ6ï¼‰ä»£ç†æ¨¡å¼</p><p>ï¼ˆ7ï¼‰ç­–ç•¥æ¨¡å¼</p><p>ï¼ˆ8ï¼‰é€‚é…å™¨æ¨¡å¼</p><p>ï¼ˆ9ï¼‰æ¨¡ç‰ˆæ¨¡å¼</p><p>ï¼ˆ10ï¼‰å¤–è§‚æ¨¡å¼</p><p>ï¼ˆ11ï¼‰åˆ›å»ºæ¨¡å¼</p><p>ï¼ˆ12ï¼‰MVPæ¨¡å¼</p><p>115ã€MVVMæ¨¡å¼åŸç†åˆ†æ</p><p>116ã€è¯´è¯´å¸¸ç”¨çš„å‡ ç§ä¼ å€¼æ–¹å¼</p><p>117ã€ä»€ä¹ˆæ—¶å€™ç”¨delegateï¼Œä»€ä¹ˆæ—¶å€™ç”¨Notification</p><p>118ã€å¯¹äºå•ä¾‹çš„ç†è§£</p><p>119ã€ä»è®¾è®¡æ¨¡å¼è§’åº¦åˆ†æä»£ç†ï¼Œé€šçŸ¥å’ŒKVOåŒºåˆ«ï¼Ÿios SDK æä¾› çš„frameworkä½¿ç”¨äº†å“ªäº›è®¾è®¡æ¨¡å¼ï¼Œä¸ºä»€ä¹ˆä½¿ç”¨ï¼Ÿæœ‰å“ªäº›å¥½å¤„å’Œåå¤„?</p><p>120ã€KVOï¼ŒNSNotificationï¼ŒdelegateåŠblockåŒºåˆ«</p><p>121ã€è¿è¡Œæ—¶ï¼ˆrunTimeï¼‰</p><p>122ã€runtime/æ¶ˆæ¯è½¬å‘æœºåˆ¶</p><p>ï¼ˆ1ï¼‰runtime</p><p>1.1ã€ä»€ä¹ˆæ˜¯runtime</p><p>1.2ã€runtimeå¹²ä»€ä¹ˆç”¨ï¼Œä½¿ç”¨åœºæ™¯</p><p>ï¼ˆ2ï¼‰æ¶ˆæ¯æœºåˆ¶</p><p>2.1ã€æ¶ˆæ¯è½¬å‘çš„åŸç†</p><p>2.2ã€SEL isa super cmd æ˜¯ä»€ä¹ˆ</p><p>ï¼ˆ3ï¼‰åŠ¨æ€ç»‘å®š</p><p>123ã€ä½¿ç”¨buglyè¿›è¡Œå´©æºƒåˆ†æ</p><p>124ã€jenkens æŒç»­æ‰“åŒ…</p><p>125ã€KVO &amp; KVC</p><p>ï¼ˆ1ï¼‰åº•å±‚å®ç°</p><p>ï¼ˆ2ï¼‰KVOæ¦‚è¿°</p><p>ï¼ˆ3ï¼‰KVCæ¦‚è¿°</p><p>126ã€ä»€ä¹ˆæ˜¯KVOå’ŒKVC?</p><p>KVOå’ŒKVC</p><p>ï¼ˆ1ï¼‰å¦‚ä½•è°ƒç”¨ç§æœ‰å˜é‡ï¼Œå¦‚ä½•ä¿®æ”¹ç³»ç»Ÿçš„åªè¯»å±æ€§ï¼ŒKVCçš„æŸ¥æ‰¾é¡ºåº</p><p>ï¼ˆ2ï¼‰ä»€ä¹ˆæ˜¯é”®-å€¼,é”®è·¯å¾„æ˜¯ä»€ä¹ˆ</p><p>ï¼ˆ3ï¼‰kvoçš„å®ç°æœºåˆ¶</p><p>ï¼ˆ4ï¼‰KVOè®¡ç®—å±æ€§ï¼Œè®¾ç½®ä¾èµ–é”®</p><p>ï¼ˆ5ï¼‰KVOé›†åˆå±æ€§</p><p>ï¼ˆ6ï¼‰kvoä½¿ç”¨åœºæ™¯</p><p>127ã€SDWebImage(SDWebImageçš„å®ç°æœºåˆ¶ï¼‰</p><p>ï¼ˆ1ï¼‰ä¸»è¦åŠŸèƒ½</p><p>ï¼ˆ2ï¼‰ç¼“å­˜</p><p>ï¼ˆ3ï¼‰å†…å­˜ç¼“å­˜ä¸ç£ç›˜ç¼“å­˜</p><p>128ã€æ¡†æ¶ SDWebimageçš„ç¼“å­˜æœºåˆ¶</p><p>129ã€ç½‘ç»œå®‰å…¨</p><p>å¯†ç çš„å®‰å…¨åŸåˆ™</p><p>130ã€å¤šçº¿ç¨‹</p><p>ï¼ˆ1ï¼‰å¤šçº¿ç¨‹æ¦‚å¿µ</p><p>ï¼ˆ2ï¼‰å¤šçº¿ç¨‹çš„ä½œç”¨</p><p>ï¼ˆ3ï¼‰ä½¿ç”¨åœºæ™¯</p><p>131ã€NSOperationQueueå’ŒGCDçš„åŒºåˆ«æ˜¯ä»€ä¹ˆ</p><p>132ã€GCDä¸NSThreadçš„åŒºåˆ«</p><p>133ã€è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«ä¸è”ç³»æ˜¯ä»€ä¹ˆ?</p><p>134ã€åˆ«å¼‚æ­¥æ‰§è¡Œä¸¤ä¸ªè€—æ—¶æ“ä½œï¼Œç­‰ä¸¤æ¬¡è€—æ—¶æ“ä½œéƒ½æ‰§è¡Œå®Œæ¯•å,å†å›åˆ°ä¸»çº¿ç¨‹æ‰§è¡Œæ“ä½œ. ä½¿ç”¨é˜Ÿåˆ—ç»„(dispatch_group_t)å¿«é€Ÿ,é«˜æ•ˆçš„å®ç°ä¸Šè¿°éœ€æ±‚</p><p>135ã€åœ¨é¡¹ç›®ä»€ä¹ˆæ—¶å€™é€‰æ‹©ä½¿ç”¨GCDï¼Œä»€ä¹ˆæ—¶å€™é€‰æ‹©NSOperation?</p><p>136ã€å¯¹æ¯”iOSä¸­çš„å¤šçº¿ç¨‹æŠ€æœ¯</p><p>137ã€å¤šçº¿ç¨‹ä¼˜ç¼ºç‚¹</p><p>138ã€iOSä¸­çš„å»¶è¿Ÿæ“ä½œ</p><p>139ã€ä¸²è¡Œé˜Ÿåˆ—åŒæ­¥æ‰§è¡Œå’Œå¼‚æ­¥ä¸»é˜Ÿåˆ—</p><p>140ã€èµ„æºæŠ¢å¤ºè§£å†³æ–¹æ¡ˆ</p><p>141ã€dispatch_barrier_asyncçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>142ã€åœ¨å¤šçº¿ç¨‹Core Dataä¸­ï¼ŒNSC,MOC,NSObjectModelå“ªäº›éœ€è¦åœ¨çº¿ç¨‹ä¸­åˆ›å»ºæˆ–è€…ä¼ é€’ï¼Ÿä½ æ˜¯ç”¨ä»€ä¹ˆç­–è¶Šæ¥å®ç°çš„ï¼Ÿ</p><p>143ã€+(void)loadä¸ +(void)initializeåŒºåˆ«load å’Œ initializeæ–¹æ³•çš„åŒºåˆ«</p><p>144ã€httpçš„postä¸åŒºåˆ«ä¸è”ç³»ï¼Œå®è·µä¸­å¦‚ä½•é€‰æ‹©å®ƒä»¬ï¼Ÿ</p><p>145ã€è¯´è¯´å…³äºUDP/TCPçš„åŒºåˆ«ï¼Ÿ</p><p>146ã€httpå’Œscoketé€šä¿¡çš„åŒºåˆ«?socketè¿æ¥ç›¸å…³åº“,TCP,UDPçš„è¿æ¥æ–¹æ³•,HTTPçš„å‡ ç§å¸¸ç”¨æ–¹å¼?</p><p>147ã€HTTPè¯·æ±‚å¸¸ç”¨çš„å‡ ç§æ–¹å¼</p><p>148ã€block</p><p>ï¼ˆ1ï¼‰ä½¿ç”¨blockæ—¶ä»€ä¹ˆæƒ…å†µä¼šå‘ç”Ÿå¼•ç”¨å¾ªç¯ï¼Œå¦‚ä½•è§£å†³ï¼Ÿ</p><p>ï¼ˆ2ï¼‰åœ¨blockå†…å¦‚ä½•ä¿®æ”¹blockå¤–éƒ¨å˜é‡ï¼Ÿ</p><p>ï¼ˆ3ï¼‰Block &amp; MRC-Block</p><p>ï¼ˆ4ï¼‰ä»€ä¹ˆæ˜¯block</p><p>ï¼ˆ5ï¼‰block å®ç°åŸç†</p><p>ï¼ˆ6ï¼‰å…³äºblock</p><p>ï¼ˆ7ï¼‰ä½¿ç”¨blockå’Œä½¿ç”¨delegateå®Œæˆå§”æ‰˜æ¨¡å¼æœ‰ä»€ä¹ˆä¼˜ç‚¹</p><p>ï¼ˆ8ï¼‰å¤šçº¿ç¨‹ä¸block</p><p>ï¼ˆ9ï¼‰è°ˆè°ˆå¯¹Block çš„ç†è§£?å¹¶å†™å‡ºä¸€ä¸ªä½¿ç”¨Blockæ‰§è¡ŒUIVewåŠ¨ç”»?</p><p>ï¼ˆ10ï¼‰å†™å‡ºä¸Šé¢ä»£ç çš„Blockçš„å®šä¹‰ï¼ˆæ¥ä¸Šé¢˜ï¼‰</p><p>149ã€Weakã€strongã€copyã€assign ä½¿ç”¨</p><p>ï¼ˆ1ï¼‰ä»€ä¹ˆæƒ…å†µä½¿ç”¨ weak å…³é”®å­—ï¼Œç›¸æ¯” assign æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ</p><p>ï¼ˆ2ï¼‰æ€ä¹ˆç”¨ copy å…³é”®å­—ï¼Ÿ</p><p>ï¼ˆ3ï¼‰weak &amp; strong</p><p>ï¼ˆ4ï¼‰è¿™ä¸ªå†™æ³•ä¼šå‡ºä»€ä¹ˆé—®é¢˜ï¼š @property (copy) NSMutableArray *array</p><p>ï¼ˆ5ï¼‰ å¦‚ä½•è®©è‡ªå·±çš„ç±»ç”¨ copy ä¿®é¥°ç¬¦ï¼Ÿå¦‚ä½•é‡å†™å¸¦ copy å…³é”®å­—çš„ setterï¼Ÿ</p><p>ï¼ˆ6ï¼‰ @property çš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿivarã€getterã€setter æ˜¯å¦‚ä½•ç”Ÿæˆå¹¶æ·»åŠ åˆ°è¿™ä¸ªç±»ä¸­çš„</p><p>ï¼ˆ7ï¼‰ivarã€getterã€setter æ˜¯å¦‚ä½•ç”Ÿæˆå¹¶æ·»åŠ åˆ°è¿™ä¸ªç±»ä¸­çš„?</p><p>ï¼ˆ8ï¼‰ç”¨@propertyå£°æ˜çš„NSStringï¼ˆæˆ–NSArrayï¼ŒNSDictionaryï¼‰ç»å¸¸ä½¿ç”¨copyå…³é”®å­—ï¼Œä¸ºä»€ä¹ˆï¼Ÿå¦‚æœæ”¹ç”¨strongå…³é”®å­—ï¼Œå¯èƒ½é€ æˆä»€ä¹ˆé—®é¢˜ï¼Ÿ</p><p>ï¼ˆ9ï¼‰@protocol å’Œ category ä¸­å¦‚ä½•ä½¿ç”¨ @property</p><p>ï¼ˆ10ï¼‰runtimeå¦‚ä½•é€šè¿‡selectoræ‰¾åˆ°å¯¹åº”çš„IMPåœ°å€ï¼Ÿ</p><p>ï¼ˆ11ï¼‰retainå’ŒcopyåŒºåˆ«</p><p>ï¼ˆ12ï¼‰copyå’Œstrongçš„ä½¿ç”¨ï¼Ÿ</p><p>ï¼ˆ13ï¼‰NSStringå’ŒNSMutableStringï¼Œå‰è€…çº¿ç¨‹å®‰å…¨ï¼Œåè€…çº¿ç¨‹ä¸å®‰å…¨ã€‚</p><p>ï¼ˆ14ï¼‰readwriteï¼Œreadonlyï¼Œassignï¼Œretainï¼Œcopyï¼Œweak ,strong,nonatomic å±æ€§çš„ä½œç”¨</p><p>150ã€OCä¸JSçš„äº¤äº’ï¼ˆiOSä¸H5æ··ç¼–ï¼‰</p><p>TableViewæ€§èƒ½ä¼˜åŒ–</p><p>UITableViewæ ¸å¿ƒæ€æƒ³</p><p>UITableViewçš„ä¼˜åŒ–ä¸»è¦ä»ä¸‰ä¸ªæ–¹é¢å…¥æ‰‹ï¼š</p><p>151ã€TableViewä¸ºä»€ä¹ˆä¼šå¡ï¼Ÿ</p><p>152ã€UITableView</p><p>ï¼ˆ1ï¼‰UITableViewæœ€æ ¸å¿ƒçš„æ€æƒ³</p><p>ï¼ˆ2ï¼‰å®šä¹‰é«˜åº¦</p><p>ï¼ˆ3ï¼‰è‡ªå®šä¹‰é«˜åº¦åŸç†</p><p>ï¼ˆ4ï¼‰è€ç”Ÿå¸¸è°ˆä¹‹UITableViewçš„æ€§èƒ½ä¼˜åŒ–</p><p>ï¼ˆ5ï¼‰cellé«˜åº¦çš„è®¡ç®—</p><p>ï¼ˆ5.1ï¼‰å®šé«˜çš„cellå’ŒåŠ¨æ€é«˜åº¦çš„cell</p><p>ï¼ˆ6ï¼‰TableViewæ¸²æŸ“</p><p>ï¼ˆ7ï¼‰å‡å°‘è§†å›¾çš„æ•°ç›®</p><p>ï¼ˆ8ï¼‰å‡å°‘å¤šä½™çš„ç»˜åˆ¶æ“ä½œ</p><p>ï¼ˆ9ï¼‰ä¸è¦ç»™cellåŠ¨æ€æ·»åŠ subView</p><p>ï¼ˆ10ï¼‰å¼‚æ­¥åŒ–UIï¼Œä¸è¦é˜»å¡ä¸»çº¿ç¨‹</p><p>ï¼ˆ11ï¼‰æ»‘åŠ¨æ—¶æŒ‰éœ€åŠ è½½å¯¹åº”çš„å†…å®¹</p><p>ï¼ˆ12ï¼‰ç¦»å±æ¸²æŸ“çš„é—®é¢˜</p><p>ï¼ˆ13ï¼‰ç¦»å±æ¸²æŸ“ä¼˜åŒ–æ–¹æ¡ˆ</p><p>153ã€ç¯ä¿¡SDKä½¿ç”¨</p><p>154ã€è“ç‰™</p><p>155ã€åœ¨iPhoneåº”ç”¨ä¸­å¦‚ä½•ä¿å­˜æ•°æ®?</p><p>156ã€ä»€ä¹ˆæ˜¯coredata?</p><p>157ã€ ä»€ä¹ˆæ˜¯NSManagedObjectæ¨¡å‹?</p><p>158ã€ä»€ä¹ˆæ˜¯NSManagedobjectContext?</p><p>159ã€ iOSå¹³å°æ€ä¹ˆåšæ•°æ®çš„æŒä¹…åŒ–?coredata å’Œsqliteæœ‰æ— å¿…ç„¶è”ç³»ï¼Ÿcoredataæ˜¯ä¸€ä¸ªå…³ç³»å‹æ•°æ®åº“å—ï¼Ÿ</p><p>160ã€CoreData &amp; SQLite3</p><p>161ã€æ•°æ®å­˜å‚¨</p><p>ï¼ˆ1ï¼‰æ•°æ®å­˜å‚¨æŠ€æœ¯</p><p>ï¼ˆ1.1ï¼‰æ•°æ®å­˜å‚¨çš„å‡ ç§æ–¹å¼</p><p>ï¼ˆ1.2ï¼‰å„è‡ªç‰¹ç‚¹ï¼ˆé¢è¯•è€ƒç‚¹ï¼‰</p><p>ï¼ˆ1.3ï¼‰åå¥½è®¾ç½®ï¼ˆé¢è¯•è€ƒç‚¹ï¼‰</p><p>ï¼ˆ1.4ï¼‰å½’æ¡£ï¼ˆé¢è¯•è€ƒç‚¹ï¼‰</p><p>ï¼ˆ2ï¼‰æ•°æ®åº“æŠ€æœ¯ï¼ˆSQLite&amp;CoreDataï¼‰</p><p>162ã€Objective-Cå †å’Œæ ˆçš„åŒºåˆ«ï¼Ÿ</p><p>163ã€å†…å­˜æ³„éœ² &amp; å†…å­˜æº¢å‡º</p><p>164ã€å † &amp; æ ˆ</p><p>ï¼ˆ1ï¼‰å †æ ˆç©ºé—´åˆ†é…åŒºåˆ«</p><p>ï¼ˆ2ï¼‰å †æ ˆç¼“å­˜æ–¹å¼åŒºåˆ«</p><p>ï¼ˆ3ï¼‰å †æ ˆæ•°æ®ç»“æ„åŒºåˆ«</p><p>165ã€å†…å­˜ç®¡ç†</p><p>ï¼ˆ1ï¼‰å†…å­˜åŒºåŸŸ</p><p>ï¼ˆ1.1ï¼‰å †å’Œæ ˆçš„åŒºåˆ«</p><p>ï¼ˆ1.2ï¼‰iOSå†…å­˜åŒºåŸŸ</p><p>ï¼ˆ2ï¼‰å­—ç¬¦ä¸²çš„å†…å­˜ç®¡ç†</p><p>ï¼ˆ3ï¼‰ä½ æ˜¯å¦‚ä½•ä¼˜åŒ–å†…å­˜ç®¡ç†</p><p>ï¼ˆ4ï¼‰å¾ªç¯å¼•ç”¨</p><p>ï¼ˆ5ï¼‰autoreleaseçš„ä½¿ç”¨</p><p>ï¼ˆ5.1ï¼‰å·¥å‚æ–¹æ³•ä¸ºä»€ä¹ˆä¸é‡Šæ”¾å¯¹è±¡</p><p>ï¼ˆ5.2ï¼‰ARCä¸‹autoreleaseçš„ä½¿ç”¨åœºæ™¯</p><p>ï¼ˆ5.3ï¼‰è‡ªåŠ¨é‡Šæ”¾æ± å¦‚ä½•å·¥ä½œ</p><p>ï¼ˆ5.4ï¼‰é¿å…å†…å­˜å³°å€¼</p><p>ï¼ˆ5.5ï¼‰ARCå’ŒMRCçš„æ··ç”¨</p><p>ï¼ˆ5.6ï¼‰NSTimerçš„å†…å­˜ç®¡ç†</p><p>ï¼ˆ5.7ï¼‰ARCçš„å®ç°åŸç†</p><p>166ã€Runloop</p><p>167ã€fmmpegæ¡†æ¶</p><p>168ã€fmdbæ¡†æ¶</p><p>169ã€320æ¡†æ¶</p><p>170ã€UIKitå’ŒCoreAnimationå’ŒCoreGraphicsçš„å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿåœ¨å¼€å‘ä¸­æ˜¯å¦ä½¿ç”¨è¿‡CoreAnimationå’ŒCoreGraphics?</p><p>171ã€trasform</p><p>172ã€ç‚¹è®²åŠ¨ç”»å’Œlayer ,viewçš„åŒºåˆ«</p><p>173ã€å›¾å±‚ä¸è§†å›¾</p><p>174ã€å¹³è¡Œçš„å±‚çº§å…³ç³»</p><p>175ã€å›¾å±‚çš„èƒ½åŠ›</p><p>176ã€ä½¿ç”¨å›¾å±‚</p><p>177ã€æ ¸å¿ƒç»˜å›¾</p><p>ï¼ˆ1ï¼‰Viewå’Œlayerçš„åŒºåˆ«</p><p>ï¼ˆ2ï¼‰newå’Œalloc initçš„åŒºåˆ«</p><p>178ã€åŠ¨ç”»</p><p>179ã€UICollectionView</p><p>ï¼ˆ1ï¼‰ä½•å®ç°ç€‘å¸ƒæµ,æµæ°´å¸ƒå±€</p><p>ï¼ˆ2ï¼‰å’ŒUITableViewçš„ä½¿ç”¨åŒºåˆ«</p><p>180ã€UIImage</p><p>181ã€webview</p><p>182ã€æè¿°ä¹å®«æ ¼ç®—æ³•</p><p>183ã€å®ç°å›¾ç‰‡è½®æ’­å›¾</p><p>184ã€iOSç½‘ç»œæ¡†æ¶</p><p>185ã€ç½‘ç»œ</p><p>ï¼ˆ1ï¼‰ç½‘ç»œåŸºç¡€</p><p>ï¼ˆ2ï¼‰ç½‘ç»œä¼ è¾“</p><p>ï¼ˆ3ï¼‰AFN</p><p>186ã€AFNetworking &amp; ASIHttpRequest &amp; MKNetWorking</p><p>ï¼ˆ1ï¼‰åº•å±‚å®ç°</p><p>ï¼ˆ2ï¼‰å¯¹æœåŠ¡å™¨è¿”å›çš„æ•°æ®å¤„ç†</p><p>ï¼ˆ3ï¼‰ç›‘å¬è¯·æ±‚è¿‡ç¨‹</p><p>ï¼ˆ4ï¼‰åœ¨æ–‡ä»¶ä¸‹è½½å’Œæ–‡ä»¶ä¸Šä¼ çš„ä½¿ç”¨éš¾æ˜“åº¦</p><p>ï¼ˆ5ï¼‰ç½‘ç»œç›‘æ§</p><p>ï¼ˆ6ï¼‰ASIæä¾›çš„å…¶ä»–å®ç”¨åŠŸèƒ½</p><p>ï¼ˆ7ï¼‰MKNetworkKit</p><p>187ã€æ€§èƒ½ä¼˜åŒ–</p><p>188ã€ç®—æ³•</p>]]></content>
      
      
      <categories>
          
          <category> é¢è¯•é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¢è¯•æŠ€å·§ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iOSé¢è¯•é¢˜-003</title>
      <link href="/2020/01/16/iOS%E9%9D%A2%E8%AF%95%E9%A2%98-003/"/>
      <url>/2020/01/16/iOS%E9%9D%A2%E8%AF%95%E9%A2%98-003/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€UIè§†å›¾"><a href="#ä¸€ã€UIè§†å›¾" class="headerlink" title="ä¸€ã€UIè§†å›¾"></a>ä¸€ã€UIè§†å›¾</h2><h3 id="æ‹¬äº‹ä»¶ä¼ é€’"><a href="#æ‹¬äº‹ä»¶ä¼ é€’" class="headerlink" title="æ‹¬äº‹ä»¶ä¼ é€’"></a>æ‹¬äº‹ä»¶ä¼ é€’</h3><h3 id="è§†å›¾å“åº”"><a href="#è§†å›¾å“åº”" class="headerlink" title="è§†å›¾å“åº”"></a>è§†å›¾å“åº”</h3><h3 id="UIå¸ƒå±€"><a href="#UIå¸ƒå±€" class="headerlink" title="UIå¸ƒå±€"></a>UIå¸ƒå±€</h3><h3 id="UIç»˜åˆ¶"><a href="#UIç»˜åˆ¶" class="headerlink" title="UIç»˜åˆ¶"></a>UIç»˜åˆ¶</h3><h3 id="UITableviewé‡ç”¨æœºåˆ¶çš„ç†è§£ç­‰åŸºæœ¬æŠ€æœ¯ç‚¹"><a href="#UITableviewé‡ç”¨æœºåˆ¶çš„ç†è§£ç­‰åŸºæœ¬æŠ€æœ¯ç‚¹" class="headerlink" title="UITableviewé‡ç”¨æœºåˆ¶çš„ç†è§£ç­‰åŸºæœ¬æŠ€æœ¯ç‚¹"></a>UITableviewé‡ç”¨æœºåˆ¶çš„ç†è§£ç­‰åŸºæœ¬æŠ€æœ¯ç‚¹</h3><h3 id="ç¦»å±æ¸²æŸ“"><a href="#ç¦»å±æ¸²æŸ“" class="headerlink" title="ç¦»å±æ¸²æŸ“"></a>ç¦»å±æ¸²æŸ“</h3><h3 id="æµå¼é¡µé¢çš„æ€§èƒ½ä¼˜åŒ–"><a href="#æµå¼é¡µé¢çš„æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="æµå¼é¡µé¢çš„æ€§èƒ½ä¼˜åŒ–"></a>æµå¼é¡µé¢çš„æ€§èƒ½ä¼˜åŒ–</h3><h3 id="å¼‚æ­¥ç»˜åˆ¶"><a href="#å¼‚æ­¥ç»˜åˆ¶" class="headerlink" title="å¼‚æ­¥ç»˜åˆ¶"></a>å¼‚æ­¥ç»˜åˆ¶</h3><h3 id="UIæ¸²æŸ“æœºåˆ¶"><a href="#UIæ¸²æŸ“æœºåˆ¶" class="headerlink" title="UIæ¸²æŸ“æœºåˆ¶"></a>UIæ¸²æŸ“æœºåˆ¶</h3><h2 id="Objective-Cè¯­è¨€"><a href="#Objective-Cè¯­è¨€" class="headerlink" title="Objective-Cè¯­è¨€"></a>Objective-Cè¯­è¨€</h2><h3 id="KVO"><a href="#KVO" class="headerlink" title="KVO"></a>KVO</h3><h3 id="KVC"><a href="#KVC" class="headerlink" title="KVC"></a>KVC</h3><h3 id="åˆ†ç±»"><a href="#åˆ†ç±»" class="headerlink" title="åˆ†ç±»"></a>åˆ†ç±»</h3><h3 id="æ‰©å±•"><a href="#æ‰©å±•" class="headerlink" title="æ‰©å±•"></a>æ‰©å±•</h3><h3 id="å…³è”å¯¹è±¡"><a href="#å…³è”å¯¹è±¡" class="headerlink" title="å…³è”å¯¹è±¡"></a>å…³è”å¯¹è±¡</h3><h3 id="NSNotification"><a href="#NSNotification" class="headerlink" title="NSNotification"></a>NSNotification</h3><h3 id="å±æ€§"><a href="#å±æ€§" class="headerlink" title="å±æ€§"></a>å±æ€§</h3><h3 id="å…³é”®å­—"><a href="#å…³é”®å­—" class="headerlink" title="å…³é”®å­—"></a>å…³é”®å­—</h3><h2 id="ä¸‰ã€Runtime"><a href="#ä¸‰ã€Runtime" class="headerlink" title="ä¸‰ã€Runtime"></a>ä¸‰ã€Runtime</h2><h3 id="å¯¹è±¡"><a href="#å¯¹è±¡" class="headerlink" title="å¯¹è±¡"></a>å¯¹è±¡</h3><h3 id="ç±»å¯¹è±¡"><a href="#ç±»å¯¹è±¡" class="headerlink" title="ç±»å¯¹è±¡"></a>ç±»å¯¹è±¡</h3><h3 id="åŸç±»å¯¹è±¡"><a href="#åŸç±»å¯¹è±¡" class="headerlink" title="åŸç±»å¯¹è±¡"></a>åŸç±»å¯¹è±¡</h3><h3 id="æ¶ˆæ¯ä¼ é€’æœºåˆ¶"><a href="#æ¶ˆæ¯ä¼ é€’æœºåˆ¶" class="headerlink" title="æ¶ˆæ¯ä¼ é€’æœºåˆ¶"></a>æ¶ˆæ¯ä¼ é€’æœºåˆ¶</h3><h3 id="æ¶ˆæ¯è½¬å‘æµç¨‹"><a href="#æ¶ˆæ¯è½¬å‘æµç¨‹" class="headerlink" title="æ¶ˆæ¯è½¬å‘æµç¨‹"></a>æ¶ˆæ¯è½¬å‘æµç¨‹</h3><h3 id="Method-Swizzling"><a href="#Method-Swizzling" class="headerlink" title="Method-Swizzling"></a>Method-Swizzling</h3><h3 id="ISA-swizzling"><a href="#ISA-swizzling" class="headerlink" title="ISA-swizzling"></a>ISA-swizzling</h3><h3 id="åŠ¨æ€æ–¹æ³•è§£æ"><a href="#åŠ¨æ€æ–¹æ³•è§£æ" class="headerlink" title="åŠ¨æ€æ–¹æ³•è§£æ"></a>åŠ¨æ€æ–¹æ³•è§£æ</h3><h3 id="åŠ¨æ€æ·»åŠ æ–¹æ³•"><a href="#åŠ¨æ€æ·»åŠ æ–¹æ³•" class="headerlink" title="åŠ¨æ€æ·»åŠ æ–¹æ³•"></a>åŠ¨æ€æ·»åŠ æ–¹æ³•</h3><h2 id="å››ã€å†…å­˜ç®¡ç†"><a href="#å››ã€å†…å­˜ç®¡ç†" class="headerlink" title="å››ã€å†…å­˜ç®¡ç†"></a>å››ã€å†…å­˜ç®¡ç†</h2><h3 id="weakè‡ªåŠ¨ç½®nil"><a href="#weakè‡ªåŠ¨ç½®nil" class="headerlink" title="weakè‡ªåŠ¨ç½®nil"></a>weakè‡ªåŠ¨ç½®nil</h3><h3 id="ARC"><a href="#ARC" class="headerlink" title="ARC"></a>ARC</h3><h3 id="MRC"><a href="#MRC" class="headerlink" title="MRC"></a>MRC</h3><h3 id="è‡ªåŠ¨é‡Šæ”¾æ± çš„å®ç°åŸç†"><a href="#è‡ªåŠ¨é‡Šæ”¾æ± çš„å®ç°åŸç†" class="headerlink" title="è‡ªåŠ¨é‡Šæ”¾æ± çš„å®ç°åŸç†"></a>è‡ªåŠ¨é‡Šæ”¾æ± çš„å®ç°åŸç†</h3><h3 id="å¾ªç¯å¼•ç”¨"><a href="#å¾ªç¯å¼•ç”¨" class="headerlink" title="å¾ªç¯å¼•ç”¨"></a>å¾ªç¯å¼•ç”¨</h3><h3 id="å¼•ç”¨è®¡æ•°ç®¡ç†"><a href="#å¼•ç”¨è®¡æ•°ç®¡ç†" class="headerlink" title="å¼•ç”¨è®¡æ•°ç®¡ç†"></a>å¼•ç”¨è®¡æ•°ç®¡ç†</h3><h2 id="äº”ã€Block"><a href="#äº”ã€Block" class="headerlink" title="äº”ã€Block"></a>äº”ã€Block</h2><h3 id="æˆªè·å˜é‡ç‰¹æ€§"><a href="#æˆªè·å˜é‡ç‰¹æ€§" class="headerlink" title="æˆªè·å˜é‡ç‰¹æ€§"></a>æˆªè·å˜é‡ç‰¹æ€§</h3><h3 id="Blockå…³é”®å­—"><a href="#Blockå…³é”®å­—" class="headerlink" title="__Blockå…³é”®å­—"></a>__Blockå…³é”®å­—</h3><h3 id="Blockçš„æœ¬è´¨"><a href="#Blockçš„æœ¬è´¨" class="headerlink" title="Blockçš„æœ¬è´¨"></a>Blockçš„æœ¬è´¨</h3><h3 id="Blockçš„å†…å­˜ç®¡ç†"><a href="#Blockçš„å†…å­˜ç®¡ç†" class="headerlink" title="Blockçš„å†…å­˜ç®¡ç†"></a>Blockçš„å†…å­˜ç®¡ç†</h3><h3 id="å¾ªç¯å¼•ç”¨-1"><a href="#å¾ªç¯å¼•ç”¨-1" class="headerlink" title="å¾ªç¯å¼•ç”¨"></a>å¾ªç¯å¼•ç”¨</h3><h2 id="å…­ã€å¤šçº¿ç¨‹"><a href="#å…­ã€å¤šçº¿ç¨‹" class="headerlink" title="å…­ã€å¤šçº¿ç¨‹"></a>å…­ã€å¤šçº¿ç¨‹</h2><h3 id="NSOperation-amp-NSOperationQueue-NSThread"><a href="#NSOperation-amp-NSOperationQueue-NSThread" class="headerlink" title="NSOperation&amp;NSOperationQueue ### NSThread"></a>NSOperation&amp;NSOperationQueue ### NSThread</h3><h3 id="GCD"><a href="#GCD" class="headerlink" title="GCD"></a>GCD</h3><h3 id="NSLock"><a href="#NSLock" class="headerlink" title="NSLock"></a>NSLock</h3><h3 id="é€’å½’é”"><a href="#é€’å½’é”" class="headerlink" title="é€’å½’é”"></a>é€’å½’é”</h3><h3 id="è‡ªæ—‹é”"><a href="#è‡ªæ—‹é”" class="headerlink" title="è‡ªæ—‹é”"></a>è‡ªæ—‹é”</h3><h3 id="æ¡ä»¶é”"><a href="#æ¡ä»¶é”" class="headerlink" title="æ¡ä»¶é”"></a>æ¡ä»¶é”</h3><h2 id="ä¸ƒã€RunLoop"><a href="#ä¸ƒã€RunLoop" class="headerlink" title="ä¸ƒã€RunLoop"></a>ä¸ƒã€RunLoop</h2><h3 id="RunLoopä¸ºä»€ä¹ˆä¼šæœ‰äº‹åšäº‹æ²¡äº‹ä¼‘æ¯ï¼Œç³»ç»Ÿæ˜¯æ€æ ·å®ç°çš„"><a href="#RunLoopä¸ºä»€ä¹ˆä¼šæœ‰äº‹åšäº‹æ²¡äº‹ä¼‘æ¯ï¼Œç³»ç»Ÿæ˜¯æ€æ ·å®ç°çš„" class="headerlink" title="RunLoopä¸ºä»€ä¹ˆä¼šæœ‰äº‹åšäº‹æ²¡äº‹ä¼‘æ¯ï¼Œç³»ç»Ÿæ˜¯æ€æ ·å®ç°çš„"></a>RunLoopä¸ºä»€ä¹ˆä¼šæœ‰äº‹åšäº‹æ²¡äº‹ä¼‘æ¯ï¼Œç³»ç»Ÿæ˜¯æ€æ ·å®ç°çš„</h3><h3 id="æ€æ ·å®ç°ä¸€ä¸ªå¸¸é©»çº¿ç¨‹"><a href="#æ€æ ·å®ç°ä¸€ä¸ªå¸¸é©»çº¿ç¨‹" class="headerlink" title="æ€æ ·å®ç°ä¸€ä¸ªå¸¸é©»çº¿ç¨‹"></a>æ€æ ·å®ç°ä¸€ä¸ªå¸¸é©»çº¿ç¨‹</h3><h3 id="RunLoopå’Œçº¿ç¨‹çš„å…³ç³»æ˜¯æ€æ ·"><a href="#RunLoopå’Œçº¿ç¨‹çš„å…³ç³»æ˜¯æ€æ ·" class="headerlink" title="RunLoopå’Œçº¿ç¨‹çš„å…³ç³»æ˜¯æ€æ ·"></a>RunLoopå’Œçº¿ç¨‹çš„å…³ç³»æ˜¯æ€æ ·</h3><h2 id="å…«ã€ç½‘ç»œ"><a href="#å…«ã€ç½‘ç»œ" class="headerlink" title="å…«ã€ç½‘ç»œ"></a>å…«ã€ç½‘ç»œ</h2><h3 id="HTTPç›¸å…³çš„ä¸­é—´äººæ”»å‡»"><a href="#HTTPç›¸å…³çš„ä¸­é—´äººæ”»å‡»" class="headerlink" title="HTTPç›¸å…³çš„ä¸­é—´äººæ”»å‡»"></a>HTTPç›¸å…³çš„ä¸­é—´äººæ”»å‡»</h3><h3 id="HTTPSçš„è¿æ¥å»ºç«‹æµç¨‹"><a href="#HTTPSçš„è¿æ¥å»ºç«‹æµç¨‹" class="headerlink" title="HTTPSçš„è¿æ¥å»ºç«‹æµç¨‹"></a>HTTPSçš„è¿æ¥å»ºç«‹æµç¨‹</h3><h3 id="å¯¹ç§°åŠ å¯†"><a href="#å¯¹ç§°åŠ å¯†" class="headerlink" title="å¯¹ç§°åŠ å¯†"></a>å¯¹ç§°åŠ å¯†</h3><h3 id="éå¯¹ç§°åŠ å¯†"><a href="#éå¯¹ç§°åŠ å¯†" class="headerlink" title="éå¯¹ç§°åŠ å¯†"></a>éå¯¹ç§°åŠ å¯†</h3><h3 id="DNSåŠ«æŒ"><a href="#DNSåŠ«æŒ" class="headerlink" title="DNSåŠ«æŒ"></a>DNSåŠ«æŒ</h3><h3 id="TCPçš„æ»‘åŠ¨çª—å£åè®®"><a href="#TCPçš„æ»‘åŠ¨çª—å£åè®®" class="headerlink" title="TCPçš„æ»‘åŠ¨çª—å£åè®®"></a>TCPçš„æ»‘åŠ¨çª—å£åè®®</h3><h3 id="å¯é ä¼ è¾“æ˜¯æ€æ ·ä¿è¯çš„"><a href="#å¯é ä¼ è¾“æ˜¯æ€æ ·ä¿è¯çš„" class="headerlink" title="å¯é ä¼ è¾“æ˜¯æ€æ ·ä¿è¯çš„"></a>å¯é ä¼ è¾“æ˜¯æ€æ ·ä¿è¯çš„</h3><h3 id="TCPçš„æ…¢å¯åŠ¨ç‰¹ç‚¹"><a href="#TCPçš„æ…¢å¯åŠ¨ç‰¹ç‚¹" class="headerlink" title="TCPçš„æ…¢å¯åŠ¨ç‰¹ç‚¹"></a>TCPçš„æ…¢å¯åŠ¨ç‰¹ç‚¹</h3><h3 id="Session-Cookieçš„åŒºåˆ«"><a href="#Session-Cookieçš„åŒºåˆ«" class="headerlink" title="Session/Cookieçš„åŒºåˆ«"></a>Session/Cookieçš„åŒºåˆ«</h3><h2 id="ä¹ã€è®¾è®¡æ¨¡å¼"><a href="#ä¹ã€è®¾è®¡æ¨¡å¼" class="headerlink" title="ä¹ã€è®¾è®¡æ¨¡å¼"></a>ä¹ã€è®¾è®¡æ¨¡å¼</h2><h3 id="è½¯ä»¶è®¾è®¡åŸåˆ™"><a href="#è½¯ä»¶è®¾è®¡åŸåˆ™" class="headerlink" title="è½¯ä»¶è®¾è®¡åŸåˆ™"></a>è½¯ä»¶è®¾è®¡åŸåˆ™</h3><h3 id="è´£ä»»é“¾"><a href="#è´£ä»»é“¾" class="headerlink" title="è´£ä»»é“¾"></a>è´£ä»»é“¾</h3><h3 id="é€‚é…å™¨"><a href="#é€‚é…å™¨" class="headerlink" title="é€‚é…å™¨"></a>é€‚é…å™¨</h3><h3 id="æ¡¥æ¥"><a href="#æ¡¥æ¥" class="headerlink" title="æ¡¥æ¥"></a>æ¡¥æ¥</h3><h3 id="å‘½ä»¤"><a href="#å‘½ä»¤" class="headerlink" title="å‘½ä»¤"></a>å‘½ä»¤</h3><h3 id="å•ä¾‹"><a href="#å•ä¾‹" class="headerlink" title="å•ä¾‹"></a>å•ä¾‹</h3><h3 id="ç­–ç•¥æ¨¡å¼"><a href="#ç­–ç•¥æ¨¡å¼" class="headerlink" title="ç­–ç•¥æ¨¡å¼"></a>ç­–ç•¥æ¨¡å¼</h3><h2 id="åã€æ¶æ„-æ¡†æ¶"><a href="#åã€æ¶æ„-æ¡†æ¶" class="headerlink" title="åã€æ¶æ„/æ¡†æ¶"></a>åã€æ¶æ„/æ¡†æ¶</h2><h3 id="æ€æ ·è®¾è®¡å›¾ç‰‡ç¼“å­˜æ¡†æ¶"><a href="#æ€æ ·è®¾è®¡å›¾ç‰‡ç¼“å­˜æ¡†æ¶" class="headerlink" title="æ€æ ·è®¾è®¡å›¾ç‰‡ç¼“å­˜æ¡†æ¶"></a>æ€æ ·è®¾è®¡å›¾ç‰‡ç¼“å­˜æ¡†æ¶</h3><h3 id="ç½‘ç»œæ¡†æ¶"><a href="#ç½‘ç»œæ¡†æ¶" class="headerlink" title="ç½‘ç»œæ¡†æ¶"></a>ç½‘ç»œæ¡†æ¶</h3><h3 id="å®¢æˆ·ç«¯çš„æ•´ä½“æ¶æ„æ€æ ·å®ç°"><a href="#å®¢æˆ·ç«¯çš„æ•´ä½“æ¶æ„æ€æ ·å®ç°" class="headerlink" title="å®¢æˆ·ç«¯çš„æ•´ä½“æ¶æ„æ€æ ·å®ç°"></a>å®¢æˆ·ç«¯çš„æ•´ä½“æ¶æ„æ€æ ·å®ç°</h3><h3 id="å¸¸è§çš„è§£è€¦æ–¹å¼æœ‰å“ªäº›"><a href="#å¸¸è§çš„è§£è€¦æ–¹å¼æœ‰å“ªäº›" class="headerlink" title="å¸¸è§çš„è§£è€¦æ–¹å¼æœ‰å“ªäº›"></a>å¸¸è§çš„è§£è€¦æ–¹å¼æœ‰å“ªäº›</h3>]]></content>
      
      
      <categories>
          
          <category> é¢è¯•é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¢è¯•æŠ€å·§ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iOSé¢è¯•é¢˜-002</title>
      <link href="/2020/01/16/iOS%E9%9D%A2%E8%AF%95%E9%A2%98-002/"/>
      <url>/2020/01/16/iOS%E9%9D%A2%E8%AF%95%E9%A2%98-002/</url>
      
        <content type="html"><![CDATA[<h2 id="æ¶æ„æ¨¡å¼-ç¼–ç¨‹æ€æƒ³-è®¾è®¡æ¨¡å¼"><a href="#æ¶æ„æ¨¡å¼-ç¼–ç¨‹æ€æƒ³-è®¾è®¡æ¨¡å¼" class="headerlink" title="æ¶æ„æ¨¡å¼,ç¼–ç¨‹æ€æƒ³,è®¾è®¡æ¨¡å¼"></a>æ¶æ„æ¨¡å¼,ç¼–ç¨‹æ€æƒ³,è®¾è®¡æ¨¡å¼</h2><h3 id="1ã€æ¶æ„æ¨¡å¼"><a href="#1ã€æ¶æ„æ¨¡å¼" class="headerlink" title="1ã€æ¶æ„æ¨¡å¼"></a>1ã€æ¶æ„æ¨¡å¼</h3><ul><li>MVC:<blockquote><p>MVCå³Model-VIew-Controllerã€‚MVCæ¨¡å¼è‡´åŠ›äºå…³æ³¨ç‚¹çš„åˆ‡åˆ†ï¼Œè¿™æ„å‘³ç€modelå’Œcontrollerçš„é€»è¾‘æ˜¯ä¸ä¸ç”¨æˆ·ç•Œé¢ï¼ˆViewï¼‰æŒ‚é’©çš„ã€‚Modelå±‚ä»£è¡¨äº†æè¿°ä¸šåŠ¡é€»è¾‘å’Œæ•°æ®çš„ä¸€ç³»åˆ—ç±»çš„é›†åˆã€‚å®ƒä¹Ÿå®šä¹‰äº†æ•°æ®ä¿®æ”¹å’Œæ“ä½œçš„ä¸šåŠ¡è§„åˆ™ã€‚Viewä»£è¡¨äº†UIç»„ä»¶ï¼ŒåƒUIViewï¼ŒUIButtonï¼ŒUITableViewç­‰ã€‚ä»–åªè´Ÿè´£å±•ç¤ºä»controlleræ¥æ”¶åˆ°çš„æ•°æ®ã€‚å› æ­¤ï¼Œç»´æŠ¤å’Œæµ‹è¯•ç¨‹åºå˜å¾—æ›´åŠ ç®€å•å®¹æ˜“ã€‚ç„¶è€Œåœ¨Cocoaçš„MVCæ¨¡å¼ä¸­Controllerç»å¸¸è¢«æ··æ‚åœ¨Viewçš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œå› æ­¤å¾ˆéš¾è¯´Viewå’ŒViewControlleræ˜¯åˆ†ç¦»çš„ï¼Œè¿™ä¹Ÿå¾€å¾€é©±ä½¿äººä»¬å†™å‡ºè‡ƒè‚¿çš„è§†å›¾æ§åˆ¶å™¨ï¼Œå°½ç®¡ä»å¯ä»¥å°†ä¸šåŠ¡é€»è¾‘å’Œæ•°æ®è½¬æ¢åˆ°Modelï¼Œä½†æ˜¯å¤§å¤šæ•°æƒ…å†µä¸‹å½“éœ€è¦ä¸ºViewå‡è´Ÿçš„æ—¶å€™æˆ‘ä»¬å´æ— èƒ½ä¸ºåŠ›äº†ã€‚Viewçš„æœ€å¤§çš„ä»»åŠ¡å°±æ˜¯å‘Controllerä¼ é€’ç”¨æˆ·åŠ¨ä½œäº‹ä»¶ã€‚ViewControllerä¸å†æ‰¿æ‹…ä¸€åˆ‡ä»£ç†å’Œæ•°æ®æºçš„èŒè´£ï¼Œé€šå¸¸åªè´Ÿè´£ä¸€äº›åˆ†å‘å’Œå–æ¶ˆç½‘ç»œè¯·æ±‚ä»¥åŠä¸€äº›å…¶ä»–çš„ä»»åŠ¡ã€‚å½“åœ¨è¿›è¡Œå•å…ƒæµ‹è¯•çš„æ—¶å€™ä½ ä¼šå‘ç°é—®é¢˜è¶Šæ¥è¶Šæ˜æ˜¾ã€‚å› ä¸ºä½ çš„ViewControllerå’ŒViewæ˜¯ç´§å¯†è€¦åˆçš„ï¼Œå¯¹å®ƒä»¬è¿›è¡Œæµ‹è¯•å°±æ˜¾å¾—å¾ˆè‰°éš¾ã€‚Cocoa MVCçœ‹æ¥å¹¶ä¸æ˜¯æˆ‘ä»¬å®šä¹‰ä¸­ç†æƒ³çš„æ¶æ„æ¨¡å¼ã€‚</p></blockquote></li><li>MVVM:<blockquote><p>å³Model-View-View Modelã€‚è¿™ä¸ªæ¨¡å¼æä¾›å¯¹Viewå’ŒView Modelçš„åŒå‘æ•°æ®ç»‘å®šã€‚è¿™ä½¿å¾—View Modelçš„çŠ¶æ€æ”¹å˜å¯ä»¥è‡ªåŠ¨ä¼ é€’ç»™Viewã€‚å…¸å‹çš„æƒ…å†µæ˜¯ï¼ŒView Modelé€šè¿‡ä½¿ç”¨obseveræ¨¡å¼ï¼ˆè§‚å¯Ÿè€…æ¨¡å¼ï¼‰æ¥å°†View Modelçš„å˜åŒ–é€šçŸ¥ç»™modelã€‚View Modelè´Ÿè´£æš´æ¼æ–¹æ³•ï¼Œå‘½ä»¤ï¼Œå…¶ä»–å±æ€§æ¥æ“ä½œVIewçš„çŠ¶æ€ï¼Œç»„è£…modelä½œä¸ºViewåŠ¨ä½œçš„ç»“æœï¼Œå¹¶ä¸”è§¦å‘Viewè‡ªå·±çš„äº‹ä»¶ã€‚å®ƒå’ŒMVPæ¨¡å¼çœ‹èµ·æ¥éå¸¸åƒ:MVVMå°†ViewControllerè§†ä½œView,Viewå’ŒModelä¹‹é—´æ²¡æœ‰ç´§å¯†çš„è”ç³»ã€‚åœ¨ä½¿ç”¨MVVMæ¨¡å¼æ—¶ï¼Œè‡ªç„¶è€Œç„¶ä¼šæƒ³åˆ°ReactiveCocaï¼Œåä¹‹äº¦ç„¶ã€‚å°½ç®¡é€šè¿‡ç®€å•çš„ç»‘å®šæ¥ä½¿ç”¨MVVMæ˜¯å¯å®ç°çš„ï¼Œä½†æ˜¯ReactiveCocoaå´èƒ½æ›´å¥½çš„å‘æŒ¥MVVMæ¨¡å¼çš„ç‰¹ç‚¹ã€‚ä½†æ˜¯ä½¿ç”¨è¿™ä¸ªæ¡†æ¶æœ‰ä¸ªéš¾ä»¥å¿½ç•¥çš„äº‹å®ï¼šå½“ä½ åˆšå¼€å§‹ä½¿ç”¨ReactiveCocaçš„æ—¶å€™æœ‰å¾ˆå¤§çš„å¯èƒ½å°±ä¼šæŠŠäº‹æƒ…æç ¸ã€‚æ¢å¥è¯æ¥è¯´å°±æ˜¯ï¼Œå¦‚æœå‘ç°äº†ä¸€äº›é”™è¯¯ï¼Œå½“ä½ è¯•å›¾æŸ¥çœ‹å‡½æ•°è°ƒç”¨æ ˆæ—¶ä½ å¯èƒ½ä¼šå–Šï¼šâ€œå¤©å“ªï¼Œå¥½æ·±çš„å‡½æ•°è°ƒç”¨æ ˆâ€œï¼è°ƒè¯•å‡ºè¿™ä¸ªbugå¯èƒ½ä¼šèŠ±è´¹å¤§é‡çš„æ—¶é—´ã€‚MVVMå¾ˆè¯±äººï¼Œå› ä¸ºå®ƒé›†åˆäº†ä¸Šè¿°æ–¹æ³•çš„ä¼˜ç‚¹ï¼Œå¹¶ä¸”ç”±äºåœ¨Viewå±‚çš„ç»‘å®šï¼Œå®ƒå¹¶ä¸éœ€è¦å…¶ä»–é™„åŠ çš„ä»£ç æ¥æ›´æ–°Viewï¼Œå°½ç®¡è¿™æ ·ï¼Œå¯æµ‹è¯•æ€§ä¾ç„¶å¾ˆå¼ºâ€”â€”ç¬¦åˆæˆ‘ä»¬ç†æƒ³ä¸­å¥½æ¶æ„æ¨¡å¼çš„å®šä¹‰ã€‚</p></blockquote></li><li>MVP:<blockquote><p>è¿™ä¸ªæ¨¡å¼æŠŠPresenteræ¢æˆControllerå°±å’ŒMVCéå¸¸ç›¸åƒäº†ã€‚è¿™ä¸ªè®¾è®¡æ¨¡å¼æŠŠåº”ç”¨ç¨‹åºåˆ†æˆäº†3ä¸ªä¸»è¦æ–¹é¢ï¼šModelã€Viewå’ŒPresenter,å…¶ä¸­çš„Modelå’ŒViewä¸MVCæ¨¡ä¸­çš„è§’è‰²ç›¸åŒã€‚Presenterè´Ÿè´£å¤„ç†ViewèƒŒåæ‰€æœ‰çš„UIäº‹ä»¶ã€‚å®ƒé€šè¿‡Viewæ¥æ”¶ç”¨æˆ·è¾“å…¥ï¼Œä¹‹ååˆ©ç”¨Modelæ¥å¤„ç†ç”¨æˆ·çš„æ•°æ®ï¼Œæœ€åæŠŠç»“æœè¿”å›ç»™Viewã€‚ä¸Viewå’ŒControllerä¸åŒï¼ŒViewå’ŒPresenterä¹‹é—´æ˜¯å®Œå…¨è§£è€¦çš„ï¼Œä»–ä»¬é€šè¿‡æ¥å£æ¥äº¤äº’ã€‚å¦å¤–ï¼Œpresenterä¸åƒcontrollerå¤„ç†è¿›å…¥çš„è¯·æ±‚ã€‚è¿™ä¸æ˜¯æ­£è§£å†³äº†Cocoa MVCä¸­ViewControllerå’ŒViewçš„è€¦åˆé—®é¢˜å—ï¼Ÿå°±MVPæ¨¡å¼è€Œè¨€ï¼ŒUIViewControllerçš„å­ç±»å®é™…ä¸Šå°±æ˜¯Viewså¹¶ä¸æ˜¯Presentersã€‚è¿™ç‚¹åŒºåˆ«ä½¿å¾—è¿™ç§æ¨¡å¼çš„å¯æµ‹è¯•æ€§å¾—åˆ°äº†æå¤§çš„æé«˜ï¼Œä»˜å‡ºçš„ä»£ä»·æ˜¯å¼€å‘é€Ÿåº¦çš„ä¸€äº›é™ä½ï¼Œå› ä¸ºå¿…é¡»è¦åšä¸€äº›æ‰‹åŠ¨çš„æ•°æ®å’Œäº‹ä»¶ç»‘å®šã€‚ä½†æ˜¯è¿™ä¹Ÿæ„å‘³ç€æˆ‘ä»¬å°†æœ€ä¸»è¦çš„ä»»åŠ¡åˆ’åˆ†åˆ°Presenterå’ŒModelï¼Œè€ŒViewçš„åŠŸèƒ½è¾ƒå°‘â€”â€”å„ä¸ªå®ä½“ä»»åŠ¡é‡åˆ†é…ä¸å‡è¡¡ã€‚</p></blockquote></li><li>Viperæ¶æ„æ¨¡å¼:<blockquote><p>ç”±è§†å›¾ (View)ï¼Œäº¤äº’å™¨ (Interactor)ï¼Œå±•ç¤ºå™¨ (Presenter)ï¼Œå®ä½“ (Entity) ä»¥åŠè·¯ç”± (Routing) ç»„æˆã€‚<br><br>è§†å›¾ï¼šæ ¹æ®å±•ç¤ºå™¨çš„è¦æ±‚æ˜¾ç¤ºç•Œé¢ï¼Œå¹¶å°†ç”¨æˆ·è¾“å…¥åé¦ˆç»™å±•ç¤ºå™¨ã€‚<br><br>äº¤äº’å™¨ï¼šåŒ…å«ç”±ç”¨ä¾‹æŒ‡å®šçš„ä¸šåŠ¡é€»è¾‘ã€‚<br><br>å±•ç¤ºå™¨ï¼šåŒ…å«ä¸ºæ˜¾ç¤ºï¼ˆä»äº¤äº’å™¨æ¥å—çš„å†…å®¹ï¼‰åšçš„å‡†å¤‡å·¥ä½œçš„ç›¸å…³è§†å›¾é€»è¾‘ï¼Œå¹¶å¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œåé¦ˆï¼ˆä»äº¤äº’å™¨è·å–æ–°æ•°æ®ï¼‰ã€‚<br><br>å®ä½“ï¼šåŒ…å«äº¤äº’å™¨è¦ä½¿ç”¨çš„åŸºæœ¬æ¨¡å‹å¯¹è±¡ã€‚<br><br>è·¯ç”±ï¼šåŒ…å«ç”¨æ¥æè¿°å±å¹•æ˜¾ç¤ºå’Œæ˜¾ç¤ºé¡ºåºçš„å¯¼èˆªé€»è¾‘ã€‚<br>Viperå°†åº”ç”¨ç¨‹åºçš„é€»è¾‘ç»“æ„åˆ’åˆ†ä¸ºä¸åŒçš„è´£ä»»å±‚ã€‚è¿™ä½¿å¾—å®ƒæ›´å®¹æ˜“éš”ç¦»ä¾èµ–é¡¹ (å¦‚æ•°æ®åº“)ï¼Œä¹Ÿæ›´å®¹æ˜“æµ‹è¯•å„å±‚é—´çš„è¾¹ç•Œå¤„çš„äº¤äº’ã€‚<br><br>Viperçš„ä¸åŒå±‚æä¾›äº†æ˜ç¡®çš„ç¨‹åºé€»è¾‘ä»¥åŠå¯¼èˆªæ§åˆ¶ä»£ç æ¥é¿å…è§†å›¾æ§åˆ¶å™¨å¤ªè¿‡äºè‡ƒè‚¿çš„é—®é¢˜ï¼Œåˆ©ç”¨ Viper ï¼Œè§†å›¾æ§åˆ¶å™¨å¯ä»¥ç®€æ´é«˜æ•ˆï¼Œæ„ä¹‰æ˜ç¡®åœ°æ§åˆ¶è§†å›¾ã€‚è§†å›¾æ§åˆ¶å™¨ä¸­ä»£ç å’Œæ‰€æœ‰çš„å…¶ä»–ç±»å¾ˆå®¹æ˜“ç†è§£ï¼Œå®¹æ˜“æµ‹è¯•ï¼Œç†æ‰€å½“ç„¶ä¹Ÿæ›´æ˜“ç»´æŠ¤ã€‚<br>æ¯«æ— ç–‘é—®ï¼ŒViperåœ¨åˆ’åˆ†è´£ä»»çš„ç²’åº¦ä¸Šæ¯”ä»¥ä¸Šå‡ ç§æ¨¡å¼éƒ½è¦ä¼˜ç§€ï¼Œè‡ªç„¶è€Œç„¶å°±æœ‰æ›´å¥½çš„å¯æµ‹è¯•æ€§ï¼Œå½“ç„¶ä½ å¿…é¡»ä¸ºå¾ˆå°åŠŸèƒ½çš„ç±»å†™å‡ºå¤§é‡çš„æ¥å£ã€‚å¦‚æœæ˜¯åœ¨å¤§å‹é¡¹ç›®ä¸­ä½¿ç”¨Viperï¼ŒViperæ¶æ„æ¨¡å¼ç¬¦åˆæˆ‘ä»¬ç†æƒ³ä¸­å¥½æ¶æ„æ¨¡å¼çš„å®šä¹‰ã€‚</p></blockquote></li></ul><h3 id="2ã€ç¼–ç¨‹æ€æƒ³"><a href="#2ã€ç¼–ç¨‹æ€æƒ³" class="headerlink" title="2ã€ç¼–ç¨‹æ€æƒ³"></a>2ã€ç¼–ç¨‹æ€æƒ³</h3><h4 id="é¢å‘å¯¹è±¡ç¼–ç¨‹æ€æƒ³"><a href="#é¢å‘å¯¹è±¡ç¼–ç¨‹æ€æƒ³" class="headerlink" title="é¢å‘å¯¹è±¡ç¼–ç¨‹æ€æƒ³"></a>é¢å‘å¯¹è±¡ç¼–ç¨‹æ€æƒ³</h4><blockquote><h5 id="å°è£…"><a href="#å°è£…" class="headerlink" title="å°è£…"></a>å°è£…</h5><p>åœ¨é¢å‘å¯¹è±¡çš„è¯­è¨€ä¸­ï¼Œå¯¹è±¡ã€ç±»ã€æ–¹æ³•éƒ½æ˜¯ä¸€ç§å°è£…ï¼Œå¯¹è±¡æ˜¯å°è£…çš„æœ€åŸºæœ¬å•ä½ã€‚<br><br>ç±»çš„å°è£…ä½“ç°åœ¨æ¯ä¸ªç±»éƒ½æœ‰.hå’Œ.mä¸¤ä¸ªæ–‡ä»¶ï¼Œå°†å®šä¹‰ä¸å®ç°åˆ†å¼€ï¼Œ.hå£°æ˜ï¼ˆç”¨æˆ·å¯è§çš„å¤–éƒ¨æ¥å£ï¼‰ï¼Œ.må®ç°ï¼ˆç”¨æˆ·ä¸å¯è§çš„å†…éƒ¨å®ç°ï¼‰ã€‚æ–¹æ³•çš„å°è£…ï¼Œæ˜¯æœ€å¸¸è§çš„ï¼Œæ¯ä¸ªæ–¹æ³•ä¸­å°è£…äº†ä¸€ä¸ªå°çš„åŠŸèƒ½ï¼Œè¿™æ˜¯å•ä¸€èŒè´£çš„å¾ˆå¥½ä½“ç°ï¼Œç¬¬ä¸‰æ–¹æ¡†æ¶å’Œä»£ç ä¹Ÿæ˜¯ä¸€ç§å°è£…ã€‚å°è£…ä½¿ç¨‹åºçš„ç»“æ„æ›´åŠ æ¸…æ™°ï¼Œå°†å®ç°çš„ä¿¡æ¯å°è£…éšè—ï¼Œç”¨çš„æ—¶å€™ç›´æ¥è°ƒç”¨å°è£…å¥½çš„æ–¹æ³•æˆ–ç±»ï¼Œæé«˜æ•ˆç‡ã€‚æ­¤å¤–ï¼Œå¯ä»¥å‡å°‘ç¨‹åºé—´çš„ç›¸äº’ä¾èµ–ã€‚</p><h5 id="ç»§æ‰¿"><a href="#ç»§æ‰¿" class="headerlink" title="ç»§æ‰¿"></a>ç»§æ‰¿</h5><p>å­ç±»è‡ªåŠ¨å…±äº«çˆ¶ç±»éç§æœ‰æ•°æ®ç»“æ„å’Œæ–¹æ³•çš„æœºåˆ¶ï¼Œæ˜¯ç±»ä¹‹é—´çš„ä¸€ç§å…³ç³»ã€‚<br><br>ç»§æ‰¿æ˜¯é¢å‘å¯¹è±¡è¯­è¨€ç‰¹æœ‰çš„ï¼Œé¢å‘è¿‡ç¨‹çš„è¯­è¨€ä¸å…·æœ‰ç»§æ‰¿ç‰¹æ€§ï¼ŒOCæ˜¯å•ç»§æ‰¿ã€‚<br><br>ç»§æ‰¿æä¾›äº†ç±»çš„è§„èŒƒç­‰çº§ç»“æ„ï¼Œä½¿å…¬å…±çš„ç‰¹æ€§èƒ½å¤Ÿå…±äº«ï¼Œæé«˜çš„è½¯ä»¶çš„é‡ç”¨æ€§ã€‚<br><br>ç±»çš„ç»§æ‰¿æ€§ä½¿æ‰€å»ºçš„è½¯ä»¶å…·æœ‰å¼€å‘æ€§ã€å¯æ‰©å……æ€§ï¼Œç®€åŒ–äº†å¯¹è±¡ã€ç±»çš„åˆ›å»ºå·¥ä½œé‡ï¼Œæé«˜äº†ä»£ç çš„é‡ç”¨æ€§ã€‚</p><h5 id="å¤šæ€"><a href="#å¤šæ€" class="headerlink" title="å¤šæ€"></a>å¤šæ€</h5><p>ç”¨çˆ¶ç±»æŒ‡é’ˆæŒ‡å‘å­ç±»çš„å¯¹è±¡ã€‚é€šè¿‡ä¸åŒçš„å¯¹è±¡è°ƒç”¨ç›¸åŒçš„åç§°çš„æ–¹æ³•ï¼Œå´äº§ç”Ÿä¸åŒçš„ç»“æœã€‚<br><br>é€šè¿‡çˆ¶ç±»æŒ‡é’ˆå¾—åˆ°çš„å‡ ä¸ªå¯¹è±¡ï¼Œéƒ½è°ƒç”¨äº†çˆ¶ç±»ä¸­æŸä¸ªæ–¹æ³•ï¼Œä½†å®é™…ä¸Šåœ¨è¿è¡Œçš„æ—¶å€™ï¼Œæ˜¯æ‰§è¡Œçš„è‡ªå·±çœŸå®ç±»ä¸­çš„æ–¹æ³•ã€‚<br><br>å¤šæ€å¢å¼ºäº†è½¯ä»¶çš„çµæ´»æ€§å’Œé‡ç”¨æ€§ã€‚</p></blockquote><h4 id="é“¾å¼ç¼–ç¨‹æ€æƒ³"><a href="#é“¾å¼ç¼–ç¨‹æ€æƒ³" class="headerlink" title="é“¾å¼ç¼–ç¨‹æ€æƒ³"></a>é“¾å¼ç¼–ç¨‹æ€æƒ³</h4><blockquote><p>å°†å¤šä¸ªæ“ä½œï¼ˆå¤šè¡Œä»£ç ï¼‰é€šè¿‡ç‚¹å·(.)é“¾æ¥åœ¨ä¸€èµ·æˆä¸ºä¸€å¥ä»£ç ,ä½¿ä»£ç å¯è¯»æ€§å¥½ã€‚a(1).b(2).c(3)<br><br>é“¾å¼ç¼–ç¨‹ç‰¹ç‚¹ï¼šæ–¹æ³•çš„è¿”å›å€¼æ˜¯block,blockå¿…é¡»æœ‰è¿”å›å€¼ï¼ˆæœ¬èº«å¯¹è±¡ï¼‰ï¼Œblockå‚æ•°ï¼ˆéœ€è¦æ“ä½œçš„å€¼<br><br>ä»£è¡¨ï¼šMasonryæ¡†æ¶</p></blockquote><h4 id="å“åº”å¼ç¼–ç¨‹æ€æƒ³"><a href="#å“åº”å¼ç¼–ç¨‹æ€æƒ³" class="headerlink" title="å“åº”å¼ç¼–ç¨‹æ€æƒ³"></a>å“åº”å¼ç¼–ç¨‹æ€æƒ³</h4><blockquote><p>ä¸éœ€è¦è€ƒè™‘è°ƒç”¨é¡ºåºï¼Œåªéœ€è¦çŸ¥é“è€ƒè™‘ç»“æœï¼Œç±»ä¼¼äºè´è¶æ•ˆåº”ï¼Œäº§ç”Ÿä¸€ä¸ªäº‹ä»¶ï¼Œä¼šå½±å“å¾ˆå¤šä¸œè¥¿ï¼Œè¿™äº›äº‹ä»¶åƒæµä¸€æ ·çš„ä¼ æ’­å‡ºå»ï¼Œç„¶åå½±å“ç»“æœï¼Œå€Ÿç”¨é¢å‘å¯¹è±¡çš„ä¸€å¥è¯ï¼Œä¸‡ç‰©çš†æ˜¯æµã€‚<br></p></blockquote><blockquote><p>ä»£è¡¨ï¼šKVOè¿ç”¨ã€‚</p></blockquote><h4 id="å‡½æ•°å¼ç¼–ç¨‹æ€æƒ³"><a href="#å‡½æ•°å¼ç¼–ç¨‹æ€æƒ³" class="headerlink" title="å‡½æ•°å¼ç¼–ç¨‹æ€æƒ³"></a>å‡½æ•°å¼ç¼–ç¨‹æ€æƒ³</h4><blockquote><p>æ˜¯æŠŠæ“ä½œå°½é‡å†™æˆä¸€ç³»åˆ—åµŒå¥—çš„å‡½æ•°æˆ–è€…æ–¹æ³•è°ƒç”¨ã€‚<br><br>å‡½æ•°å¼ç¼–ç¨‹æœ¬è´¨:å°±æ˜¯å¾€æ–¹æ³•ä¸­ä¼ å…¥Block,æ–¹æ³•ä¸­åµŒå¥—Blockè°ƒç”¨ï¼ŒæŠŠä»£ç èšåˆèµ·æ¥ç®¡ç†<br><br>å‡½æ•°å¼ç¼–ç¨‹ç‰¹ç‚¹ï¼šæ¯ä¸ªæ–¹æ³•å¿…é¡»æœ‰è¿”å›å€¼ï¼ˆæœ¬èº«å¯¹è±¡ï¼‰,æŠŠå‡½æ•°æˆ–è€…Blockå½“åšå‚æ•°,blockå‚æ•°ï¼ˆéœ€è¦æ“ä½œçš„å€¼ï¼‰blockè¿”å›å€¼ï¼ˆæ“ä½œç»“æœï¼‰<br><br>ä»£è¡¨ï¼šReactiveCocoaã€‚</p></blockquote><h2 id="åº•å±‚è¿›é˜¶-æ·±å±‚ç†è§£"><a href="#åº•å±‚è¿›é˜¶-æ·±å±‚ç†è§£" class="headerlink" title="åº•å±‚è¿›é˜¶,æ·±å±‚ç†è§£"></a>åº•å±‚è¿›é˜¶,æ·±å±‚ç†è§£</h2><h2 id="ä¸‰æ–¹æ¡†æ¶è¦çŸ¥å…¶ç„¶-è€ŒçŸ¥å…¶æ‰€ä»¥ç„¶"><a href="#ä¸‰æ–¹æ¡†æ¶è¦çŸ¥å…¶ç„¶-è€ŒçŸ¥å…¶æ‰€ä»¥ç„¶" class="headerlink" title="ä¸‰æ–¹æ¡†æ¶è¦çŸ¥å…¶ç„¶,è€ŒçŸ¥å…¶æ‰€ä»¥ç„¶"></a>ä¸‰æ–¹æ¡†æ¶è¦çŸ¥å…¶ç„¶,è€ŒçŸ¥å…¶æ‰€ä»¥ç„¶</h2><h3 id="1ã€AFNetworking"><a href="#1ã€AFNetworking" class="headerlink" title="1ã€AFNetworking"></a>1ã€AFNetworking</h3><p>AFNetworkingæœ‰5ä¸ªæ¨¡å—ï¼š</p><h4 id="NSURLSession-ç½‘ç»œè¯·æ±‚æ¨¡å—"><a href="#NSURLSession-ç½‘ç»œè¯·æ±‚æ¨¡å—" class="headerlink" title="NSURLSession ç½‘ç»œè¯·æ±‚æ¨¡å—"></a>NSURLSession ç½‘ç»œè¯·æ±‚æ¨¡å—</h4><blockquote><p>AFHTTPSessionManagerç»§æ‰¿è‡ªAFURLSessionManager<br><br>GET<br><br>POST<br><br>DELETE<br><br>PUT<br><br>PATCH<br><br>æ–‡ä»¶ä¸Šä¼ <br><br>AFURLSessionManager<br><br>ç®¡ç†æ‰€æœ‰çš„è¯·æ±‚ï¼Œè®¾ç½®äº†NSURLSessionTaskDelegate, NSRULSessionDataDelegate,NSURLSessionDownloadDelegateå®ç°è¯ä¹¦åˆæ³•æ€§æ ¡éªŒï¼Œæ•°æ®ä¼ è¾“è¿›åº¦æ£€æµ‹ï¼Œæ•°æ®è¯·æ±‚æˆåŠŸ/å¤±è´¥çš„å›è°ƒã€‚<br>ä½¿ç”¨Runtimeç”¨af_suspendæ›¿æ¢ suspend, ç”¨af_resumeæ›¿æ¢äº†resume å½“è°ƒç”¨è€…ä¸¤ä¸ªæ–¹æ³•æ—¶å¾€ä¸Šå±‚å‘é€é€šçŸ¥ AFNetworkingTaskDidSuspendNotification AFNetworkingTaskDidResumeNotification<br>è¯·æ±‚æœåŠ¡å™¨æ•°æ®<br><br>ä¸Šä¼ æ•°æ®<br><br>å¤šçº¿ç¨‹ä¸‹è½½æ•°æ®</p></blockquote><h4 id="Reachability-ç›‘æµ‹ç½‘ç»œçŠ¶æ€æ¨¡å—"><a href="#Reachability-ç›‘æµ‹ç½‘ç»œçŠ¶æ€æ¨¡å—" class="headerlink" title="Reachability ç›‘æµ‹ç½‘ç»œçŠ¶æ€æ¨¡å—"></a>Reachability ç›‘æµ‹ç½‘ç»œçŠ¶æ€æ¨¡å—</h4><blockquote><p>AFNetworkReachabilityManager</p></blockquote><h4 id="Security-å®‰å…¨ç­–ç•¥æ¨¡å—"><a href="#Security-å®‰å…¨ç­–ç•¥æ¨¡å—" class="headerlink" title="Security å®‰å…¨ç­–ç•¥æ¨¡å—"></a>Security å®‰å…¨ç­–ç•¥æ¨¡å—</h4><blockquote><p>AFSecurityPolicy:iOSé¡¹ç›®å°†æœåŠ¡å™¨ç«¯çš„è¯ä¹¦ä¿å­˜å¯¼å…¥åˆ°é¡¹ç›®ä¸­ï¼ŒAFNæ ¹æ®é¡¹ç›®ä¸­çš„æœåŠ¡å™¨è¯ä¹¦æ¥è¿›è¡ŒéªŒè¯ï¼ŒéªŒè¯æœåŠ¡å™¨ï¼Œä¿è¯è®¿é—®æœåŠ¡å™¨çš„å®‰å…¨æ€§ã€‚<br><br>éªŒè¯è¯ä¹¦çš„æ¨¡å¼æœ‰ä¸‰ç§ï¼š<br><br>AFSSLPinningModeNone ä¸éªŒè¯<br><br>AFSSLPinningModePublicKey åªéªŒè¯å…¬é’¥<br><br>AFSSLPinningModeCertificate éªŒè¯è¯ä¹¦çš„æ‰€æœ‰å†…å®¹</p></blockquote><h4 id="Serialization-åºåˆ—åŒ–"><a href="#Serialization-åºåˆ—åŒ–" class="headerlink" title="Serialization åºåˆ—åŒ–"></a>Serialization åºåˆ—åŒ–</h4><blockquote><p>AFURLRequestSerialization<br><br>AFURLResponseSerialization</p></blockquote><h4 id="UIKit-UIç›¸å…³çš„ä¸€äº›ç±»ç›®"><a href="#UIKit-UIç›¸å…³çš„ä¸€äº›ç±»ç›®" class="headerlink" title="UIKit UIç›¸å…³çš„ä¸€äº›ç±»ç›®"></a>UIKit UIç›¸å…³çš„ä¸€äº›ç±»ç›®</h4><h4 id="åŸç†æ¦‚è¿°"><a href="#åŸç†æ¦‚è¿°" class="headerlink" title="åŸç†æ¦‚è¿°"></a>åŸç†æ¦‚è¿°</h4><blockquote><p>AFNetworking æ˜¯å¯¹NSURLSessionTaskçš„å°è£…ã€‚AFHTTPSessionManagerç»§æ‰¿AFURLSessionManagerå¯¹ç½‘ç»œè¯·æ±‚è¿›è¡Œç®¡ç†ï¼Œä½¿ç”¨AFURLRequestSerializationå¯¹ç½‘ç»œè¯·æ±‚è¿›è¡Œå°è£…ï¼Œä½¿ç”¨AFURLResponseSerializationå¯¹å“åº”ä½“è¿›è¡Œå¤„ç†ï¼Œä½¿ç”¨AFSecurityPolicyå¯¹æœåŠ¡å™¨è¯ä¹¦è¿›è¡Œæ ¡éªŒã€‚æ”¯æŒHTTPSåè®®ï¼Œæ”¯æŒæœ¬åœ°è¯ä¹¦å’ŒæœåŠ¡å™¨è¯ä¹¦è¿›è¡Œå¯¹æ¯”éªŒè¯ã€‚AFNæ•°æ®ä¼ é€’ä¸»è¦ä½¿ç”¨blockå’Œnotifacationæ–¹å¼ã€‚</p></blockquote><h4 id="è¯·æ±‚è¿‡ç¨‹"><a href="#è¯·æ±‚è¿‡ç¨‹" class="headerlink" title="è¯·æ±‚è¿‡ç¨‹"></a>è¯·æ±‚è¿‡ç¨‹</h4><blockquote><p>GET/POSTç­‰æ–¹æ³•è°ƒç”¨æŠ½è±¡çš„è¯·æ±‚æ–¹æ³•ï¼ŒæŒ‡æ˜è¯·æ±‚å‚æ•°ï¼Œè°ƒç”¨å…¨èƒ½æ•°æ®è¯·æ±‚æ–¹æ³•ï¼ŒæŒ‡æ˜æ•°æ®è¯·æ±‚æ–¹å¼å’Œå‚æ•°ã€‚<br>å¯¹è¯·æ±‚è¿›è¡Œåºåˆ—åŒ–ï¼Œå¦‚æœåºåˆ—åŒ–å¤±è´¥ï¼Œå°±æ‰§è¡Œfailure blockã€‚<br>ä¸ºæ¯ä¸€ä¸ªNSURLSessionDataTaskçš„dataTaskå¢åŠ ä»£ç†ã€‚<br>å¯¹æ¯ä¸€ä¸ªNSURLSessionDataTaskçš„dataTaskå¢åŠ ä»£ç†çš„å…·ä½“å®ç°ï¼Œå¯¹dataTaskè®¾ç½®è¯·æ±‚ä¹‹åçš„å›è°ƒdelegateå’Œå¤„ç†blockã€‚</p></blockquote><h3 id="2ã€SDWebImage"><a href="#2ã€SDWebImage" class="headerlink" title="2ã€SDWebImage"></a>2ã€SDWebImage</h3><h4 id="ç¼“å­˜æœºåˆ¶"><a href="#ç¼“å­˜æœºåˆ¶" class="headerlink" title="ç¼“å­˜æœºåˆ¶"></a>ç¼“å­˜æœºåˆ¶</h4><h5 id="SDImageCache"><a href="#SDImageCache" class="headerlink" title="SDImageCache"></a>SDImageCache</h5><p>åœ¨SDImageCacheï¼Œå›¾ç‰‡é‡‡ç”¨äº†äºŒçº§ç¼“å­˜ç­–ç•¥ã€‚å›¾ç‰‡ç¼“å­˜æ—¶ï¼Œåœ¨å†…å­˜æœ‰ç¼“å­˜ï¼Œåœ¨ç£ç›˜ä¸­ä¹Ÿæœ‰ç¼“å­˜ã€‚å…¶ä¸­ï¼Œå†…å­˜ç¼“å­˜æ˜¯é€šè¿‡NSCacheå®ç°çš„ã€‚<br></p><h5 id="ç¼“å­˜æ­¥éª¤"><a href="#ç¼“å­˜æ­¥éª¤" class="headerlink" title="ç¼“å­˜æ­¥éª¤"></a>ç¼“å­˜æ­¥éª¤</h5><blockquote><ol><li>å°†å›¾ç‰‡ç¼“å­˜åœ¨å†…å­˜ä¸­</li><li>åˆ¤æ–­å›¾ç‰‡çš„æ ¼å¼æ˜¯pngæˆ–æ˜¯jpegï¼Œå°†å›¾ç‰‡è½¬åŒ–ä¸ºNSDataæ•°æ®</li><li>å¦‚æœæ˜¯åœ¨mac_osç³»ç»Ÿä¸­ï¼Œç›´æ¥å°†å›¾ç‰‡è½¬åŒ–ä¸ºNSBitmapImageRepæ•°æ®</li><li>è·å–å›¾ç‰‡çš„å­˜å‚¨è·¯å¾„ï¼Œå…¶ä¸­å›¾ç‰‡çš„æ–‡ä»¶åæ˜¯é€šè¿‡ä¼ å…¥çš„keyç»è¿‡md5åŠ å¯†åè·å¾—çš„ã€‚</li><li>å°†å›¾ç‰‡å­˜å‚¨ç£ç›˜ä¸­</li></ol></blockquote><h5 id="è·å–å›¾ç‰‡æ­¥éª¤"><a href="#è·å–å›¾ç‰‡æ­¥éª¤" class="headerlink" title="è·å–å›¾ç‰‡æ­¥éª¤"></a>è·å–å›¾ç‰‡æ­¥éª¤</h5><blockquote><ol><li>å…ˆåœ¨å†…å­˜ç¼“å­˜ä¸­å¯»æ‰¾</li><li>å¦‚æœå†…å­˜ä¸­æ‰¾ä¸åˆ°å›¾ç‰‡ï¼Œåˆ™åœ¨é»˜è®¤çš„ç£ç›˜æ ¹ç›®å½•ä¸­å¯»æ‰¾ï¼Œå¦‚æœè¿˜æ˜¯æ‰¾ä¸åˆ°ï¼Œå†ä»è‡ªå®šä¹‰çš„åªè¯»ç›®å½•è·¯å¾„ä¸­å¯»æ‰¾</li><li>è·å–å›¾ç‰‡æ•°æ®åï¼Œå°†å›¾ç‰‡æ•°æ®ä»NSDataè½¬åŒ–ä¸ºUIImage,è½¬åŒ–æ˜¯è¦æ ¹æ®å›¾ç‰‡çš„ç±»å‹è¿›è¡Œè½¬åŒ–ã€‚</li><li>é»˜è®¤å¯¹å›¾ç‰‡è¿›è¡Œè§£å‹ç¼©ï¼Œç”Ÿæˆä½å›¾å›¾ç‰‡ã€‚</li><li>å°†ä½å›¾å›¾ç‰‡è¿”å›ã€‚</li></ol></blockquote><h5 id="å›¾ç‰‡è§£å‹ç¼©æ­¥éª¤"><a href="#å›¾ç‰‡è§£å‹ç¼©æ­¥éª¤" class="headerlink" title="å›¾ç‰‡è§£å‹ç¼©æ­¥éª¤"></a>å›¾ç‰‡è§£å‹ç¼©æ­¥éª¤</h5><blockquote><ol><li>åˆ¤æ–­å›¾ç‰‡æ˜¯å¦æ˜¯åŠ¨æ€å›¾ç‰‡ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™ä¸èƒ½è§£å‹ç¼©</li><li>åˆ¤æ–­å›¾ç‰‡æ˜¯å¦æ˜¯é€æ˜çš„ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™ä¸èƒ½è§£å‹ç¼©</li><li>åˆ¤æ–­å›¾ç‰‡çš„é¢œè‰²ç©ºé—´æ¨¡å‹æ˜¯ä¸æ˜¯RGBï¼Œå¦‚æœä¸æ˜¯ï¼Œä¸èƒ½è§£å‹ç¼©</li><li>æ ¹æ®å›¾ç‰‡çš„å¤§å°åˆ›å»ºä¸€ä¸ªä¸Šä¸‹æ–‡</li><li>å°†å›¾ç‰‡ç»˜åˆ¶åœ¨ä¸Šä¸‹æ–‡ä¸­ã€‚</li><li>ä»ä¸Šä¸‹æ–‡ä¸­è¯»å–ä¸€ä¸ªä¸é€æ˜çš„ä½å›¾å›¾åƒï¼Œè¯¥å›¾åƒå°±æ˜¯è§£å‹ç¼©åçš„å›¾åƒ</li><li>å°†ä½å›¾å›¾åƒè¿”å›</li></ol></blockquote><h5 id="å¯¹å›¾ç‰‡è¿›è¡Œç¼©æ”¾æ­¥éª¤"><a href="#å¯¹å›¾ç‰‡è¿›è¡Œç¼©æ”¾æ­¥éª¤" class="headerlink" title="å¯¹å›¾ç‰‡è¿›è¡Œç¼©æ”¾æ­¥éª¤"></a>å¯¹å›¾ç‰‡è¿›è¡Œç¼©æ”¾æ­¥éª¤</h5><blockquote><ol><li>å¦‚æœæ˜¯æ™®é€šå›¾åƒï¼Œåˆ™ç›´æ¥è¿›è¡Œç¼©æ”¾</li><li>å¦‚æœæ˜¯åŠ¨æ€å›¾åƒï¼Œåˆ™è¦å¯¹å›¾åƒä¸­çš„æ¯ä¸€å¼ å›¾åƒéƒ½è¿›è¡Œç¼©æ”¾<h5 id="ç£ç›˜ç¼“å­˜æ¸…ç†æ­¥éª¤"><a href="#ç£ç›˜ç¼“å­˜æ¸…ç†æ­¥éª¤" class="headerlink" title="ç£ç›˜ç¼“å­˜æ¸…ç†æ­¥éª¤"></a>ç£ç›˜ç¼“å­˜æ¸…ç†æ­¥éª¤</h5></li><li>è·å–ç£ç›˜ä¸­å›¾ç‰‡çš„æœ€åä¿®æ”¹æ—¥æœŸã€‚(ä¸ºäº†å‡å°‘ç£ç›˜å’Œå†…å­˜æ•°æ®äº¤æ¢ï¼Œè¯»å–æ˜¯å¹¶ä¸å°†æ•´ä¸ªæ–‡ä»¶è¯»å…¥å†…å­˜ï¼Œä»…ä»…å°†æ–‡ä»¶çš„ä¸€äº›å±æ€§è¯»å…¥å†…å­˜ä¸­ï¼ŒåŒ…æ‹¬æœ€åä¿®æ”¹æ—¥æœŸï¼Œè¯¥æ–‡ä»¶æ˜¯å¦ä¸ºæ–‡ä»¶å¤¹ï¼Œæ–‡ä»¶çš„å¤§å°å’Œå¯¹åº”æ–‡ä»¶çš„æ–‡ä»¶è·¯å¾„)</li><li>æ ¹æ®æœ€åä¿®æ”¹æ—¥æœŸå°†å›¾ç‰‡è¿›è¡Œåˆ†ç±»ï¼Œå°†é‚£äº›å·²ç»å­˜æ”¾è¶…è¿‡æœ€é•¿å­˜æ”¾æ—¶é—´çš„æ–‡ä»¶å­˜å‚¨åœ¨åˆ é™¤æ•°ç»„ï¼Œå…¶ä»–çš„æ–‡ä»¶ä¿¡æ¯å­˜å‚¨åœ¨å¦ä¸€ä¸ªå­—å…¸ä¸­ã€‚å¹¶è®¡ç®—é™¤å»è¦åˆ é™¤çš„æ–‡ä»¶ä¹‹å¤–çš„æ‰€æœ‰æ–‡ä»¶å¤§å°</li><li>æ ¹æ®åˆ é™¤æ•°ç»„ä¸­çš„æ–‡ä»¶è·¯å¾„ï¼Œå°†å¯¹åº”çš„æ–‡ä»¶åˆ é™¤ã€‚</li><li>åˆ¤æ–­å‰©ä¸‹çš„æ–‡ä»¶å¤§å°æ˜¯å¦è¶…è¿‡ç”¨æˆ·ç°åœ¨çš„ç£ç›˜æœ€å¤§å®¹é‡ã€‚</li><li>å¦‚æœè¶…è¿‡ï¼Œåˆ™å°†å‰©ä½™çš„æ–‡ä»¶è¿›è¡Œå®‰ä¿®æ”¹æ—¶é—´è¿›è¡Œå‡åºæ’åˆ—ï¼Œç„¶ååˆ é™¤ä¿®æ”¹æ—¶é—´æœ€æ—©çš„æ–‡ä»¶ï¼Œç›´åˆ°ç”šå‰©ä½™æ–‡ä»¶å¤§å°å°äºæœ€å¤§ç£ç›˜å®¹é‡çš„ä¸€åŠã€‚</li></ol></blockquote><h5 id="å›¾ç‰‡ç¼“å­˜æ¸…ç†æ—¶æœº"><a href="#å›¾ç‰‡ç¼“å­˜æ¸…ç†æ—¶æœº" class="headerlink" title="å›¾ç‰‡ç¼“å­˜æ¸…ç†æ—¶æœº"></a>å›¾ç‰‡ç¼“å­˜æ¸…ç†æ—¶æœº</h5><blockquote><ol><li>å½“ç³»ç»Ÿå‘å‡ºå†…å­˜ä¸è¶³é€šçŸ¥æ—¶ï¼Œä¼šå°†å†…å­˜ä¸­çš„æ‰€æœ‰å›¾ç‰‡ç¼“å­˜éƒ½åˆ é™¤æ‰ã€‚</li><li>å½“ç¨‹åºè¿›å…¥åå°æ—¶ï¼Œä¼šå¯¹ç£ç›˜çš„æ–‡ä»¶æ•°æ®è¿›è¡Œæ¸…ç†ã€‚</li><li>å½“æ”¶åˆ°ç¨‹åºå…³é—­é€šçŸ¥æ—¶ï¼Œä¼šå¯¹ç£ç›˜ä¸­çš„æ–‡ä»¶æ•°æ®è¿›è¡Œæ¸…ç†ã€‚</li></ol></blockquote><h3 id="å¤šçº¿ç¨‹ä¸ç½‘ç»œ"><a href="#å¤šçº¿ç¨‹ä¸ç½‘ç»œ" class="headerlink" title="å¤šçº¿ç¨‹ä¸ç½‘ç»œ"></a>å¤šçº¿ç¨‹ä¸ç½‘ç»œ</h3><h3 id="å†…å­˜ç®¡ç†-æ€§èƒ½ä¼˜åŒ–"><a href="#å†…å­˜ç®¡ç†-æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="å†…å­˜ç®¡ç†,æ€§èƒ½ä¼˜åŒ–"></a>å†…å­˜ç®¡ç†,æ€§èƒ½ä¼˜åŒ–</h3><h4 id="1ã€å†…å­˜ç®¡ç†"><a href="#1ã€å†…å­˜ç®¡ç†" class="headerlink" title="1ã€å†…å­˜ç®¡ç†"></a>1ã€å†…å­˜ç®¡ç†</h4><h4 id="2ã€æ€§èƒ½ä¼˜åŒ–"><a href="#2ã€æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="2ã€æ€§èƒ½ä¼˜åŒ–"></a>2ã€æ€§èƒ½ä¼˜åŒ–</h4><h5 id="é€»è¾‘ä¼˜åŒ–"><a href="#é€»è¾‘ä¼˜åŒ–" class="headerlink" title="é€»è¾‘ä¼˜åŒ–"></a>é€»è¾‘ä¼˜åŒ–</h5><ol><li>ä»£ç å°è£…ä¼˜åŒ–</li><li>ä»£ç æ‰§è¡Œæ•ˆç‡ä¼˜åŒ–<h5 id="ç•Œé¢ä¼˜åŒ–"><a href="#ç•Œé¢ä¼˜åŒ–" class="headerlink" title="ç•Œé¢ä¼˜åŒ–"></a>ç•Œé¢ä¼˜åŒ–</h5></li><li>ç¦»å±æ¸²æŸ“ä¼˜åŒ–<blockquote><ol><li>shouldRasterizeï¼ˆå…‰æ …åŒ–ï¼‰</li><li>maskï¼ˆé®ç½©å±‚ï¼‰</li><li>shadowsï¼ˆé˜´å½±ï¼‰</li><li>EdgeAnntialiasingï¼ˆæŠ—é”¯é½¿ï¼‰</li><li>GroupOpacityï¼ˆä¸é€æ˜ï¼‰</li><li>å¤æ‚å½¢çŠ¶æ¯”å¦‚åœ†è§’ç­‰</li><li>æ¸å˜<br></li></ol></blockquote></li><li>ç•Œé¢åŠ è½½ä¼˜åŒ–</li></ol><h3 id="æ•°æ®ç»“æ„å’Œç®—æ³•"><a href="#æ•°æ®ç»“æ„å’Œç®—æ³•" class="headerlink" title="æ•°æ®ç»“æ„å’Œç®—æ³•"></a>æ•°æ®ç»“æ„å’Œç®—æ³•</h3><h3 id="éŸ³è§†é¢‘æ–¹å‘"><a href="#éŸ³è§†é¢‘æ–¹å‘" class="headerlink" title="éŸ³è§†é¢‘æ–¹å‘"></a>éŸ³è§†é¢‘æ–¹å‘</h3><h3 id="é€†å‘æ–¹å‘"><a href="#é€†å‘æ–¹å‘" class="headerlink" title="é€†å‘æ–¹å‘"></a>é€†å‘æ–¹å‘</h3>]]></content>
      
      
      <categories>
          
          <category> é¢è¯•é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¢è¯•æŠ€å·§ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iOSé¢è¯•é¢˜-001</title>
      <link href="/2020/01/16/iOS%E9%9D%A2%E8%AF%95%E9%A2%98-001/"/>
      <url>/2020/01/16/iOS%E9%9D%A2%E8%AF%95%E9%A2%98-001/</url>
      
        <content type="html"><![CDATA[<h2 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h2><h4 id="1-å±æ€§ä¿®é¥°è¯"><a href="#1-å±æ€§ä¿®é¥°è¯" class="headerlink" title="1. å±æ€§ä¿®é¥°è¯"></a>1. å±æ€§ä¿®é¥°è¯</h4><h4 id="nonatomic"><a href="#nonatomic" class="headerlink" title="nonatomic"></a>nonatomic</h4><p>éåŸå­æ€§è®¿é—®ï¼Œå¤šçº¿ç¨‹å¹¶å‘è®¿é—®ä¼šæé«˜æ€§èƒ½ã€‚</p><h4 id="atomic"><a href="#atomic" class="headerlink" title="atomic:"></a>atomic:</h4><p>åŸå­æ€§è®¿é—®ã€‚</p><h4 id="strong"><a href="#strong" class="headerlink" title="strong"></a>strong</h4><p>ARCæ—¶ä¸­ä½¿ç”¨ï¼Œç›¸å½“äºretainã€‚</p><h4 id="weak"><a href="#weak" class="headerlink" title="weak"></a>weak</h4><p>ç›¸å½“äºassignï¼Œå¯ä»¥æŠŠå¯¹åº”çš„æŒ‡é’ˆå˜é‡ç½®ä¸ºnilã€‚</p><h4 id="assgin"><a href="#assgin" class="headerlink" title="assgin"></a>assgin</h4><p>ä¸ä¼šä½¿å¼•ç”¨è®¡æ•°åŠ 1ï¼Œä¹Ÿå°±æ˜¯ç›´æ¥èµ‹å€¼ã€‚</p><h4 id="copy"><a href="#copy" class="headerlink" title="copy"></a>copy</h4><p>å»ºç«‹ä¸€ä¸ªç´¢å¼•è®¡æ•°ä¸º1çš„å¯¹è±¡ï¼Œåœ¨èµ‹å€¼æ—¶ä½¿ç”¨ä¼ å…¥å€¼çš„ä¸€ä»½æ‹·è´ã€‚</p><h4 id="retain"><a href="#retain" class="headerlink" title="retain"></a>retain</h4><p>ä¼šä½¿å¼•ç”¨è®¡æ•°åŠ 1ã€‚</p><h4 id="readonly"><a href="#readonly" class="headerlink" title="readonly"></a>readonly</h4><p>æ­¤æ ‡è®°è¯´æ˜å±æ€§ä¼šè¢«å½“æˆè¯»å†™çš„ï¼Œè¿™ä¹Ÿæ˜¯é»˜è®¤å±æ€§ã€‚</p><h4 id="readwrite"><a href="#readwrite" class="headerlink" title="readwrite"></a>readwrite</h4><p>æ­¤æ ‡è®°è¯´æ˜å±æ€§åªå¯ä»¥è¯»ï¼Œä¹Ÿå°±æ˜¯ä¸èƒ½è®¾ç½®ï¼Œå¯ä»¥è·å–ã€‚</p><h4 id="é—®é¢˜ï¼š"><a href="#é—®é¢˜ï¼š" class="headerlink" title="é—®é¢˜ï¼š"></a>é—®é¢˜ï¼š</h4><p>ï¼ˆ1ï¼‰ä»€ä¹ˆæƒ…å†µä½¿ç”¨ weak å…³é”®å­—ï¼Ÿç›¸æ¯” assign æœ‰ä»€ä¹ˆä¸åŒ?</p><ul><li>ä½¿ç”¨<blockquote><ol><li>åè®®å£°æ˜ä½¿ç”¨weak</li><li>IBOutlet ä½¿ç”¨weak</li></ol></blockquote></li><li>weak å’Œ assign çš„ä¸åŒç‚¹:<blockquote><p>weak ç­–ç•¥åœ¨å±æ€§æ‰€æŒ‡çš„å¯¹è±¡é­åˆ°æ‘§æ¯æ—¶,ç³»ç»Ÿä¼šå°† weak ä¿®é¥°çš„å±æ€§å¯¹è±¡çš„æŒ‡é’ˆæŒ‡å‘ nil,åœ¨ OC ç»™ nil å‘æ¶ˆæ¯æ˜¯ä¸ä¼šæœ‰ä»€ä¹ˆé—®é¢˜çš„;å¦‚æœä½¿ç”¨ assign ç­–ç•¥åœ¨å±æ€§æ‰€æŒ‡çš„å¯¹è±¡é­åˆ°æ‘§æ¯æ—¶,å±æ€§å¯¹è±¡æŒ‡é’ˆè¿˜æŒ‡å‘åŸæ¥çš„å¯¹è±¡,ç”±äºå¯¹è±¡å·²ç»è¢«é”€æ¯,è¿™æ—¶å€™å°±äº§ç”Ÿäº†é‡æŒ‡é’ˆ,å¦‚æœè¿™æ—¶å€™åœ¨ç»™æ­¤å¯¹è±¡å‘é€æ¶ˆæ¯,å¾ˆå®¹é€ æˆç¨‹åºå¥”æºƒassigin å¯ä»¥ç”¨äºä¿®é¥°é OC å¯¹è±¡,è€Œ weak å¿…é¡»ç”¨äº OC å¯¹è±¡ã€‚</p></blockquote></li></ul><p>ï¼ˆ2ï¼‰ä½¿ç”¨ atomic ä¸€å®šæ˜¯çº¿ç¨‹å®‰å…¨çš„å—?</p><ul><li>ä¸æ˜¯,atomic çš„æœ¬æ„æ˜¯æŒ‡å±æ€§çš„å­˜å–æ–¹æ³•æ˜¯çº¿ç¨‹å®‰å…¨çš„,å¹¶ä¸ä¿è¯æ•´ä¸ªå¯¹è±¡æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚<blockquote><p>ä¾‹å¦‚ï¼š å£°æ˜ä¸€ä¸ª NSMutableArray çš„åŸå­å±æ€§ stuff,æ­¤æ—¶ self.stuff å’Œ self.stuff =othersulf éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä½†æ˜¯,ä½¿ç”¨[self.stuff objectAtIndex:index]å°±ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„,éœ€è¦ç”¨äº’æ–¥é”æ¥ä¿è¯çº¿ç¨‹å®‰å…¨æ€§ã€‚</p></blockquote></li></ul><p>ï¼ˆ3ï¼‰@synthesize å’Œ @dynamic åˆ†åˆ«æœ‰ä»€ä¹ˆä½œç”¨</p><blockquote><ul><li>@property æœ‰ä¸¤ä¸ªå¯¹åº”çš„è¯,ä¸€ä¸ªæ˜¯@synthesize,ä¸€ä¸ªæ˜¯@dynamicã€‚<br>å¦‚æœ@synthesize å’Œ@dynamic éƒ½æ²¡å†™,é‚£ä¹ˆé»˜è®¤çš„å°±æ˜¯<br>@syntheszie var = _var;</li><li>@synthesize çš„è¯­ä¹‰æ˜¯å¦‚æœä½ æ²¡æœ‰æ‰‹åŠ¨å®ç° setter æ–¹æ³•å’Œ getter æ–¹æ³•,é‚£ä¹ˆç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ä¸ºä½ åŠ ä¸Šè¿™ä¸¤ä¸ªæ–¹æ³•ã€‚</li><li>@dynamic å‘Šè¯‰ç¼–è¯‘å™¨:å±æ€§çš„ setter ä¸ getter æ–¹æ³•ç”±ç”¨æˆ·è‡ªå·±å®ç°,ä¸è‡ªåŠ¨ç”Ÿæˆã€‚(å½“ç„¶å¯¹äº readonly çš„å±æ€§åªéœ€æä¾› getter å³å¯)</li><li>å‡å¦‚ä¸€ä¸ªå±æ€§è¢«å£°æ˜ä¸º@dynamic varï¼›ç„¶åä½ æ²¡æœ‰æä¾›@setter æ–¹æ³•å’Œ@getter æ–¹æ³•,ç¼–è¯‘çš„æ—¶å€™æ²¡é—®é¢˜,ä½†æ˜¯å½“ç¨‹åºè¿è¡Œåˆ° instance.var = someVar,ç”±äºç¼º setteræ–¹æ³•ä¼šå¯¼è‡´ç¨‹åºå´©æºƒ;<br>æˆ–è€…å½“è¿è¡Œåˆ° someVar = instance.var æ—¶,ç”±äºç¼º getter æ–¹æ³•åŒæ ·ä¼šå¯¼è‡´å´©æºƒã€‚</li></ul></blockquote><p>ï¼ˆ4ï¼‰ARC ä¸‹,ä¸æ˜¾å¼æŒ‡å®šä»»ä½•å±æ€§å…³é”®å­—æ—¶,é»˜è®¤çš„å…³é”®å­—éƒ½æœ‰å“ªäº›?</p><blockquote><ul><li>åŸºæœ¬æ•°æ®ï¼š  <code>atomic,readwrite,assign</code></li><li>æ™®é€šçš„ OC å¯¹è±¡: <code>atomic,readwrite,strong</code></li></ul></blockquote><p>ï¼ˆ5ï¼‰ç”¨@property å£°æ˜çš„ NSString(æˆ– NSArray,NSDictionary)ç»å¸¸ä½¿ç”¨ copy å…³é”®å­—,ä¸ºä»€ä¹ˆ?å¦‚æœæ”¹ç”¨ strong å…³é”®å­—,å¯èƒ½é€ æˆä»€ä¹ˆé—®é¢˜?</p><blockquote><p>å› ä¸ºçˆ¶ç±»æŒ‡é’ˆå¯ä»¥æŒ‡å‘å­ç±»å¯¹è±¡,ä½¿ç”¨ copy çš„ç›®çš„æ˜¯ä¸ºäº†è®©æœ¬å¯¹è±¡çš„å±æ€§ä¸å—å¤–ç•Œå½±å“,ä½¿ç”¨ copy æ— è®ºç»™æˆ‘ä¼ å…¥æ˜¯ä¸€ä¸ªå¯å˜å¯¹è±¡è¿˜æ˜¯ä¸å¯å¯¹è±¡,æˆ‘æœ¬èº«æŒæœ‰çš„å°±æ˜¯ä¸€ä¸ªä¸å¯å˜çš„å‰¯æœ¬.</p><p>å¦‚æœæˆ‘ä»¬ä½¿ç”¨æ˜¯ strong,é‚£ä¹ˆè¿™ä¸ªå±æ€§å°±æœ‰å¯èƒ½æŒ‡å‘ä¸€ä¸ªå¯å˜å¯¹è±¡,å¦‚æœè¿™ä¸ªå¯å˜å¯¹è±¡åœ¨å¤–éƒ¨è¢«ä¿®æ”¹äº†,é‚£ä¹ˆä¼šå½±å“è¯¥å±æ€§.</p></blockquote><p>ï¼ˆ6ï¼‰è¿™ä¸ªå†™æ³•ä¼šå‡ºä»€ä¹ˆé—®é¢˜: @property(copy)NSMutableArray *array;</p><blockquote><p>å› ä¸º copy ç­–ç•¥æ‹·è´å‡ºæ¥çš„æ˜¯ä¸€ä¸ªä¸å¯å˜å¯¹è±¡,ç„¶è€Œå´æŠŠå®ƒå½“æˆå¯å˜å¯¹è±¡ä½¿ç”¨,å¾ˆå®¹æ˜“é€ æˆç¨‹åºå¥”æºƒè¿™é‡Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜,è¯¥å±æ€§ä½¿ç”¨äº†åŒæ­¥é”,ä¼šåœ¨åˆ›å»ºæ—¶ç”Ÿæˆä¸€äº›é¢å¤–çš„ä»£ç ç”¨äºå¸®åŠ©ç¼–å†™å¤šçº¿ç¨‹ç¨‹åº,è¿™ä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜,é€šè¿‡å£°æ˜ nonatomic å¯ä»¥èŠ‚çœè¿™äº›è™½ç„¶<br>å¾ˆå°ä½†æ˜¯ä¸å¿…è¦é¢å¤–å¼€é”€,åœ¨ iOS å¼€å‘ä¸­åº”è¯¥ä½¿ç”¨ nonatomic æ›¿ä»£ atomic.</p></blockquote><p>ï¼ˆ7ï¼‰å¦‚ä½•è®©è‡ªå®šä¹‰ç±»å¯ä»¥ç”¨ copy ä¿®é¥°ç¬¦?å¦‚ä½•é‡å†™å¸¦ copy å…³é”®å­—çš„ setter?</p><blockquote><p>è‹¥æƒ³ä»¤è‡ªå·±æ‰€å†™çš„å¯¹è±¡å…·æœ‰æ‹·è´åŠŸèƒ½,åˆ™éœ€å®ç° NSCopying åè®®ã€‚</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; å®ç°ä¸å¯å˜ç‰ˆæœ¬æ‹·è´</span><br><span class="line">- (id)copyWithZone:(NSZone *)zone; &#x2F;&#x2F; å®ç°å¯å˜ç‰ˆæœ¬æ‹·è´</span><br><span class="line">- (id)mutableCopyWithZone:(NSZone *)zone;</span><br><span class="line">&#x2F;&#x2F; é‡å†™å¸¦ copy å…³é”®å­—çš„ setter</span><br><span class="line">- (void)setName:(NSString *)name &#123;</span><br><span class="line">    _name &#x3D; [name copy];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-æˆ‘ä»¬è¯´çš„Objective-Cæ˜¯åŠ¨æ€è¿è¡Œæ—¶è¯­è¨€æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ"><a href="#2-æˆ‘ä»¬è¯´çš„Objective-Cæ˜¯åŠ¨æ€è¿è¡Œæ—¶è¯­è¨€æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ" class="headerlink" title="2. æˆ‘ä»¬è¯´çš„Objective-Cæ˜¯åŠ¨æ€è¿è¡Œæ—¶è¯­è¨€æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ"></a>2. æˆ‘ä»¬è¯´çš„Objective-Cæ˜¯åŠ¨æ€è¿è¡Œæ—¶è¯­è¨€æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ</h4><blockquote><ul><li>åŠ¨æ€ç±»å‹ã€‚ å¦‚idç±»å‹ã€‚å®é™…ä¸Šé™æ€ç±»å‹å› ä¸ºå…¶å›ºå®šæ€§å’Œå¯é¢„çŸ¥æ€§è€Œä½¿ç”¨å¾—æ›´åŠ å¹¿æ³›ã€‚é™æ€ç±»å‹æ˜¯å¼ºç±»å‹ï¼Œè€ŒåŠ¨æ€ç±»å‹å±äºå¼±ç±»å‹ã€‚è¿è¡Œæ—¶å†³å®šæ¥æ”¶è€…ã€‚</li><li>åŠ¨æ€ç»‘å®šã€‚è®©ä»£ç åœ¨è¿è¡Œæ—¶åˆ¤æ–­éœ€è¦è°ƒç”¨ä»€ä¹ˆæ–¹æ³•ï¼Œè€Œä¸æ˜¯åœ¨ç¼–è¯‘æ—¶ã€‚ä¸å…¶ä»–é¢å‘å¯¹è±¡è¯­è¨€ä¸€æ ·ï¼Œæ–¹æ³•è°ƒç”¨å’Œä»£ç å¹¶æ²¡æœ‰åœ¨ç¼–è¯‘æ—¶è¿æ¥åœ¨ä¸€èµ·ï¼Œè€Œæ˜¯åœ¨æ¶ˆæ¯å‘é€æ—¶æ‰è¿›è¡Œè¿æ¥ã€‚è¿è¡Œæ—¶å†³å®šè°ƒç”¨å“ªä¸ªæ–¹æ³•ã€‚</li><li>åŠ¨æ€è½½å…¥ã€‚è®©ç¨‹åºåœ¨è¿è¡Œæ—¶æ·»åŠ ä»£ç æ¨¡å—ä»¥åŠå…¶ä»–èµ„æºã€‚ç”¨æˆ·å¯ä»¥æ ¹æ®éœ€è¦åŠ è½½ä¸€äº›å¯æ‰§è¡Œä»£ç å’Œèµ„æºï¼Œè€Œä¸æ˜¯åœ¨å¯åŠ¨æ—¶å°±åŠ è½½æ‰€æœ‰ç»„ä»¶ã€‚å¯æ‰§è¡Œä»£ç ä¸­å¯ä»¥å«æœ‰å’Œç¨‹åºè¿è¡Œæ—¶æ•´åˆçš„æ–°ç±»ã€‚</li></ul></blockquote><h4 id="3-è®²ä¸€ä¸‹MVCå’ŒMVVMï¼ŒMVPï¼Ÿ"><a href="#3-è®²ä¸€ä¸‹MVCå’ŒMVVMï¼ŒMVPï¼Ÿ" class="headerlink" title="3. è®²ä¸€ä¸‹MVCå’ŒMVVMï¼ŒMVPï¼Ÿ"></a>3. è®²ä¸€ä¸‹MVCå’ŒMVVMï¼ŒMVPï¼Ÿ</h4><ul><li>MVC:<blockquote><p>MVCå³Model-VIew-Controllerã€‚MVCæ¨¡å¼è‡´åŠ›äºå…³æ³¨ç‚¹çš„åˆ‡åˆ†ï¼Œè¿™æ„å‘³ç€modelå’Œcontrollerçš„é€»è¾‘æ˜¯ä¸ä¸ç”¨æˆ·ç•Œé¢ï¼ˆViewï¼‰æŒ‚é’©çš„ã€‚Modelå±‚ä»£è¡¨äº†æè¿°ä¸šåŠ¡é€»è¾‘å’Œæ•°æ®çš„ä¸€ç³»åˆ—ç±»çš„é›†åˆã€‚å®ƒä¹Ÿå®šä¹‰äº†æ•°æ®ä¿®æ”¹å’Œæ“ä½œçš„ä¸šåŠ¡è§„åˆ™ã€‚Viewä»£è¡¨äº†UIç»„ä»¶ï¼ŒåƒUIViewï¼ŒUIButtonï¼ŒUITableViewç­‰ã€‚ä»–åªè´Ÿè´£å±•ç¤ºä»controlleræ¥æ”¶åˆ°çš„æ•°æ®ã€‚å› æ­¤ï¼Œç»´æŠ¤å’Œæµ‹è¯•ç¨‹åºå˜å¾—æ›´åŠ ç®€å•å®¹æ˜“ã€‚ç„¶è€Œåœ¨Cocoaçš„MVCæ¨¡å¼ä¸­Controllerç»å¸¸è¢«æ··æ‚åœ¨Viewçš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œå› æ­¤å¾ˆéš¾è¯´Viewå’ŒViewControlleræ˜¯åˆ†ç¦»çš„ï¼Œè¿™ä¹Ÿå¾€å¾€é©±ä½¿äººä»¬å†™å‡ºè‡ƒè‚¿çš„è§†å›¾æ§åˆ¶å™¨ï¼Œå°½ç®¡ä»å¯ä»¥å°†ä¸šåŠ¡é€»è¾‘å’Œæ•°æ®è½¬æ¢åˆ°Modelï¼Œä½†æ˜¯å¤§å¤šæ•°æƒ…å†µä¸‹å½“éœ€è¦ä¸ºViewå‡è´Ÿçš„æ—¶å€™æˆ‘ä»¬å´æ— èƒ½ä¸ºåŠ›äº†ã€‚Viewçš„æœ€å¤§çš„ä»»åŠ¡å°±æ˜¯å‘Controllerä¼ é€’ç”¨æˆ·åŠ¨ä½œäº‹ä»¶ã€‚ViewControllerä¸å†æ‰¿æ‹…ä¸€åˆ‡ä»£ç†å’Œæ•°æ®æºçš„èŒè´£ï¼Œé€šå¸¸åªè´Ÿè´£ä¸€äº›åˆ†å‘å’Œå–æ¶ˆç½‘ç»œè¯·æ±‚ä»¥åŠä¸€äº›å…¶ä»–çš„ä»»åŠ¡ã€‚å½“åœ¨è¿›è¡Œå•å…ƒæµ‹è¯•çš„æ—¶å€™ä½ ä¼šå‘ç°é—®é¢˜è¶Šæ¥è¶Šæ˜æ˜¾ã€‚å› ä¸ºä½ çš„ViewControllerå’ŒViewæ˜¯ç´§å¯†è€¦åˆçš„ï¼Œå¯¹å®ƒä»¬è¿›è¡Œæµ‹è¯•å°±æ˜¾å¾—å¾ˆè‰°éš¾ã€‚Cocoa MVCçœ‹æ¥å¹¶ä¸æ˜¯æˆ‘ä»¬å®šä¹‰ä¸­ç†æƒ³çš„æ¶æ„æ¨¡å¼ã€‚</p></blockquote></li><li>MVVM:<blockquote><p>å³Model-View-View Modelã€‚è¿™ä¸ªæ¨¡å¼æä¾›å¯¹Viewå’ŒView Modelçš„åŒå‘æ•°æ®ç»‘å®šã€‚è¿™ä½¿å¾—View Modelçš„çŠ¶æ€æ”¹å˜å¯ä»¥è‡ªåŠ¨ä¼ é€’ç»™Viewã€‚å…¸å‹çš„æƒ…å†µæ˜¯ï¼ŒView Modelé€šè¿‡ä½¿ç”¨obseveræ¨¡å¼ï¼ˆè§‚å¯Ÿè€…æ¨¡å¼ï¼‰æ¥å°†View Modelçš„å˜åŒ–é€šçŸ¥ç»™modelã€‚View Modelè´Ÿè´£æš´æ¼æ–¹æ³•ï¼Œå‘½ä»¤ï¼Œå…¶ä»–å±æ€§æ¥æ“ä½œVIewçš„çŠ¶æ€ï¼Œç»„è£…modelä½œä¸ºViewåŠ¨ä½œçš„ç»“æœï¼Œå¹¶ä¸”è§¦å‘Viewè‡ªå·±çš„äº‹ä»¶ã€‚å®ƒå’ŒMVPæ¨¡å¼çœ‹èµ·æ¥éå¸¸åƒ:MVVMå°†ViewControllerè§†ä½œView,Viewå’ŒModelä¹‹é—´æ²¡æœ‰ç´§å¯†çš„è”ç³»ã€‚åœ¨ä½¿ç”¨MVVMæ¨¡å¼æ—¶ï¼Œè‡ªç„¶è€Œç„¶ä¼šæƒ³åˆ°ReactiveCocaï¼Œåä¹‹äº¦ç„¶ã€‚å°½ç®¡é€šè¿‡ç®€å•çš„ç»‘å®šæ¥ä½¿ç”¨MVVMæ˜¯å¯å®ç°çš„ï¼Œä½†æ˜¯ReactiveCocoaå´èƒ½æ›´å¥½çš„å‘æŒ¥MVVMæ¨¡å¼çš„ç‰¹ç‚¹ã€‚ä½†æ˜¯ä½¿ç”¨è¿™ä¸ªæ¡†æ¶æœ‰ä¸ªéš¾ä»¥å¿½ç•¥çš„äº‹å®ï¼šå½“ä½ åˆšå¼€å§‹ä½¿ç”¨ReactiveCocaçš„æ—¶å€™æœ‰å¾ˆå¤§çš„å¯èƒ½å°±ä¼šæŠŠäº‹æƒ…æç ¸ã€‚æ¢å¥è¯æ¥è¯´å°±æ˜¯ï¼Œå¦‚æœå‘ç°äº†ä¸€äº›é”™è¯¯ï¼Œå½“ä½ è¯•å›¾æŸ¥çœ‹å‡½æ•°è°ƒç”¨æ ˆæ—¶ä½ å¯èƒ½ä¼šå–Šï¼šâ€œå¤©å“ªï¼Œå¥½æ·±çš„å‡½æ•°è°ƒç”¨æ ˆâ€œï¼è°ƒè¯•å‡ºè¿™ä¸ªbugå¯èƒ½ä¼šèŠ±è´¹å¤§é‡çš„æ—¶é—´ã€‚MVVMå¾ˆè¯±äººï¼Œå› ä¸ºå®ƒé›†åˆäº†ä¸Šè¿°æ–¹æ³•çš„ä¼˜ç‚¹ï¼Œå¹¶ä¸”ç”±äºåœ¨Viewå±‚çš„ç»‘å®šï¼Œå®ƒå¹¶ä¸éœ€è¦å…¶ä»–é™„åŠ çš„ä»£ç æ¥æ›´æ–°Viewï¼Œå°½ç®¡è¿™æ ·ï¼Œå¯æµ‹è¯•æ€§ä¾ç„¶å¾ˆå¼ºâ€”â€”ç¬¦åˆæˆ‘ä»¬ç†æƒ³ä¸­å¥½æ¶æ„æ¨¡å¼çš„å®šä¹‰ã€‚</p></blockquote></li><li>MVP:<blockquote><p>è¿™ä¸ªæ¨¡å¼æŠŠPresenteræ¢æˆControllerå°±å’ŒMVCéå¸¸ç›¸åƒäº†ã€‚è¿™ä¸ªè®¾è®¡æ¨¡å¼æŠŠåº”ç”¨ç¨‹åºåˆ†æˆäº†3ä¸ªä¸»è¦æ–¹é¢ï¼šModelã€Viewå’ŒPresenter,å…¶ä¸­çš„Modelå’ŒViewä¸MVCæ¨¡ä¸­çš„è§’è‰²ç›¸åŒã€‚Presenterè´Ÿè´£å¤„ç†ViewèƒŒåæ‰€æœ‰çš„UIäº‹ä»¶ã€‚å®ƒé€šè¿‡Viewæ¥æ”¶ç”¨æˆ·è¾“å…¥ï¼Œä¹‹ååˆ©ç”¨Modelæ¥å¤„ç†ç”¨æˆ·çš„æ•°æ®ï¼Œæœ€åæŠŠç»“æœè¿”å›ç»™Viewã€‚ä¸Viewå’ŒControllerä¸åŒï¼ŒViewå’ŒPresenterä¹‹é—´æ˜¯å®Œå…¨è§£è€¦çš„ï¼Œä»–ä»¬é€šè¿‡æ¥å£æ¥äº¤äº’ã€‚å¦å¤–ï¼Œpresenterä¸åƒcontrollerå¤„ç†è¿›å…¥çš„è¯·æ±‚ã€‚è¿™ä¸æ˜¯æ­£è§£å†³äº†Cocoa MVCä¸­ViewControllerå’ŒViewçš„è€¦åˆé—®é¢˜å—ï¼Ÿå°±MVPæ¨¡å¼è€Œè¨€ï¼ŒUIViewControllerçš„å­ç±»å®é™…ä¸Šå°±æ˜¯Viewså¹¶ä¸æ˜¯Presentersã€‚è¿™ç‚¹åŒºåˆ«ä½¿å¾—è¿™ç§æ¨¡å¼çš„å¯æµ‹è¯•æ€§å¾—åˆ°äº†æå¤§çš„æé«˜ï¼Œä»˜å‡ºçš„ä»£ä»·æ˜¯å¼€å‘é€Ÿåº¦çš„ä¸€äº›é™ä½ï¼Œå› ä¸ºå¿…é¡»è¦åšä¸€äº›æ‰‹åŠ¨çš„æ•°æ®å’Œäº‹ä»¶ç»‘å®šã€‚ä½†æ˜¯è¿™ä¹Ÿæ„å‘³ç€æˆ‘ä»¬å°†æœ€ä¸»è¦çš„ä»»åŠ¡åˆ’åˆ†åˆ°Presenterå’ŒModelï¼Œè€ŒViewçš„åŠŸèƒ½è¾ƒå°‘â€”â€”å„ä¸ªå®ä½“ä»»åŠ¡é‡åˆ†é…ä¸å‡è¡¡ã€‚</p></blockquote></li></ul><h4 id="4-ä¸ºä»€ä¹ˆä»£ç†è¦ç”¨weakï¼Ÿä»£ç†çš„delegateå’ŒdataSourceæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿblockå’Œä»£ç†çš„åŒºåˆ«"><a href="#4-ä¸ºä»€ä¹ˆä»£ç†è¦ç”¨weakï¼Ÿä»£ç†çš„delegateå’ŒdataSourceæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿblockå’Œä»£ç†çš„åŒºåˆ«" class="headerlink" title="4. ä¸ºä»€ä¹ˆä»£ç†è¦ç”¨weakï¼Ÿä»£ç†çš„delegateå’ŒdataSourceæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿblockå’Œä»£ç†çš„åŒºåˆ«?"></a>4. ä¸ºä»€ä¹ˆä»£ç†è¦ç”¨weakï¼Ÿä»£ç†çš„delegateå’ŒdataSourceæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿblockå’Œä»£ç†çš„åŒºåˆ«?</h4><blockquote><ol><li>ä¸ºä»€ä¹ˆä»£ç†è¦ç”¨weak? <blockquote><p>é˜²æ­¢å¾ªç¯å¼•ç”¨ã€‚ä¾‹å¦‚Viewæœ‰ä¸€ä¸ªåè®®ï¼Œéœ€è¦ä¸€ä¸ªä»£ç†å®ç°å›è°ƒã€‚ä¸€ä¸ªControlleræ·»åŠ è¿™ä¸ªViewï¼Œå¹¶ä¸”éµå®ˆåè®®ï¼Œæˆä¸ºViewçš„ä»£ç†ã€‚å¦‚æœä¸ç”¨weekï¼Œç”¨strongï¼ŒController -&gt;View -&gt; delegate -&gt; Controllerï¼Œå°±å¾ªç¯å¼•ç”¨äº†ã€‚</p></blockquote></li><li>ä»£ç†çš„delegateå’ŒdataSourceæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ<blockquote><p> delegateåé‡äºä¸ç”¨æˆ·äº¤äº’çš„å›è°ƒï¼Œæœ‰é‚£äº›æ–¹æ³•å¯ä»¥ä¾›æˆ‘ä½¿ç”¨ï¼Œä¾‹å¦‚UITableviewDelegateï¼›dataSourceåé‡äºæ•°æ®çš„å›è°ƒï¼Œviewé‡Œé¢æœ‰ä»€ä¹ˆä¸œè¥¿ï¼Œå±æ€§éƒ½æ˜¯ä»€ä¹ˆï¼Œä¾‹å¦‚UITableviewDatasourceï¼›</p></blockquote></li><li>blockå’Œä»£ç†çš„åŒºåˆ«?<blockquote><p>ä»£ç†å’Œblockçš„å…±åŒç‰¹æ€§æ˜¯å›è°ƒæœºåˆ¶ï¼Œä¸åŒçš„æ˜¯ï¼Œä»£ç†çš„æ–¹æ³•æ¯”è¾ƒå¤šï¼Œæ¯”è¾ƒåˆ†æ•£ã€‚ä½¿ç”¨blockçš„ä»£ç æ¯”è¾ƒé›†ä¸­ç»Ÿä¸€ã€‚</p></blockquote></li></ol></blockquote><h4 id="5-å±æ€§çš„å®è´¨æ˜¯ä»€ä¹ˆï¼ŸåŒ…æ‹¬å“ªå‡ ä¸ªéƒ¨åˆ†ï¼Ÿå±æ€§é»˜è®¤çš„å…³é”®å­—éƒ½æœ‰å“ªäº›ï¼Ÿ-dynamicå…³é”®å­—å’Œ-synthesizeå…³é”®å­—æ˜¯ç”¨æ¥åšä»€ä¹ˆçš„ï¼Ÿ"><a href="#5-å±æ€§çš„å®è´¨æ˜¯ä»€ä¹ˆï¼ŸåŒ…æ‹¬å“ªå‡ ä¸ªéƒ¨åˆ†ï¼Ÿå±æ€§é»˜è®¤çš„å…³é”®å­—éƒ½æœ‰å“ªäº›ï¼Ÿ-dynamicå…³é”®å­—å’Œ-synthesizeå…³é”®å­—æ˜¯ç”¨æ¥åšä»€ä¹ˆçš„ï¼Ÿ" class="headerlink" title="5. å±æ€§çš„å®è´¨æ˜¯ä»€ä¹ˆï¼ŸåŒ…æ‹¬å“ªå‡ ä¸ªéƒ¨åˆ†ï¼Ÿå±æ€§é»˜è®¤çš„å…³é”®å­—éƒ½æœ‰å“ªäº›ï¼Ÿ@dynamicå…³é”®å­—å’Œ@synthesizeå…³é”®å­—æ˜¯ç”¨æ¥åšä»€ä¹ˆçš„ï¼Ÿ"></a>5. å±æ€§çš„å®è´¨æ˜¯ä»€ä¹ˆï¼ŸåŒ…æ‹¬å“ªå‡ ä¸ªéƒ¨åˆ†ï¼Ÿå±æ€§é»˜è®¤çš„å…³é”®å­—éƒ½æœ‰å“ªäº›ï¼Ÿ@dynamicå…³é”®å­—å’Œ@synthesizeå…³é”®å­—æ˜¯ç”¨æ¥åšä»€ä¹ˆçš„ï¼Ÿ</h4><blockquote><ol><li>@property = ivar + getter + setter; (å®ä¾‹å˜é‡+getæ–¹æ³•+ setæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´ä½¿ç”¨@propertyç³»ç»Ÿä¼šè‡ªåŠ¨ç”Ÿæˆsetterå’Œgetteræ–¹æ³•;) <br></li><li>@synthesize propertyName = _propertyName; (è¿™è¡Œä»£ç ä¼šåˆ›é€ ä¸€ä¸ªå¸¦ä¸‹åˆ’çº¿å‰ç¼€çš„å®ä¾‹å˜é‡åï¼ŒåŒæ—¶ä½¿ç”¨è¿™ä¸ªå±æ€§ç”Ÿæˆgetter å’Œ setter æ–¹æ³•ã€‚) <br></li><li>ç¦æ­¢@synthesize:å¦‚æœæŸå±æ€§å·²ç»åœ¨æŸå¤„å®ç°äº†è‡ªå·±çš„ setter/getter ,å¯ä»¥ä½¿ç”¨ @dynamic æ¥é˜»æ­¢ @synthesize è‡ªåŠ¨ç”Ÿæˆæ–°çš„ setter/getter è¦†ç›–ã€‚</li></ol></blockquote><h4 id="6-å±æ€§çš„é»˜è®¤å…³é”®å­—æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#6-å±æ€§çš„é»˜è®¤å…³é”®å­—æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="6. å±æ€§çš„é»˜è®¤å…³é”®å­—æ˜¯ä»€ä¹ˆï¼Ÿ"></a>6. å±æ€§çš„é»˜è®¤å…³é”®å­—æ˜¯ä»€ä¹ˆï¼Ÿ</h4><blockquote><p>åŸºæœ¬ç±»å‹ @property (atomic, assign) <br><br>å¯¹è±¡ç±»å‹ @property (atomic, strong)</p></blockquote><h4 id="7-NSStringä¸ºä»€ä¹ˆè¦ç”¨copyå…³é”®å­—ï¼Œå¦‚æœç”¨strongä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿï¼ˆæ³¨æ„ï¼šè¿™é‡Œæ²¡æœ‰è¯´ç”¨strongå°±ä¸€å®šä¸è¡Œã€‚ä½¿ç”¨copyå’Œstrongæ˜¯çœ‹æƒ…å†µè€Œå®šçš„ï¼‰"><a href="#7-NSStringä¸ºä»€ä¹ˆè¦ç”¨copyå…³é”®å­—ï¼Œå¦‚æœç”¨strongä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿï¼ˆæ³¨æ„ï¼šè¿™é‡Œæ²¡æœ‰è¯´ç”¨strongå°±ä¸€å®šä¸è¡Œã€‚ä½¿ç”¨copyå’Œstrongæ˜¯çœ‹æƒ…å†µè€Œå®šçš„ï¼‰" class="headerlink" title="7. NSStringä¸ºä»€ä¹ˆè¦ç”¨copyå…³é”®å­—ï¼Œå¦‚æœç”¨strongä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿï¼ˆæ³¨æ„ï¼šè¿™é‡Œæ²¡æœ‰è¯´ç”¨strongå°±ä¸€å®šä¸è¡Œã€‚ä½¿ç”¨copyå’Œstrongæ˜¯çœ‹æƒ…å†µè€Œå®šçš„ï¼‰"></a>7. NSStringä¸ºä»€ä¹ˆè¦ç”¨copyå…³é”®å­—ï¼Œå¦‚æœç”¨strongä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿï¼ˆæ³¨æ„ï¼šè¿™é‡Œæ²¡æœ‰è¯´ç”¨strongå°±ä¸€å®šä¸è¡Œã€‚ä½¿ç”¨copyå’Œstrongæ˜¯çœ‹æƒ…å†µè€Œå®šçš„ï¼‰</h4><blockquote><ol><li>å› ä¸ºçˆ¶ç±»æŒ‡é’ˆå¯ä»¥æŒ‡å‘å­ç±»å¯¹è±¡,ä½¿ç”¨copyçš„ç›®çš„æ˜¯ä¸ºäº†è®©æœ¬å¯¹è±¡çš„å±æ€§ä¸å—å¤–ç•Œå½±å“,ä½¿ç”¨copyæ— è®ºç»™æˆ‘ä¼ å…¥æ˜¯ä¸€ä¸ªå¯å˜å¯¹è±¡è¿˜æ˜¯ä¸å¯å¯¹è±¡,æˆ‘æœ¬èº«æŒæœ‰çš„å°±æ˜¯ä¸€ä¸ªä¸å¯å˜çš„å‰¯æœ¬.</li><li>å¦‚æœæˆ‘ä»¬ä½¿ç”¨æ˜¯strong,é‚£ä¹ˆè¿™ä¸ªå±æ€§å°±æœ‰å¯èƒ½æŒ‡å‘ä¸€ä¸ªå¯å˜å¯¹è±¡,å¦‚æœè¿™ä¸ªå¯å˜å¯¹è±¡åœ¨å¤–éƒ¨è¢«ä¿®æ”¹äº†,é‚£ä¹ˆä¼šå½±å“è¯¥å±æ€§.</li></ol></blockquote><h4 id="8-å¦‚ä½•ä»¤è‡ªå·±æ‰€å†™çš„å¯¹è±¡å…·æœ‰æ‹·è´åŠŸèƒ½"><a href="#8-å¦‚ä½•ä»¤è‡ªå·±æ‰€å†™çš„å¯¹è±¡å…·æœ‰æ‹·è´åŠŸèƒ½" class="headerlink" title="8. å¦‚ä½•ä»¤è‡ªå·±æ‰€å†™çš„å¯¹è±¡å…·æœ‰æ‹·è´åŠŸèƒ½?"></a>8. å¦‚ä½•ä»¤è‡ªå·±æ‰€å†™çš„å¯¹è±¡å…·æœ‰æ‹·è´åŠŸèƒ½?</h4><blockquote><ol><li>éœ€å£°æ˜è¯¥ç±»éµä» NSCopying åè®®</li><li>å®ç° NSCopying åè®®ã€‚è¯¥åè®®åªæœ‰ä¸€ä¸ªæ–¹æ³•: <code>- (id)copyWithZone:(NSZone *)zone;</code></li></ol></blockquote><h4 id="9-ç®€è¿°kvoã€kvcã€Delegateä»–ä»¬ä¹‹é—´çš„åŒºåˆ«ï¼Ÿ"><a href="#9-ç®€è¿°kvoã€kvcã€Delegateä»–ä»¬ä¹‹é—´çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="9. ç®€è¿°kvoã€kvcã€Delegateä»–ä»¬ä¹‹é—´çš„åŒºåˆ«ï¼Ÿ"></a>9. ç®€è¿°kvoã€kvcã€Delegateä»–ä»¬ä¹‹é—´çš„åŒºåˆ«ï¼Ÿ</h4><blockquote><ol><li>KVOï¼ˆKey-Value- Observingï¼‰ï¼šä¸€å¯¹å¤š, è§‚å¯Ÿè€…æ¨¡å¼, æ˜¯é”®å€¼ç›‘å¬,é”®å€¼è§‚å¯Ÿæœºåˆ¶, KVOçš„æœ¬è´¨æ˜¯å½“è§‚å¯Ÿè€…ä¸ºä¸€ä¸ªå¯¹è±¡çš„å±æ€§è¿›è¡Œäº†æ³¨å†Œï¼Œè¢«è§‚å¯Ÿå¯¹è±¡çš„isaæŒ‡é’ˆè¢«ä¿®æ”¹çš„æ—¶å€™ï¼ŒisaæŒ‡é’ˆå°±ä¼šæŒ‡å‘ä¸€ä¸ªä¸­é—´ç±»ï¼Œè€Œä¸æ˜¯çœŸå®çš„ç±»ã€‚æ‰€ä»¥ isaæŒ‡é’ˆå…¶å®ä¸éœ€è¦æŒ‡å‘å®ä¾‹å¯¹è±¡çœŸå®çš„ç±»ã€‚æ‰€ä»¥æˆ‘ä»¬çš„ç¨‹åºæœ€å¥½ä¸è¦ä¾èµ–äºisaæŒ‡é’ˆã€‚åœ¨è°ƒç”¨ç±»çš„æ–¹æ³•çš„æ—¶å€™ï¼Œæœ€å¥½è¦æ˜ç¡®å¯¹è±¡å®ä¾‹çš„ç±»åã€‚</li><li>KVC(Key-Value-Coding)å†…éƒ¨çš„å®ç°ï¼šæ˜¯é”®å€¼ç¼–ç , ä¸€ä¸ªå¯¹è±¡åœ¨è°ƒç”¨setValueçš„æ—¶å€™ï¼Œï¼ˆ1ï¼‰é¦–å…ˆæ ¹æ®æ–¹æ³•åæ‰¾åˆ°è¿è¡Œæ–¹æ³•çš„æ—¶å€™æ‰€éœ€è¦çš„ç¯ å¢ƒå‚æ•°ã€‚ï¼ˆ2ï¼‰ä»–ä¼šä»è‡ªå·±isaæŒ‡é’ˆç»“åˆç¯å¢ƒå‚æ•°ï¼Œæ‰¾åˆ°å…·ä½“çš„æ–¹æ³•å®ç°çš„æ¥å£ã€‚ï¼ˆ3ï¼‰å†ç›´æ¥æŸ¥æ‰¾å¾—æ¥çš„å…·ä½“çš„æ–¹æ³•å®ç°ã€‚</li><li>Delegate: é€šå¸¸å‘é€è€…å’Œæ¥æ”¶è€…çš„å…³ç³»æ˜¯ç›´æ¥çš„ä¸€å¯¹ä¸€çš„å…³ç³»ã€‚ä»£ç†çš„ç›®çš„æ˜¯æ”¹å˜æˆ–ä¼ é€’æ§åˆ¶é“¾ã€‚å…è®¸ä¸€ä¸ªç±»åœ¨æŸäº›ç‰¹å®šæ—¶åˆ»é€šçŸ¥åˆ°å…¶ä»–ç±»ï¼Œè€Œä¸éœ€è¦è·å–åˆ°é‚£äº›ç±»çš„æŒ‡é’ˆã€‚å¯ä»¥å‡å°‘æ¡†æ¶å¤æ‚åº¦ã€‚æ¶ˆæ¯çš„å‘é€è€…(sender)å‘ŠçŸ¥æ¥æ”¶è€…(receiver)æŸä¸ªäº‹ä»¶å°†è¦å‘ç”Ÿï¼ŒdelegateåŒæ„ç„¶ç„¶åå‘é€è€…å“åº”äº‹ä»¶ï¼Œdelegateæœºåˆ¶ä½¿å¾—æ¥æ”¶è€…å¯ä»¥æ”¹å˜å‘é€è€…çš„è¡Œä¸ºã€‚</li><li>Notification: è§‚å¯Ÿè€…æ¨¡å¼, é€šå¸¸å‘é€è€…å’Œæ¥æ”¶è€…çš„å…³ç³»æ˜¯é—´æ¥çš„å¤šå¯¹å¤šå…³ç³»ã€‚ æ¶ˆæ¯çš„å‘é€è€…å‘ŠçŸ¥æ¥æ”¶è€…äº‹ä»¶å·²ç»å‘ç”Ÿæˆ–è€…å°†è¦å‘é€ï¼Œä»…æ­¤è€Œå·²ï¼Œæ¥æ”¶è€…å¹¶ä¸èƒ½åè¿‡æ¥å½±å“å‘é€è€…çš„è¡Œä¸ºã€‚<blockquote><p>(1) æ•ˆç‡è‚¯å®šæ˜¯delegateæ¯”NSNotificationé«˜ã€‚<br></p><p>(2) delegateæ–¹æ³•æ¯”notificationæ›´åŠ ç›´æ¥ï¼Œæœ€å…¸å‹çš„ç‰¹å¾æ˜¯ï¼Œdelegateæ–¹æ³•å¾€å¾€éœ€è¦å…³æ³¨è¿”å›å€¼ï¼Œä¹Ÿå°±æ˜¯delegateæ–¹æ³•çš„ç»“æœã€‚æ¯”å¦‚-windowShouldClose:ï¼Œéœ€è¦å…³å¿ƒè¿”å›çš„æ˜¯yesè¿˜æ˜¯noã€‚æ‰€ä»¥delegateæ–¹æ³•å¾€å¾€åŒ…å«shouldè¿™ä¸ªå¾ˆä¼ ç¥çš„è¯ã€‚ä¹Ÿå°±æ˜¯å¥½æ¯”ä½ åšæˆ‘çš„delegateï¼Œæˆ‘ä¼šé—®ä½ æˆ‘æƒ³å…³é—­çª—å£ä½ æ„¿æ„å—ï¼Ÿä½ éœ€è¦ç»™æˆ‘ä¸€ä¸ªç­”æ¡ˆï¼Œæˆ‘æ ¹æ®ä½ çš„ç­”æ¡ˆæ¥å†³å®šå¦‚ä½•åšä¸‹ä¸€æ­¥ã€‚ç›¸åçš„ï¼Œnotificationæœ€å¤§çš„ç‰¹è‰²å°±æ˜¯ä¸å…³å¿ƒæ¥å—è€…çš„æ€åº¦ï¼Œæˆ‘åªç®¡æŠŠé€šå‘Šæ”¾å‡ºæ¥ï¼Œä½ æ¥å—ä¸æ¥å—å°±æ˜¯ä½ çš„äº‹æƒ…ï¼ŒåŒæ—¶æˆ‘ä¹Ÿä¸å…³å¿ƒç»“æœã€‚æ‰€ä»¥notificationå¾€å¾€ç”¨didè¿™ä¸ªè¯æ±‡ï¼Œæ¯”å¦‚NSWindowDidResizeNotificationï¼Œé‚£ä¹ˆnswindowå¯¹è±¡æ”¾å‡ºè¿™ä¸ªnotificationåå°±ä»€ä¹ˆéƒ½ä¸ç®¡äº†ä¹Ÿä¸ä¼šç­‰å¾…æ¥å—è€…çš„ååº”ã€‚</p></blockquote></li></ol></blockquote><h4 id="10-includeä¸-importçš„åŒºåˆ«ï¼Ÿ-importä¸-classçš„åŒºåˆ«ï¼Ÿ"><a href="#10-includeä¸-importçš„åŒºåˆ«ï¼Ÿ-importä¸-classçš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="10. includeä¸#importçš„åŒºåˆ«ï¼Ÿ#importä¸@classçš„åŒºåˆ«ï¼Ÿ"></a>10. includeä¸#importçš„åŒºåˆ«ï¼Ÿ#importä¸@classçš„åŒºåˆ«ï¼Ÿ</h4><blockquote><ol><li>#importæŒ‡ä»¤æ˜¯Object-Cé’ˆå¯¹@includeçš„æ”¹è¿›ç‰ˆæœ¬ï¼Œèƒ½ç¡®ä¿å¼•ç”¨çš„æ–‡ä»¶åªä¼šè¢«å¼•ç”¨ä¸€æ¬¡ï¼Œä¸ä¼šé™·å…¥é€’å½’åŒ…å«çš„é—®é¢˜ä¸­ï¼›</li><li>@importä¸@classçš„åŒºåˆ«ï¼š<blockquote><p>#importä¼šé“¾å…¥è¯¥å¤´æ–‡ä»¶çš„å…¨éƒ¨ä¿¡æ¯ï¼ŒåŒ…æ‹¬å®ä½“å˜é‡å’Œæ–¹æ³•ç­‰ï¼›äºŒ@classåªæ˜¯å‘Šè¯‰ç¼–è¯‘å™¨ï¼Œå…¶åé¢å£°æ˜çš„åç§°æ˜¯ç±»çš„åç§°ï¼Œè‡³äºè¿™äº›ç±»å¦‚ä½•å®šä¹‰çš„ï¼Œæš‚æ—¶ä¸ç”¨è€ƒè™‘ã€‚åœ¨å¤´æ–‡ä»¶ä¸­ï¼Œä¸€èˆ¬åªéœ€è¦çŸ¥é“è¢«å¼•ç”¨çš„ç±»çš„åç§°å°±å¯ä»¥äº†ï¼Œä¸éœ€è¦çŸ¥é“å…¶å†…éƒ¨çš„å®ä½“å˜é‡å’Œæ–¹æ³•ï¼Œæ‰€ä»¥åœ¨å¤´æ–‡ä»¶ä¸­ä¸€èˆ¬ä½¿ç”¨@classæ¥å£°æ˜è¿™ä¸ªåç§°æ˜¯ç±»çš„åç§°ï¼›è€Œåœ¨å®ç°ç±»é‡Œé¢ï¼Œå› ä¸ºä¼šç”¨åˆ°è¿™ä¸ªå¼•ç”¨ç±»çš„å†…éƒ¨çš„å®ä½“å˜é‡å’Œæ–¹æ³•ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨#importç±»åŒ…å«è¿™ä¸ªè¢«å¼•ç”¨ç±»çš„å¤´æ–‡ä»¶ã€‚@classè¿˜å¯ä»¥è§£å†³å¾ªç¯åŒ…å«çš„é—®é¢˜</p></blockquote></li><li>#import&lt;&gt;è·Ÿ#importâ€â€çš„åŒºåˆ«ï¼š<blockquote><p>#import&lt;&gt;ç”¨æ¥åŒ…å«ç³»ç»Ÿè‡ªå¸¦çš„æ–‡ä»¶ï¼Œ#importâ€â€ç”¨æ¥åŒ…å«è‡ªå®šä¹‰çš„æ–‡ä»¶</p></blockquote></li></ol></blockquote><h4 id="11-nonatomicå’Œatomicçš„åŒºåˆ«ï¼Ÿatomicæ˜¯ç»å¯¹çš„çº¿ç¨‹å®‰å…¨ä¹ˆï¼Ÿä¸ºä»€ä¹ˆï¼Ÿå¦‚æœä¸æ˜¯ï¼Œé‚£åº”è¯¥å¦‚ä½•å®ç°ï¼Ÿ"><a href="#11-nonatomicå’Œatomicçš„åŒºåˆ«ï¼Ÿatomicæ˜¯ç»å¯¹çš„çº¿ç¨‹å®‰å…¨ä¹ˆï¼Ÿä¸ºä»€ä¹ˆï¼Ÿå¦‚æœä¸æ˜¯ï¼Œé‚£åº”è¯¥å¦‚ä½•å®ç°ï¼Ÿ" class="headerlink" title="11. nonatomicå’Œatomicçš„åŒºåˆ«ï¼Ÿatomicæ˜¯ç»å¯¹çš„çº¿ç¨‹å®‰å…¨ä¹ˆï¼Ÿä¸ºä»€ä¹ˆï¼Ÿå¦‚æœä¸æ˜¯ï¼Œé‚£åº”è¯¥å¦‚ä½•å®ç°ï¼Ÿ"></a>11. nonatomicå’Œatomicçš„åŒºåˆ«ï¼Ÿatomicæ˜¯ç»å¯¹çš„çº¿ç¨‹å®‰å…¨ä¹ˆï¼Ÿä¸ºä»€ä¹ˆï¼Ÿå¦‚æœä¸æ˜¯ï¼Œé‚£åº”è¯¥å¦‚ä½•å®ç°ï¼Ÿ</h4><blockquote><ol><li>nonatomicå’Œatomicçš„åŒºåˆ«<blockquote><p>nonatomicå’Œatomicç”¨æ¥å†³å®šç¼–è¯‘å™¨ç”Ÿæˆçš„getterå’Œsetteræ“ä½œæ˜¯å¦ä¸ºåŸå­æ“ä½œã€‚</p></blockquote></li><li>atomicæ˜¯ç»å¯¹çš„çº¿ç¨‹å®‰å…¨ä¹ˆï¼Ÿ<blockquote><p>atomicä¸æ˜¯ç»å¯¹çš„çº¿ç¨‹å®‰å…¨ã€‚atomicçš„æœ¬æ„æ˜¯æŒ‡å±æ€§çš„å­˜å–æ–¹æ³•æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¹¶ä¸ä¿è¯æ•´ä¸ªå¯¹è±¡æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚å¦‚ï¼š<br>å£°æ˜ä¸€ä¸ªNSMutableArrayçš„åŸå­å±æ€§stuffï¼Œæ­¤æ—¶self.stuff å’Œ self.stuff = otherstufféƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä½†æ˜¯ä½¿ç”¨[self.stuff objectAtIndex:index]å°±ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚éœ€è¦ç”¨äº’æ–¥é”æ¥ä¿è¯çº¿ç¨‹å®‰å…¨æ€§ã€‚</p></blockquote></li><li>å¦‚ä½•å®ç°çº¿ç¨‹å®‰å…¨<blockquote><p>ä½¿ç”¨çº¿ç¨‹é”</p></blockquote></li></ol></blockquote><h4 id="12-UICollectionViewè‡ªå®šä¹‰layoutå¦‚ä½•å®ç°ï¼Ÿ"><a href="#12-UICollectionViewè‡ªå®šä¹‰layoutå¦‚ä½•å®ç°ï¼Ÿ" class="headerlink" title="12. UICollectionViewè‡ªå®šä¹‰layoutå¦‚ä½•å®ç°ï¼Ÿ"></a>12. UICollectionViewè‡ªå®šä¹‰layoutå¦‚ä½•å®ç°ï¼Ÿ</h4><blockquote><ol><li><code>-(void)prepareLayout;</code> æ–¹æ³•é‡å†™ï¼Œå¹¶è®¾ç½®åˆå§‹æ ·å¼</li><li><code>- (CGRect)collectionViewContentSize;</code> æ–¹æ³•é‡å†™ï¼Œ å¹¶ä½¿ç”¨å®ƒæ¥è¿”å›CollectionViewè§†å›¾å†…å®¹çš„å®½é«˜ï¼Œ</li><li>å››ä¸ªæ–¹æ³•æ¥ç¡®å®šå¸ƒå±€ä¿¡æ¯<blockquote><ul><li><p><code>- (NSArray&lt;__kindof UICollectionViewLayoutAttributes *&gt; *)layoutAttributesForElementsInRect:(CGRect)rect;</code></p></li><li><p><code>- (UICollectionViewLayoutAttributes *)layoutAttributesForItemAtIndexPath:(NSIndexPath *)indexPath;</code></p></li><li><p><code>- (UICollectionViewLayoutAttributes *)layoutAttributesForSupplementaryViewOfKind:(NSString *)elementKind atIndexPath:(NSIndexPath *)indexPath;</code></p></li><li><p><code>- (UICollectionViewLayoutAttributes *)layoutAttributesForDecorationViewOfKind:(NSString*)elementKind atIndexPath:(NSIndexPath *)indexPath;</code></p></li></ul></blockquote></li><li><code>- (BOOL)shouldInvalidateLayoutForBoundsChange:(CGRect)newBounds;</code>å¦‚æœè¿”å›YESï¼Œé‚£ä¹ˆcollectionViewæ˜¾ç¤ºçš„èŒƒå›´å‘ç”Ÿæ”¹å˜æ—¶ï¼Œå°±ä¼šé‡æ–°åˆ·æ–°å¸ƒå±€</li></ol></blockquote><h4 id="13-è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«ï¼ŸåŒæ­¥å¼‚æ­¥çš„åŒºåˆ«ï¼Ÿå¹¶è¡Œå’Œå¹¶å‘çš„åŒºåˆ«ï¼Ÿ"><a href="#13-è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«ï¼ŸåŒæ­¥å¼‚æ­¥çš„åŒºåˆ«ï¼Ÿå¹¶è¡Œå’Œå¹¶å‘çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="13. è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«ï¼ŸåŒæ­¥å¼‚æ­¥çš„åŒºåˆ«ï¼Ÿå¹¶è¡Œå’Œå¹¶å‘çš„åŒºåˆ«ï¼Ÿ"></a>13. è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«ï¼ŸåŒæ­¥å¼‚æ­¥çš„åŒºåˆ«ï¼Ÿå¹¶è¡Œå’Œå¹¶å‘çš„åŒºåˆ«ï¼Ÿ</h4><blockquote><ol><li>è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«<blockquote><ul><li>è¿›ç¨‹æ˜¯èµ„æºçš„åˆ†é…å’Œè°ƒåº¦çš„ä¸€ä¸ªç‹¬ç«‹å•å…ƒï¼Œè€Œçº¿ç¨‹æ˜¯CPUè°ƒåº¦çš„åŸºæœ¬å•å…ƒ</li><li>åŒä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥åŒ…æ‹¬å¤šä¸ªçº¿ç¨‹ï¼Œå¹¶ä¸”çº¿ç¨‹å…±äº«æ•´ä¸ªè¿›ç¨‹çš„èµ„æºï¼ˆå¯„å­˜å™¨ã€å †æ ˆã€ä¸Šä¸‹æ–‡ï¼‰ï¼Œä¸€ä¸ªè¿›è¡Œè‡³å°‘åŒ…æ‹¬ä¸€ä¸ªçº¿ç¨‹ã€‚</li><li>è¿›ç¨‹çš„åˆ›å»ºè°ƒç”¨forkæˆ–è€…vforkï¼Œè€Œçº¿ç¨‹çš„åˆ›å»ºè°ƒç”¨pthread_createï¼Œè¿›ç¨‹ç»“æŸåå®ƒæ‹¥æœ‰çš„æ‰€æœ‰çº¿ç¨‹éƒ½å°†é”€æ¯ï¼Œè€Œçº¿ç¨‹çš„ç»“æŸä¸ä¼šå½±å“åŒä¸ªè¿›ç¨‹ä¸­çš„å…¶ä»–çº¿ç¨‹çš„ç»“æŸ</li><li>çº¿ç¨‹æ˜¯è½»ä¸¤çº§çš„è¿›ç¨‹ï¼Œå®ƒçš„åˆ›å»ºå’Œé”€æ¯æ‰€éœ€è¦çš„æ—¶é—´æ¯”è¿›ç¨‹å°å¾ˆå¤šï¼Œæ‰€æœ‰æ“ä½œç³»ç»Ÿä¸­çš„æ‰§è¡ŒåŠŸèƒ½éƒ½æ˜¯åˆ›å»ºçº¿ç¨‹å»å®Œæˆçš„</li><li>çº¿ç¨‹ä¸­æ‰§è¡Œæ—¶ä¸€èˆ¬éƒ½è¦è¿›è¡ŒåŒæ­¥å’Œäº’æ–¥ï¼Œå› ä¸ºä»–ä»¬å…±äº«åŒä¸€è¿›ç¨‹çš„æ‰€æœ‰èµ„æº</li><li>çº¿ç¨‹æœ‰è‡ªå·±çš„ç§æœ‰å±æ€§TCBï¼Œçº¿ç¨‹idï¼Œå¯„å­˜å™¨ã€ç¡¬ä»¶ä¸Šä¸‹æ–‡ï¼Œè€Œè¿›ç¨‹ä¹Ÿæœ‰è‡ªå·±çš„ç§æœ‰å±æ€§è¿›ç¨‹æ§åˆ¶å—PCBï¼Œè¿™äº›ç§æœ‰å±æ€§æ˜¯ä¸è¢«å…±äº«çš„ï¼Œç”¨æ¥æ ‡ç¤ºä¸€ä¸ªè¿›ç¨‹æˆ–ä¸€ä¸ªçº¿ç¨‹çš„æ ‡å¿—</li></ul></blockquote></li><li>åŒæ­¥å’Œå¼‚æ­¥çš„åŒºåˆ«<blockquote><ul><li>åŒæ­¥(synchronous)ï¼šè¿›ç¨‹ä¹‹é—´çš„å…³ç³»ä¸æ˜¯ç›¸äº’æ’æ–¥ä¸´ç•Œèµ„æºçš„å…³ç³»ï¼Œè€Œæ˜¯ç›¸äº’ä¾èµ–çš„å…³ç³»ã€‚è¿›ä¸€æ­¥çš„è¯´æ˜ï¼šå°±æ˜¯å‰ä¸€ä¸ªè¿›ç¨‹çš„è¾“å‡ºä½œä¸ºåä¸€ä¸ªè¿›ç¨‹çš„è¾“å…¥ï¼Œå½“ç¬¬ä¸€ä¸ªè¿›ç¨‹æ²¡æœ‰è¾“å‡ºæ—¶ç¬¬äºŒä¸ªè¿›ç¨‹å¿…é¡»ç­‰å¾…ã€‚å…·æœ‰åŒæ­¥å…³ç³»çš„ä¸€ç»„å¹¶å‘è¿›ç¨‹ç›¸äº’å‘é€çš„ä¿¡æ¯ç§°ä¸ºæ¶ˆæ¯æˆ–äº‹ä»¶ã€‚</li><li>å¼‚æ­¥(asynchronous)ï¼šå¼‚æ­¥å’ŒåŒæ­¥æ˜¯ç›¸å¯¹çš„ï¼ŒåŒæ­¥å°±æ˜¯é¡ºåºæ‰§è¡Œï¼Œæ‰§è¡Œå®Œä¸€ä¸ªå†æ‰§è¡Œä¸‹ä¸€ä¸ªï¼Œéœ€è¦ç­‰å¾…ã€åè°ƒè¿è¡Œã€‚å¼‚æ­¥å°±æ˜¯å½¼æ­¤ç‹¬ç«‹,åœ¨ç­‰å¾…æŸäº‹ä»¶çš„è¿‡ç¨‹ä¸­ç»§ç»­åšè‡ªå·±çš„äº‹ï¼Œä¸éœ€è¦ç­‰å¾…è¿™ä¸€äº‹ä»¶å®Œæˆåå†å·¥ä½œã€‚çº¿ç¨‹å°±æ˜¯å®ç°å¼‚æ­¥çš„ä¸€ä¸ªæ–¹å¼ã€‚å¼‚æ­¥æ˜¯è®©è°ƒç”¨æ–¹æ³•çš„ä¸»çº¿ç¨‹ä¸éœ€è¦åŒæ­¥ç­‰å¾…å¦ä¸€çº¿ç¨‹çš„å®Œæˆï¼Œä»è€Œå¯ä»¥è®©ä¸»çº¿ç¨‹å¹²å…¶å®ƒçš„äº‹æƒ…ã€‚</li></ul></blockquote></li><li>å¹¶è¡Œå’Œå¹¶å‘çš„åŒºåˆ«<blockquote><ul><li>å¹¶å‘ï¼šåœ¨æ“ä½œç³»ç»Ÿä¸­ï¼Œæ˜¯æŒ‡ä¸€ä¸ªæ—¶é—´æ®µä¸­æœ‰å‡ ä¸ªç¨‹åºéƒ½å¤„äºå·²å¯åŠ¨è¿è¡Œåˆ°è¿è¡Œå®Œæ¯•ä¹‹é—´ï¼Œä¸”è¿™ä¸ªå‡ ä¸ªç¨‹åºéƒ½æ˜¯åœ¨åŒä¸€ä¸ªå¤„ç†æœºä¸Šè¿è¡Œã€‚å…¶ä¸­ä¸¤ç§å¹¶å‘å…³ç³»åˆ†åˆ«æ˜¯åŒæ­¥å’Œäº’æ–¥ã€‚ <blockquote><ol><li>äº’æ–¥ï¼šè¿›ç¨‹é—´ç›¸äº’æ’æ–¥çš„ä½¿ç”¨ä¸´ç•Œèµ„æºçš„ç°è±¡</li><li>åŒæ­¥ï¼šè¿›ç¨‹ä¹‹é—´çš„å…³ç³»ä¸æ˜¯ç›¸äº’æ’æ–¥ä¸´ç•Œèµ„æºçš„å…³ç³»ï¼Œè€Œæ˜¯ç›¸äº’ä¾èµ–çš„å…³ç³»ã€‚è¿›ä¸€æ­¥è¯´æ˜å°±æ˜¯å‰ä¸€ä¸ªè¿›ç¨‹çš„è¾“å‡ºä½œä¸ºåä¸€ä¸ªè¿›ç¨‹çš„è¾“å…¥ï¼Œå½“ç¬¬ä¸€ä¸ªè¿›ç¨‹æ²¡æœ‰è¾“å‡ºæ—¶ç¬¬äºŒä¸ªè¿›ç¨‹å¿…é¡»ç­‰å¾…ã€‚å…·æœ‰åŒæ­¥å…³ç³»çš„ä¸€ç»„å¹¶å‘è¿›ç¨‹ç›¸äº’å‘é€çš„ä¿¡æ¯ç§°ä¸ºæ¶ˆæ¯æˆ–äº‹ä»¶ã€‚<br>å…¶ä¸­å¹¶å‘åˆæœ‰ä¼ªå¹¶å‘å’ŒçœŸå¹¶å‘ï¼Œä¼ªå¹¶å‘æ˜¯æŒ‡å•æ ¸å¤„ç†å™¨çš„å¹¶å‘ï¼ŒçœŸå¹¶å‘æ˜¯æŒ‡å¤šæ ¸å¤„ç†å™¨çš„å¹¶å‘ã€‚</li></ol></blockquote></li><li>å¹¶è¡Œ(parallelism)ï¼šåœ¨å•å¤„ç†å™¨ä¸­å¤šé“ç¨‹åºè®¾è®¡ç³»ç»Ÿä¸­ï¼Œè¿›ç¨‹è¢«äº¤æ›¿æ‰§è¡Œï¼Œè¡¨ç°å‡ºä¸€ç§å¹¶å‘çš„å¤–éƒ¨ç‰¹ç§ï¼›åœ¨å¤šå¤„ç†å™¨ç³»ç»Ÿä¸­ï¼Œè¿›ç¨‹ä¸ä»…å¯ä»¥äº¤æ›¿æ‰§è¡Œï¼Œè€Œä¸”å¯ä»¥é‡å æ‰§è¡Œã€‚åœ¨å¤šå¤„ç†å™¨ä¸Šçš„ç¨‹åºæ‰å¯å®ç°å¹¶è¡Œå¤„ç†ã€‚ä»è€Œå¯çŸ¥ï¼Œå¹¶è¡Œæ˜¯é’ˆå¯¹å¤šå¤„ç†å™¨è€Œè¨€çš„ã€‚å¹¶è¡Œæ˜¯åŒæ—¶å‘ç”Ÿçš„å¤šä¸ªå¹¶å‘äº‹ä»¶ï¼Œå…·æœ‰å¹¶å‘çš„å«ä¹‰ï¼Œä½†å¹¶å‘ä¸ä¸€å®šå¹¶è¡Œï¼Œä¹Ÿäº¦æ˜¯è¯´å¹¶å‘äº‹ä»¶ä¹‹é—´ä¸ä¸€å®šè¦åŒä¸€æ—¶åˆ»å‘ç”Ÿã€‚ </li></ul></blockquote></li></ol></blockquote><h4 id="14-çº¿ç¨‹é—´é€šä¿¡ï¼Ÿ"><a href="#14-çº¿ç¨‹é—´é€šä¿¡ï¼Ÿ" class="headerlink" title="14. çº¿ç¨‹é—´é€šä¿¡ï¼Ÿ"></a>14. çº¿ç¨‹é—´é€šä¿¡ï¼Ÿ</h4><blockquote><ol><li><code>NSThread</code><blockquote><ol><li><code>- (void)performSelectorOnMainThread:(SEL)aSelector withObject:(nullable id)arg waitUntilDone:(BOOL)wait;</code></li><li><code>- (void)performSelector:(SEL)aSelector onThread:(NSThread *)thr withObject:(nullable id)arg waitUntilDone:(BOOL)wait;</code></li></ol></blockquote></li><li><code>CGD</code><blockquote><p> dispatch_async(dispatch_get_global_queue(0, 0), ^{â€¦});</p></blockquote></li></ol></blockquote><h4 id="15-GCDçš„ä¸€äº›å¸¸ç”¨çš„å‡½æ•°ï¼Ÿï¼ˆgroupï¼Œbarrierï¼Œä¿¡å·é‡ï¼Œçº¿ç¨‹åŒæ­¥ï¼‰"><a href="#15-GCDçš„ä¸€äº›å¸¸ç”¨çš„å‡½æ•°ï¼Ÿï¼ˆgroupï¼Œbarrierï¼Œä¿¡å·é‡ï¼Œçº¿ç¨‹åŒæ­¥ï¼‰" class="headerlink" title="15. GCDçš„ä¸€äº›å¸¸ç”¨çš„å‡½æ•°ï¼Ÿï¼ˆgroupï¼Œbarrierï¼Œä¿¡å·é‡ï¼Œçº¿ç¨‹åŒæ­¥ï¼‰"></a>15. GCDçš„ä¸€äº›å¸¸ç”¨çš„å‡½æ•°ï¼Ÿï¼ˆgroupï¼Œbarrierï¼Œä¿¡å·é‡ï¼Œçº¿ç¨‹åŒæ­¥ï¼‰</h4><h4 id="16-å¦‚ä½•è®¿é—®å¹¶ä¿®æ”¹ä¸€ä¸ªç±»çš„ç§æœ‰å±æ€§ï¼Ÿ"><a href="#16-å¦‚ä½•è®¿é—®å¹¶ä¿®æ”¹ä¸€ä¸ªç±»çš„ç§æœ‰å±æ€§ï¼Ÿ" class="headerlink" title="16. å¦‚ä½•è®¿é—®å¹¶ä¿®æ”¹ä¸€ä¸ªç±»çš„ç§æœ‰å±æ€§ï¼Ÿ"></a>16. å¦‚ä½•è®¿é—®å¹¶ä¿®æ”¹ä¸€ä¸ªç±»çš„ç§æœ‰å±æ€§ï¼Ÿ</h4><blockquote><ol><li>KVO + KVC</li><li>runtime (class_copyIvarList, object_setIvar)</li></ol></blockquote><h4 id="17-æ•°æ®æŒä¹…åŒ–çš„å‡ ä¸ªæ–¹æ¡ˆï¼ˆfmdbç”¨æ²¡ç”¨è¿‡ï¼‰"><a href="#17-æ•°æ®æŒä¹…åŒ–çš„å‡ ä¸ªæ–¹æ¡ˆï¼ˆfmdbç”¨æ²¡ç”¨è¿‡ï¼‰" class="headerlink" title="17. æ•°æ®æŒä¹…åŒ–çš„å‡ ä¸ªæ–¹æ¡ˆï¼ˆfmdbç”¨æ²¡ç”¨è¿‡ï¼‰"></a>17. æ•°æ®æŒä¹…åŒ–çš„å‡ ä¸ªæ–¹æ¡ˆï¼ˆfmdbç”¨æ²¡ç”¨è¿‡ï¼‰</h4><blockquote><ol><li>CoreData</li><li>Sqlite 3</li><li>FMDB ï¼ˆSqlite 3å°è£…ï¼‰</li><li>é’¥åŒ™ä¸²</li><li>NSUserDefualt</li><li>NSKeyedArchiver</li><li>NSCache</li><li>æ²™ç›’</li></ol></blockquote><h4 id="18-è¯´ä¸€ä¸‹AppDelegateçš„å‡ ä¸ªæ–¹æ³•ï¼Ÿä»åå°åˆ°å‰å°è°ƒç”¨äº†å“ªäº›æ–¹æ³•ï¼Ÿç¬¬ä¸€æ¬¡å¯åŠ¨è°ƒç”¨äº†å“ªäº›æ–¹æ³•ï¼Ÿä»å‰å°åˆ°åå°è°ƒç”¨äº†å“ªäº›æ–¹æ³•ï¼Ÿ"><a href="#18-è¯´ä¸€ä¸‹AppDelegateçš„å‡ ä¸ªæ–¹æ³•ï¼Ÿä»åå°åˆ°å‰å°è°ƒç”¨äº†å“ªäº›æ–¹æ³•ï¼Ÿç¬¬ä¸€æ¬¡å¯åŠ¨è°ƒç”¨äº†å“ªäº›æ–¹æ³•ï¼Ÿä»å‰å°åˆ°åå°è°ƒç”¨äº†å“ªäº›æ–¹æ³•ï¼Ÿ" class="headerlink" title="18. è¯´ä¸€ä¸‹AppDelegateçš„å‡ ä¸ªæ–¹æ³•ï¼Ÿä»åå°åˆ°å‰å°è°ƒç”¨äº†å“ªäº›æ–¹æ³•ï¼Ÿç¬¬ä¸€æ¬¡å¯åŠ¨è°ƒç”¨äº†å“ªäº›æ–¹æ³•ï¼Ÿä»å‰å°åˆ°åå°è°ƒç”¨äº†å“ªäº›æ–¹æ³•ï¼Ÿ"></a>18. è¯´ä¸€ä¸‹AppDelegateçš„å‡ ä¸ªæ–¹æ³•ï¼Ÿä»åå°åˆ°å‰å°è°ƒç”¨äº†å“ªäº›æ–¹æ³•ï¼Ÿç¬¬ä¸€æ¬¡å¯åŠ¨è°ƒç”¨äº†å“ªäº›æ–¹æ³•ï¼Ÿä»å‰å°åˆ°åå°è°ƒç”¨äº†å“ªäº›æ–¹æ³•ï¼Ÿ</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">1.å½“åº”ç”¨ç¨‹åºå°†è¦è¿›å…¥éæ´»åŠ¨çŠ¶æ€æ‰§è¡Œï¼Œåœ¨æ­¤æœŸé—´ï¼Œåº”ç”¨ç¨‹åºä¸æ¥å—æ¶ˆæ¯æˆ–äº‹ä»¶ï¼Œæ¯”å¦‚æ¥ç”µ</span><br><span class="line"></span><br><span class="line">- (void)applicationWillResignActive:(UIApplication *)application &#123;</span><br><span class="line">    NSLog(@&quot;åº”ç”¨ç¨‹åºå°†è¦è¿›å…¥éæ´»åŠ¨çŠ¶æ€ï¼Œå³å°†è¿›å…¥åå°&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">2.åº”ç”¨ç¨‹åºå·²ç»è¿›å…¥åå°è¿è¡Œ</span><br><span class="line"></span><br><span class="line">- (void)applicationDidEnterBackground:(UIApplication *)application &#123;</span><br><span class="line">    NSLog(@&quot;å¦‚æœåº”ç”¨ç¨‹åºæ”¯æŒåå°è¿è¡Œï¼Œåˆ™åº”ç”¨ç¨‹åºå·²ç»è¿›å…¥åå°è¿è¡Œ&quot;); &#x2F;&#x2F;å¦‚æœéœ€è¦é€€å‡ºåå°,åˆ™åœ¨è¿™é‡ŒåŠ ä¸Š:exit(0);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">3.åº”ç”¨ç¨‹åºå°†è¦è¿›å…¥æ´»åŠ¨çŠ¶æ€æ‰§è¡Œ</span><br><span class="line"></span><br><span class="line">- (void)applicationWillEnterForeground:(UIApplication *)application &#123;</span><br><span class="line">    NSLog(@&quot;åº”ç”¨ç¨‹åºå°†è¦è¿›å…¥æ´»åŠ¨çŠ¶æ€ï¼Œå³å°†è¿›å…¥å‰å°è¿è¡Œ&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">4.åº”ç”¨ç¨‹åºå·²ç»è¿›å…¥æ´»åŠ¨çŠ¶æ€</span><br><span class="line"></span><br><span class="line">- (void)applicationDidBecomeActive:(UIApplication *)application &#123;</span><br><span class="line">    NSLog(@&quot;åº”ç”¨ç¨‹åºå·²è¿›å…¥å‰å°ï¼Œå¤„äºæ´»åŠ¨çŠ¶æ€&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">5.åº”ç”¨ç¨‹åºå°†è¦é€€å‡ºï¼Œé€šå¸¸ç”¨äºä¿å­˜æ•°æ®å’Œä¸€äº›é€€å‡ºå‰çš„æ¸…ç†å·¥ä½œ</span><br><span class="line"></span><br><span class="line">- (void)applicationWillTerminate:(UIApplication *)application &#123;</span><br><span class="line">    NSLog(@&quot;åº”ç”¨ç¨‹åºå°†è¦é€€å‡ºï¼Œé€šå¸¸ç”¨äºä¿å­˜æ•°æ®å’Œä¸€äº›é€€å‡ºå‰çš„æ¸…ç†å·¥ä½œ&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">6.å½“è®¾å¤‡ä¸ºåº”ç”¨ç¨‹åºåˆ†é…äº†å¤ªå¤šçš„å†…å­˜ï¼Œæ“ä½œç³»ç»Ÿä¼šç»ˆæ­¢åº”ç”¨ç¨‹åºçš„è¿è¡Œï¼Œåœ¨ç»ˆæ­¢å‰ä¼šæ‰§è¡Œè¿™ä¸ªæ–¹æ³•ï¼Œé€šå¸¸å¯ä»¥åœ¨è¿™é‡Œè¿›è¡Œå†…å­˜æ¸…ç†å·¥ä½œï¼Œé˜²æ­¢ç¨‹åºè¢«ç»ˆæ­¢</span><br><span class="line"></span><br><span class="line">- (void)applicationDidReceiveMemoryWarning:(UIApplication *)application &#123;</span><br><span class="line">    NSLog(@&quot;ç³»ç»Ÿå†…å­˜ä¸è¶³ï¼Œéœ€è¦è¿›è¡Œæ¸…ç†å·¥ä½œ&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">7.å½“ç³»ç»Ÿæ—¶é—´å‘ç”Ÿæ”¹å˜æ—¶æ‰§è¡Œ</span><br><span class="line"></span><br><span class="line">- (void)applicationSignificantTimeChange:(UIApplication *)application &#123;</span><br><span class="line">    NSLog(@&quot;å½“ç³»ç»Ÿæ—¶é—´å‘ç”Ÿæ”¹å˜æ—¶æ‰§è¡Œ&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">8.æ¨é€æ¶ˆæ¯æ—¶ï¼Œè·å–è®¾å¤‡çš„tokenid</span><br><span class="line"></span><br><span class="line">- (void)application:(UIApplication *)application didRegisterForRemoteNotificationsWithDeviceToken:(NSData *)deviceToken &#123;</span><br><span class="line">    NSLog(@&quot;%@&quot;,deviceToken);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">9.tokenidè·å–å¤±è´¥æ—¶,åšç›¸åº”å¤„ç†</span><br><span class="line"></span><br><span class="line">- (void)application:(UIApplication *)app didFailToRegisterForRemoteNotificationsWithError:(NSError *)error &#123;</span><br><span class="line">    NSLog(@&quot;fail to register for remoteNotifications: %@&quot;, [err description]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">10.æ¥æ”¶åˆ°æ¨é€æ¶ˆæ¯å¤„ç†</span><br><span class="line"></span><br><span class="line">- (void)application:(UIApplication *)application didReceiveRemoteNotification:(NSDictionary *)userInfo &#123;</span><br><span class="line">    &#x2F;&#x2F;è®¾ç½®iconä¸Šçš„æ ‡è®°æ•°å­—è®¾ç½®ä¸º0ï¼›</span><br><span class="line">    &#x2F;&#x2F;application.applicationIconBadgeNumber &#x3D; 0;</span><br><span class="line">    NSLog(@&quot;%@&quot;,userInfo);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">11.å½“ç¨‹åºè½½å…¥åæ‰§è¡Œ</span><br><span class="line"></span><br><span class="line">- (void)applicationDidFinishLaunching:(UIApplication *)application &#123;</span><br><span class="line">    NSLog(@&quot;å½“ç¨‹åºè½½å…¥åæ‰§è¡Œ&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="19-NSCacheä¼˜äºNSDictionaryçš„å‡ ç‚¹ï¼Ÿ"><a href="#19-NSCacheä¼˜äºNSDictionaryçš„å‡ ç‚¹ï¼Ÿ" class="headerlink" title="19. NSCacheä¼˜äºNSDictionaryçš„å‡ ç‚¹ï¼Ÿ"></a>19. NSCacheä¼˜äºNSDictionaryçš„å‡ ç‚¹ï¼Ÿ</h4><blockquote><p>NSCache æ˜¯ä¸€ä¸ªå®¹å™¨ç±»ï¼Œç±»ä¼¼äºNSDIctionary,é€šè¿‡key-value å½¢å¼å­˜å‚¨å’ŒæŸ¥è¯¢å€¼ï¼Œç”¨äºä¸´æ—¶å­˜å‚¨å¯¹è±¡ã€‚</p><p>æ³¨æ„ä¸€ç‚¹å®ƒå’ŒNSDictionaryåŒºåˆ«å°±æ˜¯ï¼ŒNSCache ä¸­çš„keyä¸å¿…å®ç°copyï¼ŒNSDictionaryä¸­çš„keyå¿…é¡»å®ç°copy</p><p>NSCacheä¸­å­˜å‚¨çš„å¯¹è±¡ä¹Ÿä¸å¿…å®ç°NSCodingåè®®ï¼Œå› ä¸ºæ¯•ç«Ÿæ˜¯ä¸´æ—¶å­˜å‚¨ï¼Œç±»ä¼¼äºå†…å­˜ç¼“å­˜ï¼Œç¨‹åºé€€å‡ºåå°±è¢«é‡Šæ”¾äº†ã€‚</p></blockquote><h4 id="20-çŸ¥ä¸çŸ¥é“Designated-Initializerï¼Ÿä½¿ç”¨å®ƒçš„æ—¶å€™æœ‰ä»€ä¹ˆéœ€è¦æ³¨æ„çš„é—®é¢˜ï¼Ÿ"><a href="#20-çŸ¥ä¸çŸ¥é“Designated-Initializerï¼Ÿä½¿ç”¨å®ƒçš„æ—¶å€™æœ‰ä»€ä¹ˆéœ€è¦æ³¨æ„çš„é—®é¢˜ï¼Ÿ" class="headerlink" title="20. çŸ¥ä¸çŸ¥é“Designated Initializerï¼Ÿä½¿ç”¨å®ƒçš„æ—¶å€™æœ‰ä»€ä¹ˆéœ€è¦æ³¨æ„çš„é—®é¢˜ï¼Ÿ"></a>20. çŸ¥ä¸çŸ¥é“Designated Initializerï¼Ÿä½¿ç”¨å®ƒçš„æ—¶å€™æœ‰ä»€ä¹ˆéœ€è¦æ³¨æ„çš„é—®é¢˜ï¼Ÿ</h4><h4 id="21-å®ç°descriptionæ–¹æ³•èƒ½å–åˆ°ä»€ä¹ˆæ•ˆæœï¼Ÿ"><a href="#21-å®ç°descriptionæ–¹æ³•èƒ½å–åˆ°ä»€ä¹ˆæ•ˆæœï¼Ÿ" class="headerlink" title="21. å®ç°descriptionæ–¹æ³•èƒ½å–åˆ°ä»€ä¹ˆæ•ˆæœï¼Ÿ"></a>21. å®ç°descriptionæ–¹æ³•èƒ½å–åˆ°ä»€ä¹ˆæ•ˆæœï¼Ÿ</h4><blockquote><p>å¯ä»¥è¾“å‡ºå¯¹è±¡å†…éƒ¨çš„ä¸€äº›æˆå˜é‡çš„å€¼</p></blockquote><h4 id="22-objcä½¿ç”¨ä»€ä¹ˆæœºåˆ¶ç®¡ç†å¯¹è±¡å†…å­˜ï¼Ÿ"><a href="#22-objcä½¿ç”¨ä»€ä¹ˆæœºåˆ¶ç®¡ç†å¯¹è±¡å†…å­˜ï¼Ÿ" class="headerlink" title="22. objcä½¿ç”¨ä»€ä¹ˆæœºåˆ¶ç®¡ç†å¯¹è±¡å†…å­˜ï¼Ÿ"></a>22. objcä½¿ç”¨ä»€ä¹ˆæœºåˆ¶ç®¡ç†å¯¹è±¡å†…å­˜ï¼Ÿ</h4><blockquote><p>ARC (automatic reference counting)<br>MRC (manual retain-release)</p></blockquote><h2 id="Block"><a href="#Block" class="headerlink" title="Block"></a>Block</h2><ol><li>blockçš„å®è´¨æ˜¯ä»€ä¹ˆï¼Ÿä¸€å…±æœ‰å‡ ç§blockï¼Ÿéƒ½æ˜¯ä»€ä¹ˆæƒ…å†µä¸‹ç”Ÿæˆçš„ï¼Ÿ</li><li>ä½¿ç”¨ç³»ç»Ÿçš„æŸäº›block apiï¼Œæ˜¯å¦è€ƒè™‘å¼•ç”¨å¾ªç¯é—®é¢˜ï¼Ÿ</li><li>è°ˆè°ˆblockçš„ç†è§£ï¼Ÿå¹¶å†™å‡ºä¸€ä¸ªä½¿ç”¨blockæ‰§è¡ŒUIVewåŠ¨ç”»ï¼Ÿ</li></ol><h2 id="Runtime"><a href="#Runtime" class="headerlink" title="Runtime"></a>Runtime</h2><ol><li>runtimeå¦‚ä½•å®ç°weakå±æ€§ï¼Ÿ</li><li>runtimeå¦‚ä½•é€šè¿‡selectoræ‰¾åˆ°å¯¹åº”çš„IMPåœ°å€ï¼Ÿ</li><li>èƒ½å¦å‘ç¼–è¯‘åå¾—åˆ°çš„ç±»ä¸­å¢åŠ å®ä¾‹å˜é‡ï¼Ÿèƒ½å¦å‘è¿è¡Œæ—¶åˆ›å»ºçš„ç±»ä¸­æ·»åŠ å®ä¾‹å˜é‡ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</li><li>runtimeå¦‚ä½•å®ç°weakå˜é‡çš„è‡ªåŠ¨ç½®nilï¼Ÿ</li><li>åœ¨å¼€å‘ä¸­å¦‚ä½•ä½¿ç”¨runtimeï¼Ÿä»€ä¹ˆåº”ç”¨åœºæ™¯ï¼Ÿ</li></ol><h2 id="ç±»ç»“æ„"><a href="#ç±»ç»“æ„" class="headerlink" title="ç±»ç»“æ„"></a>ç±»ç»“æ„</h2><ol><li>isaæŒ‡é’ˆï¼Ÿï¼ˆå¯¹è±¡çš„isaï¼Œç±»å¯¹è±¡çš„isaï¼Œå…ƒç±»çš„isaéƒ½è¦è¯´ï¼‰</li><li>ç±»æ–¹æ³•å’Œå®ä¾‹æ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</li><li>ä»‹ç»ä¸€ä¸‹åˆ†ç±»ï¼Œèƒ½ç”¨åˆ†ç±»åšä»€ä¹ˆï¼Ÿå†…éƒ¨æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿå®ƒä¸ºä»€ä¹ˆä¼šè¦†ç›–æ‰åŸæ¥çš„æ–¹æ³•ï¼Ÿ</li><li>è¿è¡Œæ—¶èƒ½å¢åŠ æˆå‘˜å˜é‡ä¹ˆï¼Ÿèƒ½å¢åŠ å±æ€§ä¹ˆï¼Ÿå¦‚æœèƒ½ï¼Œå¦‚ä½•å¢åŠ ï¼Ÿå¦‚æœä¸èƒ½ï¼Œä¸ºä»€ä¹ˆï¼Ÿ</li><li>objcä¸­å‘ä¸€ä¸ªnilå¯¹è±¡å‘é€æ¶ˆæ¯å°†ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿï¼ˆè¿”å›å€¼æ˜¯å¯¹è±¡ï¼Œæ˜¯æ ‡é‡ï¼Œç»“æ„ä½“ï¼‰</li></ol><h2 id="é«˜çº§"><a href="#é«˜çº§" class="headerlink" title="é«˜çº§"></a>é«˜çº§</h2><ol><li>UITableviewçš„ä¼˜åŒ–æ–¹æ³•ï¼ˆç¼“å­˜é«˜åº¦ï¼Œå¼‚æ­¥ç»˜åˆ¶ï¼Œå‡å°‘å±‚çº§ï¼Œhideï¼Œé¿å…ç¦»å±æ¸²æŸ“ï¼‰</li><li>æœ‰æ²¡æœ‰ç”¨è¿‡è¿è¡Œæ—¶ï¼Œç”¨å®ƒéƒ½èƒ½åšä»€ä¹ˆï¼Ÿï¼ˆäº¤æ¢æ–¹æ³•ï¼Œåˆ›å»ºç±»ï¼Œç»™æ–°åˆ›å»ºçš„ç±»å¢åŠ æ–¹æ³•ï¼Œæ”¹å˜isaæŒ‡é’ˆï¼‰</li><li>çœ‹è¿‡å“ªäº›ç¬¬ä¸‰æ–¹æ¡†æ¶çš„æºç ï¼Ÿéƒ½æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿï¼ˆå¦‚æœæ²¡æœ‰ï¼Œé—®ä¸€ä¸‹å¤šå›¾ä¸‹è½½çš„è®¾è®¡ï¼‰</li><li>SDWebImageçš„ç¼“å­˜ç­–ç•¥ï¼Ÿ</li><li>AFNä¸ºä»€ä¹ˆæ·»åŠ ä¸€æ¡å¸¸é©»çº¿ç¨‹ï¼Ÿ</li><li>KVOçš„ä½¿ç”¨ï¼Ÿå®ç°åŸç†ï¼Ÿï¼ˆä¸ºä»€ä¹ˆè¦åˆ›å»ºå­ç±»æ¥å®ç°ï¼‰</li><li>KVCçš„ä½¿ç”¨ï¼Ÿå®ç°åŸç†ï¼Ÿï¼ˆKVCæ‹¿åˆ°keyä»¥åï¼Œæ˜¯å¦‚ä½•èµ‹å€¼çš„ï¼ŸçŸ¥ä¸çŸ¥é“é›†åˆæ“ä½œç¬¦ï¼Œèƒ½ä¸èƒ½è®¿é—®ç§æœ‰å±æ€§ï¼Œèƒ½ä¸èƒ½ç›´æ¥è®¿é—®_ivarï¼‰</li></ol><h2 id="iOSçš„æ²™ç›’ç›®å½•ç»“æ„"><a href="#iOSçš„æ²™ç›’ç›®å½•ç»“æ„" class="headerlink" title="iOSçš„æ²™ç›’ç›®å½•ç»“æ„"></a>iOSçš„æ²™ç›’ç›®å½•ç»“æ„</h2><ol><li>AppName.app</li><li>Documents</li><li>Library â€“&gt; 3.1 Preferences 3.2 Caches</li><li>tmp</li></ol>]]></content>
      
      
      <categories>
          
          <category> é¢è¯•é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¢è¯•æŠ€å·§ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iOSé¢è¯•é¢˜-005</title>
      <link href="/2020/01/16/iOS%E9%9D%A2%E8%AF%95%E9%A2%98-005/"/>
      <url>/2020/01/16/iOS%E9%9D%A2%E8%AF%95%E9%A2%98-005/</url>
      
        <content type="html"><![CDATA[<h2 id="åŸºç¡€é¢è¯•é¢˜"><a href="#åŸºç¡€é¢è¯•é¢˜" class="headerlink" title="åŸºç¡€é¢è¯•é¢˜"></a>åŸºç¡€é¢è¯•é¢˜</h2><h3 id="ä¸€ã€ä¸¤ç§æ‹·è´çš„å·®åˆ«"><a href="#ä¸€ã€ä¸¤ç§æ‹·è´çš„å·®åˆ«" class="headerlink" title="ä¸€ã€ä¸¤ç§æ‹·è´çš„å·®åˆ«"></a>ä¸€ã€ä¸¤ç§æ‹·è´çš„å·®åˆ«</h3><ul><li><p>æµ…æ‹·è´ï¼šæŒ‡é’ˆï¼ˆåœ°å€ï¼‰æ‹·è´ï¼Œä¸ä¼šäº§ç”Ÿæ–°å¯¹è±¡</p></li><li><p>æ·±æ‹·è´ï¼šå†…å®¹æ‹·è´ï¼Œä¼šäº§ç”Ÿæ–°å¯¹è±¡</p></li></ul><h3 id="äºŒã€Categoryå’ŒExtensionçš„å·®åˆ«"><a href="#äºŒã€Categoryå’ŒExtensionçš„å·®åˆ«" class="headerlink" title="äºŒã€Categoryå’ŒExtensionçš„å·®åˆ«"></a>äºŒã€Categoryå’ŒExtensionçš„å·®åˆ«</h3><ul><li><p>åˆ†ç±»æ˜¯æœ‰åç§°çš„ï¼Œç±»æ‰©å±•æ²¡æœ‰åç§°</p></li><li><p>åˆ†ç±»åªèƒ½æ‰©å……æ–¹æ³•ã€ä¸èƒ½æ‰©å……æˆå‘˜å˜é‡ï¼ˆéœ€è¦åˆ©ç”¨RunTimeé‡å†™setã€getæ–¹æ³•ï¼‰ï¼›ç±»æ‰©å±•å¯ä»¥æ‰©å……æ–¹æ³•å’Œæˆå‘˜å˜é‡</p></li><li><p>ç±»æ‰©å±•ä¸€èˆ¬å°±å†™åœ¨.mæ–‡ä»¶ä¸­ï¼Œç”¨æ¥æ‰©å……ç§æœ‰çš„æ–¹æ³•å’Œæˆå‘˜å˜é‡ï¼ˆå±æ€§ï¼‰</p></li></ul><h3 id="ä¸‰ã€KVOå’ŒKVCçš„å·®åˆ«"><a href="#ä¸‰ã€KVOå’ŒKVCçš„å·®åˆ«" class="headerlink" title="ä¸‰ã€KVOå’ŒKVCçš„å·®åˆ«"></a>ä¸‰ã€KVOå’ŒKVCçš„å·®åˆ«</h3><ul><li>KVCæ˜¯é”®å€¼ç¼–ç ï¼Œå¯ä»¥é€šè¿‡ä¸€ä¸ªå­—ç¬¦ä¸²çš„keyï¼ˆå±æ€§åï¼‰ä¿®æ”¹å¯¹è±¡çš„å±æ€§å€¼</li><li></li><li>KVOæ˜¯é”®å€¼ç›‘å¬ï¼Œå¯ä»¥ç›‘å¬ä¸€ä¸ªå¯¹è±¡å±æ€§å€¼çš„æ”¹å˜</li></ul><h3 id="å››ã€propertyå±æ€§ä»‹ç»"><a href="#å››ã€propertyå±æ€§ä»‹ç»" class="headerlink" title="å››ã€propertyå±æ€§ä»‹ç»"></a>å››ã€propertyå±æ€§ä»‹ç»</h3><ul><li><p>copyæ˜¯åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œä¸¤ä¸ªå¯¹è±¡å†…å®¹ç›¸åŒï¼Œæ—§å¯¹è±¡æ²¡æœ‰å˜åŒ–ã€‚æ–°çš„å¯¹è±¡retainä¸º1ï¼Œä¸æ—§æœ‰å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¸å˜ã€‚æ—§å¯¹è±¡å‘ç”Ÿæ”¹å˜ä¸å½±å“æ–°å¯¹è±¡ï¼Œcopyå‡å°‘å¯¹è±¡å¯¹ä¸Šä¸‹æ–‡çš„ä¾èµ–ã€‚NSStringã€Blockç­‰ç±»å‹</p></li><li><p>retainå±æ€§è¡¨ç¤ºä¸¤ä¸ªå¯¹è±¡åœ°å€ç›¸åŒï¼ˆå»ºç«‹ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡é’ˆæ‹·è´ï¼‰ï¼Œå†…å®¹ç›¸åŒï¼Œè¿™ä¸ªå¯¹è±¡çš„retainå€¼+1ã€‚ä¸¤ä¸ªå¯¹è±¡è¦æ”¹å˜å°±ä¸€èµ·æ”¹å˜ã€‚</p></li><li><p>weakå…¶å®ç±»ä¼¼äºassignï¼Œå«å¼±å¼•ç”¨ï¼Œä¹Ÿæ˜¯ä¸å¢åŠ å¼•ç”¨è®¡æ•°ã€‚ä¸€èˆ¬åªæœ‰åœ¨é˜²æ­¢å¾ªç¯å¼•ç”¨æ—¶ä½¿ç”¨ï¼Œæ¯”å¦‚çˆ¶ç±»å¼•ç”¨äº†å­ç±»ï¼Œå­ç±»åˆå»å¼•ç”¨çˆ¶ç±»ã€‚IBOutletã€Delegateä¸€èˆ¬ç”¨çš„å°±æ˜¯weakï¼Œè¿™æ˜¯å› ä¸ºå®ƒä»¬ä¼šåœ¨ç±»å¤–éƒ¨è¢«è°ƒç”¨ï¼Œé˜²æ­¢å¾ªç¯å¼•ç”¨ã€‚</p></li><li><p>assignï¼šéOCå¯¹è±¡ç±»å‹ï¼Œ åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆä¸¤ä¸ªå¯¹è±¡ç›¸äº’å¼•ç”¨çš„æ—¶å€™ï¼Œä¸€ç«¯ç”¨retainï¼Œ ä¸€ç«¯ç”¨assignï¼‰</p></li><li><p>strongå°±ç±»ä¼¼ä¸retainäº†ï¼Œå«å¼ºå¼•ç”¨ï¼Œä¼šå¢åŠ å¼•ç”¨è®¡æ•°ï¼Œç±»å†…éƒ¨ä½¿ç”¨çš„å±æ€§ä¸€èˆ¬éƒ½æ˜¯strongä¿®é¥°çš„ï¼Œç°åœ¨ARCå·²ç»åŸºæœ¬æ›¿ä»£äº†MRCï¼Œæ‰€ä»¥æˆ‘ä»¬æœ€å¸¸è§çš„å°±æ˜¯strongäº†ã€‚retainï¼šOCå¯¹è±¡ç±»å‹</p></li><li><p>nonatomic åœ¨ä¿®é¥°å±æ€§æ—¶ï¼Œæˆ‘ä»¬å¾€å¾€è¿˜ä¼šåŠ ä¸€ä¸ªnonatomicï¼Œè¿™åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå®ƒçš„åå­—å«éåŸå­è®¿é—®ã€‚å¯¹åº”çš„æœ‰atomicï¼Œæ˜¯åŸå­æ€§çš„è®¿é—®ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨ä½¿ç”¨å¤šçº¿ç¨‹æ—¶ä¸ºäº†é¿å…åœ¨å†™æ“ä½œæ—¶åŒæ—¶è¿›è¡Œå†™å¯¼è‡´é—®é¢˜ï¼Œç»å¸¸ä¼šå¯¹è¦å†™çš„å¯¹è±¡è¿›è¡ŒåŠ é”ï¼Œä¹Ÿå°±æ˜¯åŒä¸€æ—¶åˆ»åªå…è®¸ä¸€ä¸ªçº¿ç¨‹å»æ“ä½œå®ƒã€‚å¦‚æœä¸€ä¸ªå±æ€§æ˜¯ç”±atomicä¿®é¥°çš„ï¼Œé‚£ä¹ˆç³»ç»Ÿå°±ä¼šè¿›è¡Œçº¿ç¨‹ä¿æŠ¤ï¼Œé˜²æ­¢å¤šä¸ªå†™æ“ä½œåŒæ—¶è¿›è¡Œã€‚è¿™æœ‰å¥½å¤„ï¼Œä½†ä¹Ÿæœ‰åå¤„ï¼Œé‚£å°±æ˜¯æ¶ˆè€—ç³»ç»Ÿèµ„æºï¼Œæ‰€ä»¥å¯¹äºiPhoneè¿™ç§å°å‹è®¾å¤‡ï¼Œå¦‚æœä¸æ˜¯è¿›è¡Œå¤šçº¿ç¨‹çš„å†™æ“ä½œï¼Œå°±å¯ä»¥ä½¿ç”¨nonatomicï¼Œå–æ¶ˆçº¿ç¨‹ä¿æŠ¤ï¼Œæé«˜æ€§èƒ½ã€‚</p></li></ul><h3 id="äº”ã€ä»£ç†ï¼Œé€šçŸ¥ï¼Œå’Œblockçš„åŒºåˆ«"><a href="#äº”ã€ä»£ç†ï¼Œé€šçŸ¥ï¼Œå’Œblockçš„åŒºåˆ«" class="headerlink" title="äº”ã€ä»£ç†ï¼Œé€šçŸ¥ï¼Œå’Œblockçš„åŒºåˆ«"></a>äº”ã€ä»£ç†ï¼Œé€šçŸ¥ï¼Œå’Œblockçš„åŒºåˆ«</h3><ul><li><p>é€šçŸ¥ï¼šNotificationCenter é€šçŸ¥ä¸­å¿ƒï¼šâ€œä¸€å¯¹å¤šâ€ï¼Œåœ¨APPä¸­ï¼Œå¾ˆå¤šæ§åˆ¶å™¨éƒ½éœ€è¦çŸ¥é“ä¸€ä¸ªäº‹ä»¶ï¼Œåº”è¯¥ç”¨é€šçŸ¥ï¼›</p></li><li><p>ä»£ç†ï¼šä¸€å¯¹ä¸€â€ï¼Œå¯¹åŒä¸€ä¸ªåè®®ï¼Œä¸€ä¸ªå¯¹è±¡åªèƒ½è®¾ç½®ä¸€ä¸ªä»£ç†delegateï¼Œæ‰€ä»¥å•ä¾‹å¯¹è±¡å°±ä¸èƒ½ç”¨ä»£ç†ï¼›ä»£ç†æ›´æ³¨é‡è¿‡ç¨‹ä¿¡æ¯çš„ä¼ è¾“ï¼šæ¯”å¦‚å‘èµ·ä¸€ä¸ªç½‘ç»œè¯·æ±‚ï¼Œå¯èƒ½æƒ³è¦çŸ¥é“æ­¤æ—¶è¯·æ±‚æ˜¯å¦å·²ç»å¼€å§‹ã€æ˜¯å¦æ”¶åˆ°äº†æ•°æ®ã€æ•°æ®æ˜¯å¦å·²ç»æ¥å—å®Œæˆã€æ•°æ®æ¥æ”¶å¤±è´¥</p></li><li><p>blockï¼šdelegateä¸€æ ·ï¼Œä¸€èˆ¬éƒ½æ˜¯â€œä¸€å¯¹ä¸€â€ä¹‹é—´é€šä¿¡äº¤äº’ï¼Œç›¸æ¯”ä»£ç†blockæœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><pre><code>1ã€å†™æ³•æ›´ç®€ç»ƒï¼Œä¸éœ€è¦å†™protocolã€å‡½æ•°ç­‰ç­‰2ã€blockæ³¨é‡ç»“æœçš„ä¼ è¾“ï¼šæ¯”å¦‚å¯¹äºä¸€ä¸ªäº‹ä»¶ï¼Œåªæƒ³çŸ¥é“æˆåŠŸæˆ–è€…å¤±è´¥ï¼Œå¹¶ä¸éœ€è¦çŸ¥é“è¿›è¡Œäº†å¤šå°‘æˆ–è€…é¢å¤–çš„ä¸€äº›ä¿¡æ¯3ã€blockéœ€è¦æ³¨æ„é˜²æ­¢å¾ªç¯å¼•ç”¨</code></pre></li></ul><h3 id="å…­ã€ç½‘ç»œ"><a href="#å…­ã€ç½‘ç»œ" class="headerlink" title="å…­ã€ç½‘ç»œ"></a>å…­ã€ç½‘ç»œ</h3><ul><li><p>HTTPï¼ˆHyperText Transfer Protocolã€è¶…æ–‡æœ¬ä¼ è¾“åè®®)æ˜¯OSIä¸ƒå±‚ä¸­åº”ç”¨å±‚çš„åè®®ã€‚HTTP æ˜¯åŸºäº TCP/IPåè®®çš„åº”ç”¨å±‚åè®®ã€‚å®ƒä¸æ¶‰åŠæ•°æ®åŒ…ï¼ˆpacketï¼‰ä¼ è¾“ï¼Œä¸»è¦è§„å®šäº†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡æ ¼å¼ï¼Œé»˜è®¤ä½¿ç”¨80ç«¯å£ã€‚</p></li><li><p>TCPï¼ˆTransmission Control Protocolï¼Œä¼ è¾“æ§åˆ¶åè®®ï¼‰æ˜¯OSIä¸ƒå±‚ä¸­ä¼ è¾“å±‚çš„åè®®ã€‚TCPï¼ˆTransmission Control Protocolï¼Œä¼ è¾“æ§åˆ¶åè®®ï¼‰æ˜¯åŸºäºè¿æ¥çš„åè®®ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ­£å¼æ”¶å‘æ•°æ®å‰ï¼Œå¿…é¡»å’Œå¯¹æ–¹å»ºç«‹å¯é çš„è¿æ¥ã€‚TCPæä¾›è¶…æ—¶é‡å‘ï¼Œä¸¢å¼ƒé‡å¤æ•°æ®ï¼Œæ£€éªŒæ•°æ®ï¼Œæµé‡æ§åˆ¶ç­‰åŠŸèƒ½ï¼Œä¿è¯æ•°æ®èƒ½ä»ä¸€ç«¯ä¼ åˆ°å¦ä¸€ç«¯ã€‚ ç†æƒ³çŠ¶æ€ä¸‹ï¼ŒTCPè¿æ¥ä¸€æ—¦å»ºç«‹ï¼Œåœ¨é€šä¿¡åŒæ–¹ä¸­çš„ä»»ä½•ä¸€æ–¹ä¸»åŠ¨å…³é—­è¿æ¥å‰ï¼ŒTCP è¿æ¥éƒ½å°†è¢«ä¸€ç›´ä¿æŒä¸‹å»ã€‚æ–­å¼€è¿æ¥æ—¶æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å‡å¯ä»¥ä¸»åŠ¨å‘èµ·æ–­å¼€TCPè¿æ¥çš„è¯·æ±‚</p></li><li><p>UDP (User Datagram Protocol,ç”¨æˆ·æ•°æ®æŠ¥åè®®)æ˜¯OSIå‚è€ƒæ¨¡å‹ä¸­æ— è¿æ¥çš„ä¼ è¾“å±‚åè®®.UDPç”¨æˆ·æ•°æ®æŠ¥åè®®ï¼Œæ˜¯ä¸€ä¸ªæ— è¿æ¥çš„ç®€å•çš„é¢å‘æ•°æ®æŠ¥çš„è¿è¾“å±‚åè®®ã€‚UDPä¸æä¾›å¯é æ€§ï¼Œå®ƒåªæ˜¯æŠŠåº”ç”¨ç¨‹åºä¼ ç»™IPå±‚çš„æ•°æ®æŠ¥å‘é€å‡ºå»ï¼Œä½†æ˜¯å¹¶ä¸èƒ½ä¿è¯å®ƒä»¬èƒ½åˆ°è¾¾ç›®çš„åœ°ã€‚ç”±äºUDPåœ¨ä¼ è¾“æ•°æ®æŠ¥å‰ä¸ç”¨åœ¨å®¢æˆ·å’ŒæœåŠ¡å™¨ä¹‹é—´å»ºç«‹ä¸€ä¸ªè¿æ¥ï¼Œä¸”æ²¡æœ‰è¶…æ—¶é‡å‘ç­‰æœºåˆ¶ï¼Œæ•…è€Œä¼ è¾“é€Ÿåº¦å¾ˆå¿«ã€‚</p></li><li><p>socketæ˜¯å¯¹TCPæˆ–è€…UDPåè®®çš„å°è£…å’Œå®ç°ï¼Œsocketå¹¶ä¸æ˜¯åè®®ï¼Œå·®ä¸å¤šæ¯ä¸€ç§è¯­è¨€éƒ½å®ç°äº†å¯¹TCPå’ŒUDPå°è£…å’Œå®ç°çš„Socketä»£ç åº“ï¼Œæ–¹ä¾¿å¼€å‘ç¨‹åºå‘˜ä½¿ç”¨ï¼Œsocketæ˜¯å¯¹TCPæˆ–è€…UDPåè®®çš„å°è£…å’Œå®ç°ï¼Œè¿™æ ·æˆ‘å°±å¯ä»¥åŸºäºä½ æ‰€ä½¿ç”¨è¯­è¨€çš„Socketæ¥å®ç°æ›´å¤šçš„åŠŸèƒ½ï¼Œæœ‰åŸºäºSocket TCPçš„HTTPè¯·æ±‚ï¼Œæœ‰åŸºäºSocket TCPé•¿è¿æ¥çš„æ¶ˆæ¯æ¨é€ï¼Œä¹Ÿå¯ä»¥åŸºäºSocket TCP/UDPè‡ªå®šä¹‰ä¸€å¥—è‡ªå·±çš„é€šä¿¡åè®®ã€‚<br>ï¼ˆ5ï¼‰å…³ç³»â€”&gt; HTTPåŸºäºTCPï¼ŒHTTPè¯·æ±‚éœ€è¦ä½¿ç”¨Socket TCPæ¥å®Œæˆã€‚</p></li></ul><h3 id="ä¸ƒã€å¤šçº¿ç¨‹"><a href="#ä¸ƒã€å¤šçº¿ç¨‹" class="headerlink" title="ä¸ƒã€å¤šçº¿ç¨‹"></a>ä¸ƒã€å¤šçº¿ç¨‹</h3><ul><li><p>è¿›ç¨‹ï¼šè¿›ç¨‹æ˜¯èµ„æºï¼ˆCPUã€å†…å­˜ç­‰ï¼‰åˆ†é…çš„åŸºæœ¬å•ä½ï¼Œå®ƒæ˜¯ç¨‹åºæ‰§è¡Œæ—¶çš„ä¸€ä¸ªå®ä¾‹ã€‚</p></li><li><p>çº¿ç¨‹æ˜¯ç¨‹åºæ‰§è¡Œæ—¶çš„æœ€å°å•ä½ï¼Œå®ƒæ˜¯è¿›ç¨‹çš„ä¸€ä¸ªæ‰§è¡Œæµï¼Œæ˜¯CPUè°ƒåº¦å’Œåˆ†æ´¾çš„åŸºæœ¬å•ä½ï¼Œä¸€ä¸ªè¿›ç¨‹å¯ä»¥ç”±å¾ˆå¤šä¸ªçº¿ç¨‹ç»„æˆï¼Œçº¿ç¨‹é—´å…±äº«è¿›ç¨‹çš„æ‰€æœ‰èµ„æºï¼Œæ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„å †æ ˆå’Œå±€éƒ¨å˜é‡ã€‚</p></li><li><p>pthreadï¼šCè¯­è¨€ç¼–ç¨‹ï¼Œæ‰‹åŠ¨ç®¡ç†çº¿ç¨‹å‘¨æœŸï¼Œä½¿ç”¨éš¾åº¦å¤§ï¼Œä¸å¸¸ç”¨ã€‚</p></li><li><p>NSThreadï¼šOCè¯­è¨€ç¼–ç¨‹ï¼Œæ‰‹åŠ¨ç®¡ç†çº¿ç¨‹å‘¨æœŸï¼Œé¢å‘å¯¹è±¡ï¼Œå¶å°”ä½¿ç”¨</p></li><li><p>GCDï¼šCè¯­è¨€ç¼–ç¨‹ï¼Œæ”¯æŒå¤šæ ¸ï¼Œè‡ªåŠ¨ç®¡ç†çº¿ç¨‹å‘¨æœŸï¼Œå¸¸ç”¨</p></li><li><p>NSOperationï¼šOCè¯­è¨€ç¼–ç¨‹ï¼ŒåŸºäºGCDï¼Œæ¯”GCDæ–°å¢æ–°åŠŸèƒ½ï¼Œå¸¸ç”¨</p></li><li><p>çº¿ç¨‹é”ï¼šçº¿ç¨‹æ­»é”æœ‰â€œäº’ç­‰â€ï¼Œç„¶åå¡ä½çš„æ„æ€,ä¹Ÿç”±äºå’ŒåŒ/å¼‚æ­¥å¤„ç†é¡ºåºï¼Œçº¿ç¨‹çš„ç­‰å¾…å¯¼è‡´é˜Ÿåˆ—åŠ å…¥çš„é¡ºåºä¸é˜Ÿåˆ—çš„FIFOåŸåˆ™(å…ˆè¿›å…ˆå‡ºï¼‰å†²çªå¼•èµ·ã€‚</p></li><li><p>å¹¶è¡Œï¼šå¹¶è¡ŒæŒ‡çš„æ˜¯ä¸€ç§æŠ€æœ¯ï¼Œä¸€ä¸ªåŒæ—¶å¤„ç†å¤šä¸ªä»»åŠ¡çš„æŠ€æœ¯ã€‚å®ƒæè¿°äº†ä¸€ç§èƒ½å¤ŸåŒæ—¶å¤„ç†å¤šä¸ªä»»åŠ¡çš„èƒ½åŠ›ï¼Œä¾§é‡ç‚¹åœ¨äºâ€œè¿è¡Œâ€ã€‚</p></li><li><p>ä¸²è¡Œï¼šè¡¨ç¤ºä»»åŠ¡å¿…é¡»æŒ‰é¡ºåºæ¥ï¼Œä¸€ä¸ªä¸€ä¸ªæ‰§è¡Œï¼Œå‰ä¸€ä¸ªæ‰§è¡Œå®Œäº†æ‰èƒ½æ‰§è¡Œåä¸€ä¸ªã€‚</p></li><li><p>å¹¶å‘ï¼šå¹¶å‘æŒ‡çš„æ˜¯ä¸€ç§ç°è±¡ï¼Œä¸€ç§ç»å¸¸å‡ºç°ï¼Œæ— å¯é¿å…çš„ç°è±¡ã€‚å®ƒæè¿°çš„æ˜¯â€œå¤šä¸ªä»»åŠ¡åŒæ—¶å‘ç”Ÿï¼Œéœ€è¦è¢«å¤„ç†â€è¿™ä¸€ç°è±¡ã€‚å®ƒçš„ä¾§é‡ç‚¹åœ¨äºâ€œå‘ç”Ÿâ€ã€‚</p></li><li><p>é˜Ÿåˆ—ï¼šä¸ç®¡æ˜¯ä¸²è¡Œé˜Ÿåˆ—ï¼ˆSerialQueueï¼‰è¿˜æ˜¯å¹¶è¡Œé˜Ÿåˆ—ï¼ˆConcurrencyQueueï¼‰ï¼Œéƒ½æ˜¯FIFOé˜Ÿåˆ—ã€‚ä¹Ÿå°±æ„å‘³ç€ï¼Œä»»åŠ¡ä¸€å®šæ˜¯ä¸€ä¸ªä¸€ä¸ªåœ°ï¼ŒæŒ‰ç…§å…ˆè¿›å…ˆå‡ºçš„é¡ºåºæ¥è°ƒåº¦ã€‚</p></li><li><p>åŒæ­¥ï¼šå°±æ˜¯åœ¨å‘å‡ºä¸€ä¸ªè°ƒç”¨æ—¶ï¼Œåœ¨æ²¡æœ‰å¾—åˆ°ç»“æœä¹‹å‰ï¼Œè¯¥è°ƒç”¨å°±ä¸è¿”å›ã€‚ä½†æ˜¯ä¸€æ—¦è°ƒç”¨è¿”å›ï¼Œå°±å¾—åˆ°è¿”å›å€¼äº†ã€‚</p></li><li><p>å¼‚æ­¥ï¼šè°ƒç”¨åœ¨å‘å‡ºä¹‹åï¼Œè¿™ä¸ªè°ƒç”¨å°±ç›´æ¥è¿”å›äº†ï¼Œæ‰€ä»¥æ²¡æœ‰è¿”å›ç»“æœã€‚</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> é¢è¯•é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¢è¯•æŠ€å·§ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iOSå¤šçº¿ç¨‹-NSOperation</title>
      <link href="/2020/01/16/iOS%E5%A4%9A%E7%BA%BF%E7%A8%8B-NSOperation/"/>
      <url>/2020/01/16/iOS%E5%A4%9A%E7%BA%BF%E7%A8%8B-NSOperation/</url>
      
        <content type="html"><![CDATA[<h2 id="1-NSOperationã€NSOperationQueue-ç®€ä»‹"><a href="#1-NSOperationã€NSOperationQueue-ç®€ä»‹" class="headerlink" title="1.NSOperationã€NSOperationQueue ç®€ä»‹"></a>1.NSOperationã€NSOperationQueue ç®€ä»‹</h2><p>NSOperationã€NSOperationQueue æ˜¯è‹¹æœæä¾›ç»™æˆ‘ä»¬çš„ä¸€å¥—å¤šçº¿ç¨‹è§£å†³æ–¹æ¡ˆã€‚å®é™…ä¸Š NSOperationã€NSOperationQueue æ˜¯åŸºäº GCD æ›´é«˜ä¸€å±‚çš„å°è£…ï¼Œå®Œå…¨é¢å‘å¯¹è±¡ã€‚ä½†æ˜¯æ¯” GCD æ›´ç®€å•æ˜“ç”¨ã€ä»£ç å¯è¯»æ€§ä¹Ÿæ›´é«˜ã€‚</p><h5 id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-NSOperationã€NSOperationQueueï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-NSOperationã€NSOperationQueueï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ NSOperationã€NSOperationQueueï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ NSOperationã€NSOperationQueueï¼Ÿ</h5><ol><li>å¯æ·»åŠ å®Œæˆçš„ä»£ç å—ï¼Œåœ¨æ“ä½œå®Œæˆåæ‰§è¡Œã€‚</li><li>æ·»åŠ æ“ä½œä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œæ–¹ä¾¿çš„æ§åˆ¶æ‰§è¡Œé¡ºåºã€‚</li><li>è®¾å®šæ“ä½œæ‰§è¡Œçš„ä¼˜å…ˆçº§ã€‚</li><li>å¯ä»¥å¾ˆæ–¹ä¾¿çš„å–æ¶ˆä¸€ä¸ªæ“ä½œçš„æ‰§è¡Œã€‚</li><li>ä½¿ç”¨ KVO è§‚å¯Ÿå¯¹æ“ä½œæ‰§è¡ŒçŠ¶æ€çš„æ›´æ”¹ï¼šisExecuteingã€isFinishedã€isCancelledã€‚</li></ol><h2 id="2-NSOperationã€NSOperationQueue-æ“ä½œå’Œæ“ä½œé˜Ÿåˆ—"><a href="#2-NSOperationã€NSOperationQueue-æ“ä½œå’Œæ“ä½œé˜Ÿåˆ—" class="headerlink" title="2. NSOperationã€NSOperationQueue æ“ä½œå’Œæ“ä½œé˜Ÿåˆ—"></a>2. NSOperationã€NSOperationQueue æ“ä½œå’Œæ“ä½œé˜Ÿåˆ—</h2><p>æ—¢ç„¶æ˜¯åŸºäº GCD çš„æ›´é«˜ä¸€å±‚çš„å°è£…ã€‚é‚£ä¹ˆï¼ŒGCD ä¸­çš„ä¸€äº›æ¦‚å¿µåŒæ ·é€‚ç”¨äº NSOperationã€NSOperationQueueã€‚åœ¨ NSOperationã€NSOperationQueue ä¸­ä¹Ÿæœ‰ç±»ä¼¼çš„ä»»åŠ¡ï¼ˆæ“ä½œï¼‰å’Œé˜Ÿåˆ—ï¼ˆæ“ä½œé˜Ÿåˆ—ï¼‰çš„æ¦‚å¿µã€‚</p><h4 id="æ“ä½œï¼ˆOperationï¼‰ï¼š"><a href="#æ“ä½œï¼ˆOperationï¼‰ï¼š" class="headerlink" title="æ“ä½œï¼ˆOperationï¼‰ï¼š"></a>æ“ä½œï¼ˆOperationï¼‰ï¼š</h4><ul><li>æ‰§è¡Œæ“ä½œçš„æ„æ€ï¼Œæ¢å¥è¯è¯´å°±æ˜¯ä½ åœ¨çº¿ç¨‹ä¸­æ‰§è¡Œçš„é‚£æ®µä»£ç ã€‚</li><li>åœ¨ GCD ä¸­æ˜¯æ”¾åœ¨ block ä¸­çš„ã€‚åœ¨ NSOperation ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ NSOperation å­ç±» NSInvocationOperationã€NSBlockOperationï¼Œæˆ–è€…è‡ªå®šä¹‰å­ç±»æ¥å°è£…æ“ä½œã€‚<h4 id="æ“ä½œé˜Ÿåˆ—ï¼ˆOperation-Queuesï¼‰ï¼š"><a href="#æ“ä½œé˜Ÿåˆ—ï¼ˆOperation-Queuesï¼‰ï¼š" class="headerlink" title="æ“ä½œé˜Ÿåˆ—ï¼ˆOperation Queuesï¼‰ï¼š"></a>æ“ä½œé˜Ÿåˆ—ï¼ˆOperation Queuesï¼‰ï¼š</h4></li><li>è¿™é‡Œçš„é˜Ÿåˆ—æŒ‡æ“ä½œé˜Ÿåˆ—ï¼Œå³ç”¨æ¥å­˜æ”¾æ“ä½œçš„é˜Ÿåˆ—ã€‚ä¸åŒäº GCD ä¸­çš„è°ƒåº¦é˜Ÿåˆ— FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰çš„åŸåˆ™ã€‚NSOperationQueue å¯¹äºæ·»åŠ åˆ°é˜Ÿåˆ—ä¸­çš„æ“ä½œï¼Œé¦–å…ˆè¿›å…¥å‡†å¤‡å°±ç»ªçš„çŠ¶æ€ï¼ˆå°±ç»ªçŠ¶æ€å–å†³äºæ“ä½œä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼‰ï¼Œç„¶åè¿›å…¥å°±ç»ªçŠ¶æ€çš„æ“ä½œçš„å¼€å§‹æ‰§è¡Œé¡ºåºï¼ˆéç»“æŸæ‰§è¡Œé¡ºåºï¼‰ç”±æ“ä½œä¹‹é—´ç›¸å¯¹çš„ä¼˜å…ˆçº§å†³å®šï¼ˆä¼˜å…ˆçº§æ˜¯æ“ä½œå¯¹è±¡è‡ªèº«çš„å±æ€§ï¼‰ã€‚</li><li>æ“ä½œé˜Ÿåˆ—é€šè¿‡è®¾ç½®æœ€å¤§å¹¶å‘æ“ä½œæ•°ï¼ˆmaxConcurrentOperationCountï¼‰æ¥æ§åˆ¶å¹¶å‘ã€ä¸²è¡Œã€‚</li><li>NSOperationQueue ä¸ºæˆ‘ä»¬æä¾›äº†ä¸¤ç§ä¸åŒç±»å‹çš„é˜Ÿåˆ—ï¼šä¸»é˜Ÿåˆ—å’Œè‡ªå®šä¹‰é˜Ÿåˆ—ã€‚ä¸»é˜Ÿåˆ—è¿è¡Œåœ¨ä¸»çº¿ç¨‹ä¹‹ä¸Šï¼Œè€Œè‡ªå®šä¹‰é˜Ÿåˆ—åœ¨åå°æ‰§è¡Œã€‚</li></ul><h2 id="3-NSOperationã€NSOperationQueue-ä½¿ç”¨æ­¥éª¤"><a href="#3-NSOperationã€NSOperationQueue-ä½¿ç”¨æ­¥éª¤" class="headerlink" title="3. NSOperationã€NSOperationQueue ä½¿ç”¨æ­¥éª¤"></a>3. NSOperationã€NSOperationQueue ä½¿ç”¨æ­¥éª¤</h2><p>NSOperation éœ€è¦é…åˆ NSOperationQueue æ¥å®ç°å¤šçº¿ç¨‹ã€‚å› ä¸ºé»˜è®¤æƒ…å†µä¸‹ï¼ŒNSOperation å•ç‹¬ä½¿ç”¨æ—¶ç³»ç»ŸåŒæ­¥æ‰§è¡Œæ“ä½œï¼Œé…åˆ NSOperationQueue æˆ‘ä»¬èƒ½æ›´å¥½çš„å®ç°å¼‚æ­¥æ‰§è¡Œã€‚<br>NSOperation å®ç°å¤šçº¿ç¨‹çš„ä½¿ç”¨æ­¥éª¤åˆ†ä¸ºä¸‰æ­¥ï¼š</p><p>åˆ›å»ºæ“ä½œï¼šå…ˆå°†éœ€è¦æ‰§è¡Œçš„æ“ä½œå°è£…åˆ°ä¸€ä¸ª NSOperation å¯¹è±¡ä¸­ã€‚<br>åˆ›å»ºé˜Ÿåˆ—ï¼šåˆ›å»º NSOperationQueue å¯¹è±¡ã€‚<br>å°†æ“ä½œåŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ï¼šå°† NSOperation å¯¹è±¡æ·»åŠ åˆ° NSOperationQueue å¯¹è±¡ä¸­ã€‚</p><p>ä¹‹åå‘¢ï¼Œç³»ç»Ÿå°±ä¼šè‡ªåŠ¨å°† NSOperationQueue ä¸­çš„ NSOperation å–å‡ºæ¥ï¼Œåœ¨æ–°çº¿ç¨‹ä¸­æ‰§è¡Œæ“ä½œã€‚<br>ä¸‹é¢æˆ‘ä»¬æ¥å­¦ä¹ ä¸‹ NSOperation å’Œ NSOperationQueue çš„åŸºæœ¬ä½¿ç”¨ã€‚</p><h2 id="4-NSOperation-å’Œ-NSOperationQueue-åŸºæœ¬ä½¿ç”¨"><a href="#4-NSOperation-å’Œ-NSOperationQueue-åŸºæœ¬ä½¿ç”¨" class="headerlink" title="4. NSOperation å’Œ NSOperationQueue åŸºæœ¬ä½¿ç”¨"></a>4. NSOperation å’Œ NSOperationQueue åŸºæœ¬ä½¿ç”¨</h2><h3 id="4-1-åˆ›å»ºæ“ä½œ"><a href="#4-1-åˆ›å»ºæ“ä½œ" class="headerlink" title="4.1 åˆ›å»ºæ“ä½œ"></a>4.1 åˆ›å»ºæ“ä½œ</h3><p>NSOperation æ˜¯ä¸ªæŠ½è±¡ç±»ï¼Œä¸èƒ½ç”¨æ¥å°è£…æ“ä½œã€‚æˆ‘ä»¬åªæœ‰ä½¿ç”¨å®ƒçš„å­ç±»æ¥å°è£…æ“ä½œã€‚æˆ‘ä»¬æœ‰ä¸‰ç§æ–¹å¼æ¥å°è£…æ“ä½œã€‚</p><p>ä½¿ç”¨å­ç±» NSInvocationOperation<br>ä½¿ç”¨å­ç±» NSBlockOperation<br>è‡ªå®šä¹‰ç»§æ‰¿è‡ª NSOperation çš„å­ç±»ï¼Œé€šè¿‡å®ç°å†…éƒ¨ç›¸åº”çš„æ–¹æ³•æ¥å°è£…æ“ä½œã€‚</p><p>åœ¨ä¸ä½¿ç”¨ NSOperationQueueï¼Œå•ç‹¬ä½¿ç”¨ NSOperation çš„æƒ…å†µä¸‹ç³»ç»ŸåŒæ­¥æ‰§è¡Œæ“ä½œï¼Œä¸‹é¢æˆ‘ä»¬å­¦ä¹ ä»¥ä¸‹æ“ä½œçš„ä¸‰ç§åˆ›å»ºæ–¹å¼ã€‚</p><h4 id="4-1-1-ä½¿ç”¨å­ç±»-NSInvocationOperation"><a href="#4-1-1-ä½¿ç”¨å­ç±»-NSInvocationOperation" class="headerlink" title="4.1.1 ä½¿ç”¨å­ç±» NSInvocationOperation"></a>4.1.1 ä½¿ç”¨å­ç±» NSInvocationOperation</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * ä½¿ç”¨å­ç±» NSInvocationOperation</span><br><span class="line"> *&#x2F;</span><br><span class="line">- (void)useInvocationOperation &#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 1.åˆ›å»º NSInvocationOperation å¯¹è±¡</span><br><span class="line">    NSInvocationOperation *op &#x3D; [[NSInvocationOperation alloc] initWithTarget:self selector:@selector(task1) object:nil];</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 2.è°ƒç”¨ start æ–¹æ³•å¼€å§‹æ‰§è¡Œæ“ä½œ</span><br><span class="line">    [op start];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * ä»»åŠ¡1</span><br><span class="line"> *&#x2F;</span><br><span class="line">- (void)task1 &#123;</span><br><span class="line">    for (int i &#x3D; 0; i &lt; 2; i++) &#123;</span><br><span class="line">        [NSThread sleepForTimeInterval:2]; &#x2F;&#x2F; æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span><br><span class="line">        NSLog(@&quot;1---%@&quot;, [NSThread currentThread]); &#x2F;&#x2F; æ‰“å°å½“å‰çº¿ç¨‹</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š<br><img src="https://upload-images.jianshu.io/upload_images/1877784-8adc1a81b44170e6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000" alt="60920ddb4ccdca50074568b5ea54679f.jpg"></p><ul><li>å¯ä»¥çœ‹åˆ°ï¼šåœ¨æ²¡æœ‰ä½¿ç”¨ NSOperationQueueã€åœ¨ä¸»çº¿ç¨‹ä¸­å•ç‹¬ä½¿ç”¨ä½¿ç”¨å­ç±» NSInvocationOperation æ‰§è¡Œä¸€ä¸ªæ“ä½œçš„æƒ…å†µä¸‹ï¼Œæ“ä½œæ˜¯åœ¨å½“å‰çº¿ç¨‹æ‰§è¡Œçš„ï¼Œå¹¶æ²¡æœ‰å¼€å¯æ–°çº¿ç¨‹ã€‚<br>å¦‚æœåœ¨å…¶ä»–çº¿ç¨‹ä¸­æ‰§è¡Œæ“ä½œï¼Œåˆ™æ‰“å°ç»“æœä¸ºå…¶ä»–çº¿ç¨‹ã€‚<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; åœ¨å…¶ä»–çº¿ç¨‹ä½¿ç”¨å­ç±» NSInvocationOperation</span><br><span class="line">[NSThread detachNewThreadSelector:@selector(useInvocationOperation) toTarget:self withObject:nil];</span><br></pre></td></tr></table></figure>è¾“å‡ºç»“æœï¼š<br><img src="https://upload-images.jianshu.io/upload_images/1877784-3a5b4d58d70a9129.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000" alt="60920ddb4ccdca50074568b5ea54679f.jpg"></li><li>å¯ä»¥çœ‹åˆ°ï¼šåœ¨å…¶ä»–çº¿ç¨‹ä¸­å•ç‹¬ä½¿ç”¨å­ç±» NSInvocationOperationï¼Œæ“ä½œæ˜¯åœ¨å½“å‰è°ƒç”¨çš„å…¶ä»–çº¿ç¨‹æ‰§è¡Œçš„ï¼Œå¹¶æ²¡æœ‰å¼€å¯æ–°çº¿ç¨‹ã€‚</li></ul><p>ä¸‹è¾¹å†æ¥çœ‹çœ‹ NSBlockOperationã€‚</p><h4 id="4-1-2-ä½¿ç”¨å­ç±»-NSBlockOperation"><a href="#4-1-2-ä½¿ç”¨å­ç±»-NSBlockOperation" class="headerlink" title="4.1.2 ä½¿ç”¨å­ç±» NSBlockOperation"></a>4.1.2 ä½¿ç”¨å­ç±» NSBlockOperation</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * ä½¿ç”¨å­ç±» NSBlockOperation</span><br><span class="line"> *&#x2F;</span><br><span class="line">- (void)useBlockOperation &#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 1.åˆ›å»º NSBlockOperation å¯¹è±¡</span><br><span class="line">    NSBlockOperation *op &#x3D; [NSBlockOperation blockOperationWithBlock:^&#123;</span><br><span class="line">        for (int i &#x3D; 0; i &lt; 2; i++) &#123;</span><br><span class="line">            [NSThread sleepForTimeInterval:2]; &#x2F;&#x2F; æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span><br><span class="line">            NSLog(@&quot;1---%@&quot;, [NSThread currentThread]); &#x2F;&#x2F; æ‰“å°å½“å‰çº¿ç¨‹</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 2.è°ƒç”¨ start æ–¹æ³•å¼€å§‹æ‰§è¡Œæ“ä½œ</span><br><span class="line">    [op start];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š<br><img src="https://upload-images.jianshu.io/upload_images/1877784-bfec9a19f48614b0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000" alt="60920ddb4ccdca50074568b5ea54679f.jpg"></p><ul><li>å¯ä»¥çœ‹åˆ°ï¼šåœ¨æ²¡æœ‰ä½¿ç”¨ NSOperationQueueã€åœ¨ä¸»çº¿ç¨‹ä¸­å•ç‹¬ä½¿ç”¨ NSBlockOperation æ‰§è¡Œä¸€ä¸ªæ“ä½œçš„æƒ…å†µä¸‹ï¼Œæ“ä½œæ˜¯åœ¨å½“å‰çº¿ç¨‹æ‰§è¡Œçš„ï¼Œå¹¶æ²¡æœ‰å¼€å¯æ–°çº¿ç¨‹ã€‚</li></ul><blockquote><p>æ³¨æ„ï¼šå’Œä¸Šè¾¹ NSInvocationOperation ä½¿ç”¨ä¸€æ ·ã€‚å› ä¸ºä»£ç æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­è°ƒç”¨çš„ï¼Œæ‰€ä»¥æ‰“å°ç»“æœä¸ºä¸»çº¿ç¨‹ã€‚å¦‚æœåœ¨å…¶ä»–çº¿ç¨‹ä¸­æ‰§è¡Œæ“ä½œï¼Œåˆ™æ‰“å°ç»“æœä¸ºå…¶ä»–çº¿ç¨‹ã€‚</p></blockquote><p>ä½†æ˜¯ï¼ŒNSBlockOperation è¿˜æä¾›äº†ä¸€ä¸ªæ–¹æ³• addExecutionBlock:ï¼Œé€šè¿‡ addExecutionBlock: å°±å¯ä»¥ä¸º NSBlockOperation æ·»åŠ é¢å¤–çš„æ“ä½œã€‚è¿™äº›æ“ä½œï¼ˆåŒ…æ‹¬ blockOperationWithBlock ä¸­çš„æ“ä½œï¼‰å¯ä»¥åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­åŒæ—¶ï¼ˆå¹¶å‘ï¼‰æ‰§è¡Œã€‚åªæœ‰å½“æ‰€æœ‰ç›¸å…³çš„æ“ä½œå·²ç»å®Œæˆæ‰§è¡Œæ—¶ï¼Œæ‰è§†ä¸ºå®Œæˆã€‚<br><br><br><br><br>å¦‚æœæ·»åŠ çš„æ“ä½œå¤šçš„è¯ï¼ŒblockOperationWithBlock: ä¸­çš„æ“ä½œä¹Ÿå¯èƒ½ä¼šåœ¨å…¶ä»–çº¿ç¨‹ï¼ˆéå½“å‰çº¿ç¨‹ï¼‰ä¸­æ‰§è¡Œï¼Œè¿™æ˜¯ç”±ç³»ç»Ÿå†³å®šçš„ï¼Œå¹¶ä¸æ˜¯è¯´æ·»åŠ åˆ° blockOperationWithBlock: ä¸­çš„æ“ä½œä¸€å®šä¼šåœ¨å½“å‰çº¿ç¨‹ä¸­æ‰§è¡Œã€‚ï¼ˆå¯ä»¥ä½¿ç”¨ addExecutionBlock: å¤šæ·»åŠ å‡ ä¸ªæ“ä½œè¯•è¯•ï¼‰ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * ä½¿ç”¨å­ç±» NSBlockOperation</span><br><span class="line"> * è°ƒç”¨æ–¹æ³• AddExecutionBlock:</span><br><span class="line"> *&#x2F;</span><br><span class="line">- (void)useBlockOperationAddExecutionBlock &#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 1.åˆ›å»º NSBlockOperation å¯¹è±¡</span><br><span class="line">    NSBlockOperation *op &#x3D; [NSBlockOperation blockOperationWithBlock:^&#123;</span><br><span class="line">        for (int i &#x3D; 0; i &lt; 2; i++) &#123;</span><br><span class="line">            [NSThread sleepForTimeInterval:2]; &#x2F;&#x2F; æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span><br><span class="line">            NSLog(@&quot;1---%@&quot;, [NSThread currentThread]); &#x2F;&#x2F; æ‰“å°å½“å‰çº¿ç¨‹</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 2.æ·»åŠ é¢å¤–çš„æ“ä½œ</span><br><span class="line">    [op addExecutionBlock:^&#123;</span><br><span class="line">        for (int i &#x3D; 0; i &lt; 2; i++) &#123;</span><br><span class="line">            [NSThread sleepForTimeInterval:2]; &#x2F;&#x2F; æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span><br><span class="line">            NSLog(@&quot;2---%@&quot;, [NSThread currentThread]); &#x2F;&#x2F; æ‰“å°å½“å‰çº¿ç¨‹</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">    [op addExecutionBlock:^&#123;</span><br><span class="line">        for (int i &#x3D; 0; i &lt; 2; i++) &#123;</span><br><span class="line">            [NSThread sleepForTimeInterval:2]; &#x2F;&#x2F; æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span><br><span class="line">            NSLog(@&quot;3---%@&quot;, [NSThread currentThread]); &#x2F;&#x2F; æ‰“å°å½“å‰çº¿ç¨‹</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">    [op addExecutionBlock:^&#123;</span><br><span class="line">        for (int i &#x3D; 0; i &lt; 2; i++) &#123;</span><br><span class="line">            [NSThread sleepForTimeInterval:2]; &#x2F;&#x2F; æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span><br><span class="line">            NSLog(@&quot;4---%@&quot;, [NSThread currentThread]); &#x2F;&#x2F; æ‰“å°å½“å‰çº¿ç¨‹</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">    [op addExecutionBlock:^&#123;</span><br><span class="line">        for (int i &#x3D; 0; i &lt; 2; i++) &#123;</span><br><span class="line">            [NSThread sleepForTimeInterval:2]; &#x2F;&#x2F; æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span><br><span class="line">            NSLog(@&quot;5---%@&quot;, [NSThread currentThread]); &#x2F;&#x2F; æ‰“å°å½“å‰çº¿ç¨‹</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">    [op addExecutionBlock:^&#123;</span><br><span class="line">        for (int i &#x3D; 0; i &lt; 2; i++) &#123;</span><br><span class="line">            [NSThread sleepForTimeInterval:2]; &#x2F;&#x2F; æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span><br><span class="line">            NSLog(@&quot;6---%@&quot;, [NSThread currentThread]); &#x2F;&#x2F; æ‰“å°å½“å‰çº¿ç¨‹</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">    [op addExecutionBlock:^&#123;</span><br><span class="line">        for (int i &#x3D; 0; i &lt; 2; i++) &#123;</span><br><span class="line">            [NSThread sleepForTimeInterval:2]; &#x2F;&#x2F; æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span><br><span class="line">            NSLog(@&quot;7---%@&quot;, [NSThread currentThread]); &#x2F;&#x2F; æ‰“å°å½“å‰çº¿ç¨‹</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">    [op addExecutionBlock:^&#123;</span><br><span class="line">        for (int i &#x3D; 0; i &lt; 2; i++) &#123;</span><br><span class="line">            [NSThread sleepForTimeInterval:2]; &#x2F;&#x2F; æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span><br><span class="line">            NSLog(@&quot;8---%@&quot;, [NSThread currentThread]); &#x2F;&#x2F; æ‰“å°å½“å‰çº¿ç¨‹</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 3.è°ƒç”¨ start æ–¹æ³•å¼€å§‹æ‰§è¡Œæ“ä½œ</span><br><span class="line">    [op start];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š<br><img src="https://upload-images.jianshu.io/upload_images/1877784-86c1302fa13acc83.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000" alt="60920ddb4ccdca50074568b5ea54679f.jpg"></p><ul><li>å¯ä»¥çœ‹å‡ºï¼šä½¿ç”¨å­ç±» NSBlockOperationï¼Œå¹¶è°ƒç”¨æ–¹æ³• AddExecutionBlock: çš„æƒ…å†µä¸‹ï¼ŒblockOperationWithBlock:æ–¹æ³•ä¸­çš„æ“ä½œ å’Œ addExecutionBlock: ä¸­çš„æ“ä½œæ˜¯åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­å¼‚æ­¥æ‰§è¡Œçš„ã€‚è€Œä¸”ï¼Œè¿™æ¬¡æ‰§è¡Œç»“æœä¸­ blockOperationWithBlock:æ–¹æ³•ä¸­çš„æ“ä½œä¹Ÿä¸æ˜¯åœ¨å½“å‰çº¿ç¨‹ï¼ˆä¸»çº¿ç¨‹ï¼‰ä¸­æ‰§è¡Œçš„ã€‚ä»è€Œå°è¯äº†blockOperationWithBlock: ä¸­çš„æ“ä½œä¹Ÿå¯èƒ½ä¼šåœ¨å…¶ä»–çº¿ç¨‹ï¼ˆéå½“å‰çº¿ç¨‹ï¼‰ä¸­æ‰§è¡Œã€‚</li></ul><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¦‚æœä¸€ä¸ª NSBlockOperation å¯¹è±¡å°è£…äº†å¤šä¸ªæ“ä½œã€‚NSBlockOperation æ˜¯å¦å¼€å¯æ–°çº¿ç¨‹ï¼Œå–å†³äºæ“ä½œçš„ä¸ªæ•°ã€‚å¦‚æœæ·»åŠ çš„æ“ä½œçš„ä¸ªæ•°å¤šï¼Œå°±ä¼šè‡ªåŠ¨å¼€å¯æ–°çº¿ç¨‹ã€‚å½“ç„¶å¼€å¯çš„çº¿ç¨‹æ•°æ˜¯ç”±ç³»ç»Ÿæ¥å†³å®šçš„ã€‚</p><h4 id="4-1-3-ä½¿ç”¨è‡ªå®šä¹‰ç»§æ‰¿è‡ª-NSOperation-çš„å­ç±»"><a href="#4-1-3-ä½¿ç”¨è‡ªå®šä¹‰ç»§æ‰¿è‡ª-NSOperation-çš„å­ç±»" class="headerlink" title="4.1.3 ä½¿ç”¨è‡ªå®šä¹‰ç»§æ‰¿è‡ª NSOperation çš„å­ç±»"></a>4.1.3 ä½¿ç”¨è‡ªå®šä¹‰ç»§æ‰¿è‡ª NSOperation çš„å­ç±»</h4><p>å¦‚æœä½¿ç”¨å­ç±» NSInvocationOperationã€NSBlockOperation ä¸èƒ½æ»¡è¶³æ—¥å¸¸éœ€æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰ç»§æ‰¿è‡ª NSOperation çš„å­ç±»ã€‚å¯ä»¥é€šè¿‡é‡å†™ main æˆ–è€… start æ–¹æ³• æ¥å®šä¹‰è‡ªå·±çš„ NSOperation å¯¹è±¡ã€‚é‡å†™mainæ–¹æ³•æ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬ä¸éœ€è¦ç®¡ç†æ“ä½œçš„çŠ¶æ€å±æ€§ isExecuting å’Œ isFinishedã€‚å½“ main æ‰§è¡Œå®Œè¿”å›çš„æ—¶å€™ï¼Œè¿™ä¸ªæ“ä½œå°±ç»“æŸäº†ã€‚</p><p>å…ˆå®šä¹‰ä¸€ä¸ªç»§æ‰¿è‡ª NSOperation çš„å­ç±»ï¼Œé‡å†™mainæ–¹æ³•ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; YSCOperation.h æ–‡ä»¶</span><br><span class="line">#import &lt;Foundation&#x2F;Foundation.h&gt;</span><br><span class="line"></span><br><span class="line">@interface YSCOperation : NSOperation</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; YSCOperation.m æ–‡ä»¶</span><br><span class="line">#import &quot;YSCOperation.h&quot;</span><br><span class="line"></span><br><span class="line">@implementation YSCOperation</span><br><span class="line"></span><br><span class="line">- (void)main &#123;</span><br><span class="line">    if (!self.isCancelled) &#123;</span><br><span class="line">        for (int i &#x3D; 0; i &lt; 2; i++) &#123;</span><br><span class="line">            [NSThread sleepForTimeInterval:2];</span><br><span class="line">            NSLog(@&quot;1---%@&quot;, [NSThread currentThread]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure><p>ç„¶åä½¿ç”¨çš„æ—¶å€™å¯¼å…¥å¤´æ–‡ä»¶YSCOperation.hã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * ä½¿ç”¨è‡ªå®šä¹‰ç»§æ‰¿è‡ª NSOperation çš„å­ç±»</span><br><span class="line"> *&#x2F;</span><br><span class="line">- (void)useCustomOperation &#123;</span><br><span class="line">    &#x2F;&#x2F; 1.åˆ›å»º YSCOperation å¯¹è±¡</span><br><span class="line">    YSCOperation *op &#x3D; [[YSCOperation alloc] init];</span><br><span class="line">    &#x2F;&#x2F; 2.è°ƒç”¨ start æ–¹æ³•å¼€å§‹æ‰§è¡Œæ“ä½œ</span><br><span class="line">    [op start];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š<br><img src="https://upload-images.jianshu.io/upload_images/1877784-3ed047566df45382.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000" alt="60920ddb4ccdca50074568b5ea54679f.jpg"></p><ul><li>å¯ä»¥çœ‹å‡ºï¼šåœ¨æ²¡æœ‰ä½¿ç”¨ NSOperationQueueã€åœ¨ä¸»çº¿ç¨‹å•ç‹¬ä½¿ç”¨è‡ªå®šä¹‰ç»§æ‰¿è‡ª NSOperation çš„å­ç±»çš„æƒ…å†µä¸‹ï¼Œæ˜¯åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œæ“ä½œï¼Œå¹¶æ²¡æœ‰å¼€å¯æ–°çº¿ç¨‹ã€‚</li></ul><p>ä¸‹è¾¹æˆ‘ä»¬æ¥è®²è®² NSOperationQueue çš„åˆ›å»ºã€‚</p><h3 id="4-2-åˆ›å»ºé˜Ÿåˆ—"><a href="#4-2-åˆ›å»ºé˜Ÿåˆ—" class="headerlink" title="4.2 åˆ›å»ºé˜Ÿåˆ—"></a>4.2 åˆ›å»ºé˜Ÿåˆ—</h3><p>NSOperationQueue ä¸€å…±æœ‰ä¸¤ç§é˜Ÿåˆ—ï¼šä¸»é˜Ÿåˆ—ã€è‡ªå®šä¹‰é˜Ÿåˆ—ã€‚å…¶ä¸­è‡ªå®šä¹‰é˜Ÿåˆ—åŒæ—¶åŒ…å«äº†ä¸²è¡Œã€å¹¶å‘åŠŸèƒ½ã€‚ä¸‹è¾¹æ˜¯ä¸»é˜Ÿåˆ—ã€è‡ªå®šä¹‰é˜Ÿåˆ—çš„åŸºæœ¬åˆ›å»ºæ–¹æ³•å’Œç‰¹ç‚¹ã€‚</p><h4 id="ä¸»é˜Ÿåˆ—"><a href="#ä¸»é˜Ÿåˆ—" class="headerlink" title="ä¸»é˜Ÿåˆ—"></a>ä¸»é˜Ÿåˆ—</h4><ul><li>å‡¡æ˜¯æ·»åŠ åˆ°ä¸»é˜Ÿåˆ—ä¸­çš„æ“ä½œï¼Œéƒ½ä¼šæ”¾åˆ°ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œï¼ˆæ³¨ï¼šä¸åŒ…æ‹¬æ“ä½œä½¿ç”¨addExecutionBlock:æ·»åŠ çš„é¢å¤–æ“ä½œï¼Œé¢å¤–æ“ä½œå¯èƒ½åœ¨å…¶ä»–çº¿ç¨‹æ‰§è¡Œï¼Œæ„Ÿè°¢æŒ‡æ­£ï¼‰ã€‚<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> &#x2F;&#x2F; ä¸»é˜Ÿåˆ—è·å–æ–¹æ³•</span><br><span class="line">NSOperationQueue *queue &#x3D; [NSOperationQueue mainQueue];</span><br></pre></td></tr></table></figure><h4 id="è‡ªå®šä¹‰é˜Ÿåˆ—ï¼ˆéä¸»é˜Ÿåˆ—ï¼‰"><a href="#è‡ªå®šä¹‰é˜Ÿåˆ—ï¼ˆéä¸»é˜Ÿåˆ—ï¼‰" class="headerlink" title="è‡ªå®šä¹‰é˜Ÿåˆ—ï¼ˆéä¸»é˜Ÿåˆ—ï¼‰"></a>è‡ªå®šä¹‰é˜Ÿåˆ—ï¼ˆéä¸»é˜Ÿåˆ—ï¼‰</h4></li><li>æ·»åŠ åˆ°è¿™ç§é˜Ÿåˆ—ä¸­çš„æ“ä½œï¼Œå°±ä¼šè‡ªåŠ¨æ”¾åˆ°å­çº¿ç¨‹ä¸­æ‰§è¡Œã€‚</li><li>åŒæ—¶åŒ…å«äº†ï¼šä¸²è¡Œã€å¹¶å‘åŠŸèƒ½ã€‚<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; è‡ªå®šä¹‰é˜Ÿåˆ—åˆ›å»ºæ–¹æ³•</span><br><span class="line">NSOperationQueue *queue &#x3D; [[NSOperationQueue alloc] init];</span><br></pre></td></tr></table></figure><h3 id="4-3-å°†æ“ä½œåŠ å…¥åˆ°é˜Ÿåˆ—ä¸­"><a href="#4-3-å°†æ“ä½œåŠ å…¥åˆ°é˜Ÿåˆ—ä¸­" class="headerlink" title="4.3 å°†æ“ä½œåŠ å…¥åˆ°é˜Ÿåˆ—ä¸­"></a>4.3 å°†æ“ä½œåŠ å…¥åˆ°é˜Ÿåˆ—ä¸­</h3>ä¸Šè¾¹æˆ‘ä»¬è¯´åˆ° NSOperation éœ€è¦é…åˆ NSOperationQueue æ¥å®ç°å¤šçº¿ç¨‹ã€‚</li></ul><p>é‚£ä¹ˆæˆ‘ä»¬éœ€è¦å°†åˆ›å»ºå¥½çš„æ“ä½œåŠ å…¥åˆ°é˜Ÿåˆ—ä¸­å»ã€‚æ€»å…±æœ‰ä¸¤ç§æ–¹æ³•ï¼š</p><p>1.- (void)addOperation:(NSOperation *)op;</p><ul><li>éœ€è¦å…ˆåˆ›å»ºæ“ä½œï¼Œå†å°†åˆ›å»ºå¥½çš„æ“ä½œåŠ å…¥åˆ°åˆ›å»ºå¥½çš„é˜Ÿåˆ—ä¸­å»ã€‚<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * ä½¿ç”¨ addOperation: å°†æ“ä½œåŠ å…¥åˆ°æ“ä½œé˜Ÿåˆ—ä¸­</span><br><span class="line"> *&#x2F;</span><br><span class="line">- (void)addOperationToQueue &#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 1.åˆ›å»ºé˜Ÿåˆ—</span><br><span class="line">    NSOperationQueue *queue &#x3D; [[NSOperationQueue alloc] init];</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 2.åˆ›å»ºæ“ä½œ</span><br><span class="line">    &#x2F;&#x2F; ä½¿ç”¨ NSInvocationOperation åˆ›å»ºæ“ä½œ1</span><br><span class="line">    NSInvocationOperation *op1 &#x3D; [[NSInvocationOperation alloc] initWithTarget:self selector:@selector(task1) object:nil];</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; ä½¿ç”¨ NSInvocationOperation åˆ›å»ºæ“ä½œ2</span><br><span class="line">    NSInvocationOperation *op2 &#x3D; [[NSInvocationOperation alloc] initWithTarget:self selector:@selector(task2) object:nil];</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; ä½¿ç”¨ NSBlockOperation åˆ›å»ºæ“ä½œ3</span><br><span class="line">    NSBlockOperation *op3 &#x3D; [NSBlockOperation blockOperationWithBlock:^&#123;</span><br><span class="line">        for (int i &#x3D; 0; i &lt; 2; i++) &#123;</span><br><span class="line">            [NSThread sleepForTimeInterval:2]; &#x2F;&#x2F; æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span><br><span class="line">            NSLog(@&quot;3---%@&quot;, [NSThread currentThread]); &#x2F;&#x2F; æ‰“å°å½“å‰çº¿ç¨‹</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">    [op3 addExecutionBlock:^&#123;</span><br><span class="line">        for (int i &#x3D; 0; i &lt; 2; i++) &#123;</span><br><span class="line">            [NSThread sleepForTimeInterval:2]; &#x2F;&#x2F; æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span><br><span class="line">            NSLog(@&quot;4---%@&quot;, [NSThread currentThread]); &#x2F;&#x2F; æ‰“å°å½“å‰çº¿ç¨‹</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 3.ä½¿ç”¨ addOperation: æ·»åŠ æ‰€æœ‰æ“ä½œåˆ°é˜Ÿåˆ—ä¸­</span><br><span class="line">    [queue addOperation:op1]; &#x2F;&#x2F; [op1 start]</span><br><span class="line">    [queue addOperation:op2]; &#x2F;&#x2F; [op2 start]</span><br><span class="line">    [queue addOperation:op3]; &#x2F;&#x2F; [op3 start]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>è¾“å‡ºç»“æœï¼š<br><img src="https://upload-images.jianshu.io/upload_images/1877784-f31a03ee66c365e5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000" alt="60920ddb4ccdca50074568b5ea54679f.jpg"></li><li>å¯ä»¥çœ‹å‡ºï¼šä½¿ç”¨ NSOperation å­ç±»åˆ›å»ºæ“ä½œï¼Œå¹¶ä½¿ç”¨ addOperation: å°†æ“ä½œåŠ å…¥åˆ°æ“ä½œé˜Ÿåˆ—åèƒ½å¤Ÿå¼€å¯æ–°çº¿ç¨‹ï¼Œè¿›è¡Œå¹¶å‘æ‰§è¡Œ.</li></ul><br>2.- (void)addOperationWithBlock:(void (^)(void))block;- æ— éœ€å…ˆåˆ›å»ºæ“ä½œï¼Œåœ¨ block ä¸­æ·»åŠ æ“ä½œï¼Œç›´æ¥å°†åŒ…å«æ“ä½œçš„ block åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ã€‚<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * ä½¿ç”¨ addOperationWithBlock: å°†æ“ä½œåŠ å…¥åˆ°æ“ä½œé˜Ÿåˆ—ä¸­</span><br><span class="line"> *&#x2F;</span><br><span class="line"></span><br><span class="line">- (void)addOperationWithBlockToQueue &#123;</span><br><span class="line">    &#x2F;&#x2F; 1.åˆ›å»ºé˜Ÿåˆ—</span><br><span class="line">    NSOperationQueue *queue &#x3D; [[NSOperationQueue alloc] init];</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 2.ä½¿ç”¨ addOperationWithBlock: æ·»åŠ æ“ä½œåˆ°é˜Ÿåˆ—ä¸­</span><br><span class="line">    [queue addOperationWithBlock:^&#123;</span><br><span class="line">        for (int i &#x3D; 0; i &lt; 2; i++) &#123;</span><br><span class="line">            [NSThread sleepForTimeInterval:2]; &#x2F;&#x2F; æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span><br><span class="line">            NSLog(@&quot;1---%@&quot;, [NSThread currentThread]); &#x2F;&#x2F; æ‰“å°å½“å‰çº¿ç¨‹</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">    [queue addOperationWithBlock:^&#123;</span><br><span class="line">        for (int i &#x3D; 0; i &lt; 2; i++) &#123;</span><br><span class="line">            [NSThread sleepForTimeInterval:2]; &#x2F;&#x2F; æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span><br><span class="line">            NSLog(@&quot;2---%@&quot;, [NSThread currentThread]); &#x2F;&#x2F; æ‰“å°å½“å‰çº¿ç¨‹</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">    [queue addOperationWithBlock:^&#123;</span><br><span class="line">        for (int i &#x3D; 0; i &lt; 2; i++) &#123;</span><br><span class="line">            [NSThread sleepForTimeInterval:2]; &#x2F;&#x2F; æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span><br><span class="line">            NSLog(@&quot;3---%@&quot;, [NSThread currentThread]); &#x2F;&#x2F; æ‰“å°å½“å‰çº¿ç¨‹</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š<br><img src="https://upload-images.jianshu.io/upload_images/1877784-ac8c2cdaf40b4202.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000" alt="60920ddb4ccdca50074568b5ea54679f.jpg"></p><ul><li>å¯ä»¥çœ‹å‡ºï¼šä½¿ç”¨ addOperationWithBlock: å°†æ“ä½œåŠ å…¥åˆ°æ“ä½œé˜Ÿåˆ—åèƒ½å¤Ÿå¼€å¯æ–°çº¿ç¨‹ï¼Œè¿›è¡Œå¹¶å‘æ‰§è¡Œã€‚</li></ul><h2 id="5-NSOperationQueue-æ§åˆ¶ä¸²è¡Œæ‰§è¡Œã€å¹¶å‘æ‰§è¡Œ"><a href="#5-NSOperationQueue-æ§åˆ¶ä¸²è¡Œæ‰§è¡Œã€å¹¶å‘æ‰§è¡Œ" class="headerlink" title="5. NSOperationQueue æ§åˆ¶ä¸²è¡Œæ‰§è¡Œã€å¹¶å‘æ‰§è¡Œ"></a>5. NSOperationQueue æ§åˆ¶ä¸²è¡Œæ‰§è¡Œã€å¹¶å‘æ‰§è¡Œ</h2><p>ä¹‹å‰æˆ‘ä»¬è¯´è¿‡ï¼ŒNSOperationQueue åˆ›å»ºçš„è‡ªå®šä¹‰é˜Ÿåˆ—åŒæ—¶å…·æœ‰ä¸²è¡Œã€å¹¶å‘åŠŸèƒ½ï¼Œä¸Šè¾¹æˆ‘ä»¬æ¼”ç¤ºäº†å¹¶å‘åŠŸèƒ½ï¼Œé‚£ä¹ˆä»–çš„ä¸²è¡ŒåŠŸèƒ½æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</p><p>è¿™é‡Œæœ‰ä¸ªå…³é”®å±æ€§ maxConcurrentOperationCountï¼Œå«åšæœ€å¤§å¹¶å‘æ“ä½œæ•°ã€‚ç”¨æ¥æ§åˆ¶ä¸€ä¸ªç‰¹å®šé˜Ÿåˆ—ä¸­å¯ä»¥æœ‰å¤šå°‘ä¸ªæ“ä½œåŒæ—¶å‚ä¸å¹¶å‘æ‰§è¡Œã€‚</p><blockquote><p>æ³¨æ„ï¼šè¿™é‡Œ maxConcurrentOperationCount æ§åˆ¶çš„ä¸æ˜¯å¹¶å‘çº¿ç¨‹çš„æ•°é‡ï¼Œè€Œæ˜¯ä¸€ä¸ªé˜Ÿåˆ—ä¸­åŒæ—¶èƒ½å¹¶å‘æ‰§è¡Œçš„æœ€å¤§æ“ä½œæ•°ã€‚è€Œä¸”ä¸€ä¸ªæ“ä½œä¹Ÿå¹¶éåªèƒ½åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­è¿è¡Œã€‚</p></blockquote><h4 id="æœ€å¤§å¹¶å‘æ“ä½œæ•°ï¼šmaxConcurrentOperationCount"><a href="#æœ€å¤§å¹¶å‘æ“ä½œæ•°ï¼šmaxConcurrentOperationCount" class="headerlink" title="æœ€å¤§å¹¶å‘æ“ä½œæ•°ï¼šmaxConcurrentOperationCount"></a>æœ€å¤§å¹¶å‘æ“ä½œæ•°ï¼šmaxConcurrentOperationCount</h4><ul><li><p>maxConcurrentOperationCount é»˜è®¤æƒ…å†µä¸‹ä¸º-1ï¼Œè¡¨ç¤ºä¸è¿›è¡Œé™åˆ¶ï¼Œå¯è¿›è¡Œå¹¶å‘æ‰§è¡Œã€‚</p></li><li><p>maxConcurrentOperationCount ä¸º1æ—¶ï¼Œé˜Ÿåˆ—ä¸ºä¸²è¡Œé˜Ÿåˆ—ã€‚åªèƒ½ä¸²è¡Œæ‰§è¡Œã€‚</p></li><li><p>maxConcurrentOperationCount å¤§äº1æ—¶ï¼Œé˜Ÿåˆ—ä¸ºå¹¶å‘é˜Ÿåˆ—ã€‚æ“ä½œå¹¶å‘æ‰§è¡Œï¼Œå½“ç„¶è¿™ä¸ªå€¼ä¸åº”è¶…è¿‡ç³»ç»Ÿé™åˆ¶ï¼Œå³ä½¿è‡ªå·±è®¾ç½®ä¸€ä¸ªå¾ˆå¤§çš„å€¼ï¼Œç³»ç»Ÿä¹Ÿä¼šè‡ªåŠ¨è°ƒæ•´ä¸º min{è‡ªå·±è®¾å®šçš„å€¼ï¼Œç³»ç»Ÿè®¾å®šçš„é»˜è®¤æœ€å¤§å€¼}ã€‚</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * è®¾ç½® MaxConcurrentOperationCountï¼ˆæœ€å¤§å¹¶å‘æ“ä½œæ•°ï¼‰</span><br><span class="line"> *&#x2F;</span><br><span class="line">- (void)setMaxConcurrentOperationCount &#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 1.åˆ›å»ºé˜Ÿåˆ—</span><br><span class="line">    NSOperationQueue *queue &#x3D; [[NSOperationQueue alloc] init];</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 2.è®¾ç½®æœ€å¤§å¹¶å‘æ“ä½œæ•°</span><br><span class="line">    queue.maxConcurrentOperationCount &#x3D; 1; &#x2F;&#x2F; ä¸²è¡Œé˜Ÿåˆ—</span><br><span class="line">&#x2F;&#x2F; queue.maxConcurrentOperationCount &#x3D; 2; &#x2F;&#x2F; å¹¶å‘é˜Ÿåˆ—</span><br><span class="line">&#x2F;&#x2F; queue.maxConcurrentOperationCount &#x3D; 8; &#x2F;&#x2F; å¹¶å‘é˜Ÿåˆ—</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 3.æ·»åŠ æ“ä½œ</span><br><span class="line">    [queue addOperationWithBlock:^&#123;</span><br><span class="line">        for (int i &#x3D; 0; i &lt; 2; i++) &#123;</span><br><span class="line">            [NSThread sleepForTimeInterval:2]; &#x2F;&#x2F; æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span><br><span class="line">            NSLog(@&quot;1---%@&quot;, [NSThread currentThread]); &#x2F;&#x2F; æ‰“å°å½“å‰çº¿ç¨‹</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">    [queue addOperationWithBlock:^&#123;</span><br><span class="line">        for (int i &#x3D; 0; i &lt; 2; i++) &#123;</span><br><span class="line">            [NSThread sleepForTimeInterval:2]; &#x2F;&#x2F; æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span><br><span class="line">            NSLog(@&quot;2---%@&quot;, [NSThread currentThread]); &#x2F;&#x2F; æ‰“å°å½“å‰çº¿ç¨‹</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">    [queue addOperationWithBlock:^&#123;</span><br><span class="line">        for (int i &#x3D; 0; i &lt; 2; i++) &#123;</span><br><span class="line">            [NSThread sleepForTimeInterval:2]; &#x2F;&#x2F; æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span><br><span class="line">            NSLog(@&quot;3---%@&quot;, [NSThread currentThread]); &#x2F;&#x2F; æ‰“å°å½“å‰çº¿ç¨‹</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">    [queue addOperationWithBlock:^&#123;</span><br><span class="line">        for (int i &#x3D; 0; i &lt; 2; i++) &#123;</span><br><span class="line">            [NSThread sleepForTimeInterval:2]; &#x2F;&#x2F; æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span><br><span class="line">            NSLog(@&quot;4---%@&quot;, [NSThread currentThread]); &#x2F;&#x2F; æ‰“å°å½“å‰çº¿ç¨‹</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>æœ€å¤§å¹¶å‘æ“ä½œæ•°ä¸º1 è¾“å‡ºç»“æœï¼š<br><img src="https://upload-images.jianshu.io/upload_images/1877784-79e0996ee294d434.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000" alt=""></p></li><li><p>æœ€å¤§å¹¶å‘æ“ä½œæ•°ä¸º2 è¾“å‡ºç»“æœï¼š<br><img src="https://upload-images.jianshu.io/upload_images/1877784-c4f7ac2202fcb871.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000" alt=""></p></li><li><p>å¯ä»¥çœ‹å‡ºï¼šå½“æœ€å¤§å¹¶å‘æ“ä½œæ•°ä¸º1æ—¶ï¼Œæ“ä½œæ˜¯æŒ‰é¡ºåºä¸²è¡Œæ‰§è¡Œçš„ï¼Œå¹¶ä¸”ä¸€ä¸ªæ“ä½œå®Œæˆä¹‹åï¼Œä¸‹ä¸€ä¸ªæ“ä½œæ‰å¼€å§‹æ‰§è¡Œã€‚å½“æœ€å¤§æ“ä½œå¹¶å‘æ•°ä¸º2æ—¶ï¼Œæ“ä½œæ˜¯å¹¶å‘æ‰§è¡Œçš„ï¼Œå¯ä»¥åŒæ—¶æ‰§è¡Œä¸¤ä¸ªæ“ä½œã€‚è€Œå¼€å¯çº¿ç¨‹æ•°é‡æ˜¯ç”±ç³»ç»Ÿå†³å®šçš„ï¼Œä¸éœ€è¦æˆ‘ä»¬æ¥ç®¡ç†ã€‚</p></li></ul><p>è¿™æ ·çœ‹æ¥ï¼Œæ˜¯ä¸æ˜¯æ¯” GCD è¿˜è¦ç®€å•äº†è®¸å¤šï¼Ÿ</p><h2 id="6-NSOperation-æ“ä½œä¾èµ–"><a href="#6-NSOperation-æ“ä½œä¾èµ–" class="headerlink" title="6. NSOperation æ“ä½œä¾èµ–"></a>6. NSOperation æ“ä½œä¾èµ–</h2><p>NSOperationã€NSOperationQueue æœ€å¸å¼•äººçš„åœ°æ–¹æ˜¯å®ƒèƒ½æ·»åŠ æ“ä½œä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚é€šè¿‡æ“ä½œä¾èµ–ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿çš„æ§åˆ¶æ“ä½œä¹‹é—´çš„æ‰§è¡Œå…ˆåé¡ºåºã€‚NSOperation æä¾›äº†3ä¸ªæ¥å£ä¾›æˆ‘ä»¬ç®¡ç†å’ŒæŸ¥çœ‹ä¾èµ–ã€‚</p><blockquote><ul><li>(void)addDependency:(NSOperation *)op; æ·»åŠ ä¾èµ–ï¼Œä½¿å½“å‰æ“ä½œä¾èµ–äºæ“ä½œ op çš„å®Œæˆã€‚</li></ul></blockquote><blockquote><ul><li>(void)removeDependency:(NSOperation *)op; ç§»é™¤ä¾èµ–ï¼Œå–æ¶ˆå½“å‰æ“ä½œå¯¹æ“ä½œ op çš„ä¾èµ–ã€‚</li></ul></blockquote><blockquote><p>@property (readonly, copy) NSArray&lt;NSOperation *&gt; *dependencies; åœ¨å½“å‰æ“ä½œå¼€å§‹æ‰§è¡Œä¹‹å‰å®Œæˆæ‰§è¡Œçš„æ‰€æœ‰æ“ä½œå¯¹è±¡æ•°ç»„ã€‚</p></blockquote><p>å½“ç„¶ï¼Œæˆ‘ä»¬ç»å¸¸ç”¨åˆ°çš„è¿˜æ˜¯æ·»åŠ ä¾èµ–æ“ä½œã€‚ç°åœ¨è€ƒè™‘è¿™æ ·çš„éœ€æ±‚ï¼Œæ¯”å¦‚è¯´æœ‰ Aã€B ä¸¤ä¸ªæ“ä½œï¼Œå…¶ä¸­ A æ‰§è¡Œå®Œæ“ä½œï¼ŒB æ‰èƒ½æ‰§è¡Œæ“ä½œã€‚</p><p>å¦‚æœä½¿ç”¨ä¾èµ–æ¥å¤„ç†çš„è¯ï¼Œé‚£ä¹ˆå°±éœ€è¦è®©æ“ä½œ B ä¾èµ–äºæ“ä½œ Aã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * æ“ä½œä¾èµ–</span><br><span class="line"> * ä½¿ç”¨æ–¹æ³•ï¼šaddDependency:</span><br><span class="line"> *&#x2F;</span><br><span class="line">- (void)addDependency &#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 1.åˆ›å»ºé˜Ÿåˆ—</span><br><span class="line">    NSOperationQueue *queue &#x3D; [[NSOperationQueue alloc] init];</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 2.åˆ›å»ºæ“ä½œ</span><br><span class="line">    NSBlockOperation *op1 &#x3D; [NSBlockOperation blockOperationWithBlock:^&#123;</span><br><span class="line">        for (int i &#x3D; 0; i &lt; 2; i++) &#123;</span><br><span class="line">            [NSThread sleepForTimeInterval:2]; &#x2F;&#x2F; æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span><br><span class="line">            NSLog(@&quot;1---%@&quot;, [NSThread currentThread]); &#x2F;&#x2F; æ‰“å°å½“å‰çº¿ç¨‹</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">    NSBlockOperation *op2 &#x3D; [NSBlockOperation blockOperationWithBlock:^&#123;</span><br><span class="line">        for (int i &#x3D; 0; i &lt; 2; i++) &#123;</span><br><span class="line">            [NSThread sleepForTimeInterval:2]; &#x2F;&#x2F; æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span><br><span class="line">            NSLog(@&quot;2---%@&quot;, [NSThread currentThread]); &#x2F;&#x2F; æ‰“å°å½“å‰çº¿ç¨‹</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 3.æ·»åŠ ä¾èµ–</span><br><span class="line">    [op2 addDependency:op1]; &#x2F;&#x2F; è®©op2 ä¾èµ–äº op1ï¼Œåˆ™å…ˆæ‰§è¡Œop1ï¼Œåœ¨æ‰§è¡Œop2</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 4.æ·»åŠ æ“ä½œåˆ°é˜Ÿåˆ—ä¸­</span><br><span class="line">    [queue addOperation:op1];</span><br><span class="line">    [queue addOperation:op2];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š<br><img src="https://upload-images.jianshu.io/upload_images/1877784-c0ce9c8c762ea71b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000" alt=""></p><ul><li>å¯ä»¥çœ‹åˆ°ï¼šé€šè¿‡æ·»åŠ æ“ä½œä¾èµ–ï¼Œæ— è®ºè¿è¡Œå‡ æ¬¡ï¼Œå…¶ç»“æœéƒ½æ˜¯ op1 å…ˆæ‰§è¡Œï¼Œop2 åæ‰§è¡Œã€‚</li></ul><h2 id="7-NSOperation-ä¼˜å…ˆçº§"><a href="#7-NSOperation-ä¼˜å…ˆçº§" class="headerlink" title="7. NSOperation ä¼˜å…ˆçº§"></a>7. NSOperation ä¼˜å…ˆçº§</h2><p>NSOperation æä¾›äº†queuePriorityï¼ˆä¼˜å…ˆçº§ï¼‰å±æ€§ï¼ŒqueuePriorityå±æ€§é€‚ç”¨äºåŒä¸€æ“ä½œé˜Ÿåˆ—ä¸­çš„æ“ä½œï¼Œä¸é€‚ç”¨äºä¸åŒæ“ä½œé˜Ÿåˆ—ä¸­çš„æ“ä½œã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰æ–°åˆ›å»ºçš„æ“ä½œå¯¹è±¡ä¼˜å…ˆçº§éƒ½æ˜¯NSOperationQueuePriorityNormalã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡setQueuePriority:æ–¹æ³•æ¥æ”¹å˜å½“å‰æ“ä½œåœ¨åŒä¸€é˜Ÿåˆ—ä¸­çš„æ‰§è¡Œä¼˜å…ˆçº§ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; ä¼˜å…ˆçº§çš„å–å€¼</span><br><span class="line">typedef NS_ENUM(NSInteger, NSOperationQueuePriority) &#123;</span><br><span class="line">    NSOperationQueuePriorityVeryLow &#x3D; -8L,</span><br><span class="line">    NSOperationQueuePriorityLow &#x3D; -4L,</span><br><span class="line">    NSOperationQueuePriorityNormal &#x3D; 0,</span><br><span class="line">    NSOperationQueuePriorityHigh &#x3D; 4,</span><br><span class="line">    NSOperationQueuePriorityVeryHigh &#x3D; 8</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ä¸Šè¾¹æˆ‘ä»¬è¯´è¿‡ï¼šå¯¹äºæ·»åŠ åˆ°é˜Ÿåˆ—ä¸­çš„æ“ä½œï¼Œé¦–å…ˆè¿›å…¥å‡†å¤‡å°±ç»ªçš„çŠ¶æ€ï¼ˆå°±ç»ªçŠ¶æ€å–å†³äºæ“ä½œä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼‰ï¼Œç„¶åè¿›å…¥å°±ç»ªçŠ¶æ€çš„æ“ä½œçš„å¼€å§‹æ‰§è¡Œé¡ºåºï¼ˆéç»“æŸæ‰§è¡Œé¡ºåºï¼‰ç”±æ“ä½œä¹‹é—´ç›¸å¯¹çš„ä¼˜å…ˆçº§å†³å®šï¼ˆä¼˜å…ˆçº§æ˜¯æ“ä½œå¯¹è±¡è‡ªèº«çš„å±æ€§ï¼‰ã€‚</p><h5 id="é‚£ä¹ˆï¼Œä»€ä¹ˆæ ·çš„æ“ä½œæ‰æ˜¯è¿›å…¥å°±ç»ªçŠ¶æ€çš„æ“ä½œå‘¢ï¼Ÿ"><a href="#é‚£ä¹ˆï¼Œä»€ä¹ˆæ ·çš„æ“ä½œæ‰æ˜¯è¿›å…¥å°±ç»ªçŠ¶æ€çš„æ“ä½œå‘¢ï¼Ÿ" class="headerlink" title="é‚£ä¹ˆï¼Œä»€ä¹ˆæ ·çš„æ“ä½œæ‰æ˜¯è¿›å…¥å°±ç»ªçŠ¶æ€çš„æ“ä½œå‘¢ï¼Ÿ"></a>é‚£ä¹ˆï¼Œä»€ä¹ˆæ ·çš„æ“ä½œæ‰æ˜¯è¿›å…¥å°±ç»ªçŠ¶æ€çš„æ“ä½œå‘¢ï¼Ÿ</h5><ul><li>å½“ä¸€ä¸ªæ“ä½œçš„æ‰€æœ‰ä¾èµ–éƒ½å·²ç»å®Œæˆæ—¶ï¼Œæ“ä½œå¯¹è±¡é€šå¸¸ä¼šè¿›å…¥å‡†å¤‡å°±ç»ªçŠ¶æ€ï¼Œç­‰å¾…æ‰§è¡Œã€‚</li></ul><p>ä¸¾ä¸ªä¾‹å­ï¼Œç°åœ¨æœ‰4ä¸ªä¼˜å…ˆçº§éƒ½æ˜¯ NSOperationQueuePriorityNormalï¼ˆé»˜è®¤çº§åˆ«ï¼‰çš„æ“ä½œï¼šop1ï¼Œop2ï¼Œop3ï¼Œop4ã€‚å…¶ä¸­ op3 ä¾èµ–äº op2ï¼Œop2 ä¾èµ–äº op1ï¼Œå³ op3 -&gt; op2 -&gt; op1ã€‚ç°åœ¨å°†è¿™4ä¸ªæ“ä½œæ·»åŠ åˆ°é˜Ÿåˆ—ä¸­å¹¶å‘æ‰§è¡Œã€‚</p><ul><li>å› ä¸º op1 å’Œ op4 éƒ½æ²¡æœ‰éœ€è¦ä¾èµ–çš„æ“ä½œï¼Œæ‰€ä»¥åœ¨ op1ï¼Œop4 æ‰§è¡Œä¹‹å‰ï¼Œå°±æ˜¯å¤„äºå‡†å¤‡å°±ç»ªçŠ¶æ€çš„æ“ä½œã€‚</li><li>è€Œ op3 å’Œ op2 éƒ½æœ‰ä¾èµ–çš„æ“ä½œï¼ˆop3 ä¾èµ–äº op2ï¼Œop2 ä¾èµ–äº op1ï¼‰ï¼Œæ‰€ä»¥ op3 å’Œ op2 éƒ½ä¸æ˜¯å‡†å¤‡å°±ç»ªçŠ¶æ€ä¸‹çš„æ“ä½œã€‚</li></ul><p>ç†è§£äº†è¿›å…¥å°±ç»ªçŠ¶æ€çš„æ“ä½œï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ç†è§£äº†queuePriority å±æ€§çš„ä½œç”¨å¯¹è±¡ã€‚</p><ul><li>queuePriority å±æ€§å†³å®šäº†è¿›å…¥å‡†å¤‡å°±ç»ªçŠ¶æ€ä¸‹çš„æ“ä½œä¹‹é—´çš„å¼€å§‹æ‰§è¡Œé¡ºåºã€‚å¹¶ä¸”ï¼Œä¼˜å…ˆçº§ä¸èƒ½å–ä»£ä¾èµ–å…³ç³»ã€‚</li><li>å¦‚æœä¸€ä¸ªé˜Ÿåˆ—ä¸­æ—¢åŒ…å«é«˜ä¼˜å…ˆçº§æ“ä½œï¼ŒåˆåŒ…å«ä½ä¼˜å…ˆçº§æ“ä½œï¼Œå¹¶ä¸”ä¸¤ä¸ªæ“ä½œéƒ½å·²ç»å‡†å¤‡å°±ç»ªï¼Œé‚£ä¹ˆé˜Ÿåˆ—å…ˆæ‰§è¡Œé«˜ä¼˜å…ˆçº§æ“ä½œã€‚æ¯”å¦‚ä¸Šä¾‹ä¸­ï¼Œå¦‚æœ op1 å’Œ op4 æ˜¯ä¸åŒä¼˜å…ˆçº§çš„æ“ä½œï¼Œé‚£ä¹ˆå°±ä¼šå…ˆæ‰§è¡Œä¼˜å…ˆçº§é«˜çš„æ“ä½œã€‚</li><li>å¦‚æœï¼Œä¸€ä¸ªé˜Ÿåˆ—ä¸­æ—¢åŒ…å«äº†å‡†å¤‡å°±ç»ªçŠ¶æ€çš„æ“ä½œï¼ŒåˆåŒ…å«äº†æœªå‡†å¤‡å°±ç»ªçš„æ“ä½œï¼Œæœªå‡†å¤‡å°±ç»ªçš„æ“ä½œä¼˜å…ˆçº§æ¯”å‡†å¤‡å°±ç»ªçš„æ“ä½œä¼˜å…ˆçº§é«˜ã€‚é‚£ä¹ˆï¼Œè™½ç„¶å‡†å¤‡å°±ç»ªçš„æ“ä½œä¼˜å…ˆçº§ä½ï¼Œä¹Ÿä¼šä¼˜å…ˆæ‰§è¡Œã€‚ä¼˜å…ˆçº§ä¸èƒ½å–ä»£ä¾èµ–å…³ç³»ã€‚å¦‚æœè¦æ§åˆ¶æ“ä½œé—´çš„å¯åŠ¨é¡ºåºï¼Œåˆ™å¿…é¡»ä½¿ç”¨ä¾èµ–å…³ç³»ã€‚</li></ul><h2 id="8-NSOperationã€NSOperationQueue-çº¿ç¨‹é—´çš„é€šä¿¡"><a href="#8-NSOperationã€NSOperationQueue-çº¿ç¨‹é—´çš„é€šä¿¡" class="headerlink" title="8. NSOperationã€NSOperationQueue çº¿ç¨‹é—´çš„é€šä¿¡"></a>8. NSOperationã€NSOperationQueue çº¿ç¨‹é—´çš„é€šä¿¡</h2><p>åœ¨ iOS å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬åœ¨ä¸»çº¿ç¨‹é‡Œè¾¹è¿›è¡Œ UI åˆ·æ–°ï¼Œä¾‹å¦‚ï¼šç‚¹å‡»ã€æ»šåŠ¨ã€æ‹–æ‹½ç­‰äº‹ä»¶ã€‚æˆ‘ä»¬é€šå¸¸æŠŠä¸€äº›è€—æ—¶çš„æ“ä½œæ”¾åœ¨å…¶ä»–çº¿ç¨‹ï¼Œæ¯”å¦‚è¯´å›¾ç‰‡ä¸‹è½½ã€æ–‡ä»¶ä¸Šä¼ ç­‰è€—æ—¶æ“ä½œã€‚è€Œå½“æˆ‘ä»¬æœ‰æ—¶å€™åœ¨å…¶ä»–çº¿ç¨‹å®Œæˆäº†è€—æ—¶æ“ä½œæ—¶ï¼Œéœ€è¦å›åˆ°ä¸»çº¿ç¨‹ï¼Œé‚£ä¹ˆå°±ç”¨åˆ°äº†çº¿ç¨‹ä¹‹é—´çš„é€šè®¯ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * çº¿ç¨‹é—´é€šä¿¡</span><br><span class="line"> *&#x2F;</span><br><span class="line">- (void)communication &#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 1.åˆ›å»ºé˜Ÿåˆ—</span><br><span class="line">    NSOperationQueue *queue &#x3D; [[NSOperationQueue alloc]init];</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 2.æ·»åŠ æ“ä½œ</span><br><span class="line">    [queue addOperationWithBlock:^&#123;</span><br><span class="line">        &#x2F;&#x2F; å¼‚æ­¥è¿›è¡Œè€—æ—¶æ“ä½œ</span><br><span class="line">        for (int i &#x3D; 0; i &lt; 2; i++) &#123;</span><br><span class="line">            [NSThread sleepForTimeInterval:2]; &#x2F;&#x2F; æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span><br><span class="line">            NSLog(@&quot;1---%@&quot;, [NSThread currentThread]); &#x2F;&#x2F; æ‰“å°å½“å‰çº¿ç¨‹</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; å›åˆ°ä¸»çº¿ç¨‹</span><br><span class="line">        [[NSOperationQueue mainQueue] addOperationWithBlock:^&#123;</span><br><span class="line">            &#x2F;&#x2F; è¿›è¡Œä¸€äº› UI åˆ·æ–°ç­‰æ“ä½œ</span><br><span class="line">            for (int i &#x3D; 0; i &lt; 2; i++) &#123;</span><br><span class="line">                [NSThread sleepForTimeInterval:2]; &#x2F;&#x2F; æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span><br><span class="line">                NSLog(@&quot;2---%@&quot;, [NSThread currentThread]); &#x2F;&#x2F; æ‰“å°å½“å‰çº¿ç¨‹</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š<br><img src="https://upload-images.jianshu.io/upload_images/1877784-c284bc79994a08dc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000" alt=""></p><ul><li>å¯ä»¥çœ‹åˆ°ï¼šé€šè¿‡çº¿ç¨‹é—´çš„é€šä¿¡ï¼Œå…ˆåœ¨å…¶ä»–çº¿ç¨‹ä¸­æ‰§è¡Œæ“ä½œï¼Œç­‰æ“ä½œæ‰§è¡Œå®Œäº†ä¹‹åå†å›åˆ°ä¸»çº¿ç¨‹æ‰§è¡Œä¸»çº¿ç¨‹çš„ç›¸åº”æ“ä½œã€‚</li></ul><h2 id="9-NSOperationã€NSOperationQueue-çº¿ç¨‹åŒæ­¥å’Œçº¿ç¨‹å®‰å…¨"><a href="#9-NSOperationã€NSOperationQueue-çº¿ç¨‹åŒæ­¥å’Œçº¿ç¨‹å®‰å…¨" class="headerlink" title="9. NSOperationã€NSOperationQueue çº¿ç¨‹åŒæ­¥å’Œçº¿ç¨‹å®‰å…¨"></a>9. NSOperationã€NSOperationQueue çº¿ç¨‹åŒæ­¥å’Œçº¿ç¨‹å®‰å…¨</h2><h4 id="çº¿ç¨‹å®‰å…¨"><a href="#çº¿ç¨‹å®‰å…¨" class="headerlink" title="çº¿ç¨‹å®‰å…¨"></a>çº¿ç¨‹å®‰å…¨</h4><p>å¦‚æœä½ çš„ä»£ç æ‰€åœ¨çš„è¿›ç¨‹ä¸­æœ‰å¤šä¸ªçº¿ç¨‹åœ¨åŒæ—¶è¿è¡Œï¼Œè€Œè¿™äº›çº¿ç¨‹å¯èƒ½ä¼šåŒæ—¶è¿è¡Œè¿™æ®µä»£ç ã€‚å¦‚æœæ¯æ¬¡è¿è¡Œç»“æœå’Œå•çº¿ç¨‹è¿è¡Œçš„ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œè€Œä¸”å…¶ä»–çš„å˜é‡çš„å€¼ä¹Ÿå’Œé¢„æœŸçš„æ˜¯ä¸€æ ·çš„ï¼Œå°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚<br>è‹¥æ¯ä¸ªçº¿ç¨‹ä¸­å¯¹å…¨å±€å˜é‡ã€é™æ€å˜é‡åªæœ‰è¯»æ“ä½œï¼Œè€Œæ— å†™æ“ä½œï¼Œä¸€èˆ¬æ¥è¯´ï¼Œè¿™ä¸ªå…¨å±€å˜é‡æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼›è‹¥æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œå†™æ“ä½œï¼ˆæ›´æ”¹å˜é‡ï¼‰ï¼Œä¸€èˆ¬éƒ½éœ€è¦è€ƒè™‘çº¿ç¨‹åŒæ­¥ï¼Œå¦åˆ™çš„è¯å°±å¯èƒ½å½±å“çº¿ç¨‹å®‰å…¨ã€‚</p><h4 id="çº¿ç¨‹åŒæ­¥"><a href="#çº¿ç¨‹åŒæ­¥" class="headerlink" title="çº¿ç¨‹åŒæ­¥"></a>çº¿ç¨‹åŒæ­¥</h4><p>å¯ç†è§£ä¸ºçº¿ç¨‹ A å’Œ çº¿ç¨‹ B ä¸€å—é…åˆï¼ŒA æ‰§è¡Œåˆ°ä¸€å®šç¨‹åº¦æ—¶è¦ä¾é çº¿ç¨‹ B çš„æŸä¸ªç»“æœï¼Œäºæ˜¯åœä¸‹æ¥ï¼Œç¤ºæ„ B è¿è¡Œï¼›B ä¾è¨€æ‰§è¡Œï¼Œå†å°†ç»“æœç»™ Aï¼›A å†ç»§ç»­æ“ä½œã€‚</p><p>ä¸¾ä¸ªç®€å•ä¾‹å­å°±æ˜¯ï¼šä¸¤ä¸ªäººåœ¨ä¸€èµ·èŠå¤©ã€‚ä¸¤ä¸ªäººä¸èƒ½åŒæ—¶è¯´è¯ï¼Œé¿å…å¬ä¸æ¸…(æ“ä½œå†²çª)ã€‚ç­‰ä¸€ä¸ªäººè¯´å®Œ(ä¸€ä¸ªçº¿ç¨‹ç»“æŸæ“ä½œ)ï¼Œå¦ä¸€ä¸ªå†è¯´(å¦ä¸€ä¸ªçº¿ç¨‹å†å¼€å§‹æ“ä½œ)ã€‚<br>ä¸‹é¢ï¼Œæˆ‘ä»¬æ¨¡æ‹Ÿç«è½¦ç¥¨å”®å–çš„æ–¹å¼ï¼Œå®ç° NSOperation çº¿ç¨‹å®‰å…¨å’Œè§£å†³çº¿ç¨‹åŒæ­¥é—®é¢˜ã€‚<br>åœºæ™¯ï¼šæ€»å…±æœ‰50å¼ ç«è½¦ç¥¨ï¼Œæœ‰ä¸¤ä¸ªå”®å–ç«è½¦ç¥¨çš„çª—å£ï¼Œä¸€ä¸ªæ˜¯åŒ—äº¬ç«è½¦ç¥¨å”®å–çª—å£ï¼Œå¦ä¸€ä¸ªæ˜¯ä¸Šæµ·ç«è½¦ç¥¨å”®å–çª—å£ã€‚ä¸¤ä¸ªçª—å£åŒæ—¶å”®å–ç«è½¦ç¥¨ï¼Œå–å®Œä¸ºæ­¢ã€‚</p><h3 id="9-1-NSOperationã€NSOperationQueue-éçº¿ç¨‹å®‰å…¨"><a href="#9-1-NSOperationã€NSOperationQueue-éçº¿ç¨‹å®‰å…¨" class="headerlink" title="9.1 NSOperationã€NSOperationQueue éçº¿ç¨‹å®‰å…¨"></a>9.1 NSOperationã€NSOperationQueue éçº¿ç¨‹å®‰å…¨</h3><p>å…ˆæ¥çœ‹çœ‹ä¸è€ƒè™‘çº¿ç¨‹å®‰å…¨çš„ä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * éçº¿ç¨‹å®‰å…¨ï¼šä¸ä½¿ç”¨ NSLock</span><br><span class="line"> * åˆå§‹åŒ–ç«è½¦ç¥¨æ•°é‡ã€å–ç¥¨çª—å£(éçº¿ç¨‹å®‰å…¨)ã€å¹¶å¼€å§‹å–ç¥¨</span><br><span class="line"> *&#x2F;</span><br><span class="line">- (void)initTicketStatusNotSave &#123;</span><br><span class="line">    NSLog(@&quot;currentThread---%@&quot;,[NSThread currentThread]); &#x2F;&#x2F; æ‰“å°å½“å‰çº¿ç¨‹</span><br><span class="line"></span><br><span class="line">    self.ticketSurplusCount &#x3D; 50;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 1.åˆ›å»º queue1,queue1 ä»£è¡¨åŒ—äº¬ç«è½¦ç¥¨å”®å–çª—å£</span><br><span class="line">    NSOperationQueue *queue1 &#x3D; [[NSOperationQueue alloc] init];</span><br><span class="line">    queue1.maxConcurrentOperationCount &#x3D; 1;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 2.åˆ›å»º queue2,queue2 ä»£è¡¨ä¸Šæµ·ç«è½¦ç¥¨å”®å–çª—å£</span><br><span class="line">    NSOperationQueue *queue2 &#x3D; [[NSOperationQueue alloc] init];</span><br><span class="line">    queue2.maxConcurrentOperationCount &#x3D; 1;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 3.åˆ›å»ºå–ç¥¨æ“ä½œ op1</span><br><span class="line">    NSBlockOperation *op1 &#x3D; [NSBlockOperation blockOperationWithBlock:^&#123;</span><br><span class="line">        [self saleTicketNotSafe];</span><br><span class="line">    &#125;];</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 4.åˆ›å»ºå–ç¥¨æ“ä½œ op2</span><br><span class="line">    NSBlockOperation *op2 &#x3D; [NSBlockOperation blockOperationWithBlock:^&#123;</span><br><span class="line">        [self saleTicketNotSafe];</span><br><span class="line">    &#125;];</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 5.æ·»åŠ æ“ä½œï¼Œå¼€å§‹å–ç¥¨</span><br><span class="line">    [queue1 addOperation:op1];</span><br><span class="line">    [queue2 addOperation:op2];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * å”®å–ç«è½¦ç¥¨(éçº¿ç¨‹å®‰å…¨)</span><br><span class="line"> *&#x2F;</span><br><span class="line">- (void)saleTicketNotSafe &#123;</span><br><span class="line">    while (1) &#123;</span><br><span class="line"></span><br><span class="line">        if (self.ticketSurplusCount &gt; 0) &#123;</span><br><span class="line">            &#x2F;&#x2F;å¦‚æœè¿˜æœ‰ç¥¨ï¼Œç»§ç»­å”®å–</span><br><span class="line">            self.ticketSurplusCount--;</span><br><span class="line">            NSLog(@&quot;%@&quot;, [NSString stringWithFormat:@&quot;å‰©ä½™ç¥¨æ•°:%d çª—å£:%@&quot;, self.ticketSurplusCount, [NSThread currentThread]]);</span><br><span class="line">            [NSThread sleepForTimeInterval:0.2];</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            NSLog(@&quot;æ‰€æœ‰ç«è½¦ç¥¨å‡å·²å”®å®Œ&quot;);</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š<br><img src="https://upload-images.jianshu.io/upload_images/1877784-e4a2e86c0523d4c8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000" alt=""></p><p>çœç•¥ä¸€éƒ¨åˆ†ç»“æœå›¾ã€‚ã€‚ã€‚<br><img src="https://upload-images.jianshu.io/upload_images/1877784-4a354394f006929f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000" alt=""></p><blockquote><p>å¯ä»¥çœ‹åˆ°ï¼šåœ¨ä¸è€ƒè™‘çº¿ç¨‹å®‰å…¨ï¼Œä¸ä½¿ç”¨ NSLock æƒ…å†µä¸‹ï¼Œå¾—åˆ°ç¥¨æ•°æ˜¯é”™ä¹±çš„ï¼Œè¿™æ ·æ˜¾ç„¶ä¸ç¬¦åˆæˆ‘ä»¬çš„éœ€æ±‚ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p></blockquote><h3 id="9-2-NSOperationã€NSOperationQueue-çº¿ç¨‹å®‰å…¨"><a href="#9-2-NSOperationã€NSOperationQueue-çº¿ç¨‹å®‰å…¨" class="headerlink" title="9.2 NSOperationã€NSOperationQueue çº¿ç¨‹å®‰å…¨"></a>9.2 NSOperationã€NSOperationQueue çº¿ç¨‹å®‰å…¨</h3><p>çº¿ç¨‹å®‰å…¨è§£å†³æ–¹æ¡ˆï¼šå¯ä»¥ç»™çº¿ç¨‹åŠ é”ï¼Œåœ¨ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œè¯¥æ“ä½œçš„æ—¶å€™ï¼Œä¸å…è®¸å…¶ä»–çº¿ç¨‹è¿›è¡Œæ“ä½œã€‚iOS å®ç°çº¿ç¨‹åŠ é”æœ‰å¾ˆå¤šç§æ–¹å¼ã€‚@synchronizedã€ NSLockã€NSRecursiveLockã€NSConditionã€NSConditionLockã€pthread_mutexã€dispatch_semaphoreã€OSSpinLockã€atomic(property) set/geç­‰ç­‰å„ç§æ–¹å¼ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ NSLock å¯¹è±¡æ¥è§£å†³çº¿ç¨‹åŒæ­¥é—®é¢˜ã€‚NSLock å¯¹è±¡å¯ä»¥é€šè¿‡è¿›å…¥é”æ—¶è°ƒç”¨ lock æ–¹æ³•ï¼Œè§£é”æ—¶è°ƒç”¨ unlock æ–¹æ³•æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚<br>è€ƒè™‘çº¿ç¨‹å®‰å…¨çš„ä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * çº¿ç¨‹å®‰å…¨ï¼šä½¿ç”¨ NSLock åŠ é”</span><br><span class="line"> * åˆå§‹åŒ–ç«è½¦ç¥¨æ•°é‡ã€å–ç¥¨çª—å£(çº¿ç¨‹å®‰å…¨)ã€å¹¶å¼€å§‹å–ç¥¨</span><br><span class="line"> *&#x2F;</span><br><span class="line"></span><br><span class="line">- (void)initTicketStatusSave &#123;</span><br><span class="line">    NSLog(@&quot;currentThread---%@&quot;,[NSThread currentThread]); &#x2F;&#x2F; æ‰“å°å½“å‰çº¿ç¨‹</span><br><span class="line"></span><br><span class="line">    self.ticketSurplusCount &#x3D; 50;</span><br><span class="line"></span><br><span class="line">    self.lock &#x3D; [[NSLock alloc] init];  &#x2F;&#x2F; åˆå§‹åŒ– NSLock å¯¹è±¡</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 1.åˆ›å»º queue1,queue1 ä»£è¡¨åŒ—äº¬ç«è½¦ç¥¨å”®å–çª—å£</span><br><span class="line">    NSOperationQueue *queue1 &#x3D; [[NSOperationQueue alloc] init];</span><br><span class="line">    queue1.maxConcurrentOperationCount &#x3D; 1;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 2.åˆ›å»º queue2,queue2 ä»£è¡¨ä¸Šæµ·ç«è½¦ç¥¨å”®å–çª—å£</span><br><span class="line">    NSOperationQueue *queue2 &#x3D; [[NSOperationQueue alloc] init];</span><br><span class="line">    queue2.maxConcurrentOperationCount &#x3D; 1;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 3.åˆ›å»ºå–ç¥¨æ“ä½œ op1</span><br><span class="line">    NSBlockOperation *op1 &#x3D; [NSBlockOperation blockOperationWithBlock:^&#123;</span><br><span class="line">        [self saleTicketSafe];</span><br><span class="line">    &#125;];</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 4.åˆ›å»ºå–ç¥¨æ“ä½œ op2</span><br><span class="line">    NSBlockOperation *op2 &#x3D; [NSBlockOperation blockOperationWithBlock:^&#123;</span><br><span class="line">        [self saleTicketSafe];</span><br><span class="line">    &#125;];</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 5.æ·»åŠ æ“ä½œï¼Œå¼€å§‹å–ç¥¨</span><br><span class="line">    [queue1 addOperation:op1];</span><br><span class="line">    [queue2 addOperation:op2];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * å”®å–ç«è½¦ç¥¨(çº¿ç¨‹å®‰å…¨)</span><br><span class="line"> *&#x2F;</span><br><span class="line">- (void)saleTicketSafe &#123;</span><br><span class="line">    while (1) &#123;</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; åŠ é”</span><br><span class="line">        [self.lock lock];</span><br><span class="line"></span><br><span class="line">        if (self.ticketSurplusCount &gt; 0) &#123;</span><br><span class="line">            &#x2F;&#x2F;å¦‚æœè¿˜æœ‰ç¥¨ï¼Œç»§ç»­å”®å–</span><br><span class="line">            self.ticketSurplusCount--;</span><br><span class="line">            NSLog(@&quot;%@&quot;, [NSString stringWithFormat:@&quot;å‰©ä½™ç¥¨æ•°:%d çª—å£:%@&quot;, self.ticketSurplusCount, [NSThread currentThread]]);</span><br><span class="line">            [NSThread sleepForTimeInterval:0.2];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F; è§£é”</span><br><span class="line">        [self.lock unlock];</span><br><span class="line"></span><br><span class="line">        if (self.ticketSurplusCount &lt;&#x3D; 0) &#123;</span><br><span class="line">            NSLog(@&quot;æ‰€æœ‰ç«è½¦ç¥¨å‡å·²å”®å®Œ&quot;);</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/1877784-7bffb9eade5887d0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000" alt=""></p><p>çœç•¥ä¸€éƒ¨åˆ†ç»“æœå›¾ã€‚ã€‚ã€‚</p><p><img src="https://upload-images.jianshu.io/upload_images/1877784-6698fdd0d10b0d14.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000" alt=""></p><blockquote><p>å¯ä»¥çœ‹å‡ºï¼šåœ¨è€ƒè™‘äº†çº¿ç¨‹å®‰å…¨ï¼Œä½¿ç”¨ NSLock åŠ é”ã€è§£é”æœºåˆ¶çš„æƒ…å†µä¸‹ï¼Œå¾—åˆ°çš„ç¥¨æ•°æ˜¯æ­£ç¡®çš„ï¼Œæ²¡æœ‰å‡ºç°æ··ä¹±çš„æƒ…å†µã€‚æˆ‘ä»¬ä¹Ÿå°±è§£å†³äº†å¤šä¸ªçº¿ç¨‹åŒæ­¥çš„é—®é¢˜ã€‚</p></blockquote><h2 id="10-NSOperationã€NSOperationQueue-å¸¸ç”¨å±æ€§å’Œæ–¹æ³•å½’çº³"><a href="#10-NSOperationã€NSOperationQueue-å¸¸ç”¨å±æ€§å’Œæ–¹æ³•å½’çº³" class="headerlink" title="10. NSOperationã€NSOperationQueue å¸¸ç”¨å±æ€§å’Œæ–¹æ³•å½’çº³"></a>10. NSOperationã€NSOperationQueue å¸¸ç”¨å±æ€§å’Œæ–¹æ³•å½’çº³</h2><h3 id="10-1-NSOperation-å¸¸ç”¨å±æ€§å’Œæ–¹æ³•"><a href="#10-1-NSOperation-å¸¸ç”¨å±æ€§å’Œæ–¹æ³•" class="headerlink" title="10.1 NSOperation å¸¸ç”¨å±æ€§å’Œæ–¹æ³•"></a>10.1 NSOperation å¸¸ç”¨å±æ€§å’Œæ–¹æ³•</h3><p>1ã€å–æ¶ˆæ“ä½œæ–¹æ³•</p><ul><li>-(void)cancel; å¯å–æ¶ˆæ“ä½œï¼Œå®è´¨æ˜¯æ ‡è®° isCancelled çŠ¶æ€ã€‚</li></ul><p>2ã€åˆ¤æ–­æ“ä½œçŠ¶æ€æ–¹æ³•</p><ul><li><p>-(BOOL)isFinished; åˆ¤æ–­æ“ä½œæ˜¯å¦å·²ç»ç»“æŸã€‚</p></li><li><p>-(BOOL)isCancelled; åˆ¤æ–­æ“ä½œæ˜¯å¦å·²ç»æ ‡è®°ä¸ºå–æ¶ˆã€‚</p></li><li><p>-(BOOL)isExecuting; åˆ¤æ–­æ“ä½œæ˜¯å¦æ­£åœ¨åœ¨è¿è¡Œã€‚</p></li><li><p>-(BOOL)isReady; åˆ¤æ–­æ“ä½œæ˜¯å¦å¤„äºå‡†å¤‡å°±ç»ªçŠ¶æ€ï¼Œè¿™ä¸ªå€¼å’Œæ“ä½œçš„ä¾èµ–å…³ç³»ç›¸å…³ã€‚</p></li></ul><p>3ã€æ“ä½œåŒæ­¥</p><ul><li><p>-(void)waitUntilFinished; é˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°è¯¥æ“ä½œç»“æŸã€‚å¯ç”¨äºçº¿ç¨‹æ‰§è¡Œé¡ºåºçš„åŒæ­¥ã€‚</p></li><li><p>-(void)setCompletionBlock:(void (^)(void))block; completionBlock ä¼šåœ¨å½“å‰æ“ä½œæ‰§è¡Œå®Œæ¯•æ—¶æ‰§è¡Œ completionBlockã€‚</p></li><li><p>-(void)addDependency:(NSOperation *)op; æ·»åŠ ä¾èµ–ï¼Œä½¿å½“å‰æ“ä½œä¾èµ–äºæ“ä½œ op çš„å®Œæˆã€‚</p></li><li><p>-(void)removeDependency:(NSOperation *)op; ç§»é™¤ä¾èµ–ï¼Œå–æ¶ˆå½“å‰æ“ä½œå¯¹æ“ä½œ op çš„ä¾èµ–ã€‚</p></li><li><p>@property (readonly, copy) NSArray&lt;NSOperation *&gt; *dependencies; åœ¨å½“å‰æ“ä½œå¼€å§‹æ‰§è¡Œä¹‹å‰å®Œæˆæ‰§è¡Œçš„æ‰€æœ‰æ“ä½œå¯¹è±¡æ•°ç»„ã€‚</p></li></ul><h3 id="10-2-NSOperationQueue-å¸¸ç”¨å±æ€§å’Œæ–¹æ³•"><a href="#10-2-NSOperationQueue-å¸¸ç”¨å±æ€§å’Œæ–¹æ³•" class="headerlink" title="10.2 NSOperationQueue å¸¸ç”¨å±æ€§å’Œæ–¹æ³•"></a>10.2 NSOperationQueue å¸¸ç”¨å±æ€§å’Œæ–¹æ³•</h3><p>1ã€å–æ¶ˆ/æš‚åœ/æ¢å¤æ“ä½œ</p><ul><li><p>-(void)cancelAllOperations; å¯ä»¥å–æ¶ˆé˜Ÿåˆ—çš„æ‰€æœ‰æ“ä½œã€‚</p></li><li><p>-(BOOL)isSuspended; åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦å¤„äºæš‚åœçŠ¶æ€ã€‚ YES ä¸ºæš‚åœçŠ¶æ€ï¼ŒNO ä¸ºæ¢å¤çŠ¶æ€ã€‚</p></li><li><p>-(void)setSuspended:(BOOL)b; å¯è®¾ç½®æ“ä½œçš„æš‚åœå’Œæ¢å¤ï¼ŒYES ä»£è¡¨æš‚åœé˜Ÿåˆ—ï¼ŒNO ä»£è¡¨æ¢å¤é˜Ÿåˆ—ã€‚</p></li></ul><p>2ã€æ“ä½œåŒæ­¥</p><ul><li>-(void)waitUntilAllOperationsAreFinished; é˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸­çš„æ“ä½œå…¨éƒ¨æ‰§è¡Œå®Œæ¯•ã€‚</li></ul><p>3ã€æ·»åŠ /è·å–æ“ä½œ</p><ul><li><p>-(void)addOperationWithBlock:(void (^)(void))block; å‘é˜Ÿåˆ—ä¸­æ·»åŠ ä¸€ä¸ª NSBlockOperation ç±»å‹æ“ä½œå¯¹è±¡ã€‚</p></li><li><p>-(void)addOperations:(NSArray *)ops waitUntilFinished:(BOOL)wait; å‘é˜Ÿåˆ—ä¸­æ·»åŠ æ“ä½œæ•°ç»„ï¼Œwait æ ‡å¿—æ˜¯å¦é˜»å¡å½“å‰çº¿ç¨‹ç›´åˆ°æ‰€æœ‰æ“ä½œç»“æŸ</p></li><li><p>-(NSArray *)operations; å½“å‰åœ¨é˜Ÿåˆ—ä¸­çš„æ“ä½œæ•°ç»„ï¼ˆæŸä¸ªæ“ä½œæ‰§è¡Œç»“æŸåä¼šè‡ªåŠ¨ä»è¿™ä¸ªæ•°ç»„æ¸…é™¤ï¼‰ã€‚</p></li><li><p>-(NSUInteger)operationCount; å½“å‰é˜Ÿåˆ—ä¸­çš„æ“ä½œæ•°ã€‚</p></li></ul><p>4ã€è·å–é˜Ÿåˆ—</p><ul><li>+(id)currentQueue; è·å–å½“å‰é˜Ÿåˆ—ï¼Œå¦‚æœå½“å‰çº¿ç¨‹ä¸æ˜¯åœ¨ NSOperationQueue ä¸Šè¿è¡Œåˆ™è¿”å› nilã€‚</li><li>-(id)mainQueue; è·å–ä¸»é˜Ÿåˆ—ã€‚<blockquote><p>æ³¨æ„ï¼š</p><p>è¿™é‡Œçš„æš‚åœå’Œå–æ¶ˆï¼ˆåŒ…æ‹¬æ“ä½œçš„å–æ¶ˆå’Œé˜Ÿåˆ—çš„å–æ¶ˆï¼‰å¹¶ä¸ä»£è¡¨å¯ä»¥å°†å½“å‰çš„æ“ä½œç«‹å³å–æ¶ˆï¼Œè€Œæ˜¯å½“å½“å‰çš„æ“ä½œæ‰§è¡Œå®Œæ¯•ä¹‹åä¸å†æ‰§è¡Œæ–°çš„æ“ä½œã€‚<br>æš‚åœå’Œå–æ¶ˆçš„åŒºåˆ«å°±åœ¨äºï¼šæš‚åœæ“ä½œä¹‹åè¿˜å¯ä»¥æ¢å¤æ“ä½œï¼Œç»§ç»­å‘ä¸‹æ‰§è¡Œï¼›è€Œå–æ¶ˆæ“ä½œä¹‹åï¼Œæ‰€æœ‰çš„æ“ä½œå°±æ¸…ç©ºäº†ï¼Œæ— æ³•å†æ¥ç€æ‰§è¡Œå‰©ä¸‹çš„æ“ä½œã€‚</p></blockquote></li></ul>]]></content>
      
      
      <categories>
          
          <category> Objective-C </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åº•å±‚åŸç† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iOSå¤šçº¿ç¨‹-9ç§é”.md</title>
      <link href="/2020/01/16/iOS%E5%A4%9A%E7%BA%BF%E7%A8%8B-9%E7%A7%8D%E9%94%81.md/"/>
      <url>/2020/01/16/iOS%E5%A4%9A%E7%BA%BF%E7%A8%8B-9%E7%A7%8D%E9%94%81.md/</url>
      
        <content type="html"><![CDATA[<h2 id="1ã€dispatch-semaphore-è‡ªæ—‹é”"><a href="#1ã€dispatch-semaphore-è‡ªæ—‹é”" class="headerlink" title="1ã€dispatch_semaphore è‡ªæ—‹é”"></a>1ã€dispatch_semaphore è‡ªæ—‹é”</h2><h2 id="2ã€-synchronized-äº’æ–¥é”"><a href="#2ã€-synchronized-äº’æ–¥é”" class="headerlink" title="2ã€@synchronized äº’æ–¥é”"></a>2ã€@synchronized äº’æ–¥é”</h2><h2 id="3ã€NSLock-çº¿ç¨‹é”"><a href="#3ã€NSLock-çº¿ç¨‹é”" class="headerlink" title="3ã€NSLock çº¿ç¨‹é”"></a>3ã€NSLock çº¿ç¨‹é”</h2><h2 id="4ã€NSRecursiveLock-é€’å½’é”"><a href="#4ã€NSRecursiveLock-é€’å½’é”" class="headerlink" title="4ã€NSRecursiveLock é€’å½’é”"></a>4ã€NSRecursiveLock é€’å½’é”</h2><h2 id="5ã€NSConditionLock-æ¡ä»¶é”"><a href="#5ã€NSConditionLock-æ¡ä»¶é”" class="headerlink" title="5ã€NSConditionLock æ¡ä»¶é”"></a>5ã€NSConditionLock æ¡ä»¶é”</h2><h2 id="6ã€NSCondition-æ–­è¨€"><a href="#6ã€NSCondition-æ–­è¨€" class="headerlink" title="6ã€NSCondition æ–­è¨€"></a>6ã€NSCondition æ–­è¨€</h2><h2 id="7ã€OSSpinLock-è‡ªæ—‹é”"><a href="#7ã€OSSpinLock-è‡ªæ—‹é”" class="headerlink" title="7ã€OSSpinLock è‡ªæ—‹é”"></a>7ã€OSSpinLock è‡ªæ—‹é”</h2><h2 id="8ã€pthread-mutex-äº’æ–¥é”"><a href="#8ã€pthread-mutex-äº’æ–¥é”" class="headerlink" title="8ã€pthread_mutex äº’æ–¥é”"></a>8ã€pthread_mutex äº’æ–¥é”</h2><h2 id="9ã€pthread-mutex-recursive-äº’æ–¥é”"><a href="#9ã€pthread-mutex-recursive-äº’æ–¥é”" class="headerlink" title="9ã€pthread_mutex(recursive) äº’æ–¥é”"></a>9ã€pthread_mutex(recursive) äº’æ–¥é”</h2>]]></content>
      
      
      <categories>
          
          <category> Objective-C </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åº•å±‚åŸç† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iOSåŠ¨ç”»-Transitionè½¬åœºåŠ¨ç”»</title>
      <link href="/2020/01/16/iOS%E5%8A%A8%E7%94%BB-Transition%E8%BD%AC%E5%9C%BA%E5%8A%A8%E7%94%BB/"/>
      <url>/2020/01/16/iOS%E5%8A%A8%E7%94%BB-Transition%E8%BD%AC%E5%9C%BA%E5%8A%A8%E7%94%BB/</url>
      
        <content type="html"><![CDATA[<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> *  UIViewAnimationOptionTransitionNone              &#x2F;&#x2F;æ²¡æœ‰æ•ˆæœ</span><br><span class="line"> *  UIViewAnimationOptionTransitionFlipFromLeft      &#x2F;&#x2F;ä»å·¦æ°´å¹³ç¿»è½¬</span><br><span class="line"> *  UIViewAnimationOptionTransitionFlipFromRight     &#x2F;&#x2F;ä»å³æ°´å¹³ç¿»è½¬</span><br><span class="line"> *  UIViewAnimationOptionTransitionCurlUp            &#x2F;&#x2F;ç¿»ä¹¦ä¸Šæ€</span><br><span class="line"> *  UIViewAnimationOptionTransitionCurlDown          &#x2F;&#x2F;ç¿»ä¹¦ä¸‹ç›–</span><br><span class="line"> *  UIViewAnimationOptionTransitionCrossDissolve     &#x2F;&#x2F;èåˆ</span><br><span class="line"> *  UIViewAnimationOptionTransitionFlipFromTop       &#x2F;&#x2F;ä»ä¸Šå‚ç›´ç¿»è½¬</span><br><span class="line"> *  UIViewAnimationOptionTransitionFlipFromBottom    &#x2F;&#x2F;ä»ä¸‹å‚ç›´ç¿»è½¬</span><br><span class="line"> *</span><br><span class="line"> *&#x2F;</span><br><span class="line"></span><br><span class="line">[UIView transitionWithView:UIApplication.sharedApplication.keyWindow</span><br><span class="line">                  duration:0.5</span><br><span class="line">                   options:UIViewAnimationOptionTransitionFlipFromLeft</span><br><span class="line">                animations:^&#123;</span><br><span class="line">                </span><br><span class="line">                 &#x2F;&#x2F; TODO: é¡µé¢è·³è½¬</span><br><span class="line">                       </span><br><span class="line">              &#125; completion:^(BOOL finished) &#123;</span><br><span class="line">    </span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> åŠ¨ç”» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iOSåŠ¨ç”»-CATransitionç§»åŠ¨åŠ¨ç”»</title>
      <link href="/2020/01/16/iOS%E5%8A%A8%E7%94%BB-CATransition%E7%A7%BB%E5%8A%A8%E5%8A%A8%E7%94%BB/"/>
      <url>/2020/01/16/iOS%E5%8A%A8%E7%94%BB-CATransition%E7%A7%BB%E5%8A%A8%E5%8A%A8%E7%94%BB/</url>
      
        <content type="html"><![CDATA[<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> *  UIViewAnimationTransitionNone              &#x2F;&#x2F;æ²¡æœ‰æ•ˆæœ</span><br><span class="line"> *  UIViewAnimationTransitionFlipFromLeft      &#x2F;&#x2F;ä»å·¦æ°´å¹³ç¿»è½¬</span><br><span class="line"> *  UIViewAnimationTransitionFlipFromRight     &#x2F;&#x2F;ä»å³æ°´å¹³ç¿»è½¬</span><br><span class="line"> *  UIViewAnimationTransitionCurlUp            &#x2F;&#x2F;ç¿»ä¹¦ä¸Šæ€</span><br><span class="line"> *  UIViewAnimationTransitionCurlDown          &#x2F;&#x2F;ç¿»ä¹¦ä¸‹ç›–</span><br><span class="line"> *  UIViewAnimationTransitionCrossDissolve     &#x2F;&#x2F;èåˆ</span><br><span class="line"> *  UIViewAnimationTransitionFlipFromTop       &#x2F;&#x2F;ä»ä¸Šå‚ç›´ç¿»è½¬</span><br><span class="line"> *  UIViewAnimationTransitionFlipFromBottom    &#x2F;&#x2F;ä»ä¸‹å‚ç›´ç¿»è½¬</span><br><span class="line"> *</span><br><span class="line"> *&#x2F;</span><br><span class="line"></span><br><span class="line">[UIView beginAnimations:@&quot;animation&quot; context:nil];</span><br><span class="line">[UIView setAnimationDuration:1.0f];</span><br><span class="line">[UIView setAnimationTransition:UIViewAnimationTransitionNone forView:containerView cache:YES];</span><br><span class="line">[UIView setAnimationCurve:UIViewAnimationCurveEaseInOut];</span><br><span class="line">&#x2F;&#x2F; äº¤æ¢å±‚çº§å…³ç³»</span><br><span class="line">[containerView exchangeSubviewAtIndex:0 withSubviewAtIndex:1];</span><br><span class="line">[UIView commitAnimations];</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> åŠ¨ç”» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iOSåŠ¨ç”»-CATransitionå±æ€§åŠ¨ç”»</title>
      <link href="/2020/01/16/iOS%E5%8A%A8%E7%94%BB-CATransition%E5%B1%9E%E6%80%A7%E5%8A%A8%E7%94%BB/"/>
      <url>/2020/01/16/iOS%E5%8A%A8%E7%94%BB-CATransition%E5%B1%9E%E6%80%A7%E5%8A%A8%E7%94%BB/</url>
      
        <content type="html"><![CDATA[<p>ç§æœ‰æ–¹æ³•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;* Common transition types. *&#x2F;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> *   cube                  &#x2F;&#x2F; ç«‹æ–¹ä½“æ—‹è½¬</span><br><span class="line"> *   suckEffect            &#x2F;&#x2F; æ”¶ç¼©åŠ¨ç”»</span><br><span class="line"> *   oglFlip               &#x2F;&#x2F; ç¿»è½¬</span><br><span class="line"> *   pageCurl              &#x2F;&#x2F; é¡µé¢æ­å¼€</span><br><span class="line"> *   pageUnCurl            &#x2F;&#x2F; æ”¾ä¸‹é¡µé¢</span><br><span class="line"> *   cemeraIrisHollowOpen  &#x2F;&#x2F; é•œå¤´æ‰“å¼€</span><br><span class="line"> *   cameraIrisHollowClose &#x2F;&#x2F; é•œå¤´å…³é—­</span><br><span class="line"> *&#x2F;</span><br><span class="line"></span><br><span class="line">&#x2F;* Common transition subtypes. *&#x2F;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> *   kCATransitionFromRight</span><br><span class="line"> *   kCATransitionFromLeft</span><br><span class="line"> *   kCATransitionFromTop</span><br><span class="line"> *   kCATransitionFromBottom</span><br><span class="line"> *&#x2F;</span><br><span class="line"></span><br><span class="line">CATransition *transition &#x3D; [CATransition animation];</span><br><span class="line">transition.duration &#x3D; 3;</span><br><span class="line">transition.type &#x3D; @&quot;oglFlip&quot;;</span><br><span class="line">transition.subtype &#x3D; kCATransitionFromTop;</span><br><span class="line">[containerView.layer addAnimation:transition forKey:nil];</span><br><span class="line">[containerView exchangeSubviewAtIndex:0 withSubviewAtIndex:1];</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> åŠ¨ç”» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iOSåŠ¨ç”»-CATransitionåè½¬åŠ¨ç”»</title>
      <link href="/2020/01/16/iOS%E5%8A%A8%E7%94%BB-CATransition%E5%8F%8D%E8%BD%AC%E5%8A%A8%E7%94%BB/"/>
      <url>/2020/01/16/iOS%E5%8A%A8%E7%94%BB-CATransition%E5%8F%8D%E8%BD%AC%E5%8A%A8%E7%94%BB/</url>
      
        <content type="html"><![CDATA[<p>ç§»åŠ¨åŠ¨ç”»</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;* Common transition types. *&#x2F;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> *   kCATransitionFade    &#x2F;&#x2F; æ¸å˜</span><br><span class="line"> *   kCATransitionMoveIn  &#x2F;&#x2F; è¦†ç›–</span><br><span class="line"> *   kCATransitionPush    &#x2F;&#x2F; æ¨å‡º</span><br><span class="line"> *   kCATransitionReveal  &#x2F;&#x2F; æ­å¼€</span><br><span class="line"> *&#x2F;</span><br><span class="line"></span><br><span class="line">&#x2F;* Common transition subtypes. *&#x2F;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> *   kCATransitionFromRight</span><br><span class="line"> *   kCATransitionFromLeft</span><br><span class="line"> *   kCATransitionFromTop</span><br><span class="line"> *   kCATransitionFromBottom</span><br><span class="line"> *&#x2F;</span><br><span class="line"></span><br><span class="line">CATransition *transition &#x3D; [CATransition animation];</span><br><span class="line">transition.duration &#x3D; 0.25;</span><br><span class="line">transition.type &#x3D; kCATransitionPush;</span><br><span class="line">transition.subtype &#x3D; kCATransitionFromRight;</span><br><span class="line">[containerView.layer addAnimation:transition forKey:nil];</span><br><span class="line">[containerView exchangeSubviewAtIndex:0 withSubviewAtIndex:1];</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> åŠ¨ç”» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iOSåŠ¨ç”»-CALayerçš„å±æ€§å’Œä½¿ç”¨(æœªå®Œç»“)</title>
      <link href="/2020/01/16/iOS%E5%8A%A8%E7%94%BB-CALayer%E7%9A%84%E5%B1%9E%E6%80%A7%E5%92%8C%E4%BD%BF%E7%94%A8(%E6%9C%AA%E5%AE%8C%E7%BB%93)/"/>
      <url>/2020/01/16/iOS%E5%8A%A8%E7%94%BB-CALayer%E7%9A%84%E5%B1%9E%E6%80%A7%E5%92%8C%E4%BD%BF%E7%94%A8(%E6%9C%AA%E5%AE%8C%E7%BB%93)/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€CALayerçš„å¸¸ç”¨å±æ€§"><a href="#ä¸€ã€CALayerçš„å¸¸ç”¨å±æ€§" class="headerlink" title="ä¸€ã€CALayerçš„å¸¸ç”¨å±æ€§"></a>ä¸€ã€CALayerçš„å¸¸ç”¨å±æ€§</h2><blockquote><ul><li><p>@propertyCGPoint position;<br>å›¾å±‚ä¸­å¿ƒç‚¹çš„ä½ç½®ï¼Œç±»ä¼¼ä¸UIViewçš„centerï¼›ç”¨æ¥è®¾ç½®CALayeråœ¨çˆ¶å±‚ä¸­çš„ä½ç½®ï¼›ä»¥çˆ¶å±‚çš„å·¦ä¸Šè§’ä¸ºåŸç‚¹ï¼ˆ0ï¼Œ0ï¼‰</p></li><li><p>@property CGPoint anchorPoint;<br>ç§°ã€å®šä½ç‚¹ã€ã€ã€é”šç‚¹ã€ï¼Œè¯¥æè¿°æ˜¯ç›¸å¯¹äºxã€yä½ç½®æ¯”ä¾‹è€Œè¨€çš„é»˜è®¤åœ¨å›¾åƒä¸­å¿ƒç‚¹ï¼ˆ0.5ã€0.5ï¼‰çš„ä½ç½®ï¼›å†³å®šç€CALayerèº«ä¸Šçš„å“ªä¸ªç‚¹ä¼šå†positionå±æ€§æ‰€æŒ‡çš„ä½ç½®ï¼Œä»¥è‡ªå·±çš„å·¦ä¸Šè§’ä¸ºåŸç‚¹ï¼ˆ0ï¼Œ0ï¼‰ï¼›å®ƒçš„xã€yå–å€¼èŒƒå›´éƒ½æ˜¯0~1</p></li><li><p>@property(nullable) CGColorRef backgroundColor<br>å›¾å±‚èƒŒæ™¯é¢œè‰²</p></li><li><p>@property(nullable) CGColorRef borderColor<br>å›¾å±‚è¾¹æ¡†é¢œè‰²</p></li><li><p>@property CGFloat borderWidth<br>å›¾å±‚è¾¹æ¡†å®½åº¦</p></li><li><p>@property CGRect bounds<br>å›¾å±‚å¤§å°</p></li><li><p>@property(nullable, strong) id contents<br>å›¾å±‚æ˜¾ç¤ºå†…å®¹ï¼Œä¾‹å¦‚å¯ä»¥å°†å›¾ç‰‡ä½œä¸ºå›¾å±‚å†…å®¹æ˜¾ç¤º</p></li><li><p>@property CGRect contentsRect<br>å›¾å±‚æ˜¾ç¤ºå†…å®¹çš„å¤§å°å’Œä½ç½®</p></li><li><p>@property CGFloat cornerRadius<br>åœ†è§’åŠå¾„</p></li><li><p>@property(getter=isDoubleSided) BOOL doubleSided<br>å›¾å±‚èƒŒæ™¯æ˜¯å¦æ˜¾ç¤ºï¼Œé»˜è®¤æ˜¯YES</p></li><li><p>@property CGRect frame<br>å›¾å±‚å¤§å°å’Œä½ç½®ï¼Œä¸æ”¯æŒéšå¼åŠ¨ç”»ï¼Œæ‰€ä»¥CALyaerä¸­å¾ˆå°‘ä½¿ç”¨frameï¼Œé€šå¸¸ä½¿ç”¨boundå’Œpositionä»£æ›¿</p></li><li><p>@property(getter=isHidden) BOOL hidden<br>æ˜¯å¦éšè—</p></li><li><p>@property(nullable, strong) CALayer *mask<br>å›¾å±‚è’™ç‰ˆ</p></li><li><p>@property BOOL masksToBounds<br>å­å›¾å±‚æ˜¯å¦å‰ªåˆ‡å›¾å±‚è¾¹ç•Œï¼Œé»˜è®¤æ˜¯NO</p></li><li><p>@property float opacit;<br>å›¾å±‚é€æ˜åº¦ï¼Œç±»ä¼¼ä¸UIViewçš„alpha</p></li><li><p>@property(nullable) CGColorRef shadowColor<br>é˜´å½±é¢œè‰²</p></li><li><p>@property CGSize shadowOffset<br>é˜´å½±åç§»é‡</p></li><li><p>@property float shadowOpacity<br>é˜´å½±é€æ˜åº¦ï¼Œæ³¨æ„é»˜è®¤ä¸º0ï¼Œå¦‚æœè®¾ç½®é˜´å½±å¿…é¡»è®¾ç½®æ­¤å±æ€§</p></li><li><p>@property(nullable) CGPathRef shadowPath<br>é˜´å½±å½¢çŠ¶</p></li><li><p>@property CGFloat shadowRadius<br>é˜´å½±æ¨¡ç³ŠåŠå¾„</p></li><li><p>@property(nullable, copy) NSArray</p></li></ul></blockquote><h2 id="äºŒã€CALayerä¸å¸¸ç”¨å±æ€§"><a href="#äºŒã€CALayerä¸å¸¸ç”¨å±æ€§" class="headerlink" title="äºŒã€CALayerä¸å¸¸ç”¨å±æ€§"></a>äºŒã€CALayerä¸å¸¸ç”¨å±æ€§</h2><blockquote><ul><li><p>@property CGFloat zPosition<br>å›¾å±‚ä¸­å¿ƒç‚¹åœ¨zè½´ä¸­çš„ä½ç½®</p></li><li><p>@property CGFloat anchorPointZ<br>å›¾å±‚åœ¨zè½´ä¸­çš„é”šç‚¹ï¼›</p></li><li><p>æ–¹æ³• - (CGAffineTransform)affineTransform</p></li><li><p>æ–¹æ³• - (void)setAffineTransform:(CGAffineTransform)m<br>ä»¥ä¸Šå±æ€§ä¸ºå›¾å±‚å½¢å˜ï¼›è¯¥å±æ€§å€¼æŒ‡å®šä¸€ä¸ªCGAffineTransformå¯¹è±¡ï¼Œè¯¥å¯¹è±¡ä»£è¡¨å¯¹CALayeræ‰§è¡ŒXã€Yä¸¤ä¸ªç»´åº¦ï¼ˆä¹Ÿå°±æ˜¯å¹³é¢ï¼‰ä¸Šçš„æ—‹è½¬ã€ç¼©æ”¾ã€ä½ç§»ã€æ–œåˆ‡ã€é•œåƒç­‰å˜æ¢çŸ©é˜µ</p></li><li><p>@property(nullable, readonly) CALayer *superlayer<br>å›¾å±‚çš„çˆ¶å›¾å±‚</p></li></ul></blockquote><h2 id="ä¸‰ã€CALayerå›¾å±‚æ“ä½œ"><a href="#ä¸‰ã€CALayerå›¾å±‚æ“ä½œ" class="headerlink" title="ä¸‰ã€CALayerå›¾å±‚æ“ä½œ"></a>ä¸‰ã€CALayerå›¾å±‚æ“ä½œ</h2><blockquote><ul><li><p>æ–¹æ³•  - (void)addSublayer:(CALayer *)layer<br>æ·»åŠ å­å›¾å±‚</p></li><li><p>æ–¹æ³•  - (void)removeFromSuperlayer<br>å°†è‡ªå·±ä»çˆ¶å›¾å±‚ä¸­ç§»é™¤</p></li><li><p>æ–¹æ³• - (void)insertSublayer:(CALayer *)layer atIndex:(unsigned)idx<br>åœ¨è‡ªå·±å­å›¾å±‚æ•°ç»„ä¸­çš„ç¬¬idxä½ç½®æ·»åŠ å›¾å±‚</p></li><li><p>æ–¹æ³•  - (void)insertSublayer:(CALayer )layer below:(nullable CALayer )sibling<br>å°†å›¾å±‚layeræ·»åŠ åœ¨å­å›¾å±‚siblingçš„ä¸‹é¢</p></li><li><p>æ–¹æ³• - (void)insertSublayer:(CALayer )layer above:(nullable CALayer )sibling<br>å°†å›¾å±‚layeræ·»åŠ åœ¨å­å›¾å±‚siblingçš„ä¸Šé¢</p></li><li><p>æ–¹æ³• - (void)replaceSublayer:(CALayer )layer with:(CALayer )layer2<br>å°†å›¾å±‚layeræ›¿æ¢layer2ï¼›</p></li></ul></blockquote><h2 id="å››ã€CALayeråŠ¨ç”»æ“ä½œ"><a href="#å››ã€CALayeråŠ¨ç”»æ“ä½œ" class="headerlink" title="å››ã€CALayeråŠ¨ç”»æ“ä½œ"></a>å››ã€CALayeråŠ¨ç”»æ“ä½œ</h2><blockquote><ul><li><p>æ–¹æ³•  - (void)addAnimation:(CAAnimation )anim forKey:(nullable NSString )key<br>å›¾å±‚æ·»åŠ æŸä¸€å±æ€§çš„åŠ¨ç”»</p></li><li><p>æ–¹æ³• - (nullable NSArray&lt; NSString &gt; )animationKeys<br>è·å–æ‰€æœ‰åŠ¨ç”»çš„å±æ€§</p></li><li><p>æ–¹æ³• - (nullable CAAnimation )animationForKey:(NSString )key<br>è·å–æŸä¸€å±æ€§çš„åŠ¨ç”»</p></li><li><p>æ–¹æ³• - (void)removeAnimationForKey:(NSString *)key<br>ç§»é™¤æŸä¸€å±æ€§åŠ¨ç”»</p></li><li><p>æ–¹æ³• - (void)removeAllAnimations<br>ç§»é™¤æ‰€æœ‰åŠ¨ç”»</p></li></ul></blockquote><h2 id="äº”ã€CALayerå­ç±»å…¶ä»–è¯´æ˜"><a href="#äº”ã€CALayerå­ç±»å…¶ä»–è¯´æ˜" class="headerlink" title="äº”ã€CALayerå­ç±»å…¶ä»–è¯´æ˜"></a>äº”ã€CALayerå­ç±»å…¶ä»–è¯´æ˜</h2><table><thead><tr><th>å­ç±»åç§°</th><th>ç”¨é€”</th></tr></thead><tbody><tr><td>CAEmitterLayer</td><td>å‘å°„å™¨å±‚ï¼Œç”¨æ¥æ§åˆ¶ç²’å­æ•ˆæœ</td></tr><tr><td>CAGradientLayer</td><td>æ¢¯åº¦å±‚ï¼Œé¢œè‰²æ¸å˜</td></tr><tr><td>CAEAGLayer</td><td>ç”¨OpenGL ESç»˜åˆ¶çš„å±‚</td></tr><tr><td>CAReplicationLayer</td><td>ç”¨æ¥è‡ªåŠ¨å¤åˆ¶sublayer</td></tr><tr><td>CAShapeLayer</td><td>ç»˜åˆ¶ç«‹ä½“çš„è´å¡å°”æ›²çº¿</td></tr><tr><td>CAScrollLayer</td><td>ç”¨æ¥ç®¡ç†å¯æ»‘åŠ¨çš„åŒºåŸŸ</td></tr><tr><td>CATextLayer</td><td>å¯ä»¥ç»˜åˆ¶AttributeString</td></tr><tr><td>CATiledLayer</td><td>ç”¨æ¥ç®¡ç†ä¸€å‰¯å¯ä»¥è¢«åˆ†å‰²çš„å¤§å›¾</td></tr><tr><td>CATransformLayer</td><td>ç”¨æ¥æ¸²æŸ“3D layerçš„å±‚æ¬¡ç»“æ„</td></tr></tbody></table><h3 id="1-CAShapeLayer"><a href="#1-CAShapeLayer" class="headerlink" title="1. CAShapeLayer"></a>1. CAShapeLayer</h3><p>CAShapeLayerå±äºQuartzCoreæ¡†æ¶ï¼Œç»§æ‰¿è‡ªCALayerã€‚CAShapeLayeræ˜¯åœ¨åæ ‡ç³»å†…ç»˜åˆ¶è´å¡å°”æ›²çº¿çš„ï¼Œé€šè¿‡ç»˜åˆ¶è´å¡å°”æ›²çº¿ï¼Œè®¾ç½®shape(å½¢çŠ¶)çš„path(è·¯å¾„)ï¼Œä»è€Œç»˜åˆ¶å„ç§å„æ ·çš„å›¾å½¢ä»¥åŠä¸è§„åˆ™å›¾å½¢ã€‚å› æ­¤ï¼Œä½¿ç”¨CAShapeLayeréœ€è¦ä¸UIBezierPathä¸€èµ·ä½¿ç”¨ã€‚<br>UIBezierPathç±»å…è®¸ä½ åœ¨è‡ªå®šä¹‰çš„ View ä¸­ç»˜åˆ¶å’Œæ¸²æŸ“ç”±ç›´çº¿å’Œæ›²çº¿ç»„æˆçš„è·¯å¾„.ã€‚ä½ å¯ä»¥åœ¨åˆå§‹åŒ–çš„æ—¶å€™ç›´æ¥ä¸ºä½ çš„UIBezierPathæŒ‡å®šä¸€ä¸ªå‡ ä½•å›¾å½¢ã€‚<br>é€šä¿—ç‚¹å°±æ˜¯UIBezierPathç”¨æ¥æŒ‡å®šç»˜åˆ¶å›¾å½¢è·¯å¾„ï¼Œè€ŒCAShapeLayerå°±æ˜¯æ ¹æ®è·¯å¾„æ¥ç»˜å›¾çš„ã€‚</p><h4 id="å±æ€§"><a href="#å±æ€§" class="headerlink" title="å±æ€§"></a>å±æ€§</h4><blockquote><ul><li><p>1ã€@property(nullable) CGPathRef path;  å‘ˆç°çš„å½¢çŠ¶çš„è·¯å¾„</p></li><li><p>2ã€@property(nullable) CGColorRef fillColor;å¡«å……è·¯å¾„çš„é¢œè‰²  </p></li><li><p>3ã€@property(copy) CAShapeLayerFillRule fillRule;   å½“åœ¨å¡«å……é¢œè‰²çš„æ—¶å€™åˆ™å°±éœ€è¦è¿™ç§å¡«å……è§„åˆ™ï¼Œå€¼æœ‰ä¸¤ç§ï¼Œéé›¶å’Œå¥‡å¶æ•°ï¼Œä½†é»˜è®¤æ˜¯éé›¶å€¼ã€‚</p></li><li><p>4ã€@property(nullable) CGColorRef strokeColor;è®¾ç½®æè¾¹è‰²ï¼Œé»˜è®¤æ— è‰²ã€‚</p></li><li><p>5ã€@property CGFloat strokeStart; ç»˜åˆ¶è¾¹çº¿è½®å»“è·¯å¾„çš„å­åŒºåŸŸã€‚è¯¥å€¼å¿…é¡»åœ¨[0,1]èŒƒå›´ï¼Œ0ä»£è¡¨è·¯å¾„çš„å¼€å§‹ï¼Œ1ä»£è¡¨è·¯å¾„çš„ç»“æŸã€‚ é»˜è®¤ä¸º0</p></li><li><p>6ã€@property CGFloat strokeEnd; é»˜è®¤ä¸º1</p></li><li><p>7ã€@property CGFloat lineWidth; çº¿çš„å®½åº¦ é»˜è®¤ä¸º1</p></li><li><p>8ã€@property CGFloat miterLimit;æœ€å¤§æ–œæ¥é•¿åº¦ã€‚æ–œæ¥é•¿åº¦æŒ‡çš„æ˜¯åœ¨ä¸¤æ¡çº¿äº¤æ±‡å¤„å’Œå¤–äº¤ä¹‹é—´çš„è·ç¦»ã€‚åªæœ‰lineJoinå±æ€§ä¸ºkCALineJoinMiteræ—¶miterLimitæ‰æœ‰æ•ˆã€‚è¾¹è§’çš„è§’åº¦è¶Šå°ï¼Œæ–œæ¥é•¿åº¦å°±ä¼šè¶Šå¤§ã€‚ä¸ºäº†é¿å…æ–œæ¥é•¿åº¦è¿‡é•¿ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨miterLimitå±æ€§ã€‚å¦‚æœæ–œæ¥é•¿åº¦è¶…è¿‡miterLimitçš„å€¼ï¼Œè¾¹è§’ä¼šä»¥lineJoinçš„â€œbevelâ€å³kCALineJoinBevelç±»å‹æ¥æ˜¾ç¤ºã€‚</p></li><li><p>9ã€@property(copy) CAShapeLayerLineCap lineCap; çº¿ç«¯ç‚¹ç±»å‹ï¼Œå€¼æœ‰ä¸‰ä¸ªç±»å‹ï¼Œåˆ†åˆ«ä¸ºkCALineCapButt ã€kCALineCapRound ã€kCALineCapSquareï¼Œé»˜è®¤å€¼ä¸ºButtï¼›</p></li><li><p>10ã€@property(copy) CAShapeLayerLineJoin lineJoin;lineJoinä¸ºçº¿è¿æ¥ç±»å‹ï¼Œå…¶å€¼ä¹Ÿæœ‰ä¸‰ä¸ªç±»å‹ï¼Œåˆ†åˆ«ä¸ºkCALineJoinMiterã€kCALineJoinRoundã€kCALineJoinBevelï¼Œé»˜è®¤å€¼æ˜¯Miterã€‚</p></li><li><p>11ã€@property CGFloat lineDashPhase;ä¸ºçº¿å‹æ¨¡ç‰ˆçš„èµ·å§‹ä½ç½®ï¼›lineDashPatternä¸ºçº¿æ€§æ¨¡ç‰ˆï¼Œè¿™æ˜¯ä¸€ä¸ªNSNumberçš„æ•°ç»„ï¼Œç´¢å¼•ä»1å¼€å§‹è®°ï¼Œå¥‡æ•°ä½æ•°å€¼è¡¨ç¤ºå®çº¿é•¿åº¦ï¼Œå¶æ•°ä½æ•°å€¼è¡¨ç¤ºç©ºç™½é•¿åº¦ã€‚<br>æ³¨ï¼šfillColorä¸strokeColoréƒ½æ˜¯åœ¨æœ‰UIBezierPathå‚æ•°é…ç½®çš„æƒ…å†µä¸‹æ‰èƒ½å‘ç”Ÿä½œç”¨</p></li><li><p>12ã€@property(nullable, copy) NSArray&lt;NSNumber *&gt; *lineDashPattern;</p></li></ul></blockquote><h3 id="2-CAReplicationLayer"><a href="#2-CAReplicationLayer" class="headerlink" title="2.CAReplicationLayer"></a>2.CAReplicationLayer</h3><h4 id="å±æ€§-1"><a href="#å±æ€§-1" class="headerlink" title="å±æ€§"></a>å±æ€§</h4><blockquote><ul><li><p>1ã€@property NSInteger instanceCount;  å¤åˆ¶subLayerä¸ªæ•°ï¼Œé»˜è®¤ä¸º1</p></li><li><p>2ã€@property BOOL preservesDepth; æ˜¯å¦å°†3Dä¾‹å­ç³»ç»Ÿå¹³é¢åŒ–åˆ°ä¸€ä¸ªå›¾å±‚ï¼ˆé»˜è®¤å€¼ï¼‰æˆ–è€…å¯ä»¥åœ¨3Dç©ºé—´ä¸­æ··åˆå…¶ä»–çš„å›¾å±‚</p></li><li><p>3ã€@property CFTimeInterval instanceDelay; è®¾ç½®å¤åˆ¶å­å±‚çš„å»¶è¿ŸåŠ¨ç”»æ—¶é•¿</p></li><li><p>4ã€@property CATransform3D instanceTransform; è®¾ç½®å¤åˆ¶å­å±‚çš„ç›¸å¯¹ä½ç½®</p></li><li><p>5ã€@property(nullable) CGColorRef instanceColor; å­å±‚é¢œè‰²ï¼Œä¼šå’ŒåŸç”Ÿå­å±‚èƒŒæ™¯è‰²å†²çªï¼Œå› æ­¤äºŒè€…é€‰å…¶ä¸€è®¾ç½®</p></li><li><p>6ã€@property float instanceRedOffset;<br>è®¾ç½®æ¯ä¸ªå¤åˆ¶å›¾å±‚ç›¸å¯¹ä¸Šä¸€ä¸ªå¤åˆ¶å›¾å±‚çš„çº¢è‰²åç§»é‡</p></li><li><p>7ã€@property float instanceRedOffset;<br>è®¾ç½®æ¯ä¸ªå¤åˆ¶å›¾å±‚ç›¸å¯¹ä¸Šä¸€ä¸ªå¤åˆ¶å›¾å±‚çš„ç»¿è‰²åç§»é‡</p></li><li><p>8ã€@property float instanceBlueOffset;è®¾ç½®æ¯ä¸ªå¤åˆ¶å›¾å±‚ç›¸å¯¹ä¸Šä¸€ä¸ªå¤åˆ¶å›¾å±‚çš„è“è‰²åç§»é‡</p></li><li><p>9ã€@property float instanceAlphaOffset;è®¾ç½®æ¯ä¸ªå¤åˆ¶å›¾å±‚ç›¸å¯¹ä¸Šä¸€ä¸ªå¤åˆ¶å›¾å±‚çš„é€æ˜åº¦åç§»é‡</p></li></ul></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> åŠ¨ç”» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iOSåŠ¨ç”»-CAAniamtionçš„å±æ€§å’Œä½¿ç”¨</title>
      <link href="/2020/01/16/iOS%E5%8A%A8%E7%94%BB-CAAniamtion%E7%9A%84%E5%B1%9E%E6%80%A7%E5%92%8C%E4%BD%BF%E7%94%A8/"/>
      <url>/2020/01/16/iOS%E5%8A%A8%E7%94%BB-CAAniamtion%E7%9A%84%E5%B1%9E%E6%80%A7%E5%92%8C%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h2 id="CAAnimation"><a href="#CAAnimation" class="headerlink" title="CAAnimation"></a>CAAnimation</h2><p>CAAnimationæ˜¯æ‰€æœ‰åŠ¨ç”»å¯¹è±¡çš„çˆ¶ç±»ï¼Œè´Ÿè´£æ§åˆ¶åŠ¨ç”»çš„æŒç»­æ—¶é—´å’Œé€Ÿåº¦ï¼Œæ˜¯ä¸ªæŠ½è±¡ç±»ï¼Œä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼Œåº”è¯¥ä½¿ç”¨å®ƒå…·ä½“çš„å­ç±»ã€‚</p><h4 id="å±æ€§"><a href="#å±æ€§" class="headerlink" title="å±æ€§"></a>å±æ€§</h4><blockquote><ul><li><p>durationï¼šåŠ¨ç”»çš„æŒç»­æ—¶é—´</p></li><li><p>repeatCountï¼šåŠ¨ç”»çš„é‡å¤æ¬¡æ•°</p></li><li><p>repeatDurationï¼šåŠ¨ç”»çš„é‡å¤æ—¶é—´</p></li><li><p>removedOnCompletionï¼šé»˜è®¤ä¸ºYESï¼Œä»£è¡¨åŠ¨ç”»æ‰§è¡Œå®Œæ¯•åå°±ä»å›¾å±‚ä¸Šç§»é™¤ï¼Œå›¾å½¢ä¼šæ¢å¤åˆ°åŠ¨ç”»æ‰§è¡Œå‰çš„çŠ¶æ€ã€‚å¦‚æœæƒ³è®©å›¾å±‚ä¿æŒæ˜¾ç¤ºåŠ¨ç”»æ‰§è¡Œåçš„çŠ¶æ€ï¼Œé‚£å°±è®¾ç½®ä¸ºNOï¼Œä¸è¿‡è¿˜è¦è®¾ç½®fillModeä¸ºkCAFillModeForwards</p></li><li><p>fillModeï¼šå†³å®šå½“å‰å¯¹è±¡åœ¨éactiveæ—¶é—´æ®µçš„è¡Œä¸ºã€‚æ¯”å¦‚åŠ¨ç”»å¼€å§‹ä¹‹å‰,åŠ¨ç”»ç»“æŸä¹‹å</p></li><li><p>beginTimeï¼šå¯ä»¥ç”¨æ¥è®¾ç½®åŠ¨ç”»å»¶è¿Ÿæ‰§è¡Œæ—¶é—´ï¼Œè‹¥æƒ³å»¶è¿Ÿ2sï¼Œå°±è®¾ç½®ä¸ºCACurrentMediaTime()+2ï¼ŒCACurrentMediaTime()ä¸ºå›¾å±‚çš„å½“å‰æ—¶é—´</p></li><li><p>timingFunctionï¼šé€Ÿåº¦æ§åˆ¶å‡½æ•°ï¼Œæ§åˆ¶åŠ¨ç”»è¿è¡Œçš„èŠ‚å¥</p></li><li><p>delegateï¼šåŠ¨ç”»ä»£ç†</p></li></ul></blockquote><h2 id="å­ç±»"><a href="#å­ç±»" class="headerlink" title="å­ç±»"></a>å­ç±»</h2><h3 id="1-CAPropertyAnimation"><a href="#1-CAPropertyAnimation" class="headerlink" title="1.CAPropertyAnimation"></a>1.CAPropertyAnimation</h3><p>æ˜¯CAAnimationçš„å­ç±»ï¼Œä¹Ÿæ˜¯ä¸ªæŠ½è±¡ç±»ï¼Œè¦æƒ³åˆ›å»ºåŠ¨ç”»å¯¹è±¡ï¼Œåº”è¯¥ä½¿ç”¨å®ƒçš„ä¸¤ä¸ªå­ç±»ï¼šCABasicAnimationå’ŒCAKeyframeAnimationã€‚</p><blockquote><ul><li>keyPath é€šè¿‡æŒ‡å®šCALayerçš„ä¸€ä¸ªå±æ€§åç§°ä¸ºkeyPath(NSStringç±»å‹)ï¼Œå¹¶ä¸”å¯¹CALayerçš„è¿™ä¸ªå±æ€§çš„å€¼è¿›è¡Œä¿®æ”¹ï¼Œè¾¾åˆ°ç›¸åº”çš„åŠ¨ç”»æ•ˆæœã€‚æ¯”å¦‚ï¼ŒæŒ‡å®š@â€positionâ€ä¸ºkeyPathï¼Œå°±ä¿®æ”¹CALayerçš„positionå±æ€§çš„å€¼ï¼Œä»¥è¾¾åˆ°å¹³ç§»çš„åŠ¨ç”»æ•ˆæœã€‚</li></ul></blockquote><h3 id="2-CABasicAnimation"><a href="#2-CABasicAnimation" class="headerlink" title="2.CABasicAnimation"></a>2.CABasicAnimation</h3><blockquote><ul><li><p>fromValueï¼škeyPathç›¸åº”å±æ€§çš„åˆå§‹å€¼ã€‚</p></li><li><p>toValueï¼škeyPathç›¸åº”å±æ€§çš„ç»“æŸå€¼ã€‚</p></li><li><p>éšç€åŠ¨ç”»çš„è¿›è¡Œï¼Œåœ¨é•¿åº¦ä¸ºdurationçš„æŒç»­æ—¶é—´å†…ï¼ŒkeyPathç›¸åº”å±æ€§çš„å€¼ä»fromValueæ¸æ¸åœ°å˜ä¸ºtoValueã€‚</p></li><li><p>å¦‚æœfillMode=kCAFillModeForwardså’ŒremovedOnComletion=NOï¼Œé‚£ä¹ˆåœ¨åŠ¨ç”»æ‰§è¡Œå®Œæ¯•åï¼Œå›¾å±‚ä¼šä¿æŒæ˜¾ç¤ºåŠ¨ç”»æ‰§è¡Œåçš„çŠ¶æ€ã€‚ä½†åœ¨å®è´¨ä¸Šï¼Œå›¾å±‚çš„å±æ€§å€¼è¿˜æ˜¯åŠ¨ç”»æ‰§è¡Œå‰çš„åˆå§‹å€¼ï¼Œå¹¶æ²¡æœ‰çœŸæ­£è¢«æ”¹å˜ã€‚æ¯”å¦‚ï¼ŒCALayerçš„positionåˆå§‹å€¼ä¸º(0,0)ï¼ŒCABasicAnimationçš„fromValueä¸º(10,10)ï¼ŒtoValueä¸º(100,100)ï¼Œè™½ç„¶åŠ¨ç”»æ‰§è¡Œå®Œæ¯•åå›¾å±‚ä¿æŒåœ¨(100,100)è¿™ä¸ªä½ç½®ï¼Œå®è´¨ä¸Šå›¾å±‚çš„positionè¿˜æ˜¯ä¸º(0,0)ã€‚</p></li></ul></blockquote><h3 id="3-CAKeyframeAnimation"><a href="#3-CAKeyframeAnimation" class="headerlink" title="3.CAKeyframeAnimation"></a>3.CAKeyframeAnimation</h3><p>CApropertyAnimationçš„å­ç±»ï¼Œè·ŸCABasicAnimationçš„åŒºåˆ«æ˜¯ï¼šCABasicAnimationåªèƒ½ä»ä¸€ä¸ªæ•°å€¼(fromValue)å˜åˆ°å¦ä¸€ä¸ªæ•°å€¼(toValue)ï¼Œè€ŒCAKeyframeAnimationä¼šä½¿ç”¨ä¸€ä¸ªNSArrayä¿å­˜è¿™äº›æ•°å€¼ã€‚</p><blockquote><ul><li><p>valuesï¼šå°±æ˜¯ä¸Šè¿°çš„NSArrayå¯¹è±¡ã€‚é‡Œé¢çš„å…ƒç´ ç§°ä¸ºâ€å…³é”®å¸§â€(keyframe)ã€‚åŠ¨ç”»å¯¹è±¡ä¼šåœ¨æŒ‡å®šçš„æ—¶é—´(duration)å†…ï¼Œä¾æ¬¡æ˜¾ç¤ºvaluesæ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå…³é”®å¸§ã€‚</p></li><li><p>pathï¼šå¯ä»¥è®¾ç½®ä¸€ä¸ªCGPathRef\CGMutablePathRef,è®©å±‚è·Ÿç€è·¯å¾„ç§»åŠ¨ã€‚pathåªå¯¹CALayerçš„anchorPointå’Œpositionèµ·ä½œç”¨ã€‚å¦‚æœä½ è®¾ç½®äº†pathï¼Œé‚£ä¹ˆvalueså°†è¢«å¿½ç•¥ã€‚</p></li><li><p>keyTimesï¼šå¯ä»¥ä¸ºå¯¹åº”çš„å…³é”®å¸§æŒ‡å®šå¯¹åº”çš„æ—¶é—´ç‚¹,å…¶å–å€¼èŒƒå›´ä¸º0åˆ°1.0,keyTimesä¸­çš„æ¯ä¸€ä¸ªæ—¶é—´å€¼éƒ½å¯¹åº”valuesä¸­çš„æ¯ä¸€å¸§.å½“keyTimesæ²¡æœ‰è®¾ç½®çš„æ—¶å€™,å„ä¸ªå…³é”®å¸§çš„æ—¶é—´æ˜¯å¹³åˆ†çš„ã€‚</p></li><li><p>CABasicAnimationå¯çœ‹åšæ˜¯æœ€å¤šåªæœ‰2ä¸ªå…³é”®å¸§çš„CAKeyframeAnimationã€‚</p></li></ul></blockquote><h3 id="4-CAAnimationGroup"><a href="#4-CAAnimationGroup" class="headerlink" title="4.CAAnimationGroup"></a>4.CAAnimationGroup</h3><p>CAAnimationçš„å­ç±»ï¼Œå¯ä»¥ä¿å­˜ä¸€ç»„åŠ¨ç”»å¯¹è±¡ï¼Œå°†CAAnimationGroupå¯¹è±¡åŠ å…¥å±‚åï¼Œç»„ä¸­æ‰€æœ‰åŠ¨ç”»å¯¹è±¡å¯ä»¥åŒæ—¶å¹¶å‘è¿è¡Œã€‚</p><blockquote><ul><li><p>animationsï¼šç”¨æ¥ä¿å­˜ä¸€ç»„åŠ¨ç”»å¯¹è±¡çš„NSArrayã€‚</p></li><li><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸€ç»„åŠ¨ç”»å¯¹è±¡æ˜¯åŒæ—¶è¿è¡Œçš„ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è®¾ç½®åŠ¨ç”»å¯¹è±¡çš„beginTimeå±æ€§æ¥æ›´æ”¹åŠ¨ç”»çš„å¼€å§‹æ—¶é—´ã€‚</p></li></ul></blockquote><h3 id="5-CATransition"><a href="#5-CATransition" class="headerlink" title="5.CATransition"></a>5.CATransition</h3><p>CAAnimationçš„å­ç±»ï¼Œç”¨äºåšè½¬åœºåŠ¨ç”»ï¼Œèƒ½å¤Ÿä¸ºå±‚æä¾›ç§»å‡ºå±å¹•å’Œç§»å…¥å±å¹•çš„åŠ¨ç”»æ•ˆæœã€‚iOSæ¯”Mac OS Xçš„è½¬åœºåŠ¨ç”»æ•ˆæœå°‘ä¸€ç‚¹ã€‚UINavigationControllerå°±æ˜¯é€šè¿‡CATransitionå®ç°äº†å°†æ§åˆ¶å™¨çš„è§†å›¾æ¨å…¥å±å¹•çš„åŠ¨ç”»æ•ˆæœã€‚</p><blockquote><ul><li><p>typeï¼šåŠ¨ç”»è¿‡æ¸¡ç±»å‹ã€‚</p></li><li><p>subtypeï¼šåŠ¨ç”»è¿‡æ¸¡æ–¹å‘ã€‚</p></li><li><p>startProgressï¼šåŠ¨ç”»èµ·ç‚¹(åœ¨æ•´ä½“åŠ¨ç”»çš„ç™¾åˆ†æ¯”)ã€‚</p></li><li><p>endProgressï¼šåŠ¨ç”»ç»ˆç‚¹(åœ¨æ•´ä½“åŠ¨ç”»çš„ç™¾åˆ†æ¯”)ã€‚</p></li></ul></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> åŠ¨ç”» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iOSç¬¬ä¸‰æ–¹åº“-YYCache</title>
      <link href="/2020/01/16/iOS%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93-YYCache/"/>
      <url>/2020/01/16/iOS%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93-YYCache/</url>
      
        <content type="html"><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>ä¸€ä¸ªé«˜æ€§èƒ½ iOS ç¼“å­˜æ¡†æ¶ã€‚</p><p>ä¸»è¦ç”±<code>YYDiskCache</code>ä¸<code>YYMemoryCache</code>ç»„æˆã€‚å…¶ä¸­<code>YYDiskCache</code>æ˜¯ä½œä¸ºæŒä¹…åŒ–å‚¨å­˜ï¼Œé€šè¿‡<code>sqlite</code>çš„å½¢å¼å‚¨å­˜åœ¨æ²™ç›’ä¸­<code>Library/Caches/&lt;ç¼“å­˜åœ°å€åç§°&gt;</code>ã€‚<br>ç¼“å­˜çš„å¯¹è±¡éœ€è¦éµå¾ª<code>NSCoding</code>åè®®ï¼Œå¹¶å®ç°åè®®æ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡<code>YYModel</code>ä¸€é”®å½’æ¡£ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- (void)encodeWithCoder:(NSCoder*)aCoder &#123;</span><br><span class="line">    [self yy_modelEncodeWithCoder:aCoder];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (id)initWithCoder:(NSCoder*)aDecoder &#123;</span><br><span class="line">    self &#x3D; [super init];</span><br><span class="line">    return [self yy_modelInitWithCoder:aDecoder];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ¥å£è¯´æ˜"><a href="#æ¥å£è¯´æ˜" class="headerlink" title="æ¥å£è¯´æ˜"></a>æ¥å£è¯´æ˜</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">@interface YYCache : NSObject</span><br><span class="line"></span><br><span class="line">&#x2F;** ç¼“å­˜çš„åç§° *&#x2F;</span><br><span class="line">@property (copy, readonly) NSString *name;</span><br><span class="line"></span><br><span class="line">&#x2F;** å†…å­˜ç¼“å­˜ *&#x2F;</span><br><span class="line">@property (strong, readonly) YYMemoryCache *memoryCache;</span><br><span class="line"></span><br><span class="line">&#x2F;** ç£ç›˜ç¼“å­˜ *&#x2F;</span><br><span class="line">@property (strong, readonly) YYDiskCache *diskCache;</span><br><span class="line"></span><br><span class="line">&#x2F;** åˆå§‹åŒ–æ–¹å¼ä¸€ï¼Œè®¾ç½®ç¼“å­˜åç§° *&#x2F;</span><br><span class="line">- (nullable instancetype)initWithName:(NSString *)name;</span><br><span class="line"></span><br><span class="line">&#x2F;** åˆå§‹åŒ–æ–¹å¼äºŒï¼Œè®¾ç½®ç¼“å­˜è·¯å¾„ *&#x2F;</span><br><span class="line">- (nullable instancetype)initWithPath:(NSString *)path NS_DESIGNATED_INITIALIZER;</span><br><span class="line"></span><br><span class="line">&#x2F;** ä¾¿åˆ©æ„é€ åˆå§‹åŒ–ï¼Œè®¾ç½®ç¼“å­˜åç§° *&#x2F;</span><br><span class="line">+ (nullable instancetype)cacheWithName:(NSString *)name;</span><br><span class="line"></span><br><span class="line">&#x2F;** ä¾¿åˆ©æ„é€ åˆå§‹åŒ–ï¼Œè®¾ç½®ç¼“å­˜è·¯å¾„ *&#x2F;</span><br><span class="line">+ (nullable instancetype)cacheWithPath:(NSString *)path;</span><br><span class="line"></span><br><span class="line">&#x2F;** æ–¹æ³•å¤±æ•ˆ *&#x2F;</span><br><span class="line">- (instancetype)init UNAVAILABLE_ATTRIBUTE;</span><br><span class="line">&#x2F;** æ–¹æ³•å¤±æ•ˆ *&#x2F;</span><br><span class="line">+ (instancetype)new UNAVAILABLE_ATTRIBUTE;</span><br><span class="line"></span><br><span class="line">#pragma mark - Access Methods</span><br><span class="line">&#x2F;&#x2F;&#x2F;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&#x2F;&#x2F;&#x2F; @name Access Methods</span><br><span class="line">&#x2F;&#x2F;&#x2F;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line"></span><br><span class="line">&#x2F;** åˆ¤æ–­ç¼“å­˜ä¸­æ˜¯å¦å­˜åœ¨ç›¸åŒkeyå€¼çš„æ•°æ® *&#x2F;</span><br><span class="line">- (BOOL)containsObjectForKey:(NSString *)key;</span><br><span class="line"></span><br><span class="line">&#x2F;** å¼‚æ­¥ åˆ¤æ–­ç¼“å­˜ä¸­æ˜¯å¦å­˜åœ¨ç›¸åŒkeyå€¼çš„æ•°æ® *&#x2F;</span><br><span class="line">- (void)containsObjectForKey:(NSString *)key withBlock:(nullable void(^)(NSString *key, BOOL contains))block;</span><br><span class="line"></span><br><span class="line">&#x2F;** é€šè¿‡keyå€¼è·å–ç¼“å­˜æ•°æ® *&#x2F;</span><br><span class="line">- (nullable id&lt;NSCoding&gt;)objectForKey:(NSString *)key;</span><br><span class="line"></span><br><span class="line">&#x2F;** å¼‚æ­¥é€šè¿‡keyå€¼è·å–ç¼“å­˜æ•°æ® *&#x2F;</span><br><span class="line">- (void)objectForKey:(NSString *)key withBlock:(nullable void(^)(NSString *key, id&lt;NSCoding&gt; object))block;</span><br><span class="line"></span><br><span class="line">&#x2F;** é€šè¿‡keyå€¼ï¼Œè®¾ç½®ç¼“å­˜æ•°æ® *&#x2F;</span><br><span class="line">- (void)setObject:(nullable id&lt;NSCoding&gt;)object forKey:(NSString *)key;</span><br><span class="line"></span><br><span class="line">&#x2F;** å¼‚æ­¥é€šè¿‡keyå€¼ï¼Œè®¾ç½®ç¼“å­˜æ•°æ® *&#x2F;</span><br><span class="line">- (void)setObject:(nullable id&lt;NSCoding&gt;)object forKey:(NSString *)key withBlock:(nullable void(^)(void))block;</span><br><span class="line"></span><br><span class="line">&#x2F;** é€šè¿‡keyå€¼ï¼Œæ¸…é™¤ç¼“å­˜æ•°æ® *&#x2F;</span><br><span class="line">- (void)removeObjectForKey:(NSString *)key;</span><br><span class="line"></span><br><span class="line">&#x2F;** å¼‚æ­¥é€šè¿‡keyå€¼ï¼Œæ¸…é™¤ç¼“å­˜æ•°æ®  *&#x2F;</span><br><span class="line">- (void)removeObjectForKey:(NSString *)key withBlock:(nullable void(^)(NSString *key))block;</span><br><span class="line"></span><br><span class="line">&#x2F;** æ¸…é™¤æ‰€æœ‰ç¼“å­˜æ•°æ®  *&#x2F;</span><br><span class="line">- (void)removeAllObjects;</span><br><span class="line"></span><br><span class="line">&#x2F;** å¼‚æ­¥æ¸…é™¤æ‰€æœ‰ç¼“å­˜æ•°æ®  *&#x2F;</span><br><span class="line">- (void)removeAllObjectsWithBlock:(void(^)(void))block;</span><br><span class="line"></span><br><span class="line">&#x2F;** å¼‚æ­¥æ¸…é™¤æ‰€æœ‰ç¼“å­˜æ•°æ®ï¼Œå¹¶è·å–æ¸…é™¤è¿›ç¨‹å’Œæ˜¯å¦æ¸…é™¤å¤±è´¥  *&#x2F;</span><br><span class="line">- (void)removeAllObjectsWithProgressBlock:(nullable void(^)(int removedCount, int totalCount))progress</span><br><span class="line">                                 endBlock:(nullable void(^)(BOOL error))end;</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><p>å®ä¾‹<code>Model</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;Foundation&#x2F;Foundation.h&gt;</span><br><span class="line">NS_ASSUME_NONNULL_BEGIN</span><br><span class="line"></span><br><span class="line">@interface TestModel : NSObject &lt;NSCoding&gt;</span><br><span class="line"></span><br><span class="line">@property (nonatomic, copy) NSString *name;</span><br><span class="line">@property (nonatomic, assign) NSInteger age;</span><br><span class="line">@property (nonatomic, assign) bool sex;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">NS_ASSUME_NONNULL_END</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;--------------------åˆ†ç•Œçº¿--------------------&#x2F;&#x2F;</span><br><span class="line"></span><br><span class="line">#import &quot;TestModel.h&quot;</span><br><span class="line">#import &lt;YYModel.h&gt;</span><br><span class="line"></span><br><span class="line">@implementation TestModel</span><br><span class="line">- (void)encodeWithCoder:(NSCoder*)aCoder &#123;</span><br><span class="line">    [self yy_modelEncodeWithCoder:aCoder];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (id)initWithCoder:(NSCoder*)aDecoder &#123;</span><br><span class="line">    self &#x3D; [super init];</span><br><span class="line">    return [self yy_modelInitWithCoder:aDecoder];</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure><p>æ·»åŠ åˆ°ç¼“å­˜ä¸­</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">YYCache *cache &#x3D; [YYCache cacheWithName:@&quot;CacheName&quot;];</span><br><span class="line"></span><br><span class="line">TestModel *model &#x3D; [[TestModel alloc] init];</span><br><span class="line">model.name &#x3D; @&quot;test&quot;;</span><br><span class="line">model.age &#x3D; 11;</span><br><span class="line">model.sex &#x3D; NO;</span><br><span class="line"></span><br><span class="line">TestModel *model1 &#x3D; [[TestModel alloc] init];</span><br><span class="line">model1.name &#x3D; @&quot;tes2&quot;;</span><br><span class="line">model1.age &#x3D; 22;</span><br><span class="line">model1.sex &#x3D; YES;</span><br><span class="line"></span><br><span class="line">TestModel *model2 &#x3D; [[TestModel alloc] init];</span><br><span class="line">model2.name &#x3D; @&quot;tes3&quot;;</span><br><span class="line">model2.age &#x3D; 33;</span><br><span class="line">model2.sex &#x3D; NO;</span><br><span class="line"></span><br><span class="line">NSArray&lt;TestModel *&gt; *array &#x3D; @[model, model1, model2];</span><br><span class="line"></span><br><span class="line">[cache setObject:array forKey:@&quot;Test&quot;];</span><br><span class="line">NSArray&lt;TestModel *&gt; *tArray &#x3D; [cache objectForKey:@&quot;Test&quot;];</span><br><span class="line"></span><br><span class="line">for (TestModel *m in tArray) &#123;</span><br><span class="line">    NSLog(@&quot;name:%@----age:%ld---sex:%d&quot;, m.name, m.age, m.sex);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è·å–ç¼“å­˜ä¸­çš„æ•°æ®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2019-05-16 11:59:12.918221+0800 YYKitDemo[8347:173145] name:test----age:11---sex:0</span><br><span class="line">2019-05-16 11:59:12.918342+0800 YYKitDemo[8347:173145] name:tes2----age:22---sex:1</span><br><span class="line">2019-05-16 11:59:12.918412+0800 YYKitDemo[8347:173145] name:tes3----age:33---sex:0</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åº•å±‚åŸç† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¬¬ä¸‰æ–¹åº“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iOSç¬¬ä¸‰æ–¹åº“-RxSwiftå­¦ä¹ æ—¥å¸¸ï¼ˆåŸºç¡€ä»‹ç»ï¼‰</title>
      <link href="/2020/01/16/iOS%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93-RxSwift%E5%AD%A6%E4%B9%A0%E6%97%A5%E5%B8%B8%EF%BC%88%E5%9F%BA%E7%A1%80%E4%BB%8B%E7%BB%8D%EF%BC%89/"/>
      <url>/2020/01/16/iOS%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93-RxSwift%E5%AD%A6%E4%B9%A0%E6%97%A5%E5%B8%B8%EF%BC%88%E5%9F%BA%E7%A1%80%E4%BB%8B%E7%BB%8D%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h2 id="Observable-ä»‹ç»"><a href="#Observable-ä»‹ç»" class="headerlink" title="Observable ä»‹ç»"></a>Observable ä»‹ç»</h2><h2 id="Observable"><a href="#Observable" class="headerlink" title="Observable"></a>Observable<T></h2><ul><li>Observable<T> è¿™ä¸ªç±»å°±æ˜¯ Rx æ¡†æ¶çš„åŸºç¡€ï¼Œæˆ‘ä»¬å¯ä»¥ç§°å®ƒä¸ºå¯è§‚å¯Ÿåºåˆ—ã€‚å®ƒçš„ä½œç”¨å°±æ˜¯å¯ä»¥å¼‚æ­¥åœ°äº§ç”Ÿä¸€ç³»åˆ—çš„ Eventï¼ˆäº‹ä»¶ï¼‰ï¼Œå³ä¸€ä¸ª Observable<T> å¯¹è±¡ä¼šéšç€æ—¶é—´æ¨ç§»ä¸å®šæœŸåœ°å‘å‡º event(element : T) è¿™æ ·ä¸€ä¸ªä¸œè¥¿ã€‚</li><li>è€Œä¸”è¿™äº› Event è¿˜å¯ä»¥æºå¸¦æ•°æ®ï¼Œå®ƒçš„æ³›å‹ <T> å°±æ˜¯ç”¨æ¥æŒ‡å®šè¿™ä¸ª Event æºå¸¦çš„æ•°æ®çš„ç±»å‹ã€‚</li><li>æœ‰äº†å¯è§‚å¯Ÿåºåˆ—ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æœ‰ä¸€ä¸ª Observerï¼ˆè®¢é˜…è€…ï¼‰æ¥è®¢é˜…å®ƒï¼Œè¿™æ ·è¿™ä¸ªè®¢é˜…è€…æ‰èƒ½æ”¶åˆ° Observable<T> ä¸æ—¶å‘å‡ºçš„ Eventã€‚<h2 id="Event"><a href="#Event" class="headerlink" title="Event"></a>Event</h2>æŸ¥çœ‹ RxSwift æºç å¯ä»¥å‘ç°ï¼Œäº‹ä»¶ Event çš„å®šä¹‰å¦‚ä¸‹ï¼š</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public enum Event&lt;Element&gt; &#123;</span><br><span class="line">    &#x2F;&#x2F;&#x2F; Next element is produced.</span><br><span class="line">    case next(Element)</span><br><span class="line"> </span><br><span class="line">    &#x2F;&#x2F;&#x2F; Sequence terminated with an error.</span><br><span class="line">    case error(Swift.Error)</span><br><span class="line"> </span><br><span class="line">    &#x2F;&#x2F;&#x2F; Sequence completed successfully.</span><br><span class="line">    case completed</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ° Event å°±æ˜¯ä¸€ä¸ªæšä¸¾ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ª Observable æ˜¯å¯ä»¥å‘å‡º 3 ç§ä¸åŒç±»å‹çš„ Event äº‹ä»¶ï¼š</p><ul><li>nextï¼šnext äº‹ä»¶å°±æ˜¯é‚£ä¸ªå¯ä»¥æºå¸¦æ•°æ® <T> çš„äº‹ä»¶ï¼Œå¯ä»¥è¯´å®ƒå°±æ˜¯ä¸€ä¸ªâ€œæœ€æ­£å¸¸â€çš„äº‹ä»¶ã€‚</li><li>errorï¼šerror äº‹ä»¶è¡¨ç¤ºä¸€ä¸ªé”™è¯¯ï¼Œå®ƒå¯ä»¥æºå¸¦å…·ä½“çš„é”™è¯¯å†…å®¹ï¼Œä¸€æ—¦ Observable å‘å‡ºäº† error eventï¼Œåˆ™è¿™ä¸ª Observable å°±ç­‰äºç»ˆæ­¢äº†ï¼Œä»¥åå®ƒå†ä¹Ÿä¸ä¼šå‘å‡º event äº‹ä»¶äº†ã€‚</li><li>completedï¼šcompleted äº‹ä»¶è¡¨ç¤º Observable å‘å‡ºçš„äº‹ä»¶æ­£å¸¸åœ°ç»“æŸäº†ï¼Œè·Ÿ error ä¸€æ ·ï¼Œä¸€æ—¦ Observable å‘å‡ºäº† completed eventï¼Œåˆ™è¿™ä¸ª Observable å°±ç­‰äºç»ˆæ­¢äº†ï¼Œä»¥åå®ƒå†ä¹Ÿä¸ä¼šå‘å‡º event äº‹ä»¶äº†<h2 id="Observable-ä¸-Sequenceæ¯”è¾ƒ"><a href="#Observable-ä¸-Sequenceæ¯”è¾ƒ" class="headerlink" title="Observable ä¸ Sequenceæ¯”è¾ƒ"></a>Observable ä¸ Sequenceæ¯”è¾ƒ</h2>(1)ã€ä¸ºæ›´å¥½åœ°ç†è§£ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ¯ä¸€ä¸ª Observable çš„å®ä¾‹æƒ³è±¡æˆäºä¸€ä¸ª Swift ä¸­çš„ Sequenceï¼š</li><li>å³ä¸€ä¸ª Observableï¼ˆObservableTypeï¼‰ç›¸å½“äºä¸€ä¸ªåºåˆ— Sequenceï¼ˆSequenceTypeï¼‰ã€‚</li><li>ObservableType.subscribe(_:) æ–¹æ³•å…¶å®å°±ç›¸å½“äº SequenceType.generate()ã€‚</li></ul><p>(2)ã€ä½†å®ƒä»¬ä¹‹é—´è¿˜æ˜¯æœ‰è®¸å¤šåŒºåˆ«çš„ï¼š</p><ul><li>Swift ä¸­çš„ SequenceType æ˜¯åŒæ­¥çš„å¾ªç¯ï¼Œè€Œ Observable æ˜¯å¼‚æ­¥çš„ã€‚</li><li>Observable å¯¹è±¡ä¼šåœ¨æœ‰ä»»ä½• Event æ—¶å€™ï¼Œè‡ªåŠ¨å°† Event ä½œä¸ºä¸€ä¸ªå‚æ•°é€šè¿‡ ObservableType.subscribe(_:) å‘å‡ºï¼Œå¹¶ä¸éœ€è¦ä½¿ç”¨ next æ–¹æ³•ã€‚<h2 id="åˆ›å»º-Observable-åºåˆ—"><a href="#åˆ›å»º-Observable-åºåˆ—" class="headerlink" title="åˆ›å»º Observable åºåˆ—"></a>åˆ›å»º Observable åºåˆ—</h2><h3 id="just-æ–¹æ³•"><a href="#just-æ–¹æ³•" class="headerlink" title="just() æ–¹æ³•"></a>just() æ–¹æ³•</h3>ï¼ˆ1ï¼‰è¯¥æ–¹æ³•é€šè¿‡ä¼ å…¥ä¸€ä¸ªé»˜è®¤å€¼æ¥åˆå§‹åŒ–ã€‚<br><br>ï¼ˆ2ï¼‰ä¸‹é¢æ ·ä¾‹æˆ‘ä»¬æ˜¾å¼åœ°æ ‡æ³¨å‡ºäº† observable çš„ç±»å‹ä¸º Observable<Int>ï¼Œå³æŒ‡å®šäº†è¿™ä¸ª Observable æ‰€å‘å‡ºçš„äº‹ä»¶æºå¸¦çš„æ•°æ®ç±»å‹å¿…é¡»æ˜¯ Int ç±»å‹çš„ã€‚</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">let observable &#x3D; Observable&lt;Int&gt;.just(5)</span><br></pre></td></tr></table></figure><h3 id="of-æ–¹æ³•"><a href="#of-æ–¹æ³•" class="headerlink" title="of() æ–¹æ³•"></a>of() æ–¹æ³•</h3><p>ï¼ˆ1ï¼‰è¯¥æ–¹æ³•å¯ä»¥æ¥å—å¯å˜æ•°é‡çš„å‚æ•°ï¼ˆå¿…éœ€è¦æ˜¯åŒç±»å‹çš„ï¼‰<br><br>ï¼ˆ2ï¼‰ä¸‹é¢æ ·ä¾‹ä¸­æˆ‘æ²¡æœ‰æ˜¾å¼åœ°å£°æ˜å‡º Observable çš„æ³›å‹ç±»å‹ï¼ŒSwift ä¹Ÿä¼šè‡ªåŠ¨æ¨æ–­ç±»å‹ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">let observable &#x3D; Observable.of(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;)</span><br></pre></td></tr></table></figure><h3 id="from-æ–¹æ³•"><a href="#from-æ–¹æ³•" class="headerlink" title="from() æ–¹æ³•"></a>from() æ–¹æ³•</h3><p>ï¼ˆ1ï¼‰è¯¥æ–¹æ³•éœ€è¦ä¸€ä¸ªæ•°ç»„å‚æ•°ã€‚<br><br>ï¼ˆ2ï¼‰ä¸‹é¢æ ·ä¾‹ä¸­æ•°æ®é‡Œçš„å…ƒç´ å°±ä¼šè¢«å½“åšè¿™ä¸ª Observable æ‰€å‘å‡º event æºå¸¦çš„æ•°æ®å†…å®¹ï¼Œæœ€ç»ˆæ•ˆæœåŒä¸Šé¢é¥¿ of() æ ·ä¾‹æ˜¯ä¸€æ ·çš„ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">let observable &#x3D; Observable.from([&quot;A&quot;, &quot;B&quot;, &quot;C&quot;])</span><br></pre></td></tr></table></figure><h3 id="empty-æ–¹æ³•"><a href="#empty-æ–¹æ³•" class="headerlink" title="empty() æ–¹æ³•"></a>empty() æ–¹æ³•</h3><p>è¯¥æ–¹æ³•åˆ›å»ºä¸€ä¸ªç©ºå†…å®¹çš„ Observable åºåˆ—ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">let observable &#x3D; Observable&lt;Int&gt;.empty()</span><br></pre></td></tr></table></figure><h3 id="never-æ–¹æ³•"><a href="#never-æ–¹æ³•" class="headerlink" title="never() æ–¹æ³•"></a>never() æ–¹æ³•</h3><p>è¯¥æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ°¸è¿œä¸ä¼šå‘å‡º Eventï¼ˆä¹Ÿä¸ä¼šç»ˆæ­¢ï¼‰çš„ Observable åºåˆ—ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">let observable &#x3D; Observable&lt;Int&gt;.never()</span><br></pre></td></tr></table></figure><h3 id="error-æ–¹æ³•"><a href="#error-æ–¹æ³•" class="headerlink" title="error() æ–¹æ³•"></a>error() æ–¹æ³•</h3><p>è¯¥æ–¹æ³•åˆ›å»ºä¸€ä¸ªä¸åšä»»ä½•æ“ä½œï¼Œè€Œæ˜¯ç›´æ¥å‘é€ä¸€ä¸ªé”™è¯¯çš„ Observable åºåˆ—ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">enum MyError: Error &#123;</span><br><span class="line">    case A</span><br><span class="line">    case B</span><br><span class="line">&#125;</span><br><span class="line">         </span><br><span class="line">let observable &#x3D; Observable&lt;Int&gt;.error(MyError.A)</span><br></pre></td></tr></table></figure><h3 id="range-æ–¹æ³•"><a href="#range-æ–¹æ³•" class="headerlink" title="range() æ–¹æ³•"></a>range() æ–¹æ³•</h3><p>ï¼ˆ1ï¼‰è¯¥æ–¹æ³•é€šè¿‡æŒ‡å®šèµ·å§‹å’Œç»“æŸæ•°å€¼ï¼Œåˆ›å»ºä¸€ä¸ªä»¥è¿™ä¸ªèŒƒå›´å†…æ‰€æœ‰å€¼ä½œä¸ºåˆå§‹å€¼çš„ Observable åºåˆ—ã€‚<br><br>ï¼ˆ2ï¼‰ä¸‹é¢æ ·ä¾‹ä¸­ï¼Œä¸¤ç§æ–¹æ³•åˆ›å»ºçš„ Observable åºåˆ—éƒ½æ˜¯ä¸€æ ·çš„ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;ä½¿ç”¨range()</span><br><span class="line">let observable &#x3D; Observable.range(start: 1, count: 5)</span><br><span class="line"> </span><br><span class="line">&#x2F;&#x2F;ä½¿ç”¨of()</span><br><span class="line">let observable &#x3D; Observable.of(1, 2, 3 ,4 ,5)</span><br></pre></td></tr></table></figure><h3 id="repeatElement-æ–¹æ³•"><a href="#repeatElement-æ–¹æ³•" class="headerlink" title="repeatElement() æ–¹æ³•"></a>repeatElement() æ–¹æ³•</h3><p>è¯¥æ–¹æ³•åˆ›å»ºä¸€ä¸ªå¯ä»¥æ— é™å‘å‡ºç»™å®šå…ƒç´ çš„ Event çš„ Observable åºåˆ—ï¼ˆæ°¸ä¸ç»ˆæ­¢ï¼‰ã€‚ </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">let observable &#x3D; Observable.repeatElement(1)</span><br></pre></td></tr></table></figure><h3 id="generate-æ–¹æ³•"><a href="#generate-æ–¹æ³•" class="headerlink" title="generate() æ–¹æ³•"></a>generate() æ–¹æ³•</h3><p>ï¼ˆ1ï¼‰è¯¥æ–¹æ³•åˆ›å»ºä¸€ä¸ªåªæœ‰å½“æä¾›çš„æ‰€æœ‰çš„åˆ¤æ–­æ¡ä»¶éƒ½ä¸º true çš„æ—¶å€™ï¼Œæ‰ä¼šç»™å‡ºåŠ¨ä½œçš„ Observable åºåˆ—ã€‚<br><br>ï¼ˆ2ï¼‰ä¸‹é¢æ ·ä¾‹ä¸­ï¼Œä¸¤ç§æ–¹æ³•åˆ›å»ºçš„ Observable åºåˆ—éƒ½æ˜¯ä¸€æ ·çš„ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;ä½¿ç”¨generate()æ–¹æ³•</span><br><span class="line">let observable &#x3D; Observable.generate(</span><br><span class="line">    initialState: 0,</span><br><span class="line">    condition: &#123; $0 &lt;&#x3D; 10 &#125;,</span><br><span class="line">    iterate: &#123; $0 + 2 &#125;</span><br><span class="line">)</span><br><span class="line"> </span><br><span class="line">&#x2F;&#x2F;ä½¿ç”¨of()æ–¹æ³•</span><br><span class="line">let observable &#x3D; Observable.of(0 , 2 ,4 ,6 ,8 ,10)</span><br></pre></td></tr></table></figure><h3 id="create-æ–¹æ³•"><a href="#create-æ–¹æ³•" class="headerlink" title="create() æ–¹æ³•"></a>create() æ–¹æ³•</h3><p>ï¼ˆ1ï¼‰è¯¥æ–¹æ³•æ¥å—ä¸€ä¸ª block å½¢å¼çš„å‚æ•°ï¼Œä»»åŠ¡æ˜¯å¯¹æ¯ä¸€ä¸ªè¿‡æ¥çš„è®¢é˜…è¿›è¡Œå¤„ç†ã€‚<br><br>ï¼ˆ2ï¼‰ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„æ ·ä¾‹ã€‚ä¸ºæ–¹ä¾¿æ¼”ç¤ºï¼Œè¿™é‡Œå¢åŠ äº†è®¢é˜…ç›¸å…³ä»£ç ï¼ˆå…³äºè®¢é˜…æˆ‘ä¹‹åä¼šè¯¦ç»†ä»‹ç»çš„ï¼‰ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;è¿™ä¸ªblockæœ‰ä¸€ä¸ªå›è°ƒå‚æ•°observerå°±æ˜¯è®¢é˜…è¿™ä¸ªObservableå¯¹è±¡çš„è®¢é˜…è€…</span><br><span class="line">&#x2F;&#x2F;å½“ä¸€ä¸ªè®¢é˜…è€…è®¢é˜…è¿™ä¸ªObservableå¯¹è±¡çš„æ—¶å€™ï¼Œå°±ä¼šå°†è®¢é˜…è€…ä½œä¸ºå‚æ•°ä¼ å…¥è¿™ä¸ªblockæ¥æ‰§è¡Œä¸€äº›å†…å®¹</span><br><span class="line">let observable &#x3D; Observable&lt;String&gt;.create&#123;observer in</span><br><span class="line">    &#x2F;&#x2F;å¯¹è®¢é˜…è€…å‘å‡ºäº†.nextäº‹ä»¶ï¼Œä¸”æºå¸¦äº†ä¸€ä¸ªæ•°æ®&quot;hangge.com&quot;</span><br><span class="line">    observer.onNext(&quot;hangge.com&quot;)</span><br><span class="line">    &#x2F;&#x2F;å¯¹è®¢é˜…è€…å‘å‡ºäº†.completedäº‹ä»¶</span><br><span class="line">    observer.onCompleted()</span><br><span class="line">    &#x2F;&#x2F;å› ä¸ºä¸€ä¸ªè®¢é˜…è¡Œä¸ºä¼šæœ‰ä¸€ä¸ªDisposableç±»å‹çš„è¿”å›å€¼ï¼Œæ‰€ä»¥åœ¨ç»“å°¾ä¸€å®šè¦returenä¸€ä¸ªDisposable</span><br><span class="line">    return Disposables.create()</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">&#x2F;&#x2F;è®¢é˜…æµ‹è¯•</span><br><span class="line">observable.subscribe &#123;</span><br><span class="line">    print($0)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="deferred-æ–¹æ³•"><a href="#deferred-æ–¹æ³•" class="headerlink" title="deferred() æ–¹æ³•"></a>deferred() æ–¹æ³•</h3><p>è¯¥ä¸ªæ–¹æ³•ç›¸å½“äºæ˜¯åˆ›å»ºä¸€ä¸ª Observable å·¥å‚ï¼Œé€šè¿‡ä¼ å…¥ä¸€ä¸ª block æ¥æ‰§è¡Œå»¶è¿Ÿ Observable åºåˆ—åˆ›å»ºçš„è¡Œä¸ºï¼Œè€Œè¿™ä¸ª block é‡Œå°±æ˜¯çœŸæ­£çš„å®ä¾‹åŒ–åºåˆ—å¯¹è±¡çš„åœ°æ–¹ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;ç”¨äºæ ‡è®°æ˜¯å¥‡æ•°ã€è¿˜æ˜¯å¶æ•°</span><br><span class="line">var isOdd &#x3D; true</span><br><span class="line"> </span><br><span class="line">&#x2F;&#x2F;ä½¿ç”¨deferred()æ–¹æ³•å»¶è¿ŸObservableåºåˆ—çš„åˆå§‹åŒ–ï¼Œé€šè¿‡ä¼ å…¥çš„blockæ¥å®ç°Observableåºåˆ—çš„åˆå§‹åŒ–å¹¶ä¸”è¿”å›ã€‚</span><br><span class="line">let factory : Observable&lt;Int&gt; &#x3D; Observable.deferred &#123;</span><br><span class="line">     </span><br><span class="line">    &#x2F;&#x2F;è®©æ¯æ¬¡æ‰§è¡Œè¿™ä¸ªblockæ—¶å€™éƒ½ä¼šè®©å¥‡ã€å¶æ•°è¿›è¡Œäº¤æ›¿</span><br><span class="line">    isOdd &#x3D; !isOdd</span><br><span class="line">     </span><br><span class="line">    &#x2F;&#x2F;æ ¹æ®isOddå‚æ•°ï¼Œå†³å®šåˆ›å»ºå¹¶è¿”å›çš„æ˜¯å¥‡æ•°Observableã€è¿˜æ˜¯å¶æ•°Observable</span><br><span class="line">    if isOdd &#123;</span><br><span class="line">        return Observable.of(1, 3, 5 ,7)</span><br><span class="line">    &#125;else &#123;</span><br><span class="line">        return Observable.of(2, 4, 6, 8)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">&#x2F;&#x2F;ç¬¬1æ¬¡è®¢é˜…æµ‹è¯•</span><br><span class="line">factory.subscribe &#123; event in</span><br><span class="line">    print(&quot;\(isOdd)&quot;, event)</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">&#x2F;&#x2F;ç¬¬2æ¬¡è®¢é˜…æµ‹è¯•</span><br><span class="line">factory.subscribe &#123; event in</span><br><span class="line">    print(&quot;\(isOdd)&quot;, event)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="interval-æ–¹æ³•"><a href="#interval-æ–¹æ³•" class="headerlink" title="interval() æ–¹æ³•"></a>interval() æ–¹æ³•</h3><p>ï¼ˆ1ï¼‰è¿™ä¸ªæ–¹æ³•åˆ›å»ºçš„ Observable åºåˆ—æ¯éš”ä¸€æ®µè®¾å®šçš„æ—¶é—´ï¼Œä¼šå‘å‡ºä¸€ä¸ªç´¢å¼•æ•°çš„å…ƒç´ ã€‚è€Œä¸”å®ƒä¼šä¸€ç›´å‘é€ä¸‹å»ã€‚<br><br>ï¼ˆ2ï¼‰ä¸‹é¢æ–¹æ³•è®©å…¶æ¯ 1 ç§’å‘é€ä¸€æ¬¡ï¼Œå¹¶ä¸”æ˜¯åœ¨ä¸»çº¿ç¨‹ï¼ˆMainSchedulerï¼‰å‘é€ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let observable &#x3D; Observable&lt;Int&gt;.interval(1, scheduler: MainScheduler.instance)</span><br><span class="line">observable.subscribe &#123; event in</span><br><span class="line">    print(event)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="timer-æ–¹æ³•"><a href="#timer-æ–¹æ³•" class="headerlink" title="timer() æ–¹æ³•"></a>timer() æ–¹æ³•</h3><p>ï¼ˆ1ï¼‰è¿™ä¸ªæ–¹æ³•æœ‰ä¸¤ç§ç”¨æ³•ï¼Œä¸€ç§æ˜¯åˆ›å»ºçš„ Observable åºåˆ—åœ¨ç»è¿‡è®¾å®šçš„ä¸€æ®µæ—¶é—´åï¼Œäº§ç”Ÿå”¯ä¸€çš„ä¸€ä¸ªå…ƒç´ ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;5ç§’ç§åå‘å‡ºå”¯ä¸€çš„ä¸€ä¸ªå…ƒç´ 0</span><br><span class="line">let observable &#x3D; Observable&lt;Int&gt;.timer(5, scheduler: MainScheduler.instance)</span><br><span class="line">observable.subscribe &#123; event in</span><br><span class="line">    print(event)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰å¦ä¸€ç§æ˜¯åˆ›å»ºçš„ Observable åºåˆ—åœ¨ç»è¿‡è®¾å®šçš„ä¸€æ®µæ—¶é—´åï¼Œæ¯éš”ä¸€æ®µæ—¶é—´äº§ç”Ÿä¸€ä¸ªå…ƒç´ ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;å»¶æ—¶5ç§’ç§åï¼Œæ¯éš”1ç§’é’Ÿå‘å‡ºä¸€ä¸ªå…ƒç´ </span><br><span class="line">let observable &#x3D; Observable&lt;Int&gt;.timer(5, period: 1, scheduler: MainScheduler.instance)</span><br><span class="line">observable.subscribe &#123; event in</span><br><span class="line">    print(event)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="è®¢é˜…-Observable"><a href="#è®¢é˜…-Observable" class="headerlink" title="è®¢é˜… Observable"></a>è®¢é˜… Observable</h1><h3 id="ç¬¬ä¸€ç§ç”¨æ³•ï¼š"><a href="#ç¬¬ä¸€ç§ç”¨æ³•ï¼š" class="headerlink" title="ç¬¬ä¸€ç§ç”¨æ³•ï¼š"></a>ç¬¬ä¸€ç§ç”¨æ³•ï¼š</h3><p>ï¼ˆ1ï¼‰æˆ‘ä»¬ä½¿ç”¨ subscribe() è®¢é˜…äº†ä¸€ä¸ª Observable å¯¹è±¡ï¼Œè¯¥æ–¹æ³•çš„ block çš„å›è°ƒå‚æ•°å°±æ˜¯è¢«å‘å‡ºçš„ event äº‹ä»¶ï¼Œæˆ‘ä»¬å°†å…¶ç›´æ¥æ‰“å°å‡ºæ¥ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">let observable &#x3D; Observable.of(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;)</span><br><span class="line">         </span><br><span class="line">observable.subscribe &#123; event in</span><br><span class="line">    print(event)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å…¥ç»“æœå¯ä»¥çœ‹å‡º</p><ul><li>åˆå§‹åŒ– Observable åºåˆ—æ—¶è®¾ç½®çš„é»˜è®¤å€¼éƒ½æŒ‰é¡ºåºé€šè¿‡ .next äº‹ä»¶å‘é€å‡ºæ¥ã€‚</li><li>å½“ Observable åºåˆ—çš„åˆå§‹æ•°æ®éƒ½å‘é€å®Œæ¯•ï¼Œå®ƒè¿˜ä¼šè‡ªåŠ¨å‘ä¸€ä¸ª .completed äº‹ä»¶å‡ºæ¥ã€‚<br></li></ul><p>ï¼ˆ2ï¼‰å¦‚æœæƒ³è¦è·å–åˆ°è¿™ä¸ªäº‹ä»¶é‡Œçš„æ•°æ®ï¼Œå¯ä»¥é€šè¿‡ event.element å¾—åˆ°ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">let observable &#x3D; Observable.of(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;)</span><br><span class="line">         </span><br><span class="line">observable.subscribe &#123; event in</span><br><span class="line">    print(event.element)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç¬¬äºŒç§ç”¨æ³•ï¼š"><a href="#ç¬¬äºŒç§ç”¨æ³•ï¼š" class="headerlink" title="ç¬¬äºŒç§ç”¨æ³•ï¼š"></a>ç¬¬äºŒç§ç”¨æ³•ï¼š</h3><p>ï¼ˆ1ï¼‰RxSwift è¿˜æä¾›äº†å¦ä¸€ä¸ª subscribe æ–¹æ³•ï¼Œå®ƒå¯ä»¥æŠŠ event è¿›è¡Œåˆ†ç±»ï¼š</p><ul><li>é€šè¿‡ä¸åŒçš„ block å›è°ƒå¤„ç†ä¸åŒç±»å‹çš„ eventã€‚ï¼ˆå…¶ä¸­ onDisposed è¡¨ç¤ºè®¢é˜…è¡Œä¸ºè¢« dispose åçš„å›è°ƒï¼Œè¿™ä¸ªæˆ‘åé¢ä¼šè¯´ï¼‰</li><li>åŒæ—¶ä¼šæŠŠ event æºå¸¦çš„æ•°æ®ç›´æ¥è§£åŒ…å‡ºæ¥ä½œä¸ºå‚æ•°ï¼Œæ–¹ä¾¿æˆ‘ä»¬ä½¿ç”¨ã€‚<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">let observable &#x3D; Observable.of(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;)</span><br><span class="line">         </span><br><span class="line">observable.subscribe(onNext: &#123; element in</span><br><span class="line">    print(element)</span><br><span class="line">&#125;, onError: &#123; error in</span><br><span class="line">    print(error)</span><br><span class="line">&#125;, onCompleted: &#123;</span><br><span class="line">    print(&quot;completed&quot;)</span><br><span class="line">&#125;, onDisposed: &#123;</span><br><span class="line">    print(&quot;disposed&quot;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>2ï¼‰subscribe() æ–¹æ³•çš„ onNextã€onErrorã€onCompleted å’Œ onDisposed è¿™å››ä¸ªå›è°ƒ block å‚æ•°éƒ½æ˜¯æœ‰é»˜è®¤å€¼çš„ï¼Œå³å®ƒä»¬éƒ½æ˜¯å¯é€‰çš„ã€‚æ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯ä»¥åªå¤„ç† onNext è€Œä¸ç®¡å…¶ä»–çš„æƒ…å†µã€‚<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">let observable &#x3D; Observable.of(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;)</span><br><span class="line">         </span><br><span class="line">observable.subscribe(onNext: &#123; element in</span><br><span class="line">    print(element)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="ç›‘å¬äº‹ä»¶çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#ç›‘å¬äº‹ä»¶çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç›‘å¬äº‹ä»¶çš„ç”Ÿå‘½å‘¨æœŸ"></a>ç›‘å¬äº‹ä»¶çš„ç”Ÿå‘½å‘¨æœŸ</h1><h3 id="1ã€-doOn-ä»‹ç»"><a href="#1ã€-doOn-ä»‹ç»" class="headerlink" title="1ã€ doOn ä»‹ç»"></a>1ã€ doOn ä»‹ç»</h3>ï¼ˆ1ï¼‰æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ doOn æ–¹æ³•æ¥ç›‘å¬äº‹ä»¶çš„ç”Ÿå‘½å‘¨æœŸï¼Œå®ƒä¼šåœ¨æ¯ä¸€æ¬¡äº‹ä»¶å‘é€å‰è¢«è°ƒç”¨ã€‚<br><br>ï¼ˆ2ï¼‰åŒæ—¶å®ƒå’Œ subscribe ä¸€æ ·ï¼Œå¯ä»¥é€šè¿‡ä¸åŒçš„ block å›è°ƒå¤„ç†ä¸åŒç±»å‹çš„ eventã€‚æ¯”å¦‚ï¼š</li><li>do(onNext:) æ–¹æ³•å°±æ˜¯åœ¨ subscribe(onNext:) å‰è°ƒç”¨</li><li>è€Œ do(onCompleted:) æ–¹æ³•åˆ™ä¼šåœ¨ subscribe(onCompleted:) å‰é¢è°ƒç”¨ã€‚</li></ul><h3 id="ä½¿ç”¨æ ·ä¾‹"><a href="#ä½¿ç”¨æ ·ä¾‹" class="headerlink" title="ä½¿ç”¨æ ·ä¾‹"></a>ä½¿ç”¨æ ·ä¾‹</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">let observable &#x3D; Observable.of(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;)</span><br><span class="line"> </span><br><span class="line">observable</span><br><span class="line">    .do(onNext: &#123; element in</span><br><span class="line">        print(&quot;Intercepted Nextï¼š&quot;, element)</span><br><span class="line">    &#125;, onError: &#123; error in</span><br><span class="line">        print(&quot;Intercepted Errorï¼š&quot;, error)</span><br><span class="line">    &#125;, onCompleted: &#123;</span><br><span class="line">        print(&quot;Intercepted Completed&quot;)</span><br><span class="line">    &#125;, onDispose: &#123;</span><br><span class="line">        print(&quot;Intercepted Disposed&quot;)</span><br><span class="line">    &#125;)</span><br><span class="line">    .subscribe(onNext: &#123; element in</span><br><span class="line">        print(element)</span><br><span class="line">    &#125;, onError: &#123; error in</span><br><span class="line">        print(error)</span><br><span class="line">    &#125;, onCompleted: &#123;</span><br><span class="line">        print(&quot;completed&quot;)</span><br><span class="line">    &#125;, onDisposed: &#123;</span><br><span class="line">        print(&quot;disposed&quot;)</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure><h1 id="Observable-çš„é”€æ¯ï¼ˆDisposeï¼‰"><a href="#Observable-çš„é”€æ¯ï¼ˆDisposeï¼‰" class="headerlink" title="Observable çš„é”€æ¯ï¼ˆDisposeï¼‰"></a>Observable çš„é”€æ¯ï¼ˆDisposeï¼‰</h1><h3 id="1ã€Observable-ä»åˆ›å»ºåˆ°ç»ˆç»“æµç¨‹"><a href="#1ã€Observable-ä»åˆ›å»ºåˆ°ç»ˆç»“æµç¨‹" class="headerlink" title="1ã€Observable ä»åˆ›å»ºåˆ°ç»ˆç»“æµç¨‹"></a>1ã€Observable ä»åˆ›å»ºåˆ°ç»ˆç»“æµç¨‹</h3><p>ï¼ˆ1ï¼‰ä¸€ä¸ª Observable åºåˆ—è¢«åˆ›å»ºå‡ºæ¥åå®ƒä¸ä¼šé©¬ä¸Šå°±å¼€å§‹è¢«æ¿€æ´»ä»è€Œå‘å‡º Eventï¼Œè€Œæ˜¯è¦ç­‰åˆ°å®ƒè¢«æŸä¸ªäººè®¢é˜…äº†æ‰ä¼šæ¿€æ´»å®ƒã€‚<br><br>ï¼ˆ2ï¼‰è€Œ Observable åºåˆ—æ¿€æ´»ä¹‹åè¦ä¸€ç›´ç­‰åˆ°å®ƒå‘å‡ºäº† .error æˆ–è€… .completed çš„ event åï¼Œå®ƒæ‰è¢«ç»ˆç»“ã€‚</p><h3 id="2ã€dispose-æ–¹æ³•"><a href="#2ã€dispose-æ–¹æ³•" class="headerlink" title="2ã€dispose() æ–¹æ³•"></a>2ã€dispose() æ–¹æ³•</h3><p>ï¼ˆ1ï¼‰ä½¿ç”¨è¯¥æ–¹æ³•æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨å–æ¶ˆä¸€ä¸ªè®¢é˜…è¡Œä¸ºã€‚<br><br>ï¼ˆ2ï¼‰å¦‚æœæˆ‘ä»¬è§‰å¾—è¿™ä¸ªè®¢é˜…ç»“æŸäº†ä¸å†éœ€è¦äº†ï¼Œå°±å¯ä»¥è°ƒç”¨ dispose() æ–¹æ³•æŠŠè¿™ä¸ªè®¢é˜…ç»™é”€æ¯æ‰ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼ã€‚<br><br>ï¼ˆ2ï¼‰å½“ä¸€ä¸ªè®¢é˜…è¡Œä¸ºè¢« dispose äº†ï¼Œé‚£ä¹ˆä¹‹å observable å¦‚æœå†å‘å‡º eventï¼Œè¿™ä¸ªå·²ç» dispose çš„è®¢é˜…å°±æ”¶ä¸åˆ°æ¶ˆæ¯äº†ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä½¿ç”¨æ ·ä¾‹ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">let observable &#x3D; Observable.of(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;)</span><br><span class="line">         </span><br><span class="line">&#x2F;&#x2F;ä½¿ç”¨subscriptionå¸¸é‡å­˜å‚¨è¿™ä¸ªè®¢é˜…æ–¹æ³•</span><br><span class="line">let subscription &#x3D; observable.subscribe &#123; event in</span><br><span class="line">    print(event)</span><br><span class="line">&#125;</span><br><span class="line">         </span><br><span class="line">&#x2F;&#x2F;è°ƒç”¨è¿™ä¸ªè®¢é˜…çš„dispose()æ–¹æ³•</span><br><span class="line">subscription.dispose()</span><br></pre></td></tr></table></figure><h3 id="3ã€DisposeBag"><a href="#3ã€DisposeBag" class="headerlink" title="3ã€DisposeBag"></a>3ã€DisposeBag</h3><p>é™¤äº† dispose() æ–¹æ³•ä¹‹å¤–ï¼Œæˆ‘ä»¬æ›´ç»å¸¸ç”¨åˆ°çš„æ˜¯ä¸€ä¸ªå« DisposeBag çš„å¯¹è±¡æ¥ç®¡ç†å¤šä¸ªè®¢é˜…è¡Œä¸ºçš„é”€æ¯ï¼š<br>æˆ‘ä»¬å¯ä»¥æŠŠä¸€ä¸ª DisposeBag å¯¹è±¡çœ‹æˆä¸€ä¸ªåƒåœ¾è¢‹ï¼ŒæŠŠç”¨è¿‡çš„è®¢é˜…è¡Œä¸ºéƒ½æ”¾è¿›å»ã€‚<br>è€Œè¿™ä¸ª DisposeBag å°±ä¼šåœ¨è‡ªå·±å¿«è¦ dealloc çš„æ—¶å€™ï¼Œå¯¹å®ƒé‡Œé¢çš„æ‰€æœ‰è®¢é˜…è¡Œä¸ºéƒ½è°ƒç”¨ dispose() æ–¹æ³•ã€‚<br>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä½¿ç”¨æ ·ä¾‹ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">let disposeBag &#x3D; DisposeBag()</span><br><span class="line">         </span><br><span class="line">&#x2F;&#x2F;ç¬¬1ä¸ªObservableï¼ŒåŠå…¶è®¢é˜…</span><br><span class="line">let observable1 &#x3D; Observable.of(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;)</span><br><span class="line">observable1.subscribe &#123; event in</span><br><span class="line">    print(event)</span><br><span class="line">&#125;.disposed(by: disposeBag)</span><br><span class="line"> </span><br><span class="line">&#x2F;&#x2F;ç¬¬2ä¸ªObservableï¼ŒåŠå…¶è®¢é˜…</span><br><span class="line">let observable2 &#x3D; Observable.of(1, 2, 3)</span><br><span class="line">observable2.subscribe &#123; event in</span><br><span class="line">    print(event)</span><br><span class="line">&#125;.disposed(by: disposeBag)</span><br></pre></td></tr></table></figure><h1 id="è§‚å¯Ÿè€…ï¼ˆObserverï¼‰ä»‹ç»"><a href="#è§‚å¯Ÿè€…ï¼ˆObserverï¼‰ä»‹ç»" class="headerlink" title="è§‚å¯Ÿè€…ï¼ˆObserverï¼‰ä»‹ç»"></a>è§‚å¯Ÿè€…ï¼ˆObserverï¼‰ä»‹ç»</h1><p>è§‚å¯Ÿè€…ï¼ˆObserverï¼‰çš„ä½œç”¨å°±æ˜¯ç›‘å¬äº‹ä»¶ï¼Œç„¶åå¯¹è¿™ä¸ªäº‹ä»¶åšå‡ºå“åº”ã€‚æˆ–è€…è¯´ä»»ä½•å“åº”äº‹ä»¶çš„è¡Œä¸ºéƒ½æ˜¯è§‚å¯Ÿè€…ã€‚æ¯”å¦‚ï¼š</p><ul><li>å½“æˆ‘ä»¬ç‚¹å‡»æŒ‰é’®ï¼Œå¼¹å‡ºä¸€ä¸ªæç¤ºæ¡†ã€‚é‚£ä¹ˆè¿™ä¸ªâ€œå¼¹å‡ºä¸€ä¸ªæç¤ºæ¡†â€å°±æ˜¯è§‚å¯Ÿè€… Observer<Void></li><li>å½“æˆ‘ä»¬è¯·æ±‚ä¸€ä¸ªè¿œç¨‹çš„ json æ•°æ®åï¼Œå°†å…¶æ‰“å°å‡ºæ¥ã€‚é‚£ä¹ˆè¿™ä¸ªâ€œæ‰“å° json æ•°æ®â€å°±æ˜¯è§‚å¯Ÿè€… Observer<JSON></li></ul><h1 id="ç›´æ¥åœ¨-subscribeã€bind-æ–¹æ³•ä¸­åˆ›å»ºè§‚å¯Ÿè€…"><a href="#ç›´æ¥åœ¨-subscribeã€bind-æ–¹æ³•ä¸­åˆ›å»ºè§‚å¯Ÿè€…" class="headerlink" title="ç›´æ¥åœ¨ subscribeã€bind æ–¹æ³•ä¸­åˆ›å»ºè§‚å¯Ÿè€…"></a>ç›´æ¥åœ¨ subscribeã€bind æ–¹æ³•ä¸­åˆ›å»ºè§‚å¯Ÿè€…</h1><h3 id="1-åœ¨-subscribe-æ–¹æ³•ä¸­åˆ›å»º"><a href="#1-åœ¨-subscribe-æ–¹æ³•ä¸­åˆ›å»º" class="headerlink" title="1. åœ¨ subscribe æ–¹æ³•ä¸­åˆ›å»º"></a>1. åœ¨ subscribe æ–¹æ³•ä¸­åˆ›å»º</h3><p>ï¼ˆ1ï¼‰åˆ›å»ºè§‚å¯Ÿè€…æœ€ç›´æ¥çš„æ–¹æ³•å°±æ˜¯åœ¨ Observable çš„ subscribe æ–¹æ³•åé¢æè¿°å½“äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œéœ€è¦å¦‚ä½•åšå‡ºå“åº”ã€‚<br><br>ï¼ˆ2ï¼‰æ¯”å¦‚ä¸‹é¢çš„æ ·ä¾‹ï¼Œè§‚å¯Ÿè€…å°±æ˜¯ç”±åé¢çš„ onNextï¼ŒonErrorï¼ŒonCompleted è¿™äº›é—­åŒ…æ„å»ºå‡ºæ¥çš„ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">let observable &#x3D; Observable.of(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;)</span><br><span class="line">          </span><br><span class="line">observable.subscribe(onNext: &#123; element in</span><br><span class="line">    print(element)</span><br><span class="line">&#125;, onError: &#123; error in</span><br><span class="line">    print(error)</span><br><span class="line">&#125;, onCompleted: &#123;</span><br><span class="line">    print(&quot;completed&quot;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="2-åœ¨-bind-æ–¹æ³•ä¸­åˆ›å»º"><a href="#2-åœ¨-bind-æ–¹æ³•ä¸­åˆ›å»º" class="headerlink" title="2. åœ¨ bind æ–¹æ³•ä¸­åˆ›å»º"></a>2. åœ¨ bind æ–¹æ³•ä¸­åˆ›å»º</h3><p>ä¸‹é¢ä»£ç æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå®šæ—¶ç”Ÿæˆç´¢å¼•æ•°çš„ Observable åºåˆ—ï¼Œå¹¶å°†ç´¢å¼•æ•°ä¸æ–­æ˜¾ç¤ºåœ¨ label æ ‡ç­¾ä¸Šï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">import UIKit</span><br><span class="line">import RxSwift</span><br><span class="line">import RxCocoa</span><br><span class="line"> </span><br><span class="line">class ViewController: UIViewController &#123;</span><br><span class="line">     </span><br><span class="line">    @IBOutlet weak var label: UILabel!</span><br><span class="line">     </span><br><span class="line">    let disposeBag &#x3D; DisposeBag()</span><br><span class="line">     </span><br><span class="line">    override func viewDidLoad() &#123;</span><br><span class="line">         </span><br><span class="line">        &#x2F;&#x2F;Observableåºåˆ—ï¼ˆæ¯éš”1ç§’é’Ÿå‘å‡ºä¸€ä¸ªç´¢å¼•æ•°ï¼‰</span><br><span class="line">        let observable &#x3D; Observable&lt;Int&gt;.interval(1, scheduler: MainScheduler.instance)</span><br><span class="line"> </span><br><span class="line">        observable</span><br><span class="line">            .map &#123; &quot;å½“å‰ç´¢å¼•æ•°ï¼š\($0 )&quot;&#125;</span><br><span class="line">            .bind &#123; [weak self](text) in</span><br><span class="line">                &#x2F;&#x2F;æ”¶åˆ°å‘å‡ºçš„ç´¢å¼•æ•°åæ˜¾ç¤ºåˆ°labelä¸Š</span><br><span class="line">                self?.label.text &#x3D; text</span><br><span class="line">            &#125;</span><br><span class="line">            .disposed(by: disposeBag)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ä½¿ç”¨-AnyObserver-åˆ›å»ºè§‚å¯Ÿè€…"><a href="#ä½¿ç”¨-AnyObserver-åˆ›å»ºè§‚å¯Ÿè€…" class="headerlink" title="ä½¿ç”¨ AnyObserver åˆ›å»ºè§‚å¯Ÿè€…"></a>ä½¿ç”¨ AnyObserver åˆ›å»ºè§‚å¯Ÿè€…</h1><p>AnyObserver å¯ä»¥ç”¨æ¥æå™ä»»æ„ä¸€ç§è§‚å¯Ÿè€…ã€‚</p><h3 id="1ã€é…åˆ-subscribe-æ–¹æ³•ä½¿ç”¨"><a href="#1ã€é…åˆ-subscribe-æ–¹æ³•ä½¿ç”¨" class="headerlink" title="1ã€é…åˆ subscribe æ–¹æ³•ä½¿ç”¨"></a>1ã€é…åˆ subscribe æ–¹æ³•ä½¿ç”¨</h3><p>æ¯”å¦‚ä¸Šé¢ç¬¬ä¸€ä¸ªæ ·ä¾‹æˆ‘ä»¬å¯ä»¥æ”¹æˆå¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;è§‚å¯Ÿè€…</span><br><span class="line">let observer: AnyObserver&lt;String&gt; &#x3D; AnyObserver &#123; (event) in</span><br><span class="line">    switch event &#123;</span><br><span class="line">    case .next(let data):</span><br><span class="line">        print(data)</span><br><span class="line">    case .error(let error):</span><br><span class="line">        print(error)</span><br><span class="line">    case .completed:</span><br><span class="line">        print(&quot;completed&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">let observable &#x3D; Observable.of(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;)</span><br><span class="line">observable.subscribe(observer)</span><br></pre></td></tr></table></figure><h3 id="2ã€é…åˆ-bindTo-æ–¹æ³•ä½¿ç”¨"><a href="#2ã€é…åˆ-bindTo-æ–¹æ³•ä½¿ç”¨" class="headerlink" title="2ã€é…åˆ bindTo æ–¹æ³•ä½¿ç”¨"></a>2ã€é…åˆ bindTo æ–¹æ³•ä½¿ç”¨</h3><p>ä¹Ÿå¯é…åˆ Observable çš„æ•°æ®ç»‘å®šæ–¹æ³•ï¼ˆbindToï¼‰ä½¿ç”¨ã€‚æ¯”å¦‚ä¸Šé¢çš„ç¬¬äºŒä¸ªæ ·ä¾‹æˆ‘å¯ä»¥æ”¹æˆå¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">import UIKit</span><br><span class="line">import RxSwift</span><br><span class="line">import RxCocoa</span><br><span class="line"> </span><br><span class="line">class ViewController: UIViewController &#123;</span><br><span class="line">     </span><br><span class="line">    @IBOutlet weak var label: UILabel!</span><br><span class="line">     </span><br><span class="line">    let disposeBag &#x3D; DisposeBag()</span><br><span class="line">     </span><br><span class="line">    override func viewDidLoad() &#123;</span><br><span class="line">         </span><br><span class="line">        &#x2F;&#x2F;è§‚å¯Ÿè€…</span><br><span class="line">        let observer: AnyObserver&lt;String&gt; &#x3D; AnyObserver &#123; [weak self] (event) in</span><br><span class="line">            switch event &#123;</span><br><span class="line">            case .next(let text):</span><br><span class="line">                &#x2F;&#x2F;æ”¶åˆ°å‘å‡ºçš„ç´¢å¼•æ•°åæ˜¾ç¤ºåˆ°labelä¸Š</span><br><span class="line">                self?.label.text &#x3D; text</span><br><span class="line">            default:</span><br><span class="line">                break</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">        &#x2F;&#x2F;Observableåºåˆ—ï¼ˆæ¯éš”1ç§’é’Ÿå‘å‡ºä¸€ä¸ªç´¢å¼•æ•°ï¼‰</span><br><span class="line">        let observable &#x3D; Observable&lt;Int&gt;.interval(1, scheduler: MainScheduler.instance)</span><br><span class="line">        observable</span><br><span class="line">            .map &#123; &quot;å½“å‰ç´¢å¼•æ•°ï¼š\($0 )&quot;&#125;</span><br><span class="line">            .bind(to: observer)</span><br><span class="line">            .disposed(by: disposeBag)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ä½¿ç”¨-Binder-åˆ›å»ºè§‚å¯Ÿè€…"><a href="#ä½¿ç”¨-Binder-åˆ›å»ºè§‚å¯Ÿè€…" class="headerlink" title="ä½¿ç”¨ Binder åˆ›å»ºè§‚å¯Ÿè€…"></a>ä½¿ç”¨ Binder åˆ›å»ºè§‚å¯Ÿè€…</h1><h3 id="1ã€åŸºæœ¬ä»‹ç»"><a href="#1ã€åŸºæœ¬ä»‹ç»" class="headerlink" title="1ã€åŸºæœ¬ä»‹ç»"></a>1ã€åŸºæœ¬ä»‹ç»</h3><p>ï¼ˆ1ï¼‰ç›¸è¾ƒäº AnyObserver çš„å¤§è€Œå…¨ï¼ŒBinder æ›´ä¸“æ³¨äºç‰¹å®šçš„åœºæ™¯ã€‚Binder ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ä¸ªç‰¹å¾ï¼š</p><ul><li>ä¸ä¼šå¤„ç†é”™è¯¯äº‹ä»¶</li><li>ç¡®ä¿ç»‘å®šéƒ½æ˜¯åœ¨ç»™å®š Scheduler ä¸Šæ‰§è¡Œï¼ˆé»˜è®¤ MainSchedulerï¼‰</li></ul><p>ï¼ˆ2ï¼‰ä¸€æ—¦äº§ç”Ÿé”™è¯¯äº‹ä»¶ï¼Œåœ¨è°ƒè¯•ç¯å¢ƒä¸‹å°†æ‰§è¡Œ fatalErrorï¼Œåœ¨å‘å¸ƒç¯å¢ƒä¸‹å°†æ‰“å°é”™è¯¯ä¿¡æ¯ã€‚</p><h3 id="ä½¿ç”¨æ ·ä¾‹-1"><a href="#ä½¿ç”¨æ ·ä¾‹-1" class="headerlink" title="ä½¿ç”¨æ ·ä¾‹"></a>ä½¿ç”¨æ ·ä¾‹</h3><p>ï¼ˆ1ï¼‰åœ¨ä¸Šé¢åºåˆ—æ•°æ˜¾ç¤ºæ ·ä¾‹ä¸­ï¼Œlabel æ ‡ç­¾çš„æ–‡å­—æ˜¾ç¤ºå°±æ˜¯ä¸€ä¸ªå…¸å‹çš„ UI è§‚å¯Ÿè€…ã€‚å®ƒåœ¨å“åº”äº‹ä»¶æ—¶ï¼Œåªä¼šå¤„ç† next äº‹ä»¶ï¼Œè€Œä¸”æ›´æ–° UI çš„æ“ä½œéœ€è¦åœ¨ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œã€‚é‚£ä¹ˆè¿™ç§æƒ…å†µä¸‹æ›´å¥½çš„æ–¹æ¡ˆå°±æ˜¯ä½¿ç”¨ Binderã€‚<br><br>ï¼ˆ2ï¼‰ä¸Šé¢çš„æ ·ä¾‹æˆ‘ä»¬æ”¹ç”¨ Binder ä¼šç®€å•è®¸å¤šï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">import UIKit</span><br><span class="line">import RxSwift</span><br><span class="line">import RxCocoa</span><br><span class="line"> </span><br><span class="line">class ViewController: UIViewController &#123;</span><br><span class="line">     </span><br><span class="line">    @IBOutlet weak var label: UILabel!</span><br><span class="line">     </span><br><span class="line">    let disposeBag &#x3D; DisposeBag()</span><br><span class="line">     </span><br><span class="line">    override func viewDidLoad() &#123;</span><br><span class="line">                 </span><br><span class="line">        &#x2F;&#x2F;è§‚å¯Ÿè€…</span><br><span class="line">        let observer: Binder&lt;String&gt; &#x3D; Binder(label) &#123; (view, text) in</span><br><span class="line">            &#x2F;&#x2F;æ”¶åˆ°å‘å‡ºçš„ç´¢å¼•æ•°åæ˜¾ç¤ºåˆ°labelä¸Š</span><br><span class="line">            view.text &#x3D; text</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">        &#x2F;&#x2F;Observableåºåˆ—ï¼ˆæ¯éš”1ç§’é’Ÿå‘å‡ºä¸€ä¸ªç´¢å¼•æ•°ï¼‰</span><br><span class="line">        let observable &#x3D; Observable&lt;Int&gt;.interval(1, scheduler: MainScheduler.instance)</span><br><span class="line">        observable</span><br><span class="line">            .map &#123; &quot;å½“å‰ç´¢å¼•æ•°ï¼š\($0 )&quot;&#125;</span><br><span class="line">            .bind(to: observer)</span><br><span class="line">            .disposed(by: disposeBag)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é™„ï¼šBinder-åœ¨-RxCocoa-ä¸­çš„åº”ç”¨"><a href="#é™„ï¼šBinder-åœ¨-RxCocoa-ä¸­çš„åº”ç”¨" class="headerlink" title="é™„ï¼šBinder åœ¨ RxCocoa ä¸­çš„åº”ç”¨"></a>é™„ï¼šBinder åœ¨ RxCocoa ä¸­çš„åº”ç”¨</h3><p>ï¼ˆ1ï¼‰å…¶å® RxCocoa åœ¨å¯¹è®¸å¤š UI æ§ä»¶è¿›è¡Œæ‰©å±•æ—¶ï¼Œå°±åˆ©ç”¨ Binder å°†æ§ä»¶å±æ€§å˜æˆè§‚æŸ¥è€…ï¼Œæ¯”å¦‚ UIControl+Rx.swift ä¸­çš„ isEnabled å±æ€§ä¾¿æ˜¯ä¸€ä¸ª observer ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import RxSwift</span><br><span class="line">import UIKit</span><br><span class="line"> </span><br><span class="line">extension Reactive where Base: UIControl &#123;</span><br><span class="line">     </span><br><span class="line">    &#x2F;&#x2F;&#x2F; Bindable sink for &#96;enabled&#96; property.</span><br><span class="line">    public var isEnabled: Binder&lt;Bool&gt; &#123;</span><br><span class="line">        return Binder(self.base) &#123; control, value in</span><br><span class="line">            control.isEnabled &#x3D; value</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰å› æ­¤æˆ‘ä»¬å¯ä»¥å°†åºåˆ—ç›´æ¥ç»‘å®šåˆ°å®ƒä¸Šé¢ã€‚æ¯”å¦‚ä¸‹é¢æ ·ä¾‹ï¼Œbutton ä¼šåœ¨å¯ç”¨ã€ä¸å¯ç”¨è¿™ä¸¤ç§çŠ¶æ€é—´äº¤æ›¿å˜æ¢ï¼ˆæ¯éš”ä¸€ç§’ï¼‰ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;Observableåºåˆ—ï¼ˆæ¯éš”1ç§’é’Ÿå‘å‡ºä¸€ä¸ªç´¢å¼•æ•°ï¼‰</span><br><span class="line">let observable &#x3D; Observable&lt;Int&gt;.interval(1, scheduler: MainScheduler.instance)</span><br><span class="line">observable</span><br><span class="line">    .map &#123; $0 % 2 &#x3D;&#x3D; 0 &#125;</span><br><span class="line">    .bind(to: button.rx.isEnabled)</span><br><span class="line">    .disposed(by: disposeBag)</span><br></pre></td></tr></table></figure><h1 id="è‡ªå®šä¹‰å¯ç»‘å®šå±æ€§"><a href="#è‡ªå®šä¹‰å¯ç»‘å®šå±æ€§" class="headerlink" title="è‡ªå®šä¹‰å¯ç»‘å®šå±æ€§"></a>è‡ªå®šä¹‰å¯ç»‘å®šå±æ€§</h1><p>æœ‰æ—¶æˆ‘ä»¬æƒ³è®© UI æ§ä»¶åˆ›å»ºå‡ºæ¥åé»˜è®¤å°±æœ‰ä¸€äº›è§‚å¯Ÿè€…ï¼Œè€Œä¸å¿…æ¯æ¬¡éƒ½ä¸ºå®ƒä»¬å•ç‹¬å»åˆ›å»ºè§‚å¯Ÿè€…ã€‚æ¯”å¦‚æˆ‘ä»¬æƒ³è¦è®©æ‰€æœ‰çš„ UIlabel éƒ½æœ‰ä¸ª fontSize å¯ç»‘å®šå±æ€§ï¼Œå®ƒä¼šæ ¹æ®äº‹ä»¶å€¼è‡ªåŠ¨æ”¹å˜æ ‡ç­¾çš„å­—ä½“å¤§å°ã€‚</p><h3 id="æ–¹å¼ä¸€ï¼šé€šè¿‡å¯¹-UI-ç±»è¿›è¡Œæ‰©å±•"><a href="#æ–¹å¼ä¸€ï¼šé€šè¿‡å¯¹-UI-ç±»è¿›è¡Œæ‰©å±•" class="headerlink" title="æ–¹å¼ä¸€ï¼šé€šè¿‡å¯¹ UI ç±»è¿›è¡Œæ‰©å±•"></a>æ–¹å¼ä¸€ï¼šé€šè¿‡å¯¹ UI ç±»è¿›è¡Œæ‰©å±•</h3><p>è¿™é‡Œæˆ‘ä»¬é€šè¿‡å¯¹ UILabel è¿›è¡Œæ‰©å±•ï¼Œå¢åŠ äº†ä¸€ä¸ª fontSize å¯ç»‘å®šå±æ€§ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">import UIKit</span><br><span class="line">import RxSwift</span><br><span class="line">import RxCocoa</span><br><span class="line"> </span><br><span class="line">class ViewController: UIViewController &#123;</span><br><span class="line">     </span><br><span class="line">    @IBOutlet weak var label: UILabel!</span><br><span class="line">     </span><br><span class="line">    let disposeBag &#x3D; DisposeBag()</span><br><span class="line">     </span><br><span class="line">    override func viewDidLoad() &#123;</span><br><span class="line">         </span><br><span class="line">        &#x2F;&#x2F;Observableåºåˆ—ï¼ˆæ¯éš”0.5ç§’é’Ÿå‘å‡ºä¸€ä¸ªç´¢å¼•æ•°ï¼‰</span><br><span class="line">        let observable &#x3D; Observable&lt;Int&gt;.interval(0.5, scheduler: MainScheduler.instance)</span><br><span class="line">        observable</span><br><span class="line">            .map &#123; CGFloat($0) &#125;</span><br><span class="line">            .bind(to: label.fontSize) &#x2F;&#x2F;æ ¹æ®ç´¢å¼•æ•°ä¸æ–­å˜æ”¾å¤§å­—ä½“</span><br><span class="line">            .disposed(by: disposeBag)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">extension UILabel &#123;</span><br><span class="line">    public var fontSize: Binder&lt;CGFloat&gt; &#123;</span><br><span class="line">        return Binder(self) &#123; label, fontSize in</span><br><span class="line">            label.font &#x3D; UIFont.systemFont(ofSize: fontSize)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ–¹å¼äºŒï¼šé€šè¿‡å¯¹-Reactive-ç±»è¿›è¡Œæ‰©å±•"><a href="#æ–¹å¼äºŒï¼šé€šè¿‡å¯¹-Reactive-ç±»è¿›è¡Œæ‰©å±•" class="headerlink" title="æ–¹å¼äºŒï¼šé€šè¿‡å¯¹ Reactive ç±»è¿›è¡Œæ‰©å±•"></a>æ–¹å¼äºŒï¼šé€šè¿‡å¯¹ Reactive ç±»è¿›è¡Œæ‰©å±•</h3><p>æ—¢ç„¶ä½¿ç”¨äº† RxSwiftï¼Œé‚£ä¹ˆæ›´è§„èŒƒçš„å†™æ³•åº”è¯¥æ˜¯å¯¹ Reactive è¿›è¡Œæ‰©å±•ã€‚è¿™é‡ŒåŒæ ·æ˜¯ç»™ UILabel å¢åŠ äº†ä¸€ä¸ª fontSize å¯ç»‘å®šå±æ€§ã€‚<br><br>ï¼ˆæ³¨æ„ï¼šè¿™ç§æ–¹å¼ä¸‹ï¼Œæˆ‘ä»¬ç»‘å®šå±æ€§æ—¶è¦å†™æˆ label.rx.fontSizeï¼‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">import UIKit</span><br><span class="line">import RxSwift</span><br><span class="line">import RxCocoa</span><br><span class="line"> </span><br><span class="line">class ViewController: UIViewController &#123;</span><br><span class="line">     </span><br><span class="line">    @IBOutlet weak var label: UILabel!</span><br><span class="line">     </span><br><span class="line">    let disposeBag &#x3D; DisposeBag()</span><br><span class="line">     </span><br><span class="line">    override func viewDidLoad() &#123;</span><br><span class="line">         </span><br><span class="line">        &#x2F;&#x2F;Observableåºåˆ—ï¼ˆæ¯éš”0.5ç§’é’Ÿå‘å‡ºä¸€ä¸ªç´¢å¼•æ•°ï¼‰</span><br><span class="line">        let observable &#x3D; Observable&lt;Int&gt;.interval(0.5, scheduler: MainScheduler.instance)</span><br><span class="line">        observable</span><br><span class="line">            .map &#123; CGFloat($0) &#125;</span><br><span class="line">            .bind(to: label.rx.fontSize) &#x2F;&#x2F;æ ¹æ®ç´¢å¼•æ•°ä¸æ–­å˜æ”¾å¤§å­—ä½“</span><br><span class="line">            .disposed(by: disposeBag)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">extension Reactive where Base: UILabel &#123;</span><br><span class="line">    public var fontSize: Binder&lt;CGFloat&gt; &#123;</span><br><span class="line">        return Binder(self.base) &#123; label, fontSize in</span><br><span class="line">            label.font &#x3D; UIFont.systemFont(ofSize: fontSize)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="RxSwift-è‡ªå¸¦çš„å¯ç»‘å®šå±æ€§ï¼ˆUI-è§‚å¯Ÿè€…ï¼‰"><a href="#RxSwift-è‡ªå¸¦çš„å¯ç»‘å®šå±æ€§ï¼ˆUI-è§‚å¯Ÿè€…ï¼‰" class="headerlink" title="RxSwift è‡ªå¸¦çš„å¯ç»‘å®šå±æ€§ï¼ˆUI è§‚å¯Ÿè€…ï¼‰"></a>RxSwift è‡ªå¸¦çš„å¯ç»‘å®šå±æ€§ï¼ˆUI è§‚å¯Ÿè€…ï¼‰</h1><p>ï¼ˆ1ï¼‰å…¶å® RxSwift å·²ç»ä¸ºæˆ‘ä»¬æä¾›è®¸å¤šå¸¸ç”¨çš„å¯ç»‘å®šå±æ€§ã€‚æ¯”å¦‚ UILabel å°±æœ‰ text å’Œ attributedText è¿™ä¸¤ä¸ªå¯ç»‘å®šå±æ€§ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import RxSwift</span><br><span class="line">import UIKit</span><br><span class="line"> </span><br><span class="line">extension Reactive where Base: UILabel &#123;</span><br><span class="line">     </span><br><span class="line">    &#x2F;&#x2F;&#x2F; Bindable sink for &#96;text&#96; property.</span><br><span class="line">    public var text: Binder&lt;String?&gt; &#123;</span><br><span class="line">        return Binder(self.base) &#123; label, text in</span><br><span class="line">            label.text &#x3D; text</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    &#x2F;&#x2F;&#x2F; Bindable sink for &#96;attributedText&#96; property.</span><br><span class="line">    public var attributedText: Binder&lt;NSAttributedString?&gt; &#123;</span><br><span class="line">        return Binder(self.base) &#123; label, text in</span><br><span class="line">            label.attributedText &#x3D; text</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰é‚£ä¹ˆä¸Šæ–‡é‚£ä¸ªå®šæ—¶æ˜¾ç¤ºç´¢å¼•æ•°çš„æ ·ä¾‹ï¼Œæˆ‘ä»¬å…¶å®ä¸éœ€è¦è‡ªå®šä¹‰ UI è§‚å¯Ÿè€…ï¼Œç›´æ¥ä½¿ç”¨ RxSwift æä¾›çš„ç»‘å®šå±æ€§å³å¯ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import UIKit</span><br><span class="line">import RxSwift</span><br><span class="line">import RxCocoa</span><br><span class="line"> </span><br><span class="line">class ViewController: UIViewController &#123;</span><br><span class="line">     </span><br><span class="line">    @IBOutlet weak var label: UILabel!</span><br><span class="line">     </span><br><span class="line">    let disposeBag &#x3D; DisposeBag()</span><br><span class="line">     </span><br><span class="line">    override func viewDidLoad() &#123;</span><br><span class="line">         </span><br><span class="line">        &#x2F;&#x2F;Observableåºåˆ—ï¼ˆæ¯éš”1ç§’é’Ÿå‘å‡ºä¸€ä¸ªç´¢å¼•æ•°ï¼‰</span><br><span class="line">        let observable &#x3D; Observable&lt;Int&gt;.interval(1, scheduler: MainScheduler.instance)</span><br><span class="line">        observable</span><br><span class="line">            .map &#123; &quot;å½“å‰ç´¢å¼•æ•°ï¼š\($0 )&quot;&#125;</span><br><span class="line">            .bind(to: label.rx.text) &#x2F;&#x2F;æ”¶åˆ°å‘å‡ºçš„ç´¢å¼•æ•°åæ˜¾ç¤ºåˆ°labelä¸Š</span><br><span class="line">            .disposed(by: disposeBag)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Subjects-ä»‹ç»"><a href="#Subjects-ä»‹ç»" class="headerlink" title="Subjects ä»‹ç»"></a>Subjects ä»‹ç»</h1><h3 id="Subjects-åŸºæœ¬ä»‹ç»"><a href="#Subjects-åŸºæœ¬ä»‹ç»" class="headerlink" title="Subjects åŸºæœ¬ä»‹ç»"></a>Subjects åŸºæœ¬ä»‹ç»</h3><p>ï¼ˆ1ï¼‰Subjects æ—¢æ˜¯è®¢é˜…è€…ï¼Œä¹Ÿæ˜¯ Observableï¼š</p><ul><li>è¯´å®ƒæ˜¯è®¢é˜…è€…ï¼Œæ˜¯å› ä¸ºå®ƒèƒ½å¤ŸåŠ¨æ€åœ°æ¥æ”¶æ–°çš„å€¼ã€‚</li><li>è¯´å®ƒåˆæ˜¯ä¸€ä¸ª Observableï¼Œæ˜¯å› ä¸ºå½“ Subjects æœ‰äº†æ–°çš„å€¼ä¹‹åï¼Œå°±ä¼šé€šè¿‡ Event å°†æ–°å€¼å‘å‡ºç»™ä»–çš„æ‰€æœ‰è®¢é˜…è€…ã€‚</li></ul><p>ï¼ˆ2ï¼‰ä¸€å…±æœ‰å››ç§ Subjectsï¼Œåˆ†åˆ«ä¸ºï¼šPublishSubjectã€BehaviorSubjectã€ReplaySubjectã€Variableã€‚ä»–ä»¬ä¹‹é—´æ—¢æœ‰å„è‡ªçš„ç‰¹ç‚¹ï¼Œä¹Ÿæœ‰ç›¸åŒä¹‹å¤„ï¼š</p><ul><li>é¦–å…ˆä»–ä»¬éƒ½æ˜¯ Observableï¼Œä»–ä»¬çš„è®¢é˜…è€…éƒ½èƒ½æ”¶åˆ°ä»–ä»¬å‘å‡ºçš„æ–°çš„ Eventã€‚</li><li>ç›´åˆ° Subject å‘å‡º .complete æˆ–è€… .error çš„ Event åï¼Œè¯¥ Subject ä¾¿ç»ˆç»“äº†ï¼ŒåŒæ—¶å®ƒä¹Ÿå°±ä¸ä¼šå†å‘å‡º .next äº‹ä»¶ã€‚</li><li>å¯¹äºé‚£äº›åœ¨ Subject ç»ˆç»“åå†è®¢é˜…ä»–çš„è®¢é˜…è€…ï¼Œä¹Ÿèƒ½æ”¶åˆ° subject å‘å‡ºçš„ä¸€æ¡ .complete æˆ– .error çš„ eventï¼Œå‘Šè¯‰è¿™ä¸ªæ–°çš„è®¢é˜…è€…å®ƒå·²ç»ç»ˆç»“äº†ã€‚</li><li>ä»–ä»¬ä¹‹é—´æœ€å¤§çš„åŒºåˆ«åªæ˜¯åœ¨äºï¼šå½“ä¸€ä¸ªæ–°çš„è®¢é˜…è€…åˆšè®¢é˜…å®ƒçš„æ—¶å€™ï¼Œèƒ½ä¸èƒ½æ”¶åˆ° Subject ä»¥å‰å‘å‡ºè¿‡çš„æ—§ Eventï¼Œå¦‚æœèƒ½çš„è¯åˆèƒ½æ”¶åˆ°å¤šå°‘ä¸ªã€‚</li></ul><p>ï¼ˆ3ï¼‰Subject å¸¸ç”¨çš„å‡ ä¸ªæ–¹æ³•ï¼š</p><ul><li>onNext(:)ï¼šæ˜¯ on(.next(:)) çš„ç®€ä¾¿å†™æ³•ã€‚è¯¥æ–¹æ³•ç›¸å½“äº subject æ¥æ”¶åˆ°ä¸€ä¸ª .next äº‹ä»¶ã€‚</li><li>onError(:)ï¼šæ˜¯ on(.error(:)) çš„ç®€ä¾¿å†™æ³•ã€‚è¯¥æ–¹æ³•ç›¸å½“äº subject æ¥æ”¶åˆ°ä¸€ä¸ª .error äº‹ä»¶ã€‚</li><li>onCompleted()ï¼šæ˜¯ on(.completed) çš„ç®€ä¾¿å†™æ³•ã€‚è¯¥æ–¹æ³•ç›¸å½“äº subject æ¥æ”¶åˆ°ä¸€ä¸ª .completed äº‹ä»¶ã€‚</li></ul><h3 id="PublishSubject"><a href="#PublishSubject" class="headerlink" title="PublishSubject"></a>PublishSubject</h3><p>ï¼ˆ1ï¼‰åŸºæœ¬ä»‹ç»</p><ul><li>PublishSubject æ˜¯æœ€æ™®é€šçš„ Subjectï¼Œå®ƒä¸éœ€è¦åˆå§‹å€¼å°±èƒ½åˆ›å»ºã€‚</li><li>PublishSubject çš„è®¢é˜…è€…ä»ä»–ä»¬å¼€å§‹è®¢é˜…çš„æ—¶é—´ç‚¹èµ·ï¼Œå¯ä»¥æ”¶åˆ°è®¢é˜…å Subject å‘å‡ºçš„æ–° Eventï¼Œè€Œä¸ä¼šæ”¶åˆ°ä»–ä»¬åœ¨è®¢é˜…å‰å·²å‘å‡ºçš„ Eventã€‚<br>ï¼ˆ2ï¼‰æ—¶åºå›¾</li><li>æœ€ä¸Šé¢ä¸€æ¡æ˜¯ BehaviorSubjectã€‚</li><li>ä¸‹é¢ä¸¤æ¡åˆ†åˆ«è¡¨ç¤ºä¸¤ä¸ªæ–°çš„è®¢é˜…ï¼Œå®ƒä»¬è®¢é˜…çš„æ—¶é—´ç‚¹ä¸åŒï¼Œå¯ä»¥å‘ç° BehaviorSubject çš„è®¢é˜…è€…ä¸€å¼€å§‹å°±èƒ½æ”¶åˆ° BehaviorSubjects ä¹‹å‰å‘å‡ºçš„ä¸€ä¸ª Eventã€‚<br><img src="https://upload-images.jianshu.io/upload_images/3334769-516513ae6b34d5b2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ—¶åºå›¾"><br><br>ï¼ˆ3ï¼‰ä½¿ç”¨æ ·ä¾‹<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">let disposeBag &#x3D; DisposeBag()</span><br><span class="line"> </span><br><span class="line">&#x2F;&#x2F;åˆ›å»ºä¸€ä¸ªBehaviorSubject</span><br><span class="line">let subject &#x3D; BehaviorSubject(value: &quot;111&quot;)</span><br><span class="line"> </span><br><span class="line">&#x2F;&#x2F;ç¬¬1æ¬¡è®¢é˜…subject</span><br><span class="line">subject.subscribe &#123; event in</span><br><span class="line">    print(&quot;ç¬¬1æ¬¡è®¢é˜…ï¼š&quot;, event)</span><br><span class="line">&#125;.disposed(by: disposeBag)</span><br><span class="line"> </span><br><span class="line">&#x2F;&#x2F;å‘é€nextäº‹ä»¶</span><br><span class="line">subject.onNext(&quot;222&quot;)</span><br><span class="line"> </span><br><span class="line">&#x2F;&#x2F;å‘é€erroräº‹ä»¶</span><br><span class="line">subject.onError(NSError(domain: &quot;local&quot;, code: 0, userInfo: nil))</span><br><span class="line"> </span><br><span class="line">&#x2F;&#x2F;ç¬¬2æ¬¡è®¢é˜…subject</span><br><span class="line">subject.subscribe &#123; event in</span><br><span class="line">    print(&quot;ç¬¬2æ¬¡è®¢é˜…ï¼š&quot;, event)</span><br><span class="line">&#125;.disposed(by: disposeBag)</span><br></pre></td></tr></table></figure><h3 id="ReplaySubject"><a href="#ReplaySubject" class="headerlink" title="ReplaySubject"></a>ReplaySubject</h3>ï¼ˆ1ï¼‰åŸºæœ¬ä»‹ç»</li><li>ReplaySubject åœ¨åˆ›å»ºæ—¶å€™éœ€è¦è®¾ç½®ä¸€ä¸ª bufferSizeï¼Œè¡¨ç¤ºå®ƒå¯¹äºå®ƒå‘é€è¿‡çš„ event çš„ç¼“å­˜ä¸ªæ•°ã€‚</li><li>æ¯”å¦‚ä¸€ä¸ª ReplaySubject çš„ bufferSize è®¾ç½®ä¸º 2ï¼Œå®ƒå‘å‡ºäº† 3 ä¸ª .next çš„ eventï¼Œé‚£ä¹ˆå®ƒä¼šå°†åä¸¤ä¸ªï¼ˆæœ€è¿‘çš„ä¸¤ä¸ªï¼‰event ç»™ç¼“å­˜èµ·æ¥ã€‚æ­¤æ—¶å¦‚æœæœ‰ä¸€ä¸ª subscriber è®¢é˜…äº†è¿™ä¸ª ReplaySubjectï¼Œé‚£ä¹ˆè¿™ä¸ª subscriber å°±ä¼šç«‹å³æ”¶åˆ°å‰é¢ç¼“å­˜çš„ä¸¤ä¸ª .next çš„ eventã€‚</li><li>å¦‚æœä¸€ä¸ª subscriber è®¢é˜…å·²ç»ç»“æŸçš„ ReplaySubjectï¼Œé™¤äº†ä¼šæ”¶åˆ°ç¼“å­˜çš„ .next çš„ event å¤–ï¼Œè¿˜ä¼šæ”¶åˆ°é‚£ä¸ªç»ˆç»“çš„ .error æˆ–è€… .complete çš„ eventã€‚</li></ul><p>ï¼ˆ2ï¼‰æ—¶åºå›¾</p><ul><li>æœ€ä¸Šé¢ä¸€æ¡æ˜¯ ReplaySubjectï¼ˆbufferSize è®¾ä¸ºä¸º 2ï¼‰ã€‚</li><li>ä¸‹é¢ä¸¤æ¡åˆ†åˆ«è¡¨ç¤ºä¸¤ä¸ªæ–°çš„è®¢é˜…ï¼Œå®ƒä»¬è®¢é˜…çš„æ—¶é—´ç‚¹ä¸åŒã€‚å¯ä»¥å‘ç° ReplaySubject çš„è®¢é˜…è€…ä¸€å¼€å§‹å°±èƒ½æ”¶åˆ° ReplaySubject ä¹‹å‰å‘å‡ºçš„ä¸¤ä¸ª Eventï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚<br><img src="https://upload-images.jianshu.io/upload_images/3334769-4dec2ddcf714e9ac.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ—¶åºå›¾"><br><br>ï¼ˆ3ï¼‰ä½¿ç”¨æ ·ä¾‹<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">let disposeBag &#x3D; DisposeBag()</span><br><span class="line"> </span><br><span class="line">&#x2F;&#x2F;åˆ›å»ºä¸€ä¸ªbufferSizeä¸º2çš„ReplaySubject</span><br><span class="line">let subject &#x3D; ReplaySubject&lt;String&gt;.create(bufferSize: 2)</span><br><span class="line"> </span><br><span class="line">&#x2F;&#x2F;è¿ç»­å‘é€3ä¸ªnextäº‹ä»¶</span><br><span class="line">subject.onNext(&quot;111&quot;)</span><br><span class="line">subject.onNext(&quot;222&quot;)</span><br><span class="line">subject.onNext(&quot;333&quot;)</span><br><span class="line"> </span><br><span class="line">&#x2F;&#x2F;ç¬¬1æ¬¡è®¢é˜…subject</span><br><span class="line">subject.subscribe &#123; event in</span><br><span class="line">    print(&quot;ç¬¬1æ¬¡è®¢é˜…ï¼š&quot;, event)</span><br><span class="line">&#125;.disposed(by: disposeBag)</span><br><span class="line"> </span><br><span class="line">&#x2F;&#x2F;å†å‘é€1ä¸ªnextäº‹ä»¶</span><br><span class="line">subject.onNext(&quot;444&quot;)</span><br><span class="line"> </span><br><span class="line">&#x2F;&#x2F;ç¬¬2æ¬¡è®¢é˜…subject</span><br><span class="line">subject.subscribe &#123; event in</span><br><span class="line">    print(&quot;ç¬¬2æ¬¡è®¢é˜…ï¼š&quot;, event)</span><br><span class="line">&#125;.disposed(by: disposeBag)</span><br><span class="line"> </span><br><span class="line">&#x2F;&#x2F;è®©subjectç»“æŸ</span><br><span class="line">subject.onCompleted()</span><br><span class="line"> </span><br><span class="line">&#x2F;&#x2F;ç¬¬3æ¬¡è®¢é˜…subject</span><br><span class="line">subject.subscribe &#123; event in</span><br><span class="line">    print(&quot;ç¬¬3æ¬¡è®¢é˜…ï¼š&quot;, event)</span><br><span class="line">&#125;.disposed(by: disposeBag)</span><br></pre></td></tr></table></figure><h3 id="Variable"><a href="#Variable" class="headerlink" title="Variable"></a>Variable</h3>ï¼ˆæ³¨æ„ï¼šç”±äº Variable åœ¨ä¹‹åç‰ˆæœ¬ä¸­å°†è¢«åºŸå¼ƒï¼Œå»ºè®®ä½¿ç”¨ Varible çš„åœ°æ–¹éƒ½æ”¹ç”¨ä¸‹é¢ä»‹ç»çš„ BehaviorRelay ä½œä¸ºæ›¿ä»£ã€‚ï¼‰<br><br>ï¼ˆ1ï¼‰åŸºæœ¬ä»‹ç»</li><li>Variable å…¶å®å°±æ˜¯å¯¹ BehaviorSubject çš„å°è£…ï¼Œæ‰€ä»¥å®ƒä¹Ÿå¿…é¡»è¦é€šè¿‡ä¸€ä¸ªé»˜è®¤çš„åˆå§‹å€¼è¿›è¡Œåˆ›å»ºã€‚</li><li>Variable å…·æœ‰ BehaviorSubject çš„åŠŸèƒ½ï¼Œèƒ½å¤Ÿå‘å®ƒçš„è®¢é˜…è€…å‘å‡ºä¸Šä¸€ä¸ª event ä»¥åŠä¹‹åæ–°åˆ›å»ºçš„ eventã€‚</li><li>ä¸åŒçš„æ˜¯ï¼ŒVariable è¿˜æŠŠä¼šæŠŠå½“å‰å‘å‡ºçš„å€¼ä¿å­˜ä¸ºè‡ªå·±çš„çŠ¶æ€ã€‚åŒæ—¶å®ƒä¼šåœ¨é”€æ¯æ—¶è‡ªåŠ¨å‘é€ .complete çš„ eventï¼Œä¸éœ€è¦ä¹Ÿä¸èƒ½æ‰‹åŠ¨ç»™ Variables å‘é€ completed æˆ–è€… error äº‹ä»¶æ¥ç»“æŸå®ƒã€‚</li><li>ç®€å•åœ°è¯´å°±æ˜¯ Variable æœ‰ä¸€ä¸ª value å±æ€§ï¼Œæˆ‘ä»¬æ”¹å˜è¿™ä¸ª value å±æ€§çš„å€¼å°±ç›¸å½“äºè°ƒç”¨ä¸€èˆ¬ Subjects çš„ onNext() æ–¹æ³•ï¼Œè€Œè¿™ä¸ªæœ€æ–°çš„ onNext() çš„å€¼å°±è¢«ä¿å­˜åœ¨ value å±æ€§é‡Œäº†ï¼Œç›´åˆ°æˆ‘ä»¬å†æ¬¡ä¿®æ”¹å®ƒã€‚<blockquote><p>æ³¨æ„ï¼š<br><br>Variables æœ¬èº«æ²¡æœ‰ subscribe() æ–¹æ³•ï¼Œä½†æ˜¯æ‰€æœ‰ Subjects éƒ½æœ‰ä¸€ä¸ª asObservable() æ–¹æ³•ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•è¿”å›è¿™ä¸ª Variable çš„ Observable ç±»å‹ï¼Œæ‹¿åˆ°è¿™ä¸ª Observable ç±»å‹æˆ‘ä»¬å°±èƒ½è®¢é˜…å®ƒäº†ã€‚</p></blockquote></li></ul><p>ï¼ˆ2ï¼‰ä½¿ç”¨æ ·ä¾‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">import UIKit</span><br><span class="line">import RxSwift</span><br><span class="line">import RxCocoa</span><br><span class="line"> </span><br><span class="line">class ViewController: UIViewController &#123;</span><br><span class="line">     </span><br><span class="line">    override func viewDidLoad() &#123;</span><br><span class="line">        super.viewDidLoad()</span><br><span class="line"> </span><br><span class="line">        let disposeBag &#x3D; DisposeBag()</span><br><span class="line">         </span><br><span class="line">        &#x2F;&#x2F;åˆ›å»ºä¸€ä¸ªåˆå§‹å€¼ä¸º111çš„Variable</span><br><span class="line">        let variable &#x3D; Variable(&quot;111&quot;)</span><br><span class="line">         </span><br><span class="line">        &#x2F;&#x2F;ä¿®æ”¹valueå€¼</span><br><span class="line">        variable.value &#x3D; &quot;222&quot;</span><br><span class="line">         </span><br><span class="line">        &#x2F;&#x2F;ç¬¬1æ¬¡è®¢é˜…</span><br><span class="line">        variable.asObservable().subscribe &#123;</span><br><span class="line">            print(&quot;ç¬¬1æ¬¡è®¢é˜…ï¼š&quot;, $0)</span><br><span class="line">        &#125;.disposed(by: disposeBag)</span><br><span class="line">         </span><br><span class="line">        &#x2F;&#x2F;ä¿®æ”¹valueå€¼</span><br><span class="line">        variable.value &#x3D; &quot;333&quot;</span><br><span class="line">         </span><br><span class="line">        &#x2F;&#x2F;ç¬¬2æ¬¡è®¢é˜…</span><br><span class="line">        variable.asObservable().subscribe &#123;</span><br><span class="line">            print(&quot;ç¬¬2æ¬¡è®¢é˜…ï¼š&quot;, $0)</span><br><span class="line">        &#125;.disposed(by: disposeBag)</span><br><span class="line">         </span><br><span class="line">        &#x2F;&#x2F;ä¿®æ”¹valueå€¼</span><br><span class="line">        variable.value &#x3D; &quot;444&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="BehaviorRelay"><a href="#BehaviorRelay" class="headerlink" title="BehaviorRelay"></a>BehaviorRelay</h3><p>ï¼ˆ1ï¼‰åŸºæœ¬ä»‹ç»</p><ul><li>BehaviorRelay æ˜¯ä½œä¸º Variable çš„æ›¿ä»£è€…å‡ºç°çš„ã€‚å®ƒçš„æœ¬è´¨å…¶å®ä¹Ÿæ˜¯å¯¹ BehaviorSubject çš„å°è£…ï¼Œæ‰€ä»¥å®ƒä¹Ÿå¿…é¡»è¦é€šè¿‡ä¸€ä¸ªé»˜è®¤çš„åˆå§‹å€¼è¿›è¡Œåˆ›å»ºã€‚</li><li>BehaviorRelay å…·æœ‰ BehaviorSubject çš„åŠŸèƒ½ï¼Œèƒ½å¤Ÿå‘å®ƒçš„è®¢é˜…è€…å‘å‡ºä¸Šä¸€ä¸ª event ä»¥åŠä¹‹åæ–°åˆ›å»ºçš„ eventã€‚</li><li>ä¸ BehaviorSubject ä¸åŒçš„æ˜¯ï¼Œä¸éœ€è¦ä¹Ÿä¸èƒ½æ‰‹åŠ¨ç»™ BehaviorReply å‘é€ completed æˆ–è€… error äº‹ä»¶æ¥ç»“æŸå®ƒï¼ˆBehaviorRelay ä¼šåœ¨é”€æ¯æ—¶ä¹Ÿä¸ä¼šè‡ªåŠ¨å‘é€ .complete çš„ eventï¼‰ã€‚</li><li>BehaviorRelay æœ‰ä¸€ä¸ª value å±æ€§ï¼Œæˆ‘ä»¬é€šè¿‡è¿™ä¸ªå±æ€§å¯ä»¥è·å–æœ€æ–°å€¼ã€‚è€Œé€šè¿‡å®ƒçš„ accept() æ–¹æ³•å¯ä»¥å¯¹å€¼è¿›è¡Œä¿®æ”¹ã€‚</li></ul><p>ï¼ˆ2ï¼‰ä¸Šé¢çš„ Variable æ ·ä¾‹æˆ‘ä»¬å¯ä»¥æ”¹ç”¨æˆ BehaviorRelayï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">import UIKit</span><br><span class="line">import RxSwift</span><br><span class="line">import RxCocoa</span><br><span class="line"> </span><br><span class="line">class ViewController: UIViewController &#123;</span><br><span class="line">     </span><br><span class="line">    override func viewDidLoad() &#123;</span><br><span class="line">        super.viewDidLoad()</span><br><span class="line">         </span><br><span class="line">        let disposeBag &#x3D; DisposeBag()</span><br><span class="line">         </span><br><span class="line">        &#x2F;&#x2F;åˆ›å»ºä¸€ä¸ªåˆå§‹å€¼ä¸º111çš„BehaviorRelay</span><br><span class="line">        let subject &#x3D; BehaviorRelay&lt;String&gt;(value: &quot;111&quot;)</span><br><span class="line">         </span><br><span class="line">        &#x2F;&#x2F;ä¿®æ”¹valueå€¼</span><br><span class="line">        subject.accept(&quot;222&quot;)</span><br><span class="line">         </span><br><span class="line">        &#x2F;&#x2F;ç¬¬1æ¬¡è®¢é˜…</span><br><span class="line">        subject.asObservable().subscribe &#123;</span><br><span class="line">            print(&quot;ç¬¬1æ¬¡è®¢é˜…ï¼š&quot;, $0)</span><br><span class="line">            &#125;.disposed(by: disposeBag)</span><br><span class="line">         </span><br><span class="line">        &#x2F;&#x2F;ä¿®æ”¹valueå€¼</span><br><span class="line">        subject.accept(&quot;333&quot;)</span><br><span class="line">         </span><br><span class="line">        &#x2F;&#x2F;ç¬¬2æ¬¡è®¢é˜…</span><br><span class="line">        subject.asObservable().subscribe &#123;</span><br><span class="line">            print(&quot;ç¬¬2æ¬¡è®¢é˜…ï¼š&quot;, $0)</span><br><span class="line">            &#125;.disposed(by: disposeBag)</span><br><span class="line">         </span><br><span class="line">        &#x2F;&#x2F;ä¿®æ”¹valueå€¼</span><br><span class="line">        subject.accept(&quot;444&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ï¼ˆ3ï¼‰å¦‚æœæƒ³å°†æ–°å€¼åˆå¹¶åˆ°åŸå€¼ä¸Šï¼Œå¯ä»¥é€šè¿‡ accept() æ–¹æ³•ä¸ value å±æ€§é…åˆæ¥å®ç°ã€‚ï¼ˆè¿™ä¸ªå¸¸ç”¨åœ¨è¡¨æ ¼ä¸Šæ‹‰åŠ è½½åŠŸèƒ½ä¸Šï¼ŒBehaviorRelay ç”¨æ¥ä¿å­˜æ‰€æœ‰åŠ è½½åˆ°çš„æ•°æ®ï¼‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">import UIKit</span><br><span class="line">import RxSwift</span><br><span class="line">import RxCocoa</span><br><span class="line"> </span><br><span class="line">class ViewController: UIViewController &#123;</span><br><span class="line">     </span><br><span class="line">    override func viewDidLoad() &#123;</span><br><span class="line">        super.viewDidLoad()</span><br><span class="line">         </span><br><span class="line">        let disposeBag &#x3D; DisposeBag()</span><br><span class="line">         </span><br><span class="line">        &#x2F;&#x2F;åˆ›å»ºä¸€ä¸ªåˆå§‹å€¼ä¸ºåŒ…å«ä¸€ä¸ªå…ƒç´ çš„æ•°ç»„çš„BehaviorRelay</span><br><span class="line">        let subject &#x3D; BehaviorRelay&lt;[String]&gt;(value: [&quot;1&quot;])</span><br><span class="line">         </span><br><span class="line">        &#x2F;&#x2F;ä¿®æ”¹valueå€¼</span><br><span class="line">        subject.accept(subject.value + [&quot;2&quot;, &quot;3&quot;])</span><br><span class="line">         </span><br><span class="line">        &#x2F;&#x2F;ç¬¬1æ¬¡è®¢é˜…</span><br><span class="line">        subject.asObservable().subscribe &#123;</span><br><span class="line">            print(&quot;ç¬¬1æ¬¡è®¢é˜…ï¼š&quot;, $0)</span><br><span class="line">            &#125;.disposed(by: disposeBag)</span><br><span class="line">         </span><br><span class="line">        &#x2F;&#x2F;ä¿®æ”¹valueå€¼</span><br><span class="line">        subject.accept(subject.value + [&quot;4&quot;, &quot;5&quot;])</span><br><span class="line">         </span><br><span class="line">        &#x2F;&#x2F;ç¬¬2æ¬¡è®¢é˜…</span><br><span class="line">        subject.asObservable().subscribe &#123;</span><br><span class="line">            print(&quot;ç¬¬2æ¬¡è®¢é˜…ï¼š&quot;, $0)</span><br><span class="line">            &#125;.disposed(by: disposeBag)</span><br><span class="line">         </span><br><span class="line">        &#x2F;&#x2F;ä¿®æ”¹valueå€¼</span><br><span class="line">        subject.accept(subject.value + [&quot;6&quot;, &quot;7&quot;])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> ç¬¬ä¸‰æ–¹åº“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iOSç¬¬ä¸‰æ–¹åº“-FMDB-æ¨¡å‹è¿›è¡Œå­˜å–(Model)</title>
      <link href="/2020/01/16/iOS%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93-FMDB-%E6%A8%A1%E5%9E%8B%E8%BF%9B%E8%A1%8C%E5%AD%98%E5%8F%96(Model)/"/>
      <url>/2020/01/16/iOS%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93-FMDB-%E6%A8%A1%E5%9E%8B%E8%BF%9B%E8%A1%8C%E5%AD%98%E5%8F%96(Model)/</url>
      
        <content type="html"><![CDATA[<p>å†™è¿™ä¸ªBlogçš„ç›®çš„æ˜¯ä¸ºäº†è®°å½•çš„å­¦ä¹ ç»å†ï¼Œä»£ç å†™çš„ä¸æ˜¯å¾ˆå¥½ï¼Œå¸Œæœ›è¯»è€…ç†è§£ã€‚<br>æ—¥å¸¸å¯¹æ•°æ®åº“çš„æ“ä½œï¼Œéœ€è¦è®¾è®¡å­—æ®µï¼Œæ„Ÿè§‰å¤ªç¹çäº†ï¼Œæƒ³æ‰¾ä¸ªç®€åŒ–çš„æ–¹æ³•ï¼Œå°±æƒ³é€šè¿‡è¿™æ ·è¿›è¡Œå®ç°ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸€ç§æ€è€ƒæ–¹å¼ã€‚å®é™…å®ç°è¿˜æ˜¯çœ‹éœ€æ±‚ã€‚å…·ä½“çœ‹ä»£ç ï¼š<br>1ã€å¯¼å…¥FMDB</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import FMDB</span><br></pre></td></tr></table></figure><p>2ã€ä½¿ç”¨å•åˆ©æ¨¡å¼å’Œå¿…è¦å±æ€§</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">static let defaultManger &#x3D; WDDataBaseManager()</span><br><span class="line">typealias successBlock &#x3D; () -&gt;Void</span><br><span class="line">typealias failBlock &#x3D; () -&gt;Void</span><br><span class="line">private var tableName:String?</span><br></pre></td></tr></table></figure><p>3ã€æ‡’åŠ è½½åˆ›å»ºæ•°æ®åº“ï¼ˆåç§°æˆ‘éšä¾¿å–å¾—ï¼‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">lazy var fmdb:FMDatabase &#x3D; &#123;</span><br><span class="line">        let path &#x3D; NSHomeDirectory().appending(&quot;&#x2F;Documents&#x2F;testDB.db&quot;)</span><br><span class="line">        let db &#x3D; FMDatabase(path: path)</span><br><span class="line">        return db</span><br><span class="line">    &#125;()</span><br></pre></td></tr></table></figure><p>4ã€åˆ›å»ºè¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">func creatTable(tableName:String) -&gt; Void &#123;</span><br><span class="line">        fmdb.open()</span><br><span class="line">        self.tableName &#x3D; tableName</span><br><span class="line">        let creatSql &#x3D; &quot;create table if not exists \(tableName) (id integer primary key autoincrement,model BLOB)&quot;</span><br><span class="line">        let result &#x3D; fmdb.executeUpdate(creatSql, withArgumentsIn:[])</span><br><span class="line">        if result&#123;</span><br><span class="line">            print(&quot;åˆ›å»ºè¡¨æˆåŠŸ&quot;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>5ã€åˆ é™¤è¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">func dropTable() -&gt; Void &#123;</span><br><span class="line">       let sql &#x3D; &quot;drop table if exists &quot; + tableName!</span><br><span class="line">       let result &#x3D; fmdb.executeUpdate(sql, withArgumentsIn:[])</span><br><span class="line">       if result&#123;</span><br><span class="line">           print(&quot;åˆ é™¤è¡¨æˆåŠŸ&quot;)</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>6ã€æ’å…¥æ•°æ®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">func insert(model:NSObject, successBlock: successBlock, failBlock: failBlock) -&gt; Void &#123;</span><br><span class="line">        let modelData &#x3D; try! NSKeyedArchiver.archivedData(withRootObject: model, requiringSecureCoding: false)</span><br><span class="line">        let insertSql &#x3D; &quot;insert into &quot; + tableName! + &quot; (model) values(?)&quot;</span><br><span class="line">        do &#123;</span><br><span class="line">            try fmdb.executeUpdate(insertSql, values: [modelData])</span><br><span class="line">            successBlock()</span><br><span class="line">        &#125; catch &#123;</span><br><span class="line">            print(fmdb.lastError())</span><br><span class="line">            failBlock()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>7ã€æ›´æ–°è¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">func update(model:NSObject,uid:Int32, successBlock: successBlock, failBlock: failBlock) -&gt; Void &#123;</span><br><span class="line">        let modelData &#x3D; try! NSKeyedArchiver.archivedData(withRootObject: model, requiringSecureCoding: false)</span><br><span class="line">        let updateSql &#x3D; &quot;update &quot; + tableName! + &quot; set model &#x3D; ? where id &#x3D; ?&quot;</span><br><span class="line">        do &#123;</span><br><span class="line">            try fmdb.executeUpdate(updateSql, values: [modelData, uid])</span><br><span class="line">            successBlock()</span><br><span class="line">        &#125; catch &#123;</span><br><span class="line">            print(fmdb.lastError())</span><br><span class="line">            failBlock()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>8ã€æŸ¥è¯¢æ•°æ®ï¼ˆè¿™æ˜¯æŸ¥è¯¢æ‰€æœ‰æ•°æ®ï¼Œå…¶ä»–æŒ‰éœ€æ±‚è®¾è®¡ï¼‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">func selectAll() -&gt; [NSObject] &#123;</span><br><span class="line">        var tmpArr &#x3D; [NSObject]()</span><br><span class="line">        let selectSql &#x3D; &quot;select * from &quot; + tableName!</span><br><span class="line">        do &#123;</span><br><span class="line">            let rs &#x3D; try fmdb.executeQuery(selectSql, values:nil)</span><br><span class="line">            while rs.next() &#123;</span><br><span class="line">                var model &#x3D; NSObject()</span><br><span class="line">                let modelData  &#x3D; rs.data(forColumn:&quot;model&quot;)</span><br><span class="line">                let id &#x3D; rs.int(forColumn: &quot;id&quot;)</span><br><span class="line">                model &#x3D; try! NSKeyedUnarchiver.unarchiveTopLevelObjectWithData(modelData!) as! NSObject</span><br><span class="line">                model.wd_fmdb_id &#x3D; id</span><br><span class="line">                tmpArr.append(model)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; catch &#123;</span><br><span class="line">            print(fmdb.lastError())</span><br><span class="line">        &#125;</span><br><span class="line">        return tmpArr</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>9ã€åˆ é™¤æ•°æ®ï¼ˆè¿™æ˜¯æ ¹æ®Idåˆ é™¤çš„ï¼‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">func delete(uid:Int32, successBlock: successBlock, failBlock: failBlock) -&gt; Void &#123;</span><br><span class="line">        let deleteSql &#x3D; &quot;delete from &quot; + tableName! + &quot; where id &#x3D; ?&quot;</span><br><span class="line">        do &#123;</span><br><span class="line">            try fmdb.executeUpdate(deleteSql, values: [uid])</span><br><span class="line">            successBlock()</span><br><span class="line">        &#125; catch &#123;</span><br><span class="line">            print(fmdb.lastError())</span><br><span class="line">            failBlock()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>10ã€æ–°å¢åˆ†ç±»æ·»åŠ é»˜è®¤Id</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">private var wd_id_key: String &#x3D; &quot;key&quot;</span><br><span class="line"></span><br><span class="line">extension NSObject &#123;</span><br><span class="line">    open var wd_fmdb_id:Int32? &#123;</span><br><span class="line">        get &#123;</span><br><span class="line">            return (objc_getAssociatedObject(self, &amp;wd_id_key) as? Int32)</span><br><span class="line">        &#125; set(newValue) &#123;</span><br><span class="line">            objc_setAssociatedObject(self, &amp;wd_id_key, newValue, objc_AssociationPolicy.OBJC_ASSOCIATION_ASSIGN)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>11ã€ä½¿ç”¨æ–¹æ³•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;1. åœ¨Appdelegateä¸­æ‰“å¼€æ•°æ®åº“</span><br><span class="line">func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?) -&gt; Bool &#123;</span><br><span class="line">        DataBaseManager.defaultManger.creatTable()</span><br><span class="line">        return true</span><br><span class="line"> &#125;</span><br><span class="line">&#x2F;&#x2F;2ã€æ·»åŠ æ•°æ®</span><br><span class="line">WDDataBaseManager.defaultManger.insert(model: model, successBlock: &#123;</span><br><span class="line">                print(&quot;æˆåŠŸ&quot;)</span><br><span class="line">            &#125;, failBlock: &#123;</span><br><span class="line">                 print(&quot;å¤±è´¥&quot;)</span><br><span class="line">            &#125;)</span><br><span class="line">&#x2F;&#x2F;3ã€ä¿®æ”¹æ•°æ®</span><br><span class="line">WDDataBaseManager.defaultManger.update(model: model, uid: self.model!.wd_fmdb_id!, successBlock: &#123;</span><br><span class="line">               print(&quot;æˆåŠŸ&quot;)</span><br><span class="line">            &#125;, failBlock: &#123;</span><br><span class="line">                print(&quot;å¤±è´¥&quot;)</span><br><span class="line">            &#125;)</span><br><span class="line">&#x2F;&#x2F;4ã€åˆ é™¤æ•°æ®</span><br><span class="line">WDDataBaseManager.defaultManger.delete(uid: model.wd_fmdb_id!, successBlock: &#123;</span><br><span class="line">                print(&quot;æˆåŠŸ&quot;)</span><br><span class="line">            &#125;, failBlock: &#123;</span><br><span class="line">                print(&quot;å¤±è´¥&quot;)</span><br><span class="line">            &#125;)</span><br><span class="line">&#x2F;&#x2F; 5ã€æŸ¥è¯¢æ•°æ®</span><br><span class="line">WDDataBaseManager.defaultManger.selectAll()</span><br></pre></td></tr></table></figure><ul><li>éµå¾ªNSCoding é‡å†™ä¸‰ä¸ªæ–¹æ³•<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">import UIKit</span><br><span class="line"></span><br><span class="line">class Model: NSObject , NSCoding&#123;</span><br><span class="line"></span><br><span class="line">    public var name:String?</span><br><span class="line">    public var phone:String?</span><br><span class="line">    public var addres:String?</span><br><span class="line">    </span><br><span class="line">    override init() &#123;</span><br><span class="line">        super.init()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    func encode(with aCoder: NSCoder) &#123;</span><br><span class="line">        aCoder.encode(name, forKey: &quot;name&quot;)</span><br><span class="line">        aCoder.encode(phone, forKey: &quot;phone&quot;)</span><br><span class="line">        aCoder.encode(addres, forKey: &quot;addres&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    required init?(coder aDecoder: NSCoder) &#123;</span><br><span class="line">        super.init()</span><br><span class="line">        self.name &#x3D; aDecoder.decodeObject(forKey: &quot;name&quot;) as? String</span><br><span class="line">        self.addres &#x3D; aDecoder.decodeObject(forKey: &quot;addres&quot;) as? String</span><br><span class="line">        self.phone &#x3D; aDecoder.decodeObject(forKey: &quot;phone&quot;) as? String</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>12ã€æ•ˆæœå›¾</li></ul><p><img src="https://upload-images.jianshu.io/upload_images/3334769-309b5904357f7e30.gif?imageMogr2/auto-orient/strip" alt="æ•ˆæœå›¾"></p><p>13ã€Demoåœ°å€:<a href="https://github.com/wudan-ios/FMDB-Model.git" target="_blank" rel="noopener">https://github.com/wudan-ios/FMDB-Model.git</a></p><hr><p>è¡¥å……Objective-Cç‰ˆæœ¬<br>1ã€æ¥å£æ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;Foundation&#x2F;Foundation.h&gt;</span><br><span class="line"></span><br><span class="line">NS_ASSUME_NONNULL_BEGIN</span><br><span class="line"></span><br><span class="line">@interface NSObject (addId)</span><br><span class="line"></span><br><span class="line">@property (nonatomic) NSInteger wd_fmdb_id;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">typedef void(^successBlock)(void);</span><br><span class="line">typedef void(^failBlock)(void);</span><br><span class="line"></span><br><span class="line">@interface WDDataBaseManager : NSObject</span><br><span class="line"></span><br><span class="line">+ (instancetype)manager;</span><br><span class="line">&#x2F;** åˆ›å»ºè¡¨ *&#x2F;</span><br><span class="line">- (void)createTableWithName:(NSString *)name;</span><br><span class="line">&#x2F;** åˆ é™¤è¡¨ *&#x2F;</span><br><span class="line">- (void)dropTable;</span><br><span class="line">&#x2F;** æ·»åŠ æ•°æ® *&#x2F;</span><br><span class="line">- (void)insertDataWithModel:(NSObject *)model successBlock:(successBlock)aSuccessBlock failBlock:(failBlock)aFailBlock;</span><br><span class="line">&#x2F;** æ›´æ–°æ•°æ® *&#x2F;</span><br><span class="line">- (void)updateDataWithModel:(NSObject *)model uid:(NSInteger)aUid successBlock:(successBlock)aSuccessBlock failBlock:(failBlock)aFailBlock;</span><br><span class="line">&#x2F;** åˆ é™¤æ•°æ® *&#x2F;</span><br><span class="line">- (void)deleteDataWithUid:(NSInteger)uid successBlock:(successBlock)aSuccessBlock failBlock:(failBlock)aFailBlock;</span><br><span class="line">&#x2F;** æŸ¥è¯¢å…¨éƒ¨æ•°æ® *&#x2F;</span><br><span class="line">- (NSArray&lt;NSObject *&gt; *)queryAllData;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line">NS_ASSUME_NONNULL_END</span><br></pre></td></tr></table></figure><p>2ã€å®ç°æ–‡ä»¶</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;WDDataBaseManager.h&quot;</span><br><span class="line">#import &lt;FMDB.h&gt;</span><br><span class="line">#import &lt;objc&#x2F;runtime.h&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">static char *wd_id_key &#x3D; &quot;key&quot;;</span><br><span class="line">@implementation NSObject (addId)</span><br><span class="line"></span><br><span class="line">- (NSInteger)wd_fmdb_id &#123;</span><br><span class="line">    NSNumber *numberValue &#x3D; objc_getAssociatedObject(self, wd_id_key);</span><br><span class="line">    return numberValue.integerValue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)setWd_fmdb_id:(NSInteger)wd_fmdb_id &#123;</span><br><span class="line">    objc_setAssociatedObject(self, wd_id_key, @(wd_fmdb_id), OBJC_ASSOCIATION_ASSIGN);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@interface WDDataBaseManager ()</span><br><span class="line"></span><br><span class="line">@property (nonatomic, strong) FMDatabase *fmdb;</span><br><span class="line">@property (nonatomic, copy) NSString *tableName;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">@implementation WDDataBaseManager</span><br><span class="line"></span><br><span class="line">+ (instancetype)manager &#123;</span><br><span class="line">    static dispatch_once_t onceToken;</span><br><span class="line">    static WDDataBaseManager *manager &#x3D; nil;</span><br><span class="line">    dispatch_once(&amp;onceToken, ^&#123;</span><br><span class="line">        manager &#x3D; [[WDDataBaseManager alloc] init];</span><br><span class="line">    &#125;);</span><br><span class="line">    return manager;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)createTableWithName:(NSString *)name &#123;</span><br><span class="line">    [self.fmdb open];</span><br><span class="line">    self.tableName &#x3D; name;</span><br><span class="line">    NSString *sql &#x3D; [NSString stringWithFormat:@&quot;create table if not exists %@ (id integer primary key autoincrement,model BLOB)&quot;, name];</span><br><span class="line">    BOOL result &#x3D; [self.fmdb executeUpdate:sql];</span><br><span class="line">    if (result) &#123;</span><br><span class="line">        NSLog(@&quot;è¡¨åˆ›å»ºæˆåŠŸ&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)dropTable &#123;</span><br><span class="line">    NSString *sql &#x3D; [NSString stringWithFormat:@&quot;drop table if exists %@&quot;, self.tableName];</span><br><span class="line">    BOOL result &#x3D; [self.fmdb executeUpdate:sql];</span><br><span class="line">    if (result) &#123;</span><br><span class="line">        NSLog(@&quot;è¡¨åˆ é™¤æˆåŠŸ&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)insertDataWithModel:(NSObject *)model successBlock:(successBlock)aSuccessBlock failBlock:(failBlock)aFailBlock &#123;</span><br><span class="line">    NSData *modelData &#x3D; [NSKeyedArchiver archivedDataWithRootObject:model];</span><br><span class="line">    NSString *sql &#x3D; [NSString stringWithFormat:@&quot;insert into %@ (model) values(?)&quot;, self.tableName];</span><br><span class="line">    BOOL result &#x3D; [self.fmdb executeUpdate:sql withArgumentsInArray:@[modelData]];</span><br><span class="line">    if (result) &#123;</span><br><span class="line">        aSuccessBlock();</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        aFailBlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)updateDataWithModel:(NSObject *)model uid:(NSInteger)aUid successBlock:(successBlock)aSuccessBlock failBlock:(failBlock)aFailBlock &#123;</span><br><span class="line">    NSData *modelData &#x3D; [NSKeyedArchiver archivedDataWithRootObject:model];</span><br><span class="line">    NSString *sql &#x3D; [NSString stringWithFormat:@&quot;update %@ set model &#x3D; ? where id &#x3D; ?&quot;, self.tableName];</span><br><span class="line">    BOOL result &#x3D; [self.fmdb executeUpdate:sql withArgumentsInArray:@[modelData, @(aUid)]];</span><br><span class="line">    if (result) &#123;</span><br><span class="line">        aSuccessBlock();</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        aFailBlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)deleteDataWithUid:(NSInteger)uid successBlock:(successBlock)aSuccessBlock failBlock:(failBlock)aFailBlock &#123;</span><br><span class="line">    NSString *sql &#x3D; [NSString stringWithFormat:@&quot;delete from %@ where id &#x3D; ?&quot;, self.tableName];</span><br><span class="line">    BOOL result &#x3D; [self.fmdb executeUpdate:sql withArgumentsInArray:@[@(uid)]];</span><br><span class="line">    if (result) &#123;</span><br><span class="line">        aSuccessBlock();</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        aFailBlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (NSArray&lt;NSObject *&gt; *)queryAllData &#123;</span><br><span class="line">    NSMutableArray *array &#x3D; [NSMutableArray array];</span><br><span class="line">    NSString *sql &#x3D; [NSString stringWithFormat:@&quot;select * from %@&quot;,self.tableName];</span><br><span class="line">    @try &#123;</span><br><span class="line">        FMResultSet *rs &#x3D; [self.fmdb executeQuery:sql];</span><br><span class="line">        while (rs.next) &#123;</span><br><span class="line">            NSObject *model &#x3D; [[NSObject alloc] init];</span><br><span class="line">            NSData *modelData &#x3D; [rs dataForColumn:@&quot;model&quot;];</span><br><span class="line">            int uid &#x3D; [rs intForColumn:@&quot;id&quot;];</span><br><span class="line">            </span><br><span class="line">            model &#x3D; [NSKeyedUnarchiver unarchiveObjectWithData:modelData];</span><br><span class="line">            model.wd_fmdb_id &#x3D; uid;</span><br><span class="line">            [array addObject:model];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; @catch (NSException *exception) &#123;</span><br><span class="line">        NSLog(@&quot;%@&quot;, self.fmdb.lastError);</span><br><span class="line">    &#125; @finally &#123;</span><br><span class="line">        NSLog(@&quot;æŸ¥è¯¢æ•°æ®&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">   return array;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (FMDatabase *)fmdb &#123;</span><br><span class="line">    if (!_fmdb) &#123;</span><br><span class="line">        NSString *path &#x3D; [NSHomeDirectory() stringByAppendingString:@&quot;&#x2F;Documents&#x2F;testDB.db&quot;];</span><br><span class="line">        _fmdb &#x3D; [[FMDatabase alloc] initWithPath:path];</span><br><span class="line">    &#125;</span><br><span class="line">    return _fmdb;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure><p>3ã€ä½¿ç”¨æ–¹æ³•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 1ã€æ‰“å¼€æ•°æ®åº“ï¼Œå¹¶åˆ›å»ºè¡¨</span><br><span class="line">- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions &#123;</span><br><span class="line">    </span><br><span class="line">    [[WDDataBaseManager manager] createTableWithName:@&quot;test&quot;];</span><br><span class="line">    </span><br><span class="line">    return YES;</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F; 2ã€æ·»åŠ æ•°æ®</span><br><span class="line"> [[WDDataBaseManager manager] insertDataWithModel:model successBlock:^&#123;</span><br><span class="line">        &#x2F;&#x2F; TODO:</span><br><span class="line">    &#125; failBlock:^&#123;</span><br><span class="line">        &#x2F;&#x2F; TODO:</span><br><span class="line">    &#125;];</span><br><span class="line">&#x2F;&#x2F; 3ã€æŸ¥è¯¢æ•°æ®</span><br><span class="line">[[WDDataBaseManager manager] queryAllData]</span><br><span class="line">&#x2F;&#x2F; 4ã€ä¿®æ”¹æ•°æ®</span><br><span class="line">[[WDDataBaseManager manager] updateDataWithModel:model uid:self.model.wd_fmdb_id successBlock:^&#123;</span><br><span class="line">        &#x2F;&#x2F; TODO:</span><br><span class="line">    &#125; failBlock:^&#123;</span><br><span class="line">         &#x2F;&#x2F; TODO:</span><br><span class="line">    &#125;];</span><br><span class="line">&#x2F;&#x2F; 5ã€åˆ é™¤æ•°æ®</span><br><span class="line">[[WDDataBaseManager manager] deleteDataWithUid:model.wd_fmdb_id successBlock:^&#123;</span><br><span class="line">            &#x2F;&#x2F; TODO:</span><br><span class="line">        &#125; failBlock:^&#123;</span><br><span class="line">            &#x2F;&#x2F; TODO:</span><br><span class="line">        &#125;];</span><br><span class="line">&#x2F;&#x2F; 6ã€åˆ é™¤è¡¨</span><br><span class="line">[[WDDataBaseManager manager] dropTable];</span><br></pre></td></tr></table></figure><ul><li>æ’å…¥è¡¨ä¸­çš„Modeléœ€è¦éµå¾ª<NSCoding>(å®ä¾‹ä»£ç )<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">- (void)encodeWithCoder:(nonnull NSCoder *)aCoder &#123;</span><br><span class="line">    [aCoder encodeObject:self.name forKey:@&quot;name&quot;];</span><br><span class="line">    [aCoder encodeObject:self.phone forKey:@&quot;phone&quot;];</span><br><span class="line">    [aCoder encodeObject:self.address forKey:@&quot;address&quot;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (nullable instancetype)initWithCoder:(nonnull NSCoder *)aDecoder &#123;</span><br><span class="line">    if (self &#x3D;&#x3D; [super init]) &#123;</span><br><span class="line">        self.name &#x3D; [aDecoder decodeObjectForKey:@&quot;name&quot;] ;</span><br><span class="line">        self.phone &#x3D; [aDecoder decodeObjectForKey:@&quot;phone&quot;];</span><br><span class="line">        self.address &#x3D; [aDecoder decodeObjectForKey:@&quot;address&quot;];</span><br><span class="line">    &#125;</span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> ç¬¬ä¸‰æ–¹åº“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iOSç¬¬ä¸‰æ–¹åº“-AFNetworking&amp;SDWebImageåŸç†</title>
      <link href="/2020/01/16/iOS%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93-AFNetworking&amp;SDWebImage%E5%8E%9F%E7%90%86/"/>
      <url>/2020/01/16/iOS%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93-AFNetworking&amp;SDWebImage%E5%8E%9F%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h2 id="AFNetworking"><a href="#AFNetworking" class="headerlink" title="AFNetworking"></a>AFNetworking</h2><p>NSURLSession</p><blockquote><ul><li>NSURLSession</li><li>NSURLSessionConfiguation</li><li>NSURLSessionTask</li></ul></blockquote><p>NSURLSessionTask</p><blockquote><ul><li>NSURLSessionDataTask </li><li>NSURLSessionDownLoadTask </li><li>NSURLSessionUploadTask</li></ul></blockquote><p>ç½‘ç»œè¯·æ±‚çš„è¿‡ç¨‹</p><blockquote><ul><li>åˆ›å»ºNSURLSessionConfigå¯¹è±¡â€“ç”¨åˆ›å»ºçš„configå¯¹è±¡é…ç½®åˆå§‹åŒ–NSURLSessionâ€“åˆ›å»ºNSURLSessionTaskå¯¹è±¡å¹¶resumeæ‰§è¡Œï¼Œç”¨delegateæˆ–è€…blockå›è°ƒè¿”å›æ•°æ®ã€‚</li><li>AFURLSessionManagerå°è£…äº†ä¸Šè¿°ç½‘ç»œäº¤äº’åŠŸèƒ½ </li><li>AFURLSessionManagerè¯·æ±‚è¿‡ç¨‹ </li><li>1.åˆå§‹åŒ–AFURLSessionManagerã€‚ </li><li>2.è·å–AFURLSessionManagerçš„Taskå¯¹è±¡ </li><li>3.å¯åŠ¨Task</li></ul></blockquote><p>AFNetworkingç”±äº”ä¸ªæ¨¡å—ç»„æˆï¼š</p><blockquote><ul><li>NSURLSessionï¼šç½‘ç»œé€šä¿¡æ¨¡å—ï¼ˆæ ¸å¿ƒæ¨¡å—ï¼‰ å¯¹åº” AFNetworkingä¸­çš„AFURLSessionManagerå’Œå¯¹HTTPåè®®è¿›è¡Œç‰¹åŒ–å¤„ç†çš„AFHTTPSessionManager,AFHTTPSessionManageræ˜¯ç»§æ‰¿äºAFURLSessionmanager</li><li>Securityï¼šç½‘ç»œé€šè®¯å®‰å…¨ç­–ç•¥æ¨¡å— å¯¹åº” AFSecurityPolicy</li><li>Reachabilityï¼šç½‘ç»œçŠ¶æ€ç›‘å¬æ¨¡å— å¯¹åº”AFNetworkReachabilityManager</li><li>Seriaalizationï¼šç½‘ç»œé€šä¿¡ä¿¡æ¯åºåˆ—åŒ–ã€ååºåˆ—åŒ–æ¨¡å— å¯¹åº” AFURLResponseSerialization</li><li>UIKitï¼šå¯¹äºIOSUIKitçš„æ‰©å±•åº“</li></ul></blockquote><hr><h2 id="SDWebImage"><a href="#SDWebImage" class="headerlink" title="SDWebImage"></a>SDWebImage</h2><h4 id="å›¾ç‰‡è§£é‡Šï¼š"><a href="#å›¾ç‰‡è§£é‡Šï¼š" class="headerlink" title="å›¾ç‰‡è§£é‡Šï¼š"></a>å›¾ç‰‡è§£é‡Šï¼š</h4><blockquote><ul><li>å†…å­˜å±‚é¢çš„ç›¸å½“æ˜¯ä¸ªç¼“å­˜å™¨ï¼Œä»¥Key-Valueçš„å½¢å¼å­˜å‚¨å›¾ç‰‡ã€‚</li><li>å½“å†…å­˜ä¸å¤Ÿçš„æ—¶å€™ä¼šæ¸…é™¤æ‰€æœ‰ç¼“å­˜å›¾ç‰‡ã€‚</li><li>ç”¨æœç´¢æ–‡ä»¶ç³»ç»Ÿçš„æ–¹å¼åšç®¡ç†ï¼Œæ–‡ä»¶æ›¿æ¢æ–¹å¼æ˜¯ä»¥æ—¶é—´ä¸ºå•ä½ï¼Œå‰”é™¤æ—¶é—´å¤§äºä¸€å‘¨çš„å›¾ç‰‡æ–‡ä»¶ã€‚</li><li>å½“SDWebImageManagerå‘SDImageCacheè¦èµ„æºæ—¶ï¼Œå…ˆæœç´¢å†…å­˜å±‚é¢çš„æ•°æ®ï¼Œå¦‚æœæœ‰ç›´æ¥è¿”å›ï¼Œæ²¡æœ‰çš„è¯å»è®¿é—®ç£ç›˜ï¼Œå°†å›¾ç‰‡ä»ç£ç›˜è¯»å–å‡ºæ¥ï¼Œç„¶ååšDecoderï¼Œå°†å›¾ç‰‡å¯¹è±¡æ”¾åˆ°å†…å­˜å±‚é¢åšå¤‡ä»½ï¼Œå†è¿”å›è°ƒç”¨å±‚ã€‚</li></ul></blockquote><h4 id="å®ç°è¿‡ç¨‹"><a href="#å®ç°è¿‡ç¨‹" class="headerlink" title="å®ç°è¿‡ç¨‹"></a>å®ç°è¿‡ç¨‹</h4><blockquote><p>1ã€å…¥å£ setImageWithURL:placeholderImage:options: ä¼šå…ˆæŠŠ placeholderImage æ˜¾ç¤ºï¼Œç„¶å SDWebImageManager æ ¹æ® URL å¼€å§‹å¤„ç†å›¾ç‰‡ã€‚</p><p>2ã€è¿›å…¥ SDWebImageManager-downloadWithURL:delegate:options:userInfo:ï¼Œäº¤ç»™ SDImageCache ä»ç¼“å­˜æŸ¥æ‰¾å›¾ç‰‡æ˜¯å¦å·²ç»ä¸‹è½½ queryDiskCacheForKey:delegate:userInfo:.</p><p>3ã€å¦‚æœå†…å­˜ä¸­å·²ç»æœ‰å›¾ç‰‡ç¼“å­˜ï¼ŒSDImageCacheDelegate å›è°ƒ imageCache:didFindImage:forKey:userInfo: åˆ° SDWebImageManagerã€‚</p><p>4ã€SDWebImageManagerDelegate å›è°ƒ webImageManager:didFinishWithImage: åˆ° UIImageView+WebCache ç­‰å‰ç«¯å±•ç¤ºå›¾ç‰‡ã€‚</p><p>5ã€å¦‚æœå†…å­˜ç¼“å­˜ä¸­æ²¡æœ‰ï¼Œç”Ÿæˆ NSInvocationOperation æ·»åŠ åˆ°é˜Ÿåˆ—å¼€å§‹ä»ç¡¬ç›˜æŸ¥æ‰¾å›¾ç‰‡æ˜¯å¦å·²ç»ç¼“å­˜ã€‚</p><p>6ã€æ ¹æ® URLKey åœ¨ç¡¬ç›˜ç¼“å­˜ç›®å½•ä¸‹å°è¯•è¯»å–å›¾ç‰‡æ–‡ä»¶ã€‚è¿™ä¸€æ­¥æ˜¯åœ¨ NSOperation è¿›è¡Œçš„æ“ä½œï¼Œæ‰€ä»¥å›ä¸»çº¿ç¨‹è¿›è¡Œç»“æœå›è°ƒ notifyDelegate:ã€‚</p><p>7ã€å¦‚æœç¡¬ç›˜ä¸­æœ‰è¯¥å›¾ç‰‡ï¼Œå°†å›¾ç‰‡æ·»åŠ åˆ°å†…å­˜ç¼“å­˜ä¸­ï¼ˆå¦‚æœç©ºé—²å†…å­˜è¿‡å°ï¼Œä¼šå…ˆæ¸…ç©ºå†…å­˜ç¼“å­˜ï¼‰ã€‚SDImageCacheDelegate å›è°ƒ imageCache:didFindImage:forKey:userInfo:ã€‚è¿›è€Œå›è°ƒå±•ç¤ºå›¾ç‰‡ã€‚</p><p>8ã€å¦‚æœä»ç¡¬ç›˜ç¼“å­˜ç›®å½•è¯»å–ä¸åˆ°å›¾ç‰‡ï¼Œè¯´æ˜æ‰€æœ‰ç¼“å­˜éƒ½ä¸å­˜åœ¨è¯¥å›¾ç‰‡ï¼Œéœ€è¦ä¸‹è½½å›¾ç‰‡ï¼Œå›è°ƒ imageCache:didNotFindImageForKey:userInfo:ã€‚</p><p>9ã€å…±äº«æˆ–é‡æ–°ç”Ÿæˆä¸€ä¸ªä¸‹è½½å™¨ SDWebImageDownloader å¼€å§‹ä¸‹è½½å›¾ç‰‡ã€‚</p><p>10ã€å›¾ç‰‡ä¸‹è½½ç”± NSURLConnection æ¥åšï¼Œå®ç°ç›¸å…³ delegate æ¥åˆ¤æ–­å›¾ç‰‡ä¸‹è½½ä¸­ã€ä¸‹è½½å®Œæˆå’Œä¸‹è½½å¤±è´¥ã€‚</p><p>11ã€imageDownloader:didFinishWithImage: å›è°ƒç»™ SDWebImageManager å‘ŠçŸ¥å›¾ç‰‡ä¸‹è½½å®Œæˆã€‚</p><p>12ã€é€šçŸ¥æ‰€æœ‰çš„ downloadDelegates ä¸‹è½½å®Œæˆï¼Œå›è°ƒç»™éœ€è¦çš„åœ°æ–¹å±•ç¤ºå›¾ç‰‡ã€‚</p><p>13ã€å°†å›¾ç‰‡ä¿å­˜åˆ° SDImageCache ä¸­ï¼Œå†…å­˜ç¼“å­˜å’Œç¡¬ç›˜ç¼“å­˜åŒæ—¶ä¿å­˜ã€‚å†™æ–‡ä»¶åˆ°ç¡¬ç›˜ä¹Ÿåœ¨ä»¥å•ç‹¬ NSInvocationOperation å®Œæˆï¼Œé¿å…æ‹–æ…¢ä¸»çº¿ç¨‹ã€‚SDImageCache åœ¨åˆå§‹åŒ–çš„æ—¶å€™ä¼šæ³¨å†Œä¸€äº›æ¶ˆæ¯é€šçŸ¥ï¼Œåœ¨å†…å­˜è­¦å‘Šæˆ–é€€åˆ°åå°çš„æ—¶å€™æ¸…ç†å†…å­˜å›¾ç‰‡ç¼“å­˜ï¼Œåº”ç”¨ç»“æŸçš„æ—¶å€™æ¸…ç†è¿‡æœŸå›¾ç‰‡ã€‚</p></blockquote><hr>]]></content>
      
      
      
        <tags>
            
            <tag> ç¬¬ä¸‰æ–¹åº“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iOSåº•å±‚-RunLoop</title>
      <link href="/2020/01/16/iOS%E5%BA%95%E5%B1%82-RunLoop/"/>
      <url>/2020/01/16/iOS%E5%BA%95%E5%B1%82-RunLoop/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€æ¦‚å¿µ"><a href="#ä¸€ã€æ¦‚å¿µ" class="headerlink" title="ä¸€ã€æ¦‚å¿µ"></a>ä¸€ã€æ¦‚å¿µ</h2><p>RunLoopæ˜¯é€šè¿‡å†…éƒ¨ç»´æŠ¤çš„<code>äº‹ä»¶å¾ªç¯(Event Loop)</code>æ¥å¯¹<code>äº‹ä»¶/æ¶ˆæ¯è¿›è¡Œç®¡ç†</code>çš„ä¸€ä¸ªå¯¹è±¡ã€‚</p><p>1ã€æ²¡æœ‰æ¶ˆæ¯å¤„ç†æ—¶ï¼Œä¼‘çœ å·²é¿å…èµ„æºå ç”¨ï¼Œç”±ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€(CPU-å†…æ ¸æ€å’Œç”¨æˆ·æ€)<br><br>2ã€æœ‰æ¶ˆæ¯éœ€è¦å¤„ç†æ—¶ï¼Œç«‹åˆ»è¢«å”¤é†’ï¼Œç”±å†…æ ¸æ€åˆ‡æ¢åˆ°ç”¨æˆ·æ€</p><p><strong>ä¸ºä»€ä¹ˆmainå‡½æ•°ä¸ä¼šé€€å‡ºï¼Ÿ</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">int main(int argc, char * argv[]) &#123;</span><br><span class="line">    @autoreleasepool &#123;</span><br><span class="line">        return UIApplicationMain(argc, argv, nil, NSStringFromClass([AppDelegate class]));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>UIApplicationMainå†…éƒ¨é»˜è®¤å¼€å¯äº†ä¸»çº¿ç¨‹çš„RunLoopï¼Œå¹¶æ‰§è¡Œäº†ä¸€æ®µæ— é™å¾ªç¯çš„ä»£ç ï¼ˆä¸æ˜¯ç®€å•çš„forå¾ªç¯æˆ–whileå¾ªç¯ï¼‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;æ— é™å¾ªç¯ä»£ç æ¨¡å¼(ä¼ªä»£ç )</span><br><span class="line">int main(int argc, char * argv[]) &#123;        </span><br><span class="line">    BOOL running &#x3D; YES;</span><br><span class="line">    do &#123;</span><br><span class="line">        &#x2F;&#x2F; æ‰§è¡Œå„ç§ä»»åŠ¡ï¼Œå¤„ç†å„ç§äº‹ä»¶</span><br><span class="line">        &#x2F;&#x2F; ......</span><br><span class="line">    &#125; while (running);</span><br><span class="line"></span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>UIApplicationMainå‡½æ•°ä¸€ç›´æ²¡æœ‰è¿”å›ï¼Œè€Œæ˜¯ä¸æ–­åœ°æ¥æ”¶å¤„ç†æ¶ˆæ¯ä»¥åŠç­‰å¾…ä¼‘çœ ï¼Œæ‰€ä»¥è¿è¡Œç¨‹åºä¹‹åä¼šä¿æŒæŒç»­è¿è¡ŒçŠ¶æ€ã€‚</p><h2 id="äºŒã€RunLoopçš„æ•°æ®ç»“æ„"><a href="#äºŒã€RunLoopçš„æ•°æ®ç»“æ„" class="headerlink" title="äºŒã€RunLoopçš„æ•°æ®ç»“æ„"></a>äºŒã€RunLoopçš„æ•°æ®ç»“æ„</h2><p><code>NSRunLoop(Foundation)</code>æ˜¯<code>CFRunLoop(CoreFoundation)</code>çš„å°è£…ï¼Œæä¾›äº†é¢å‘å¯¹è±¡çš„API<br>RunLoop ç›¸å…³çš„ä¸»è¦æ¶‰åŠäº”ä¸ªç±»ï¼š</p><p><code>CFRunLoop</code>ï¼šRunLoopå¯¹è±¡<br><code>CFRunLoopMode</code>ï¼šè¿è¡Œæ¨¡å¼<br><code>CFRunLoopSource</code>ï¼šè¾“å…¥æº/äº‹ä»¶æº<br><code>CFRunLoopTimer</code>ï¼šå®šæ—¶æº<br><code>CFRunLoopObserver</code>ï¼šè§‚å¯Ÿè€…</p><p><strong>1ã€CFRunLoop</strong></p><p>ç”±<code>pthread</code>(çº¿ç¨‹å¯¹è±¡ï¼Œè¯´æ˜RunLoopå’Œçº¿ç¨‹æ˜¯ä¸€ä¸€å¯¹åº”çš„)ã€<code>currentMode</code>(å½“å‰æ‰€å¤„çš„è¿è¡Œæ¨¡å¼)ã€<code>modes</code>(å¤šä¸ªè¿è¡Œæ¨¡å¼çš„é›†åˆ)ã€<code>commonModes</code>(æ¨¡å¼åç§°å­—ç¬¦ä¸²é›†åˆ)ã€<code>commonModelItems</code>(Observer,Timer,Sourceé›†åˆ)æ„æˆ</p><p><strong>2ã€CFRunLoopMode</strong></p><p>ç”±nameã€source0ã€source1ã€observersã€timersæ„æˆ</p><p><strong>3ã€CFRunLoopSource</strong></p><p>åˆ†ä¸ºsource0å’Œsource1ä¸¤ç§</p><ul><li><code>source0:</code><br>å³éåŸºäºportçš„ï¼Œä¹Ÿå°±æ˜¯ç”¨æˆ·è§¦å‘çš„äº‹ä»¶ã€‚éœ€è¦æ‰‹åŠ¨å”¤é†’çº¿ç¨‹ï¼Œå°†å½“å‰çº¿ç¨‹ä»å†…æ ¸æ€åˆ‡æ¢åˆ°ç”¨æˆ·æ€</li></ul><ul><li><code>source1:</code><br>åŸºäºportçš„ï¼ŒåŒ…å«ä¸€ä¸ª mach_port å’Œä¸€ä¸ªå›è°ƒï¼Œå¯ç›‘å¬ç³»ç»Ÿç«¯å£å’Œé€šè¿‡å†…æ ¸å’Œå…¶ä»–çº¿ç¨‹å‘é€çš„æ¶ˆæ¯ï¼Œèƒ½ä¸»åŠ¨å”¤é†’RunLoopï¼Œæ¥æ”¶åˆ†å‘ç³»ç»Ÿäº‹ä»¶ã€‚<br>å…·å¤‡å”¤é†’çº¿ç¨‹çš„èƒ½åŠ›</li></ul><p><strong>4ã€CFRunLoopTimer</strong></p><p>åŸºäºæ—¶é—´çš„è§¦å‘å™¨ï¼ŒåŸºæœ¬ä¸Šè¯´çš„å°±æ˜¯NSTimerã€‚åœ¨é¢„è®¾çš„æ—¶é—´ç‚¹å”¤é†’RunLoopæ‰§è¡Œå›è°ƒã€‚å› ä¸ºå®ƒæ˜¯åŸºäºRunLoopçš„ï¼Œå› æ­¤å®ƒä¸æ˜¯å®æ—¶çš„ï¼ˆå°±æ˜¯NSTimer æ˜¯ä¸å‡†ç¡®çš„ã€‚ å› ä¸ºRunLoopåªè´Ÿè´£åˆ†å‘æºçš„æ¶ˆæ¯ã€‚å¦‚æœçº¿ç¨‹å½“å‰æ­£åœ¨å¤„ç†ç¹é‡çš„ä»»åŠ¡ï¼Œå°±æœ‰å¯èƒ½å¯¼è‡´Timeræœ¬æ¬¡å»¶æ—¶ï¼Œæˆ–è€…å°‘æ‰§è¡Œä¸€æ¬¡ï¼‰ã€‚</p><p><strong>5ã€CFRunLoopObserver</strong></p><p>ç›‘å¬ä»¥ä¸‹æ—¶é—´ç‚¹:<code>CFRunLoopActivity</code></p><ul><li><p><code>kCFRunLoopEntry</code><br>RunLoopå‡†å¤‡å¯åŠ¨</p></li><li><p><code>kCFRunLoopBeforeTimers</code><br>RunLoopå°†è¦å¤„ç†ä¸€äº›Timerç›¸å…³äº‹ä»¶</p></li><li><p><code>kCFRunLoopBeforeSources</code><br>RunLoopå°†è¦å¤„ç†ä¸€äº›Sourceäº‹ä»¶</p></li><li><p><code>kCFRunLoopBeforeWaiting</code><br>RunLoopå°†è¦è¿›è¡Œä¼‘çœ çŠ¶æ€,å³å°†ç”±ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€</p></li><li><p><code>kCFRunLoopAfterWaiting</code><br>RunLoopè¢«å”¤é†’ï¼Œå³ä»å†…æ ¸æ€åˆ‡æ¢åˆ°ç”¨æˆ·æ€å</p></li><li><p><code>kCFRunLoopExit</code><br>RunLoopé€€å‡º</p></li><li><p><code>kCFRunLoopAllActivities</code><br>ç›‘å¬æ‰€æœ‰çŠ¶æ€</p></li></ul><p><strong>6ã€å„æ•°æ®ç»“æ„ä¹‹é—´çš„è”ç³»</strong></p><p>çº¿ç¨‹å’ŒRunLoopä¸€ä¸€å¯¹åº”ï¼Œ RunLoopå’ŒModeæ˜¯ä¸€å¯¹å¤šçš„ï¼ŒModeå’Œsourceã€timerã€observerä¹Ÿæ˜¯ä¸€å¯¹å¤šçš„</p><h2 id="ä¸‰ã€RunLoopçš„Mode"><a href="#ä¸‰ã€RunLoopçš„Mode" class="headerlink" title="ä¸‰ã€RunLoopçš„Mode"></a>ä¸‰ã€RunLoopçš„Mode</h2><p>å…³äºModeé¦–å…ˆè¦çŸ¥é“ä¸€ä¸ªRunLoop å¯¹è±¡ä¸­å¯èƒ½åŒ…å«å¤šä¸ªModeï¼Œä¸”æ¯æ¬¡è°ƒç”¨ RunLoop çš„ä¸»å‡½æ•°æ—¶ï¼Œåªèƒ½æŒ‡å®šå…¶ä¸­ä¸€ä¸ª Mode(CurrentMode)ã€‚åˆ‡æ¢ Modeï¼Œéœ€è¦é‡æ–°æŒ‡å®šä¸€ä¸ª Mode ã€‚ä¸»è¦æ˜¯ä¸ºäº†åˆ†éš”å¼€ä¸åŒçš„ Sourceã€Timerã€Observerï¼Œè®©å®ƒä»¬ä¹‹é—´äº’ä¸å½±å“ã€‚</p><p>å½“RunLoopè¿è¡Œåœ¨Mode1ä¸Šæ—¶ï¼Œæ˜¯æ— æ³•æ¥å—å¤„ç†Mode2æˆ–Mode3ä¸Šçš„Sourceã€Timerã€Observeräº‹ä»¶çš„</p><p>æ€»å…±æ˜¯æœ‰äº”ç§<code>CFRunLoopMode</code>:</p><ul><li><code>kCFRunLoopDefaultMode</code>ï¼šé»˜è®¤æ¨¡å¼ï¼Œä¸»çº¿ç¨‹æ˜¯åœ¨è¿™ä¸ªè¿è¡Œæ¨¡å¼ä¸‹è¿è¡Œ</li><li><code>UITrackingRunLoopMode</code>ï¼šè·Ÿè¸ªç”¨æˆ·äº¤äº’äº‹ä»¶ï¼ˆç”¨äº ScrollView è¿½è¸ªè§¦æ‘¸æ»‘åŠ¨ï¼Œä¿è¯ç•Œé¢æ»‘åŠ¨æ—¶ä¸å—å…¶ä»–Modeå½±å“ï¼‰</li><li><code>UIInitializationRunLoopMode</code>ï¼šåœ¨åˆšå¯åŠ¨Appæ—¶ç¬¬è¿›å…¥çš„ç¬¬ä¸€ä¸ª Modeï¼Œå¯åŠ¨å®Œæˆåå°±ä¸å†ä½¿ç”¨</li><li><code>GSEventReceiveRunLoopMode</code>ï¼šæ¥å—ç³»ç»Ÿå†…éƒ¨äº‹ä»¶ï¼Œé€šå¸¸ç”¨ä¸åˆ°</li><li><code>kCFRunLoopCommonModes</code>ï¼šä¼ªæ¨¡å¼ï¼Œä¸æ˜¯ä¸€ç§çœŸæ­£çš„è¿è¡Œæ¨¡å¼ï¼Œæ˜¯åŒæ­¥Source/Timer/Observeråˆ°å¤šä¸ªModeä¸­çš„ä¸€ç§è§£å†³æ–¹æ¡ˆ</li></ul><h2 id="å››ã€RunLoopçš„å®ç°æœºåˆ¶"><a href="#å››ã€RunLoopçš„å®ç°æœºåˆ¶" class="headerlink" title="å››ã€RunLoopçš„å®ç°æœºåˆ¶"></a>å››ã€RunLoopçš„å®ç°æœºåˆ¶</h2><p>å¯¹äºRunLoopè€Œè¨€æœ€æ ¸å¿ƒçš„äº‹æƒ…å°±æ˜¯ä¿è¯çº¿ç¨‹åœ¨æ²¡æœ‰æ¶ˆæ¯çš„æ—¶å€™ä¼‘çœ ï¼Œåœ¨æœ‰æ¶ˆæ¯æ—¶å”¤é†’ï¼Œä»¥æé«˜ç¨‹åºæ€§èƒ½ã€‚RunLoopè¿™ä¸ªæœºåˆ¶æ˜¯ä¾é ç³»ç»Ÿå†…æ ¸æ¥å®Œæˆçš„ï¼ˆè‹¹æœæ“ä½œç³»ç»Ÿæ ¸å¿ƒç»„ä»¶Darwinä¸­çš„Machï¼‰ã€‚</p><p>RunLoopé€šè¿‡<code>mach_msg()</code>å‡½æ•°æ¥æ”¶ã€å‘é€æ¶ˆæ¯ã€‚å®ƒçš„æœ¬è´¨æ˜¯è°ƒç”¨å‡½æ•°<code>mach_msg_trap()</code>ï¼Œç›¸å½“äºæ˜¯ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œä¼šè§¦å‘å†…æ ¸çŠ¶æ€åˆ‡æ¢ã€‚åœ¨ç”¨æˆ·æ€è°ƒç”¨ <code>mach_msg_trap()</code>æ—¶ä¼šåˆ‡æ¢åˆ°å†…æ ¸æ€ï¼›å†…æ ¸æ€ä¸­å†…æ ¸å®ç°çš„<code>mach_msg()</code>å‡½æ•°ä¼šå®Œæˆå®é™…çš„å·¥ä½œã€‚<br>å³åŸºäºportçš„source1ï¼Œç›‘å¬ç«¯å£ï¼Œç«¯å£æœ‰æ¶ˆæ¯å°±ä¼šè§¦å‘å›è°ƒï¼›è€Œsource0ï¼Œè¦æ‰‹åŠ¨æ ‡è®°ä¸ºå¾…å¤„ç†å’Œæ‰‹åŠ¨å”¤é†’RunLoop</p><p><a href="https://www.jianshu.com/p/a764aad31847" target="_blank" rel="noopener">Machæ¶ˆæ¯å‘é€æœºåˆ¶</a><br>å¤§è‡´é€»è¾‘ä¸ºï¼š<br>1ã€é€šçŸ¥è§‚å¯Ÿè€… RunLoop å³å°†å¯åŠ¨ã€‚<br>2ã€é€šçŸ¥è§‚å¯Ÿè€…å³å°†è¦å¤„ç†Timeräº‹ä»¶ã€‚<br>3ã€é€šçŸ¥è§‚å¯Ÿè€…å³å°†è¦å¤„ç†source0äº‹ä»¶ã€‚<br>4ã€å¤„ç†source0äº‹ä»¶ã€‚<br>5ã€å¦‚æœåŸºäºç«¯å£çš„æº(Source1)å‡†å¤‡å¥½å¹¶å¤„äºç­‰å¾…çŠ¶æ€ï¼Œè¿›å…¥æ­¥éª¤9ã€‚<br>6ã€é€šçŸ¥è§‚å¯Ÿè€…çº¿ç¨‹å³å°†è¿›å…¥ä¼‘çœ çŠ¶æ€ã€‚<br>7ã€å°†çº¿ç¨‹ç½®äºä¼‘çœ çŠ¶æ€ï¼Œç”±ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€ï¼Œç›´åˆ°ä¸‹é¢çš„ä»»ä¸€äº‹ä»¶å‘ç”Ÿæ‰å”¤é†’çº¿ç¨‹ã€‚</p><ul><li>ä¸€ä¸ªåŸºäº port çš„Source1 çš„äº‹ä»¶(å›¾é‡Œåº”è¯¥æ˜¯source0)ã€‚</li><li>ä¸€ä¸ª Timer åˆ°æ—¶é—´äº†ã€‚</li><li>RunLoop è‡ªèº«çš„è¶…æ—¶æ—¶é—´åˆ°äº†ã€‚</li><li>è¢«å…¶ä»–è°ƒç”¨è€…æ‰‹åŠ¨å”¤é†’ã€‚</li></ul><p>8ã€é€šçŸ¥è§‚å¯Ÿè€…çº¿ç¨‹å°†è¢«å”¤é†’ã€‚<br>9ã€å¤„ç†å”¤é†’æ—¶æ”¶åˆ°çš„äº‹ä»¶ã€‚</p><ul><li>å¦‚æœç”¨æˆ·å®šä¹‰çš„å®šæ—¶å™¨å¯åŠ¨ï¼Œå¤„ç†å®šæ—¶å™¨äº‹ä»¶å¹¶é‡å¯RunLoopã€‚è¿›å…¥æ­¥éª¤2ã€‚</li><li>å¦‚æœè¾“å…¥æºå¯åŠ¨ï¼Œä¼ é€’ç›¸åº”çš„æ¶ˆæ¯ã€‚</li><li>å¦‚æœRunLoopè¢«æ˜¾ç¤ºå”¤é†’è€Œä¸”æ—¶é—´è¿˜æ²¡è¶…æ—¶ï¼Œé‡å¯RunLoopã€‚è¿›å…¥æ­¥éª¤2</li></ul><p>10ã€é€šçŸ¥è§‚å¯Ÿè€…RunLoopç»“æŸã€‚</p><h2 id="äº”ã€RunLoopä¸NSTimer"><a href="#äº”ã€RunLoopä¸NSTimer" class="headerlink" title="äº”ã€RunLoopä¸NSTimer"></a>äº”ã€RunLoopä¸NSTimer</h2><p>ä¸€ä¸ªæ¯”è¾ƒå¸¸è§çš„é—®é¢˜ï¼šæ»‘åŠ¨tableViewæ—¶ï¼Œå®šæ—¶å™¨è¿˜ä¼šç”Ÿæ•ˆå—ï¼Ÿ<br>é»˜è®¤æƒ…å†µä¸‹RunLoopè¿è¡Œåœ¨<code>kCFRunLoopDefaultMode</code>ä¸‹ï¼Œè€Œå½“æ»‘åŠ¨tableViewæ—¶ï¼ŒRunLoopåˆ‡æ¢åˆ°<code>UITrackingRunLoopMode</code>ï¼Œè€ŒTimeræ˜¯åœ¨<code>kCFRunLoopDefaultMode</code>ä¸‹çš„ï¼Œå°±æ— æ³•æ¥å—å¤„ç†Timerçš„äº‹ä»¶ã€‚<br>æ€ä¹ˆå»è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼ŸæŠŠTimeræ·»åŠ åˆ°UITrackingRunLoopModeä¸Šå¹¶ä¸èƒ½è§£å†³é—®é¢˜ï¼Œå› ä¸ºè¿™æ ·åœ¨é»˜è®¤æƒ…å†µä¸‹å°±æ— æ³•æ¥å—å®šæ—¶å™¨äº‹ä»¶äº†ã€‚<br>æ‰€ä»¥æˆ‘ä»¬éœ€è¦æŠŠTimeråŒæ—¶æ·»åŠ åˆ°<code>UITrackingRunLoopMode</code>å’Œ<code>kCFRunLoopDefaultMode</code>ä¸Šã€‚<br>é‚£ä¹ˆå¦‚ä½•æŠŠtimeråŒæ—¶æ·»åŠ åˆ°å¤šä¸ªmodeä¸Šå‘¢ï¼Ÿå°±è¦ç”¨åˆ°<code>NSRunLoopCommonModes</code>äº†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[NSRunLoop currentRunLoop] addTimer:timer forMode:NSRunLoopCommonModes];</span><br></pre></td></tr></table></figure><p>Timerå°±è¢«æ·»åŠ åˆ°å¤šä¸ªmodeä¸Šï¼Œè¿™æ ·å³ä½¿RunLoopç”±<code>kCFRunLoopDefaultMode</code>åˆ‡æ¢åˆ°<code>UITrackingRunLoopMode</code>ä¸‹ï¼Œä¹Ÿä¸ä¼šå½±å“æ¥æ”¶Timeräº‹ä»¶</p><h2 id="å…­ã€RunLoopå’Œçº¿ç¨‹"><a href="#å…­ã€RunLoopå’Œçº¿ç¨‹" class="headerlink" title="å…­ã€RunLoopå’Œçº¿ç¨‹"></a>å…­ã€RunLoopå’Œçº¿ç¨‹</h2><ul><li>çº¿ç¨‹å’ŒRunLoopæ˜¯ä¸€ä¸€å¯¹åº”çš„,å…¶æ˜ å°„å…³ç³»æ˜¯ä¿å­˜åœ¨ä¸€ä¸ªå…¨å±€çš„ Dictionary é‡Œ</li><li>è‡ªå·±åˆ›å»ºçš„çº¿ç¨‹é»˜è®¤æ˜¯æ²¡æœ‰å¼€å¯RunLoopçš„</li></ul><p><strong>1ã€æ€ä¹ˆåˆ›å»ºä¸€ä¸ªå¸¸é©»çº¿ç¨‹ï¼Ÿ</strong></p><p>1ã€ä¸ºå½“å‰çº¿ç¨‹å¼€å¯ä¸€ä¸ªRunLoopï¼ˆç¬¬ä¸€æ¬¡è°ƒç”¨ [NSRunLoop currentRunLoop]æ–¹æ³•æ—¶å®é™…æ˜¯ä¼šå…ˆå»åˆ›å»ºä¸€ä¸ªRunLoopï¼‰<br>2ã€å‘å½“å‰RunLoopä¸­æ·»åŠ ä¸€ä¸ªPort/Sourceç­‰ç»´æŒRunLoopçš„äº‹ä»¶å¾ªç¯ï¼ˆå¦‚æœRunLoopçš„modeä¸­ä¸€ä¸ªiteméƒ½æ²¡æœ‰ï¼ŒRunLoopä¼šé€€å‡ºï¼‰<br>3ã€å¯åŠ¨è¯¥RunLoop</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@autoreleasepool &#123;</span><br><span class="line">      </span><br><span class="line">      NSRunLoop *runLoop &#x3D; [NSRunLoop currentRunLoop];</span><br><span class="line">      </span><br><span class="line">      [[NSRunLoop currentRunLoop] addPort:[NSMachPort port] forMode:NSDefaultRunLoopMode];</span><br><span class="line">      </span><br><span class="line">      [runLoop run];</span><br><span class="line">      </span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p><strong>2ã€è¾“å‡ºä¸‹è¾¹ä»£ç çš„æ‰§è¡Œé¡ºåº</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">NSLog(@&quot;1&quot;);</span><br><span class="line"></span><br><span class="line">dispatch_async(dispatch_get_global_queue(0, 0), ^&#123;</span><br><span class="line">    </span><br><span class="line">    NSLog(@&quot;2&quot;);</span><br><span class="line"></span><br><span class="line">    [self performSelector:@selector(test) withObject:nil afterDelay:10];</span><br><span class="line">    </span><br><span class="line">    NSLog(@&quot;3&quot;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">NSLog(@&quot;4&quot;);</span><br><span class="line"></span><br><span class="line">- (void)test</span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">    NSLog(@&quot;5&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç­”æ¡ˆæ˜¯1423ï¼Œtestæ–¹æ³•å¹¶ä¸ä¼šæ‰§è¡Œã€‚<br>åŸå› æ˜¯å¦‚æœæ˜¯å¸¦afterDelayçš„å»¶æ—¶å‡½æ•°ï¼Œä¼šåœ¨å†…éƒ¨åˆ›å»ºä¸€ä¸ª NSTimerï¼Œç„¶åæ·»åŠ åˆ°å½“å‰çº¿ç¨‹çš„RunLoopä¸­ã€‚ä¹Ÿå°±æ˜¯å¦‚æœå½“å‰çº¿ç¨‹æ²¡æœ‰å¼€å¯RunLoopï¼Œè¯¥æ–¹æ³•ä¼šå¤±æ•ˆã€‚<br>é‚£ä¹ˆæˆ‘ä»¬æ”¹æˆ:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">dispatch_async(dispatch_get_global_queue(0, 0), ^&#123;</span><br><span class="line">        </span><br><span class="line">        NSLog(@&quot;2&quot;);</span><br><span class="line">        </span><br><span class="line">        [[NSRunLoop currentRunLoop] run];</span><br><span class="line">        </span><br><span class="line">        [self performSelector:@selector(test) withObject:nil afterDelay:10];</span><br><span class="line">  </span><br><span class="line">        NSLog(@&quot;3&quot;);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure><p>ç„¶è€Œtestæ–¹æ³•ä¾ç„¶ä¸æ‰§è¡Œã€‚<br>åŸå› æ˜¯å¦‚æœRunLoopçš„modeä¸­ä¸€ä¸ªiteméƒ½æ²¡æœ‰ï¼ŒRunLoopä¼šé€€å‡ºã€‚å³åœ¨è°ƒç”¨RunLoopçš„runæ–¹æ³•åï¼Œç”±äºå…¶modeä¸­æ²¡æœ‰æ·»åŠ ä»»ä½•itemå»ç»´æŒRunLoopçš„æ—¶é—´å¾ªç¯ï¼ŒRunLoopéšå³è¿˜æ˜¯ä¼šé€€å‡ºã€‚<br>æ‰€ä»¥æˆ‘ä»¬è‡ªå·±å¯åŠ¨RunLoopï¼Œä¸€å®šè¦åœ¨æ·»åŠ itemå</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">dispatch_async(dispatch_get_global_queue(0, 0), ^&#123;</span><br><span class="line">        </span><br><span class="line">        NSLog(@&quot;2&quot;);</span><br><span class="line">        </span><br><span class="line">        [self performSelector:@selector(test) withObject:nil afterDelay:10];</span><br><span class="line">        </span><br><span class="line">        [[NSRunLoop currentRunLoop] run];</span><br><span class="line">  </span><br><span class="line">        NSLog(@&quot;3&quot;);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure><p><strong>3ã€æ€æ ·ä¿è¯å­çº¿ç¨‹æ•°æ®å›æ¥æ›´æ–°UIçš„æ—¶å€™ä¸æ‰“æ–­ç”¨æˆ·çš„æ»‘åŠ¨æ“ä½œï¼Ÿ</strong></p><p>å½“æˆ‘ä»¬åœ¨å­è¯·æ±‚æ•°æ®çš„åŒæ—¶æ»‘åŠ¨æµè§ˆå½“å‰é¡µé¢ï¼Œå¦‚æœæ•°æ®è¯·æ±‚æˆåŠŸè¦åˆ‡å›ä¸»çº¿ç¨‹æ›´æ–°UIï¼Œé‚£ä¹ˆå°±ä¼šå½±å“å½“å‰æ­£åœ¨æ»‘åŠ¨çš„ä½“éªŒã€‚<br>æˆ‘ä»¬å°±å¯ä»¥å°†æ›´æ–°UIäº‹ä»¶æ”¾åœ¨ä¸»çº¿ç¨‹çš„<code>NSDefaultRunLoopMode</code>ä¸Šæ‰§è¡Œå³å¯ï¼Œè¿™æ ·å°±ä¼šç­‰ç”¨æˆ·ä¸å†æ»‘åŠ¨é¡µé¢ï¼Œä¸»çº¿ç¨‹RunLoopç”±<code>UITrackingRunLoopMode</code>åˆ‡æ¢åˆ°<code>NSDefaultRunLoopMode</code>æ—¶å†å»æ›´æ–°UI</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[self performSelectorOnMainThread:@selector(reloadData) withObject:nil waitUntilDone:NO modes:@[NSDefaultRunLoopMode]];</span><br></pre></td></tr></table></figure><h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><h4 id="1-å¦‚ä½•ä½¿ç”¨-Runloop-å®ç°ä¸€ä¸ªå¸¸é©»çº¿ç¨‹ï¼Ÿè¿™ç§çº¿ç¨‹ä¸€èˆ¬æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ"><a href="#1-å¦‚ä½•ä½¿ç”¨-Runloop-å®ç°ä¸€ä¸ªå¸¸é©»çº¿ç¨‹ï¼Ÿè¿™ç§çº¿ç¨‹ä¸€èˆ¬æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ" class="headerlink" title="1. å¦‚ä½•ä½¿ç”¨ Runloop å®ç°ä¸€ä¸ªå¸¸é©»çº¿ç¨‹ï¼Ÿè¿™ç§çº¿ç¨‹ä¸€èˆ¬æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ"></a>1. å¦‚ä½•ä½¿ç”¨ <code>Runloop</code> å®ç°ä¸€ä¸ªå¸¸é©»çº¿ç¨‹ï¼Ÿè¿™ç§çº¿ç¨‹ä¸€èˆ¬æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</h4><p>ä¸€èˆ¬åšæ³•æ˜¯å‘ <code>Runloop</code> ä¸­æ”¾ä¸€ä¸ª <code>port</code>ã€‚<br><br>åˆ›å»ºä¸€æ¡å¸¸é©»çš„åå°çº¿ç¨‹ï¼Œåšä»»ä½•ä½ æƒ³åšçš„äº‹ã€‚</p><h4 id="2-ä¸ºä»€ä¹ˆ-NSTimer-æœ‰æ—¶å€™ä¸å¥½ä½¿ï¼Ÿ"><a href="#2-ä¸ºä»€ä¹ˆ-NSTimer-æœ‰æ—¶å€™ä¸å¥½ä½¿ï¼Ÿ" class="headerlink" title="2. ä¸ºä»€ä¹ˆ NSTimer æœ‰æ—¶å€™ä¸å¥½ä½¿ï¼Ÿ"></a>2. ä¸ºä»€ä¹ˆ <code>NSTimer</code> æœ‰æ—¶å€™ä¸å¥½ä½¿ï¼Ÿ</h4><p>å› ä¸ºåˆ›å»ºçš„  <code>NSTimer</code> é»˜è®¤æ˜¯è¢«åŠ å…¥åˆ°äº† <code>defaultMode</code>ï¼Œæ‰€ä»¥å½“ <code>Runloop</code> çš„ <code>Mode</code> å˜åŒ–æ—¶ï¼Œå½“å‰çš„ <code>NSTimer</code> å°±ä¸ä¼šå·¥ä½œäº†ã€‚</p><h4 id="3-autoreleasePool-åœ¨ä½•æ—¶è¢«é‡Šæ”¾ï¼Ÿ"><a href="#3-autoreleasePool-åœ¨ä½•æ—¶è¢«é‡Šæ”¾ï¼Ÿ" class="headerlink" title="3. autoreleasePool åœ¨ä½•æ—¶è¢«é‡Šæ”¾ï¼Ÿ"></a>3. <code>autoreleasePool</code> åœ¨ä½•æ—¶è¢«é‡Šæ”¾ï¼Ÿ</h4><p><code>App</code>å¯åŠ¨åï¼Œè‹¹æœåœ¨ä¸»çº¿ç¨‹ <code>RunLoop</code> é‡Œæ³¨å†Œäº†ä¸¤ä¸ª <code>Observer</code>ï¼Œå…¶å›è°ƒéƒ½æ˜¯ <code>_wrapRunLoopWithAutoreleasePoolHandler()</code>ã€‚</p><p>ç¬¬ä¸€ä¸ª <code>Observer</code> ç›‘è§†çš„äº‹ä»¶æ˜¯ <code>Entry(å³å°†è¿›å…¥Loop)</code>ï¼Œå…¶å›è°ƒå†…ä¼šè°ƒç”¨ <code>_objc_autoreleasePoolPush()</code> åˆ›å»ºè‡ªåŠ¨é‡Šæ”¾æ± ã€‚å…¶ <code>order</code> æ˜¯ <code>-2147483647</code>ï¼Œä¼˜å…ˆçº§æœ€é«˜ï¼Œä¿è¯åˆ›å»ºé‡Šæ”¾æ± å‘ç”Ÿåœ¨å…¶ä»–æ‰€æœ‰å›è°ƒä¹‹å‰ã€‚</p><p>ç¬¬äºŒä¸ª <code>Observer</code> ç›‘è§†äº†ä¸¤ä¸ªäº‹ä»¶ï¼š <code>BeforeWaiting</code>(å‡†å¤‡è¿›å…¥ä¼‘çœ ) æ—¶è°ƒç”¨<code>_objc_autoreleasePoolPop()</code>  å’Œ <code>_objc_autoreleasePoolPush()</code> é‡Šæ”¾æ—§çš„æ± å¹¶åˆ›å»ºæ–°æ± ï¼›<code>Exit</code>(å³å°†é€€å‡ºLoop) æ—¶è°ƒç”¨ <code>_objc_autoreleasePoolPop()</code> æ¥é‡Šæ”¾è‡ªåŠ¨é‡Šæ”¾æ± ã€‚è¿™ä¸ª <code>Observer</code> çš„ <code>order</code> æ˜¯ <code>2147483647</code>ï¼Œä¼˜å…ˆçº§æœ€ä½ï¼Œä¿è¯å…¶é‡Šæ”¾æ± å­å‘ç”Ÿåœ¨å…¶ä»–æ‰€æœ‰å›è°ƒä¹‹åã€‚</p><p>åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œçš„ä»£ç ï¼Œé€šå¸¸æ˜¯å†™åœ¨è¯¸å¦‚äº‹ä»¶å›è°ƒã€<code>Timer</code>å›è°ƒå†…çš„ã€‚è¿™äº›å›è°ƒä¼šè¢« <code>RunLoop</code> åˆ›å»ºå¥½çš„ <code>AutoreleasePool</code> ç¯ç»•ç€ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°å†…å­˜æ³„æ¼ï¼Œå¼€å‘è€…ä¹Ÿä¸å¿…æ˜¾ç¤ºåˆ›å»º <code>Pool</code> äº†ã€‚</p><h4 id="4-PerformSelector-çš„å®ç°åŸç†ï¼Ÿ"><a href="#4-PerformSelector-çš„å®ç°åŸç†ï¼Ÿ" class="headerlink" title="4. PerformSelector çš„å®ç°åŸç†ï¼Ÿ"></a>4. <code>PerformSelector</code> çš„å®ç°åŸç†ï¼Ÿ</h4><p>å½“è°ƒç”¨ NSObject çš„ performSelecter:afterDelay: åï¼Œå®é™…ä¸Šå…¶å†…éƒ¨ä¼šåˆ›å»ºä¸€ä¸ª Timer å¹¶æ·»åŠ åˆ°å½“å‰çº¿ç¨‹çš„ RunLoop ä¸­ã€‚æ‰€ä»¥å¦‚æœå½“å‰çº¿ç¨‹æ²¡æœ‰ RunLoopï¼Œåˆ™è¿™ä¸ªæ–¹æ³•ä¼šå¤±æ•ˆã€‚</p><p>å½“è°ƒç”¨ performSelector:onThread: æ—¶ï¼Œå®é™…ä¸Šå…¶ä¼šåˆ›å»ºä¸€ä¸ª Timer åŠ åˆ°å¯¹åº”çš„çº¿ç¨‹å»ï¼ŒåŒæ ·çš„ï¼Œå¦‚æœå¯¹åº”çº¿ç¨‹æ²¡æœ‰ RunLoop è¯¥æ–¹æ³•ä¹Ÿä¼šå¤±æ•ˆã€‚</p><h4 id="5-PerformSelector-afterDelay-è¿™ä¸ªæ–¹æ³•åœ¨å­çº¿ç¨‹ä¸­æ˜¯å¦èµ·ä½œç”¨ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿæ€ä¹ˆè§£å†³ï¼Ÿ"><a href="#5-PerformSelector-afterDelay-è¿™ä¸ªæ–¹æ³•åœ¨å­çº¿ç¨‹ä¸­æ˜¯å¦èµ·ä½œç”¨ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿæ€ä¹ˆè§£å†³ï¼Ÿ" class="headerlink" title="5. PerformSelector:afterDelay:è¿™ä¸ªæ–¹æ³•åœ¨å­çº¿ç¨‹ä¸­æ˜¯å¦èµ·ä½œç”¨ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿæ€ä¹ˆè§£å†³ï¼Ÿ"></a>5. <code>PerformSelector:afterDelay:</code>è¿™ä¸ªæ–¹æ³•åœ¨å­çº¿ç¨‹ä¸­æ˜¯å¦èµ·ä½œç”¨ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿæ€ä¹ˆè§£å†³ï¼Ÿ</h4><p>ä¸èµ·ä½œç”¨ï¼Œå­çº¿ç¨‹é»˜è®¤æ²¡æœ‰ <code>Runloop</code>ï¼Œä¹Ÿå°±æ²¡æœ‰ <code>Timer</code>ã€‚<br><br>è§£å†³çš„åŠæ³•æ˜¯å¯ä»¥ä½¿ç”¨ <code>GCD</code> æ¥å®ç°ï¼š<code>Dispatch_after</code></p><h4 id="6-è®²ä¸€ä¸‹-Observer-ï¼Ÿ"><a href="#6-è®²ä¸€ä¸‹-Observer-ï¼Ÿ" class="headerlink" title="6. è®²ä¸€ä¸‹ Observer ï¼Ÿ"></a>6. è®²ä¸€ä¸‹ <code>Observer</code> ï¼Ÿ</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="built_in">CF_OPTIONS</span>(<span class="built_in">CFOptionFlags</span>, <span class="built_in">CFRunLoopActivity</span>) &#123;</span><br><span class="line">    kCFRunLoopEntry         = (<span class="number">1</span>UL &lt;&lt; <span class="number">0</span>), <span class="comment">// å³å°†è¿›å…¥Loop</span></span><br><span class="line">    kCFRunLoopBeforeTimers  = (<span class="number">1</span>UL &lt;&lt; <span class="number">1</span>), <span class="comment">// å³å°†å¤„ç† Timer</span></span><br><span class="line">    kCFRunLoopBeforeSources = (<span class="number">1</span>UL &lt;&lt; <span class="number">2</span>), <span class="comment">// å³å°†å¤„ç† Source</span></span><br><span class="line">    kCFRunLoopBeforeWaiting = (<span class="number">1</span>UL &lt;&lt; <span class="number">5</span>), <span class="comment">// å³å°†è¿›å…¥ä¼‘çœ </span></span><br><span class="line">    kCFRunLoopAfterWaiting  = (<span class="number">1</span>UL &lt;&lt; <span class="number">6</span>), <span class="comment">// åˆšä»ä¼‘çœ ä¸­å”¤é†’</span></span><br><span class="line">    kCFRunLoopExit          = (<span class="number">1</span>UL &lt;&lt; <span class="number">7</span>), <span class="comment">// å³å°†é€€å‡ºLoop</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="7-è§£é‡Šä¸€ä¸‹-äº‹ä»¶å“åº”-çš„è¿‡ç¨‹ï¼Ÿ"><a href="#7-è§£é‡Šä¸€ä¸‹-äº‹ä»¶å“åº”-çš„è¿‡ç¨‹ï¼Ÿ" class="headerlink" title="7. è§£é‡Šä¸€ä¸‹ äº‹ä»¶å“åº” çš„è¿‡ç¨‹ï¼Ÿ"></a>7. è§£é‡Šä¸€ä¸‹ <code>äº‹ä»¶å“åº”</code> çš„è¿‡ç¨‹ï¼Ÿ</h4><p>è‹¹æœæ³¨å†Œäº†ä¸€ä¸ª <code>Source1</code> (åŸºäº <code>mach port</code> çš„) ç”¨æ¥æ¥æ”¶ç³»ç»Ÿäº‹ä»¶ï¼Œå…¶å›è°ƒå‡½æ•°ä¸º <code>__IOHIDEventSystemClientQueueCallback()</code>ã€‚</p><p>å½“ä¸€ä¸ªç¡¬ä»¶äº‹ä»¶(è§¦æ‘¸/é”å±/æ‘‡æ™ƒç­‰)å‘ç”Ÿåï¼Œé¦–å…ˆç”± <code>IOKit.framework</code> ç”Ÿæˆä¸€ä¸ª <code>IOHIDEvent</code> äº‹ä»¶å¹¶ç”± <code>SpringBoard</code> æ¥æ”¶ã€‚è¿™ä¸ªè¿‡ç¨‹çš„è¯¦ç»†æƒ…å†µå¯ä»¥å‚è€ƒè¿™é‡Œã€‚<code>SpringBoard</code> åªæ¥æ”¶æŒ‰é”®(é”å±/é™éŸ³ç­‰)ï¼Œè§¦æ‘¸ï¼ŒåŠ é€Ÿï¼Œæ¥è¿‘ä¼ æ„Ÿå™¨ç­‰å‡ ç§ <code>Event</code>ï¼Œéšåç”¨ <code>mach port</code> è½¬å‘ç»™éœ€è¦çš„ <code>App</code> è¿›ç¨‹ã€‚éšåè‹¹æœæ³¨å†Œçš„é‚£ä¸ª <code>Source1</code> å°±ä¼šè§¦å‘å›è°ƒï¼Œå¹¶è°ƒç”¨ <code>_UIApplicationHandleEventQueue()</code> è¿›è¡Œåº”ç”¨å†…éƒ¨çš„åˆ†å‘ã€‚</p><p><code>_UIApplicationHandleEventQueue()</code> ä¼šæŠŠ <code>IOHIDEvent</code> å¤„ç†å¹¶åŒ…è£…æˆ <code>UIEvent</code> è¿›è¡Œå¤„ç†æˆ–åˆ†å‘ï¼Œå…¶ä¸­åŒ…æ‹¬è¯†åˆ« <code>UIGesture</code>/å¤„ç†å±å¹•æ—‹è½¬/å‘é€ç»™ <code>UIWindow</code> ç­‰ã€‚é€šå¸¸äº‹ä»¶æ¯”å¦‚ <code>UIButton ç‚¹å‡»</code>ã€<code>touchesBegin/Move/End/Cancel</code> äº‹ä»¶éƒ½æ˜¯åœ¨è¿™ä¸ªå›è°ƒä¸­å®Œæˆçš„ã€‚</p><h4 id="8-è§£é‡Šä¸€ä¸‹-æ‰‹åŠ¿è¯†åˆ«-çš„è¿‡ç¨‹ï¼Ÿ"><a href="#8-è§£é‡Šä¸€ä¸‹-æ‰‹åŠ¿è¯†åˆ«-çš„è¿‡ç¨‹ï¼Ÿ" class="headerlink" title="8. è§£é‡Šä¸€ä¸‹ æ‰‹åŠ¿è¯†åˆ« çš„è¿‡ç¨‹ï¼Ÿ"></a>8. è§£é‡Šä¸€ä¸‹ <code>æ‰‹åŠ¿è¯†åˆ«</code> çš„è¿‡ç¨‹ï¼Ÿ</h4><p>å½“ä¸Šé¢çš„ <code>_UIApplicationHandleEventQueue()</code>è¯†åˆ«äº†ä¸€ä¸ªæ‰‹åŠ¿æ—¶ï¼Œå…¶é¦–å…ˆä¼šè°ƒç”¨ <code>Cancel</code> å°†å½“å‰çš„ <code>touchesBegin/Move/End</code> ç³»åˆ—å›è°ƒæ‰“æ–­ã€‚éšåç³»ç»Ÿå°†å¯¹åº”çš„ <code>UIGestureRecognizer</code> æ ‡è®°ä¸ºå¾…å¤„ç†ã€‚</p><p>è‹¹æœæ³¨å†Œäº†ä¸€ä¸ª <code>Observer</code> ç›‘æµ‹ <code>BeforeWaiting</code> (Loopå³å°†è¿›å…¥ä¼‘çœ ) äº‹ä»¶ï¼Œè¿™ä¸ª <code>Observer</code> çš„å›è°ƒå‡½æ•°æ˜¯ <code>_UIGestureRecognizerUpdateObserver()</code>ï¼Œå…¶å†…éƒ¨ä¼šè·å–æ‰€æœ‰åˆšè¢«æ ‡è®°ä¸ºå¾…å¤„ç†çš„ <code>GestureRecognizer</code>ï¼Œå¹¶æ‰§è¡Œ<code>GestureRecognizer</code> çš„å›è°ƒã€‚</p><p>å½“æœ‰ <code>UIGestureRecognizer</code> çš„å˜åŒ–(åˆ›å»º/é”€æ¯/çŠ¶æ€æ”¹å˜)æ—¶ï¼Œè¿™ä¸ªå›è°ƒéƒ½ä¼šè¿›è¡Œç›¸åº”å¤„ç†ã€‚</p><h4 id="9-è§£é‡Šä¸€ä¸‹-GCD-åœ¨-Runloop-ä¸­çš„ä½¿ç”¨ï¼Ÿ"><a href="#9-è§£é‡Šä¸€ä¸‹-GCD-åœ¨-Runloop-ä¸­çš„ä½¿ç”¨ï¼Ÿ" class="headerlink" title="9. è§£é‡Šä¸€ä¸‹ GCD åœ¨ Runloop ä¸­çš„ä½¿ç”¨ï¼Ÿ"></a>9. è§£é‡Šä¸€ä¸‹ <code>GCD</code> åœ¨ <code>Runloop</code> ä¸­çš„ä½¿ç”¨ï¼Ÿ</h4><p><code>GCD</code>ç”± å­çº¿ç¨‹ è¿”å›åˆ° ä¸»çº¿ç¨‹,åªæœ‰åœ¨è¿™ç§æƒ…å†µä¸‹æ‰ä¼šè§¦å‘ RunLoopã€‚ä¼šè§¦å‘ RunLoop çš„ Source 1 äº‹ä»¶ã€‚</p><h4 id="10-è§£é‡Šä¸€ä¸‹-NSTimerã€‚"><a href="#10-è§£é‡Šä¸€ä¸‹-NSTimerã€‚" class="headerlink" title="10. è§£é‡Šä¸€ä¸‹ NSTimerã€‚"></a>10. è§£é‡Šä¸€ä¸‹ <code>NSTimer</code>ã€‚</h4><p><code>NSTimer</code> å…¶å®å°±æ˜¯ <code>CFRunLoopTimerRef</code>ï¼Œä»–ä»¬ä¹‹é—´æ˜¯ <code>toll-free bridged</code> çš„ã€‚ä¸€ä¸ª <code>NSTimer</code> æ³¨å†Œåˆ° <code>RunLoop</code> åï¼Œ<code>RunLoop</code> ä¼šä¸ºå…¶é‡å¤çš„æ—¶é—´ç‚¹æ³¨å†Œå¥½äº‹ä»¶ã€‚ä¾‹å¦‚ <code>10:00</code>, <code>10:10</code>, <code>10:20</code> è¿™å‡ ä¸ªæ—¶é—´ç‚¹ã€‚<code>RunLoop</code> ä¸ºäº†èŠ‚çœèµ„æºï¼Œå¹¶ä¸ä¼šåœ¨éå¸¸å‡†ç¡®çš„æ—¶é—´ç‚¹å›è°ƒè¿™ä¸ª<code>Timer</code>ã€‚<code>Timer</code> æœ‰ä¸ªå±æ€§å«åš <code>Tolerance</code> (å®½å®¹åº¦)ï¼Œæ ‡ç¤ºäº†å½“æ—¶é—´ç‚¹åˆ°åï¼Œå®¹è®¸æœ‰å¤šå°‘æœ€å¤§è¯¯å·®ã€‚</p><p>å¦‚æœæŸä¸ªæ—¶é—´ç‚¹è¢«é”™è¿‡äº†ï¼Œä¾‹å¦‚æ‰§è¡Œäº†ä¸€ä¸ªå¾ˆé•¿çš„ä»»åŠ¡ï¼Œåˆ™é‚£ä¸ªæ—¶é—´ç‚¹çš„å›è°ƒä¹Ÿä¼šè·³è¿‡å»ï¼Œä¸ä¼šå»¶åæ‰§è¡Œã€‚å°±æ¯”å¦‚ç­‰å…¬äº¤ï¼Œå¦‚æœ 10:10 æ—¶æˆ‘å¿™ç€ç©æ‰‹æœºé”™è¿‡äº†é‚£ä¸ªç‚¹çš„å…¬äº¤ï¼Œé‚£æˆ‘åªèƒ½ç­‰ 10:20 è¿™ä¸€è¶Ÿäº†ã€‚</p><p><code>CADisplayLink</code> æ˜¯ä¸€ä¸ªå’Œå±å¹•åˆ·æ–°ç‡ä¸€è‡´çš„å®šæ—¶å™¨ï¼ˆä½†å®é™…å®ç°åŸç†æ›´å¤æ‚ï¼Œå’Œ NSTimer å¹¶ä¸ä¸€æ ·ï¼Œå…¶å†…éƒ¨å®é™…æ˜¯æ“ä½œäº†ä¸€ä¸ª <code>Source</code>ï¼‰ã€‚å¦‚æœåœ¨ä¸¤æ¬¡å±å¹•åˆ·æ–°ä¹‹é—´æ‰§è¡Œäº†ä¸€ä¸ªé•¿ä»»åŠ¡ï¼Œé‚£å…¶ä¸­å°±ä¼šæœ‰ä¸€å¸§è¢«è·³è¿‡å»ï¼ˆå’Œ <code>NSTimer</code> ç›¸ä¼¼ï¼‰ï¼Œé€ æˆç•Œé¢å¡é¡¿çš„æ„Ÿè§‰ã€‚åœ¨å¿«é€Ÿæ»‘åŠ¨ <code>TableView</code> æ—¶ï¼Œå³ä½¿ä¸€å¸§çš„å¡é¡¿ä¹Ÿä¼šè®©ç”¨æˆ·æœ‰æ‰€å¯Ÿè§‰ã€‚<code>Facebook</code> å¼€æºçš„ <code>AsyncDisplayLink</code> å°±æ˜¯ä¸ºäº†è§£å†³ç•Œé¢å¡é¡¿çš„é—®é¢˜ï¼Œå…¶å†…éƒ¨ä¹Ÿç”¨åˆ°äº† <code>RunLoop</code>ã€‚</p><h4 id="11-åˆ©ç”¨-runloop-è§£é‡Šä¸€ä¸‹é¡µé¢çš„æ¸²æŸ“çš„è¿‡ç¨‹ï¼Ÿ"><a href="#11-åˆ©ç”¨-runloop-è§£é‡Šä¸€ä¸‹é¡µé¢çš„æ¸²æŸ“çš„è¿‡ç¨‹ï¼Ÿ" class="headerlink" title="11. åˆ©ç”¨ runloop è§£é‡Šä¸€ä¸‹é¡µé¢çš„æ¸²æŸ“çš„è¿‡ç¨‹ï¼Ÿ"></a>11. åˆ©ç”¨ <code>runloop</code> è§£é‡Šä¸€ä¸‹é¡µé¢çš„æ¸²æŸ“çš„è¿‡ç¨‹ï¼Ÿ</h4><p>å½“æˆ‘ä»¬è°ƒç”¨ <code>[UIView setNeedsDisplay]</code> æ—¶ï¼Œè¿™æ—¶ä¼šè°ƒç”¨å½“å‰ <code>View.layer</code> çš„ <code>[view.layer setNeedsDisplay]</code>æ–¹æ³•ã€‚</p><p>è¿™ç­‰äºç»™å½“å‰çš„ <code>layer</code> æ‰“ä¸Šäº†ä¸€ä¸ªè„æ ‡è®°ï¼Œè€Œæ­¤æ—¶å¹¶æ²¡æœ‰ç›´æ¥è¿›è¡Œç»˜åˆ¶å·¥ä½œã€‚è€Œæ˜¯ä¼šåˆ°å½“å‰çš„ <code>Runloop</code> å³å°†ä¼‘çœ ï¼Œä¹Ÿå°±æ˜¯ <code>beforeWaiting</code> æ—¶æ‰ä¼šè¿›è¡Œç»˜åˆ¶å·¥ä½œã€‚</p><p>ç´§æ¥ç€ä¼šè°ƒç”¨ <code>[CALayer display]</code>ï¼Œè¿›å…¥åˆ°çœŸæ­£ç»˜åˆ¶çš„å·¥ä½œã€‚<code>CALayer</code> å±‚ä¼šåˆ¤æ–­è‡ªå·±çš„ <code>delegate</code> æœ‰æ²¡æœ‰å®ç°å¼‚æ­¥ç»˜åˆ¶çš„ä»£ç†æ–¹æ³• <code>displayer:</code>ï¼Œè¿™ä¸ªä»£ç†æ–¹æ³•æ˜¯å¼‚æ­¥ç»˜åˆ¶çš„å…¥å£ï¼Œå¦‚æœæ²¡æœ‰å®ç°è¿™ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆä¼šç»§ç»­è¿›è¡Œç³»ç»Ÿç»˜åˆ¶çš„æµç¨‹ï¼Œç„¶åç»˜åˆ¶ç»“æŸã€‚</p><p><code>CALayer</code> å†…éƒ¨ä¼šåˆ›å»ºä¸€ä¸ª <code>Backing Store</code>ï¼Œç”¨æ¥è·å–å›¾å½¢ä¸Šä¸‹æ–‡ã€‚æ¥ä¸‹æ¥ä¼šåˆ¤æ–­è¿™ä¸ª <code>layer</code> æ˜¯å¦æœ‰ delegateã€‚</p><p>å¦‚æœæœ‰çš„è¯ï¼Œä¼šè°ƒç”¨ <code>[layer.delegate drawLayer:inContext:]</code>ï¼Œå¹¶ä¸”ä¼šè¿”å›ç»™æˆ‘ä»¬ <code>[UIView DrawRect:]</code> çš„å›è°ƒï¼Œè®©æˆ‘ä»¬åœ¨ç³»ç»Ÿç»˜åˆ¶çš„åŸºç¡€ä¹‹ä¸Šå†åšä¸€äº›äº‹æƒ…ã€‚</p><p>å¦‚æœæ²¡æœ‰ <code>delegate</code>ï¼Œé‚£ä¹ˆä¼šè°ƒç”¨ <code>[CALayer drawInContext:]</code>ã€‚</p><p>ä»¥ä¸Šä¸¤ä¸ªåˆ†æ”¯ï¼Œæœ€ç»ˆ <code>CALayer</code> éƒ½ä¼šå°†ä½å›¾æäº¤åˆ° <code>Backing Store</code>ï¼Œæœ€åæäº¤ç»™ <code>GPU</code>ã€‚</p><p>è‡³æ­¤ç»˜åˆ¶çš„è¿‡ç¨‹ç»“æŸã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åº•å±‚åŸç† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> runloop </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iOSåº•å±‚-Block</title>
      <link href="/2020/01/16/iOS%E5%BA%95%E5%B1%82-Block/"/>
      <url>/2020/01/16/iOS%E5%BA%95%E5%B1%82-Block/</url>
      
        <content type="html"><![CDATA[<h3 id="Blockçš„å®è´¨"><a href="#Blockçš„å®è´¨" class="headerlink" title="Blockçš„å®è´¨"></a>Blockçš„å®è´¨</h3><p>æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªOCå¯¹è±¡ï¼Œä»–å†…éƒ¨ä¹Ÿæœ‰ä¸€ä¸ªisaæŒ‡é’ˆã€‚Blockæ˜¯å°è£…äº†å‡½æ•°è°ƒç”¨ä»¥åŠå‡½æ•°è°ƒç”¨ç¯å¢ƒçš„OCå¯¹è±¡ã€‚</p><h3 id="Blockä¸‰ç§ç±»å‹"><a href="#Blockä¸‰ç§ç±»å‹" class="headerlink" title="Blockä¸‰ç§ç±»å‹"></a>Blockä¸‰ç§ç±»å‹</h3><table><thead><tr><th>ç±»å‹</th><th>å­˜å‚¨åŒºåŸŸ</th></tr></thead><tbody><tr><td>GlobalBlock</td><td>æ•°æ®åŒº</td></tr><tr><td>StackBlock</td><td>æ ˆåŒº</td></tr><tr><td>MallocBlock</td><td>å †åŒº</td></tr></tbody></table><h3 id="Blocké¿å…å¾ªç¯å¼•ç”¨çš„ä¸‰ç§æ–¹å¼"><a href="#Blocké¿å…å¾ªç¯å¼•ç”¨çš„ä¸‰ç§æ–¹å¼" class="headerlink" title="Blocké¿å…å¾ªç¯å¼•ç”¨çš„ä¸‰ç§æ–¹å¼"></a>Blocké¿å…å¾ªç¯å¼•ç”¨çš„ä¸‰ç§æ–¹å¼</h3><p>1ã€åˆ©ç”¨ <code>__weak</code>å’Œ<code>__strong</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> __weak typeof(self) weakSelf &#x3D; self;</span><br><span class="line">self.block &#x3D; ^&#123;</span><br><span class="line">    __strong typeof(self) strongSelf &#x3D; weakSelf;</span><br><span class="line">    NSLog(@&quot;%@&quot;, NSStringFromCGRect(strongSelf.view.frame));</span><br><span class="line">&#125;;</span><br><span class="line">self.block();</span><br></pre></td></tr></table></figure><p>2ã€åˆ©ç”¨é€ æˆå¾ªç¯å¼•ç”¨çš„ä¸´æ—¶å˜é‡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">__block ViewController *vc &#x3D; self;</span><br><span class="line">self.block &#x3D; ^&#123;</span><br><span class="line">    NSLog(@&quot;%@&quot;, NSStringFromCGRect(vc.view.frame));</span><br><span class="line">    vc &#x3D; nil;</span><br><span class="line">&#125;;</span><br><span class="line">self.block();</span><br></pre></td></tr></table></figure><p>3ã€ç›´æ¥å£°æ˜Blockä¸­æ·»åŠ é€ æˆå¾ªç¯å¼•ç”¨çš„å‚æ•°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">typedef void(^Block)(UIViewController *vc);</span><br><span class="line"></span><br><span class="line">self.block &#x3D; ^(UIViewController *vc)&#123;</span><br><span class="line">    NSLog(@&quot;%@&quot;, NSStringFromCGRect(vc.view.frame));</span><br><span class="line">&#125;;</span><br><span class="line">self.block(self);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åº•å±‚åŸç† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Block </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iOSå¤šçº¿ç¨‹-GCD</title>
      <link href="/2020/01/16/iOS%E5%A4%9A%E7%BA%BF%E7%A8%8B-GCD/"/>
      <url>/2020/01/16/iOS%E5%A4%9A%E7%BA%BF%E7%A8%8B-GCD/</url>
      
        <content type="html"><![CDATA[<h2 id="ä»»åŠ¡"><a href="#ä»»åŠ¡" class="headerlink" title="ä»»åŠ¡"></a>ä»»åŠ¡</h2><p>å°±æ˜¯æ‰§è¡Œæ“ä½œçš„æ„æ€ï¼Œæ¢å¥è¯è¯´å°±æ˜¯ä½ åœ¨çº¿ç¨‹ä¸­æ‰§è¡Œçš„é‚£æ®µä»£ç ã€‚åœ¨ GCD ä¸­æ˜¯æ”¾åœ¨ block ä¸­çš„ã€‚æ‰§è¡Œä»»åŠ¡æœ‰ä¸¤ç§æ–¹å¼ï¼šåŒæ­¥æ‰§è¡Œï¼ˆsyncï¼‰å’Œå¼‚æ­¥æ‰§è¡Œï¼ˆasyncï¼‰ã€‚<br>ä¸¤è€…çš„ä¸»è¦åŒºåˆ«æ˜¯ï¼šæ˜¯å¦ç­‰å¾…é˜Ÿåˆ—çš„ä»»åŠ¡æ‰§è¡Œç»“æŸï¼Œä»¥åŠæ˜¯å¦å…·å¤‡å¼€å¯æ–°çº¿ç¨‹çš„èƒ½åŠ›ã€‚</p><h3 id="åŒæ­¥æ‰§è¡Œï¼ˆsyncï¼‰"><a href="#åŒæ­¥æ‰§è¡Œï¼ˆsyncï¼‰" class="headerlink" title="åŒæ­¥æ‰§è¡Œï¼ˆsyncï¼‰"></a>åŒæ­¥æ‰§è¡Œï¼ˆsyncï¼‰</h3><p>åŒæ­¥æ·»åŠ ä»»åŠ¡åˆ°æŒ‡å®šçš„é˜Ÿåˆ—ä¸­ï¼Œåœ¨æ·»åŠ çš„ä»»åŠ¡æ‰§è¡Œç»“æŸä¹‹å‰ï¼Œä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°é˜Ÿåˆ—é‡Œé¢çš„ä»»åŠ¡å®Œæˆä¹‹åå†ç»§ç»­æ‰§è¡Œã€‚<br><br>åªèƒ½åœ¨å½“å‰çº¿ç¨‹ä¸­æ‰§è¡Œä»»åŠ¡ï¼Œä¸å…·å¤‡å¼€å¯æ–°çº¿ç¨‹çš„èƒ½åŠ›ã€‚</p><h3 id="å¼‚æ­¥æ‰§è¡Œï¼ˆasyncï¼‰"><a href="#å¼‚æ­¥æ‰§è¡Œï¼ˆasyncï¼‰" class="headerlink" title="å¼‚æ­¥æ‰§è¡Œï¼ˆasyncï¼‰"></a>å¼‚æ­¥æ‰§è¡Œï¼ˆasyncï¼‰</h3><p>å¼‚æ­¥æ·»åŠ ä»»åŠ¡åˆ°æŒ‡å®šçš„é˜Ÿåˆ—ä¸­ï¼Œå®ƒä¸ä¼šåšä»»ä½•ç­‰å¾…ï¼Œå¯ä»¥ç»§ç»­æ‰§è¡Œä»»åŠ¡ã€‚<br><br>å¯ä»¥åœ¨æ–°çš„çº¿ç¨‹ä¸­æ‰§è¡Œä»»åŠ¡ï¼Œå…·å¤‡å¼€å¯æ–°çº¿ç¨‹çš„èƒ½åŠ›ã€‚</p><h2 id="é˜Ÿåˆ—"><a href="#é˜Ÿåˆ—" class="headerlink" title="é˜Ÿåˆ—"></a>é˜Ÿåˆ—</h2><p>æ‰§è¡Œä»»åŠ¡çš„ç­‰å¾…é˜Ÿåˆ—ï¼Œå³ç”¨æ¥å­˜æ”¾ä»»åŠ¡çš„é˜Ÿåˆ—ã€‚é˜Ÿåˆ—æ˜¯ä¸€ç§ç‰¹æ®Šçš„çº¿æ€§è¡¨ï¼Œé‡‡ç”¨ FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰çš„åŸåˆ™ï¼Œå³æ–°ä»»åŠ¡æ€»æ˜¯è¢«æ’å…¥åˆ°é˜Ÿåˆ—çš„æœ«å°¾ï¼Œè€Œè¯»å–ä»»åŠ¡çš„æ—¶å€™æ€»æ˜¯ä»é˜Ÿåˆ—çš„å¤´éƒ¨å¼€å§‹è¯»å–ã€‚æ¯è¯»å–ä¸€ä¸ªä»»åŠ¡ï¼Œåˆ™ä»é˜Ÿåˆ—ä¸­é‡Šæ”¾ä¸€ä¸ªä»»åŠ¡ã€‚<br><br><br>åœ¨ GCD ä¸­æœ‰ä¸¤ç§é˜Ÿåˆ—ï¼šä¸²è¡Œé˜Ÿåˆ—å’Œå¹¶å‘é˜Ÿåˆ—ã€‚ä¸¤è€…éƒ½ç¬¦åˆ FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰çš„åŸåˆ™ã€‚ä¸¤è€…çš„ä¸»è¦åŒºåˆ«æ˜¯ï¼šæ‰§è¡Œé¡ºåºä¸åŒï¼Œä»¥åŠå¼€å¯çº¿ç¨‹æ•°ä¸åŒã€‚</p><h3 id="ä¸²è¡Œé˜Ÿåˆ—ï¼ˆSerial-Dispatch-Queueï¼‰"><a href="#ä¸²è¡Œé˜Ÿåˆ—ï¼ˆSerial-Dispatch-Queueï¼‰" class="headerlink" title="ä¸²è¡Œé˜Ÿåˆ—ï¼ˆSerial Dispatch Queueï¼‰"></a>ä¸²è¡Œé˜Ÿåˆ—ï¼ˆSerial Dispatch Queueï¼‰</h3><p>æ¯æ¬¡åªæœ‰ä¸€ä¸ªä»»åŠ¡è¢«æ‰§è¡Œã€‚è®©ä»»åŠ¡ä¸€ä¸ªæ¥ç€ä¸€ä¸ªåœ°æ‰§è¡Œã€‚ï¼ˆåªå¼€å¯ä¸€ä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå®Œæ¯•åï¼Œå†æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡ï¼‰</p><h3 id="å¹¶å‘é˜Ÿåˆ—ï¼ˆConcurrent-Dispatch-Queueï¼‰"><a href="#å¹¶å‘é˜Ÿåˆ—ï¼ˆConcurrent-Dispatch-Queueï¼‰" class="headerlink" title="å¹¶å‘é˜Ÿåˆ—ï¼ˆConcurrent Dispatch Queueï¼‰"></a>å¹¶å‘é˜Ÿåˆ—ï¼ˆConcurrent Dispatch Queueï¼‰</h3><p>å¯ä»¥è®©å¤šä¸ªä»»åŠ¡å¹¶å‘ï¼ˆåŒæ—¶ï¼‰æ‰§è¡Œã€‚ï¼ˆå¯ä»¥å¼€å¯å¤šä¸ªçº¿ç¨‹ï¼Œå¹¶ä¸”åŒæ—¶æ‰§è¡Œä»»åŠ¡ï¼‰</p><blockquote><p>æ³¨æ„ï¼šå¹¶å‘é˜Ÿåˆ— çš„å¹¶å‘åŠŸèƒ½åªæœ‰åœ¨å¼‚æ­¥ï¼ˆdispatch_asyncï¼‰å‡½æ•°ä¸‹æ‰æœ‰æ•ˆ</p></blockquote><h2 id="dispatch-queue-t"><a href="#dispatch-queue-t" class="headerlink" title="dispatch_queue_t"></a>dispatch_queue_t</h2><table><thead><tr><th>ä»»åŠ¡</th><th>é˜Ÿåˆ—</th></tr></thead><tbody><tr><td>åŒæ­¥</td><td>ä¸²è¡Œ</td></tr><tr><td>å¼‚æ­¥</td><td>å¹¶å‘</td></tr><tr><td>#### ç»„åˆç»“æœ</td><td></td></tr><tr><td>ç»„åˆ</td><td>ç»“æœ</td></tr><tr><td>â€”</td><td>â€”</td></tr><tr><td>åŒæ­¥æ‰§è¡Œ + å¹¶å‘é˜Ÿåˆ—</td><td>åœ¨å½“å‰çº¿ç¨‹ä¸­æ‰§è¡Œä»»åŠ¡ï¼Œä¸ä¼šå¼€å¯æ–°çº¿ç¨‹ï¼Œæ‰§è¡Œå®Œä¸€ä¸ªä»»åŠ¡ï¼Œå†æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡</td></tr><tr><td>å¼‚æ­¥æ‰§è¡Œ + å¹¶å‘é˜Ÿåˆ—</td><td>å¯ä»¥å¼€å¯å¤šä¸ªçº¿ç¨‹ï¼Œä»»åŠ¡äº¤æ›¿ï¼ˆåŒæ—¶ï¼‰æ‰§è¡Œ</td></tr><tr><td>åŒæ­¥æ‰§è¡Œ + ä¸²è¡Œé˜Ÿåˆ—</td><td>ä¸ä¼šå¼€å¯æ–°çº¿ç¨‹ï¼Œåœ¨å½“å‰çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ã€‚ä»»åŠ¡æ˜¯ä¸²è¡Œçš„ï¼Œæ‰§è¡Œå®Œä¸€ä¸ªä»»åŠ¡ï¼Œå†æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡</td></tr><tr><td>å¼‚æ­¥æ‰§è¡Œ + ä¸²è¡Œé˜Ÿåˆ—</td><td>ä¼šå¼€å¯æ–°çº¿ç¨‹ï¼Œä½†æ˜¯å› ä¸ºä»»åŠ¡æ˜¯ä¸²è¡Œçš„ï¼Œæ‰§è¡Œå®Œä¸€ä¸ªä»»åŠ¡ï¼Œå†æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡</td></tr><tr><td>åŒæ­¥æ‰§è¡Œ + ä¸»é˜Ÿåˆ—</td><td>åœ¨ä¸»çº¿ç¨‹ä¸­è°ƒç”¨ä¼šå‡ºç°æ­»é”ï¼Œè€Œåœ¨å…¶ä»–çº¿ç¨‹ä¸­åˆ™ä¸ä¼š</td></tr><tr><td>å¼‚æ­¥æ‰§è¡Œ + ä¸»é˜Ÿåˆ—</td><td>äº’ç›¸ç­‰å¾…å¡ä½ä¸å¯è¡Œ</td></tr></tbody></table><h3 id="åˆ›å»º"><a href="#åˆ›å»º" class="headerlink" title="åˆ›å»º"></a>åˆ›å»º</h3><h4 id="ä¸²è¡Œé˜Ÿåˆ—"><a href="#ä¸²è¡Œé˜Ÿåˆ—" class="headerlink" title="ä¸²è¡Œé˜Ÿåˆ—"></a>ä¸²è¡Œé˜Ÿåˆ—</h4><p>å¸¸ç”¨å®å®šä¹‰</p><table><thead><tr><th>åç§°</th><th>å€¼</th></tr></thead><tbody><tr><td>DISPATCH_QUEUE_SERIAL</td><td>NULL</td></tr><tr><td>DISPATCH_QUEUE_SERIAL_INACTIVE</td><td>dispatch_queue_attr_make_initially_inactive(DISPATCH_QUEUE_SERIAL)</td></tr><tr><td>DISPATCH_QUEUE_SERIAL_WITH_AUTORELEASE_POOL</td><td>dispatch_queue_attr_make_with_autorelease_frequency(DISPATCH_QUEUE_SERIAL, DISPATCH_AUTORELEASE_FREQUENCY_WORK_ITEM)</td></tr></tbody></table><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dispatch_queue_create(&quot;æ ‡è¯†&quot;, DISPATCH_QUEUE_SERIAL);</span><br></pre></td></tr></table></figure><h4 id="å¹¶å‘é˜Ÿåˆ—"><a href="#å¹¶å‘é˜Ÿåˆ—" class="headerlink" title="å¹¶å‘é˜Ÿåˆ—"></a>å¹¶å‘é˜Ÿåˆ—</h4><p>å¸¸ç”¨å®å®šä¹‰</p><table><thead><tr><th>åç§°</th><th>å€¼</th></tr></thead><tbody><tr><td>DISPATCH_QUEUE_CONCURRENT</td><td>NULL</td></tr><tr><td>DISPATCH_QUEUE_CONCURRENT_INACTIVE</td><td>dispatch_queue_attr_make_initially_inactive(DISPATCH_QUEUE_CONCURRENT)</td></tr><tr><td>DISPATCH_QUEUE_CONCURRENT_WITH_AUTORELEASE_POOL</td><td>dispatch_queue_attr_make_with_autorelease_frequency(DISPATCH_QUEUE_SERIAL,DISPATCH_AUTORELEASE_FREQUENCY_WORK_ITEM)</td></tr></tbody></table><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dispatch_queue_t queue &#x3D; dispatch_queue_create(&quot;æ ‡è¯†&quot;, DISPATCH_QUEUE_CONCURRENT);</span><br></pre></td></tr></table></figure><h4 id="è·å–ä¸»çº¿ç¨‹"><a href="#è·å–ä¸»çº¿ç¨‹" class="headerlink" title="è·å–ä¸»çº¿ç¨‹"></a>è·å–ä¸»çº¿ç¨‹</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dispatch_get_main_queue();</span><br></pre></td></tr></table></figure><h4 id="è·å–ç³»ç»Ÿé»˜è®¤çš„å…¨å±€å¹¶å‘é˜Ÿåˆ—"><a href="#è·å–ç³»ç»Ÿé»˜è®¤çš„å…¨å±€å¹¶å‘é˜Ÿåˆ—" class="headerlink" title="è·å–ç³»ç»Ÿé»˜è®¤çš„å…¨å±€å¹¶å‘é˜Ÿåˆ—"></a>è·å–ç³»ç»Ÿé»˜è®¤çš„å…¨å±€å¹¶å‘é˜Ÿåˆ—</h4><h4 id="iOS-8-0"><a href="#iOS-8-0" class="headerlink" title="iOS 8.0"></a>iOS 8.0</h4><table><thead><tr><th>åç§°</th><th>æ„ä¹‰</th></tr></thead><tbody><tr><td>QOS_CLASS_USER_INTERACTIVE</td><td>ç”¨æˆ·äº¤äº’(å¸Œæœ›å°½å¿«å®Œæˆï¼Œç”¨æˆ·å¯¹ç»“æœå¾ˆæœŸæœ›ï¼Œä¸è¦æ”¾å¤ªè€—æ—¶æ“ä½œ)</td></tr><tr><td>QOS_CLASS_USER_INITIATED</td><td>ç”¨æˆ·æœŸæœ›(ä¸è¦æ”¾å¤ªè€—æ—¶æ“ä½œ)</td></tr><tr><td>QOS_CLASS_DEFAULT</td><td>é»˜è®¤(ä¸æ˜¯ç»™ç¨‹åºå‘˜ä½¿ç”¨çš„ï¼Œç”¨æ¥é‡ç½®å¯¹åˆ—ä½¿ç”¨çš„)</td></tr><tr><td>QOS_CLASS_UTILITY</td><td>å®ç”¨å·¥å…·(è€—æ—¶æ“ä½œï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªé€‰é¡¹)</td></tr><tr><td>QOS_CLASS_BACKGROUND</td><td>åå°</td></tr><tr><td>QOS_CLASS_UNSPECIFIED</td><td>æœªæŒ‡å®š</td></tr></tbody></table><h4 id="iOS-8-0ä¹‹å‰"><a href="#iOS-8-0ä¹‹å‰" class="headerlink" title="iOS 8.0ä¹‹å‰"></a>iOS 8.0ä¹‹å‰</h4><table><thead><tr><th>åç§°</th><th>æ„ä¹‰</th></tr></thead><tbody><tr><td>DISPATCH_QUEUE_PRIORITY_HIGH</td><td>é«˜ä¼˜å…ˆçº§</td></tr><tr><td>DISPATCH_QUEUE_PRIORITY_DEFAULT</td><td>é»˜è®¤ä¼˜å…ˆçº§</td></tr><tr><td>DISPATCH_QUEUE_PRIORITY_LOW</td><td>ä½ä¼˜å…ˆçº§</td></tr><tr><td>DISPATCH_QUEUE_PRIORITY_BACKGROUND</td><td>åå°ä¼˜å…ˆçº§</td></tr><tr><td><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);</span><br></pre></td></tr></table></figure></td><td></td></tr></tbody></table><h4 id="å¼‚æ­¥æ‰§è¡Œ"><a href="#å¼‚æ­¥æ‰§è¡Œ" class="headerlink" title="å¼‚æ­¥æ‰§è¡Œ"></a>å¼‚æ­¥æ‰§è¡Œ</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">int context &#x3D; 10;</span><br><span class="line">&#x2F;**</span><br><span class="line">  é˜Ÿåˆ—å¼‚æ­¥æ‰§è¡Œ</span><br><span class="line"></span><br><span class="line">  @param queue é˜Ÿåˆ—</span><br><span class="line">  @param context è¦ä¼ é€’ç»™å‡½æ•°çš„åº”ç”¨ç¨‹åºå®šä¹‰çš„ä¸Šä¸‹æ–‡å‚æ•°ã€‚</span><br><span class="line">  @param asyncMethod cæ“ä½œæ–¹æ³•</span><br><span class="line">  @return dispatch_queue_t</span><br><span class="line">*&#x2F;</span><br><span class="line">dispatch_async_f(queue, &amp;context, asyncMethod);</span><br><span class="line"></span><br><span class="line">void asyncMethod() &#123;</span><br><span class="line">    &#x2F;&#x2F; TODO</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dispatch_sync(queue, ^&#123;</span><br><span class="line">    &#x2F;&#x2F; TODO</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="åŒæ­¥æ‰§è¡Œ"><a href="#åŒæ­¥æ‰§è¡Œ" class="headerlink" title="åŒæ­¥æ‰§è¡Œ"></a>åŒæ­¥æ‰§è¡Œ</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">int context &#x3D; 10;</span><br><span class="line">&#x2F;**</span><br><span class="line">  é˜Ÿåˆ—åŒæ­¥æ‰§è¡Œ</span><br><span class="line"></span><br><span class="line">  @param queue é˜Ÿåˆ—</span><br><span class="line">  @param context è¦ä¼ é€’ç»™å‡½æ•°çš„åº”ç”¨ç¨‹åºå®šä¹‰çš„ä¸Šä¸‹æ–‡å‚æ•°ã€‚</span><br><span class="line">  @param syncMethod cæ“ä½œæ–¹æ³•</span><br><span class="line">  @return dispatch_queue_t</span><br><span class="line"> *&#x2F;</span><br><span class="line">dispatch_sync_f(queue, &amp;context, syncMethod);</span><br><span class="line"></span><br><span class="line">void syncMethod() &#123;</span><br><span class="line">    &#x2F;&#x2F; TODO</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dispatch_sync(queue, ^&#123;</span><br><span class="line">    &#x2F;&#x2F; TODO</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="å»¶è¿Ÿæ“ä½œ"><a href="#å»¶è¿Ÿæ“ä½œ" class="headerlink" title="å»¶è¿Ÿæ“ä½œ"></a>å»¶è¿Ÿæ“ä½œ</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">int context &#x3D; 10;</span><br><span class="line">dispatch_after_f(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(1.2 * NSEC_PER_SEC)), queue, &amp;context, afterMethod);</span><br><span class="line">void afterMethod() &#123;</span><br><span class="line">    &#x2F;&#x2F; TODO</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dispatch_queue_t queue &#x3D; dispatch_get_main_queue();</span><br><span class="line"> dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(1.2 * NSEC_PER_SEC)), queue, ^&#123;</span><br><span class="line">    &#x2F;&#x2F; TODO</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="å¿«é€Ÿè¿­ä»£"><a href="#å¿«é€Ÿè¿­ä»£" class="headerlink" title="å¿«é€Ÿè¿­ä»£"></a>å¿«é€Ÿè¿­ä»£</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">int context &#x3D; 1;</span><br><span class="line">&#x2F;&#x2F; æ‰§è¡Œ10æ¬¡applyMethodå‡½æ•°</span><br><span class="line">dispatch_apply_f(10, queue, &amp;context, applyMethod);</span><br><span class="line">void applyMethod() &#123;</span><br><span class="line">    &#x2F;&#x2F; TODO</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dispatch_apply(10, queue, ^(size_t index) &#123;</span><br><span class="line">    &#x2F;&#x2F; TODO</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="æ‰§è¡Œä¸€æ¬¡"><a href="#æ‰§è¡Œä¸€æ¬¡" class="headerlink" title="æ‰§è¡Œä¸€æ¬¡"></a>æ‰§è¡Œä¸€æ¬¡</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">dispatch_once_f(&amp;onceToken, &amp;context, onceMethod);</span><br><span class="line">void onceMethod() &#123;</span><br><span class="line">    &#x2F;&#x2F; TODO</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static dispatch_once_t onceToken;</span><br><span class="line">dispatch_once(&amp;onceToken, ^&#123;</span><br><span class="line">    &#x2F;&#x2F; TODO</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="æ …æ æ–¹æ³•"><a href="#æ …æ æ–¹æ³•" class="headerlink" title="æ …æ æ–¹æ³•"></a>æ …æ æ–¹æ³•</h4><p>å°†é˜Ÿåˆ—æ‰§è¡Œçš„æ“ä½œç»„ç»™åˆ†å‰²èµ·æ¥ã€‚</p><ul><li>dispatch_barrier_async<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">int context &#x3D; 10;</span><br><span class="line">dispatch_barrier_async_f(queue, &amp;context, barrierAsync);</span><br><span class="line"></span><br><span class="line">void barrierAsync() &#123;</span><br><span class="line">    &#x2F;&#x2F; TODO</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dispatch_barrier_async(queue, ^&#123;</span><br><span class="line">    &#x2F;&#x2F; TODO</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li><li>dispatch_barrier_sync<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">int context &#x3D; 10;</span><br><span class="line">dispatch_barrier_sync_f(queue, &amp;context, barrierAsync);</span><br><span class="line"></span><br><span class="line">void barrierSync() &#123;</span><br><span class="line">    &#x2F;&#x2F; TODO</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dispatch_barrier_sync(queue, ^&#123;</span><br><span class="line">    &#x2F;&#x2F; TODO</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>dispatch_barrier_syncå’Œdispatch_barrier_asyncçš„å…±åŒç‚¹ï¼š <blockquote><ul><li>1ã€éƒ½ä¼šç­‰å¾…åœ¨å®ƒå‰é¢æ’å…¥é˜Ÿåˆ—çš„ä»»åŠ¡å…ˆæ‰§è¡Œå®Œ </li><li>2ã€éƒ½ä¼šç­‰å¾…ä»–ä»¬è‡ªå·±çš„ä»»åŠ¡æ‰§è¡Œå®Œå†æ‰§è¡Œåé¢çš„ä»»åŠ¡</li></ul></blockquote></li></ul><p>dispatch_barrier_syncå’Œdispatch_barrier_asyncçš„ä¸å…±åŒç‚¹ï¼š </p><blockquote><ul><li>åœ¨å°†ä»»åŠ¡æ’å…¥åˆ°queueçš„æ—¶å€™ï¼Œdispatch_barrier_syncéœ€è¦ç­‰å¾…è‡ªå·±çš„ä»»åŠ¡ç»“æŸä¹‹åæ‰ä¼šç»§ç»­ç¨‹åºï¼Œç„¶åæ’å…¥è¢«å†™åœ¨å®ƒåé¢çš„ä»»åŠ¡ï¼Œç„¶åæ‰§è¡Œåé¢çš„ä»»åŠ¡<br>è€Œdispatch_barrier_asyncå°†è‡ªå·±çš„ä»»åŠ¡æ’å…¥åˆ°queueä¹‹åï¼Œä¸ä¼šç­‰å¾…è‡ªå·±çš„ä»»åŠ¡ç»“æŸï¼Œå®ƒä¼šç»§ç»­æŠŠåé¢çš„ä»»åŠ¡æ’å…¥åˆ°queueã€‚</li><li>æ‰€ä»¥ï¼Œdispatch_barrier_asyncçš„ä¸ç­‰å¾…ï¼ˆå¼‚æ­¥ï¼‰ç‰¹æ€§ä½“ç°åœ¨å°†ä»»åŠ¡æ’å…¥é˜Ÿåˆ—çš„è¿‡ç¨‹ï¼Œå®ƒçš„ç­‰å¾…ç‰¹æ€§ä½“ç°åœ¨ä»»åŠ¡çœŸæ­£æ‰§è¡Œçš„è¿‡ç¨‹ã€‚</li></ul></blockquote><h2 id="dispatch-semaphore"><a href="#dispatch-semaphore" class="headerlink" title="dispatch_semaphore"></a>dispatch_semaphore</h2><p>GCD ä¸­çš„ä¿¡å·é‡æ˜¯æŒ‡ Dispatch Semaphoreï¼Œæ˜¯æŒæœ‰è®¡æ•°çš„ä¿¡å·ã€‚ç±»ä¼¼äºè¿‡é«˜é€Ÿè·¯æ”¶è´¹ç«™çš„æ æ†ã€‚å¯ä»¥é€šè¿‡æ—¶ï¼Œæ‰“å¼€æ æ†ï¼Œä¸å¯ä»¥é€šè¿‡æ—¶ï¼Œå…³é—­æ æ†ã€‚åœ¨ Dispatch Semaphore ä¸­ï¼Œä½¿ç”¨è®¡æ•°æ¥å®Œæˆè¿™ä¸ªåŠŸèƒ½ï¼Œè®¡æ•°ä¸º0æ—¶ç­‰å¾…ï¼Œä¸å¯é€šè¿‡ã€‚è®¡æ•°ä¸º1æˆ–å¤§äº1æ—¶ï¼Œè®¡æ•°å‡1ä¸”ä¸ç­‰å¾…ï¼Œå¯é€šè¿‡ã€‚<br><br></p><h5 id="Dispatch-Semaphore-æä¾›äº†ä¸‰ä¸ªå‡½æ•°ã€‚"><a href="#Dispatch-Semaphore-æä¾›äº†ä¸‰ä¸ªå‡½æ•°ã€‚" class="headerlink" title="Dispatch Semaphore æä¾›äº†ä¸‰ä¸ªå‡½æ•°ã€‚"></a>Dispatch Semaphore æä¾›äº†ä¸‰ä¸ªå‡½æ•°ã€‚</h5><ul><li>dispatch_semaphore_createï¼šåˆ›å»ºä¸€ä¸ªSemaphoreå¹¶åˆå§‹åŒ–ä¿¡å·çš„æ€»é‡</li><li>dispatch_semaphore_signalï¼šå‘é€ä¸€ä¸ªä¿¡å·ï¼Œè®©ä¿¡å·æ€»é‡åŠ 1</li><li>dispatch_semaphore_waitï¼šå¯ä»¥ä½¿æ€»ä¿¡å·é‡å‡1ï¼Œå½“ä¿¡å·æ€»é‡ä¸º0æ—¶å°±ä¼šä¸€ç›´ç­‰å¾…ï¼ˆé˜»å¡æ‰€åœ¨çº¿ç¨‹ï¼‰ï¼Œå¦åˆ™å°±å¯ä»¥æ­£å¸¸æ‰§è¡Œã€‚</li></ul><blockquote><p>æ³¨æ„ï¼šä¿¡å·é‡çš„ä½¿ç”¨å‰ææ˜¯ï¼šæƒ³æ¸…æ¥šä½ éœ€è¦å¤„ç†å“ªä¸ªçº¿ç¨‹ç­‰å¾…ï¼ˆé˜»å¡ï¼‰ï¼Œåˆè¦å“ªä¸ªçº¿ç¨‹ç»§ç»­æ‰§è¡Œï¼Œç„¶åä½¿ç”¨ä¿¡å·é‡ã€‚</p></blockquote><h5 id="Dispatch-Semaphore-åœ¨å®é™…å¼€å‘ä¸­ä¸»è¦ç”¨äºï¼š"><a href="#Dispatch-Semaphore-åœ¨å®é™…å¼€å‘ä¸­ä¸»è¦ç”¨äºï¼š" class="headerlink" title="Dispatch Semaphore åœ¨å®é™…å¼€å‘ä¸­ä¸»è¦ç”¨äºï¼š"></a>Dispatch Semaphore åœ¨å®é™…å¼€å‘ä¸­ä¸»è¦ç”¨äºï¼š</h5><ul><li>ä¿æŒçº¿ç¨‹åŒæ­¥ï¼Œå°†å¼‚æ­¥æ‰§è¡Œä»»åŠ¡è½¬æ¢ä¸ºåŒæ­¥æ‰§è¡Œä»»åŠ¡</li><li>ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œä¸ºçº¿ç¨‹åŠ é”</li></ul><h3 id="Dispatch-Semaphore-çº¿ç¨‹åŒæ­¥"><a href="#Dispatch-Semaphore-çº¿ç¨‹åŒæ­¥" class="headerlink" title="Dispatch Semaphore çº¿ç¨‹åŒæ­¥"></a>Dispatch Semaphore çº¿ç¨‹åŒæ­¥</h3><p>æˆ‘ä»¬åœ¨å¼€å‘ä¸­ï¼Œä¼šé‡åˆ°è¿™æ ·çš„éœ€æ±‚ï¼šå¼‚æ­¥æ‰§è¡Œè€—æ—¶ä»»åŠ¡ï¼Œå¹¶ä½¿ç”¨å¼‚æ­¥æ‰§è¡Œçš„ç»“æœè¿›è¡Œä¸€äº›é¢å¤–çš„æ“ä½œã€‚æ¢å¥è¯è¯´ï¼Œç›¸å½“äºï¼Œå°†å°†å¼‚æ­¥æ‰§è¡Œä»»åŠ¡è½¬æ¢ä¸ºåŒæ­¥æ‰§è¡Œä»»åŠ¡ã€‚æ¯”å¦‚è¯´ï¼šAFNetworking ä¸­ AFURLSessionManager.m é‡Œé¢çš„ tasksForKeyPath: æ–¹æ³•ã€‚é€šè¿‡å¼•å…¥ä¿¡å·é‡çš„æ–¹å¼ï¼Œç­‰å¾…å¼‚æ­¥æ‰§è¡Œä»»åŠ¡ç»“æœï¼Œè·å–åˆ° tasksï¼Œç„¶åå†è¿”å›è¯¥ tasksã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">- (NSArray *)tasksForKeyPath:(NSString *)keyPath &#123;</span><br><span class="line">    __block NSArray *tasks &#x3D; nil;</span><br><span class="line">    dispatch_semaphore_t semaphore &#x3D; dispatch_semaphore_create(0);</span><br><span class="line">    [self.session getTasksWithCompletionHandler:^(NSArray *dataTasks, NSArray *uploadTasks, NSArray *downloadTasks) &#123;</span><br><span class="line">        if ([keyPath isEqualToString:NSStringFromSelector(@selector(dataTasks))]) &#123;</span><br><span class="line">            tasks &#x3D; dataTasks;</span><br><span class="line">        &#125; else if ([keyPath isEqualToString:NSStringFromSelector(@selector(uploadTasks))]) &#123;</span><br><span class="line">            tasks &#x3D; uploadTasks;</span><br><span class="line">        &#125; else if ([keyPath isEqualToString:NSStringFromSelector(@selector(downloadTasks))]) &#123;</span><br><span class="line">            tasks &#x3D; downloadTasks;</span><br><span class="line">        &#125; else if ([keyPath isEqualToString:NSStringFromSelector(@selector(tasks))]) &#123;</span><br><span class="line">            tasks &#x3D; [@[dataTasks, uploadTasks, downloadTasks] valueForKeyPath:@&quot;@unionOfArrays.self&quot;];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        dispatch_semaphore_signal(semaphore);</span><br><span class="line">    &#125;];</span><br><span class="line"></span><br><span class="line">    dispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER);</span><br><span class="line"></span><br><span class="line">    return tasks;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Dispatch-Semaphore-çº¿ç¨‹å®‰å…¨å’Œçº¿ç¨‹åŒæ­¥ï¼ˆä¸ºçº¿ç¨‹åŠ é”ï¼‰"><a href="#Dispatch-Semaphore-çº¿ç¨‹å®‰å…¨å’Œçº¿ç¨‹åŒæ­¥ï¼ˆä¸ºçº¿ç¨‹åŠ é”ï¼‰" class="headerlink" title="Dispatch Semaphore çº¿ç¨‹å®‰å…¨å’Œçº¿ç¨‹åŒæ­¥ï¼ˆä¸ºçº¿ç¨‹åŠ é”ï¼‰"></a>Dispatch Semaphore çº¿ç¨‹å®‰å…¨å’Œçº¿ç¨‹åŒæ­¥ï¼ˆä¸ºçº¿ç¨‹åŠ é”ï¼‰</h3><ul><li><p>çº¿ç¨‹å®‰å…¨ï¼šå¦‚æœä½ çš„ä»£ç æ‰€åœ¨çš„è¿›ç¨‹ä¸­æœ‰å¤šä¸ªçº¿ç¨‹åœ¨åŒæ—¶è¿è¡Œï¼Œè€Œè¿™äº›çº¿ç¨‹å¯èƒ½ä¼šåŒæ—¶è¿è¡Œè¿™æ®µä»£ç ã€‚å¦‚æœæ¯æ¬¡è¿è¡Œç»“æœå’Œå•çº¿ç¨‹è¿è¡Œçš„ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œè€Œä¸”å…¶ä»–çš„å˜é‡çš„å€¼ä¹Ÿå’Œé¢„æœŸçš„æ˜¯ä¸€æ ·çš„ï¼Œå°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚<br><br>è‹¥æ¯ä¸ªçº¿ç¨‹ä¸­å¯¹å…¨å±€å˜é‡ã€é™æ€å˜é‡åªæœ‰è¯»æ“ä½œï¼Œè€Œæ— å†™æ“ä½œï¼Œä¸€èˆ¬æ¥è¯´ï¼Œè¿™ä¸ªå…¨å±€å˜é‡æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼›è‹¥æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œå†™æ“ä½œï¼ˆæ›´æ”¹å˜é‡ï¼‰ï¼Œä¸€èˆ¬éƒ½éœ€è¦è€ƒè™‘çº¿ç¨‹åŒæ­¥ï¼Œå¦åˆ™çš„è¯å°±å¯èƒ½å½±å“çº¿ç¨‹å®‰å…¨ã€‚</p></li><li><p>çº¿ç¨‹åŒæ­¥ï¼šå¯ç†è§£ä¸ºçº¿ç¨‹ A å’Œ çº¿ç¨‹ B ä¸€å—é…åˆï¼ŒA æ‰§è¡Œåˆ°ä¸€å®šç¨‹åº¦æ—¶è¦ä¾é çº¿ç¨‹ B çš„æŸä¸ªç»“æœï¼Œäºæ˜¯åœä¸‹æ¥ï¼Œç¤ºæ„ B è¿è¡Œï¼›B ä¾è¨€æ‰§è¡Œï¼Œå†å°†ç»“æœç»™ Aï¼›A å†ç»§ç»­æ“ä½œã€‚</p></li><li><p>ä¸¾ä¸ªç®€å•ä¾‹å­å°±æ˜¯ï¼šä¸¤ä¸ªäººåœ¨ä¸€èµ·èŠå¤©ã€‚ä¸¤ä¸ªäººä¸èƒ½åŒæ—¶è¯´è¯ï¼Œé¿å…å¬ä¸æ¸…(æ“ä½œå†²çª)ã€‚ç­‰ä¸€ä¸ªäººè¯´å®Œ(ä¸€ä¸ªçº¿ç¨‹ç»“æŸæ“ä½œ)ï¼Œå¦ä¸€ä¸ªå†è¯´(å¦ä¸€ä¸ªçº¿ç¨‹å†å¼€å§‹æ“ä½œ)ã€‚<br>ä¸‹é¢ï¼Œæˆ‘ä»¬æ¨¡æ‹Ÿç«è½¦ç¥¨å”®å–çš„æ–¹å¼ï¼Œå®ç° NSThread çº¿ç¨‹å®‰å…¨å’Œè§£å†³çº¿ç¨‹åŒæ­¥é—®é¢˜ã€‚<br>åœºæ™¯ï¼šæ€»å…±æœ‰50å¼ ç«è½¦ç¥¨ï¼Œæœ‰ä¸¤ä¸ªå”®å–ç«è½¦ç¥¨çš„çª—å£ï¼Œä¸€ä¸ªæ˜¯åŒ—äº¬ç«è½¦ç¥¨å”®å–çª—å£ï¼Œå¦ä¸€ä¸ªæ˜¯ä¸Šæµ·ç«è½¦ç¥¨å”®å–çª—å£ã€‚ä¸¤ä¸ªçª—å£åŒæ—¶å”®å–ç«è½¦ç¥¨ï¼Œå–å®Œä¸ºæ­¢ã€‚</p><h4 id="éçº¿ç¨‹å®‰å…¨ï¼ˆä¸ä½¿ç”¨-semaphoreï¼‰"><a href="#éçº¿ç¨‹å®‰å…¨ï¼ˆä¸ä½¿ç”¨-semaphoreï¼‰" class="headerlink" title="éçº¿ç¨‹å®‰å…¨ï¼ˆä¸ä½¿ç”¨ semaphoreï¼‰"></a>éçº¿ç¨‹å®‰å…¨ï¼ˆä¸ä½¿ç”¨ semaphoreï¼‰</h4><p>å…ˆæ¥çœ‹çœ‹ä¸è€ƒè™‘çº¿ç¨‹å®‰å…¨çš„ä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * éçº¿ç¨‹å®‰å…¨ï¼šä¸ä½¿ç”¨ semaphore</span><br><span class="line"> * åˆå§‹åŒ–ç«è½¦ç¥¨æ•°é‡ã€å–ç¥¨çª—å£(éçº¿ç¨‹å®‰å…¨)ã€å¹¶å¼€å§‹å–ç¥¨</span><br><span class="line"> *&#x2F;</span><br><span class="line">- (void)initTicketStatusNotSave &#123;</span><br><span class="line">    NSLog(@&quot;currentThread---%@&quot;,[NSThread currentThread]);  &#x2F;&#x2F; æ‰“å°å½“å‰çº¿ç¨‹</span><br><span class="line">    NSLog(@&quot;semaphore---begin&quot;);</span><br><span class="line">    </span><br><span class="line">    self.ticketSurplusCount &#x3D; 50;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; queue1 ä»£è¡¨åŒ—äº¬ç«è½¦ç¥¨å”®å–çª—å£</span><br><span class="line">    dispatch_queue_t queue1 &#x3D; dispatch_queue_create(&quot;net.bujige.testQueue1&quot;, DISPATCH_QUEUE_SERIAL);</span><br><span class="line">    &#x2F;&#x2F; queue2 ä»£è¡¨ä¸Šæµ·ç«è½¦ç¥¨å”®å–çª—å£</span><br><span class="line">    dispatch_queue_t queue2 &#x3D; dispatch_queue_create(&quot;net.bujige.testQueue2&quot;, DISPATCH_QUEUE_SERIAL);</span><br><span class="line">    </span><br><span class="line">    __weak typeof(self) weakSelf &#x3D; self;</span><br><span class="line">    dispatch_async(queue1, ^&#123;</span><br><span class="line">        [weakSelf saleTicketNotSafe];</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    dispatch_async(queue2, ^&#123;</span><br><span class="line">        [weakSelf saleTicketNotSafe];</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * å”®å–ç«è½¦ç¥¨(éçº¿ç¨‹å®‰å…¨)</span><br><span class="line"> *&#x2F;</span><br><span class="line">- (void)saleTicketNotSafe &#123;</span><br><span class="line">    while (1) &#123;</span><br><span class="line">        </span><br><span class="line">        if (self.ticketSurplusCount &gt; 0) &#123;  &#x2F;&#x2F;å¦‚æœè¿˜æœ‰ç¥¨ï¼Œç»§ç»­å”®å–</span><br><span class="line">            self.ticketSurplusCount--;</span><br><span class="line">            NSLog(@&quot;%@&quot;, [NSString stringWithFormat:@&quot;å‰©ä½™ç¥¨æ•°ï¼š%d çª—å£ï¼š%@&quot;, self.ticketSurplusCount, [NSThread currentThread]]);</span><br><span class="line">            [NSThread sleepForTimeInterval:0.2];</span><br><span class="line">        &#125; else &#123; &#x2F;&#x2F;å¦‚æœå·²å–å®Œï¼Œå…³é—­å”®ç¥¨çª—å£</span><br><span class="line">            NSLog(@&quot;æ‰€æœ‰ç«è½¦ç¥¨å‡å·²å”®å®Œ&quot;);</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¾“å‡ºç»“æœï¼ˆéƒ¨åˆ†ï¼‰ï¼š<br>2018-02-23 22:25:35.789072+0800 YSC-GCD-demo[20712:5258914] currentThreadâ€”&lt;NSThread: 0x604000068880&gt;{number = 1, name = main}</p></blockquote></li></ul><blockquote><p>2018-02-23 22:25:35.789260+0800 YSC-GCD-demo[20712:5258914] semaphoreâ€”begin</p></blockquote><blockquote><p>2018-02-23 22:25:35.789641+0800 YSC-GCD-demo[20712:5259176] å‰©ä½™ç¥¨æ•°ï¼š48 çª—å£ï¼š&lt;NSThread: 0x60000027db80&gt;{number = 3, name = (null)}</p></blockquote><blockquote><p>2018-02-23 22:25:35.789646+0800 YSC-GCD-demo[20712:5259175] å‰©ä½™ç¥¨æ•°ï¼š49 çª—å£ï¼š&lt;NSThread: 0x60000027e740&gt;{number = 4, name = (null)}</p></blockquote><blockquote><p>2018-02-23 22:25:35.994113+0800 YSC-GCD-demo[20712:5259175] å‰©ä½™ç¥¨æ•°ï¼š47 çª—å£ï¼š&lt;NSThread: 0x60000027e740&gt;{number = 4, name = (null)}</p></blockquote><blockquote><p>2018-02-23 22:25:35.994129+0800 YSC-GCD-demo[20712:5259176] å‰©ä½™ç¥¨æ•°ï¼š46 çª—å£ï¼š&lt;NSThread: 0x60000027db80&gt;{number = 3, name = (null)}</p></blockquote><blockquote><p>2018-02-23 22:25:36.198993+0800 YSC-GCD-demo[20712:5259176] å‰©ä½™ç¥¨æ•°ï¼š45 çª—å£ï¼š&lt;NSThread: 0x60000027db80&gt;{number = 3, name = (null)}</p></blockquote><p>å¯ä»¥çœ‹åˆ°åœ¨ä¸è€ƒè™‘çº¿ç¨‹å®‰å…¨ï¼Œä¸ä½¿ç”¨ semaphore çš„æƒ…å†µä¸‹ï¼Œå¾—åˆ°ç¥¨æ•°æ˜¯é”™ä¹±çš„ï¼Œè¿™æ ·æ˜¾ç„¶ä¸ç¬¦åˆæˆ‘ä»¬çš„éœ€æ±‚ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p><h4 id="çº¿ç¨‹å®‰å…¨ï¼ˆä½¿ç”¨-semaphore-åŠ é”ï¼‰"><a href="#çº¿ç¨‹å®‰å…¨ï¼ˆä½¿ç”¨-semaphore-åŠ é”ï¼‰" class="headerlink" title="çº¿ç¨‹å®‰å…¨ï¼ˆä½¿ç”¨ semaphore åŠ é”ï¼‰"></a>çº¿ç¨‹å®‰å…¨ï¼ˆä½¿ç”¨ semaphore åŠ é”ï¼‰</h4><p>è€ƒè™‘çº¿ç¨‹å®‰å…¨çš„ä»£ç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * çº¿ç¨‹å®‰å…¨ï¼šä½¿ç”¨ semaphore åŠ é”</span><br><span class="line"> * åˆå§‹åŒ–ç«è½¦ç¥¨æ•°é‡ã€å–ç¥¨çª—å£(çº¿ç¨‹å®‰å…¨)ã€å¹¶å¼€å§‹å–ç¥¨</span><br><span class="line"> *&#x2F;</span><br><span class="line">- (void)initTicketStatusSave &#123;</span><br><span class="line">    NSLog(@&quot;currentThread---%@&quot;,[NSThread currentThread]);  &#x2F;&#x2F; æ‰“å°å½“å‰çº¿ç¨‹</span><br><span class="line">    NSLog(@&quot;semaphore---begin&quot;);</span><br><span class="line">    </span><br><span class="line">    semaphoreLock &#x3D; dispatch_semaphore_create(1);</span><br><span class="line">    </span><br><span class="line">    self.ticketSurplusCount &#x3D; 50;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; queue1 ä»£è¡¨åŒ—äº¬ç«è½¦ç¥¨å”®å–çª—å£</span><br><span class="line">    dispatch_queue_t queue1 &#x3D; dispatch_queue_create(&quot;net.bujige.testQueue1&quot;, DISPATCH_QUEUE_SERIAL);</span><br><span class="line">    &#x2F;&#x2F; queue2 ä»£è¡¨ä¸Šæµ·ç«è½¦ç¥¨å”®å–çª—å£</span><br><span class="line">    dispatch_queue_t queue2 &#x3D; dispatch_queue_create(&quot;net.bujige.testQueue2&quot;, DISPATCH_QUEUE_SERIAL);</span><br><span class="line">    </span><br><span class="line">    __weak typeof(self) weakSelf &#x3D; self;</span><br><span class="line">    dispatch_async(queue1, ^&#123;</span><br><span class="line">        [weakSelf saleTicketSafe];</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    dispatch_async(queue2, ^&#123;</span><br><span class="line">        [weakSelf saleTicketSafe];</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * å”®å–ç«è½¦ç¥¨(çº¿ç¨‹å®‰å…¨)</span><br><span class="line"> *&#x2F;</span><br><span class="line">- (void)saleTicketSafe &#123;</span><br><span class="line">    while (1) &#123;</span><br><span class="line">        &#x2F;&#x2F; ç›¸å½“äºåŠ é”</span><br><span class="line">        dispatch_semaphore_wait(semaphoreLock, DISPATCH_TIME_FOREVER);</span><br><span class="line">        </span><br><span class="line">        if (self.ticketSurplusCount &gt; 0) &#123;  &#x2F;&#x2F;å¦‚æœè¿˜æœ‰ç¥¨ï¼Œç»§ç»­å”®å–</span><br><span class="line">            self.ticketSurplusCount--;</span><br><span class="line">            NSLog(@&quot;%@&quot;, [NSString stringWithFormat:@&quot;å‰©ä½™ç¥¨æ•°ï¼š%d çª—å£ï¼š%@&quot;, self.ticketSurplusCount, [NSThread currentThread]]);</span><br><span class="line">            [NSThread sleepForTimeInterval:0.2];</span><br><span class="line">        &#125; else &#123; &#x2F;&#x2F;å¦‚æœå·²å–å®Œï¼Œå…³é—­å”®ç¥¨çª—å£</span><br><span class="line">            NSLog(@&quot;æ‰€æœ‰ç«è½¦ç¥¨å‡å·²å”®å®Œ&quot;);</span><br><span class="line">            </span><br><span class="line">            &#x2F;&#x2F; ç›¸å½“äºè§£é”</span><br><span class="line">            dispatch_semaphore_signal(semaphoreLock);</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        &#x2F;&#x2F; ç›¸å½“äºè§£é”</span><br><span class="line">        dispatch_semaphore_signal(semaphoreLock);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¾“å‡ºç»“æœä¸ºï¼š<br>2018-02-23 22:32:19.814232+0800 YSC-GCD-demo[20862:5290531] currentThreadâ€”&lt;NSThread: 0x6000000783c0&gt;{number = 1, name = main}</p></blockquote><blockquote><p>2018-02-23 22:32:19.814412+0800 YSC-GCD-demo[20862:5290531] semaphoreâ€”begin</p></blockquote><blockquote><p>2018-02-23 22:32:19.814837+0800 YSC-GCD-demo[20862:5290687] å‰©ä½™ç¥¨æ•°ï¼š49 çª—å£ï¼š&lt;NSThread: 0x6040002709c0&gt;{number = 3, name = (null)}</p></blockquote><blockquote><p>2018-02-23 22:32:20.017745+0800 YSC-GCD-demo[20862:5290689] å‰©ä½™ç¥¨æ•°ï¼š48 çª—å£ï¼š&lt;NSThread: 0x60000046c640&gt;{number = 4, name = (null)}</p></blockquote><blockquote><p>2018-02-23 22:32:20.222039+0800 YSC-GCD-demo[20862:5290687] å‰©ä½™ç¥¨æ•°ï¼š47 çª—å£ï¼š&lt;NSThread: 0x6040002709c0&gt;{number = 3, name = (null)}</p></blockquote><blockquote><p>â€¦<br>2018-02-23 22:32:29.024817+0800 YSC-GCD-demo[20862:5290689] å‰©ä½™ç¥¨æ•°ï¼š4 çª—å£ï¼š&lt;NSThread: 0x60000046c640&gt;{number = 4, name = (null)}</p></blockquote><blockquote><p>2018-02-23 22:32:29.230110+0800 YSC-GCD-demo[20862:5290687] å‰©ä½™ç¥¨æ•°ï¼š3 çª—å£ï¼š&lt;NSThread: 0x6040002709c0&gt;{number = 3, name = (null)}</p></blockquote><blockquote><p>2018-02-23 22:32:29.433615+0800 YSC-GCD-demo[20862:5290689] å‰©ä½™ç¥¨æ•°ï¼š2 çª—å£ï¼š&lt;NSThread: 0x60000046c640&gt;{number = 4, name = (null)}</p></blockquote><blockquote><p>2018-02-23 22:32:29.637572+0800 YSC-GCD-demo[20862:5290687] å‰©ä½™ç¥¨æ•°ï¼š1 çª—å£ï¼š&lt;NSThread: 0x6040002709c0&gt;{number = 3, name = (null)}</p></blockquote><blockquote><p>2018-02-23 22:32:29.840234+0800 YSC-GCD-demo[20862:5290689] å‰©ä½™ç¥¨æ•°ï¼š0 çª—å£ï¼š&lt;NSThread: 0x60000046c640&gt;{number = 4, name = (null)}</p></blockquote><blockquote><p>2018-02-23 22:32:30.044960+0800 YSC-GCD-demo[20862:5290687] æ‰€æœ‰ç«è½¦ç¥¨å‡å·²å”®å®Œ</p></blockquote><blockquote><p>2018-02-23 22:32:30.045260+0800 YSC-GCD-demo[20862:5290689] æ‰€æœ‰ç«è½¦ç¥¨å‡å·²å”®å®Œ</p></blockquote><p>å¯ä»¥çœ‹å‡ºï¼Œåœ¨è€ƒè™‘äº†çº¿ç¨‹å®‰å…¨çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨ dispatch_semaphore<br>æœºåˆ¶ä¹‹åï¼Œå¾—åˆ°çš„ç¥¨æ•°æ˜¯æ­£ç¡®çš„ï¼Œæ²¡æœ‰å‡ºç°æ··ä¹±çš„æƒ…å†µã€‚æˆ‘ä»¬ä¹Ÿå°±è§£å†³äº†å¤šä¸ªçº¿ç¨‹åŒæ­¥çš„é—®é¢˜ã€‚</p><h2 id="dispatch-group"><a href="#dispatch-group" class="headerlink" title="dispatch_group"></a>dispatch_group</h2><p>å¤šä¸ªä»»åŠ¡æ”¾åˆ°ä¸€ä¸ªç»„ä¸­ã€‚</p><h3 id="dispatch-group-t"><a href="#dispatch-group-t" class="headerlink" title="dispatch_group_t"></a>dispatch_group_t</h3><h4 id="åˆ›å»º-1"><a href="#åˆ›å»º-1" class="headerlink" title="åˆ›å»º"></a>åˆ›å»º</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dispatch_group_t group &#x3D; dispatch_group_create();</span><br></pre></td></tr></table></figure><h4 id="æ·»åŠ ä»»åŠ¡"><a href="#æ·»åŠ ä»»åŠ¡" class="headerlink" title="æ·»åŠ ä»»åŠ¡"></a>æ·»åŠ ä»»åŠ¡</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">dispatch_queue_t queue &#x3D; dispatch_queue_create(&quot;name&quot;, DISPATCH_QUEUE_SERIAL);</span><br><span class="line">int context &#x3D; 10;</span><br><span class="line">dispatch_group_async_f(group, queue, &amp;context, groupMethod);</span><br><span class="line">void groupMethod() &#123;</span><br><span class="line">    &#x2F;&#x2F; TODO</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dispatch_queue_t queue &#x3D; dispatch_queue_create(&quot;name&quot;, DISPATCH_QUEUE_SERIAL);</span><br><span class="line">dispatch_group_async(group, queue, ^&#123;</span><br><span class="line">    &#x2F;&#x2F; TODO</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="å…¶ä»–æ“ä½œ"><a href="#å…¶ä»–æ“ä½œ" class="headerlink" title="å…¶ä»–æ“ä½œ"></a>å…¶ä»–æ“ä½œ</h4><h5 id="1-è·å–ä»»åŠ¡ç»„ä»»åŠ¡å®Œæˆï¼Œè¿›è¡Œæ“ä½œ"><a href="#1-è·å–ä»»åŠ¡ç»„ä»»åŠ¡å®Œæˆï¼Œè¿›è¡Œæ“ä½œ" class="headerlink" title="1. è·å–ä»»åŠ¡ç»„ä»»åŠ¡å®Œæˆï¼Œè¿›è¡Œæ“ä½œ"></a>1. è·å–ä»»åŠ¡ç»„ä»»åŠ¡å®Œæˆï¼Œè¿›è¡Œæ“ä½œ</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œå®Œï¼Œé€šçŸ¥è°ƒåº¦ç»„ï¼Œåœ¨queueä¸Šå¼‚æ­¥æ‰§è¡Œblockï¼Œä¸ä¼šé˜»å¡å½“å‰ä»»åŠ¡</span><br><span class="line">dispatch_group_notify_f(group, queue5, &amp;context, groupMethod);</span><br><span class="line"></span><br><span class="line">void groupMethod() &#123;</span><br><span class="line">    &#x2F;&#x2F; TODO</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; dispatch_group_notify_fçš„å°è£…    </span><br><span class="line">dispatch_group_notify(group, queue, ^&#123;</span><br><span class="line">    &#x2F;&#x2F; TODO</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="2-é€šçŸ¥groupï¼Œä¸‹é¢çš„ä»»åŠ¡é©¬ä¸Šè¦æ”¾åˆ°groupä¸­æ‰§è¡Œäº†ã€‚"><a href="#2-é€šçŸ¥groupï¼Œä¸‹é¢çš„ä»»åŠ¡é©¬ä¸Šè¦æ”¾åˆ°groupä¸­æ‰§è¡Œäº†ã€‚" class="headerlink" title="2. é€šçŸ¥groupï¼Œä¸‹é¢çš„ä»»åŠ¡é©¬ä¸Šè¦æ”¾åˆ°groupä¸­æ‰§è¡Œäº†ã€‚"></a>2. é€šçŸ¥groupï¼Œä¸‹é¢çš„ä»»åŠ¡é©¬ä¸Šè¦æ”¾åˆ°groupä¸­æ‰§è¡Œäº†ã€‚</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dispatch_group_enter(group);</span><br></pre></td></tr></table></figure><h4 id="3-é€šçŸ¥groupï¼Œä»»åŠ¡å®Œæˆäº†ï¼Œè¯¥ä»»åŠ¡è¦ä»groupä¸­ç§»é™¤äº†ã€‚"><a href="#3-é€šçŸ¥groupï¼Œä»»åŠ¡å®Œæˆäº†ï¼Œè¯¥ä»»åŠ¡è¦ä»groupä¸­ç§»é™¤äº†ã€‚" class="headerlink" title="3. é€šçŸ¥groupï¼Œä»»åŠ¡å®Œæˆäº†ï¼Œè¯¥ä»»åŠ¡è¦ä»groupä¸­ç§»é™¤äº†ã€‚"></a>3. é€šçŸ¥groupï¼Œä»»åŠ¡å®Œæˆäº†ï¼Œè¯¥ä»»åŠ¡è¦ä»groupä¸­ç§»é™¤äº†ã€‚</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dispatch_group_leave(group);</span><br></pre></td></tr></table></figure><h4 id="4-è®¾ç½®è¶…æ—¶"><a href="#4-è®¾ç½®è¶…æ—¶" class="headerlink" title="4. è®¾ç½®è¶…æ—¶"></a>4. è®¾ç½®è¶…æ—¶</h4><p>å‡è®¾åˆ›å»ºdispatch_group_waité‡Œçš„dispatch_timeç­‰å¾…æ—¶é—´æ˜¯4ç§’,é‚£ä¹ˆgroupé‡Œçš„å†…å®¹åœ¨4så†…å®Œæˆçš„è¯,é‚£waitç›´æ¥ç»“æŸ,å¦‚æœgroupåœ¨4så†…æ²¡æœ‰æ‰§è¡Œå®Œ,é‚£ä¹ˆwaitä¹Ÿä¼šç»“æŸ,ç»“æŸä¹‹å,å‘¨æœ«çš„ä»»åŠ¡å°±ä¼šè¢«åŠ è¿›æ¥äº†ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">long result &#x3D; dispatch_group_wait(group, dispatch_time(DISPATCH_TIME_NOW, 4.0 * NSEC_PER_SEC));</span><br><span class="line">if (result) &#123;</span><br><span class="line">    NSLog(@&quot;è¶…è¿‡ç­‰å¾…æ—¶é—´äº†&quot;);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    NSLog(@&quot;æ—¶é—´æ²¡æœ‰è¶…è¿‡ç­‰å¾…æ—¶é—´&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Objective-C </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åº•å±‚åŸç† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iOSåº•å±‚-Runtime-æ¶ˆæ¯è½¬å‘</title>
      <link href="/2020/01/16/iOS%E5%BA%95%E5%B1%82-Runtime-%E6%B6%88%E6%81%AF%E8%BD%AC%E5%8F%91/"/>
      <url>/2020/01/16/iOS%E5%BA%95%E5%B1%82-Runtime-%E6%B6%88%E6%81%AF%E8%BD%AC%E5%8F%91/</url>
      
        <content type="html"><![CDATA[<p>iOS æ–¹æ³•çš„åŠ¨æ€è§£æå’Œæ¶ˆæ¯è½¬å‘</p><p>ä»¥åˆ›å»ºçš„Messageç±»ä¸ºç¤ºä¾‹<br>Message.h</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@interface Message : NSObject</span><br><span class="line"></span><br><span class="line">- (void)sendMessage:(NSString *)message;</span><br><span class="line"></span><br><span class="line">+ (void)sendClassMessage:(NSString *)message;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure><p>Message.m</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@implementation Message</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure><h3 id="åŠ¨æ€æ–¹æ³•è§£æ"><a href="#åŠ¨æ€æ–¹æ³•è§£æ" class="headerlink" title="åŠ¨æ€æ–¹æ³•è§£æ"></a>åŠ¨æ€æ–¹æ³•è§£æ</h3><p>å¾è¯¢æ¥æ”¶è€…æ‰€å±çš„ç±»ï¼Œæ˜¯å¦éœ€è¦åŠ¨æ€æ·»åŠ ç±»æ–¹æ³•æˆ–å®ä¾‹æ–¹æ³•ï¼Œæ¥å¤„ç†è¿™ä¸ªæœªæ‰¾åˆ°çš„æ–¹æ³•ã€‚</p><ol><li>é¦–å…ˆåˆ¤æ–­æ˜¯å¦å®ç°äº† <code>resolveInstanceMethod</code>ï¼Œå¦‚æœæ²¡æœ‰å®ç°ï¼Œè¿›å…¥ä¸‹ä¸€æ­¥å¤„ç†ï¼›</li><li>å¦‚æœå®ç°äº†ï¼Œè°ƒç”¨ <code>resolveInstanceMethod</code>ï¼Œè·å–è¿”å›å€¼ï¼›</li><li>å¦‚æœè¿”å›å€¼ä¸º YESï¼Œè¡¨ç¤º <code>resolveInstanceMethod</code> å£°ç§°å®ƒå·²ç»æä¾›äº† <code>selector</code> çš„å®ç°ï¼Œå› æ­¤å†æ¬¡æŸ¥æ‰¾ method listï¼Œå¦‚æœæ‰¾åˆ°å¯¹åº”çš„ <code>IMP</code>ï¼Œåˆ™è¿”å›è¯¥å®ç°ï¼Œå¦åˆ™æç¤ºè­¦å‘Šä¿¡æ¯ï¼Œè¿›å…¥ä¸‹ä¸€æ­¥å¤„ç†ï¼›</li><li>å¦‚æœè¿”å›å€¼ä¸º NOï¼Œè¿›å…¥ä¸‹ä¸€æ­¥å¤„ç†ï¼›<h4 id="1-å¯¹è±¡æ–¹æ³•"><a href="#1-å¯¹è±¡æ–¹æ³•" class="headerlink" title="1. å¯¹è±¡æ–¹æ³•"></a>1. å¯¹è±¡æ–¹æ³•</h4>é€šè¿‡<code>+ (BOOL)resolveInstanceMethod:(SEL)sel;</code>æ–¹æ³•è¿›è¡Œè§£æ<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+ (BOOL)resolveInstanceMethod:(SEL)sel &#123;</span><br><span class="line">    if (sel &#x3D;&#x3D; @selector(sendMessage:)) &#123;</span><br><span class="line">        class_addMethod([self class], sel, (IMP)innerSenderMessageMetod, &quot;v@:@&quot;);</span><br><span class="line">        return YES;</span><br><span class="line">    &#125;</span><br><span class="line">    return [super resolveInstanceMethod:sel];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void innerSenderMessageMetod(id obj, SEL _cmd) &#123;</span><br><span class="line">    NSLog(@&quot;å¯¹è±¡æ–¹æ³•ï¼ŒåŠ¨æ€è§£æ&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-ç±»æ–¹æ³•"><a href="#2-ç±»æ–¹æ³•" class="headerlink" title="2. ç±»æ–¹æ³•"></a>2. ç±»æ–¹æ³•</h4>é€šè¿‡<code>+ (BOOL)resolveClassMethod:(SEL)sel;</code>æ–¹æ³•è¿›è¡Œè§£æ<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+ (BOOL)resolveClassMethod:(SEL)sel &#123;</span><br><span class="line">    if (sel &#x3D;&#x3D; @selector(sendClassMessage:)) &#123;</span><br><span class="line">        class_addMethod(object_getClass(self), sel, (IMP)innerSenderClassMessageMetod, &quot;v@:@&quot;);</span><br><span class="line">        return YES;</span><br><span class="line">    &#125;</span><br><span class="line">    return [super resolveClassMethod:sel];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void innerSenderClassMessageMetod(id obj, SEL _cmd) &#123;</span><br><span class="line">    NSLog(@&quot;ç±»æ–¹æ³•ï¼ŒåŠ¨æ€è§£æ&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é‡å®šå‘"><a href="#é‡å®šå‘" class="headerlink" title="é‡å®šå‘"></a>é‡å®šå‘</h3>å¦‚æœæ²¡æœ‰åŠ¨æ€æ·»åŠ æ–¹æ³•ï¼Œåˆ™ä¼šè¿›å…¥æ­¤é˜¶æ®µï¼Œæ­¤æ—¶è¯¢é—®æ˜¯å¦è¦å°†è¿™æ¡æ¶ˆæ¯è½¬å‘ç»™å…¶ä»–çš„å¯¹è±¡ï¼Œæ¥å¤„ç†è¿™ä¸ªæ–¹æ³•ã€‚å¦‚æœè¿”å›nilï¼Œå³è¡¨ç¤ºä¸è½¬å‘ç»™å…¶ä»–å¯¹è±¡ï¼Œæ­¤æ—¶ä¼šè¿›å…¥ç¬¬3é˜¶æ®µ<br>åˆ›å»ºäº†ä¸€ä¸ªå¤‡ç”¨ç±»<code>MessageTemp</code><br>MessageTemp.h<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@interface MessageTemp : NSObject</span><br><span class="line"></span><br><span class="line">- (void)sendMessage:(NSString *)message;</span><br><span class="line">- (void)sendClassMessage:(NSString *)message;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure>MessageTemp.m<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@implementation MessageTemp</span><br><span class="line">- (void)sendMessage:(NSString *)message &#123;</span><br><span class="line">    NSLog(@&quot;å¤‡ç”¨Messageï¼Œè§£æå¯¹è±¡æ–¹æ³•&quot;);</span><br><span class="line">&#125;</span><br><span class="line">- (void)sendClassMessage:(NSString *)message &#123;</span><br><span class="line">    NSLog(@&quot;å¤‡ç”¨Messageï¼Œè§£æç±»æ–¹æ³•&quot;);</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br></pre></td></tr></table></figure><h4 id="1-å¯¹è±¡æ–¹æ³•-1"><a href="#1-å¯¹è±¡æ–¹æ³•-1" class="headerlink" title="1. å¯¹è±¡æ–¹æ³•"></a>1. å¯¹è±¡æ–¹æ³•</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- (id)forwardingTargetForSelector:(SEL)aSelector &#123;</span><br><span class="line">    if (aSelector &#x3D;&#x3D; @selector(sendMessage:)) &#123;</span><br><span class="line">        return [MessageTemp new];</span><br><span class="line">    &#125;</span><br><span class="line">    return [super forwardingTargetForSelector:aSelector];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-ç±»æ–¹æ³•-1"><a href="#2-ç±»æ–¹æ³•-1" class="headerlink" title="2. ç±»æ–¹æ³•"></a>2. ç±»æ–¹æ³•</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+ (id)forwardingTargetForSelector:(SEL)aSelector &#123;</span><br><span class="line">    if (aSelector &#x3D;&#x3D; @selector(sendClassMessage:)) &#123;</span><br><span class="line">        return [MessageTemp new];</span><br><span class="line">    &#125;</span><br><span class="line">    return [super forwardingTargetForSelector:aSelector];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ¶ˆæ¯è½¬å‘"><a href="#æ¶ˆæ¯è½¬å‘" class="headerlink" title="æ¶ˆæ¯è½¬å‘"></a>æ¶ˆæ¯è½¬å‘</h3>å½“ <code>forwardingTargetForSelector:</code> æ–¹æ³•æœªåšå‡ºä»»ä½•å“åº”çš„è¯ï¼Œä¼šæ¥åˆ°æ¶ˆæ¯è½¬å‘æµç¨‹ã€‚æ¶ˆæ¯è½¬å‘æ—¶ä¼šé¦–å…ˆè°ƒç”¨ <code>methodSignatureForSelector:</code> æ–¹æ³•ï¼Œåœ¨æ–¹æ³•å†…éƒ¨ç”Ÿæˆ <code>NSMethodSignature</code> ç±»å‹çš„æ–¹æ³•ç­¾åå¯¹è±¡ã€‚åœ¨ç”Ÿæˆç­¾åå¯¹è±¡æ—¶ï¼Œå¯ä»¥æŒ‡å®š <code>target</code> å’Œ <code>SEL</code>ï¼Œå¯ä»¥å°†è¿™ä¸¤ä¸ªå‚æ•°æ¢æˆå…¶ä»–å‚æ•°ï¼Œå°†æ¶ˆæ¯è½¬å‘ç»™å…¶ä»–å¯¹è±¡ã€‚<h4 id="1-å¯¹è±¡æ–¹æ³•-2"><a href="#1-å¯¹è±¡æ–¹æ³•-2" class="headerlink" title="1. å¯¹è±¡æ–¹æ³•"></a>1. å¯¹è±¡æ–¹æ³•</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">- (void)forwardInvocation:(NSInvocation *)anInvocation &#123;</span><br><span class="line">    if ([anInvocation selector] &#x3D;&#x3D; @selector(sendMessage:)) &#123;</span><br><span class="line">        [anInvocation invokeWithTarget:[MessageTemp new]];</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        [super forwardInvocation:anInvocation];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (NSMethodSignature *)methodSignatureForSelector:(SEL)aSelector &#123;</span><br><span class="line">    if (aSelector &#x3D;&#x3D; @selector(sendMessage:)) &#123;</span><br><span class="line">        return [NSMethodSignature signatureWithObjCTypes:&quot;v@:@&quot;];</span><br><span class="line">    &#125;</span><br><span class="line">    return [super methodSignatureForSelector:aSelector];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-ç±»æ–¹æ³•-2"><a href="#2-ç±»æ–¹æ³•-2" class="headerlink" title="2. ç±»æ–¹æ³•"></a>2. ç±»æ–¹æ³•</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">+ (void)forwardInvocation:(NSInvocation *)anInvocation &#123;</span><br><span class="line">    if ([anInvocation selector] &#x3D;&#x3D; @selector(sendClassMessage:)) &#123;</span><br><span class="line">        [anInvocation invokeWithTarget:[MessageTemp new]];</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        [super forwardInvocation:anInvocation];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (NSMethodSignature *)methodSignatureForSelector:(SEL)aSelector &#123;</span><br><span class="line">    if (aSelector &#x3D;&#x3D; @selector(sendClassMessage:)) &#123;</span><br><span class="line">        return [NSMethodSignature signatureWithObjCTypes:&quot;v@:@&quot;];</span><br><span class="line">    &#125;</span><br><span class="line">    return [super methodSignatureForSelector:aSelector];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h3></li></ol><ul><li>é€‚ç”¨äºæŠŠæ“ä½œç»™å¦å¤–ä¸€ä¸ªç±»æ¥å®ç°</li><li>åˆ©ç”¨åˆ†ç±»ï¼Œé˜²æ­¢åº”ç”¨ç¨‹åºå› ä¸ºæœªå¤„ç†æ¶ˆæ¯è€Œå´©æºƒ</li><li>Jspatch </li><li>Aspects</li><li>BlocksKit</li></ul>]]></content>
      
      
      <categories>
          
          <category> åº•å±‚åŸç† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> runtime </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
